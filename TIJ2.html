<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<title>Thinking in Java, 2nd Edition</title>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 5 4 2 2 2 2 2 4;}
@font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;}
@font-face
	{font-family:"Tms Rmn";
	panose-1:2 2 6 3 4 5 5 2 3 4;}
@font-face
	{font-family:Helv;
	panose-1:2 11 6 4 2 2 2 3 2 4;}
@font-face
	{font-family:"New York";
	panose-1:2 4 5 3 6 5 6 2 3 4;}
@font-face
	{font-family:System;
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"MS Mincho";
	panose-1:2 2 6 9 4 2 5 8 3 4;}
@font-face
	{font-family:Batang;
	panose-1:2 3 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:PMingLiU;
	panose-1:2 1 6 1 0 1 1 1 1 1;}
@font-face
	{font-family:"MS Gothic";
	panose-1:2 11 6 9 7 2 5 8 2 4;}
@font-face
	{font-family:Dotum;
	panose-1:2 11 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:SimHei;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:MingLiU;
	panose-1:2 1 6 9 0 1 1 1 1 1;}
@font-face
	{font-family:Mincho;
	panose-1:2 2 6 9 4 3 5 8 3 5;}
@font-face
	{font-family:Gulim;
	panose-1:2 11 6 0 0 1 1 1 1 1;}
@font-face
	{font-family:Century;
	panose-1:2 4 6 4 5 5 5 2 3 4;}
@font-face
	{font-family:"Angsana New";
	panose-1:2 2 6 3 5 4 5 2 3 4;}
@font-face
	{font-family:"Cordia New";
	panose-1:2 11 3 4 2 2 2 2 2 4;}
@font-face
	{font-family:Mangal;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Latha;
	panose-1:2 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Sylfaen;
	panose-1:1 10 5 2 5 3 6 3 3 3;}
@font-face
	{font-family:Vrinda;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Raavi;
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Shruti;
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Sendnya;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:Gautami;
	panose-1:2 0 5 0 0 0 0 0 0 0;}
@font-face
	{font-family:Tunga;
	panose-1:0 0 4 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Estrangelo Edessa";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:"Arial Unicode MS";
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:"Calibri Light";
	panose-1:2 15 3 2 2 2 4 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Segoe UI";
	panose-1:2 11 5 2 4 2 4 2 2 3;}
@font-face
	{font-family:"Calligraph421 BT";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:Georgia;
	panose-1:2 4 5 2 5 4 5 2 3 3;}
@font-face
	{font-family:"AmerType Md BT";}
@font-face
	{font-family:"\@MS Mincho";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:18.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
h1
	{mso-style-name:"Heading 1\,H1";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:18.0pt;
	margin-left:49.5pt;
	text-indent:-54.0pt;
	page-break-after:avoid;
	background:white;
	font-size:38.0pt;
	font-family:"Verdana","sans-serif";
	color:black;
	font-weight:normal;}
h2
	{mso-style-name:"Heading 2\,H2";
	margin-top:6.0pt;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:36.0pt;
	text-indent:-40.5pt;
	line-height:32.0pt;
	page-break-after:avoid;
	font-size:28.0pt;
	font-family:"Verdana","sans-serif";
	font-weight:normal;}
h3
	{mso-style-name:"Heading 3\,H3";
	margin-top:6.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:18.0pt;
	line-height:24.0pt;
	page-break-after:avoid;
	font-size:20.0pt;
	font-family:"Verdana","sans-serif";
	font-weight:normal;}
h4
	{mso-style-name:"Heading 4\,H4";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:36.0pt;
	page-break-after:avoid;
	font-size:15.0pt;
	font-family:"Verdana","sans-serif";
	font-weight:normal;}
h5
	{mso-style-name:"Heading 5\,H5";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:36.0pt;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Verdana","sans-serif";
	font-weight:normal;}
p.MsoHeading7, li.MsoHeading7, div.MsoHeading7
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:36.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Tms Rmn","serif";
	font-style:italic;}
p.MsoHeading8, li.MsoHeading8, div.MsoHeading8
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:36.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Tms Rmn","serif";
	font-style:italic;}
p.MsoHeading9, li.MsoHeading9, div.MsoHeading9
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:36.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Tms Rmn","serif";
	font-style:italic;}
p.MsoIndex1, li.MsoIndex1, div.MsoIndex1
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:10.1pt;
	margin-bottom:.0001pt;
	text-indent:-10.1pt;
	font-size:9.0pt;
	font-family:"Georgia","serif";}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin-top:6.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:14.0pt;
	page-break-after:avoid;
	background:#DFDFDF;
	font-size:14.0pt;
	font-family:"Georgia","serif";}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:36.0pt;
	margin-bottom:.0001pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:50.4pt;
	margin-bottom:.0001pt;
	line-height:14.0pt;
	font-size:8.0pt;
	font-family:"Georgia","serif";}
p.MsoFootnoteText, li.MsoFootnoteText, div.MsoFootnoteText
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:18.0pt;
	font-size:9.0pt;
	font-family:"Georgia","serif";}
p.MsoCommentText, li.MsoCommentText, div.MsoCommentText
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:18.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:18.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:0cm;
	line-height:14.0pt;
	border:none;
	padding:0cm;
	font-size:11.0pt;
	font-family:"Georgia","serif";
	font-style:italic;}
p.MsoIndexHeading, li.MsoIndexHeading, div.MsoIndexHeading
	{margin-top:18.0pt;
	margin-right:0cm;
	margin-bottom:12.0pt;
	margin-left:18.0pt;
	line-height:14.0pt;
	border:none;
	padding:0cm;
	font-size:12.0pt;
	font-family:"Georgia","serif";
	font-weight:bold;
	font-style:italic;}
span.MsoFootnoteReference
	{position:relative;
	top:-3.0pt;}
p.MsoListBullet, li.MsoListBullet, div.MsoListBullet
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:18.0pt;
	margin-bottom:.0001pt;
	text-indent:-18.0pt;
	font-size:12.0pt;
	font-family:"Georgia","serif";}
p.MsoList3, li.MsoList3, div.MsoList3
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:12.0pt;
	margin-left:54.0pt;
	text-indent:-18.0pt;
	font-size:12.0pt;
	font-family:"Georgia","serif";}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:18.0pt;
	text-align:center;
	font-size:79.0pt;
	font-family:"Georgia","serif";
	letter-spacing:-1.0pt;}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}
p.MsoBodyTextIndent, li.MsoBodyTextIndent, div.MsoBodyTextIndent
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:18.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
p.MsoBodyText2, li.MsoBodyText2, div.MsoBodyText2
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:6.0pt;
	margin-left:0cm;
	text-align:center;
	font-size:16.0pt;
	font-family:"Georgia","serif";}
p.MsoBodyText3, li.MsoBodyText3, div.MsoBodyText3
	{margin-top:1.0pt;
	margin-right:0cm;
	margin-bottom:4.0pt;
	margin-left:0cm;
	font-size:9.0pt;
	font-family:"Georgia","serif";}
p.MsoBodyTextIndent2, li.MsoBodyTextIndent2, div.MsoBodyTextIndent2
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:76.5pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
p.MsoBodyTextIndent3, li.MsoBodyTextIndent3, div.MsoBodyTextIndent3
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:18.0pt;
	margin-bottom:.0001pt;
	line-height:14.0pt;
	font-size:10.0pt;
	font-family:"Verdana","sans-serif";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
p.MsoPlainText, li.MsoPlainText, div.MsoPlainText
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";}
code
	{font-family:"Courier New";}
pre
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";}
p.MsoQuote, li.MsoQuote, div.MsoQuote
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:8.0pt;
	margin-left:18.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
p.Intro, li.Intro, div.Intro
	{mso-style-name:Intro;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:18.0pt;
	font-size:14.0pt;
	font-family:"Georgia","serif";}
p.Code, li.Code, div.Code
	{mso-style-name:Code;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:18.0pt;
	margin-bottom:.0001pt;
	line-height:13.0pt;
	border:none;
	padding:0cm;
	font-size:11.0pt;
	font-family:"Courier New";}
p.ChapterTitle, li.ChapterTitle, div.ChapterTitle
	{mso-style-name:"Chapter Title";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:36.0pt;
	margin-left:36.0pt;
	background:white;
	font-size:32.0pt;
	font-family:"Georgia","serif";}
p.Numbered, li.Numbered, div.Numbered
	{mso-style-name:Numbered;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:50.4pt;
	text-indent:-32.4pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
p.CodeInline, li.CodeInline, div.CodeInline
	{mso-style-name:CodeInline;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:18.0pt;
	line-height:13.0pt;
	border:none;
	padding:0cm;
	font-size:11.0pt;
	font-family:"Courier New";}
p.CodeInlineTrailer, li.CodeInlineTrailer, div.CodeInlineTrailer
	{mso-style-name:CodeInlineTrailer;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:1.0pt;
	margin-left:61.2pt;
	font-size:3.0pt;
	font-family:"Georgia","serif";}
p.Bullet, li.Bullet, div.Bullet
	{mso-style-name:Bullet;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:14.4pt;
	margin-bottom:.0001pt;
	text-indent:0cm;
	font-size:12.0pt;
	font-family:"Tms Rmn","serif";
	color:black;}
span.Emphasis
	{mso-style-name:"Emphasis\,EM";
	font-weight:bold;
	font-style:italic;}
p.EmphasisP, li.EmphasisP, div.EmphasisP
	{mso-style-name:EmphasisP;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:-7.2pt;
	margin-bottom:.0001pt;
	line-height:14.0pt;
	page-break-after:avoid;
	font-size:12.0pt;
	font-family:"Georgia","serif";
	font-weight:bold;
	font-style:italic;}
p.makeapoint, li.makeapoint, div.makeapoint
	{mso-style-name:makeapoint;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:57.6pt;
	line-height:14.0pt;
	font-size:14.0pt;
	font-family:"Georgia","serif";}
p.AfterTable, li.AfterTable, div.AfterTable
	{mso-style-name:AfterTable;
	margin-top:9.0pt;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:18.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
p.DrawingObject, li.DrawingObject, div.DrawingObject
	{mso-style-name:"Drawing Object";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:0cm;
	text-align:center;
	line-height:11.0pt;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";
	color:black;
	letter-spacing:-.2pt;
	layout-grid-mode:line;}
p.Comments, li.Comments, div.Comments
	{mso-style-name:Comments;
	margin-top:6.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:18.0pt;
	line-height:24.0pt;
	page-break-after:avoid;
	font-size:20.0pt;
	font-family:"Verdana","sans-serif";}
p.TitleNoTOC, li.TitleNoTOC, div.TitleNoTOC
	{mso-style-name:TitleNoTOC;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:12.0pt;
	margin-left:49.7pt;
	text-indent:-54.0pt;
	page-break-after:avoid;
	background:white;
	font-size:38.0pt;
	font-family:"Verdana","sans-serif";
	color:black;}
p.BulletTIJ, li.BulletTIJ, div.BulletTIJ
	{mso-style-name:BulletTIJ;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:18.0pt;
	text-indent:-18.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
p.Exercises, li.Exercises, div.Exercises
	{mso-style-name:Exercises;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:54.0pt;
	text-indent:-18.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
p.Table, li.Table, div.Table
	{mso-style-name:Table;
	margin-top:2.0pt;
	margin-right:7.2pt;
	margin-bottom:2.0pt;
	margin-left:7.2pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";
	font-weight:bold;}
p.TitlePage1, li.TitlePage1, div.TitlePage1
	{mso-style-name:TitlePage1;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:18.0pt;
	text-align:center;
	font-size:79.0pt;
	font-family:"Georgia","serif";
	letter-spacing:-1.0pt;}
p.TitlePage2, li.TitlePage2, div.TitlePage2
	{mso-style-name:TitlePage2;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:center;
	background:white;
	font-size:32.0pt;
	font-family:"Georgia","serif";}
p.TitlePage3, li.TitlePage3, div.TitlePage3
	{mso-style-name:TitlePage3;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:18.0pt;
	margin-left:0cm;
	text-align:center;
	line-height:72.0pt;
	background:white;
	font-size:80.0pt;
	font-family:"Georgia","serif";
	color:black;
	letter-spacing:-1.0pt;}
p.TitlePage4, li.TitlePage4, div.TitlePage4
	{mso-style-name:TitlePage4;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:18.0pt;
	margin-left:0cm;
	text-align:center;
	background:white;
	font-size:20.0pt;
	font-family:"Georgia","serif";}
p.TitlePage5, li.TitlePage5, div.TitlePage5
	{mso-style-name:TitlePage5;
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:center;
	background:white;
	font-size:32.0pt;
	font-family:"Georgia","serif";}
p.TitlePage6, li.TitlePage6, div.TitlePage6
	{mso-style-name:TitlePage6;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:36.0pt;
	margin-left:0cm;
	text-align:center;
	background:white;
	font-size:20.0pt;
	font-family:"Georgia","serif";}
p.TabularText, li.TabularText, div.TabularText
	{mso-style-name:TabularText;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:36.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
p.TableFollower, li.TableFollower, div.TableFollower
	{mso-style-name:TableFollower;
	margin-top:9.0pt;
	margin-right:0cm;
	margin-bottom:9.0pt;
	margin-left:18.0pt;
	line-height:14.0pt;
	font-size:11.0pt;
	font-family:"Georgia","serif";}
p.LicenseAgreement, li.LicenseAgreement, div.LicenseAgreement
	{mso-style-name:LicenseAgreement;
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:18.0pt;
	margin-bottom:.0001pt;
	line-height:13.0pt;
	font-size:9.0pt;
	font-family:"Verdana","sans-serif";}
span.msoIns
	{mso-style-name:"";
	text-decoration:underline;
	color:teal;}
span.msoDel
	{mso-style-name:"";
	text-decoration:line-through;
	color:red;}
 /* Page Definitions */
 @page WordSection1
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection1
	{page:WordSection1;}
@page WordSection2
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection2
	{page:WordSection2;}
@page WordSection3
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection3
	{page:WordSection3;}
@page WordSection4
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection4
	{page:WordSection4;}
@page WordSection5
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection5
	{page:WordSection5;}
@page WordSection6
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection6
	{page:WordSection6;}
@page WordSection7
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection7
	{page:WordSection7;}
@page WordSection8
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection8
	{page:WordSection8;}
@page WordSection9
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection9
	{page:WordSection9;}
@page WordSection10
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection10
	{page:WordSection10;}
@page WordSection11
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection11
	{page:WordSection11;}
@page WordSection12
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection12
	{page:WordSection12;}
@page WordSection13
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection13
	{page:WordSection13;}
@page WordSection14
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection14
	{page:WordSection14;}
@page WordSection15
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection15
	{page:WordSection15;}
@page WordSection16
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection16
	{page:WordSection16;}
@page WordSection17
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection17
	{page:WordSection17;}
@page WordSection18
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection18
	{page:WordSection18;}
@page WordSection19
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection19
	{page:WordSection19;}
@page WordSection20
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection20
	{page:WordSection20;}
@page WordSection21
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection21
	{page:WordSection21;}
@page WordSection22
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection22
	{page:WordSection22;}
@page WordSection23
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection23
	{page:WordSection23;}
@page WordSection24
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection24
	{page:WordSection24;}
@page WordSection25
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection25
	{page:WordSection25;}
@page WordSection26
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection26
	{page:WordSection26;}
@page WordSection27
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection27
	{page:WordSection27;}
@page WordSection28
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection28
	{page:WordSection28;}
@page WordSection29
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection29
	{page:WordSection29;}
@page WordSection30
	{size:612.0pt 792.0pt;
	margin:135.35pt 108.0pt 115.2pt 126.0pt;}
div.WordSection30
	{page:WordSection30;}
@page WordSection31
	{size:612.0pt 792.0pt;
	margin:124.55pt 108.0pt 128.15pt 126.0pt;}
div.WordSection31
	{page:WordSection31;}
 /* List Definitions */
 ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>

</head>

<body lang=EN-IN link=blue vlink=purple>

<div class=WordSection1>

<p class=TitlePage1 style='margin-bottom:0cm;margin-bottom:.0001pt'><span
lang=EN-US>Thinking</span></p>

<p class=TitlePage2><span lang=EN-US>in</span></p>

<p class=TitlePage3><span lang=EN-US>Java</span></p>

<p class=TitlePage4><span lang=EN-US>Second Edition</span></p>

<p class=TitlePage5><span lang=EN-US>Bruce Eckel</span></p>

<p class=TitlePage6><span lang=EN-US>President, MindView, Inc. </span></p>

<p class=TitleNoTOC style='margin-top:0cm;margin-right:0cm;margin-bottom:6.0pt;
margin-left:-4.3pt;text-indent:0cm'>

<table cellpadding=0 cellspacing=0 align=left>
 <tr>
  <td width=444 height=802></td>
 </tr>
 <tr>
  <td></td>
  <td><img width=215 height=113 src="TIJ2_files/image001.jpg"></td>
 </tr>
</table>

<span lang=EN-US><br clear=all style='page-break-before:always'>
</span><span lang=EN-US style='font-size:24.0pt'>Comments from readers:</span></p>

<p class=MsoQuote><i><span lang=EN-US>Much</span></i><span lang=EN-US> better
than any other Java book I’ve seen. Make that “by an order of magnitude”...
very complete, with excellent right-to-the-point examples and intelligent, not
dumbed-down, explanations ... In contrast to many other Java books I found it
to be unusually mature, consistent, intellectually honest, well-written and
precise. IMHO, an ideal book for studying Java. <b>Anatoly Vorobey, Technion
University, Haifa, Israel</b></span></p>

<p class=MsoQuote><span lang=EN-US>One of the absolutely best programming
tutorials I’ve seen for any language. <b>Joakim Ziegler, FIX sysop</b></span></p>

<p class=MsoQuote><span lang=EN-US>Thank you for your wonderful, wonderful book
on Java. <b>Dr. Gavin Pillay, Registrar, King Edward VIII Hospital, South
Africa</b></span></p>

<p class=MsoQuote><span lang=EN-US>Thank you again for your awesome book. I was
really floundering (being a non-C programmer), but your book has brought me up
to speed as fast as I could read it. It’s really cool to be able to understand
the underlying principles and concepts from the start, rather than having to try
to build that conceptual model through trial and error. Hopefully I will be
able to attend your seminar in the not-too-distant future. <b>Randall R.
Hawley, Automation Technician, Eli Lilly &amp; Co.</b></span></p>

<p class=MsoQuote><span lang=EN-US>The best computer book writing I have seen. <b>Tom
Holland</b></span></p>

<p class=MsoQuote><span lang=EN-US>This is one of the best books I’ve read
about a programming language… The best book ever written on Java. <b>Ravindra
Pai, Oracle Corporation, SUNOS product line</b></span></p>

<p class=MsoQuote><span lang=EN-US>This is the best book on Java that I have
ever found! You have done a great job. Your depth is amazing. I will be
purchasing the book when it is published. I have been learning Java since
October 96. I have read a few books, and consider yours a “MUST READ.” These
past few months we have been focused on a product written entirely in Java.
Your book has helped solidify topics I was shaky on and has expanded my
knowledge base. I have even used some of your explanations as information in
interviewing contractors to help our team. I have found how much Java knowledge
they have by asking them about things I have learned from reading your book
(e.g., the difference between arrays and Vectors). Your book is great! <b>Steve
Wilkinson, Senior Staff Specialist, MCI Telecommunications</b></span></p>

<p class=MsoQuote><span lang=EN-US>Great book. Best book on Java I have seen so
far. <b>Jeff Sinclair, Software Engineer, Kestral Computing</b></span></p>

<p class=MsoQuote><span lang=EN-US>Thank you for <i>Thinking in Java</i>. It’s
time someone went beyond mere language description to a thoughtful, penetrating
analytic tutorial that doesn’t kowtow to The Manufacturers. I’ve read almost
all the others—only yours and Patrick Winston’s have found a place in my heart.
I’m already recommending it to customers. Thanks again. <b>Richard Brooks, Java
Consultant, Sun Professional Services, Dallas</b></span></p>

<p class=MsoQuote><span lang=EN-US>Other books cover the WHAT of Java
(describing the syntax and the libraries) or the HOW of Java (practical
programming examples). <i>Thinking in Java</i> is the only book I know that
explains the WHY of Java; why it was designed the way it was, why it works the
way it does, why it sometimes doesn’t work, why it’s better than C++, why it’s
not. Although it also does a good job of teaching the what and how of the
language, <i>Thinking in Java</i> is definitely the thinking person’s choice in
a Java book. <b>Robert S. Stephenson</b> </span></p>

<p class=MsoQuote><span lang=EN-US>Thanks for writing a great book. The more I
read it the better I like it. My students like it, too. <b>Chuck Iverson</b></span></p>

<p class=MsoQuote><span lang=EN-US>I just want to commend you for your work on <i>Thinking
in Java</i>. It is people like you that dignify the future of the Internet and
I just want to thank you for your effort. It is very much appreciated. <b>Patrick
Barrell, Network Officer Mamco, QAF Mfg. Inc.</b></span></p>

<p class=MsoQuote><span lang=EN-US>Most of the Java books out there are fine
for a start, and most just have beginning stuff and a lot of the same examples.
Yours is by far the best advanced thinking book I’ve seen. Please publish it
soon! ... I also bought <i>Thinking in C++</i> just because I was so impressed
with <i>Thinking in Java</i>. <b>George Laframboise, LightWorx Technology
Consulting, Inc.</b></span></p>

<p class=MsoQuote><span lang=EN-US>I wrote to you earlier about my favorable
impressions regarding your <i>Thinking in C++</i> (a book that stands
prominently on my shelf here at work). And today I’ve been able to delve into
Java with your e-book in my virtual hand, and I must say (in my best Chevy
Chase from <i>Modern Problems</i>) “I like it!” Very informative and
explanatory, without reading like a dry textbook. You cover the most important
yet the least covered concepts of Java development: the whys. <b>Sean Brady</b></span></p>

<p class=MsoQuote><span lang=EN-US>Your examples are clear and easy to
understand. You took care of many important details of Java that can’t be found
easily in the weak Java documentation. And you don’t waste the reader’s time
with the basic facts a programmer already knows. <b>Kai Engert, Innovative
Software, Germany</b></span></p>

<p class=MsoQuote><span lang=EN-US>I’m a great fan of your <i>Thinking in C++</i>
and have recommended it to associates. As I go through the electronic version
of your Java book, I’m finding that you’ve retained the same high level of
writing. Thank you! <b>Peter R. Neuwald</b></span></p>

<p class=MsoQuote><span lang=EN-US>VERY well-written Java book...I think you’ve
done a GREAT job on it. As the leader of a Chicago-area Java special interest
group, I’ve favorably mentioned your book and Web site several times at our
recent meetings. I would like to use <i>Thinking in Java</i> as the basis for a
part of each monthly SIG meeting, in which we review and discuss each chapter
in succession. <b>Mark Ertes</b> </span></p>

<p class=MsoQuote><span lang=EN-US>I really appreciate your work and your book
is good. I recommend it here to our users and Ph.D. students. <b>Hugues Leroy
// Irisa-Inria Rennes France, Head of Scientific Computing and Industrial
Tranfert</b></span></p>

<p class=MsoQuote><span lang=EN-US>OK, I’ve only read about 40 pages of <i>Thinking
in Java</i>, but I’ve already found it to be the most clearly written and presented
programming book I’ve come across...and I’m a writer, myself, so I am probably
a little critical. I have <i>Thinking in C++</i> on order and can’t wait to
crack it—I’m fairly new to programming and am hitting learning curves head-on
everywhere. So this is just a quick note to say thanks for your excellent work.
I had begun to burn a little low on enthusiasm from slogging through the mucky,
murky prose of most computer books—even ones that came with glowing
recommendations. I feel a whole lot better now. <b>Glenn Becker, Educational
Theatre Association</b> </span></p>

<p class=MsoQuote><span lang=EN-US>Thank you for making your wonderful book
available. I have found it immensely useful in finally understanding what I
experienced as confusing in Java and C++. Reading your book has been very
satisfying. <b>Felix Bizaoui, Twin Oaks Industries, Louisa, Va.</b></span></p>

<p class=MsoQuote><span lang=EN-US>I must congratulate you on an excellent
book. I decided to have a look at <i>Thinking in Java</i> based on my
experience with <i>Thinking in C++</i>, and I was not disappointed. <b>Jaco van
der Merwe, Software Specialist, DataFusion Systems Ltd, Stellenbosch, South
Africa</b></span></p>

<p class=MsoQuote><span lang=EN-US>This has to be one of the best Java books
I’ve seen. <b>E.F. Pritchard, Senior Software Engineer, Cambridge Animation
Systems Ltd., United Kingdom</b></span></p>

<p class=MsoQuote><span lang=EN-US>Your book makes all the other Java books
I’ve read or flipped through seem doubly useless and insulting. <b>Brett g
Porter, Senior Programmer, Art &amp; Logic</b></span></p>

<p class=MsoQuote><span lang=EN-US>I have been reading your book for a week or
two and compared to the books I have read earlier on Java, your book seems to
have given me a great start. I have recommended this book to a lot of my
friends and they have rated it excellent. Please accept my congratulations for
coming out with an excellent book. <b>Rama Krishna Bhupathi, Software Engineer,
TCSI Corporation, San Jose</b></span></p>

<p class=MsoQuote><span lang=EN-US>Just wanted to say what a “brilliant” piece
of work your book is. I’ve been using it as a major reference for in-house Java
work. I find that the table of contents is just right for quickly locating the
section that is required. It’s also nice to see a book that is not just a
rehash of the API nor treats the programmer like a dummy. <b>Grant Sayer, Java
Components Group Leader, Ceedata Systems Pty Ltd, Australia</b></span></p>

<p class=MsoQuote><span lang=EN-US>Wow! A readable, in-depth Java book. There
are a lot of poor (and admittedly a couple of good) Java books out there, but
from what I’ve seen yours is definitely one of the best. <b>John Root, Web
Developer, Department of Social Security, London</b></span></p>

<p class=MsoQuote><span lang=EN-US>I’ve *just* started <i>Thinking in Java</i>.
I expect it to be very good because I really liked <i>Thinking in C++</i>
(which I read as an experienced C++ programmer, trying to stay ahead of the
curve). I’m somewhat less experienced in Java, but expect to be very satisfied.
You are a wonderful author. <b>Kevin K. Lewis, Technologist, ObjectSpace, Inc.</b></span></p>

<p class=MsoQuote><span lang=EN-US>I think it’s a great book. I learned all I
know about Java from this book. Thank you for making it available for free over
the Internet. If you wouldn’t have I’d know nothing about Java at all. But the
best thing is that your book isn’t a commercial brochure for Java. It also
shows the bad sides of Java. YOU have done a great job here. <b>Frederik Fix,
Belgium</b></span></p>

<p class=MsoQuote><span lang=EN-US>I have been hooked to your books all the
time. A couple of years ago, when I wanted to start with C++, it was <i>C++
Inside &amp; Out</i> which took me around the fascinating world of C++. It
helped me in getting better opportunities in life. Now, in pursuit of more
knowledge and when I wanted to learn Java, I bumped into <i>Thinking in Java</i>—no
doubts in my mind as to whether I need some other book. Just fantastic. It is
more like rediscovering myself as I get along with the book. It is just a month
since I started with Java, and heartfelt thanks to you, I am understanding it
better now. <b>Anand Kumar S., Software Engineer, Computervision, India</b></span></p>

<p class=MsoQuote><span lang=EN-US>Your book stands out as an excellent general
introduction. <b>Peter Robinson, University of Cambridge Computer Laboratory</b></span></p>

<p class=MsoQuote><span lang=EN-US>It’s by far the best material I have come
across to help me learn Java and I just want you to know how lucky I feel to
have found it. THANKS! <b>Chuck Peterson, Product Leader, Internet Product
Line, IVIS International</b></span></p>

<p class=MsoQuote><span lang=EN-US>The book is great. It’s the third book on
Java I’ve started and I’m about two-thirds of the way through it now. I plan to
finish this one. I found out about it because it is used in some internal
classes at Lucent Technologies and a friend told me the book was on the Net.
Good work. <b>Jerry Nowlin, MTS, Lucent Technologies</b></span></p>

<p class=MsoQuote><span lang=EN-US>Of the six or so Java books I’ve accumulated
to date, your <i>Thinking in Java</i> is by far the best and clearest. <b>Michael
Van Waas, Ph.D., President, TMR Associates</b></span></p>

<p class=MsoQuote><span lang=EN-US>I just want to say thanks for <i>Thinking in
Java</i>. What a wonderful book you’ve made here! Not to mention downloadable
for free! As a student I find your books invaluable (I have a copy of <i>C++
Inside Out</i>, another great book about C++), because they not only teach me
the how-to, but also the whys, which are of course very important in building a
strong foundation in languages such as C++ or Java. I have quite a lot of
friends here who love programming just as I do, and I’ve told them about your
books. They think it’s great! Thanks again! By the way, I’m Indonesian and I
live in Java. <b>Ray Frederick Djajadinata, Student at Trisakti University,
Jakarta</b></span></p>

<p class=MsoQuote><span lang=EN-US>The mere fact that you have made this work
free over the Net puts me into shock. I thought I’d let you know how much I
appreciate and respect what you’re doing. <b>Shane LeBouthillier, Computer
Engineering student, University of Alberta, Canada</b></span></p>

<p class=MsoQuote><span lang=EN-US>I have to tell you how much I look forward
to reading your monthly column. As a newbie to the world of object oriented
programming, I appreciate the time and thoughtfulness that you give to even the
most elementary topic. I have downloaded your book, but you can bet that I will
purchase the hard copy when it is published. Thanks for all of your help. <b>Dan
Cashmer, B. C. Ziegler &amp; Co.</b></span></p>

<p class=MsoQuote><span lang=EN-US>Just want to congratulate you on a job well
done. First I stumbled upon the PDF version of <i>Thinking in Java</i>. Even
before I finished reading it, I ran to the store and found <i>Thinking in C++</i>.
Now, I have been in the computer business for over eight years, as a
consultant, software engineer, teacher/trainer, and recently as self-employed,
so I’d like to think that I have seen enough (not “have seen it all,” mind you,
but enough). However, these books cause my girlfriend to call me a ”geek.” Not
that I have anything against the concept—it is just that I thought this phase
was well beyond me. But I find myself truly enjoying both books, like no other
computer book I have touched or bought so far. Excellent writing style, very
nice introduction of every new topic, and lots of wisdom in the books. Well
done. <b>Simon Goland, simonsez@smartt.com, Simon Says Consulting, Inc.</b></span></p>

<p class=MsoQuote><span lang=EN-US>I must say that your <i>Thinking in Java</i>
is great! That is exactly the kind of documentation I was looking for.
Especially the sections about good and poor software design using Java. <b>Dirk
Duehr, Lexikon Verlag, Bertelsmann AG, Germany</b> </span></p>

<p class=MsoQuote><span lang=EN-US>Thank you for writing two great books (<i>Thinking
in C++</i>, <i>Thinking in Java</i>). You have helped me immensely in my
progression to object oriented programming. <b>Donald Lawson, DCL Enterprises</b></span></p>

<p class=MsoQuote><span lang=EN-US>Thank you for taking the time to write a really
helpful book on Java. If teaching makes you understand something, by now you
must be pretty pleased with yourself. <b>Dominic Turner, GEAC Support</b></span></p>

<p class=MsoQuote><span lang=EN-US>It’s the best Java book I have ever read—and
I read some. <b>Jean-Yves MENGANT, Chief Software Architect NAT-SYSTEM, Paris,
France</b></span></p>

<p class=MsoQuote><i><span lang=EN-US>Thinking in Java</span></i><span
lang=EN-US> gives the best coverage and explanation. Very easy to read, and I
mean the code fragments as well. <b>Ron Chan, Ph.D., Expert Choice, Inc.,
Pittsburgh PA</b></span></p>

<p class=MsoQuote><span lang=EN-US>Your book is great. I have read lots of
programming books and your book still adds insights to programming in my mind. <b>Ningjian
Wang, Information System Engineer, The Vanguard Group</b></span></p>

<p class=MsoQuote><i><span lang=EN-US>Thinking in Java</span></i><span
lang=EN-US> is an excellent and readable book. I recommend it to all my
students. <b>Dr. Paul Gorman, Department of Computer Science, University of
Otago, Dunedin, New Zealand</b></span></p>

<p class=MsoQuote><span lang=EN-US>You make it possible for the proverbial free
lunch to exist, not just a soup kitchen type of lunch but a gourmet delight for
those who appreciate good software and books about it. <b>Jose Suriol, Scylax
Corporation</b></span></p>

<p class=MsoQuote><span lang=EN-US>Thanks for the opportunity of watching this
book grow into a masterpiece! IT IS THE BEST book on the subject that I’ve read
or browsed. <b>Jeff Lapchinsky, Programmer, Net Results Technologies</b></span></p>

<p class=MsoQuote><span lang=EN-US>Your book is concise, accessible and a joy
to read. <b>Keith Ritchie, Java Research &amp; Development Team, KL Group Inc.</b></span></p>

<p class=MsoQuote><span lang=EN-US>It truly is the best book I’ve read on Java!
<b>Daniel Eng</b></span></p>

<p class=MsoQuote><span lang=EN-US>The best book I have seen on Java! <b>Rich
Hoffarth, Senior Architect, West Group</b></span></p>

<p class=MsoQuote><span lang=EN-US>Thank you for a wonderful book. I’m having a
lot of fun going through the chapters. <b>Fred Trimble, Actium Corporation</b></span></p>

<p class=MsoQuote><span lang=EN-US>You have mastered the art of slowly and
successfully making us grasp the details. You make learning VERY easy and
satisfying. Thank you for a truly wonderful tutorial. <b>Rajesh Rau, Software
Consultant</b></span></p>

<p class=MsoQuote><i><span lang=EN-US>Thinking in Java</span></i><span
lang=EN-US> rocks the free world! <b>Miko O’Sullivan, President, Idocs Inc.</b></span></p>

<b><i><span lang=EN-US style='font-size:16.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:always'>
</span></i></b>

<p class=MsoNormal><b><span lang=EN-US style='font-size:16.0pt'>About <i>Thinking
in C++</i>:</span></b></p>

<p class=MsoNormal style='margin-bottom:10.0pt'><b><span lang=EN-US>Best Book!
Winner of the <br>
1995 Software Development Magazine Jolt Award!</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
lang=EN-US style='font-size:11.5pt'>“This book is a tremendous achievement. You
owe it to yourself to have a copy on your shelf. The chapter on iostreams is
the most comprehensive and understandable treatment of that subject I’ve seen
to date.”</span></p>

<p class=MsoNormal align=right style='text-align:right'><b><span lang=EN-US
style='font-size:14.0pt'>Al Stevens <br>
Contributing Editor, <i>Doctor Dobbs Journal</i></span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
lang=EN-US style='font-size:11.5pt'>“Eckel’s book is the only one to so clearly
explain how to rethink program construction for object orientation. That the
book is also an excellent tutorial on the ins and outs of C++ is an added bonus.”</span></p>

<p class=MsoNormal align=right style='margin-top:6.0pt;text-align:right'><b><span
lang=EN-US style='font-size:14.0pt'>Andrew Binstock<br>
Editor, <i>Unix Review</i></span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
lang=EN-US style='font-size:11.5pt'>“Bruce continues to amaze me with his
insight into C++, and <i>Thinking in C++</i> is his best collection of ideas yet.
If you want clear answers to difficult questions about C++, buy this outstanding
book.”</span></p>

<p class=MsoBodyTextIndent align=right style='margin-top:6.0pt;margin-right:
0cm;margin-bottom:6.0pt;margin-left:36.0pt;text-align:right'><b><span
lang=EN-US style='font-size:14.0pt'>Gary Entsminger<br>
Author, <i>The Tao of Objects</i></span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
lang=EN-US style='font-size:11.5pt'>“<i>Thinking in C++</i> patiently and
methodically explores the issues of when and how to use inlines, references,
operator overloading, inheritance, and dynamic objects, as well as advanced
topics such as the proper use of templates, exceptions and multiple inheritance.
The entire effort is woven in a fabric that includes Eckel’s own philosophy of
object and program design. A must for every C++ developer’s bookshelf, <i>Thinking
in C++</i> is the one C++ book you must have if you’re doing serious
development with C++.”</span></p>

<p class=MsoBodyTextIndent align=right style='margin-top:6.0pt;margin-right:
0cm;margin-bottom:6.0pt;margin-left:36.0pt;text-align:right'><b><span
lang=EN-US style='font-size:14.0pt'>Richard Hale Shaw<br>
Contributing Editor, PC Magazine</span></b><span lang=EN-US><br clear=all
style='page-break-before:always'>
</span></p>

<p class=TitlePage1 style='margin-bottom:0cm;margin-bottom:.0001pt'><span
lang=EN-US>Thinking</span></p>

<p class=TitlePage2><span lang=EN-US>in</span></p>

<p class=TitlePage3><span lang=EN-US>Java</span></p>

<p class=TitlePage4><span lang=EN-US>Second Edition</span></p>

<p class=TitlePage5><span lang=EN-US>Bruce Eckel</span></p>

<p class=TitlePage6><span lang=EN-US>President, MindView, Inc.</span></p>

<p class=Intro><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=Intro style='margin-left:0cm'><span lang=EN-US style='font-size:12.0pt'>&nbsp;</span></p>

<p class=Intro style='margin-top:0cm;margin-right:0cm;margin-bottom:3.0pt;
margin-left:72.0pt'><img width=72 height=66 src="TIJ2_files/image002.png"
align=left><span lang=EN-US>Prentice Hall<br>
Upper Saddle River, New Jersey 07458<br>
www.phptr.com</span></p>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:21.6pt;margin-bottom:.0001pt;line-height:12.0pt'><span lang=EN-US
style='font-family:"Courier New"'>Library of Congress Cataloging-in-Publication
Data</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:21.6pt;margin-bottom:.0001pt;line-height:12.0pt'><span lang=EN-US
style='font-family:"Courier New"'>Eckel, Bruce.</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:21.6pt;margin-bottom:.0001pt;line-height:12.0pt'><span lang=EN-US
style='font-family:"Courier New"'>  Thinking in Java / Bruce Eckel.--2nd ed.</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:21.6pt;margin-bottom:.0001pt;line-height:12.0pt'><span lang=EN-US
style='font-family:"Courier New"'>     p.   cm.</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:21.6pt;margin-bottom:.0001pt;line-height:12.0pt'><span lang=EN-US
style='font-family:"Courier New"'>  ISBN 0-13-027363-5</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:21.6pt;margin-bottom:.0001pt;line-height:12.0pt'><span lang=EN-US
style='font-family:"Courier New"'>  1. Java (Computer program language) I. Title.</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:21.6pt;margin-bottom:.0001pt;line-height:12.0pt'><span lang=EN-US
style='font-family:"Courier New"'> QA76.73.J38E25 2000</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:21.6pt;margin-bottom:.0001pt;line-height:12.0pt'><span lang=EN-US
style='font-family:"Courier New"'> 005.13'3--dc21                     
00-037522</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:6.0pt;
margin-left:21.6pt;line-height:12.0pt'><span lang=EN-US style='font-family:
"Courier New"'>                                         CIP</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:12.0pt;
margin-left:0cm;line-height:normal'><i><span lang=EN-US style='font-size:8.0pt'>Editorial/Production
Supervision: </span></i><span lang=EN-US style='font-size:8.0pt'>Nicholas
Radhuber<br>
<i>Acquisitions Editor: </i>Paul Petralia<br>
<i>Manufacturing Manager: </i>Maura Goldstaub<br>
<i>Marketing Manager: </i>Bryan Gambrel<br>
<i>Cover Design: </i>Daniel Will-Harris <br>
<i>Interior Design: </i>Daniel Will-Harris, www.will-harris.com</span></p>

<p class=MsoBodyText3><span lang=EN-US>© 2000 by Bruce Eckel, President,
MindView, Inc. <br>
Published by Prentice Hall PTR<br>
Prentice-Hall, Inc.<br>
Upper Saddle River, NJ 07458</span></p>

<p class=MsoNormal style='margin-top:12.0pt;margin-right:0cm;margin-bottom:
4.0pt;margin-left:0cm;line-height:normal'><span lang=EN-US style='font-size:
8.0pt'>The information in this book is distributed on an “as is” basis, without
warranty. While every precaution has been taken in the preparation of this
book, neither the author nor the publisher shall have any liability to any
person or entitle with respect to any liability, loss or damage caused or
alleged to be caused directly or indirectly by instructions contained in this
book or by the computer software or hardware products described herein.</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:4.0pt;
margin-left:0cm;line-height:normal'><span lang=EN-US style='font-size:8.0pt'>All
rights reserved. No part of this book may be reproduced, in any form or by any
means, without permission in writing from the publisher.</span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:4.0pt;
margin-left:0cm;line-height:normal'><span lang=EN-US style='font-size:8.0pt'>Prentice-Hall
books are widely used by corporations and government agencies for training,
marketing, and resale. The publisher offers discounts on this book when ordered
in bulk quantities. For more information, contact the Corporate Sales
Department at 800-382-3419, fax: 201-236-7141, email: <i><a
href="mailto:corpsales@prenhall.com"><span style='color:windowtext;text-decoration:
none'>corpsales@prenhall.com</span></a></i> or write: Corporate Sales
Department, Prentice Hall PTR, One Lake Street, Upper Saddle River, New Jersey
07458. </span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:0cm;margin-bottom:12.0pt;
margin-left:0cm;line-height:normal'><span lang=EN-US style='font-size:8.0pt'>Java
is a registered trademark of Sun Microsystems, Inc. Windows 95 and Windows NT
are trademarks of Microsoft Corporation. All other product names and company
names mentioned herein are the property of their respective owners.</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;line-height:normal'><span
lang=EN-US style='font-size:10.0pt'>Printed in the United States of America<br>
10 9 8 7 6 5 4 3 2 1</span><span lang=EN-US style='font-size:9.0pt'><br>
</span><span lang=EN-US style='font-size:7.0pt'><br>
</span><span lang=EN-US style='font-size:10.0pt'>ISBN 0-13-027363-5</span><span
lang=EN-US style='font-size:9.0pt'><br>
<br>
</span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;line-height:normal'><img
width=61 height=56 src="TIJ2_files/image003.png" align=left><span lang=EN-US
style='font-size:8.0pt'>Prentice-Hall International (UK) Limited, <i>London</i></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;line-height:normal'><span
lang=EN-US style='font-size:8.0pt'>Prentice-Hall of Australia Pty. Limited, <i>Sydney</i></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;line-height:normal'><span
lang=EN-US style='font-size:8.0pt'>Prentice-Hall Canada, Inc., <i>Toronto</i></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;line-height:normal'><span
lang=EN-US style='font-size:8.0pt'>Prentice-Hall Hispanoamericana, S.A., <i>Mexico</i></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;line-height:normal'><span
lang=EN-US style='font-size:8.0pt'>Prentice-Hall of India Private Limited, <i>New
Delhi</i></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;line-height:normal'><span
lang=EN-US style='font-size:8.0pt'>Prentice-Hall of Japan, Inc., <i>Tokyo</i></span></p>

<p class=MsoNormal style='margin:0cm;margin-bottom:.0001pt;line-height:normal'><span
lang=EN-US style='font-size:8.0pt'>Pearson Education Asia Ltd., <i>Singapore</i></span></p>

<p class=MsoNormal style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Editora Prentice-Hall do Brasil, Ltda., <i>Rio de
Janeiro</i></span><i><span lang=EN-US style='font-size:7.0pt'><br clear=all
style='page-break-before:always'>
</span></i>

<table cellpadding=0 cellspacing=0 align=left>
 <tr>
  <td width=8 height=0></td>
 </tr>
 <tr>
  <td></td>
  <td><img width=690 height=383 src="TIJ2_files/image004.png"></td>
 </tr>
</table>

<br clear=ALL>
</p>

<p class=MsoNormal align=center style='margin:0cm;margin-bottom:.0001pt;
text-align:center;line-height:normal'>

<table cellpadding=0 cellspacing=0 align=left>
 <tr>
  <td width=5 height=0></td>
 </tr>
 <tr>
  <td></td>
  <td><img width=717 height=453 src="TIJ2_files/image005.png"></td>
 </tr>
</table>

<br clear=ALL>
<i><span lang=EN-US><br clear=all style='page-break-before:always'>
</span></i></p>

<p class=MsoNormal align=right style='margin-left:0cm;text-align:right'><span
lang=EN-US style='font-size:24.0pt'>&nbsp;</span></p>

<p class=MsoNormal align=right style='margin-left:0cm;text-align:right'><span
lang=EN-US style='font-size:24.0pt'>&nbsp;</span></p>

<p class=MsoNormal align=right style='margin-left:0cm;text-align:right'><span
lang=EN-US style='font-size:24.0pt'>Dedication</span></p>

<p class=MsoNormal align=right style='margin-left:0cm;text-align:right'><span
lang=EN-US>To the person who, even now,<br>
is creating the next great computer language<br clear=all style='page-break-before:
always'>
</span></p>

</div>

<span lang=EN-US style='font-size:14.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:auto'>
</span>

<div class=WordSection2>

<p class=TitleNoTOC><a name="_Ref403700469"></a><a name=TOCOverview></a><span
lang=EN-US>Overview</span></p>

<p class=MsoToc1><span lang=EN-US>Preface</span><span lang=EN-US>                                   
                                                   </span><span
lang=EN-US>1</span></p>

<p class=MsoToc1><span lang=EN-US>Introduction</span><span lang=EN-US>                                                                             </span><span lang=EN-US>9</span></p>

<p class=MsoToc1><span lang=EN-US>1: Introduction  to Objects   </span><span
lang=EN-US>                                                 </span><span lang=EN-US>29</span></p>

<p class=MsoToc1><span lang=EN-US>2: Everything is an Object    </span><span
lang=EN-US>                                                </span><span lang=EN-US>101</span></p>

<p class=MsoToc1><span lang=EN-US>3: Controlling Program Flow                                                     </span><span
lang=EN-US>     </span><span lang=EN-US>133</span></p>

<p class=MsoToc1><span lang=EN-US>4: Initialization  &amp; Cleanup   </span><span
lang=EN-US>                                                </span><span lang=EN-US>191</span></p>

<p class=MsoToc1><span lang=EN-US>5: Hiding the Implementation</span><span
lang=EN-US>                                            </span><span
lang=EN-US>243</span></p>

<p class=MsoToc1><span lang=EN-US>6: Reusing Classes</span><span lang=EN-US>                                                                </span><span lang=EN-US>271</span></p>

<p class=MsoToc1><span lang=EN-US>7: Polymorphism</span><span lang=EN-US>                                                                   </span><span lang=EN-US>311</span></p>

<p class=MsoToc1><span lang=EN-US>8: Interfaces &amp; Inner Classes                                                     </span><span
lang=EN-US>     </span><span lang=EN-US>349</span></p>

<p class=MsoToc1><span lang=EN-US>9: Holding  Your Objects      </span><span
lang=EN-US>                                               </span><span lang=EN-US>407</span></p>

<p class=MsoToc1><span lang=EN-US>10: Error Handling  with Exceptions</span><span
lang=EN-US>                                  </span><span
lang=EN-US>531</span></p>

<p class=MsoToc1><span lang=EN-US>11: The Java  I/O System      </span><span
lang=EN-US>                                               </span><span lang=EN-US>573</span></p>

<p class=MsoToc1><span lang=EN-US>12: Run-time Type Identification</span><span
lang=EN-US>                                        </span><span
lang=EN-US>659</span></p>

<p class=MsoToc1><span lang=EN-US>13: Creating Windows  &amp; Applets</span><span
lang=EN-US>                                       </span><span
lang=EN-US>689</span></p>

<p class=MsoToc1><span lang=EN-US>14: Multiple Threads</span><span lang=EN-US>                                                            </span><span lang=EN-US>825</span></p>

<p class=MsoToc1><span lang=EN-US>15: Distributed Computing   </span><span
lang=EN-US>                                               </span><span lang=EN-US>903</span></p>

<p class=MsoToc1><span lang=EN-US>A: Passing &amp; Returning Objects</span><span
lang=EN-US>                                        </span><span
lang=EN-US>1015</span></p>

<p class=MsoToc1><span lang=EN-US>B: The Java Native Interface (JNI)</span><span
lang=EN-US>                                   </span><span
lang=EN-US>1067</span></p>

<p class=MsoToc1><span lang=EN-US>C: Java Programming Guidelines</span><span
lang=EN-US>                                      </span><span
lang=EN-US>1079</span></p>

<p class=MsoToc1><span lang=EN-US>D: Resources</span><span lang=EN-US>                                                                      </span><span lang=EN-US>1093</span></p>

<p class=MsoToc1><span lang=EN-US>Index</span><span lang=EN-US>                                                                                    </span><span lang=EN-US>1101</span></p>

<p class=MsoNormal style='margin-top:4.5pt;margin-right:36.0pt;margin-bottom:
9.0pt;margin-left:18.0pt;line-height:14.0pt'><span lang=EN-US>&nbsp;</span></p>

<p class=TitleNoTOC><a name=AAAIndex></a><span lang=EN-US>What’s Inside</span></p>

</div>

<span lang=EN-US style='font-size:14.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:auto'>
</span>

<div class=WordSection3>

<p class=MsoToc1><span lang=EN-US>Preface</span><span lang=EN-US>                                 </span><span lang=EN-US>1</span></p>

<p class=MsoToc2><span lang=EN-US>Preface to the 2<sup>nd</sup> edition</span><span
lang=EN-US>.. </span><span lang=EN-US>4</span></p>

<p class=MsoToc3><span lang=EN-US>Java 2</span><span lang=EN-US>........................................... </span><span lang=EN-US>6</span></p>

<p class=MsoToc2><span lang=EN-US>The CD ROM</span><span lang=EN-US>...................... </span><span lang=EN-US>7</span></p>

<p class=MsoToc1><span lang=EN-US>Introduction</span><span lang=EN-US>                        </span><span lang=EN-US>9</span></p>

<p class=MsoToc2><span lang=EN-US>Prerequisites</span><span lang=EN-US>...................... </span><span lang=EN-US>9</span></p>

<p class=MsoToc2><span lang=EN-US>Learning Java</span><span lang=EN-US>................... </span><span lang=EN-US>10</span></p>

<p class=MsoToc2><span lang=EN-US>Goals</span><span lang=EN-US>.................................. </span><span lang=EN-US>11</span></p>

<p class=MsoToc2><span lang=EN-US>Online documentation</span><span lang=EN-US>..... </span><span lang=EN-US>12</span></p>

<p class=MsoToc2><span lang=EN-US>Chapters</span><span lang=EN-US>............................ </span><span lang=EN-US>13</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................... </span><span lang=EN-US>19</span></p>

<p class=MsoToc2><span lang=EN-US>Multimedia CD ROM</span><span lang=EN-US>....... </span><span lang=EN-US>19</span></p>

<p class=MsoToc2><span lang=EN-US>Source code</span><span lang=EN-US>...................... </span><span lang=EN-US>20</span></p>

<p class=MsoToc3><span lang=EN-US>Coding standards</span><span lang=EN-US>..................... </span><span lang=EN-US>22</span></p>

<p class=MsoToc2><span lang=EN-US>Java versions</span><span lang=EN-US>................... </span><span lang=EN-US>22</span></p>

<p class=MsoToc2><span lang=EN-US>Seminars and <br>
mentoring</span><span lang=EN-US>......................... </span><span lang=EN-US>23</span></p>

<p class=MsoToc2><span lang=EN-US>Errors</span><span lang=EN-US>................................ </span><span lang=EN-US>23</span></p>

<p class=MsoToc2><span lang=EN-US>Note on the cover design</span><span
lang=EN-US> </span><span lang=EN-US>24</span></p>

<p class=MsoToc2><span lang=EN-US>Acknowledgements</span><span lang=EN-US>......... </span><span lang=EN-US>25</span></p>

<p class=MsoToc3><span lang=EN-US>Internet contributors</span><span lang=EN-US>............... </span><span lang=EN-US>28</span></p>

<p class=MsoToc1><span lang=EN-US>1: Introduction  <br>
to Objects</span><span lang=EN-US>                          </span><span lang=EN-US>29</span></p>

<p class=MsoToc2><span lang=EN-US>The progress </span></p>

<p class=MsoToc2><span lang=EN-US>of abstraction</span><span lang=EN-US>................... </span><span lang=EN-US>30</span></p>

<p class=MsoToc2><span lang=EN-US>An object has </span></p>

<p class=MsoToc2><span lang=EN-US>an interface</span><span lang=EN-US>...................... </span><span lang=EN-US>32</span></p>

<p class=MsoToc2><span lang=EN-US>The hidden </span></p>

<p class=MsoToc2><span lang=EN-US>implementation</span><span lang=EN-US>................ </span><span lang=EN-US>35</span></p>

<p class=MsoToc2><span lang=EN-US>Reusing the </span></p>

<p class=MsoToc2><span lang=EN-US>implementation</span><span lang=EN-US>................ </span><span lang=EN-US>37</span></p>

<p class=MsoToc2><span lang=EN-US>Inheritance: reusing </span></p>

<p class=MsoToc2><span lang=EN-US>the interface</span><span lang=EN-US>..................... </span><span lang=EN-US>38</span></p>

<p class=MsoToc3><span lang=EN-US>Is-a vs. is-like-a relationships</span><span
lang=EN-US> </span><span lang=EN-US>42</span></p>

<p class=MsoToc2><span lang=EN-US>Interchangeable objects  with polymorphism</span><span
lang=EN-US>         </span><span lang=EN-US>44</span></p>

<p class=MsoToc3><span lang=EN-US>Abstract base classes </span></p>

<p class=MsoToc3><span lang=EN-US>and interfaces</span><span lang=EN-US>........................... </span><span lang=EN-US>48</span></p>

<p class=MsoToc2><span lang=EN-US>Object landscapes and lifetimes</span><span
lang=EN-US>      </span><span lang=EN-US>49</span></p>

<p class=MsoToc3><span lang=EN-US>Collections and iterators</span><span
lang=EN-US>......... </span><span lang=EN-US>51</span></p>

<p class=MsoToc3><span lang=EN-US>The singly rooted hierarchy</span><span
lang=EN-US>.... </span><span lang=EN-US>53</span></p>

<p class=MsoToc3><span lang=EN-US>Collection libraries and </span></p>

<p class=MsoToc3><span lang=EN-US>support for easy collection use</span><span
lang=EN-US> </span><span lang=EN-US>54</span></p>

<p class=MsoToc3><span lang=EN-US>The housekeeping dilemma: </span></p>

<p class=MsoToc3><span lang=EN-US>who should clean up?</span><span lang=EN-US>.............. </span><span lang=EN-US>55</span></p>

<p class=MsoToc2><span lang=EN-US>Exception handling: </span></p>

<p class=MsoToc2><span lang=EN-US>dealing with errors</span><span lang=EN-US>........... </span><span lang=EN-US>57</span></p>

<p class=MsoToc2><span lang=EN-US>Multithreading</span><span lang=EN-US>................. </span><span lang=EN-US>58</span></p>

<p class=MsoToc2><span lang=EN-US>Persistence</span><span lang=EN-US>....................... </span><span lang=EN-US>60</span></p>

<p class=MsoToc2><span lang=EN-US>Java and the Internet</span><span lang=EN-US>..... </span><span lang=EN-US>60</span></p>

<p class=MsoToc3><span lang=EN-US>What is the Web?</span><span lang=EN-US>..................... </span><span lang=EN-US>60</span></p>

<p class=MsoToc3><span lang=EN-US>Client-side programming</span><span
lang=EN-US>........ </span><span lang=EN-US>63</span></p>

<p class=MsoToc3><span lang=EN-US>Server-side programming</span><span
lang=EN-US>....... </span><span lang=EN-US>70</span></p>

<p class=MsoToc3><span lang=EN-US>A separate arena: </span></p>

<p class=MsoToc3><span lang=EN-US>applications</span><span lang=EN-US>............................... </span><span lang=EN-US>71</span></p>

<p class=MsoToc2><span lang=EN-US>Analysis and design</span><span lang=EN-US>......... </span><span lang=EN-US>71</span></p>

<p class=MsoToc3><span lang=EN-US>Phase 0: Make a plan</span><span lang=EN-US>............... </span><span lang=EN-US>74</span></p>

<p class=MsoToc3><span lang=EN-US>Phase 1: What are we making?</span><span
lang=EN-US> </span><span lang=EN-US>75</span></p>

<p class=MsoToc3><span lang=EN-US>Phase 2: How will we build it?</span><span
lang=EN-US> </span><span lang=EN-US>79</span></p>

<p class=MsoToc3><span lang=EN-US>Phase 3: Build the core</span><span
lang=EN-US>............ </span><span lang=EN-US>83</span></p>

<p class=MsoToc3><span lang=EN-US>Phase 4: Iterate the use cases</span><span
lang=EN-US>. </span><span lang=EN-US>84</span></p>

<p class=MsoToc3><span lang=EN-US>Phase 5: Evolution</span><span lang=EN-US>................... </span><span lang=EN-US>85</span></p>

<p class=MsoToc3><span lang=EN-US>Plans pay off</span><span lang=EN-US>............................. </span><span lang=EN-US>87</span></p>

<p class=MsoToc2><span lang=EN-US>Extreme programming</span><span lang=EN-US>... </span><span lang=EN-US>88</span></p>

<p class=MsoToc3><span lang=EN-US>Write tests first</span><span lang=EN-US>........................ </span><span lang=EN-US>88</span></p>

<p class=MsoToc3><span lang=EN-US>Pair programming</span><span lang=EN-US>................... </span><span lang=EN-US>90</span></p>

<p class=MsoToc2><span lang=EN-US>Why Java succeeds</span><span lang=EN-US>.......... </span><span lang=EN-US>91</span></p>

<p class=MsoToc3><span lang=EN-US>Systems are easier  to </span></p>

<p class=MsoToc3><span lang=EN-US>express and understand</span><span
lang=EN-US>.......... </span><span lang=EN-US>91</span></p>

<p class=MsoToc3><span lang=EN-US>Maximal leverage </span></p>

<p class=MsoToc3><span lang=EN-US>with libraries</span><span lang=EN-US>............................ </span><span lang=EN-US>92</span></p>

<p class=MsoToc3><span lang=EN-US>Error handling</span><span lang=EN-US>.......................... </span><span lang=EN-US>92</span></p>

<p class=MsoToc3><span lang=EN-US>Programming in the large</span><span
lang=EN-US>....... </span><span lang=EN-US>92</span></p>

<p class=MsoToc2><span lang=EN-US>Strategies for transition</span><span
lang=EN-US>.. </span><span lang=EN-US>93</span></p>

<p class=MsoToc3><span lang=EN-US>Guidelines</span><span lang=EN-US>................................. </span><span lang=EN-US>93</span></p>

<p class=MsoToc3><span lang=EN-US>Management obstacles</span><span lang=EN-US>............ </span><span lang=EN-US>95</span></p>

<p class=MsoToc2><span lang=EN-US>Java vs. C++?</span><span lang=EN-US>.................. </span><span lang=EN-US>97</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>......................... </span><span lang=EN-US>98</span></p>

<p class=MsoToc1><span lang=EN-US>2: Everything is <br>
an Object</span><span lang=EN-US>                          </span><span lang=EN-US>101</span></p>

<p class=MsoToc2><span lang=EN-US>You manipulate objects  </span></p>

<p class=MsoToc2><span lang=EN-US>with references</span><span lang=EN-US>............... </span><span lang=EN-US>101</span></p>

<p class=MsoToc2><span lang=EN-US>You must create  </span></p>

<p class=MsoToc2><span lang=EN-US>all the objects</span><span lang=EN-US>.................. </span><span lang=EN-US>103</span></p>

<p class=MsoToc3><span lang=EN-US>Where storage lives</span><span lang=EN-US>............... </span><span lang=EN-US>103</span></p>

<p class=MsoToc3><span lang=EN-US>Special case: primitive types</span><span
lang=EN-US> </span><span lang=EN-US>105</span></p>

<p class=MsoToc3><span lang=EN-US>Arrays in Java</span><span lang=EN-US>......................... </span><span lang=EN-US>107</span></p>

<p class=MsoToc2><span lang=EN-US>You never need to  </span></p>

<p class=MsoToc2><span lang=EN-US>destroy an object</span><span lang=EN-US>............ </span><span lang=EN-US>107</span></p>

<p class=MsoToc3><span lang=EN-US>Scoping</span><span lang=EN-US>.................................... </span><span lang=EN-US>108</span></p>

<p class=MsoToc3><span lang=EN-US>Scope of objects</span><span lang=EN-US>....................... </span><span lang=EN-US>109</span></p>

<p class=MsoToc2><span lang=EN-US>Creating new  data </span></p>

<p class=MsoToc2><span lang=EN-US>types: class</span><span lang=EN-US>...................... </span><span lang=EN-US>110</span></p>

<p class=MsoToc3><span lang=EN-US>Fields and methods</span><span lang=EN-US>................ </span><span lang=EN-US>110</span></p>

<p class=MsoToc2><span lang=EN-US>Methods, arguments,  </span></p>

<p class=MsoToc2><span lang=EN-US>and return values</span><span lang=EN-US>........... </span><span lang=EN-US>112</span></p>

<p class=MsoToc3><span lang=EN-US>The argument list</span><span lang=EN-US>................... </span><span lang=EN-US>114</span></p>

<p class=MsoToc2><span lang=EN-US>Building a </span></p>

<p class=MsoToc2><span lang=EN-US>Java program</span><span lang=EN-US>.................. </span><span lang=EN-US>115</span></p>

<p class=MsoToc3><span lang=EN-US>Name visibility</span><span lang=EN-US>........................ </span><span lang=EN-US>115</span></p>

<p class=MsoToc3><span lang=EN-US>Using other components</span><span
lang=EN-US>........ </span><span lang=EN-US>116</span></p>

<p class=MsoToc3><span lang=EN-US>The <b>static</b> keyword</span><span
lang=EN-US>................. </span><span lang=EN-US>117</span></p>

<p class=MsoToc2><span lang=EN-US>Your first Java program</span><span
lang=EN-US>. </span><span lang=EN-US>119</span></p>

<p class=MsoToc3><span lang=EN-US>Compiling and running</span><span lang=EN-US>......... </span><span lang=EN-US>121</span></p>

<p class=MsoToc2><span lang=EN-US>Comments and embedded documentation</span><span
lang=EN-US>            </span><span lang=EN-US>122</span></p>

<p class=MsoToc3><span lang=EN-US>Comment documentation</span><span lang=EN-US>...... </span><span lang=EN-US>123</span></p>

<p class=MsoToc3><span lang=EN-US>Syntax</span><span lang=EN-US>....................................... </span><span lang=EN-US>124</span></p>

<p class=MsoToc3><span lang=EN-US>Embedded HTML</span><span lang=EN-US>................... </span><span lang=EN-US>125</span></p>

<p class=MsoToc3><b><span lang=EN-US>@see</span></b><span lang=EN-US>:
referring to </span></p>

<p class=MsoToc3><span lang=EN-US>other classes</span><span lang=EN-US>............................ </span><span lang=EN-US>125</span></p>

<p class=MsoToc3><span lang=EN-US>Class documentation tags</span><span
lang=EN-US>...... </span><span lang=EN-US>126</span></p>

<p class=MsoToc3><span lang=EN-US>Variable documentation tags</span><span
lang=EN-US> </span><span lang=EN-US>127</span></p>

<p class=MsoToc3><span lang=EN-US>Method documentation tags</span><span
lang=EN-US>.. </span><span lang=EN-US>127</span></p>

<p class=MsoToc3><span lang=EN-US>Documentation example</span><span lang=EN-US>....... </span><span lang=EN-US>128</span></p>

<p class=MsoToc2><span lang=EN-US>Coding style</span><span lang=EN-US>.................... </span><span lang=EN-US>129</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>........................ </span><span lang=EN-US>130</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>......................... </span><span lang=EN-US>130</span></p>

<p class=MsoToc1><span lang=EN-US>3: Controlling <br>
Program Flow</span><span lang=EN-US>                  </span><span
lang=EN-US>133</span></p>

<p class=MsoToc2><span lang=EN-US>Using Java operators</span><span lang=EN-US>..... </span><span lang=EN-US>133</span></p>

<p class=MsoToc3><span lang=EN-US>Precedence</span><span lang=EN-US>.............................. </span><span lang=EN-US>134</span></p>

<p class=MsoToc3><span lang=EN-US>Assignment</span><span lang=EN-US>.............................. </span><span lang=EN-US>134</span></p>

<p class=MsoToc3><span lang=EN-US>Mathematical operators</span><span
lang=EN-US>......... </span><span lang=EN-US>137</span></p>

<p class=MsoToc3><span lang=EN-US>Auto increment </span></p>

<p class=MsoToc3><span lang=EN-US>and decrement</span><span lang=EN-US>........................ </span><span lang=EN-US>139</span></p>

<p class=MsoToc3><span lang=EN-US>Relational operators</span><span lang=EN-US>............... </span><span lang=EN-US>141</span></p>

<p class=MsoToc3><span lang=EN-US>Logical operators</span><span lang=EN-US>.................... </span><span lang=EN-US>143</span></p>

<p class=MsoToc3><span lang=EN-US>Bitwise operators</span><span lang=EN-US>.................... </span><span lang=EN-US>146</span></p>

<p class=MsoToc3><span lang=EN-US>Shift operators</span><span lang=EN-US>........................ </span><span lang=EN-US>147</span></p>

<p class=MsoToc3><span lang=EN-US>Ternary if-else operator</span><span
lang=EN-US>......... </span><span lang=EN-US>151</span></p>

<p class=MsoToc3><span lang=EN-US>The comma operator</span><span lang=EN-US>.............. </span><span lang=EN-US>152</span></p>

<p class=MsoToc3><b><span lang=EN-US>String</span></b><span lang=EN-US>
operator +</span><span lang=EN-US>................... </span><span
lang=EN-US>153</span></p>

<p class=MsoToc3><span lang=EN-US>Common pitfalls </span></p>

<p class=MsoToc3><span lang=EN-US>when using operators</span><span lang=EN-US>............. </span><span lang=EN-US>153</span></p>

<p class=MsoToc3><span lang=EN-US>Casting operators</span><span lang=EN-US>.................... </span><span lang=EN-US>154</span></p>

<p class=MsoToc3><span lang=EN-US>Java has no “sizeof”</span><span lang=EN-US>............... </span><span lang=EN-US>158</span></p>

<p class=MsoToc3><span lang=EN-US>Precedence revisited</span><span lang=EN-US>............. </span><span lang=EN-US>158</span></p>

<p class=MsoToc3><span lang=EN-US>A compendium of operators</span><span
lang=EN-US>.. </span><span lang=EN-US>159</span></p>

<p class=MsoToc2><span lang=EN-US>Execution control</span><span lang=EN-US>........... </span><span lang=EN-US>170</span></p>

<p class=MsoToc3><span lang=EN-US>true and false</span><span lang=EN-US>.......................... </span><span lang=EN-US>170</span></p>

<p class=MsoToc3><span lang=EN-US>if-else</span><span lang=EN-US>........................................ </span><span lang=EN-US>171</span></p>

<p class=MsoToc3><span lang=EN-US>Iteration</span><span lang=EN-US>................................... </span><span lang=EN-US>172</span></p>

<p class=MsoToc3><span lang=EN-US>do-while</span><span lang=EN-US>................................... </span><span lang=EN-US>173</span></p>

<p class=MsoToc3><span lang=EN-US>for</span><span lang=EN-US>............................................. </span><span lang=EN-US>173</span></p>

<p class=MsoToc3><span lang=EN-US>break and continue</span><span lang=EN-US>................ </span><span lang=EN-US>175</span></p>

<p class=MsoToc3><span lang=EN-US>switch</span><span lang=EN-US>....................................... </span><span lang=EN-US>183</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>........................ </span><span lang=EN-US>187</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................ </span><span lang=EN-US>188</span></p>

<p class=MsoToc1><span lang=EN-US>4: Initialization  <br>
&amp; Cleanup</span><span lang=EN-US>                         </span><span lang=EN-US>191</span></p>

<p class=MsoToc2><span lang=EN-US>Guaranteed initialization  with the
constructor</span><span lang=EN-US>      </span><span
lang=EN-US>191</span></p>

<p class=MsoToc2><span lang=EN-US>Method overloading</span><span lang=EN-US>...... </span><span lang=EN-US>194</span></p>

<p class=MsoToc3><span lang=EN-US>Distinguishing </span></p>

<p class=MsoToc3><span lang=EN-US>overloaded methods</span><span lang=EN-US>............... </span><span lang=EN-US>196</span></p>

<p class=MsoToc3><span lang=EN-US>Overloading with primitives</span><span
lang=EN-US>. </span><span lang=EN-US>197</span></p>

<p class=MsoToc3><span lang=EN-US>Overloading on </span></p>

<p class=MsoToc3><span lang=EN-US>return values</span><span lang=EN-US>.......................... </span><span lang=EN-US>202</span></p>

<p class=MsoToc3><span lang=EN-US>Default constructors</span><span lang=EN-US>.............. </span><span lang=EN-US>202</span></p>

<p class=MsoToc3><span lang=EN-US>The <b>this </b>keyword</span><span
lang=EN-US>................... </span><span
lang=EN-US>203</span></p>

<p class=MsoToc2><span lang=EN-US>Cleanup: finalization </span></p>

<p class=MsoToc2><span lang=EN-US>and  garbage collection</span><span
lang=EN-US>. </span><span lang=EN-US>207</span></p>

<p class=MsoToc3><span lang=EN-US>What is <b>finalize(&nbsp;)</b> for?</span><span
lang=EN-US>......... </span><span lang=EN-US>208</span></p>

<p class=MsoToc3><span lang=EN-US>You must perform cleanup</span><span
lang=EN-US>... </span><span lang=EN-US>209</span></p>

<p class=MsoToc3><span lang=EN-US>The death condition</span><span lang=EN-US>............... </span><span lang=EN-US>214</span></p>

<p class=MsoToc3><span lang=EN-US>How a garbage </span></p>

<p class=MsoToc3><span lang=EN-US>collector works</span><span lang=EN-US>........................ </span><span lang=EN-US>215</span></p>

<p class=MsoToc2><span lang=EN-US>Member initialization</span><span lang=EN-US>..... </span><span lang=EN-US>219</span></p>

<p class=MsoToc3><span lang=EN-US>Specifying initialization</span><span
lang=EN-US>........ </span><span lang=EN-US>221</span></p>

<p class=MsoToc3><span lang=EN-US>Constructor initialization</span><span
lang=EN-US>...... </span><span lang=EN-US>223</span></p>

<p class=MsoToc2><span lang=EN-US>Array initialization</span><span lang=EN-US>.......... </span><span lang=EN-US>231</span></p>

<p class=MsoToc3><span lang=EN-US>Multidimensional arrays</span><span
lang=EN-US>....... </span><span lang=EN-US>236</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>........................ </span><span lang=EN-US>239</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................ </span><span lang=EN-US>240</span></p>

<p class=MsoToc1><span lang=EN-US>5: Hiding the Implementation</span><span
lang=EN-US>                                            </span><span
lang=EN-US>243</span></p>

<p class=MsoToc2><b><span lang=EN-US>package</span></b><span lang=EN-US>: </span></p>

<p class=MsoToc2><span lang=EN-US>the library unit</span><span lang=EN-US>............... </span><span lang=EN-US>244</span></p>

<p class=MsoToc3><span lang=EN-US>Creating unique </span></p>

<p class=MsoToc3><span lang=EN-US>package names</span><span lang=EN-US>....................... </span><span lang=EN-US>247</span></p>

<p class=MsoToc3><span lang=EN-US>A custom tool library</span><span lang=EN-US>.............. </span><span lang=EN-US>251</span></p>

<p class=MsoToc3><span lang=EN-US>Using imports to </span></p>

<p class=MsoToc3><span lang=EN-US>change behavior</span><span lang=EN-US>..................... </span><span lang=EN-US>252</span></p>

<p class=MsoToc3><span lang=EN-US>Package caveat</span><span lang=EN-US>........................ </span><span lang=EN-US>254</span></p>

<p class=MsoToc2><span lang=EN-US>Java access specifiers</span><span
lang=EN-US>.... </span><span lang=EN-US>255</span></p>

<p class=MsoToc3><span lang=EN-US>“Friendly”</span><span lang=EN-US>................................ </span><span lang=EN-US>255</span></p>

<p class=MsoToc3><b><span lang=EN-US>public</span></b><span lang=EN-US>:
interface access</span><span lang=EN-US>......... </span><span
lang=EN-US>256</span></p>

<p class=MsoToc3><b><span lang=EN-US>private</span></b><span lang=EN-US>: </span></p>

<p class=MsoToc3><span lang=EN-US>you can’t touch that!</span><span lang=EN-US>.............. </span><span lang=EN-US>258</span></p>

<p class=MsoToc3><b><span lang=EN-US>protected</span></b><span lang=EN-US>:
“sort of friendly”</span><span lang=EN-US>. </span><span
lang=EN-US>260</span></p>

<p class=MsoToc2><span lang=EN-US>Interface and implementation</span><span
lang=EN-US>         </span><span lang=EN-US>261</span></p>

<p class=MsoToc2><span lang=EN-US>Class access</span><span lang=EN-US>................... </span><span lang=EN-US>263</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>........................ </span><span lang=EN-US>267</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................ </span><span lang=EN-US>268</span></p>

<p class=MsoToc1><span lang=EN-US>6: Reusing Classes</span><span lang=EN-US>           </span><span lang=EN-US>271</span></p>

<p class=MsoToc2><span lang=EN-US>Composition syntax</span><span lang=EN-US>........ </span><span lang=EN-US>271</span></p>

<p class=MsoToc2><span lang=EN-US>Inheritance syntax</span><span lang=EN-US>......... </span><span lang=EN-US>275</span></p>

<p class=MsoToc3><span lang=EN-US>Initializing the base class</span><span
lang=EN-US>..... </span><span lang=EN-US>278</span></p>

<p class=MsoToc2><span lang=EN-US>Combining composition  </span></p>

<p class=MsoToc2><span lang=EN-US>and inheritance</span><span lang=EN-US>.............. </span><span lang=EN-US>281</span></p>

<p class=MsoToc3><span lang=EN-US>Guaranteeing </span></p>

<p class=MsoToc3><span lang=EN-US>proper cleanup</span><span lang=EN-US>....................... </span><span lang=EN-US>283</span></p>

<p class=MsoToc3><span lang=EN-US>Name hiding</span><span lang=EN-US>........................... </span><span lang=EN-US>286</span></p>

<p class=MsoToc2><span lang=EN-US>Choosing composition  </span></p>

<p class=MsoToc2><span lang=EN-US>vs. inheritance</span><span lang=EN-US>............... </span><span lang=EN-US>288</span></p>

<p class=MsoToc2><span lang=EN-US>protected</span><span lang=EN-US>........................ </span><span lang=EN-US>290</span></p>

<p class=MsoToc2><span lang=EN-US>Incremental </span></p>

<p class=MsoToc2><span lang=EN-US>development</span><span lang=EN-US>................... </span><span lang=EN-US>291</span></p>

<p class=MsoToc2><span lang=EN-US>Upcasting</span><span lang=EN-US>........................ </span><span lang=EN-US>291</span></p>

<p class=MsoToc3><span lang=EN-US>Why “upcasting”?</span><span lang=EN-US>................... </span><span lang=EN-US>293</span></p>

<p class=MsoToc2><span lang=EN-US>The <b>final</b> keyword</span><span
lang=EN-US>......... </span><span lang=EN-US>294</span></p>

<p class=MsoToc3><span lang=EN-US>Final data</span><span lang=EN-US>................................ </span><span lang=EN-US>294</span></p>

<p class=MsoToc3><span lang=EN-US>Final methods</span><span lang=EN-US>......................... </span><span lang=EN-US>299</span></p>

<p class=MsoToc3><span lang=EN-US>Final classes</span><span lang=EN-US>............................ </span><span lang=EN-US>301</span></p>

<p class=MsoToc3><span lang=EN-US>Final caution</span><span lang=EN-US>.......................... </span><span lang=EN-US>302</span></p>

<p class=MsoToc2><span lang=EN-US>Initialization and  </span></p>

<p class=MsoToc2><span lang=EN-US>class loading</span><span lang=EN-US>.................. </span><span lang=EN-US>304</span></p>

<p class=MsoToc3><span lang=EN-US>Initialization </span></p>

<p class=MsoToc3><span lang=EN-US>with inheritance</span><span lang=EN-US>..................... </span><span lang=EN-US>304</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>....................... </span><span lang=EN-US>306</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................ </span><span lang=EN-US>307</span></p>

<p class=MsoToc1><span lang=EN-US>7: Polymorphism</span><span lang=EN-US>             </span><span lang=EN-US>311</span></p>

<p class=MsoToc2><span lang=EN-US>Upcasting revisited</span><span lang=EN-US>......... </span><span lang=EN-US>311</span></p>

<p class=MsoToc3><span lang=EN-US>Forgetting the object type</span><span
lang=EN-US>...... </span><span lang=EN-US>313</span></p>

<p class=MsoToc2><span lang=EN-US>The twist</span><span lang=EN-US>.......................... </span><span lang=EN-US>315</span></p>

<p class=MsoToc3><span lang=EN-US>Method-call binding</span><span lang=EN-US>.............. </span><span lang=EN-US>315</span></p>

<p class=MsoToc3><span lang=EN-US>Producing the right behavior</span><span
lang=EN-US> </span><span lang=EN-US>316</span></p>

<p class=MsoToc3><span lang=EN-US>Extensibility</span><span lang=EN-US>........................... </span><span lang=EN-US>320</span></p>

<p class=MsoToc2><span lang=EN-US>Overriding vs. </span></p>

<p class=MsoToc2><span lang=EN-US>overloading</span><span lang=EN-US>.................... </span><span lang=EN-US>324</span></p>

<p class=MsoToc2><span lang=EN-US>Abstract classes  </span></p>

<p class=MsoToc2><span lang=EN-US>and methods</span><span lang=EN-US>.................. </span><span lang=EN-US>325</span></p>

<p class=MsoToc2><span lang=EN-US>Constructors and polymorphism</span><span
lang=EN-US>      </span><span lang=EN-US>330</span></p>

<p class=MsoToc3><span lang=EN-US>Order of constructor calls</span><span
lang=EN-US>..... </span><span lang=EN-US>330</span></p>

<p class=MsoToc3><span lang=EN-US>Inheritance and <b>finalize(&nbsp;)</b></span><span
lang=EN-US>.. </span><span lang=EN-US>333</span></p>

<p class=MsoToc3><span lang=EN-US>Behavior of polymorphic </span></p>

<p class=MsoToc3><span lang=EN-US>methods  inside constructors</span><span
lang=EN-US> </span><span lang=EN-US>337</span></p>

<p class=MsoToc2><span lang=EN-US>Designing with </span></p>

<p class=MsoToc2><span lang=EN-US>inheritance</span><span lang=EN-US>..................... </span><span lang=EN-US>339</span></p>

<p class=MsoToc3><span lang=EN-US>Pure inheritance </span></p>

<p class=MsoToc3><span lang=EN-US>vs. extension</span><span lang=EN-US>............................ </span><span lang=EN-US>341</span></p>

<p class=MsoToc3><span lang=EN-US>Downcasting and run-time  </span></p>

<p class=MsoToc3><span lang=EN-US>type identification</span><span lang=EN-US>.................. </span><span lang=EN-US>343</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>....................... </span><span lang=EN-US>346</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................ </span><span lang=EN-US>346</span></p>

<p class=MsoToc1><span lang=EN-US>8: Interfaces &amp; <br>
Inner Classes</span><span lang=EN-US>                   </span><span lang=EN-US>349</span></p>

<p class=MsoToc2><span lang=EN-US>Interfaces</span><span lang=EN-US>....................... </span><span lang=EN-US>349</span></p>

<p class=MsoToc3><span lang=EN-US>“Multiple inheritance” </span></p>

<p class=MsoToc3><span lang=EN-US>in Java</span><span lang=EN-US>..................................... </span><span lang=EN-US>354</span></p>

<p class=MsoToc3><span lang=EN-US>Extending an interface  </span></p>

<p class=MsoToc3><span lang=EN-US>with inheritance</span><span lang=EN-US>..................... </span><span lang=EN-US>358</span></p>

<p class=MsoToc3><span lang=EN-US>Grouping constants</span><span lang=EN-US>................ </span><span lang=EN-US>359</span></p>

<p class=MsoToc3><span lang=EN-US>Initializing fields </span></p>

<p class=MsoToc3><span lang=EN-US>in interfaces</span><span lang=EN-US>............................ </span><span lang=EN-US>361</span></p>

<p class=MsoToc3><span lang=EN-US>Nesting interfaces</span><span lang=EN-US>.................. </span><span lang=EN-US>362</span></p>

<p class=MsoToc2><span lang=EN-US>Inner classes</span><span lang=EN-US>.................. </span><span lang=EN-US>365</span></p>

<p class=MsoToc3><span lang=EN-US>Inner classes and upcasting</span><span
lang=EN-US>. </span><span lang=EN-US>368</span></p>

<p class=MsoToc3><span lang=EN-US>Inner classes  in </span></p>

<p class=MsoToc3><span lang=EN-US>methods and scopes</span><span lang=EN-US>............... </span><span lang=EN-US>370</span></p>

<p class=MsoToc3><span lang=EN-US>Anonymous inner classes</span><span
lang=EN-US>...... </span><span lang=EN-US>373</span></p>

<p class=MsoToc3><span lang=EN-US>The link to the outer class</span><span
lang=EN-US>.... </span><span lang=EN-US>376</span></p>

<p class=MsoToc3><b><span lang=EN-US>static</span></b><span lang=EN-US> inner
classes</span><span lang=EN-US>................ </span><span
lang=EN-US>379</span></p>

<p class=MsoToc3><span lang=EN-US>Referring to the </span></p>

<p class=MsoToc3><span lang=EN-US>outer class object</span><span lang=EN-US>.................... </span><span lang=EN-US>381</span></p>

<p class=MsoToc3><span lang=EN-US>Reaching outward from </span></p>

<p class=MsoToc3><span lang=EN-US>a multiply-nested class</span><span
lang=EN-US>......... </span><span lang=EN-US>383</span></p>

<p class=MsoToc3><span lang=EN-US>Inheriting from inner classes</span><span
lang=EN-US> </span><span lang=EN-US>384</span></p>

<p class=MsoToc3><span lang=EN-US>Can inner classes </span></p>

<p class=MsoToc3><span lang=EN-US>be overridden?</span><span lang=EN-US>....................... </span><span lang=EN-US>385</span></p>

<p class=MsoToc3><span lang=EN-US>Inner class identifiers</span><span
lang=EN-US>........... </span><span lang=EN-US>387</span></p>

<p class=MsoToc3><span lang=EN-US>Why inner classes?</span><span lang=EN-US>................ </span><span lang=EN-US>388</span></p>

<p class=MsoToc3><span lang=EN-US>Inner classes &amp; </span></p>

<p class=MsoToc3><span lang=EN-US>control frameworks</span><span lang=EN-US>................ </span><span lang=EN-US>394</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>....................... </span><span lang=EN-US>402</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................ </span><span lang=EN-US>403</span></p>

<p class=MsoToc1><span lang=EN-US>9: Holding  <br>
Your Objects</span><span lang=EN-US>                   </span><span
lang=EN-US>407</span></p>

<p class=MsoToc2><span lang=EN-US>Arrays</span><span lang=EN-US>............................. </span><span lang=EN-US>407</span></p>

<p class=MsoToc3><span lang=EN-US>Arrays are first-class objects</span><span
lang=EN-US>. </span><span lang=EN-US>409</span></p>

<p class=MsoToc3><span lang=EN-US>Returning an array</span><span lang=EN-US>................. </span><span lang=EN-US>413</span></p>

<p class=MsoToc3><span lang=EN-US>The <b>Arrays</b> class</span><span
lang=EN-US>.................... </span><span
lang=EN-US>415</span></p>

<p class=MsoToc3><span lang=EN-US>Filling an array</span><span lang=EN-US>...................... </span><span lang=EN-US>428</span></p>

<p class=MsoToc3><span lang=EN-US>Copying an array</span><span lang=EN-US>..................... </span><span lang=EN-US>429</span></p>

<p class=MsoToc3><span lang=EN-US>Comparing arrays</span><span lang=EN-US>................... </span><span lang=EN-US>431</span></p>

<p class=MsoToc3><span lang=EN-US>Array element comparisons</span><span
lang=EN-US>... </span><span lang=EN-US>431</span></p>

<p class=MsoToc3><span lang=EN-US>Sorting an array</span><span lang=EN-US>...................... </span><span lang=EN-US>435</span></p>

<p class=MsoToc3><span lang=EN-US>Searching a sorted array</span><span
lang=EN-US>........ </span><span lang=EN-US>437</span></p>

<p class=MsoToc3><span lang=EN-US>Array summary</span><span lang=EN-US>........................ </span><span lang=EN-US>439</span></p>

<p class=MsoToc2><span lang=EN-US>Introduction to </span></p>

<p class=MsoToc2><span lang=EN-US>containers</span><span lang=EN-US>...................... </span><span lang=EN-US>439</span></p>

<p class=MsoToc3><span lang=EN-US>Printing containers</span><span lang=EN-US>................ </span><span lang=EN-US>441</span></p>

<p class=MsoToc3><span lang=EN-US>Filling containers</span><span lang=EN-US>................... </span><span lang=EN-US>443</span></p>

<p class=MsoToc2><span lang=EN-US>Container disadvantage:  unknown type</span><span
lang=EN-US>     </span><span lang=EN-US>450</span></p>

<p class=MsoToc3><span lang=EN-US>Sometimes it works anyway</span><span
lang=EN-US>... </span><span lang=EN-US>452</span></p>

<p class=MsoToc3><span lang=EN-US>Making a type-conscious <b>ArrayList</b></span><span
lang=EN-US>            </span><span lang=EN-US>454</span></p>

<p class=MsoToc2><span lang=EN-US>Iterators</span><span lang=EN-US>......................... </span><span lang=EN-US>456</span></p>

<p class=MsoToc2><span lang=EN-US>Container taxonomy</span><span lang=EN-US>..... </span><span lang=EN-US>460</span></p>

<p class=MsoToc2><b><span lang=EN-US>Collection</span></b><span lang=EN-US> </span></p>

<p class=MsoToc2><span lang=EN-US>functionality</span><span lang=EN-US>................... </span><span lang=EN-US>463</span></p>

<p class=MsoToc2><b><span lang=EN-US>List</span></b><span lang=EN-US>
functionality</span><span lang=EN-US>........... </span><span
lang=EN-US>467</span></p>

<p class=MsoToc3><span lang=EN-US>Making a stack </span></p>

<p class=MsoToc3><span lang=EN-US>from a <b>LinkedList</b></span><span
lang=EN-US>................. </span><span lang=EN-US>471</span></p>

<p class=MsoToc3><span lang=EN-US>Making a queue </span></p>

<p class=MsoToc3><span lang=EN-US>from a <b>LinkedList</b></span><span
lang=EN-US>................. </span><span lang=EN-US>472</span></p>

<p class=MsoToc2><b><span lang=EN-US>Set</span></b><span lang=EN-US>
functionality</span><span lang=EN-US>............ </span><span
lang=EN-US>473</span></p>

<p class=MsoToc3><b><span lang=EN-US>SortedSet</span></b><span lang=EN-US>................................ </span><span lang=EN-US>476</span></p>

<p class=MsoToc2><b><span lang=EN-US>Map</span></b><span lang=EN-US>
functionality</span><span lang=EN-US>.......... </span><span
lang=EN-US>476</span></p>

<p class=MsoToc3><b><span lang=EN-US>SortedMap</span></b><span lang=EN-US>............................. </span><span lang=EN-US>482</span></p>

<p class=MsoToc3><span lang=EN-US>Hashing and hash codes</span><span
lang=EN-US>....... </span><span lang=EN-US>482</span></p>

<p class=MsoToc3><span lang=EN-US>Overriding <b>hashCode(&nbsp;)</b></span><span
lang=EN-US>...... </span><span lang=EN-US>492</span></p>

<p class=MsoToc2><span lang=EN-US>Holding references</span><span lang=EN-US>........ </span><span lang=EN-US>495</span></p>

<p class=MsoToc3><span lang=EN-US>The <b>WeakHashMap</b></span><span
lang=EN-US>............. </span><span lang=EN-US>498</span></p>

<p class=MsoToc2><span lang=EN-US>Iterators revisited</span><span lang=EN-US>.......... </span><span lang=EN-US>500</span></p>

<p class=MsoToc2><span lang=EN-US>Choosing an </span></p>

<p class=MsoToc2><span lang=EN-US>implementation</span><span lang=EN-US>.............. </span><span lang=EN-US>501</span></p>

<p class=MsoToc3><span lang=EN-US>Choosing between <b>List</b>s</span><span
lang=EN-US>........ </span><span lang=EN-US>502</span></p>

<p class=MsoToc3><span lang=EN-US>Choosing between <b>Set</b>s</span><span
lang=EN-US>.......... </span><span lang=EN-US>506</span></p>

<p class=MsoToc3><span lang=EN-US>Choosing between <b>Map</b>s</span><span
lang=EN-US>....... </span><span lang=EN-US>508</span></p>

<p class=MsoToc2><span lang=EN-US>Sorting and </span></p>

<p class=MsoToc2><span lang=EN-US>searching <b>List</b>s</span><span
lang=EN-US>............... </span><span lang=EN-US>511</span></p>

<p class=MsoToc2><span lang=EN-US>Utilities</span><span lang=EN-US>............................ </span><span lang=EN-US>512</span></p>

<p class=MsoToc3><span lang=EN-US>Making a <b>Collection</b> </span></p>

<p class=MsoToc3><span lang=EN-US>or <b>Map</b> unmodifiable</span><span
lang=EN-US>............ </span><span lang=EN-US>513</span></p>

<p class=MsoToc3><span lang=EN-US>Synchronizing a </span></p>

<p class=MsoToc3><b><span lang=EN-US>Collection</span></b><span lang=EN-US> or <b>Map</b></span><span
lang=EN-US>................. </span><span lang=EN-US>514</span></p>

<p class=MsoToc2><span lang=EN-US>Unsupported </span></p>

<p class=MsoToc2><span lang=EN-US>operations</span><span lang=EN-US>....................... </span><span lang=EN-US>516</span></p>

<p class=MsoToc2><span lang=EN-US>Java 1.0/1.1 containers</span><span
lang=EN-US>... </span><span lang=EN-US>519</span></p>

<p class=MsoToc3><span lang=EN-US>Vector &amp; Enumeration</span><span
lang=EN-US>............ </span><span lang=EN-US>519</span></p>

<p class=MsoToc3><span lang=EN-US>Hashtable</span><span lang=EN-US>................................ </span><span lang=EN-US>521</span></p>

<p class=MsoToc3><span lang=EN-US>Stack</span><span lang=EN-US>......................................... </span><span lang=EN-US>521</span></p>

<p class=MsoToc3><span lang=EN-US>BitSet</span><span lang=EN-US>........................................ </span><span lang=EN-US>522</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>........................ </span><span lang=EN-US>524</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................ </span><span lang=EN-US>525</span></p>

<p class=MsoToc1><span lang=EN-US>10: Error Handling  <br>
with Exceptions</span><span lang=EN-US>               </span><span
lang=EN-US>531</span></p>

<p class=MsoToc2><span lang=EN-US>Basic exceptions</span><span lang=EN-US>............. </span><span lang=EN-US>532</span></p>

<p class=MsoToc3><span lang=EN-US>Exception arguments</span><span lang=EN-US>............. </span><span lang=EN-US>533</span></p>

<p class=MsoToc2><span lang=EN-US>Catching an exception</span><span lang=EN-US>... </span><span lang=EN-US>534</span></p>

<p class=MsoToc3><span lang=EN-US>The <b>try</b> block</span><span lang=EN-US>.......................... </span><span lang=EN-US>535</span></p>

<p class=MsoToc3><span lang=EN-US>Exception handlers</span><span lang=EN-US>................ </span><span lang=EN-US>535</span></p>

<p class=MsoToc2><span lang=EN-US>Creating your own exceptions</span><span
lang=EN-US>          </span><span lang=EN-US>537</span></p>

<p class=MsoToc2><span lang=EN-US>The exception </span></p>

<p class=MsoToc2><span lang=EN-US>specification</span><span lang=EN-US>................... </span><span lang=EN-US>542</span></p>

<p class=MsoToc3><span lang=EN-US>Catching any exception</span><span
lang=EN-US>.......... </span><span lang=EN-US>543</span></p>

<p class=MsoToc3><span lang=EN-US>Rethrowing an exception</span><span
lang=EN-US>...... </span><span lang=EN-US>545</span></p>

<p class=MsoToc2><span lang=EN-US>Standard Java </span></p>

<p class=MsoToc2><span lang=EN-US>exceptions</span><span lang=EN-US>...................... </span><span lang=EN-US>549</span></p>

<p class=MsoToc3><span lang=EN-US>The special case of <b>RuntimeException</b></span><span
lang=EN-US>     </span><span lang=EN-US>550</span></p>

<p class=MsoToc2><span lang=EN-US>Performing cleanup  </span></p>

<p class=MsoToc2><span lang=EN-US>with finally</span><span lang=EN-US>...................... </span><span lang=EN-US>552</span></p>

<p class=MsoToc3><span lang=EN-US>What’s <b>finally</b> for?</span><span
lang=EN-US>................. </span><span lang=EN-US>554</span></p>

<p class=MsoToc3><span lang=EN-US>Pitfall: the lost exception</span><span
lang=EN-US>...... </span><span lang=EN-US>557</span></p>

<p class=MsoToc2><span lang=EN-US>Exception restrictions</span><span
lang=EN-US>.... </span><span lang=EN-US>558</span></p>

<p class=MsoToc2><span lang=EN-US>Constructors</span><span lang=EN-US>................... </span><span lang=EN-US>562</span></p>

<p class=MsoToc2><span lang=EN-US>Exception matching</span><span lang=EN-US>...... </span><span lang=EN-US>566</span></p>

<p class=MsoToc3><span lang=EN-US>Exception guidelines</span><span lang=EN-US>............. </span><span lang=EN-US>568</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>....................... </span><span lang=EN-US>568</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................ </span><span lang=EN-US>569</span></p>

<p class=MsoToc1><span lang=EN-US>11: The Java  <br>
I/O System</span><span lang=EN-US>                      </span><span lang=EN-US>573</span></p>

<p class=MsoToc2><span lang=EN-US>The <b>File</b> class</span><span lang=EN-US>................ </span><span lang=EN-US>574</span></p>

<p class=MsoToc3><span lang=EN-US>A directory lister</span><span lang=EN-US>..................... </span><span lang=EN-US>574</span></p>

<p class=MsoToc3><span lang=EN-US>Checking for and </span></p>

<p class=MsoToc3><span lang=EN-US>creating directories</span><span lang=EN-US>............... </span><span lang=EN-US>578</span></p>

<p class=MsoToc2><span lang=EN-US>Input and output</span><span lang=EN-US>............ </span><span lang=EN-US>581</span></p>

<p class=MsoToc3><span lang=EN-US>Types of <b>InputStream</b></span><span
lang=EN-US>........... </span><span lang=EN-US>581</span></p>

<p class=MsoToc3><span lang=EN-US>Types of <b>OutputStream</b></span><span
lang=EN-US>........ </span><span lang=EN-US>583</span></p>

<p class=MsoToc2><span lang=EN-US>Adding attributes  </span></p>

<p class=MsoToc2><span lang=EN-US>and useful interfaces</span><span lang=EN-US>..... </span><span lang=EN-US>585</span></p>

<p class=MsoToc3><span lang=EN-US>Reading from an <b>InputStream  </b>with<b>
FilterInputStream</b></span><span lang=EN-US>      </span><span
lang=EN-US>586</span></p>

<p class=MsoToc3><span lang=EN-US>Writing to an <b>OutputStream<i>  </i></b></span></p>

<p class=MsoToc3><span lang=EN-US>with<b> FilterOutputStream</b></span><span
lang=EN-US>.... </span><span lang=EN-US>587</span></p>

<p class=MsoToc2><b><span lang=EN-US>Reader</span></b><span lang=EN-US>s &amp; <b>Writer</b>s</span><span
lang=EN-US>.... </span><span lang=EN-US>589</span></p>

<p class=MsoToc3><span lang=EN-US>Sources and sinks of data</span><span
lang=EN-US>..... </span><span lang=EN-US>590</span></p>

<p class=MsoToc3><span lang=EN-US>Modifying stream behavior</span><span
lang=EN-US>... </span><span lang=EN-US>591</span></p>

<p class=MsoToc3><span lang=EN-US>Unchanged Classes</span><span lang=EN-US>................. </span><span lang=EN-US>592</span></p>

<p class=MsoToc2><span lang=EN-US>Off by itself:  RandomAccessFile</span><span
lang=EN-US>     </span><span lang=EN-US>593</span></p>

<p class=MsoToc2><span lang=EN-US>Typical uses of </span></p>

<p class=MsoToc2><span lang=EN-US>I/O streams</span><span lang=EN-US>................... </span><span lang=EN-US>594</span></p>

<p class=MsoToc3><span lang=EN-US>Input streams</span><span lang=EN-US>.......................... </span><span lang=EN-US>597</span></p>

<p class=MsoToc3><span lang=EN-US>Output streams</span><span lang=EN-US>....................... </span><span lang=EN-US>599</span></p>

<p class=MsoToc3><span lang=EN-US>A bug?</span><span lang=EN-US>...................................... </span><span lang=EN-US>601</span></p>

<p class=MsoToc3><span lang=EN-US>Piped streams</span><span lang=EN-US>......................... </span><span lang=EN-US>602</span></p>

<p class=MsoToc2><span lang=EN-US>Standard I/O</span><span lang=EN-US>................. </span><span lang=EN-US>602</span></p>

<p class=MsoToc3><span lang=EN-US>Reading from standard input</span><span
lang=EN-US> </span><span lang=EN-US>603</span></p>

<p class=MsoToc3><span lang=EN-US>Changing <b>System.out</b> </span></p>

<p class=MsoToc3><span lang=EN-US>to a <b>PrintWriter</b></span><span
lang=EN-US>.................... </span><span
lang=EN-US>604</span></p>

<p class=MsoToc3><span lang=EN-US>Redirecting standard I/O</span><span
lang=EN-US>...... </span><span lang=EN-US>604</span></p>

<p class=MsoToc2><span lang=EN-US>Compression</span><span lang=EN-US>.................. </span><span lang=EN-US>606</span></p>

<p class=MsoToc3><span lang=EN-US>Simple compression </span></p>

<p class=MsoToc3><span lang=EN-US>with GZIP</span><span lang=EN-US>................................ </span><span lang=EN-US>607</span></p>

<p class=MsoToc3><span lang=EN-US>Multifile storage with Zip</span><span
lang=EN-US>.... </span><span lang=EN-US>608</span></p>

<p class=MsoToc3><span lang=EN-US>Java ARchives (JARs)</span><span lang=EN-US>............. </span><span lang=EN-US>611</span></p>

<p class=MsoToc2><span lang=EN-US>Object serialization</span><span lang=EN-US>......... </span><span lang=EN-US>613</span></p>

<p class=MsoToc3><span lang=EN-US>Finding the class</span><span lang=EN-US>.................... </span><span lang=EN-US>618</span></p>

<p class=MsoToc3><span lang=EN-US>Controlling serialization</span><span
lang=EN-US>....... </span><span lang=EN-US>619</span></p>

<p class=MsoToc3><span lang=EN-US>Using persistence</span><span lang=EN-US>................... </span><span lang=EN-US>630</span></p>

<p class=MsoToc2><span lang=EN-US>Tokenizing input</span><span lang=EN-US>............ </span><span lang=EN-US>639</span></p>

<p class=MsoToc3><b><span lang=EN-US>StreamTokenizer</span></b><span
lang=EN-US>................. </span><span lang=EN-US>639</span></p>

<p class=MsoToc3><b><span lang=EN-US>StringTokenizer</span></b><span
lang=EN-US>................... </span><span
lang=EN-US>642</span></p>

<p class=MsoToc3><span lang=EN-US>Checking capitalization style</span><span
lang=EN-US> </span><span lang=EN-US>645</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>........................ </span><span lang=EN-US>655</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................ </span><span lang=EN-US>656</span></p>

<p class=MsoToc1><span lang=EN-US>12: Run-time Type Identification</span><span
lang=EN-US>                                        </span><span
lang=EN-US>659</span></p>

<p class=MsoToc2><span lang=EN-US>The need for RTTI</span><span lang=EN-US>......... </span><span lang=EN-US>659</span></p>

<p class=MsoToc3><span lang=EN-US>The <b>Class</b> object</span><span
lang=EN-US>..................... </span><span
lang=EN-US>662</span></p>

<p class=MsoToc3><span lang=EN-US>Checking before a cast</span><span
lang=EN-US>........... </span><span lang=EN-US>665</span></p>

<p class=MsoToc2><span lang=EN-US>RTTI syntax</span><span lang=EN-US>................... </span><span lang=EN-US>674</span></p>

<p class=MsoToc2><span lang=EN-US>Reflection: run-time  </span></p>

<p class=MsoToc2><span lang=EN-US>class information</span><span lang=EN-US>........... </span><span lang=EN-US>677</span></p>

<p class=MsoToc3><span lang=EN-US>A class method extractor</span><span
lang=EN-US>....... </span><span lang=EN-US>679</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>....................... </span><span lang=EN-US>685</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................ </span><span lang=EN-US>686</span></p>

<p class=MsoToc1><span lang=EN-US>13: Creating Windows  <br>
&amp; Applets</span><span lang=EN-US>                        </span><span lang=EN-US>689</span></p>

<p class=MsoToc2><span lang=EN-US>The basic applet</span><span lang=EN-US>............. </span><span lang=EN-US>692</span></p>

<p class=MsoToc3><span lang=EN-US>Applet restrictions</span><span lang=EN-US>................. </span><span lang=EN-US>692</span></p>

<p class=MsoToc3><span lang=EN-US>Applet advantages</span><span lang=EN-US>.................. </span><span lang=EN-US>693</span></p>

<p class=MsoToc3><span lang=EN-US>Application frameworks</span><span
lang=EN-US>........ </span><span lang=EN-US>694</span></p>

<p class=MsoToc3><span lang=EN-US>Running applets inside </span></p>

<p class=MsoToc3><span lang=EN-US>a Web browser</span><span lang=EN-US>........................ </span><span lang=EN-US>695</span></p>

<p class=MsoToc3><span lang=EN-US>Using <i>Appletviewer</i></span><span
lang=EN-US>................. </span><span lang=EN-US>698</span></p>

<p class=MsoToc3><span lang=EN-US>Testing applets</span><span lang=EN-US>....................... </span><span lang=EN-US>698</span></p>

<p class=MsoToc2><span lang=EN-US>Running applets from </span></p>

<p class=MsoToc2><span lang=EN-US>the command line</span><span lang=EN-US>......... </span><span lang=EN-US>700</span></p>

<p class=MsoToc3><span lang=EN-US>A display framework</span><span lang=EN-US>.............. </span><span lang=EN-US>702</span></p>

<p class=MsoToc3><span lang=EN-US>Using the Windows Explorer</span><span
lang=EN-US> </span><span lang=EN-US>705</span></p>

<p class=MsoToc2><span lang=EN-US>Making a button</span><span lang=EN-US>............ </span><span lang=EN-US>706</span></p>

<p class=MsoToc2><span lang=EN-US>Capturing an event</span><span lang=EN-US>........ </span><span lang=EN-US>707</span></p>

<p class=MsoToc2><span lang=EN-US>Text areas</span><span lang=EN-US>........................ </span><span lang=EN-US>711</span></p>

<p class=MsoToc2><span lang=EN-US>Controlling layout</span><span lang=EN-US>........... </span><span lang=EN-US>712</span></p>

<p class=MsoToc3><span lang=EN-US>BorderLayout</span><span lang=EN-US>........................... </span><span lang=EN-US>713</span></p>

<p class=MsoToc3><span lang=EN-US>FlowLayout</span><span lang=EN-US>.............................. </span><span lang=EN-US>714</span></p>

<p class=MsoToc3><span lang=EN-US>GridLayout</span><span lang=EN-US>............................... </span><span lang=EN-US>715</span></p>

<p class=MsoToc3><span lang=EN-US>GridBagLayout</span><span lang=EN-US>........................ </span><span lang=EN-US>716</span></p>

<p class=MsoToc3><span lang=EN-US>Absolute positioning</span><span lang=EN-US>.............. </span><span lang=EN-US>716</span></p>

<p class=MsoToc3><span lang=EN-US>BoxLayout</span><span lang=EN-US>................................ </span><span lang=EN-US>717</span></p>

<p class=MsoToc3><span lang=EN-US>The best approach?</span><span lang=EN-US>................ </span><span lang=EN-US>721</span></p>

<p class=MsoToc2><span lang=EN-US>The Swing event model</span><span lang=EN-US>. </span><span lang=EN-US>722</span></p>

<p class=MsoToc3><span lang=EN-US>Event and listener types</span><span
lang=EN-US>........ </span><span lang=EN-US>723</span></p>

<p class=MsoToc3><span lang=EN-US>Tracking multiple events</span><span
lang=EN-US>..... </span><span lang=EN-US>730</span></p>

<p class=MsoToc2><span lang=EN-US>A catalog of Swing components</span><span
lang=EN-US>       </span><span lang=EN-US>734</span></p>

<p class=MsoToc3><span lang=EN-US>Buttons</span><span lang=EN-US>..................................... </span><span lang=EN-US>734</span></p>

<p class=MsoToc3><span lang=EN-US>Icons</span><span lang=EN-US>......................................... </span><span lang=EN-US>738</span></p>

<p class=MsoToc3><span lang=EN-US>Tool tips</span><span lang=EN-US>.................................. </span><span lang=EN-US>740</span></p>

<p class=MsoToc3><span lang=EN-US>Text fields</span><span lang=EN-US>............................... </span><span lang=EN-US>740</span></p>

<p class=MsoToc3><span lang=EN-US>Borders</span><span lang=EN-US>.................................... </span><span lang=EN-US>743</span></p>

<p class=MsoToc3><span lang=EN-US>JScrollPanes</span><span lang=EN-US>............................ </span><span lang=EN-US>744</span></p>

<p class=MsoToc3><span lang=EN-US>A mini-editor</span><span lang=EN-US>.......................... </span><span lang=EN-US>747</span></p>

<p class=MsoToc3><span lang=EN-US>Check boxes</span><span lang=EN-US>............................ </span><span lang=EN-US>748</span></p>

<p class=MsoToc3><span lang=EN-US>Radio buttons</span><span lang=EN-US>......................... </span><span lang=EN-US>750</span></p>

<p class=MsoToc3><span lang=EN-US>Combo boxes </span></p>

<p class=MsoToc3><span lang=EN-US>(drop-down lists)</span><span lang=EN-US>.................... </span><span lang=EN-US>751</span></p>

<p class=MsoToc3><span lang=EN-US>List boxes</span><span lang=EN-US>................................ </span><span lang=EN-US>753</span></p>

<p class=MsoToc3><span lang=EN-US>Tabbed panes</span><span lang=EN-US>......................... </span><span lang=EN-US>755</span></p>

<p class=MsoToc3><span lang=EN-US>Message boxes</span><span lang=EN-US>........................ </span><span lang=EN-US>756</span></p>

<p class=MsoToc3><span lang=EN-US>Menus</span><span lang=EN-US>...................................... </span><span lang=EN-US>758</span></p>

<p class=MsoToc3><span lang=EN-US>Pop-up menus</span><span lang=EN-US>......................... </span><span lang=EN-US>766</span></p>

<p class=MsoToc3><span lang=EN-US>Drawing</span><span lang=EN-US>................................... </span><span lang=EN-US>768</span></p>

<p class=MsoToc3><span lang=EN-US>Dialog Boxes</span><span lang=EN-US>............................ </span><span lang=EN-US>771</span></p>

<p class=MsoToc3><span lang=EN-US>File dialogs</span><span lang=EN-US>............................. </span><span lang=EN-US>776</span></p>

<p class=MsoToc3><span lang=EN-US>HTML on </span></p>

<p class=MsoToc3><span lang=EN-US>Swing components</span><span lang=EN-US>.................. </span><span lang=EN-US>779</span></p>

<p class=MsoToc3><span lang=EN-US>Sliders and progress bars</span><span
lang=EN-US>..... </span><span lang=EN-US>780</span></p>

<p class=MsoToc3><span lang=EN-US>Trees</span><span lang=EN-US>........................................ </span><span lang=EN-US>781</span></p>

<p class=MsoToc3><span lang=EN-US>Tables</span><span lang=EN-US>...................................... </span><span lang=EN-US>784</span></p>

<p class=MsoToc3><span lang=EN-US>Selecting Look &amp; Feel</span><span
lang=EN-US>............ </span><span lang=EN-US>787</span></p>

<p class=MsoToc3><span lang=EN-US>The clipboard</span><span lang=EN-US>......................... </span><span lang=EN-US>790</span></p>

<p class=MsoToc2><span lang=EN-US>Packaging an applet </span></p>

<p class=MsoToc2><span lang=EN-US>into a JAR file</span><span lang=EN-US>................ </span><span lang=EN-US>793</span></p>

<p class=MsoToc2><span lang=EN-US>Programming </span></p>

<p class=MsoToc2><span lang=EN-US>techniques</span><span lang=EN-US>..................... </span><span lang=EN-US>794</span></p>

<p class=MsoToc3><span lang=EN-US>Binding events dynamically</span><span
lang=EN-US>.. </span><span lang=EN-US>794</span></p>

<p class=MsoToc3><span lang=EN-US>Separating business </span></p>

<p class=MsoToc3><span lang=EN-US>logic  from UI logic</span><span lang=EN-US>................. </span><span lang=EN-US>796</span></p>

<p class=MsoToc3><span lang=EN-US>A canonical form</span><span lang=EN-US>..................... </span><span lang=EN-US>799</span></p>

<p class=MsoToc2><span lang=EN-US>Visual programming  </span></p>

<p class=MsoToc2><span lang=EN-US>and Beans</span><span lang=EN-US>...................... </span><span lang=EN-US>800</span></p>

<p class=MsoToc3><span lang=EN-US>What is a Bean?</span><span lang=EN-US>...................... </span><span lang=EN-US>801</span></p>

<p class=MsoToc3><span lang=EN-US>Extracting <b>BeanInfo</b>  </span></p>

<p class=MsoToc3><span lang=EN-US>with the <b>Introspector</b></span><span
lang=EN-US>.......... </span><span lang=EN-US>804</span></p>

<p class=MsoToc3><span lang=EN-US>A more sophisticated Bean</span><span
lang=EN-US>.... </span><span lang=EN-US>811</span></p>

<p class=MsoToc3><span lang=EN-US>Packaging a Bean</span><span lang=EN-US>................... </span><span lang=EN-US>816</span></p>

<p class=MsoToc3><span lang=EN-US>More complex Bean support</span><span
lang=EN-US>. </span><span lang=EN-US>818</span></p>

<p class=MsoToc3><span lang=EN-US>More to Beans</span><span lang=EN-US>......................... </span><span lang=EN-US>819</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>........................ </span><span lang=EN-US>819</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................ </span><span lang=EN-US>820</span></p>

<p class=MsoToc1><span lang=EN-US>14: Multiple Threads</span><span lang=EN-US>      </span><span lang=EN-US>825</span></p>

<p class=MsoToc2><span lang=EN-US>Responsive </span></p>

<p class=MsoToc2><span lang=EN-US>user interfaces</span><span lang=EN-US>............... </span><span lang=EN-US>826</span></p>

<p class=MsoToc3><span lang=EN-US>Inheriting from <b>Thread</b></span><span
lang=EN-US>....... </span><span lang=EN-US>828</span></p>

<p class=MsoToc3><span lang=EN-US>Threading for a </span></p>

<p class=MsoToc3><span lang=EN-US>responsive interface</span><span lang=EN-US>.............. </span><span lang=EN-US>831</span></p>

<p class=MsoToc3><span lang=EN-US>Combining the thread  </span></p>

<p class=MsoToc3><span lang=EN-US>with the main class</span><span lang=EN-US>................ </span><span lang=EN-US>834</span></p>

<p class=MsoToc3><span lang=EN-US>Making many threads</span><span lang=EN-US>............ </span><span lang=EN-US>836</span></p>

<p class=MsoToc3><span lang=EN-US>Daemon threads</span><span lang=EN-US>..................... </span><span lang=EN-US>840</span></p>

<p class=MsoToc2><span lang=EN-US>Sharing </span></p>

<p class=MsoToc2><span lang=EN-US>limited resources</span><span lang=EN-US>........... </span><span lang=EN-US>842</span></p>

<p class=MsoToc3><span lang=EN-US>Improperly accessing </span></p>

<p class=MsoToc3><span lang=EN-US>resources</span><span lang=EN-US>................................. </span><span lang=EN-US>842</span></p>

<p class=MsoToc3><span lang=EN-US>How Java shares resources</span><span
lang=EN-US>... </span><span lang=EN-US>848</span></p>

<p class=MsoToc3><span lang=EN-US>JavaBeans revisited</span><span lang=EN-US>............... </span><span lang=EN-US>854</span></p>

<p class=MsoToc2><span lang=EN-US>Blocking</span><span lang=EN-US>.......................... </span><span lang=EN-US>859</span></p>

<p class=MsoToc3><span lang=EN-US>Becoming blocked</span><span lang=EN-US>................. </span><span lang=EN-US>860</span></p>

<p class=MsoToc3><span lang=EN-US>Deadlock</span><span lang=EN-US>................................. </span><span lang=EN-US>872</span></p>

<p class=MsoToc2><span lang=EN-US>Priorities</span><span lang=EN-US>......................... </span><span lang=EN-US>877</span></p>

<p class=MsoToc3><span lang=EN-US>Reading and </span></p>

<p class=MsoToc3><span lang=EN-US>setting priorities</span><span lang=EN-US>.................... </span><span lang=EN-US>878</span></p>

<p class=MsoToc3><span lang=EN-US>Thread groups</span><span lang=EN-US>........................ </span><span lang=EN-US>882</span></p>

<p class=MsoToc2><b><span lang=EN-US>Runnable</span></b><span lang=EN-US>
revisited</span><span lang=EN-US>...... </span><span
lang=EN-US>891</span></p>

<p class=MsoToc3><span lang=EN-US>Too many threads</span><span lang=EN-US>................... </span><span lang=EN-US>894</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>....................... </span><span lang=EN-US>899</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>........................ </span><span lang=EN-US>901</span></p>

<p class=MsoToc1><span lang=EN-US>15: Distributed <br>
Computing</span><span lang=EN-US>                      </span><span
lang=EN-US>903</span></p>

<p class=MsoToc2><span lang=EN-US>Network programming</span><span lang=EN-US>. </span><span lang=EN-US>904</span></p>

<p class=MsoToc3><span lang=EN-US>Identifying a machine</span><span lang=EN-US>........... </span><span lang=EN-US>905</span></p>

<p class=MsoToc3><span lang=EN-US>Sockets</span><span lang=EN-US>..................................... </span><span lang=EN-US>909</span></p>

<p class=MsoToc3><span lang=EN-US>Serving multiple clients</span><span
lang=EN-US>........ </span><span lang=EN-US>917</span></p>

<p class=MsoToc3><span lang=EN-US>Datagrams</span><span lang=EN-US>............................... </span><span lang=EN-US>923</span></p>

<p class=MsoToc3><span lang=EN-US>Using URLs from </span></p>

<p class=MsoToc3><span lang=EN-US>within an applet</span><span lang=EN-US>..................... </span><span lang=EN-US>923</span></p>

<p class=MsoToc3><span lang=EN-US>More to networking</span><span lang=EN-US>................ </span><span lang=EN-US>926</span></p>

<p class=MsoToc2><span lang=EN-US>Java Database </span></p>

<p class=MsoToc2><span lang=EN-US>Connectivity (JDBC)</span><span lang=EN-US>...... </span><span lang=EN-US>927</span></p>

<p class=MsoToc3><span lang=EN-US>Getting the example to work</span><span
lang=EN-US>. </span><span lang=EN-US>931</span></p>

<p class=MsoToc3><span lang=EN-US>A GUI version </span></p>

<p class=MsoToc3><span lang=EN-US>of the lookup program</span><span lang=EN-US>........... </span><span lang=EN-US>935</span></p>

<p class=MsoToc3><span lang=EN-US>Why the JDBC API  </span></p>

<p class=MsoToc3><span lang=EN-US>seems so complex</span><span lang=EN-US>................... </span><span lang=EN-US>938</span></p>

<p class=MsoToc3><span lang=EN-US>A more sophisticated </span></p>

<p class=MsoToc3><span lang=EN-US>example</span><span lang=EN-US>................................... </span><span lang=EN-US>939</span></p>

<p class=MsoToc2><span lang=EN-US>Servlets</span><span lang=EN-US>.......................... </span><span lang=EN-US>948</span></p>

<p class=MsoToc3><span lang=EN-US>The basic servlet</span><span lang=EN-US>.................... </span><span lang=EN-US>949</span></p>

<p class=MsoToc3><span lang=EN-US>Servlets and multithreading</span><span
lang=EN-US> </span><span lang=EN-US>954</span></p>

<p class=MsoToc3><span lang=EN-US>Handling sessions </span></p>

<p class=MsoToc3><span lang=EN-US>with servlets</span><span lang=EN-US>............................ </span><span lang=EN-US>955</span></p>

<p class=MsoToc3><span lang=EN-US>Running the </span></p>

<p class=MsoToc3><span lang=EN-US>servlet examples</span><span lang=EN-US>.................... </span><span lang=EN-US>960</span></p>

<p class=MsoToc2><span lang=EN-US>Java Server Pages</span><span lang=EN-US>......... </span><span lang=EN-US>960</span></p>

<p class=MsoToc3><span lang=EN-US>Implicit objects</span><span lang=EN-US>....................... </span><span lang=EN-US>962</span></p>

<p class=MsoToc3><span lang=EN-US>JSP directives</span><span lang=EN-US>......................... </span><span lang=EN-US>963</span></p>

<p class=MsoToc3><span lang=EN-US>JSP scripting elements</span><span
lang=EN-US>.......... </span><span lang=EN-US>964</span></p>

<p class=MsoToc3><span lang=EN-US>Extracting fields and values</span><span
lang=EN-US>. </span><span lang=EN-US>966</span></p>

<p class=MsoToc3><span lang=EN-US>JSP page </span></p>

<p class=MsoToc3><span lang=EN-US>attributes and scope</span><span lang=EN-US>.............. </span><span lang=EN-US>968</span></p>

<p class=MsoToc3><span lang=EN-US>Manipulating </span></p>

<p class=MsoToc3><span lang=EN-US>sessions in JSP</span><span lang=EN-US>........................ </span><span lang=EN-US>969</span></p>

<p class=MsoToc3><span lang=EN-US>Creating and </span></p>

<p class=MsoToc3><span lang=EN-US>modifying cookies</span><span lang=EN-US>................... </span><span lang=EN-US>971</span></p>

<p class=MsoToc3><span lang=EN-US>JSP summary</span><span lang=EN-US>........................... </span><span lang=EN-US>972</span></p>

<p class=MsoToc2><span lang=EN-US>RMI (Remote Method Invocation)</span><span
lang=EN-US>  </span><span lang=EN-US>973</span></p>

<p class=MsoToc3><span lang=EN-US>Remote interfaces</span><span lang=EN-US>.................. </span><span lang=EN-US>973</span></p>

<p class=MsoToc3><span lang=EN-US>Implementing the </span></p>

<p class=MsoToc3><span lang=EN-US>remote interface</span><span lang=EN-US>..................... </span><span lang=EN-US>974</span></p>

<p class=MsoToc3><span lang=EN-US>Creating stubs and skeletons</span><span
lang=EN-US> </span><span lang=EN-US>978</span></p>

<p class=MsoToc3><span lang=EN-US>Using the remote object</span><span
lang=EN-US>......... </span><span lang=EN-US>979</span></p>

<p class=MsoToc2><span lang=EN-US>CORBA</span><span lang=EN-US>........................... </span><span lang=EN-US>980</span></p>

<p class=MsoToc3><span lang=EN-US>CORBA fundamentals</span><span lang=EN-US>............ </span><span lang=EN-US>981</span></p>

<p class=MsoToc3><span lang=EN-US>An example</span><span lang=EN-US>............................. </span><span lang=EN-US>983</span></p>

<p class=MsoToc3><span lang=EN-US>Java Applets and CORBA</span><span
lang=EN-US>...... </span><span lang=EN-US>989</span></p>

<p class=MsoToc3><span lang=IT>CORBA vs. RMI</span><span lang=EN-US>....................... </span><span lang=EN-US>989</span></p>

<p class=MsoToc2><span lang=EN-US>Enterprise JavaBeans</span><span lang=EN-US>... </span><span lang=EN-US>990</span></p>

<p class=MsoToc3><span lang=EN-US>JavaBeans vs. EJBs</span><span lang=EN-US>................. </span><span lang=EN-US>991</span></p>

<p class=MsoToc3><span lang=EN-US>The EJB specification</span><span lang=EN-US>............ </span><span lang=EN-US>992</span></p>

<p class=MsoToc3><span lang=EN-US>EJB components</span><span lang=EN-US>..................... </span><span lang=EN-US>993</span></p>

<p class=MsoToc3><span lang=EN-US>The pieces of an </span></p>

<p class=MsoToc3><span lang=EN-US>EJB component</span><span lang=EN-US>....................... </span><span lang=EN-US>994</span></p>

<p class=MsoToc3><span lang=EN-US>EJB operation</span><span lang=EN-US>......................... </span><span lang=EN-US>995</span></p>

<p class=MsoToc3><span lang=EN-US>Types of EJBs</span><span lang=EN-US>.......................... </span><span lang=EN-US>996</span></p>

<p class=MsoToc3><span lang=EN-US>Developing an EJB</span><span lang=EN-US>................. </span><span lang=EN-US>998</span></p>

<p class=MsoToc3><span lang=EN-US>EJB summary</span><span lang=EN-US>........................ </span><span lang=EN-US>1003</span></p>

<p class=MsoToc2><span lang=EN-US>Jini: distributed </span></p>

<p class=MsoToc2><span lang=EN-US>services</span><span lang=EN-US>......................... </span><span lang=EN-US>1004</span></p>

<p class=MsoToc3><span lang=EN-US>Jini in context</span><span lang=EN-US>...................... </span><span lang=EN-US>1004</span></p>

<p class=MsoToc3><span lang=EN-US>What is Jini?</span><span lang=EN-US>......................... </span><span lang=EN-US>1005</span></p>

<p class=MsoToc3><span lang=EN-US>How Jini works</span><span lang=EN-US>..................... </span><span lang=EN-US>1006</span></p>

<p class=MsoToc3><span lang=EN-US>The discovery process</span><span lang=EN-US>.......... </span><span lang=EN-US>1006</span></p>

<p class=MsoToc3><span lang=EN-US>The join process</span><span lang=EN-US>................... </span><span lang=EN-US>1007</span></p>

<p class=MsoToc3><span lang=EN-US>The lookup process</span><span lang=EN-US>.............. </span><span lang=EN-US>1007</span></p>

<p class=MsoToc3><span lang=EN-US>Separation of interface </span></p>

<p class=MsoToc3><span lang=EN-US>and implementation</span><span lang=EN-US>........... </span><span lang=EN-US>1008</span></p>

<p class=MsoToc3><span lang=EN-US>Abstracting </span></p>

<p class=MsoToc3><span lang=EN-US>distributed systems</span><span lang=EN-US>.............. </span><span lang=EN-US>1010</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>...................... </span><span lang=EN-US>1010</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>....................... </span><span lang=EN-US>1010</span></p>

<p class=MsoToc1><span lang=EN-US>A: Passing &amp; <br>
Returning Objects</span><span lang=EN-US>         </span><span
lang=EN-US>1015</span></p>

<p class=MsoToc2><span lang=EN-US>Passing </span></p>

<p class=MsoToc2><span lang=EN-US>references around</span><span lang=EN-US>........ </span><span lang=EN-US>1016</span></p>

<p class=MsoToc3><span lang=EN-US>Aliasing</span><span lang=EN-US>.................................. </span><span lang=EN-US>1016</span></p>

<p class=MsoToc2><span lang=EN-US>Making local copies</span><span lang=EN-US>...... </span><span lang=EN-US>1019</span></p>

<p class=MsoToc3><span lang=EN-US>Pass by value</span><span lang=EN-US>........................ </span><span lang=EN-US>1020</span></p>

<p class=MsoToc3><span lang=EN-US>Cloning objects</span><span lang=EN-US>..................... </span><span lang=EN-US>1020</span></p>

<p class=MsoToc3><span lang=EN-US>Adding cloneability </span></p>

<p class=MsoToc3><span lang=EN-US>to a class</span><span lang=EN-US>................................ </span><span lang=EN-US>1022</span></p>

<p class=MsoToc3><span lang=EN-US>Successful cloning</span><span lang=EN-US>................ </span><span lang=EN-US>1024</span></p>

<p class=MsoToc3><span lang=EN-US>The effect of </span></p>

<p class=MsoToc3><b><span lang=EN-US>Object.clone(&nbsp;)</span></b><span
lang=EN-US>.................... </span><span
lang=EN-US>1027</span></p>

<p class=MsoToc3><span lang=EN-US>Cloning a composed object</span><span
lang=EN-US>.. </span><span lang=EN-US>1029</span></p>

<p class=MsoToc3><span lang=EN-US>A deep copy </span></p>

<p class=MsoToc3><span lang=EN-US>with <b>ArrayList</b></span><span lang=EN-US>..................... </span><span lang=EN-US>1032</span></p>

<p class=MsoToc3><span lang=EN-US>Deep copy via serialization</span><span
lang=EN-US>. </span><span lang=EN-US>1034</span></p>

<p class=MsoToc3><span lang=EN-US>Adding cloneability  </span></p>

<p class=MsoToc3><span lang=EN-US>further down a hierarchy</span><span
lang=EN-US>.... </span><span lang=EN-US>1036</span></p>

<p class=MsoToc3><span lang=EN-US>Why this strange design?</span><span
lang=EN-US>.... </span><span lang=EN-US>1037</span></p>

<p class=MsoToc2><span lang=EN-US>Controlling </span></p>

<p class=MsoToc2><span lang=EN-US>cloneability</span><span lang=EN-US>.................... </span><span lang=EN-US>1038</span></p>

<p class=MsoToc3><span lang=EN-US>The copy constructor</span><span lang=EN-US>............ </span><span lang=EN-US>1044</span></p>

<p class=MsoToc2><span lang=EN-US>Read-only classes</span><span lang=EN-US>........ </span><span lang=EN-US>1049</span></p>

<p class=MsoToc3><span lang=EN-US>Creating read-only classes</span><span
lang=EN-US>... </span><span lang=EN-US>1051</span></p>

<p class=MsoToc3><span lang=EN-US>The drawback </span></p>

<p class=MsoToc3><span lang=EN-US>to immutability</span><span lang=EN-US>..................... </span><span lang=EN-US>1052</span></p>

<p class=MsoToc3><span lang=EN-US>Immutable <b>String</b>s</span><span
lang=EN-US>.............. </span><span lang=EN-US>1054</span></p>

<p class=MsoToc3><span lang=EN-US>The <b>String</b> and  </span></p>

<p class=MsoToc3><b><span lang=EN-US>StringBuffer </span></b><span lang=EN-US>classes</span><span
lang=EN-US>........... </span><span lang=EN-US>1058</span></p>

<p class=MsoToc3><b><span lang=EN-US>String</span></b><span lang=EN-US>s are
special</span><span lang=EN-US>............... </span><span
lang=EN-US>1062</span></p>

<p class=MsoToc2><span lang=EN-US>Summary</span><span lang=EN-US>...................... </span><span lang=EN-US>1062</span></p>

<p class=MsoToc2><span lang=EN-US>Exercises</span><span lang=EN-US>...................... </span><span lang=EN-US>1064</span></p>

<p class=MsoToc1><span lang=EN-US>B: The Java Native <br>
Interface (JNI)</span><span lang=EN-US>              </span><span
lang=EN-US>1067</span></p>

<p class=MsoToc2><span lang=EN-US>Calling a </span></p>

<p class=MsoToc2><span lang=EN-US>native method</span><span lang=EN-US>.............. </span><span lang=EN-US>1068</span></p>

<p class=MsoToc3><span lang=EN-US>The header file </span></p>

<p class=MsoToc3><span lang=EN-US>generator: javah</span><span lang=EN-US>.................... </span><span lang=EN-US>1069</span></p>

<p class=MsoToc3><span lang=EN-US>Name mangling and </span></p>

<p class=MsoToc3><span lang=EN-US>function signatures</span><span lang=EN-US>.............. </span><span lang=EN-US>1070</span></p>

<p class=MsoToc3><span lang=EN-US>Implementing your DLL</span><span lang=EN-US>...... </span><span lang=EN-US>1070</span></p>

<p class=MsoToc2><span lang=EN-US>Accessing JNI functions:  </span></p>

<p class=MsoToc2><span lang=EN-US>the <b>JNIEnv</b> argument</span><span
lang=EN-US> </span><span lang=EN-US>1071</span></p>

<p class=MsoToc3><span lang=EN-US>Accessing Java Strings</span><span
lang=EN-US>......... </span><span lang=EN-US>1073</span></p>

<p class=MsoToc2><span lang=EN-US>Passing and </span></p>

<p class=MsoToc2><span lang=EN-US>using Java objects</span><span lang=EN-US>........ </span><span lang=EN-US>1073</span></p>

<p class=MsoToc2><span lang=EN-US>JNI and </span></p>

<p class=MsoToc2><span lang=EN-US>Java exceptions</span><span lang=EN-US>............ </span><span lang=EN-US>1076</span></p>

<p class=MsoToc2><span lang=EN-US>JNI and threading</span><span lang=EN-US>....... </span><span lang=EN-US>1077</span></p>

<p class=MsoToc2><span lang=EN-US>Using a preexisting </span></p>

<p class=MsoToc2><span lang=EN-US>code base</span><span lang=EN-US>...................... </span><span lang=EN-US>1077</span></p>

<p class=MsoToc2><span lang=EN-US>Additional </span></p>

<p class=MsoToc2><span lang=EN-US>information</span><span lang=EN-US>................... </span><span lang=EN-US>1078</span></p>

<p class=MsoToc1><span lang=EN-US>C: Java Programming Guidelines</span><span
lang=EN-US>                                      </span><span
lang=EN-US>1079</span></p>

<p class=MsoToc2><span lang=EN-US>Design</span><span lang=EN-US>........................... </span><span lang=EN-US>1079</span></p>

<p class=MsoToc2><span lang=EN-US>Implementation</span><span lang=EN-US>........... </span><span lang=EN-US>1086</span></p>

<p class=MsoToc1><span lang=EN-US>D: Resources</span><span lang=EN-US>                 </span><span lang=EN-US>1093</span></p>

<p class=MsoToc2><span lang=EN-US>Software</span><span lang=EN-US>........................ </span><span lang=EN-US>1093</span></p>

<p class=MsoToc2><span lang=EN-US>Books</span><span lang=EN-US>............................ </span><span lang=EN-US>1093</span></p>

<p class=MsoToc3><span lang=EN-US>Analysis &amp; design</span><span lang=EN-US>................. </span><span lang=EN-US>1095</span></p>

<p class=MsoToc3><span lang=EN-US>Python</span><span lang=EN-US>.................................... </span><span lang=EN-US>1097</span></p>

<p class=MsoToc3><span lang=EN-US>My own list of books</span><span lang=EN-US>............ </span><span lang=EN-US>1098</span></p>

<p class=MsoToc1><span lang=EN-US>Index</span><span lang=EN-US>                               </span><span lang=EN-US>1101</span></p>

<p class=MsoToc1></p>

</div>

<span lang=EN-US style='font-size:14.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:auto'>
</span>

<div class=WordSection4></div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:always'>
</span>

<div class=WordSection5>

<h1><a name="_Toc481064446"></a><a name="_Toc477690719"></a><a name=preface></a><span
lang=EN-US>Preface</span></h1>

<p class=Intro><span lang=EN-US>I suggested to my brother Todd, who is making
the leap from hardware into programming, that the next big revolution will be
in genetic engineering.</span></p>

<p class=MsoNormal><span lang=EN-US>We’ll have microbes designed to make food,
fuel, and plastic; they’ll clean up pollution and in general allow us to master
the manipulation of the physical world for a fraction of what it costs now. I
claimed that it would make the computer revolution look small in comparison. </span></p>

<p class=MsoNormal><span lang=EN-US>Then I realized I was making a mistake
common to science fiction writers: getting lost in the technology (which is of
course easy to do in science fiction). An experienced writer knows that the
story is never about the things; it’s about the people. Genetics will have a
very large impact on our lives, but I’m not so sure it will dwarf the computer
revolution (which enables the genetic revolution)—or at least the information
revolution. Information is about talking to each other: yes, cars and shoes and
especially genetic cures are important, but in the end those are just
trappings. What truly matters is how we relate to the world. And so much of
that is about communication.</span></p>

<p class=MsoNormal><span lang=EN-US>This book is a case in point. A majority of
folks thought I was very bold or a little crazy to put the entire thing up on
the Web. “Why would anyone buy it?” they asked. If I had been of a more
conservative nature I wouldn’t have done it, but I really didn’t want to write
another computer book in the same old way. I didn’t know what would happen but
it turned out to be the smartest thing I’ve ever done with a book.</span></p>

<p class=MsoNormal><span lang=EN-US>For one thing, people started sending in
corrections. This has been an amazing process, because folks have looked into
every nook and cranny and caught both technical and grammatical errors, and
I’ve been able to eliminate bugs of all sorts that I know would have otherwise
slipped through. People have been simply terrific about this, very often saying
“Now, I don’t mean this in a critical way…” and then giving me a collection of
errors I’m sure I never would have found. I feel like this has been a kind of
group process and it has really made the book into something special.</span></p>

<p class=MsoNormal><span lang=EN-US>But then I started hearing “OK, fine, it’s
nice you’ve put up an electronic version, but I want a printed and bound copy
from a real publisher.” I tried very hard to make it easy for everyone to print
it out in a nice looking format but that didn’t stem the demand for the published
book. Most people don’t want to read the entire book on screen, and hauling
around a sheaf of papers, no matter how nicely printed, didn’t appeal to them
either. (Plus, I think it’s not so cheap in terms of laser printer toner.) It
seems that the computer revolution won’t put publishers out of business, after
all. However, one student suggested this may become a model for future
publishing: books will be published on the Web first, and only if sufficient
interest warrants it will the book be put on paper. Currently, the great
majority of all books are financial failures, and perhaps this new approach
could make the publishing industry more profitable.</span></p>

<p class=MsoNormal><span lang=EN-US>This book became an enlightening experience
for me in another way. I originally approached Java as “just another
programming language,” which in many senses it is. But as time passed and I
studied it more deeply, I began to see that the fundamental intention of this
language is different from all the other languages I have seen.</span></p>

<p class=MsoNormal><span lang=EN-US>Programming is about managing complexity:
the complexity of the problem you want to solve, laid upon the complexity of
the machine in which it is solved. Because of this complexity, most of our
programming projects fail. And yet, of all the programming languages of which I
am aware, none of them have gone all-out and decided that their main design
goal would be to conquer the complexity of developing and maintaining programs</span><a
href="#_ftn1" name="_ftnref1" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[1]</span></span></span></span></a><span
lang=EN-US>. Of course, many language design decisions were made with
complexity in mind, but at some point there were always some other issues that
were considered essential to be added into the mix. Inevitably, those other
issues are what cause programmers to eventually “hit the wall” with that
language. For example, C++ had to be backwards-compatible with C (to allow easy
migration for C programmers), as well as efficient. Those are both very useful
goals and account for much of the success of C++, but they also expose extra
complexity that prevents some projects from being finished (certainly, you can
blame programmers and management, but if a language can help by catching your
mistakes, why shouldn’t it?). As another example, Visual Basic (VB) was tied to
BASIC, which wasn’t really designed to be an extensible language, so all the
extensions piled upon VB have produced some truly horrible and unmaintainable
syntax. Perl is backwards-compatible with Awk, Sed, Grep, and other Unix tools
it was meant to replace, and as a result is often accused of producing
“write-only code” (that is, after a few months you can’t read it). On the other
hand, C++, VB, Perl, and other languages like Smalltalk had some of their
design efforts focused on the issue of complexity and as a result are
remarkably successful in solving certain types of problems.</span></p>

<p class=MsoNormal><span lang=EN-US>What has impressed me most as I have come
to understand Java is what seems like an unflinching goal of reducing
complexity <i>for the programmer</i>. As if to say “we don’t care about
anything except reducing the time and difficulty of producing robust code.” In
the early days, this goal has resulted in code that doesn’t run very fast
(although there have been many promises made about how quickly Java will
someday run) but it has indeed produced amazing reductions in development time;
half or less of the time that it takes to create an equivalent C++ program.
This result alone can save incredible amounts of time and money, but Java
doesn’t stop there. It goes on to wrap all the complex tasks that have become
important, such as multithreading and network programming, in language features
or libraries that can at times make those tasks trivial. And finally, it
tackles some really big complexity problems: cross-platform programs, dynamic
code changes, and even security, each of which can fit on your complexity
spectrum anywhere from “impediment” to “show-stopper.” So despite the
performance problems we’ve seen, the promise of Java is tremendous: it can make
us significantly more productive programmers.</span></p>

<p class=MsoNormal><span lang=EN-US>One of the places I see the greatest impact
for this is on the Web. Network programming has always been hard, and Java
makes it easy (and the Java language designers are working on making it even
easier). Network programming is how we talk to each other more effectively and
cheaper than we ever have with telephones (email alone has revolutionized many
businesses). As we talk to each other more, amazing things begin to happen,
possibly more amazing even than the promise of genetic engineering.</span></p>

<p class=MsoNormal><span lang=EN-US>In all ways—creating the programs, working
in teams to create the programs, building user interfaces so the programs can
communicate with the user, running the programs on different types of machines,
and easily writing programs that communicate across the Internet—Java increases
the communication bandwidth <i>between people</i>. I think that perhaps the
results of the communication revolution will not be seen from the effects of
moving large quantities of bits around; we shall see the true revolution
because we will all be able to talk to each other more easily: one-on-one, but
also in groups and, as a planet. I've heard it suggested that the next
revolution is the formation of a kind of global mind that results from enough
people and enough interconnectedness. Java may or may not be the tool that
foments that revolution, but at least the possibility has made me feel like I'm
doing something meaningful by attempting to teach the language.</span></p>

<h2><a name="_Toc481064447"><span lang=EN-US>Preface to the 2<sup>nd</sup>
edition</span></a></h2>

<p class=MsoNormal><span lang=EN-US>People have made many, many wonderful
comments about the first edition of this book, which has naturally been very
pleasant for me. However, every now and then someone will have complaints, and
for some reason one complaint that comes up periodically is “the book is too
big.” In my mind it is faint damnation indeed if “too many pages” is your only
complaint. (One is reminded of the Emperor of Austria’s complaint about
Mozart’s work: “Too many notes!” Not that I am in any way trying to compare
myself to Mozart.) In addition, I can only assume that such a complaint comes
from someone who is yet to be acquainted with the vastness of the Java language
itself, and has not seen the rest of the books on the subject—for example, my
favorite reference is Cay Horstmann &amp; Gary Cornell’s <i>Core Java</i>
(Prentice-Hall), which grew so big it had to be broken into two volumes.
Despite this, one of the things I have attempted to do in this edition is trim
out the portions that have become obsolete, or at least nonessential. I feel
comfortable doing this because the original material remains on the Web site
and the CD ROM that accompanies this book, in the form of the
freely-downloadable first edition of the book (at <i>www.BruceEckel.com</i>).
If you want the old stuff, it’s still there, and this is a wonderful relief for
an author. For example, you may notice that the original last chapter,
“Projects,” is no longer here; two of the projects have been integrated into
other chapters, and the rest were no longer appropriate. Also, the “Design
Pattens” chapter became too big and has been moved into a book of its own (also
downloadable at the Web site). So, by all rights the book should be thinner.</span></p>

<p class=MsoNormal><span lang=EN-US>But alas, it is not to be.</span></p>

<p class=MsoNormal><span lang=EN-US>The biggest issue is the continuing
development of the Java language itself, and in particular the expanding APIs
that promise to provide standard interfaces for just about everything you’d
like to do (and I won’t be surprised to see the “JToaster” API eventually
appear). Covering all these APIs is obviously beyond the scope of this book and
is a task relegated to other authors, but some issues cannot be ignored. The
biggest of these include server-side Java (primarily Servlets &amp; Java Server
pages, or <i>JSP</i>s), which is truly an excellent solution to the World Wide
Web problem, wherein we’ve discovered that the various Web browser platforms
are just not consistent enough to support client-side programming. In addition,
there is the whole problem of easily creating applications to interact with
databases, transactions, security, and the like, which is involved with
Enterprise Java Beans (EJBs). These topics are wrapped into the chapter
formerly called “Network Programming” and now called “Distributed Computing,” a
subject that is becoming essential to everyone. You’ll also find this chapter
has been expanded to include an overview of Jini (pronounced “genie,” and it
isn’t an acronym, just a name), which is a cutting-edge technology that allows
us to change the way we think about interconnected applications. And of course
the book has been changed to use the Swing GUI library throughout. Again, if
you want the old Java 1.0/1.1 stuff you can get it from the freely-downloadable
book at <i>www.BruceEckel.com</i> (it is also included on this edition’s new CD
ROM, bound into the book; more on that a little later).</span></p>

<p class=MsoNormal><span lang=EN-US>Aside from additional small language
features added in Java 2 and corrections made throughout the book, the other
major change is in the collections chapter (9), which now focuses on the Java 2
collections used throughout the book. I’ve also improved that chapter to more
deeply go into some of the important issues of collections, in particular how a
hash function works (so that you can know how to properly create one). There
have been other movements and changes, including a rewrite of Chapter 1, and
removal of some appendices and other material that I consider no longer
necessary for the printed book, but those are the bulk of them. In general,
I’ve tried to go over everything, remove from the 2<sup>nd</sup> edition what
is no longer necessary (but which still exists in the electronic first
edition), include changes, and improve everything I could. As the language
continues to change—albeit not quite at the same breakneck pace as before—there
will no doubt be further editions of this book.</span></p>

<p class=MsoNormal><span lang=EN-US>For those of you who still can’t stand the
size of the book, I do apologize. Believe it or not, I have worked hard to keep
it small. Despite the bulk, I feel like there may be enough alternatives to
satisfy you. For one thing, the book is available electronically (from the Web
site, and also on the CD ROM that accompanies this book), so if you carry your
laptop you can carry the book on that with no extra weight. If you’re really
into slimming down, there are actually Palm Pilot versions of the book floating
around. (One person told me he would read the book in bed on his Palm with the
backlighting on to keep from annoying his wife. I can only hope that it helps
send him to slumberland.) If you need it on paper, I know of people who print a
chapter at a time and carry it in their briefcase to read on the train.</span></p>

<h3><a name="_Toc481064448"><span lang=EN-US>Java 2</span></a></h3>

<p class=MsoNormal><span lang=EN-US>At this writing, the release of Sun’s <i>Java
Development Kit </i>(JDK) 1.3 is imminent, and the proposed changes for JDK 1.4
have been publicized. Although these version numbers are still in the “ones,”
the standard way to refer to any version of the language that is JDK 1.2 or
greater is to call it “Java 2.” This indicates the very significant changes
between “old Java”—which had many warts that I complained about in the first
edition of this book—and this more modern and improved version of the language,
which has far fewer warts and many additions and nice designs.</span></p>

<p class=MsoNormal><span lang=EN-US>This book is written for Java 2. I have the
great luxury of getting rid of all the old stuff and writing to only the new,
improved language because the old information still exists in the electronic 1<sup>st</sup>
edition on the Web and on the CD ROM (which is where you can go if you’re stuck
using a pre-Java-2 version of the language). Also, because anyone can freely
download the JDK from java.sun.com, it means that by writing to Java 2 I’m not
imposing a financial hardship on someone by forcing them to upgrade.</span></p>

<p class=MsoNormal><span lang=EN-US>There is a bit of a catch, however. JDK 1.3
has some improvements that I’d really like to use, but the version of Java that
is currently being released for Linux is JDK 1.2.2. Linux (see www.Linux.org)
is a very important development in conjunction with Java, because it is fast
becoming the most important server platform out there—fast, reliable, robust,
secure, well-maintained, and free, a true revolution in the history of
computing (I don’t think we’ve ever seen all of those features in any tool
before). And Java has found a very important niche in server-side programming in
the form of <i>Servlets</i>, a technology that is a huge improvement over the
traditional CGI programming (this is covered in the “Distributed Programming”
chapter).</span></p>

<p class=MsoNormal><span lang=EN-US>So although I would like to only use the
very newest features, it’s critical that everything compiles under Linux, and
so when you unpack the source code and compile it under that OS (with the
latest JDK) you’ll discover that everything will compile. However, you will
find that I’ve put notes about features in JDK 1.3 here and there.</span></p>

<h2><a name="_Toc481064449"><span lang=EN-US>The CD ROM</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Another bonus with this edition is the CD
ROM that is packaged in the back of the book. I’ve resisted putting CD ROMs in
the back of my books in the past because I felt the extra charge for a few
Kbytes of source code on this enormous CD was not justified, preferring instead
to allow people to download such things from my Web site. However, you’ll soon
see that this CD ROM is different.</span></p>

<p class=MsoNormal><span lang=EN-US>The CD does contain the source code from
the book, but it also contains the book in its entirety, in several electronic
formats. My favorite of these is the HTML format, because it is fast and fully
indexed—you just click on an entry in the index or table of contents and you’re
immediately at that portion of the book.</span></p>

<p class=MsoNormal><span lang=EN-US>The bulk of the 300+ Megabytes of the CD,
however, is a full multimedia course called <i>Thinking in C: Foundations for
C++ &amp; Java. </i>I originally commissioned Chuck Allison to create this
seminar-on-CD ROM as a stand-alone product, but decided to include it with the
second editions of both <i>Thinking in C++</i> and <i>Thinking in Java</i>
because of the consistent experience of having people come to seminars without
an adequate background in C. The thinking apparently goes “I’m a smart
programmer and I don’t <i>want</i> to learn C, but rather C++ or Java, so I’ll
just skip C and go directly to C++/Java.” After arriving at the seminar, it
slowly dawns on folks that the prerequisite of understanding C syntax is there
for a very good reason. By including the CD ROM with the book, we can ensure
that everyone attends a seminar with adequate preparation.</span></p>

<p class=MsoNormal><span lang=EN-US>The CD also allows the book to appeal to a
wider audience. Even though Chapter 3 (</span><span lang=EN-US>Controlling
program flow) does cover the fundamentals of the parts of Java that come from
C, the CD is a gentler introduction, and assumes even less about the student’s
programming background than does the book. It is my hope that by including the
CD more people will be able to be brought into the fold of Java programming.</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection6>

<h1><a name="_Toc481064450"></a><a name="_Toc477690720"><span lang=EN-US>Introduction</span></a></h1>

<p class=Intro><span lang=EN-US>Like any human language, Java provides a way to
express concepts. If successful, this medium of expression will be
significantly easier and more flexible than the alternatives as problems grow
larger and more complex.</span></p>

<p class=MsoNormal><span lang=EN-US>You can’t look at Java as just a collection
of features—some of the features make no sense in isolation. You can use the sum
of the parts only if you are thinking about <i>design</i>, not simply coding.
And to understand Java in this way, you must understand the problems with it
and with programming in general. This book discusses programming problems, why
they are problems, and the approach Java has taken to solve them. Thus, the set
of features I explain in each chapter are based on the way I see a particular
type of problem being solved with the language. In this way I hope to move you,
a little at a time, to the point where the Java mindset becomes your native
tongue.</span></p>

<p class=MsoNormal><span lang=EN-US>Throughout, I’ll be taking the attitude
that you want to build a model in your head that allows you to develop a deep
understanding of the language; if you encounter a puzzle you’ll be able to feed
it to your model and deduce the answer.</span></p>

<h2><a name="_Toc481064451"></a><a name="_Toc375545177"></a><a
name="_Toc312373769"><span lang=EN-US>Prerequisites</span></a></h2>

<p class=MsoNormal><span lang=EN-US>This book assumes that you have some
programming familiarity: you understand that a program is a collection of
statements, the idea of a subroutine/function/macro, control statements such as
“if” and looping constructs such as “while,” etc. However, you might have
learned this in many places, such as programming with a macro language or
working with a tool like Perl. As long as you’ve programmed to the point where
you feel comfortable with the basic ideas of programming, you’ll be able to
work through this book. Of course, the book will be <i>easier</i> for the C
programmers and more so for the C++ programmers, but don’t count yourself out
if you’re not experienced with those languages (but come willing to work hard;
also, the multimedia CD that accompanies this book will bring you up to speed
on the basic C syntax necessary to learn Java). I’ll be introducing the
concepts of object-oriented programming (OOP) and Java’s basic control
mechanisms, so you’ll be exposed to those, and the first exercises will involve
the basic control-flow statements.</span></p>

<p class=MsoNormal><span lang=EN-US>Although references will often be made to C
and C++ language features, these are not intended to be insider comments, but
instead to help all programmers put Java in perspective with those languages,
from which, after all, Java is descended. I will attempt to make these
references simple and to explain anything that I think a non- C/C++ programmer
would not be familiar with.</span></p>

<h2><a name="_Toc481064452"></a><a name="_Toc375545178"></a><a
name="_Toc312373770"><span lang=EN-US>Learning </span></a><span lang=EN-US>Java</span></h2>

<p class=MsoNormal><span lang=EN-US>At about the same time that my first book <i>Using
C++</i> (Osborne/McGraw-Hill, 1989) came out, I began teaching that language.
Teaching programming languages has become my profession; I’ve seen nodding
heads, blank faces, and puzzled expressions in audiences all over the world
since 1989. As I began giving in-house training with smaller groups of people,
I discovered something during the exercises. Even those people who were smiling
and nodding were confused about many issues. I found out, by chairing the C++
track at the </span><span lang=EN-US>Software Development Conference for a number of years (and later the
Java track), that I and other speakers tended to give the typical audience too
many topics too fast. So eventually, through both variety in the audience level
and the way that I presented the material, I would end up losing some portion
of the audience. Maybe it’s asking too much, but because I am one of those
people resistant to traditional lecturing (and for most people, I believe, such
resistance results from boredom), I wanted to try to keep everyone up to speed.</span></p>

<p class=MsoNormal><span lang=EN-US>For a time, I was creating a number of
different presentations in fairly short order. Thus, I ended up learning by
experiment and iteration (a technique that also works well in Java program
design). Eventually I developed a course using everything I had learned from my
teaching experience—one that I would be happy giving for a long time. It
tackles the learning problem in discrete, easy-to-digest steps, and in a
hands-on seminar (the ideal learning situation) there are exercises following
each of the short lessons. I now give this course in </span><span lang=EN-US>public Java seminars, which you can find out about at <i>www.BruceEckel.com</i>.
(The introductory seminar is also available as a CD ROM. Information is
available at the same Web site.)</span></p>

<p class=MsoNormal><span lang=EN-US>The feedback that I get from each seminar
helps me change and refocus the material until I think it works well as a
teaching medium. But this book isn’t just seminar notes—I tried to pack as much
information as I could within these pages, and structured it to draw you
through onto the next subject. More than anything, the book is designed to
serve the solitary reader who is struggling with a new programming language.</span></p>

<h2><a name="_Toc481064453"></a><a name="_Toc375545179"></a><a
name="_Toc312373771"><span lang=EN-US>Goals</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Like my previous book <i>Thinking in C++</i>,
this book has come to be structured around the process of teaching the
language. In particular, my motivation is to create something that provides me
with a way to teach the language in my own seminars. When I think of a chapter
in the book, I think in terms of what makes a good lesson during a seminar. My
goal is to get bite-sized pieces that can be taught in a reasonable amount of
time, followed by exercises that are feasible to accomplish in a classroom
situation.</span></p>

<p class=MsoNormal><span lang=EN-US>My goals in this book are to:</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Present the material one simple step at a time
so that you can easily digest each concept before moving on.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Use examples that are as simple and short as
possible. This sometimes prevents me from tackling “real world” problems, but
I’ve found that beginners are usually happier when they can understand every
detail of an example rather than being impressed by the scope of the problem it
solves. Also, there’s a severe limit to the amount of code that can be absorbed
in a classroom situation. For this I will no doubt receive criticism for using
“toy examples,” but I’m willing to accept that in favor of producing something
pedagogically useful.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Carefully sequence the presentation of features
so that you aren’t seeing something that you haven’t been exposed to. Of
course, this isn’t always possible; in those situations, a brief introductory
description is given.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Give you what I think is important for you to
understand about the language, rather than everything I know. I believe there
is an information importance hierarchy, and that there are some facts that 95
percent of programmers will never need to know and that just confuse people and
adds to their perception of the complexity of the language. To take an example
from C, if you memorize the operator precedence table (I never did), you can
write clever code. But if you need to think about it, it will also confuse the
reader/maintainer of that code. So forget about precedence, and use parentheses
when things aren’t clear. </span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>5.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Keep each section focused enough so that the
lecture time—and the time between exercise periods—is small. Not only does this
keep the audience’s minds more active and involved during a hands-on seminar,
but it gives the reader a greater sense of accomplishment.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>6.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Provide you with a solid foundation so that you
can understand the issues well enough to move on to more difficult coursework
and books.</span></p>

<h2><a name="_Toc375545180"></a><a name="_Toc312373772"></a><a
name="_Toc481064454"><span lang=EN-US>Online documentation</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The Java language and libraries from Sun
Microsystems (a free download) come with documentation in electronic form,
readable using a Web browser, and virtually every third party implementation of
Java has this or an equivalent documentation system. Almost all the books
published on Java have duplicated this documentation. So you either already
have it or you can download it, and unless necessary, this book will not repeat
that documentation because it’s usually much faster if you find the class descriptions
with your Web browser than if you look them up in a book (and the on-line documentation
is probably more up-to-date). This book will provide extra descriptions of the
classes only when it’s necessary to supplement the documentation so you can
understand a particular example.</span></p>

<h2><a name="_Toc481064455"><span lang=EN-US>Chapters</span></a></h2>

<p class=MsoNormal><span lang=EN-US>This book was designed with one thing in
mind: the way people learn the Java language. Seminar audience feedback helped
me understand the difficult parts that needed illumination. In the areas where
I got ambitious and included too many features all at once, I came to
know—through the process of presenting the material—that if you include a lot
of new features, you need to explain them all, and this easily compounds the
student’s confusion. As a result, I’ve taken a great deal of trouble to
introduce the features as few at a time as possible.</span></p>

<p class=MsoNormal><span lang=EN-US>The goal, then, is for each chapter to
teach a single feature, or a small group of associated features, without
relying on additional features. That way you can digest each piece in the
context of your current knowledge before moving on.</span></p>

<p class=MsoNormal><span lang=EN-US>Here is a brief description of the chapters
contained in the book, which correspond to lectures and exercise periods in my
hands-on seminars.</span></p>

<p class=EmphasisP><a name="OLE_LINK10"><span class=Emphasis><span lang=EN-US>Chapter
1:      </span></span><span lang=EN-US>Introduction to Objects</span></a></p>

<p class=MsoBodyTextIndent2><span lang=EN-US>This chapter is an overview of
what object-oriented programming is all about, including the answer to the basic
question “What’s an object?”, interface vs. implementation, abstraction and
encapsulation, messages and functions, inheritance and composition, and the
all-important polymorphism. You’ll also get an overview of issues of object
creation such as constructors, where the objects live, where to put them once
they’re created, and the magical garbage collector that cleans up the objects
that are no longer needed. Other issues will be introduced, including error
handling with exceptions, multithreading for responsive user interfaces, and
networking and the Internet. You’ll learn what makes Java special, why it’s
been so successful, and about object-oriented analysis and design. </span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 2:</span></span><span
lang=EN-US>      Everything is an Object</span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>This chapter
moves you to the point where you can write your first Java program, so it must
give an overview of the essentials, including the concept of a <i>reference</i>
to an object; how to create an object; an introduction to primitive types and
arrays; scoping and the way objects are destroyed by the garbage collector; how
everything in Java is a new data type (class) and how to create your own
classes; functions, arguments, and return values; name visibility and using
components from other libraries; the <b>static</b> keyword; and comments and
embedded documentation.</span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 3:</span></span><span
lang=EN-US>      Controlling Program Flow</span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>This chapter
begins with all of the operators that come to Java from C and C++. In addition,
you’ll discover common operator pitfalls, casting, promotion, and precedence.
This is followed by the basic control-flow and selection operations that you
get with virtually any programming language: choice with if-else; looping with
for and while; quitting a loop with break and continue as well as Java’s
labeled break and labeled continue (which account for the “missing goto” in
Java); and selection using switch. Although much of this material has common
threads with C and C++ code, there are some differences. In addition, all the
examples will be full Java examples so you’ll get more comfortable with what
Java looks like. </span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 4:</span></span><span
lang=EN-US>      Initialization &amp; Cleanup</span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>This chapter
begins by introducing the constructor, which guarantees proper initialization.
The definition of the constructor leads into the concept of function
overloading (since you might want several constructors). This is followed by a
discussion of the process of cleanup, which is not always as simple as it
seems. Normally, you just drop an object when you’re done with it and the
garbage collector eventually comes along and releases the memory. This portion
explores the garbage collector and some of its idiosyncrasies. The chapter
concludes with a closer look at how things are initialized: automatic member
initialization, specifying member initialization, the order of initialization, <b>static</b>
initialization and array initialization. </span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 5:</span></span><span
lang=EN-US>      Hiding the Implementation</span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>This chapter
covers the way that code is packaged together, and why some parts of a library
are exposed while other parts are hidden. It begins by looking at the <b>package</b>
and <b>import</b> keywords, which perform file-level packaging and allow you to
build libraries of classes. It then examines subject of directory paths and
file names. The remainder of the chapter looks at the <b>public</b>, <b>private,</b>
and <b>protected</b> keywords, the concept of “friendly” access, and what the different
levels of access control mean when used in various contexts. </span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 6:</span></span><span
lang=EN-US>      Reusing Classes </span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>The concept of
inheritance is standard in virtually all OOP languages. It’s a way to take an
existing class and add to its functionality (as well as change it, the subject
of Chapter 7). Inheritance is often a way to reuse code by leaving the “base
class” the same, and just patching things here and there to produce what you
want. However, inheritance isn’t the only way to make new classes from existing
ones. You can also embed an object inside your new class with <i>composition</i>.
In this chapter you’ll learn about these two ways to reuse code in Java, and
how to apply them. </span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 7:</span></span><span
lang=EN-US>      Polymorphism</span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>On your own, you
might take nine months to discover and understand polymorphism, a cornerstone
of OOP. Through small, simple examples you’ll see how to create a family of
types with inheritance and manipulate objects in that family through their
common base class. Java’s polymorphism allows you to treat all objects in this
family generically, which means the bulk of your code doesn’t rely on specific
type information. This makes your programs extensible, so building programs and
code maintenance is easier and cheaper.</span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 8:</span></span><span
lang=EN-US>      Interfaces &amp; Inner Classes</span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>Java provides a
third way to set up a reuse relationship, through the <i>interface</i>, which
is a pure abstraction of the interface of an object. The <b>interface </b>is
more than just an abstract class taken to the extreme, since it allows you to
perform a variation on C++’s “multiple inheritance,” by creating a class that
can be upcast to more than one base type.<a name=Intro></a></span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>At first, inner
classes look like a simple code hiding mechanism: you place classes inside
other classes. You’ll learn, however, that the inner class does more than
that—it knows about and can communicate with the surrounding class—and that the
kind of code you can write with inner classes is more elegant and clear,
although it is a new concept to most and takes some time to become comfortable
with design using inner classes.</span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 9:</span></span><span
lang=EN-US>      Holding your Objects </span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>It’s a fairly
simple program that has only a fixed quantity of objects with known lifetimes.
In general, your programs will always be creating new objects at a variety of
times that will be known only while the program is running. In addition, you
won’t know until run-time the quantity or even the exact type of the objects
you need. To solve the general programming problem, you need to create any
number of objects, anytime, anywhere. This chapter explores in depth the container
library that Java 2 supplies to hold objects while you’re working with them:
the simple arrays and more sophisticated containers (data structures) such as <b>ArrayList
</b>and <b>HashMap</b>.</span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 10:</span></span><span
lang=EN-US>    Error Handling with Exceptions</span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>The basic
philosophy of Java is that badly-formed code will not be run. As much as
possible, the compiler catches problems, but sometimes the problems—either
programmer error or a natural error condition that occurs as part of the normal
execution of the program—can be detected and dealt with only at run-time. Java
has <i>exception handling</i> to deal with any problems that arise while the
program is running. This chapter examines how the keywords <b>try</b>, <b>catch</b>,
<b>throw</b>, <b>throws</b>, and <b>finally</b> work in Java; when you should
throw exceptions and what to do when you catch them. In addition, you’ll see
Java’s standard exceptions, how to create your own, what happens with
exceptions in constructors, and how exception handlers are located. </span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 11:</span></span><span
lang=EN-US>    The Java I/O System </span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>Theoretically,
you can divide any program into three parts: input, process, and output. This
implies that I/O (input/output) is an important part of the equation. In this
chapter you’ll learn about the different classes that Java provides for reading
and writing files, blocks of memory, and the console. The distinction between
“old” I/O and “new” Java I/O will be shown. In addition, this chapter examines
the process of taking an object, “streaming” it (so that it can be placed on
disk or sent across a network) and reconstructing it, which is handled for you
with Java’s <i>object serialization</i>. Also, Java’s compression libraries,
which are used in the Java ARchive file format (JAR), are examined.</span></p>

<p class=EmphasisP><a name="OLE_LINK9"><span class=Emphasis><span lang=EN-US>Chapter
12:    </span></span><span lang=EN-US>Run-Time Type Identification</span></a></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>Java run-time
type identification (RTTI) lets you find the exact type of an object when you
have a reference to only the base type. Normally, you’ll want to intentionally
ignore the exact type of an object and let Java’s dynamic binding mechanism
(polymorphism) implement the correct behavior for that type. But occasionally
it is very helpful to know the exact type of an object for which you have only
a base reference. Often this information allows you to perform a special-case
operation more efficiently. This chapter explains what RTTI is for, how to use
it, and how to get rid of it when it doesn’t belong there. In addition, this
chapter introduces the Java <i>reflection</i> mechanism.</span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 13:    </span></span><span
lang=EN-US>Creating Windows and Applets</span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>Java comes with
the “Swing” GUI library, which is a set of classes that handle windowing in a
portable fashion. These windowed programs can either be applets or stand-alone
applications. This chapter is an introduction to Swing and the creation of
World Wide Web applets. The important “JavaBeans” technology is introduced.
This is fundamental for the creation of Rapid-Application Development (RAD)
program-building tools.</span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 14</span></span><span
lang=EN-US>:    Multiple Threads </span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>Java provides a
built-in facility to support multiple concurrent subtasks, called <i>threads</i>,
running within a single program. (Unless you have multiple processors on your
machine, this is only the <i>appearance</i> of multiple subtasks.) Although
these can be used anywhere, threads are most apparent when trying to create a
responsive user interface so, for example, a user isn’t prevented from pressing
a button or entering data while some processing is going on. This chapter looks
at the syntax and semantics of multithreading in Java. </span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Chapter 15:    </span></span><span
lang=EN-US>Distributed Computing </span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>All the Java
features and libraries seem to really come together when you start writing
programs to work across networks. This chapter explores communication across
networks and the Internet, and the classes that Java provides to make this
easier. It introduces the very important concepts of <i>Servlets </i>and <i>JSPs</i>
(for server-side programming), along<i> with </i><i>Java DataBase Connectivity</i>
(JDBC), and <i>Remote Method Invocation</i> (RMI). Finally, there’s an
introduction to the new technologies of <i>JINI</i>, <i>JavaSpaces</i>, and <i>Enterprise
JavaBeans</i> (EJBs).</span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Appendix A:   </span></span><span
lang=EN-US>Passing &amp; Returning Objects</span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>Since the only
way you talk to objects in Java is through references, the concepts of passing
an object into a function and returning an object from a function have some
interesting consequences. This appendix explains what you need to know to
manage objects when you’re moving in and out of functions, and also shows the <b>String</b>
class, which uses a different approach to the problem.</span></p>

<p class=EmphasisP><span class=Emphasis><span lang=EN-US>Appendix B:   </span></span><span
lang=EN-US>The Java Native Interface (JNI)</span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>A totally
portable Java program has serious drawbacks: speed and the inability to access
platform-specific services. When you know the platform that you’re running on,
it’s possible to dramatically speed up certain operations by making them <i>native
methods</i>, which are functions that are written in another programming language
(currently, only C/C++ is supported). This appendix gives you enough of an
introduction to this feature that you should be able to create simple examples
that interface with non-Java code.</span></p>

<p class=EmphasisP><span lang=EN-US>Appendix C:   Java Programming Guidelines</span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>This appendix
contains suggestions to help guide you while performing low-level program
design and writing code.</span></p>

<p class=EmphasisP><span lang=EN-US>Appendix D:  Recommended Reading</span></p>

<p class=MsoNormal style='margin-left:76.5pt'><span lang=EN-US>A list of some
of the Java books I’ve found particularly useful.</span></p>

<h2><a name="_Toc481064456"></a><a name="_Toc375545181"></a><a
name="_Toc312373773"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal><span lang=EN-US>I’ve discovered that simple exercises are
exceptionally useful to complete a student’s understanding during a seminar, so
you’ll find a set at the end of each chapter.</span></p>

<p class=MsoNormal><span lang=EN-US>Most exercises are designed to be easy
enough that they can be finished in a reasonable amount of time in a classroom
situation while the instructor observes, making sure that all the students are
absorbing the material. Some exercises are more advanced to prevent boredom for
experienced students. The majority are designed to be solved in a short time
and test and polish your knowledge. Some are more challenging, but none present
major challenges. (Presumably, you’ll find those on your own—or more likely
they’ll find you).</span></p>

<p class=MsoNormal><span lang=EN-US>Solutions to selected exercises can be
found in the electronic document <i>The Thinking in Java Annotated Solution
Guide</i>, available for a small fee from www.BruceEckel.com.</span></p>

<h2><a name="_Toc375545182"></a><a name="_Toc312373774"></a><a
name="_Ref310733137"></a><a name="_Toc481064457"><span lang=EN-US>Multimedia CD
ROM</span></a></h2>

<p class=MsoNormal><span lang=EN-US>There are two multimedia CDs associated
with this book. The first is bound into the book itself: <i>Thinking in C</i>,
described at the end of the preface, which prepares you for the book by
bringing you up to speed on the necessary C syntax you need to be able to
understand Java.</span></p>

<p class=MsoNormal><span lang=EN-US>A second<i> </i></span><span lang=EN-US>Multimedia CD ROM is available, which is based on the contents of the
book. This CD ROM is a separate product and contains the <b>entire</b> contents
of the week-long “Hands-On Java” training seminar. This is more than 15 hours
of lectures that I have recorded, synchronized with hundreds of slides of
information. Because the seminar is based on this book, it is an ideal
accompaniment.</span></p>

<p class=MsoNormal><span lang=EN-US>The CD ROM contains all the lectures (with the
important exception of personalized attention!) from the five-day
full-immersion training seminars. We believe that it sets a new standard for
quality.</span></p>

<p class=MsoNormal><span lang=EN-US>The Hands-On Java CD ROM is available only
by ordering directly from the Web site <i>www.BruceEckel.com</i>.</span></p>

<h2><a name="_Toc481064458"><span lang=EN-US>Source code</span></a></h2>

<p class=MsoNormal><span lang=EN-US>All the source code for this book is
available as copyrighted freeware, distributed as a single package, by visiting
the Web site <i>www.BruceEckel.com</i>. To make sure that you get the most
current version, this is the official site for distribution of the code and the
electronic version of the book. You can find mirrored versions of the
electronic book and the code on other sites (some of these sites are found at <i>www.BruceEckel.com</i>),
but you should check the official site to ensure that the mirrored version is
actually the most recent edition. You may distribute the code in classroom and
other educational situations.</span></p>

<p class=MsoNormal><span lang=EN-US>The primary goal of the copyright is to
ensure that the source of the code is properly cited, and to prevent you from
republishing the code in print media without permission. (As long as the source
is cited, using examples from the book in most media is generally not a
problem.)</span></p>

<p class=MsoNormal><span lang=EN-US>In each </span><span
lang=EN-US>source code file you will find a reference to the following copyright
notice:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>//:!
:CopyRight.txt</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>Copyright
©2000 Bruce Eckel </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>Source
code file from the 2nd edition of the book</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>&quot;Thinking
in Java.&quot; All rights reserved EXCEPT as</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>allowed
by the following statements: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>You
can freely use this file</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>for
your own work (personal or commercial),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>including
modifications and distribution in</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>executable
form only. Permission is granted to use</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>this
file in classroom situations, including its</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>use
in presentation materials, as long as the book</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>&quot;Thinking
in Java&quot; is cited as the source. </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>Except
in classroom situations, you cannot copy</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>and
distribute this code; instead, the sole</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>distribution
point is http://www.BruceEckel.com </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>(and
official mirror sites) where it is</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>freely
available. You cannot remove this</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>copyright
and notice. You cannot distribute</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>modified
versions of the source code in this</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>package.
You cannot use this file in printed</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>media
without the express permission of the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>author.
Bruce Eckel makes no representation about</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>the
suitability of this software for any purpose.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>It
is provided &quot;as is&quot; without express or implied</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>warranty
of any kind, including any implied</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>warranty
of merchantability, fitness for a</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>particular
purpose or non-infringement. The entire</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>risk
as to the quality and performance of the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>software
is with you. Bruce Eckel and the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>publisher
shall not be liable for any damages</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>suffered
by you or any third party as a result of</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>using
or distributing software. In no event will</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>Bruce
Eckel or the publisher be liable for any</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>lost
revenue, profit, or data, or for direct,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>indirect,
special, consequential, incidental, or</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>punitive
damages, however caused and regardless of</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>the
theory of liability, arising out of the use of</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>or
inability to use software, even if Bruce Eckel</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>and
the publisher have been advised of the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>possibility
of such damages. Should the software</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>prove
defective, you assume the cost of all</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>necessary
servicing, repair, or correction. If you</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>think
you've found an error, please submit the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>correction
using the form you will find at</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>www.BruceEckel.com.
(Please use the same</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>form
for non-code errors found in the book.)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You may use the code in your projects and
in the classroom (including your presentation materials) as long as the
copyright notice that appears in each source file is retained.</span></p>

<h3><a name="_Toc481064459"></a><a name="_Toc375545183"></a><a
name="_Toc312373775"><span lang=EN-US>Coding standards</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>In the text of this book, identifiers (function, variable, and class
names) are set in <b>bold</b>. Most keywords are also set in bold, except for
those keywords that are used so much that the bolding can become tedious, such
as “class.”</span></p>

<p class=MsoNormal><span lang=EN-US>I use a particular coding style for the
examples in this book. This style follows the style that Sun itself uses in
virtually all of the code you will find at its site (see <i>java.sun.com/docs/codeconv/index.html</i>),
and seems to be supported by most Java development environments. If you’ve read
my other works, you’ll also notice that Sun’s coding style coincides with
mine—this pleases me, although I had nothing to do with it. The subject of
formatting style is good for hours of hot debate, so I’ll just say I’m not
trying to dictate correct style via my examples; I have my own motivation for
using the style that I do. Because Java is a free-form programming language,
you can continue to use whatever style you’re comfortable with.</span></p>

<p class=MsoNormal><span lang=EN-US>The programs in this book are files that
are included by the word processor in the text, directly from compiled files.
Thus, the code files printed in the book should all work without compiler
errors. The errors that <i>should</i> cause compile-time error messages are
commented out with the comment <b>//! </b>so they can be easily discovered and
tested using automatic means. Errors discovered and reported to the author will
appear first in the distributed source code and later in </span><span lang=EN-US>updates of the book (which will also appear on the Web site <i>www.BruceEckel.com</i>).</span></p>

<h2><a name="_Toc375545184"></a><a name="_Toc312373778"></a><a
name="_Toc481064460"><span lang=EN-US>Java versions</span></a></h2>

<p class=MsoNormal><span lang=EN-US>I generally rely on the Sun implementation
of Java as a reference when determining whether behavior is correct.</span></p>

<p class=MsoNormal><span lang=EN-US>Over time, Sun has released three major
versions of Java: 1.0, 1.1 and 2 (which is called version 2 even though the
releases of the JDK from Sun continue to use the numbering scheme of 1.2, 1.3,
1.4, etc.). Version 2 seems to finally bring Java into the prime time, in
particular where user interface tools are concerned. This book focuses on and
is tested with Java 2, although I do sometimes make concessions to earlier
features of Java 2 so that the code will compile under Linux (via the Linux JDK
that was available at this writing).</span></p>

<p class=MsoNormal><span lang=EN-US>If you need to learn about earlier releases
of the language that are not covered in this edition, the first edition of the
book is freely downloadable at <i>www.BruceEckel.com</i> and is also contained
on the CD that is bound in with this book.</span></p>

<p class=MsoNormal><span lang=EN-US>One thing you’ll notice is that, when I do
need to mention earlier versions of the language, I don’t use the sub-revision
numbers. In this book I will refer to Java 1.0, Java 1.1, and Java 2 only, to
guard against typographical errors produced by further sub-revisioning of these
products.</span></p>

<h2><a name="_Toc481064461"><span lang=EN-US>Seminars and mentoring</span></a></h2>

<p class=MsoNormal><span lang=EN-US>My company provides five-day, hands-on,
public and in-house </span><span lang=EN-US>training seminars based on the material in this book. Selected
material from each chapter represents a lesson, which is followed by a
monitored exercise period so each student receives personal attention. The audio
lectures and slides for the introductory seminar are also captured on CD ROM to
provide at least some of the experience of the seminar without the travel and
expense. For more information, go to <i>www.BruceEckel.com</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>My company also provides consulting,
mentoring and walkthrough services to help guide your project through its
development cycle—especially your company’s first Java project. </span></p>

<h2><a name="_Toc481064462"></a><a name="_Toc375545185"></a><a
name="_Toc312373779"><span lang=EN-US>Errors</span></a></h2>

<p class=MsoNormal><span lang=EN-US>No matter how many tricks a writer uses to detect errors, some always
creep in and these often leap off the page for a fresh reader. </span></p>

<p class=MsoNormal><span lang=EN-US>There is an error submission form linked
from the beginning of each chapter in the HTML version of this book (and on the
CD ROM bound into the back of this book, and downloadable from <i>www.BruceEckel.com</i>)
and also on the Web site itself, on the page for this book.<i> </i>If you
discover anything you believe to be an error, please use this form to submit
the error along with your suggested correction. If necessary, include the
original source file and note any suggested modifications. Your help is
appreciated.</span></p>

<h2><a name="_Toc375545186"></a><a name="_Toc312373780"></a><a
name="_Toc481064463"></a><a name=Acknowledgements></a><span lang=EN-US>Note on
the cover design</span></h2>

<p class=MsoNormal><span lang=EN-US>The cover of <i>Thinking in Java</i> is
inspired by the American Arts &amp; Crafts Movement, which began near the turn
of the century and reached its zenith between 1900 and 1920. It began in
England as a reaction to both the machine production of the Industrial
Revolution and the highly ornamental style of the Victorian era. Arts &amp;
Crafts emphasized spare design, the forms of nature as seen in the art nouveau
movement, hand-crafting, and the importance of the individual craftsperson, and
yet it did not eschew the use of modern tools. There are many echoes with the
situation we have today: the turn of the century, the evolution from the raw
beginnings of the computer revolution to something more refined and meaningful
to individual persons, and the emphasis on software craftsmanship rather than
just manufacturing code. </span></p>

<p class=MsoNormal><span lang=EN-US>I see Java in this same way: as an attempt
to elevate the programmer away from an operating-system mechanic and toward
being a “software craftsman.”</span></p>

<p class=MsoNormal><span lang=EN-US>Both the author and the book/cover designer
(who have been friends since childhood) find inspiration in this movement, and
both own furniture, lamps, and other pieces that are either original or
inspired by this period. </span></p>

<p class=MsoNormal><span lang=EN-US>The other theme in this cover suggests a
collection box that a naturalist might use to display the insect specimens that
he or she has preserved. These insects are objects, which are placed within the
box objects. The box objects are themselves placed within the “cover object,”
which illustrates the fundamental concept of aggregation in object-oriented
programming. Of course, a programmer cannot help but make the association with
“bugs,” and here the bugs have been captured and presumably killed in a
specimen jar, and finally confined within a small display box, as if to imply
Java’s ability to find, display, and subdue bugs (which is truly one of its
most powerful attributes).</span></p>

<h2><a name="_Toc481064464"><span lang=EN-US>Acknowledgements</span></a></h2>

<p class=MsoNormal><span lang=EN-US>First, thanks to associates who have worked
with me to give seminars, provide consulting, and develop teaching projects:
Andrea Provaglio, Dave Bartlett (who also contributed significantly to Chapter
15), Bill Venners, and Larry O’Brien. I appreciate your patience as I continue
to try to develop the best model for independent folks like us to work
together. Thanks to Rolf André Klaedtke (Switzerland); Martin Vlcek, Martin
Byer, Vlada &amp; Pavel Lahoda, Martin the Bear, and Hanka (Prague); and Marco
Cantu (Italy) for hosting me on my first self-organized European seminar tour.</span></p>

<p class=MsoNormal><span lang=EN-US>Thanks to the Doyle Street Cohousing
Community for putting up with me for the two years that it took me to write the
first edition of this book (and for putting up with me at all). Thanks very
much to Kevin and Sonda Donovan for subletting their great place in gorgeous
Crested Butte, Colorado for the summer while I worked on the first edition of
the book. Also thanks to the friendly residents of Crested Butte and the Rocky
Mountain Biological Laboratory who make me feel so welcome.</span></p>

<p class=MsoNormal><span lang=EN-US>Thanks to Claudette Moore at Moore Literary
Agency for her tremendous patience and perseverance in getting me exactly what
I wanted.</span></p>

<p class=MsoNormal><span lang=EN-US>My first two books were published with Jeff
Pepper as editor at Osborne/McGraw-Hill. Jeff appeared at the right place and
the right time at Prentice-Hall and has cleared the path and made all the right
things happen to make this a very pleasant publishing experience. Thanks,
Jeff—it means a lot to me.</span></p>

<p class=MsoNormal><span lang=EN-US>I’m especially indebted to Gen Kiyooka and
his company Digigami, who graciously provided my Web server for the first
several years of my presence on the Web. This was an invaluable learning aid.</span></p>

<p class=MsoNormal><span lang=EN-US>Thanks to Cay Horstmann (co-author of <i>Core
Java</i>, Prentice-Hall, 2000<i>)</i>, D’Arcy Smith (Symantec), and Paul Tyma
(co-author of <i>Java Primer Plus</i>, The Waite Group, 1996), for helping me
clarify concepts in the language.</span></p>

<p class=MsoNormal><span lang=EN-US>Thanks to people who have spoken in my Java
track at the Software Development Conference, and students in my seminars, who
ask the questions I need to hear in order to make the material more clear.</span></p>

<p class=MsoNormal><span lang=EN-US>Special thanks to Larry and Tina O’Brien,
who helped turn my seminar into the original <i>Hands-On Java </i>CD ROM. (You
can find out more at <i>www.BruceEckel.com</i>.)</span></p>

<p class=MsoNormal><span lang=EN-US>Lots of people sent in corrections and I am
indebted to them all, but particular thanks go to (for the first edition):
Kevin Raulerson (found tons of great bugs), Bob Resendes (simply incredible),
John Pinto, Joe Dante, Joe Sharp (all three were fabulous), David Combs (many
grammar and clarification corrections), Dr. Robert Stephenson, John Cook,
Franklin Chen, Zev Griner, David Karr, Leander A. Stroschein, Steve Clark,
Charles A. Lee, Austin Maher, Dennis P. Roth, Roque Oliveira, Douglas Dunn,
Dejan Ristic, Neil Galarneau, David B. Malkovsky, Steve Wilkinson, and a host
of others. Prof. Ir. Marc Meurrens put in a great deal of effort to publicize
and make the electronic version of the first edition of the book available in
Europe.</span></p>

<p class=MsoNormal><span lang=EN-US>There have been a spate of smart technical
people in my life who have become friends and have also been both influential
and unusual in that they do yoga and practice other forms of spiritual
enhancement, which I find quite inspirational and instructional. They are Kraig
Brockschmidt, Gen Kiyooka, and Andrea Provaglio, (who helps in the
understanding of Java and programming in general in Italy, and now in the
United States as an associate of the MindView team).</span></p>

<p class=MsoNormal><span lang=EN-US>It’s not that much of a surprise to me that
understanding Delphi helped me understand Java, since there are many concepts
and language design decisions in common. My Delphi friends provided assistance
by helping me gain insight into that marvelous programming environment. They
are Marco Cantu (another Italian—perhaps being steeped in Latin gives one
aptitude for programming languages?), Neil Rubenking (who used to do the
yoga/vegetarian/Zen thing until he discovered computers), and of course Zack
Urlocker, a long-time pal whom I’ve traveled the world with.</span></p>

<p class=MsoNormal><span lang=EN-US>My friend Richard Hale Shaw’s insights and
support have been very helpful (and Kim’s, too). Richard and I spent many
months giving seminars together and trying to work out the perfect learning
experience for the attendees. Thanks also to KoAnn Vikoren, Eric Faurot, Marco
Pardi, and the rest of the cast and crew at MFI. Thanks especially to Tara
Arrowood, who re-inspired me about the possibilities of conferences.</span></p>

<p class=MsoNormal><span lang=EN-US>The book design, cover design, and cover
photo were created by my friend Daniel Will-Harris, noted author and designer (<i>www.Will-Harris.com</i>),
who used to play with rub-on letters in junior high school while he awaited the
invention of computers and desktop publishing, and complained of me mumbling
over my algebra problems. However, I produced the camera-ready pages myself, so
the typesetting errors are mine. Microsoft<sup>®</sup> Word 97 for Windows was
used to write the book and to create camera-ready pages in Adobe Acrobat; the
book was created directly from the Acrobat PDF files. (As a tribute to the
electronic age, I happened to be overseas both times the final version of the
book was produced—the first edition was sent from Capetown, South Africa and
the second edition was posted from Prague). The body typeface is <i>Georgia </i>and
the headlines are in <i>Verdana</i>. The cover typeface is <i>ITC Rennie
Mackintosh.</i></span></p>

<p class=MsoNormal><span lang=EN-US>Thanks to the vendors who created the
compilers: Borland, the Blackdown group (for Linux), and of course, Sun.</span></p>

<p class=MsoNormal><span lang=EN-US>A special thanks to all my teachers and all
my students (who are my teachers as well). The most fun writing teacher was
Gabrielle Rico (author of <i>Writing the Natural Way</i>, Putnam, 1983). I’ll
always treasure the terrific week at Esalen.</span></p>

<p class=MsoNormal><span lang=EN-US>The supporting cast of friends includes,
but is not limited to: Andrew Binstock, Steve Sinofsky, JD Hildebrandt, Tom
Keffer, Brian McElhinney, Brinkley Barr, Bill Gates at <i>Midnight Engineering
Magazine</i>, Larry Constantine and Lucy Lockwood, Greg Perry, Dan Putterman,
Christi Westphal, Gene Wang, Dave Mayer, David Intersimone, Andrea Rosenfield,
Claire Sawyers, more Italians (Laura Fallai, Corrado, Ilsa, and Cristina
Giustozzi), Chris and Laura Strand, the Almquists, Brad Jerbic, Marilyn
Cvitanic, the Mabrys, the Haflingers, the Pollocks, Peter Vinci, the Robbins
Families, the Moelter Families (and the McMillans), Michael Wilk, Dave Stoner,
Laurie Adams, the Cranstons, Larry Fogg, Mike and Karen Sequeira, Gary
Entsminger and Allison Brody, Kevin Donovan and Sonda Eastlack, Chester and
Shannon Andersen, Joe Lordi, Dave and Brenda Bartlett, David Lee, the
Rentschlers, the Sudeks, Dick, Patty, and Lee Eckel, Lynn and Todd, and their
families. And of course, Mom and Dad.</span></p>

<h3><a name="_Toc481064465"><span lang=EN-US>Internet contributors</span></a><a
name=InternetContributors></a></h3>

<p class=MsoNormal><span lang=EN-US>Thanks to those who helped me rewrite the
examples to use the Swing library, and for other assistance: Jon Shvarts,
Thomas Kirsch, Rahim Adatia, Rajesh Jain, Ravi Manthena, Banu Rajamani, Jens
Brandt, Nitin Shivaram, Malcolm Davis, and everyone who expressed support. This
really helped me jump-start the project.</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection7>

<h1><a name="_Toc481064466"></a><a name="_Toc477690721"></a><a
name="_Toc375545187"><span lang=EN-US>1: Introduction <br>
to Objects</span></a></h1>

<p class=Intro><span lang=EN-US>The genesis of the computer revolution was in a
machine. The genesis of our programming languages thus tends to look like that
machine.</span></p>

<p class=MsoNormal><span lang=EN-US>But computers are not so much machines as
they are mind amplification tools (“bicycles for the mind,” as Steve Jobs is
fond of saying) and a different kind of expressive medium. As a result, the
tools are beginning to look less like machines and more like parts of our
minds, and also like other forms of expression such as writing, painting,
sculpture, animation, and filmmaking. Object-oriented programming (OOP) is part
of this movement toward using the computer as an expressive medium.</span></p>

<p class=MsoNormal><span lang=EN-US>This chapter will introduce you to the </span><span lang=EN-US>basic concepts of OOP, including an overview of development methods.
This chapter, and this </span><span
lang=EN-US>book, assume that you have had experience in a procedural
programming language, although not necessarily C. If you think you need more
preparation in programming and the syntax of C before tackling this book, you
should work through the <i>Thinking in C: Foundations for C++ and Java</i>
training CD ROM, bound in with this book and also available at <i>www.BruceEckel.com</i>.
</span></p>

<p class=MsoNormal><span lang=EN-US>This chapter is background and
supplementary material. Many people do not feel comfortable wading into
object-oriented programming without understanding the big picture first. Thus,
there are many concepts that are introduced here to give you a solid overview
of OOP. However, many other people don’t get the big picture concepts until
they’ve seen some of the mechanics first; these people may become bogged down
and lost without some code to get their hands on. If you’re part of this latter
group and are eager to get to the specifics of the language, feel free to jump
past this chapter—skipping it at this point will not prevent you from writing
programs or learning the language. However, you will want to come back here
eventually to fill in your knowledge so you can understand why objects are
important and how to design with them.</span></p>

<h2><a name="_Toc481064467"></a><a name="_Toc472654682"></a><a
name="_Toc408018385"></a><a name="_Toc375545188"><span lang=EN-US>The progress
of abstraction</span></a></h2>

<p class=MsoNormal><a name=mark></a><span lang=EN-US>All programming languages
provide abstractions. It can be argued that the complexity of the problems
you’re able to solve is directly related to the kind and quality of </span><span lang=EN-US>abstraction. By “kind” I mean, “What is it that you are abstracting?”
Assembly language is a small abstraction of the underlying machine. Many
so-called “imperative” languages that followed (such as Fortran, BASIC, and C)
were abstractions of assembly language. These languages are big improvements
over assembly language, but their primary abstraction still requires you to
think in terms of the structure of the computer rather than the structure of
the problem you are trying to solve. The programmer must establish the
association between the machine model (in the “</span><span lang=EN-US>solution space,” which is the place where you’re modeling that
problem, such as a computer) and the model of the problem that is actually
being solved (in the “</span><span lang=EN-US>problem space,” which is the
place where the problem exists). The effort required to perform this mapping,
and the fact that it is extrinsic to the programming language, produces
programs that are difficult to write and expensive to maintain, and as a side
effect created the entire “programming methods” industry.</span></p>

<p class=MsoNormal><span lang=EN-US>The alternative to modeling the machine is
to model the problem you’re trying to solve. Early languages such as LISP and
APL chose particular views of the world (“All problems are ultimately lists” or
“All problems are algorithmic,” respectively). PROLOG casts all problems into
chains of decisions. Languages have been created for constraint-based
programming and for programming exclusively by manipulating graphical symbols.
(The latter proved to be too restrictive.) Each of these approaches is a good
solution to the particular class of problem they’re designed to solve, but when
you step outside of that domain they become awkward. </span></p>

<p class=MsoNormal><span lang=EN-US>The object-oriented approach goes a step
further by providing tools for the programmer to represent elements in the
problem space. This representation is general enough that the programmer is not
constrained to any particular type of problem. We refer to the elements in the
problem space and their representations in the solution space as</span><span lang=EN-US> “objects.” (Of course, you will also need other objects that don’t
have problem-space analogs.) The idea is that the program is allowed to adapt
itself to the lingo of the problem by adding new types of objects, so when you
read the code describing the solution, you’re reading words that also express
the problem. This is a more flexible and powerful language abstraction than
what we’ve had before. Thus, OOP allows you to describe the problem in terms of
the problem, rather than in terms of the computer where the solution will run.
There’s still a connection back to the computer, though. Each object looks
quite a bit like a little computer; it has a state, and it has operations that
you can ask it to perform. However, this doesn’t seem like such a bad analogy
to objects in the real world—they all have characteristics and behaviors. </span></p>

<p class=MsoNormal><span lang=EN-US>Some language designers have decided that
object-oriented programming by itself is not adequate to easily solve all
programming problems, and advocate the combination of various approaches into <i>multiparadigm</i>
programming languages.</span><a href="#_ftn2" name="_ftnref2" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[2]</span></span></span></span></a></p>

<p class=MsoNormal><span lang=EN-US>Alan Kay summarized five </span><span lang=EN-US>basic characteristics of </span><span
lang=EN-US>Smalltalk, the first successful object-oriented language and one of
the languages upon which Java is based. These characteristics represent a pure
approach to object-oriented programming</span><span lang=EN-US>:</span></p>

<p class=Numbered><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>Everything
is an object.</span></b><span lang=EN-US> Think of an object as a fancy
variable; it stores data, but you can “make requests” to that object, asking it
to perform operations on itself. In theory, you can take any conceptual
component in the problem you’re trying to solve (dogs, buildings, services,
etc.) and represent it as an object in your program.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>7.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>A </span></b><b><span
lang=EN-US style='font-family:"Verdana","sans-serif"'>program</span></b><b><span
lang=EN-US style='font-family:"Verdana","sans-serif"'> is a bunch of objects
telling each other what to do by sending messages</span></b><span lang=EN-US>.
To make a request of an object, you “send a message” to that object. More
concretely, you can think of a message as a request to call a function that
belongs to a particular object.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>8.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>Each
</span></b><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>object</span></b><b><span
lang=EN-US style='font-family:"Verdana","sans-serif"'> has its own memory made
up of other objects</span></b><span lang=EN-US>. Put another way, you create a
new kind of object by making a package containing existing objects. Thus, you
can build complexity in a program while hiding it behind the simplicity of
objects.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>9.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>Every
</span></b><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>object</span></b><b><span
lang=EN-US style='font-family:"Verdana","sans-serif"'> has a type</span></b><span
lang=EN-US>. Using the parlance, each object is an <i>instance</i> of a <i>class</i>,
in which “class” is synonymous with “type.” The most important distinguishing
characteristic of a class is “What messages can you send to it?”</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>10.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><span
lang=EN-US style='font-family:"Verdana","sans-serif"'>All </span></b><b><span
lang=EN-US style='font-family:"Verdana","sans-serif"'>objects</span></b><b><span
lang=EN-US style='font-family:"Verdana","sans-serif"'> of a particular type can
receive the same messages</span></b><span lang=EN-US>. This is actually a
loaded statement, as you will see later. Because an object of type “circle” is
also an object of type “shape,” a circle is guaranteed to accept shape
messages. This means you can write code that talks to shapes and automatically
handle anything that fits the description of a shape. This <i>substitutability</i>
is one of the most powerful concepts in OOP.</span></p>

<h2><a name="_Toc481064468"></a><a name="_Toc472654683"></a><a
name="_Toc408018386"></a><a name="_Toc375545189"><span lang=EN-US>An object has
an interface</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Aristotle was probably the first to begin a
careful study of the concept of <i>type;</i> he spoke of “the class of fishes
and the class of birds.” The idea that all objects, while being unique, are
also part of a class of objects that have characteristics and behaviors in
common was used directly in the first object-oriented language, Simula-67, with
its fundamental keyword <b>class</b> that introduces a new type into a program.</span></p>

<p class=MsoNormal><span lang=EN-US>Simula, as its name implies, was created for developing simulations
such as the classic “bank teller problem.” In this, you have a bunch of
tellers, customers, accounts, transactions, and units of money—a lot of
“objects.” Objects that are identical except for their state during a program’s
execution are grouped together into “classes of objects” and that’s where the </span><span lang=EN-US>keyword <b>class</b> came from. Creating abstract data types
(classes) is a fundamental concept in object-oriented programming. Abstract
data types work almost exactly like built-in types: You can create variables of
a type (called <i>objects </i>or <i>instances</i> in object-oriented parlance)
and manipulate those variables (called </span><span lang=EN-US><i>sending messages</i> or </span><span
lang=EN-US><i>requests;</i> you send a message and the object figures out what
to do with it). The members (elements) of each class share some commonality:
every account has a balance, every teller can accept a deposit, etc. At the
same time, each member has its own state, each account has a different balance,
each teller has a name. Thus, the tellers, customers, accounts, transactions,
etc., can each be represented with a unique entity in the computer program.
This entity is the object, and each object belongs to a particular class that
defines its characteristics and behaviors.</span></p>

<p class=MsoNormal><span lang=EN-US>So, although what we really do in
object-oriented programming is create new data types, virtually all
object-oriented programming languages use the “class” keyword. When you see the
word “type” think “class” and vice versa</span><a href="#_ftn3" name="_ftnref3"
title=""><span class=MsoFootnoteReference><span lang=EN-US style='font-size:
8.0pt'><span class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;
font-family:"Georgia","serif"'>[3]</span></span></span></span></a><span
lang=EN-US>.</span></p>

<p class=MsoNormal><span lang=EN-US>Since a class describes a set of objects that
have identical characteristics (data elements) and behaviors (functionality), a
class is really a </span><span lang=EN-US>data type because a floating point number, for example, also has a set
of characteristics and behaviors. The difference is that a programmer defines a
class to fit a problem rather than being forced to use an existing data type
that was designed to represent a unit of storage in a machine. You extend the
programming language by adding new data types specific to your needs. The
programming system welcomes the new classes and gives them all the care and
type-checking that it gives to built-in types.</span></p>

<p class=MsoNormal><span lang=EN-US>The object-oriented approach is not limited
to building simulations. Whether or not you agree that any program is a
simulation of the system you’re designing, the use of OOP techniques can easily
reduce a large set of problems to a simple solution.</span></p>

<p class=MsoNormal><span lang=EN-US>Once a class is established, you can make
as many objects of that class as you like, and then manipulate those objects as
if they are the elements that exist in the problem you are trying to solve.
Indeed, one of the challenges of object-oriented programming is to create a
one-to-one mapping between the elements in the problem space and objects in the
solution space.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
lang=EN-US>But how do you get an object to do useful work for you? There must
be a way to make a request of the object so that it will do something, such as
complete a transaction, draw something on the screen, or turn on a switch. And
each object can satisfy only certain requests. The requests you can make of an
object are defined by its <i>interface,</i> and the type is what determines the
interface. A simple example might be a representation of a light bulb: </span></p>

<p class=MsoNormal align=center style='margin-bottom:0cm;margin-bottom:.0001pt;
text-align:center'><span lang=EN-US><img border=0 width=314 height=164
src="TIJ2_files/image006.png"></span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Light lt = new Light();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>lt.on();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The interface establishes <i>what</i>
requests you can make for a particular object. However, there must be code
somewhere to satisfy that request. This, along with the hidden data, comprises
the </span><span lang=EN-US><i>implementation</i>. From a procedural programming
standpoint, it’s not that complicated. A type has a function associated with
each possible request, and when you make a particular request to an object,
that function is called. This process is usually summarized by saying that you
“send a message” (make a request) to an object, and the object figures out what
to do with that message (it executes code).</span></p>

<p class=MsoNormal><span lang=EN-US>Here, the name of the type/class is <b>Light</b>,
the name of this particular <b>Light </b>object is <b>lt</b>,<b> </b>and the
requests that you can make of a <b>Light</b> object are to turn it on, turn it
off, make it brighter, or make it dimmer. You create a <b>Light </b>object by
defining a “reference” (<b>lt</b>) for that object and calling <b>new</b> to
request a new object of that type. To send a message to the object, you state
the name of the object and connect it to the message request with a period
(dot). From the standpoint of the user of a predefined class, that’s pretty
much all there is to programming with objects.</span></p>

<p class=MsoNormal><span lang=EN-US>The diagram shown above follows the format
of the </span><span lang=EN-US><i>Unified Modeling Language</i> (UML). Each
class is represented by a box, with the type name in the top portion of the
box, any data members that you care to describe in the middle portion of the
box, and the </span><span lang=EN-US><i>member functions</i> (the functions
that belong to this object, which receive any messages you send to that object)
in the bottom portion of the box. Often, only the name of the class and the
public member functions are shown in UML design diagrams, and so the middle
portion is not shown. If you’re interested only in the class name, then the
bottom portion doesn’t need to be shown, either.</span></p>

<h2><a name="_Toc481064469"></a><a name="_Toc472654684"></a><a
name="_Toc408018387"></a><a name="_Toc375545190"><span lang=EN-US>The hidden
implementation</span></a></h2>

<p class=MsoNormal><span lang=EN-US>It is helpful to break up the playing field
into </span><span lang=EN-US><i>class creators</i> (those who create new data
types) and </span><span lang=EN-US><i>client programmers</i></span><a
href="#_ftn4" name="_ftnref4" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[4]</span></span></span></span></a><span
lang=EN-US> (the class consumers who use the data types in their applications).
The goal of the client programmer is to collect a toolbox full of classes to
use for rapid application development. The goal of the class creator is to
build a class that exposes only what’s necessary to the client programmer and
keeps everything else hidden. Why? Because if it’s hidden, the client
programmer can’t use it, which means that the class creator can change the
hidden portion at will without worrying about the impact to anyone else. The
hidden portion usually represents the tender insides of an object that could
easily be corrupted by a careless or uninformed client programmer, so hiding
the implementation reduces program bugs. The concept of </span><span lang=EN-US>implementation hiding cannot be overemphasized.</span></p>

<p class=MsoNormal><span lang=EN-US>In any relationship it’s important to have
boundaries that are respected by all parties involved. When you create a
library, you establish a relationship with the client<i> </i>programmer, who is
also a programmer, but one who is putting together an application by using your
library, possibly to build a bigger library.</span></p>

<p class=MsoNormal><span lang=EN-US>If all the members of a class are available
to everyone, then the client programmer can do anything with that class and
there’s no way to enforce rules. Even though you might really prefer that the
client programmer not directly manipulate some of the members of your class,
without access control there’s no way to prevent it. Everything’s naked to the
world.</span></p>

<p class=MsoNormal><span lang=EN-US>So the first reason for access control is
to keep client programmers’ hands off portions they shouldn’t touch—parts that
are necessary for the internal machinations of the data type but not part of
the interface that users need in order to solve their particular problems. This
is actually a service to users because they can easily see what’s important to
them and what they can ignore.</span></p>

<p class=MsoNormal><span lang=EN-US>The second reason for access control is to
allow the library designer to change the internal workings of the class without
worrying about how it will affect the client programmer. For example, you might
implement a particular class in a simple fashion to ease development, and then
later discover that you need to rewrite it in order to make it run faster. If
the interface and implementation are clearly separated and protected, you can
accomplish this easily.</span></p>

<p class=MsoNormal><span lang=EN-US>Java uses three explicit keywords to set
the boundaries in a class: <b>public</b>, <b>private</b>, and <b>protected</b>.
Their use and meaning are quite straightforward. These <i>access specifiers</i>
</span><span lang=EN-US>determine who can use the definitions that follow. <b>public</b>
</span><span lang=EN-US>means the following definitions are available to
everyone. The <b>private</b> </span><span lang=EN-US>keyword, on the other
hand, means that no one can access those definitions except you, the creator of
the type, inside member functions of that type. <b>private</b> is a brick wall
between you and the client programmer. If someone tries to access a <b>private</b>
member, they’ll get a compile-time error. </span><span
lang=EN-US><b>protected</b> acts like <b>private</b>, with the exception that
an inheriting class has access to <b>protected</b> members, but not <b>private</b>
members. Inheritance will be introduced shortly.</span></p>

<p class=MsoNormal><span lang=EN-US>Java also has a “default” access, which
comes into play if you don’t use one of the aforementioned specifiers. This is
sometimes called “friendly” access because classes can access the friendly
members of other classes in the same package, but outside of the package those
same friendly members appear to be <b>private</b>.</span></p>

<h2><a name="_Toc481064470"></a><a name="_Toc472654685"></a><a
name="_Toc408018388"></a><a name="_Toc375545191"><span lang=EN-US>Reusing the
implementation</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Once a class has been created and tested,
it should (ideally) represent a useful unit of code. It turns out that this </span><span lang=EN-US>reusability is not nearly so easy to achieve as many would hope; it
takes experience and insight to produce a good design. But once you have such a
design, it begs to be reused. Code reuse is one of the greatest advantages that
object-oriented programming languages provide.</span></p>

<p class=MsoNormal style='margin-bottom:6.0pt'><span lang=EN-US>The simplest
way to reuse a class is to just use an object of that class directly, but you
can also place an object of that class inside a new class. We call this
“creating a </span><span lang=EN-US>member object.” Your new class can be made
up of any number and type of other objects, in any combination that you need to
achieve the functionality desired in your new class. Because you are composing
a new class from existing classes, this concept is called </span><span lang=EN-US><i>composition</i> (or more generally, </span><span
lang=EN-US><i>aggregation</i>). Composition is often referred to as a “</span><span lang=EN-US>has-a” relationship, as in “a car has an engine.”</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=284 height=69 src="TIJ2_files/image007.png"></span></p>

<p class=MsoNormal><span lang=EN-US>(The above </span><span
lang=EN-US>UML diagram indicates composition with the filled diamond, which
states there is one car. I will typically use a simpler form: just a line,
without the diamond, to indicate an association.</span><a href="#_ftn5"
name="_ftnref5" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[5]</span></span></span></span></a><span
lang=EN-US>)</span></p>

<p class=MsoNormal><span lang=EN-US>Composition comes with a great deal of
flexibility. The member objects of your new class are usually private, making
them inaccessible to the client programmers who are using the class. This
allows you to change those members without disturbing existing client code. You
can also change the member objects at run-time, to dynamically change the
behavior of your program. Inheritance, which is described next, does not have
this flexibility since the compiler must place compile-time restrictions on
classes created with inheritance.</span></p>

<p class=MsoNormal><span lang=EN-US>Because inheritance is so important in
object-oriented programming it is often highly emphasized, and the new
programmer can get the idea that inheritance should be used everywhere. This
can result in awkward and overly complicated designs. Instead, you should first
look to composition when creating new classes, since it is simpler and more
flexible. If you take this approach, your designs will be cleaner. Once you’ve
had some experience, it will be reasonably obvious when you need inheritance.</span></p>

<h2><a name="_Toc481064471"></a><a name="_Toc472654686"></a><a
name="_Toc408018389"></a><a name="_Toc375545192"><span lang=EN-US>Inheritance:<br>
reusing the interface</span></a></h2>

<p class=MsoNormal><span lang=EN-US>By itself, the idea of an object is a
convenient tool. It allows you to package data and functionality together by <i>concept</i>,
so you can represent an appropriate problem-space idea rather than being forced
to use the idioms of the underlying machine. These concepts are expressed as
fundamental units in the programming language by using the </span><span lang=EN-US><b>class</b> keyword.</span></p>

<p class=MsoNormal style='margin-bottom:6.0pt'><span lang=EN-US>It seems a
pity, however, to go to all the trouble to create a class and then be forced to
create a brand new one that might have similar functionality. It’s nicer if we
can take the existing class, clone it, and then make additions and
modifications to the clone. This is effectively what you get with </span><span lang=EN-US><i>inheritance</i>, with the exception that if the original class
(called the <i>base</i> or <i>super</i> or <i>parent</i> class) is changed, the
modified “clone” (called the <i>derived </i>or <i>inherited</i> or <i>sub</i>
or <i>child</i><b> </b>class) also reflects those changes.</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=125 height=149 src="TIJ2_files/image008.png"></span></p>

<p class=MsoNormal><span lang=EN-US>(The arrow in the above UML diagram points
from the derived class to the base class. As you will see, there can be more
than one derived class.)</span></p>

<p class=MsoNormal><span lang=EN-US>A type does more than describe the constraints
on a set of objects; it also has a relationship with other types. Two types can
have characteristics and behaviors in common, but one type may contain more
characteristics than another and may also handle more messages (or handle them
differently). Inheritance expresses this similarity between types using the
concept of </span><span lang=EN-US>base types and </span><span lang=EN-US>derived types. A base type contains all of the characteristics and
behaviors that are shared among the types derived from it. You create a base
type to represent the core of your ideas about some objects in your system.
From the base type, you derive other types to express the different ways that
this core can be realized.</span></p>

<p class=MsoNormal><span lang=EN-US>For example, a trash-recycling machine
sorts pieces of trash. The base type is “trash,” and each piece of trash has a
weight, a value, and so on, and can be shredded, melted, or decomposed. From
this, more specific types of trash are derived that may have additional characteristics
(a bottle has a color) or behaviors (an aluminum can may be crushed, a steel
can is magnetic). In addition, some behaviors may be different (the value of
paper depends on its type and condition). Using inheritance, you can build a
type hierarchy that expresses the problem you’re trying to solve in terms of
its types.</span></p>

<p class=MsoNormal><span lang=EN-US>A second example is the classic “</span><span lang=EN-US>shape” example, perhaps used in a computer-aided design system or
game simulation. The base type is “shape,” and each shape has a size, a color,
a position, and so on. Each shape can be drawn, erased, moved, colored, etc.
From this, specific types of shapes are derived (inherited): circle, square,
triangle, and so on, each of which may have additional characteristics and behaviors.
Certain shapes can be flipped, for example. Some behaviors may be different,
such as when you want to calculate the area of a shape. The type hierarchy
embodies both the similarities and differences between the shapes.</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=338 height=261 src="TIJ2_files/image009.png"></span></p>

<p class=MsoNormal><span lang=EN-US>Casting the solution in the same terms as
the problem is tremendously beneficial because you don’t need a lot of
intermediate models to get from a description of the problem to a description
of the solution. With objects, the type hierarchy is the primary model, so you
go directly from the description of the system in the real world to the
description of the system in code. Indeed, one of the difficulties people have
with object-oriented design is that it’s too simple to get from the beginning
to the end. A mind trained to look for complex solutions is often stumped by
this simplicity at first.</span></p>

<p class=MsoNormal><span lang=EN-US>When you inherit from an existing type, you
create a new type. This new type contains not only all the members of the
existing type (although the <b>private</b> ones are hidden away and
inaccessible), but more important, it duplicates the interface of the base
class. That is, all the messages you can send to objects of the base class you
can also send to objects of the derived class. Since we know the type of a
class by the messages we can send to it, this means that the derived class <i>is
the same type as the base class</i>. In the previous example, “a circle is a
shape.” This type equivalence via inheritance is one of the fundamental
gateways in understanding the meaning of object-oriented programming.</span></p>

<p class=MsoNormal><span lang=EN-US>Since both the base class and derived class
have the same interface, there must be some implementation to go along with
that interface. That is, there must be some code to execute when an object
receives a particular message. If you simply inherit a class and don’t do
anything else, the methods from the base-class interface come right along into
the derived class. That means objects of the derived class have not only the
same type, they also have the same behavior, which isn’t particularly
interesting.</span></p>

<p class=MsoNormal><span lang=EN-US>You have two ways to differentiate your new
derived class from the original base class. The first is quite straightforward:
You simply add brand new functions to the derived class. These new functions
are not part of the base class interface. This means that the base class simply
didn’t do as much as you wanted it to, so you added more functions. This simple
and primitive use for </span><span lang=EN-US>inheritance is, at times, the perfect solution to your problem.
However, you should look closely for the possibility that your base class might
also need these additional functions. This process of discovery and iteration
of your design happens regularly in object-oriented programming.</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=364 height=296 src="TIJ2_files/image010.png"></span></p>

<p class=MsoNormal><span lang=EN-US>Although inheritance may sometimes imply
(especially in Java, where the keyword that indicates inheritance is <b>extends</b>)<b>
</b>that you are going to add new functions to the interface, that’s not
necessarily true. The second and more important way to differentiate your new
class is to <i>change</i> the behavior of an existing base-class function. This
is referred to as </span><span lang=EN-US><i>overriding</i> that function.</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=350 height=296 src="TIJ2_files/image011.png"></span></p>

<p class=MsoNormal><span lang=EN-US>To override a function, you simply create a
new definition for the function in the derived class. You’re saying, “I’m using
the same interface function here, but I want it to do something different for
my new type.”</span></p>

<h3><a name="_Toc481064472"></a><a name="_Toc472654687"></a><a
name="_Toc408018391"></a><a name="_Toc375545194"><span lang=EN-US>Is-a vs.
is-like-a relationships</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>There’s a certain debate that can occur about inheritance: Should
inheritance override <i>only</i> base-class functions (and not add new member
functions that aren’t in the base class)? This would mean that the derived type
is <i>exactly</i> the same type as the base class since it has exactly the same
interface. As a result, you can exactly substitute an object of the derived
class for an object of the base class. This can be thought of as </span><span lang=EN-US><i>pure substitution</i>, and it’s often referred to as the </span><span lang=EN-US><i>substitution principle</i>. In a sense, this is the ideal way to
treat inheritance. We often refer to the relationship between the base class
and derived classes in this case as an <i>is-a</i> relationship, because you
can say “a circle <i>is a</i> shape.” A test for inheritance is to determine
whether you can state the is-a relationship about the classes and have it make
sense.</span></p>

<p class=MsoNormal><span lang=EN-US>There are times when you must add new
interface elements to a derived type, thus extending the interface and creating
a new type. The new type can still be substituted for the base type, but the
substitution isn’t perfect because your new functions are not accessible from
the base type. This can be described as an <i>is-like-a</i></span><a
href="#_ftn6" name="_ftnref6" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[6]</span></span></span></span></a><span
lang=EN-US> relationship; the new type has the interface of the old type but it
also contains other functions, so you can’t really say it’s exactly the same.
For example, consider an air conditioner. Suppose your house is wired with all
the controls for cooling; that is, it has an interface that allows you to
control cooling. Imagine that the air conditioner breaks down and you replace
it with a heat pump, which can both heat and cool. The heat pump <i>is-like-an</i>
air conditioner, but it can do more. Because the control system of your house
is designed only to control cooling, it is restricted to communication with the
cooling part of the new object. The interface of the new object has been
extended, and the existing system doesn’t know about anything except the
original interface.</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=417 height=220 src="TIJ2_files/image012.png"></span></p>

<p class=MsoNormal><span lang=EN-US>Of course, once you see this design it
becomes clear that the base class “cooling system” is not general enough, and
should be renamed to “temperature control system” so that it can also include
heating—at which point the substitution principle will work. However, the
diagram above is an example of what can happen in design and in the real world.
</span></p>

<p class=MsoNormal style='margin-top:6.0pt'><span lang=EN-US>When you see the
substitution principle it’s easy to feel like this approach (pure substitution)
is the only way to do things, and in fact it <i>is</i> nice if your design
works out that way. But you’ll find that there are times when it’s equally
clear that you must add new functions to the interface of a derived class. With
inspection both cases should be reasonably obvious.</span></p>

<h2><a name="_Toc481064473"></a><a name="_Toc472654688"></a><a
name="_Toc408018392"></a><a name="_Toc375545195"><span lang=EN-US>Interchangeable
objects <br>
with polymorphism</span></a></h2>

<p class=MsoNormal><span lang=EN-US>When dealing with type hierarchies, you
often want to treat an object not as the specific type that it is, but instead
as its base type. This allows you to write code that doesn’t depend on specific
types. In the shape example, functions manipulate generic shapes without
respect to whether they’re circles, squares, triangles, or some shape that
hasn’t even been defined yet. All shapes can be drawn, erased, and moved, so
these functions simply send a message to a shape object; they don’t worry about
how the object copes with the message.</span></p>

<p class=MsoNormal><span lang=EN-US>Such code is unaffected by the addition of
new types, and adding new types is the most common way to extend an
object-oriented program to handle new situations. For example, you can derive a
new subtype of shape called pentagon<i> </i>without modifying the functions
that deal only with generic shapes. This ability to extend a program easily by
deriving new subtypes is important because it greatly improves designs while
reducing the cost of software maintenance.</span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
lang=EN-US>There’s a problem, however, with attempting to treat derived-type
objects as their generic base types (circles as shapes, bicycles as vehicles,
cormorants as birds, etc.). If a function is going to tell a generic shape to
draw itself, or a generic vehicle to steer, or a generic bird to move, the
compiler cannot know at compile-time precisely what piece of code will be
executed. That’s the whole point—when the message is sent, the programmer
doesn’t <i>want</i> to know what piece of code will be executed; the draw
function can be applied equally to a circle, a square, or a triangle, and the
object will execute the proper code depending on its specific type. If you
don’t have to know what piece of code will be executed, then when you add a new
subtype, the code it executes can be different without requiring changes to the
function call. Therefore, the compiler cannot know precisely what piece of code
is executed, so what does it do? For example, in the following diagram the <b>BirdController</b>
object just works with generic <b>Bird</b> objects, and does not know what
exact type they are. This is convenient from <b>BirdController</b>’s
perspective because it doesn’t have to write special code to determine the
exact type of <b>Bird</b> it’s working with, or that <b>Bird</b>’s behavior. So
how does it happen that, when <b>move(&nbsp;)</b> is called while ignoring the
specific type of <b>Bird</b>, the right behavior will occur (a <b>Goose </b>runs,
flies, or swims, and a <b>Penguin</b> runs or swims)?</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=443 height=199 src="TIJ2_files/image013.png"></span></p>

<p class=MsoNormal><span lang=EN-US>The answer is the primary twist in
object-oriented programming: the compiler cannot make a function call in the
traditional sense. The function call generated by a non-OOP compiler causes
what is called </span><span lang=EN-US><i>early binding</i>, a term you may not
have heard before because you’ve never thought about it any other way. It means
the compiler generates a call to a specific function name, and the linker
resolves this call to the absolute address of the code to be executed. In OOP,
the program cannot determine the address of the code until run-time, so some
other scheme is necessary when a message is sent to a generic object.</span></p>

<p class=MsoNormal><span lang=EN-US>To solve the problem, object-oriented
languages use the concept of </span><span lang=EN-US><i>late binding</i>. When you send a message to an object, the code
being called isn’t determined until run-time. The compiler does ensure that the
function exists and performs type checking on the arguments and return value (a
language in which this isn’t true is called </span><span lang=EN-US><i>weakly typed</i>), but it doesn’t know the exact code to execute.</span></p>

<p class=MsoNormal><span lang=EN-US>To perform late binding, Java uses a
special bit of code in lieu of the absolute call. This code calculates the
address of the function body, using information stored in the object (this
process is covered in great detail in Chapter 7). Thus, each object can behave
differently according to the contents of that special bit of code. When you
send a message to an object, the object actually does figure out what to do
with that message.</span></p>

<p class=MsoNormal><span lang=EN-US>In some languages (C++, in particular) you
must explicitly state that you want a function to have the flexibility of
late-binding properties. In these languages, by default, member functions are <i>not</i>
dynamically bound. This caused problems, so in Java dynamic binding is the
default and you don’t need to remember to add any extra keywords in order to
get polymorphism.</span></p>

<p class=MsoNormal><span lang=EN-US>Consider the shape example. The family of
classes (all based on the same uniform interface) was diagrammed earlier in
this chapter. To demonstrate polymorphism, we want to write a single piece of
code that ignores the specific details of type and talks only to the base
class. That code is </span><span
lang=EN-US><i>decoupled</i> from type-specific information, and thus is simpler
to write and easier to understand. And, if a new type—a <b>Hexagon</b>, for
example—is added through inheritance, the code you write will work just as well
for the new type of <b>Shape</b> as it did on the existing types. Thus, the
program is <i>extensible</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>If you write a method in Java (as you will
soon learn how to do):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>void doStuff(Shape s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  s.erase();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  s.draw();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This function speaks to any <b>Shape</b>,
so it is independent of the specific type of object that it’s drawing and
erasing. If in some other part of the program we use the <b>doStuff(&nbsp;)</b>
function:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Circle c = new Circle();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Triangle t = new
Triangle();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Line l = new Line();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>doStuff(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>doStuff(t);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>doStuff(l);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The calls to <b>doStuff(&nbsp;) </b>automatically
work correctly, regardless of the exact type of the object. </span></p>

<p class=MsoNormal><span lang=EN-US>This is actually a pretty amazing trick.
Consider the line:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>doStuff(c);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>What’s happening here is that a <b>Circle</b>
is being passed into a function that’s expecting a <b>Shape</b>. Since a <b>Circle</b>
<i>is</i> a <b>Shape</b> it can be treated as one by <b>doStuff(&nbsp;)</b>.
That is, any message that <b>doStuff(&nbsp;)</b> can send to a <b>Shape</b>, a <b>Circle</b>
can accept. So it is a completely safe and logical thing to do.</span></p>

<p class=MsoNormal style='margin-bottom:6.0pt'><span lang=EN-US>We call this
process of treating a derived type as though it were its base type </span><span lang=EN-US><i>upcasting</i>. The name </span><span
lang=EN-US><i>cast </i>is used in the sense of casting into a mold and the <i>up</i>
comes from the way the </span><span lang=EN-US>inheritance diagram is typically arranged, with the base type at the
top and the derived classes fanning out downward. Thus, casting to a base type
is moving up the inheritance diagram: “upcasting.”</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=362 height=179 src="TIJ2_files/image014.png"></span></p>

<p class=MsoNormal><span lang=EN-US>An object-oriented program contains some
upcasting somewhere, because that’s how you decouple yourself from knowing
about the exact type you’re working with. Look at the code in <b>doStuff(&nbsp;)</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  s.erase();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // ...</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  s.draw();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Notice that it doesn’t say “If you’re a <b>Circle</b>,
do this, if you’re a <b>Square</b>, do that, etc.” If you write that kind of
code, which checks for all the possible types that a <b>Shape</b> can actually
be, it’s messy and you need to change it every time you add a new kind of <b>Shape</b>.
Here, you just say “You’re a shape, I know you can <b>erase(&nbsp;) </b>and <b>draw(&nbsp;)
</b>yourself, do it, and take care of the details correctly.” </span></p>

<p class=MsoNormal><span lang=EN-US>What’s impressive about the code in <b>doStuff(&nbsp;)</b>
is that, somehow, the right thing happens. Calling <b>draw(&nbsp;)</b> for <b>Circle</b>
causes different code to be executed than when calling <b>draw(&nbsp;) </b>for
a <b>Square</b> or a <b>Line</b>, but when the <b>draw(&nbsp;)</b> message is
sent to an anonymous <b>Shape</b>, the correct behavior occurs based on the
actual type of the <b>Shape</b>. This is amazing because, as mentioned earlier,
when the Java compiler is compiling the code for <b>doStuff(&nbsp;)</b>, it
cannot know exactly what types it is dealing with. So ordinarily, you’d expect
it to end up calling the version of <b>erase(&nbsp;)</b> and <b>draw(&nbsp;) </b>for
the base class <b>Shape</b>, and not for the specific <b>Circle</b>, <b>Square</b>,
or <b>Line</b>. And yet the right thing happens because of polymorphism. The
compiler and run-time system handle the details; all you need to know is that
it happens, and more important how to design with it. When you send a message
to an object, the object will do the right thing, even when upcasting is
involved.</span></p>

<h3><a name="_Toc481064474"></a><a name="_Toc473421287"></a><a
name="_Toc375545197"><span lang=EN-US>Abstract base class</span></a><span
lang=EN-US>es and interfaces</span></h3>

<p class=MsoNormal><span lang=EN-US>Often in a design, you want the base class
to present <i>only</i> an interface for its derived classes. That is, you don’t
want anyone to actually create an object of the base class, only to upcast to
it so that its interface can be used. This is accomplished by making that class
<i>abstract </i>using the <b>abstract</b> keyword. If anyone tries to make an
object of an <b>abstract</b> class, the compiler prevents them. This is a tool
to enforce a particular design.</span></p>

<p class=MsoNormal><span lang=EN-US>You can also use the <b>abstract</b>
keyword to describe a method that hasn’t been implemented yet—as a stub
indicating “here is an interface function for all types inherited from this
class, but at this point I don’t have any implementation for it.” An <b>abstract
</b>method may be created only inside an <b>abstract </b>class. When the class
is inherited, that method must be implemented, or the inheriting class becomes <b>abstract</b>
as well. Creating an <b>abstract</b> method allows you to put a method in an
interface without being forced to provide a possibly meaningless body of code
for that method.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>interface</b> keyword takes the
concept of an <b>abstract</b> class one step further by preventing any function
definitions at all. The <b>interface</b> is a very handy and commonly used
tool, as it provides the perfect separation of interface and implementation. In
addition, you can combine many interfaces together, if you wish, whereas
inheriting from multiple regular classes or abstract classes is not possible.</span></p>

<h2><a name="_Toc312373795"></a><a name="_Toc408018408"></a><a
name="_Toc408018395"></a><a name="_Toc375545198"></a><a name="_Toc481064475"><span
lang=EN-US>Object landscapes and lifetimes</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Technically, OOP is just about abstract
data typing, inheritance, and polymorphism, but other issues can be at least as
important. The remainder of this section will cover these issues.</span></p>

<p class=MsoNormal><span lang=EN-US>One of the most important factors is the
way objects are created and destroyed. Where is the data for an object and how is
the lifetime of the object controlled? There are different philosophies at work
here. C++ takes the approach that control of efficiency is the most important
issue, so it gives the programmer a choice. For maximum run-time speed, the
storage and lifetime can be determined while the program is being written, by
placing the objects on the stack (these are sometimes called <i>automatic</i>
or <i>scoped</i> variables) or in the static storage area. This places a
priority on the speed of storage allocation and release, and control of these
can be very valuable in some situations. However, you sacrifice flexibility
because you must know the exact quantity, lifetime, and type of objects while
you're writing the program. If you are trying to solve a more general problem
such as computer-aided design, warehouse management, or air-traffic control,
this is too restrictive.</span></p>

<p class=MsoNormal><span lang=EN-US>The second approach is to create objects
dynamically in a pool of memory called the heap. In this approach, you don't
know until run-time how many objects you need, what their lifetime is, or what
their exact type is. Those are determined at the spur of the moment while the
program is running. If you need a new object, you simply make it on the heap at
the point that you need it. Because the storage is managed dynamically, at
run-time, the amount of time required to allocate storage on the heap is
significantly longer than the time to create storage on the stack. (Creating
storage on the stack is often a single assembly instruction to move the stack
pointer down, and another to move it back up.) The dynamic approach makes the
generally logical assumption that objects tend to be complicated, so the extra
overhead of finding storage and releasing that storage will not have an
important impact on the creation of an object. In addition, the greater
flexibility is essential to solve the general programming problem.</span></p>

<p class=MsoNormal><span lang=EN-US>Java uses the second approach, exclusively</span><a
href="#_ftn7" name="_ftnref7" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[7]</span></span></span></span></a><span
lang=EN-US>. Every time you want to create an object, you use the <b>new</b>
keyword to build a dynamic instance of that object.</span></p>

<p class=MsoNormal><span lang=EN-US>There's another issue, however, and that's
the lifetime of an object. With languages that allow objects to be created on
the stack, the compiler determines how long the object lasts and can
automatically destroy it. However, if you create it on the heap the compiler
has no knowledge of its lifetime. In a language like C++, you must determine
programmatically when to destroy the object, which can lead to memory leaks if
you don’t do it correctly (and this is a common problem in C++ programs). Java
provides a feature called a garbage collector that automatically discovers when
an object is no longer in use and destroys it. A garbage collector is much more
convenient because it reduces the number of issues that you must track and the
code you must write. More important, the garbage collector provides a much
higher level of insurance against the insidious problem of memory leaks (which
has brought many a C++ project to its knees).</span></p>

<p class=MsoNormal><span lang=EN-US>The rest of this section looks at
additional factors concerning object lifetimes and landscapes.</span></p>

<h3><a name="_Toc481064476"><span lang=EN-US>Collections and iterators</span></a></h3>

<p class=MsoNormal><span lang=EN-US>If you don’t know how many objects you’re
going to need to solve a particular problem, or how long they will last, you
also don’t know how to store those objects. How can you know how much space to
create for those objects? You can’t, since that information isn’t known until
run-time.</span></p>

<p class=MsoNormal><span lang=EN-US>The solution to most problems in
object-oriented design seems flippant: you create another type of object. The
new type of object that solves this particular problem holds references to other
objects. Of course, you can do the same thing with an array, which is available
in most languages. But there’s more. This new object, generally called a <i>container</i>
(also called a <i>collection</i>, but the Java library uses that term in a
different sense so this book will use “container”), will expand itself whenever
necessary to accommodate everything you place inside it. So you don’t need to
know how many objects you’re going to hold in a container. Just create a
container object and let it take care of the details.</span></p>

<p class=MsoNormal><span lang=EN-US>Fortunately, a good OOP language comes with
a set of containers as part of the package. In C++, it’s part of the Standard
C++ Library and is sometimes called the Standard Template Library (STL). Object
Pascal has containers in its Visual Component Library (VCL). Smalltalk has a
very complete set of containers. Java also has containers in its standard
library. In some libraries, a generic container is considered good enough for
all needs, and in others (Java, for example) the library has different types of
containers for different needs: a vector (called an <b>ArrayList </b>in Java)
for consistent access to all elements, and a linked list for consistent
insertion at all elements, for example, so you can choose the particular type
that fits your needs. Container libraries may also include sets, queues, hash
tables, trees, stacks, etc.</span></p>

<p class=MsoNormal><span lang=EN-US>All containers have some way to put things
in and get things out; there are usually functions to add elements to a
container, and others to fetch those elements back out. But fetching elements
can be more problematic, because a single-selection function is restrictive.
What if you want to manipulate or compare a set of elements in the container
instead of just one?</span></p>

<p class=MsoNormal><span lang=EN-US>The solution is an iterator, which is an
object whose job is to select the elements within a container and present them
to the user of the iterator. As a class, it also provides a level of
abstraction. This abstraction can be used to separate the details of the
container from the code that’s accessing that container. The container, via the
iterator, is abstracted to be simply a sequence. The iterator allows you to
traverse that sequence without worrying about the underlying structure—that is,
whether it’s an <b>ArrayList</b>, a <b>LinkedList</b>, a <b>Stack</b>, or
something else. This gives you the flexibility to easily change the underlying
data structure without disturbing the code in your program. Java began (in
version 1.0 and 1.1) with a standard iterator, called <b>Enumeration</b>, for
all of its container classes. Java 2 has added a much more complete container
library that contains an iterator called <b>Iterator</b> that does more than
the older <b>Enumeration</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>From a design standpoint, all you really
want is a sequence that can be manipulated to solve your problem. If a single
type of sequence satisfied all of your needs, there’d be no reason to have
different kinds. There are two reasons that you need a choice of containers.
First, containers provide different types of interfaces and external behavior.
A stack has a different interface and behavior than that of a queue, which is
different from that of a set or a list. One of these might provide a more
flexible solution to your problem than the other. Second, different containers
have different efficiencies for certain operations. The best example is an <b>ArrayList</b>
and a <b>LinkedList</b>. Both are simple sequences that can have identical
interfaces and external behaviors. But certain operations can have radically
different costs. Randomly accessing elements in an <b>ArrayList</b> is a
constant-time operation; it takes the same amount of time regardless of the
element you select. However, in a <b>LinkedList</b> it is expensive to move
through the list to randomly select an element, and it takes longer to find an
element that is further down the list. On the other hand, if you want to insert
an element in the middle of a sequence, it’s much cheaper in a <b>LinkedList </b>than
in an <b>ArrayList</b>. These and other operations have different efficiencies
depending on the underlying structure of the sequence. In the design phase, you
might start with a <b>LinkedList</b> and, when tuning for performance, change
to an <b>ArrayList</b>. Because of the abstraction via iterators, you can
change from one to the other with minimal impact on your code.</span></p>

<p class=MsoNormal><span lang=EN-US>In the end, remember that a container is
only a storage cabinet to put objects in. If that cabinet solves all of your
needs, it doesn’t really matter how it is implemented (a basic concept with
most types of objects). If you’re working in a programming environment that has
built-in overhead due to other factors, then the cost difference between an <b>ArrayList</b>
and a <b>LinkedList</b> might not matter. You might need only one type of
sequence. You can even imagine the “perfect” container abstraction, which can
automatically change its underlying implementation according to the way it is
used.</span></p>

<h3><a name="_Toc481064477"><span lang=EN-US>The singly rooted hierarchy</span></a></h3>

<p class=MsoNormal><span lang=EN-US>One of the issues in OOP that has become
especially prominent since the introduction of C++ is whether all classes
should ultimately be inherited from a single base class. In Java (as with
virtually all other OOP languages) the answer is “yes” and the name of this
ultimate base class is simply <b>Object</b>. It turns out that the benefits of
the singly rooted hierarchy are many.</span></p>

<p class=MsoNormal><span lang=EN-US>All objects in a singly rooted hierarchy
have an interface in common, so they are all ultimately the same type. The
alternative (provided by C++) is that you don’t know that everything is the
same fundamental type. From a backward-compatibility standpoint this fits the
model of C better and can be thought of as less restrictive, but when you want
to do full-on object-oriented programming you must then build your own
hierarchy to provide the same convenience that’s built into other OOP
languages. And in any new class library you acquire, some other incompatible
interface will be used. It requires effort (and possibly multiple inheritance)
to work the new interface into your design. Is the extra “flexibility” of C++
worth it? If you need it—if you have a large investment in C—it’s quite
valuable. If you’re starting from scratch, other alternatives such as Java can
often be more productive.</span></p>

<p class=MsoNormal><span lang=EN-US>All objects in a singly rooted hierarchy
(such as Java provides) can be guaranteed to have certain functionality. You
know you can perform certain basic operations on every object in your system. A
singly rooted hierarchy, along with creating all objects on the heap, greatly
simplifies argument passing (one of the more complex topics in C++).</span></p>

<p class=MsoNormal><span lang=EN-US>A singly rooted hierarchy makes it much
easier to implement a garbage collector (which is conveniently built into
Java). The necessary support can be installed in the base class, and the
garbage collector can thus send the appropriate messages to every object in the
system. Without a singly rooted hierarchy and a system to manipulate an object
via a reference, it is difficult to implement a garbage collector.</span></p>

<p class=MsoNormal><span lang=EN-US>Since run-time type information is
guaranteed to be in all objects, you’ll never end up with an object whose type
you cannot determine. This is especially important with system level
operations, such as exception handling, and to allow greater flexibility in
programming.</span></p>

<h3><a name="_Toc481064478"><span lang=EN-US>Collection libraries and support
for easy collection use</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Because a container is a tool that you’ll
use frequently, it makes sense to have a library of containers that are built
in a reusable fashion, so you can take one off the shelf and plug it into your
program. Java provides such a library, which should satisfy most needs.</span></p>

<h4><span lang=EN-US>Downcasting vs. templates/generics</span></h4>

<p class=MsoNormal><span lang=EN-US>To make these containers reusable, they
hold the one universal type in Java that was previously mentioned: <b>Object</b>.
The singly rooted hierarchy means that everything is an <b>Object</b>, so a
container that holds <b>Object</b>s can hold anything. This makes containers
easy to reuse.</span></p>

<p class=MsoNormal><span lang=EN-US>To use such a container, you simply add
object references to it, and later ask for them back. But, since the container
holds only <b>Object</b>s, when you add your object reference into the
container it is upcast to <b>Object</b>, thus losing its identity. When you
fetch it back, you get an <b>Object</b> reference, and not a reference to the
type that you put in. So how do you turn it back into something that has the
useful interface of the object that you put into the container?</span></p>

<p class=MsoNormal><span lang=EN-US>Here, the cast is used again, but this time
you’re not casting up the inheritance hierarchy to a more general type, you
cast down the hierarchy to a more specific type. This manner of casting is
called downcasting. With upcasting, you know, for example, that a <b>Circle</b>
is a type of <b>Shape</b> so it’s safe to upcast, but you don’t know that an <b>Object</b>
is necessarily a <b>Circle</b> or a <b>Shape</b> so it’s hardly safe to
downcast unless you know that’s what you’re dealing with.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s not completely dangerous, however,
because if you downcast to the wrong thing you’ll get a run-time error called
an <i>exception,</i> which will be described shortly. When you fetch object
references from a container, though, you must have some way to remember exactly
what they are so you can perform a proper downcast.</span></p>

<p class=MsoNormal><span lang=EN-US>Downcasting and the run-time checks require
extra time for the running program, and extra effort from the programmer.
Wouldn’t it make sense to somehow create the container so that it knows the
types that it holds, eliminating the need for the downcast and a possible
mistake? The solution is parameterized types, which are classes that the
compiler can automatically customize to work with particular types. For
example, with a parameterized container, the compiler could customize that
container so that it would accept only Shapes and fetch only Shapes.</span></p>

<p class=MsoNormal><span lang=EN-US>Parameterized types are an important part
of C++, partly because C++ has no singly rooted hierarchy. In C++, the keyword
that implements parameterized types is “template.” Java currently has no
parameterized types since it is possible for it to get by—however
awkwardly—using the singly rooted hierarchy. However, a current proposal for
parameterized types uses a syntax that is strikingly similar to C++ templates.</span></p>

<h3><a name="_Toc481064479"><span lang=EN-US>The housekeeping dilemma: who
should clean up?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Each object requires resources in order to
exist, most notably memory. When an object is no longer needed it must be
cleaned up so that these resources are released for reuse. In simple
programming situations the question of how an object is cleaned up doesn’t seem
too challenging: you create the object, use it for as long as it’s needed, and
then it should be destroyed. It’s not hard, however, to encounter situations in
which the situation is more complex.</span></p>

<p class=MsoNormal><span lang=EN-US>Suppose, for example, you are designing a
system to manage air traffic for an airport. (The same model might also work
for managing crates in a warehouse, or a video rental system, or a kennel for
boarding pets.) At first it seems simple: make a container to hold airplanes,
then create a new airplane and place it in the container for each airplane that
enters the air-traffic-control zone. For cleanup, simply delete the appropriate
airplane object when a plane leaves the zone.</span></p>

<p class=MsoNormal><span lang=EN-US>But perhaps you have some other system to
record data about the planes; perhaps data that doesn’t require such immediate
attention as the main controller function. Maybe it’s a record of the flight
plans of all the small planes that leave the airport. So you have a second
container of small planes, and whenever you create a plane object you also put
it in this second container if it’s a small plane. Then some background process
performs operations on the objects in this container during idle moments.</span></p>

<p class=MsoNormal><span lang=EN-US>Now the problem is more difficult: how can
you possibly know when to destroy the objects? When you’re done with the
object, some other part of the system might not be. This same problem can arise
in a number of other situations, and in programming systems (such as C++) in
which you must explicitly delete an object when you’re done with it this can
become quite complex.</span></p>

<p class=MsoNormal><span lang=EN-US>With Java, the garbage collector is
designed to take care of the problem of releasing the memory (although this
doesn’t include other aspects of cleaning up an object). The garbage collector
“knows” when an object is no longer in use, and it then automatically releases
the memory for that object. This (combined with the fact that all objects are
inherited from the single root class <b>Object</b> and that you can create
objects only one way, on the heap) makes the process of programming in Java
much simpler than programming in C++. You have far fewer decisions to make and
hurdles to overcome.</span></p>

<h4><span lang=EN-US>Garbage collectors vs. efficiency and flexibility</span></h4>

<p class=MsoNormal><span lang=EN-US>If all this is such a good idea, why didn’t
they do the same thing in C++? Well of course there’s a price you pay for all
this programming convenience, and that price is run-time overhead. As mentioned
before, in C++ you can create objects on the stack, and in this case they’re
automatically cleaned up (but you don’t have the flexibility of creating as
many as you want at run-time). Creating objects on the stack is the most
efficient way to allocate storage for objects and to free that storage.
Creating objects on the heap can be much more expensive. Always inheriting from
a base class and making all function calls polymorphic also exacts a small
toll. But the garbage collector is a particular problem because you never quite
know when it’s going to start up or how long it will take. This means that
there’s an inconsistency in the rate of execution of a Java program, so you
can’t use it in certain situations, such as when the rate of execution of a
program is uniformly critical. (These are generally called real time programs,
although not all real time programming problems are this stringent.)</span></p>

<p class=MsoNormal><span lang=EN-US>The designers of the C++ language, trying
to woo C programmers (and most successfully, at that), did not want to add any
features to the language that would impact the speed or the use of C++ in any
situation where programmers might otherwise choose C. This goal was realized,
but at the price of greater complexity when programming in C++. Java is simpler
than C++, but the trade-off is in efficiency and sometimes applicability. For a
significant portion of programming problems, however, Java is the superior
choice.</span></p>

<h2><a name="_Toc481064480"><span lang=EN-US>Exception handling: dealing with
errors</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Ever since the beginning of programming
languages, error handling has been one of the most difficult issues. Because
it’s so hard to design a good error handling scheme, many languages simply
ignore the issue, passing the problem on to library designers who come up with
halfway measures that can work in many situations but can easily be
circumvented, generally by just ignoring them. A major problem with most error
handling schemes is that they rely on programmer vigilance in following an
agreed-upon convention that is not enforced by the language. If the programmer
is not vigilant—often the case if they are in a hurry—these schemes can easily
be forgotten.</span></p>

<p class=MsoNormal><span lang=EN-US>Exception handling wires error handling
directly into the programming language and sometimes even the operating system.
An exception is an object that is “thrown” from the site of the error and can
be “caught” by an appropriate exception handler designed to handle that
particular type of error. It’s as if exception handling is a different,
parallel path of execution that can be taken when things go wrong. And because
it uses a separate execution path, it doesn’t need to interfere with your
normally executing code. This makes that code simpler to write since you aren’t
constantly forced to check for errors. In addition, a thrown exception is
unlike an error value that’s returned from a function or a flag that’s set by a
function in order to indicate an error condition—these can be ignored. An
exception cannot be ignored, so it’s guaranteed to be dealt with at some point.
Finally, exceptions provide a way to reliably recover from a bad situation.
Instead of just exiting you are often able to set things right and restore the
execution of a program, which produces much more robust programs.</span></p>

<p class=MsoNormal><span lang=EN-US>Java’s exception handling stands out among
programming languages, because in Java, exception handling was wired in from
the beginning and you’re forced to use it. If you don’t write your code to
properly handle exceptions, you’ll get a compile-time error message. This
guaranteed consistency makes error handling much easier.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s worth noting that exception handling
isn’t an object-oriented feature, although in object-oriented languages the
exception is normally represented with an object. Exception handling existed
before object-oriented languages.</span></p>

<h2><a name="_Toc481064481"><span lang=EN-US>Multithreading</span></a></h2>

<p class=MsoNormal><span lang=EN-US>A fundamental concept in computer
programming is the idea of handling more than one task at a time. Many
programming problems require that the program be able to stop what it’s doing,
deal with some other problem, and then return to the main process. The solution
has been approached in many ways. Initially, programmers with low-level
knowledge of the machine wrote interrupt service routines and the suspension of
the main process was initiated through a hardware interrupt. Although this
worked well, it was difficult and nonportable, so it made moving a program to a
new type of machine slow and expensive. </span></p>

<p class=MsoNormal><span lang=EN-US>Sometimes interrupts are necessary for
handling time-critical tasks, but there’s a large class of problems in which
you’re simply trying to partition the problem into separately running pieces so
that the whole program can be more responsive. Within a program, these
separately running pieces are called threads, and the general concept is called
<i>multithreading.</i> A common example of multithreading is the user
interface. By using threads, a user can press a button and get a quick response
rather than being forced to wait until the program finishes its current task.</span></p>

<p class=MsoNormal><span lang=EN-US>Ordinarily, threads are just a way to
allocate the time of a single processor. But if the operating system supports
multiple processors, each thread can be assigned to a different processor and
they can truly run in parallel. One of the convenient features of
multithreading at the language level is that the programmer doesn’t need to
worry about whether there are many processors or just one. The program is
logically divided into threads and if the machine has more than one processor
then the program runs faster, without any special adjustments.</span></p>

<p class=MsoNormal><span lang=EN-US>All this makes threading sound pretty
simple. There is a catch: shared resources. If you have more than one thread
running that’s expecting to access the same resource you have a problem. For
example, two processes can’t simultaneously send information to a printer. To
solve the problem, resources that can be shared, such as the printer, must be
locked while they are being used. So a thread locks a resource, completes its
task, and then releases the lock so that someone else can use the resource.</span></p>

<p class=MsoNormal><span lang=EN-US>Java’s threading is built into the
language, which makes a complicated subject much simpler. The threading is
supported on an object level, so one thread of execution is represented by one
object. Java also provides limited resource locking. It can lock the memory of
any object (which is, after all, one kind of shared resource) so that only one
thread can use it at a time. This is accomplished with the </span><span lang=EN-US><b>synchronized</b> keyword. Other types of resources must be locked
explicitly by the programmer, typically by creating an object to represent the
lock that all threads must check before accessing that resource.</span></p>

<h2><a name="_Toc481064482"><span lang=EN-US>Persistence</span></a></h2>

<p class=MsoNormal><span lang=EN-US>When you create an object, it exists for as
long as you need it, but under no circumstances does it exist when the program
terminates. While this makes sense at first, there are situations in which it
would be incredibly useful if an object could exist and hold its information
even while the program wasn’t running. Then the next time you started the
program, the object would be there and it would have the same information it
had the previous time the program was running. Of course, you can get a similar
effect by writing the information to a file or to a database, but in the spirit
of making everything an object it would be quite convenient to be able to
declare an object persistent and have all the details taken care of for you.</span></p>

<p class=MsoNormal><span lang=EN-US>Java provides support for “lightweight
persistence,” which means that you can easily store objects on disk and later
retrieve them. The reason it’s “lightweight” is that you’re still forced to
make explicit calls to do the storage and retrieval. In addition, JavaSpaces
(described in Chapter 15) provide for a kind of persistent storage of objects.
In some future release more complete support for persistence might appear.</span></p>

<h2><a name="_Toc481064483"><span lang=EN-US>Java and the Internet</span></a></h2>

<p class=MsoNormal><span lang=EN-US>If Java is, in fact, yet another computer
programming language, you may question why it is so important and why it is
being promoted as a revolutionary step in computer programming. The answer
isn’t immediately obvious if you’re coming from a traditional programming
perspective. Although Java is very useful for solving traditional stand-alone
programming problems, it is also important because it will solve programming
problems on the World Wide Web.</span></p>

<h3><a name="_Toc481064484"><span lang=EN-US>What is the Web?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The Web can seem a bit of a mystery at
first, with all this talk of “surfing,” “presence,” and “home pages.” There has
even been a growing reaction against “Internet-mania,” questioning the economic
value and outcome of such a sweeping movement. It’s helpful to step back and
see what it really is, but to do this you must understand client/server
systems, another aspect of computing that’s full of confusing issues.</span></p>

<h4><span lang=EN-US>Client/Server computing</span></h4>

<p class=MsoNormal><span lang=EN-US>The primary idea of a client/server system
is that you have a central repository of information—some kind of data, often
in a database—that you want to distribute on demand to some set of people or
machines. A key to the client/server concept is that the repository of
information is centrally located so that it can be changed and so that those
changes will propagate out to the information consumers. Taken together, the
information repository, the software that distributes the information, and the
machine(s) where the information and software reside is called the server. The
software that resides on the remote machine, communicates with the server,
fetches the information, processes it, and then displays it on the remote
machine is called the <i>client.</i></span></p>

<p class=MsoNormal><span lang=EN-US>The basic concept of client/server
computing, then, is not so complicated. The problems arise because you have a
single server trying to serve many clients at once. Generally, a database
management system is involved so the designer “balances” the layout of data
into tables for optimal use. In addition, systems often allow a client to
insert new information into a server. This means you must ensure that one
client’s new data doesn’t walk over another client’s new data, or that data
isn’t lost in the process of adding it to the database. (This is called
transaction processing.) As client software changes, it must be built,
debugged, and installed on the client machines, which turns out to be more
complicated and expensive than you might think. It’s especially problematic to
support multiple types of computers and operating systems. Finally, there’s the
all-important performance issue: you might have hundreds of clients making
requests of your server at any one time, and so any small delay is crucial. To
minimize latency, programmers work hard to offload processing tasks, often to
the client machine, but sometimes to other machines at the server site, using
so-called <i>middleware.</i> (Middleware is also used to improve maintainability.)</span></p>

<p class=MsoNormal><span lang=EN-US>The simple idea of distributing information
to people has so many layers of complexity in implementing it that the whole
problem can seem hopelessly enigmatic. And yet it’s crucial: client/server
computing accounts for roughly half of all programming activities. It’s
responsible for everything from taking orders and credit-card transactions to
the distribution of any kind of data—stock market, scientific, government, you
name it. What we’ve come up with in the past is individual solutions to individual
problems, inventing a new solution each time. These were hard to create and
hard to use, and the user had to learn a new interface for each one. The entire
client/server problem needs to be solved in a big way.</span></p>

<h4><span lang=EN-US>The Web as a giant server</span></h4>

<p class=MsoNormal><span lang=EN-US>The Web is actually one giant client/server
system. It’s a bit worse than that, since you have all the servers and clients
coexisting on a single network at once. You don’t need to know that, since all
you care about is connecting to and interacting with one server at a time (even
though you might be hopping around the world in your search for the correct
server).</span></p>

<p class=MsoNormal><span lang=EN-US>Initially it was a simple one-way process.
You made a request of a server and it handed you a file, which your machine’s
browser software (i.e., the client) would interpret by formatting onto your
local machine. But in short order people began wanting to do more than just
deliver pages from a server. They wanted full client/server capability so that
the client could feed information back to the server, for example, to do
database lookups on the server, to add new information to the server, or to
place an order (which required more security than the original systems
offered). These are the changes we’ve been seeing in the development of the
Web.</span></p>

<p class=MsoNormal><span lang=EN-US>The Web browser was a big step forward: the
concept that one piece of information could be displayed on any type of
computer without change. However, browsers were still rather primitive and
rapidly bogged down by the demands placed on them. They weren’t particularly
interactive, and tended to clog up both the server and the Internet because any
time you needed to do something that required programming you had to send
information back to the server to be processed. It could take many seconds or
minutes to find out you had misspelled something in your request. Since the
browser was just a viewer it couldn’t perform even the simplest computing
tasks. (On the other hand, it was safe, since it couldn’t execute any programs
on your local machine that might contain bugs or viruses.)</span></p>

<p class=MsoNormal><span lang=EN-US>To solve this problem, different approaches
have been taken. To begin with, graphics standards have been enhanced to allow
better animation and video within browsers. The remainder of the problem can be
solved only by incorporating the ability to run programs on the client end,
under the browser. This is called client-side programming.</span></p>

<h3><a name="_Toc481064485"><span lang=EN-US>Client-side programming</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The Web’s initial server-browser design
provided for interactive content, but the interactivity was completely provided
by the server. The server produced static pages for the client browser, which
would simply interpret and display them. Basic HTML contains simple mechanisms
for data gathering: text-entry boxes, check boxes, radio boxes, lists and
drop-down lists, as well as a button that can only be programmed to reset the
data on the form or “submit” the data on the form back to the server. This
submission passes through the Common Gateway Interface (CGI) provided on all
Web servers. The text within the submission tells CGI what to do with it. The most
common action is to run a program located on the server in a directory that’s
typically called “cgi-bin.” (If you watch the address window at the top of your
browser when you push a button on a Web page, you can sometimes see “cgi-bin”
within all the gobbledygook there.) These programs can be written in most
languages. Perl is a common choice because it is designed for text manipulation
and is interpreted, so it can be installed on any server regardless of
processor or operating system.</span></p>

<p class=MsoNormal><span lang=EN-US>Many powerful Web sites today are built
strictly on CGI, and you can in fact do nearly anything with it. However, Web
sites built on CGI programs can rapidly become overly complicated to maintain,
and there is also the problem of response time. The response of a CGI program
depends on how much data must be sent, as well as the load on both the server
and the Internet. (On top of this, starting a CGI program tends to be slow.)
The initial designers of the Web did not foresee how rapidly this bandwidth
would be exhausted for the kinds of applications people developed. For example,
any sort of dynamic graphing is nearly impossible to perform with consistency
because a GIF file must be created and moved from the server to the client for
each version of the graph. And you’ve no doubt had direct experience with
something as simple as validating the data on an input form. You press the
submit button on a page; the data is shipped back to the server; the server
starts a CGI program that discovers an error, formats an HTML page informing
you of the error, and then sends the page back to you; you must then back up a
page and try again. Not only is this slow, it’s inelegant.</span></p>

<p class=MsoNormal><span lang=EN-US>The solution is client-side programming.
Most machines that run Web browsers are powerful engines capable of doing vast
work, and with the original static HTML approach they are sitting there, just
idly waiting for the server to dish up the next page. Client-side programming
means that the Web browser is harnessed to do whatever work it can, and the
result for the user is a much speedier and more interactive experience at your
Web site.</span></p>

<p class=MsoNormal><span lang=EN-US>The problem with discussions of client-side
programming is that they aren’t very different from discussions of programming
in general. The parameters are almost the same, but the platform is different:
a Web browser is like a limited operating system. In the end, you must still
program, and this accounts for the dizzying array of problems and solutions
produced by client-side programming. The rest of this section provides an
overview of the issues and approaches in client-side programming.</span></p>

<h4><span lang=EN-US>Plug-ins</span></h4>

<p class=MsoNormal><span lang=EN-US>One of the most significant steps forward
in client-side programming is the development of the plug-in. This is a way for
a programmer to add new functionality to the browser by downloading a piece of
code that plugs itself into the appropriate spot in the browser. It tells the
browser “from now on you can perform this new activity.” (You need to download
the plug-in only once.) Some fast and powerful behavior is added to browsers
via plug-ins, but writing a plug-in is not a trivial task, and isn’t something
you’d want to do as part of the process of building a particular site. The
value of the plug-in for client-side programming is that it allows an expert
programmer to develop a new language and add that language to a browser without
the permission of the browser manufacturer. Thus, plug-ins provide a “back
door” that allows the creation of new client-side programming languages
(although not all languages are implemented as plug-ins).</span></p>

<h4><span lang=EN-US>Scripting languages</span></h4>

<p class=MsoNormal><span lang=EN-US>Plug-ins resulted in an explosion of
scripting languages. With a scripting language you embed the source code for
your client-side program directly into the HTML page, and the plug-in that
interprets that language is automatically activated while the HTML page is
being displayed. Scripting languages tend to be reasonably easy to understand
and, because they are simply text that is part of an HTML page, they load very
quickly as part of the single server hit required to procure that page. The trade-off
is that your code is exposed for everyone to see (and steal). Generally,
however, you aren’t doing amazingly sophisticated things with scripting
languages so this is not too much of a hardship.</span></p>

<p class=MsoNormal><span lang=EN-US>This points out that the scripting
languages used inside Web browsers are really intended to solve specific types
of problems, primarily the creation of richer and more interactive graphical
user interfaces (GUIs). However, a scripting language might solve 80 percent of
the problems encountered in client-side programming. Your problems might very
well fit completely within that 80 percent, and since scripting languages can
allow easier and faster development, you should probably consider a scripting
language before looking at a more involved solution such as Java or ActiveX
programming.</span></p>

<p class=MsoNormal><span lang=EN-US>The most commonly discussed browser
scripting languages are JavaScript (which has nothing to do with Java; it’s
named that way just to grab some of Java’s marketing momentum), VBScript (which
looks like Visual Basic), and Tcl/Tk, which comes from the popular
cross-platform GUI-building language. There are others out there, and no doubt
more in development.</span></p>

<p class=MsoNormal><span lang=EN-US>JavaScript is probably the most commonly
supported. It comes built into both Netscape Navigator and the Microsoft
Internet Explorer (IE). In addition, there are probably more JavaScript books
available than there are for the other browser languages, and some tools
automatically create pages using JavaScript. However, if you’re already fluent
in Visual Basic or Tcl/Tk, you’ll be more productive using those scripting
languages rather than learning a new one. (You’ll have your hands full dealing
with the Web issues already.) </span></p>

<h4><span lang=EN-US>Java</span></h4>

<p class=MsoNormal><span lang=EN-US>If a scripting language can solve 80
percent of the client-side programming problems, what about the other 20
percent—the “really hard stuff?” The most popular solution today is Java. Not
only is it a powerful programming language built to be secure, cross-platform,
and international, but Java is being continually extended to provide language
features and libraries that elegantly handle problems that are difficult in
traditional programming languages, such as multithreading, database access,
network programming, and distributed computing. Java allows client-side
programming via the <i>applet</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>An applet is a mini-program that will run
only under a Web browser. The applet is downloaded automatically as part of a
Web page (just as, for example, a graphic is automatically downloaded). When
the applet is activated it executes a program. This is part of its beauty—it provides
you with a way to automatically distribute the client software from the server
at the time the user needs the client software, and no sooner. The user gets
the latest version of the client software without fail and without difficult
reinstallation. Because of the way Java is designed, the programmer needs to
create only a single program, and that program automatically works with all
computers that have browsers with built-in Java interpreters. (This safely
includes the vast majority of machines.) Since Java is a full-fledged
programming language, you can do as much work as possible on the client before
and after making requests of the server. For example, you won’t need to send a
request form across the Internet to discover that you’ve gotten a date or some
other parameter wrong, and your client computer can quickly do the work of
plotting data instead of waiting for the server to make a plot and ship a
graphic image back to you. Not only do you get the immediate win of speed and
responsiveness, but the general network traffic and load on servers can be
reduced, preventing the entire Internet from slowing down.</span></p>

<p class=MsoNormal><span lang=EN-US>One advantage a Java applet has over a
scripted program is that it’s in compiled form, so the source code isn’t
available to the client. On the other hand, a Java applet can be decompiled
without too much trouble, but hiding your code is often not an important issue.
Two other factors can be important. As you will see later in this book, a
compiled Java applet can comprise many modules and take multiple server “hits”
(accesses) to download. (In Java 1.1 and higher this is minimized by Java
archives, called JAR files, that allow all the required modules to be packaged
together and compressed for a single download.) A scripted program will just be
integrated into the Web page as part of its text (and will generally be smaller
and reduce server hits). This could be important to the responsiveness of your
Web site. Another factor is the all-important learning curve. Regardless of
what you’ve heard, Java is not a trivial language to learn. If you’re a Visual
Basic programmer, moving to VBScript will be your fastest solution, and since
it will probably solve most typical client/server problems you might be hard
pressed to justify learning Java. If you’re experienced with a scripting
language you will certainly benefit from looking at JavaScript or VBScript
before committing to Java, since they might fit your needs handily and you’ll
be more productive sooner.</span></p>

<h4><span lang=EN-US>ActiveX</span></h4>

<p class=MsoNormal><span lang=EN-US>To some degree, the competitor to Java is
Microsoft’s ActiveX, although it takes a completely different approach. ActiveX
was originally a Windows-only solution, although it is now being developed via
an independent consortium to become cross-platform. Effectively, ActiveX says
“if your program connects to its environment just so, it can be dropped into a
Web page and run under a browser that supports ActiveX.” (IE directly supports
ActiveX and Netscape does so using a plug-in.) Thus, ActiveX does not constrain
you to a particular language. If, for example, you’re already an experienced
Windows programmer using a language such as C++, Visual Basic, or Borland’s
Delphi, you can create ActiveX components with almost no changes to your
programming knowledge. ActiveX also provides a path for the use of legacy code
in your Web pages.</span></p>

<h4><span lang=EN-US>Security</span></h4>

<p class=MsoNormal><span lang=EN-US>Automatically downloading and running
programs across the Internet can sound like a virus-builder’s dream. ActiveX
especially brings up the thorny issue of security in client-side programming.
If you click on a Web site, you might automatically download any number of
things along with the HTML page: GIF files, script code, compiled Java code,
and ActiveX components. Some of these are benign; GIF files can’t do any harm,
and scripting languages are generally limited in what they can do. Java was
also designed to run its applets within a “sandbox” of safety, which prevents
it from writing to disk or accessing memory outside the sandbox. </span></p>

<p class=MsoNormal><span lang=EN-US>ActiveX is at the opposite end of the
spectrum. Programming with ActiveX is like programming Windows—you can do
anything you want. So if you click on a page that downloads an ActiveX
component, that component might cause damage to the files on your disk. Of
course, programs that you load onto your computer that are not restricted to running
inside a Web browser can do the same thing. Viruses downloaded from
Bulletin-Board Systems (BBSs) have long been a problem, but the speed of the
Internet amplifies the difficulty.</span></p>

<p class=MsoNormal><span lang=EN-US>The solution seems to be “digital
signatures,” whereby code is verified to show who the author is. This is based
on the idea that a virus works because its creator can be anonymous, so if you
remove the anonymity individuals will be forced to be responsible for their
actions. This seems like a good plan because it allows programs to be much more
functional, and I suspect it will eliminate malicious mischief. If, however, a
program has an unintentional destructive bug it will still cause problems.</span></p>

<p class=MsoNormal><span lang=EN-US>The Java approach is to prevent these
problems from occurring, via the sandbox. The Java interpreter that lives on
your local Web browser examines the applet for any untoward instructions as the
applet is being loaded. In particular, the applet cannot write files to disk or
erase files (one of the mainstays of viruses). Applets are generally considered
to be safe, and since this is essential for reliable client/server systems, any
bugs in the Java language that allow viruses are rapidly repaired. (It’s worth
noting that the browser software actually enforces these security restrictions,
and some browsers allow you to select different security levels to provide
varying degrees of access to your system.)</span></p>

<p class=MsoNormal><span lang=EN-US>You might be skeptical of this rather
draconian restriction against writing files to your local disk. For example,
you may want to build a local database or save data for later use offline. The
initial vision seemed to be that eventually everyone would get online to do
anything important, but that was soon seen to be impractical (although low-cost
“Internet appliances” might someday satisfy the needs of a significant segment
of users). The solution is the “signed applet” that uses public-key encryption
to verify that an applet does indeed come from where it claims it does. A
signed applet can still trash your disk, but the theory is that since you can
now hold the applet creator accountable they won’t do vicious things. Java
provides a framework for digital signatures so that you will eventually be able
to allow an applet to step outside the sandbox if necessary.</span></p>

<p class=MsoNormal><span lang=EN-US>Digital signatures have missed an important
issue, which is the speed that people move around on the Internet. If you
download a buggy program and it does something untoward, how long will it be
before you discover the damage? It could be days or even weeks. By then, how
will you track down the program that’s done it? And what good will it do you at
that point?</span></p>

<h4><span lang=EN-US>Internet vs. intranet</span></h4>

<p class=MsoNormal><span lang=EN-US>The Web is the most general solution to the
client/server problem, so it makes sense that you can use the same technology
to solve a subset of the problem, in particular the classic client/server
problem <i>within</i> a company. With traditional client/server approaches you
have the problem of multiple types of client computers, as well as the
difficulty of installing new client software, both of which are handily solved
with Web browsers and client-side programming. When Web technology is used for
an information network that is restricted to a particular company, it is
referred to as an intranet. Intranets provide much greater security than the
Internet, since you can physically control access to the servers within your
company. In terms of training, it seems that once people understand the general
concept of a browser it’s much easier for them to deal with differences in the
way pages and applets look, so the learning curve for new kinds of systems
seems to be reduced.</span></p>

<p class=MsoNormal><span lang=EN-US>The security problem brings us to one of
the divisions that seems to be automatically forming in the world of
client-side programming. If your program is running on the Internet, you don’t
know what platform it will be working under, and you want to be extra careful
that you don’t disseminate buggy code. You need something cross-platform and
secure, like a scripting language or Java. </span></p>

<p class=MsoNormal><span lang=EN-US>If you’re running on an intranet, you might
have a different set of constraints. It’s not uncommon that your machines could
all be Intel/Windows platforms. On an intranet, you’re responsible for the
quality of your own code and can repair bugs when they’re discovered. In
addition, you might already have a body of legacy code that you’ve been using
in a more traditional client/server approach, whereby you must physically
install client programs every time you do an upgrade. The time wasted in
installing upgrades is the most compelling reason to move to browsers, because
upgrades are invisible and automatic. If you are involved in such an intranet,
the most sensible approach to take is the shortest path that allows you to use
your existing code base, rather than trying to recode your programs in a new
language.</span></p>

<p class=MsoNormal><span lang=EN-US>When faced with this bewildering array of
solutions to the client-side programming problem, the best plan of attack is a
cost-benefit analysis. Consider the constraints of your problem and what would
be the shortest path to your solution. Since client-side programming is still
programming, it’s always a good idea to take the fastest development approach
for your particular situation. This is an aggressive stance to prepare for
inevitable encounters with the problems of program development.</span></p>

<h3><a name="_Toc481064486"><span lang=EN-US>Server-side programming</span></a></h3>

<p class=MsoNormal><span lang=EN-US>This whole discussion has ignored the issue
of server-side programming. What happens when you make a request of a server?
Most of the time the request is simply “send me this file.” Your browser then
interprets the file in some appropriate fashion: as an HTML page, a graphic
image, a Java applet, a script program, etc. A more complicated request to a
server generally involves a database transaction. A common scenario involves a
request for a complex database search, which the server then formats into an
HTML page and sends to you as the result. (Of course, if the client has more
intelligence via Java or a scripting language, the raw data can be sent and
formatted at the client end, which will be faster and less load on the server.)
Or you might want to register your name in a database when you join a group or
place an order, which will involve changes to that database. These database
requests must be processed via some code on the server side, which is generally
referred to as server-side programming. Traditionally, server-side programming
has been performed using Perl and CGI scripts, but more sophisticated systems
have been appearing. These include Java-based Web servers that allow you to
perform all your server-side programming in Java by writing what are called servlets.
Servlets and their offspring, JSPs, are two of the most compelling reasons that
companies who develop Web sites are moving to Java, especially because they
eliminate the problems of dealing with differently abled browsers. </span></p>

<h3><a name="_Toc481064487"><span lang=EN-US>A separate arena: applications</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Much of the brouhaha over Java has been
over applets. Java is actually a general-purpose programming language that can
solve any type of problem—at least in theory. And as pointed out previously,
there might be more effective ways to solve most client/server problems. When
you move out of the applet arena (and simultaneously release the restrictions,
such as the one against writing to disk) you enter the world of general-purpose
applications that run standalone, without a Web browser, just like any ordinary
program does. Here, Java’s strength is not only in its portability, but also
its programmability. As you’ll see throughout this book, Java has many features
that allow you to create robust programs in a shorter period than with previous
programming languages.</span></p>

<p class=MsoNormal><span lang=EN-US>Be aware that this is a mixed blessing. You
pay for the improvements through slower execution speed (although there is
significant work going on in this area—JDK 1.3, in particular, introduces the
so-called “hotspot” performance improvements). Like any language, Java has
built-in limitations that might make it inappropriate to solve certain types of
programming problems. Java is a rapidly evolving language, however, and as each
new release comes out it becomes more and more attractive for solving larger
sets of problems.</span></p>

<h2><a name="_Toc481064488"></a><a name="_Toc472654691"><span lang=EN-US>Analysis
and design</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The object-oriented paradigm is a new and different way of thinking
about programming. Many folks have trouble at first knowing how to approach an
OOP project. Once you know that everything is supposed to be an object, and as
you learn to think more in an object-oriented style, you can begin to create
“good” designs that take advantage of all the benefits that OOP has to offer.</span></p>

<p class=MsoNormal><span
lang=EN-US>A <i>method</i> (often called a <i>methodology</i>)<i> </i>is a set
of processes and heuristics used to break down the complexity of a programming
problem. Many OOP methods have been formulated since the dawn of
object-oriented programming. This section will give you a feel for what you’re
trying to accomplish when using a method.</span></p>

<p class=MsoNormal><span lang=EN-US>Especially in OOP, methodology is a field
of many experiments, so it is important to understand what problem the method
is trying to solve before you consider adopting one. This is particularly true
with Java, in which the programming language is intended to reduce the
complexity (compared to C) involved in expressing a program. This may in fact
alleviate the need for ever-more-complex methodologies. Instead, simple
methodologies may suffice in Java for a much larger class of problems than you
could handle using simple methodologies with procedural languages.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s also important to realize that the
term “methodology” is often too grand and promises too much. Whatever you do
now when you design and write a program is a method. It may be your own method,
and you may not be conscious of doing it, but it is a process you go through as
you create. If it is an effective process, it may need only a small tune-up to
work with Java. If you are not satisfied with your productivity and the way
your programs turn out, you may want to consider adopting a formal method, or
choosing pieces from among the many formal methods.</span></p>

<p class=MsoNormal><span lang=EN-US>While you’re going through the development
process, the most important issue is this: Don’t get lost. It’s easy to do.
Most of the analysis and design </span><span
lang=EN-US>methods are intended to solve the largest of problems. Remember that
most projects don’t fit into that category, so you can usually have successful
analysis and design with a relatively small subset of what a method recommends</span><a
href="#_ftn8" name="_ftnref8" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[8]</span></span></span></span></a><span
lang=EN-US>. But some sort of process, no matter how limited, will generally
get you on your way in a much better fashion than simply beginning to code.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s also easy to get stuck, to fall into “</span><span lang=EN-US>analysis paralysis,” where you feel like you can’t move forward
because you haven’t nailed down every little detail at the current stage.
Remember, no matter how much analysis you do, there are some things about a
system that won’t reveal themselves until design time, and more things that
won’t reveal themselves until you’re coding, or not even until a program is up
and running. Because of this, it’s crucial to move fairly quickly through
analysis and design, and to implement a test of the proposed system.</span></p>

<p class=MsoNormal><span lang=EN-US>This point is worth emphasizing. Because of
the history we’ve had with procedural languages, it is commendable that a team
will want to proceed carefully and understand every minute detail before moving
to design and implementation. Certainly, when creating a DBMS, it pays to
understand a customer’s needs thoroughly. But a DBMS is in a class of problems
that is very well-posed and well-understood; in many such programs, the
database structure <i>is</i> the problem to be tackled. The class of
programming problem discussed in this chapter is of the “wild-card” (my term)
variety, in which the solution isn’t simply re-forming a well-known solution,
but instead involves one or more “wild-card</span><span
lang=EN-US> factors”—elements for which there is no well-understood previous
solution, and for which research is necessary</span><a href="#_ftn9"
name="_ftnref9" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[9]</span></span></span></span></a><span
lang=EN-US>. Attempting to thoroughly analyze a wild-card problem before moving
into design and implementation results in analysis paralysis because you don’t
have enough information to solve this kind of problem during the analysis
phase. Solving such a problem requires iteration through the whole cycle, and
that requires risk-taking behavior (which makes sense, because you’re trying to
do something new and the potential rewards are higher). It may seem like the
risk is compounded by “rushing” into a preliminary implementation, but it can
instead reduce the risk in a wild-card project because you’re finding out early
whether a particular approach to the problem is viable. Product development is
risk management.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s often proposed that you “build one to
throw away.” With OOP, you may still throw <i>part</i> of it away, but because
code is encapsulated into classes, during the first pass you will inevitably
produce some useful class designs and develop some worthwhile ideas about the
system design that do not need to be thrown away. Thus, the first rapid pass at
a problem not only produces critical information for the next analysis, design,
and implementation pass, it also creates a code foundation.</span></p>

<p class=MsoNormal><span lang=EN-US>That said, if you’re looking at a
methodology that contains tremendous detail and suggests many steps and documents,
it’s still difficult to know when to stop. Keep in mind what you’re trying to
discover:</span></p>

<p class=Numbered><span lang=EN-US>What are the objects? (How do you partition
your project into its component parts?)</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>11.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>What are their interfaces? (What messages do you need to send to
each object?)</span></p>

<p class=MsoNormal><span lang=EN-US>If you come up with nothing more than the
objects and their interfaces, then you can write a program. For various reasons
you might need more descriptions and documents than this, but you can’t get
away with any less.</span></p>

<p class=MsoNormal><span lang=EN-US>The process can be undertaken in five
phases, and a Phase 0 that is just the initial commitment to using some kind of
structure.</span></p>

<h3><a name="_Toc481064489"></a><a name="_Toc472654692"></a><a
name="_Toc408018410"><span lang=EN-US>Phase 0: Make a plan</span></a></h3>

<p class=MsoNormal><span lang=EN-US>You must first decide what steps you’re
going to have in your process. It sounds simple (in fact, <i>all</i> of this
sounds simple), and yet people often don’t make this decision before they start
coding. If your plan is “let’s jump in and start coding,” fine. (Sometimes
that’s appropriate when you have a well-understood problem.) At least agree
that this is the </span><span
lang=EN-US>plan.</span></p>

<p class=MsoNormal><span lang=EN-US>You might also decide at this phase that
some additional process structure is necessary, but not the whole nine yards.
Understandably, some programmers like to work in “vacation mode,” in which no
structure is imposed on the process of developing their work; “It will be done
when it’s done.” This can be appealing for a while, but I’ve found that having
a few milestones along the way helps to focus and galvanize your efforts around
those milestones instead of being stuck with the single goal of “finish the
project.” In addition, it divides the project into more bite-sized pieces and
makes it seem less threatening (plus the milestones offer more opportunities
for celebration).</span></p>

<p class=MsoNormal><span lang=EN-US>When I began to study story structure (so
that I will someday write a novel) I was initially resistant to the idea of
structure, feeling that I wrote best when I simply let it flow onto the page.
But I later realized that when I write about computers the structure is clear
enough to me that I don’t have to think about it very much. But I still
structure my work, albeit only semi-consciously in my head. Even if you think
that your plan is to just start coding, you still somehow go through the
subsequent phases while asking and answering certain questions.</span></p>

<h4><a name="_Toc408018411"><span lang=EN-US>The mission statement</span></a></h4>

<p class=MsoNormal><span lang=EN-US>Any system you build, no matter how
complicated, has a fundamental purpose; the business that it’s in, the basic
need that it satisfies. If you can look past the user interface, the hardware-
or system-specific details, the coding algorithms and the efficiency problems,
you will eventually find the core of its being—simple and straightforward. Like
the so-called </span><span lang=EN-US><i>high concept</i> from a Hollywood
movie, you can describe it in one or two sentences. This pure description is
the starting point.</span></p>

<p class=MsoNormal><span lang=EN-US>The high concept is quite important because
it sets the tone for your project; it’s a mission statement. You won’t
necessarily get it right the first time (you may be in a later phase of the
project before it becomes completely clear), but keep trying until it feels
right. For example, in an air-traffic control system you may start out with a
high concept focused on the system that you’re building: “The tower program
keeps track of the aircraft.” But consider what happens when you shrink the
system to a very small airfield; perhaps there’s only a human controller, or
none at all. A more useful model won’t concern the solution you’re creating as
much as it describes the problem: “Aircraft arrive, unload, service and reload,
then depart.”</span></p>

<h3><a name="_Toc481064490"></a><a name="_Toc472654693"><span lang=EN-US>Phase
1: What are we making?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>In the previous generation of program
design (called <i>procedural design</i>), this is called “creating the </span><span lang=EN-US><i>requirements analysis</i> and </span><span lang=EN-US><i>system specification</i>.” These, of course, were places to get
lost; intimidatingly named documents that could become big projects in their
own right. Their intention was good, however. The requirements analysis says
“Make a list of the guidelines we will use to know when the job is done and the
customer is satisfied.” The system specification says “Here’s a description of <i>what</i>
the program will do (not <i>how</i>) to satisfy the requirements.” The
requirements analysis is really a contract between you and the customer (even
if the customer works within your company, or is some other object or system).
The system specification is a top-level exploration into the problem and in
some sense a discovery of whether it can be done and how long it will take.
Since both of these will require consensus among people (and because they will
usually change over time), I think it’s best to keep them as bare as
possible—ideally, to lists and basic diagrams—to save time. You might have
other constraints that require you to expand them into bigger documents, but by
keeping the initial document small and concise, it can be created in a few
sessions of group brainstorming with a leader who dynamically creates the
description. This not only solicits input from everyone, it also fosters
initial buy-in and agreement by everyone on the team. Perhaps most importantly,
it can kick off a project with a lot of enthusiasm.</span></p>

<p class=MsoNormal style='margin-bottom:4.0pt'><span lang=EN-US>It’s necessary
to stay focused on the heart of what you’re trying to accomplish in this phase:
determine what the system is supposed to do. The most valuable tool for this is
a collection of what are called “</span><span
lang=EN-US>use cases.” Use cases identify key features in the system that will
reveal some of the fundamental classes you’ll be using. These are essentially
descriptive answers to questions like</span><a href="#_ftn10" name="_ftnref10"
title=""><span class=MsoFootnoteReference><span lang=EN-US style='font-size:
8.0pt'><span class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;
font-family:"Georgia","serif"'>[10]</span></span></span></span></a><span
lang=EN-US>:</span></p>

<p class=MsoNormal style='margin-bottom:4.0pt;text-indent:0cm'><span
lang=EN-US>“Who will use this system?” </span></p>

<p class=MsoNormal style='margin-bottom:4.0pt;text-indent:0cm'><span
lang=EN-US>“What can those actors do with the system?”  </span></p>

<p class=MsoNormal style='margin-bottom:4.0pt;text-indent:0cm'><span
lang=EN-US>“How does <i>this</i> actor do <i>that</i> with this system?”</span></p>

<p class=MsoNormal style='margin-bottom:4.0pt;text-indent:0cm'><span
lang=EN-US>“How else might this work if someone else were doing this, or if the
same actor had a different objective?” (to reveal variations)</span></p>

<p class=MsoList3><span lang=EN-US style='font-size:11.0pt'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US style='font-size:11.0pt'>“What problems might
happen while doing this with the system?” (to reveal exceptions)</span></p>

<p class=MsoNormal><span lang=EN-US>If you are designing an auto-teller, for
example, the use case for a particular aspect of the functionality of the
system is able to describe what the auto-teller does in every possible
situation. Each of these “situations” is referred to as a </span><span lang=EN-US><i>scenario</i>, and a use case can be considered a collection of scenarios.
You can think of a scenario as a question that starts with: “What does the
system do if…?” For example, “What does the auto-teller do if a customer has
just deposited a check within the last 24 hours, and there’s not enough in the
account without the check having cleared to provide a desired withdrawal?” </span></p>

<p class=MsoNormal><span lang=EN-US>Use case diagrams are intentionally simple
to prevent you from getting bogged down in system implementation details
prematurely:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=467 height=254 src="TIJ2_files/image015.png"></span></p>

<p class=MsoNormal><span lang=EN-US>Each stick person represents an “</span><span lang=EN-US>actor,” which is typically a human or some other kind of free agent.
(These can even be other computer systems, as is the case with “ATM.”) The box
represents the boundary of your system. The ellipses represent the use cases,
which are descriptions of valuable work that can be performed with the system.
The lines between the actors and the use cases represent the interactions.</span></p>

<p class=MsoNormal><span lang=EN-US>It doesn’t matter how the system is
actually implemented, as long as it looks like this to the user.</span></p>

<p class=MsoNormal><span lang=EN-US>A use case does not need to be terribly
complex, even if the underlying system is complex. It is only intended to show
the system as it appears to the user. For example:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=284 height=115 src="TIJ2_files/image016.png"></span></p>

<p class=MsoNormal><span lang=EN-US>The use cases produce the requirements
specifications by determining all the interactions that the user may have with
the system. You try to discover a full set of use cases for your system, and
once you’ve done that you have the core of what the system is supposed to do.
The nice thing about focusing on use cases is that they always bring you back
to the essentials and keep you from drifting off into issues that aren’t
critical for getting the job done. That is, if you have a full set of use
cases, you can describe your system and move onto the next phase. You probably
won’t get it all figured out perfectly on the first try, but that’s OK.
Everything will reveal itself in time, and if you demand a perfect system
specification at this point you’ll get stuck.</span></p>

<p class=MsoNormal><span lang=EN-US>If you do get stuck, you can kick-start
this phase by using a rough approximation tool: describe the system in a few
paragraphs and then look for nouns and verbs. The nouns can suggest actors,
context of the use case (e.g., “lobby”), or artifacts manipulated in the use
case. Verbs can suggest interactions between actors and use cases, and specify
steps within the use case. You’ll also discover that nouns and verbs produce
objects and messages during the design phase (and note that use cases describe
interactions between subsystems, so the “noun and verb” technique can be used
only as a brainstorming tool as it does not generate use cases)</span><span
class=MsoFootnoteReference><b><span lang=EN-US style='font-size:8.0pt'> </span></b></span><a
href="#_ftn11" name="_ftnref11" title=""><span lang=EN-US style='font-size:
11.0pt;font-family:"Georgia","serif"'>[11]</span></a><span lang=EN-US>.</span></p>

<p class=MsoNormal><span lang=EN-US>The boundary between a use case and an
actor can point out the existence of a </span><span lang=EN-US>user interface, but it does not define such a user interface. For a
process of defining and creating user interfaces, see <i>Software for Use</i>
by Larry Constantine and Lucy Lockwood, (Addison-Wesley Longman, 1999) or go to
<i>www.ForUse.com</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>Although it’s a black art, at this point
some kind of basic </span><span lang=EN-US>scheduling is important. You now
have an overview of what you’re building, so you’ll probably be able to get
some idea of how long it will take. A lot of factors come into play here. If
you estimate a long schedule then the company might decide not to build it (and
thus use their resources on something more reasonable—that’s a <i>good</i>
thing). Or a manager might have already decided how long the project should
take and will try to influence your estimate. But it’s best to have an honest
schedule from the beginning and deal with the tough decisions early. There have
been a lot of attempts to come up with accurate scheduling techniques (much
like techniques to predict the stock market), but probably the best approach is
to rely on your experience and intuition. Get a gut feeling for how long it
will really take, then double that and add 10 percent. Your gut feeling is
probably correct; you <i>can</i> get something working in that time. The
“doubling” will turn that into something decent, and the 10 percent will deal
with the final polishing and details</span><a href="#_ftn12" name="_ftnref12"
title=""><span class=MsoFootnoteReference><span lang=EN-US style='font-size:
8.0pt'><span class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;
font-family:"Georgia","serif"'>[12]</span></span></span></span></a><span
lang=EN-US>. However you want to explain it, and regardless of the moans and
manipulations that happen when you reveal such a schedule, it just seems to
work out that way.</span></p>

<h3><a name="_Toc481064491"></a><a name="_Toc472654694"></a><a
name="_Toc408018412"><span lang=EN-US>Phase 2: How will we build it?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>In this phase you must come up with a
design that describes what the classes look like and how they will interact. An
excellent technique in determining classes and interactions is the </span><span lang=EN-US><i>Class-Responsibility-Collaboration</i> (CRC) card. Part of the
value of this tool is that it’s so low-tech: you start out with a set of blank
3 x 5 cards, and you write on them. Each card represents a single class, and on
the card you write:</span></p>

<p class=Numbered><span lang=EN-US>The name of the class. It’s important that
this name capture the essence of what the class does, so that it makes sense at
a glance.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>12.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>The “responsibilities” of the class: what it should do. This can
typically be summarized by just stating the names of the member functions
(since those names should be descriptive in a good design), but it does not
preclude other notes. If you need to seed the process, look at the problem from
a lazy programmer’s standpoint: What objects would you like to magically appear
to solve your problem?</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>13.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>The “collaborations” of the class: what other classes does it
interact with? “Interact” is an intentionally broad term; it could mean
aggregation or simply that some other object exists that will perform services
for an object of the class. Collaborations should also consider the audience
for this class. For example, if you create a class <b>Firecracker</b>, who is
going to observe it, a <b>Chemist</b> or a <b>Spectator</b>? The former will
want to know what chemicals go into the construction, and the latter will
respond to the colors and shapes released when it explodes.</span></p>

<p class=MsoNormal><span lang=EN-US>You may feel like the cards should be
bigger because of all the information you’d like to get on them, but they are
intentionally small, not only to keep your classes small but also to keep you
from getting into too much detail too early. If you can’t fit all you need to
know about a class on a small card, the class is too complex (either you’re
getting too detailed, or you should create more than one class). The ideal
class should be understood at a glance. The idea of CRC cards is to assist you
in coming up with a first cut of the design so that you can get the big picture
and then refine your design.</span></p>

<p class=MsoNormal><span lang=EN-US>One of the great benefits of CRC cards is
in communication. It’s best done real time, in a group, without computers. Each
person takes responsibility for several classes (which at first have no names
or other information). You run a live simulation by solving one scenario at a
time, deciding which messages are sent to the various objects to satisfy each
scenario. As you go through this process, you discover the classes that you
need along with their responsibilities and collaborations, and you fill out the
cards as you do this. When you’ve moved through all the use cases, you should
have a fairly complete first cut of your design.</span></p>

<p class=MsoNormal><span lang=EN-US>Before I began using CRC cards, the most
successful consulting experiences I had when coming up with an initial design
involved standing in front of a team—who hadn’t built an OOP project before—and
drawing objects on a whiteboard. We talked about how the objects should
communicate with each other, and erased some of them and replaced them with
other objects. Effectively, I was managing all the “CRC cards” on the
whiteboard. The team (who knew what the project was supposed to do) actually
created the design; they “owned” the design rather than having it given to
them. All I was doing was guiding the process by asking the right questions,
trying out the assumptions, and taking the feedback from the team to modify
those assumptions. The true beauty of the process was that the team learned how
to do object-oriented design not by reviewing abstract examples, but by working
on the one design that was most interesting to them at that moment: theirs.</span></p>

<p class=MsoNormal><span lang=EN-US>Once you’ve come up with a set of CRC
cards, you may want to create a more formal description of your design using
UML</span><a href="#_ftn13" name="_ftnref13" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[13]</span></span></span></span></a><span lang=EN-US>. You
don’t need to use </span><span lang=EN-US>UML, but it can be helpful,
especially if you want to put up a diagram on the wall for everyone to ponder,
which is a good idea. An alternative to UML is a textual description of the
objects and their interfaces, or, depending on your programming language, the
code itself</span><a href="#_ftn14" name="_ftnref14" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[14]</span></span></span></span></a><span lang=EN-US>.</span></p>

<p class=MsoNormal><span lang=EN-US>UML also provides an additional diagramming
notation for describing the dynamic model of your system. This is helpful in
situations in which the state transitions of a system or subsystem are dominant
enough that they need their own diagrams (such as in a control system). You may
also need to describe the data structures, for systems or subsystems in which
data is a dominant factor (such as a database).</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll know you’re done with Phase 2 when
you have described the objects and their interfaces. Well, most of them—there
are usually a few that slip through the cracks and don’t make themselves known
until Phase 3. But that’s OK. All you are concerned with is that you eventually
discover all of your objects. It’s nice to discover them early in the process,
but OOP provides enough structure so that it’s not so bad if you discover them
later. In fact, the design of an object tends to happen in five stages, throughout
the process of program development.</span></p>

<h4><a name="_Toc408018413"></a><a name="_Toc312373799"><span lang=EN-US>Five
stages of object design</span></a></h4>

<p class=MsoNormal><span lang=EN-US>The design life of an object is not limited to the time when you’re
writing the program. Instead, the design of an object appears over a sequence
of stages. It’s helpful to have this perspective because you stop expecting
perfection right away; instead, you realize that the understanding of what an
object does and what it should look like happens over time. This view also
applies to the design of various types of programs; the pattern for a
particular type of program emerges through struggling again and again with that
problem (This is chronicled in the book <i>Thinking in Patterns with Java</i>,
downloadable at <i>www.BruceEckel.com</i>). Objects, too, have their patterns
that emerge through understanding, use, and reuse.</span></p>

<p class=MsoNormal><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>1.
Object discovery.</span><span lang=EN-US> </span></b><span lang=EN-US>This
stage occurs during the initial analysis of a program. Objects may be
discovered by looking for external factors and boundaries, duplication of
elements in the system, and the smallest conceptual units. Some objects are
obvious if you already have a set of class libraries. Commonality between
classes suggesting base classes and inheritance may appear right away, or later
in the design process.</span></p>

<p class=MsoNormal><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>2.
Object assembly.</span><span lang=EN-US> </span></b><span lang=EN-US>As you’re
building an object you’ll discover the need for new members that didn’t appear
during discovery. The internal needs of the object may require other classes to
support it.</span></p>

<p class=MsoNormal><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>3.
System construction.</span><span lang=EN-US> </span></b><span lang=EN-US>Once
again, more requirements for an object may appear at this later stage. As you
learn, you evolve your objects. The need for communication and interconnection
with other objects in the system may change the needs of your classes or
require new classes. For example, you may discover the need for facilitator or
helper classes, such as a linked list, that contain little or no state
information and simply help other classes function.</span></p>

<p class=MsoNormal><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>4.
System extension.</span><span lang=EN-US> </span></b><span lang=EN-US>As you
add new features to a system you may discover that your previous design doesn’t
support easy system extension. With this new information, you can restructure
parts of the system, possibly adding new classes or class hierarchies.</span></p>

<p class=MsoNormal><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>5.
Object reuse.</span><span lang=EN-US> </span></b><span
lang=EN-US>This is the real stress test for a class. If someone tries to reuse
it in an entirely new situation, they’ll probably discover some shortcomings.
As you change a class to adapt to more new programs, the general principles of
the class will become clearer, until you have a truly reusable type. However, don’t
expect most objects from a system design to be reusable—it is perfectly
acceptable for the bulk of your objects to be system-specific. Reusable types
tend to be less common, and they must solve more general problems in order to
be reusable.</span></p>

<h4><span lang=EN-US>Guidelines for object development</span></h4>

<p class=MsoNormal><span lang=EN-US>These stages suggest some guidelines when thinking about developing
your classes:</span></p>

<p class=Numbered><span lang=EN-US>Let a specific problem generate a class,
then let the class grow and mature during the solution of other problems.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>14.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Remember, discovering the classes you need (and their interfaces) is
the majority of the system design. If you already had those classes, this would
be an easy project.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>15.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Don’t force yourself to know everything at the beginning; learn as
you go. This will happen anyway.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>16.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Start programming; get something working so you can prove or
disprove your design. Don’t fear that you’ll end up with procedural-style
spaghetti code—classes partition the problem and help control anarchy and
entropy. Bad classes do not break good classes.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>17.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Always keep it simple. Little clean objects with obvious utility are
better than big complicated interfaces. When decision points come up, use an
Occam’s Razor approach: Consider the choices and select the one that is
simplest, because simple classes are almost always best. Start small and
simple, and you can expand the class interface when you understand it better.
As time goes on, it’s difficult to remove elements from a class.</span></p>

<h3><a name="_Toc481064492"></a><a name="_Toc472654695"><span lang=EN-US>Phase
3: Build </span></a><span lang=EN-US>the core</span></h3>

<p class=MsoNormal><span lang=EN-US>This is the initial conversion from the
rough design into a compiling and executing body of code that can be tested,
and especially that will prove or disprove your architecture. This is not a
one-pass process, but rather the beginning of a series of steps that will
iteratively build the system, as you’ll see in Phase 4.</span></p>

<p class=MsoNormal><span lang=EN-US>Your goal is to find the core of your
system architecture that needs to be implemented in order to generate a running
system, no matter how incomplete that system is in this initial pass. You’re
creating a framework that you can build on with further iterations. You’re also
performing the first of many system integrations and tests, and giving the
stakeholders feedback about what their system will look like and how it is
progressing. Ideally, you are also exposing some of the critical risks. You’ll
probably also discover changes and improvements that can be made to your
original architecture—things you would not have learned without implementing
the system.</span></p>

<p class=MsoNormal><span lang=EN-US>Part of building the system is the reality
check that you get from testing against your requirements analysis and system
specification (in whatever form they exist). Make sure that your tests verify
the requirements and use cases. When the core of the system is stable, you’re ready
to move on and add more functionality.</span></p>

<h3><a name="_Toc408018414"></a><a name="_Toc481064493"></a><a
name="_Toc472654696"><span lang=EN-US>Phase 4: Iterate the </span></a><span lang=EN-US>use cases</span></h3>

<p class=MsoNormal><span lang=EN-US>Once the core framework is running, each
feature set you add is a small project in itself. You add a feature set during
an </span><span lang=EN-US><i>iteration</i>, a reasonably short period of
development.</span></p>

<p class=MsoNormal><span lang=EN-US>How big is an iteration? Ideally, each
iteration lasts one to three weeks (this can vary based on the implementation
language). At the end of that period, you have an integrated, tested system
with more functionality than it had before. But what’s particularly interesting
is the basis for the iteration: a single use case. Each use case is a package
of related functionality that you build into the system all at once, during one
iteration. Not only does this give you a better idea of what the </span><span lang=EN-US>scope of a use case should be, but it also gives more validation to
the idea of a use case, since the concept isn’t discarded after analysis and
design, but instead it is a fundamental unit of development throughout the
software-building process. </span></p>

<p class=MsoNormal><span lang=EN-US>You stop iterating when you achieve target
functionality or an external deadline arrives and the customer can be satisfied
with the current version. (Remember, software is a subscription business.)
Because the process is iterative, you have many opportunities to ship a product
rather than a single endpoint; open-source projects work exclusively in an
iterative, high-feedback environment, which is precisely what makes them
successful.</span></p>

<p class=MsoNormal><span lang=EN-US>An iterative development process is
valuable for many reasons. You can reveal and resolve critical risks early, the
customers have ample opportunity to change their minds, programmer satisfaction
is higher, and the project can be steered with more precision. But an
additional important benefit is the feedback to the stakeholders, who can see
by the current state of the product exactly where everything lies. This may
reduce or eliminate the need for mind-numbing status meetings and increase the
confidence and support from the stakeholders.</span></p>

<h3><a name="_Toc481064494"></a><a name="_Toc472654697"><span lang=EN-US>Phase
5: </span></a><span
lang=EN-US>Evolution</span></h3>

<p class=MsoNormal><span lang=EN-US>This is the point in the development cycle
that has traditionally been called “</span><span lang=EN-US>maintenance,” a catch-all term that can mean everything from “getting
it to work the way it was really supposed to in the first place” to “adding
features that the customer forgot to mention” to the more traditional “fixing
the bugs that show up” and “adding new features as the need arises.” So many
misconceptions have been applied to the term “maintenance” that it has taken on
a slightly deceiving quality, partly because it suggests that you’ve actually
built a pristine program and all you need to do is change parts, oil it, and
keep it from rusting. Perhaps there’s a better term to describe what’s going
on.</span></p>

<p class=MsoNormal><span lang=EN-US>I’ll use the term <i>evolution</i></span><a
href="#_ftn15" name="_ftnref15" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[15]</span></span></span></span></a><span
lang=EN-US>. That is, “You won’t get it right the first time, so give yourself
the latitude to learn and to go back and make changes.” You might need to make
a lot of changes as you learn and understand the problem more deeply. The
elegance you’ll produce if you evolve until you get it right will pay off, both
in the short and the long term. Evolution is where your program goes from good
to great, and where those issues that you didn’t really understand in the first
pass become clear. It’s also where your classes can evolve from single-project
usage to reusable resources.</span></p>

<p class=MsoNormal><span lang=EN-US>What it means to “get it right” isn’t just
that the program works according to the requirements and the use cases. It also
means that the internal structure of the code makes sense to you, and feels
like it fits together well, with no awkward syntax, oversized objects, or
ungainly exposed bits of code. In addition, you must have some sense that the
program structure will survive the changes that it will inevitably go through
during its lifetime, and that those changes can be made easily and cleanly.
This is no small feat. You must not only understand what you’re building, but
also how the program will evolve (what I call the </span><span
lang=EN-US><i>vector of change</i>). Fortunately, object-oriented programming
languages are particularly adept at supporting this kind of continuing
modification—the boundaries created by the objects are what tend to keep the
structure from breaking down. They also allow you to make changes—ones that
would seem drastic in a procedural program—without causing earthquakes
throughout your code. In fact, support for evolution might be the most
important benefit of OOP.</span></p>

<p class=MsoNormal><span lang=EN-US>With evolution, you create something that
at least approximates what you think you’re building, and then you kick the
tires, compare it to your requirements, and see where it falls short. Then you
can go back and fix it by redesigning and reimplementing the portions of the
program that didn’t work right</span><a href="#_ftn16" name="_ftnref16" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[16]</span></span></span></span></a><span lang=EN-US>. You
might actually need to solve the problem, or an aspect of the problem, several
times before you hit on the right solution. (A study of </span><span lang=EN-US><i>Design Patterns </i>is usually helpful here. You can find
information in <i>Thinking in Patterns with Java</i>, downloadable at <i>www.BruceEckel.com</i>.)</span></p>

<p class=MsoNormal><span lang=EN-US>Evolution also occurs when you build a
system, see that it matches your requirements, and then discover it wasn’t
actually what you wanted. When you see the system in operation, you find that
you really wanted to solve a different problem. If you think this kind of
evolution is going to happen, then you owe it to yourself to build your first
version as quickly as possible so you can find out if it is indeed what you
want.</span></p>

<p class=MsoNormal><span lang=EN-US>Perhaps the most important thing to
remember is that by default—by definition, really—if you modify a class, its
super- and subclasses will still function. You need not fear modification
(especially if you have a built-in set of unit tests to verify the correctness
of your modifications). Modification won’t necessarily break the program, and
any change in the outcome will be limited to subclasses and/or specific
collaborators of the class you change.</span></p>

<h3><a name="_Toc481064495"></a><a name="_Toc472654698"></a><a
name="_Toc408018415"><span lang=EN-US>Plans pay off</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Of course you wouldn’t build a house
without a lot of carefully drawn plans. If you build a deck or a dog house your
plans won’t be so elaborate, but you’ll probably still start with some kind of
sketches to guide you on your way. Software development has gone to extremes.
For a long time, people didn’t have much structure in their development, but
then big projects began failing. In reaction, we ended up with methodologies
that had an intimidating amount of structure and detail, primarily intended for
those big projects. These methodologies were too scary to use—it looked like
you’d spend all your time writing documents and no time programming. (This was
often the case.) I hope that what I’ve shown you here suggests a middle path—a
sliding scale. Use an approach that fits your needs (and your personality). No
matter how minimal you choose to make it, <i>some</i> kind of plan will make a
big improvement in your project as opposed to no plan at all. Remember that, by
most estimates, over 50 percent of projects fail (some estimates go up to 70
percent!).</span><a name="_Toc312373783"><span lang=EN-US> </span></a></p>

<p class=MsoNormal><span lang=EN-US>By following a plan—preferably one that is
simple and brief—and coming up with design structure before coding, you’ll
discover that things fall together far more easily than if you dive in and
start hacking. You’ll also realize a great deal of satisfaction. It’s my
experience that coming up with an elegant solution is deeply satisfying at an
entirely different level; it feels closer to art than technology. And </span><span lang=EN-US>elegance always pays off; it’s not a frivolous pursuit. Not only does
it give you a program that’s easier to build and debug, but it’s also easier to
understand and maintain, and that’s where the financial value lies.</span></p>

<h2><a name="_Toc312373787"></a><a name="_Toc481064496"></a><a
name="_Toc472654699"><span lang=EN-US>Extreme programming</span></a></h2>

<p class=MsoNormal><span lang=EN-US>I have studied analysis and design
techniques, on and off, since I was in graduate school. The concept of </span><span lang=EN-US><i>Extreme Programming</i> (XP) is the most radical, and delightful,
that I’ve seen. You can find it chronicled in <i>Extreme Programming Explained</i>
by Kent Beck (Addison-Wesley, 2000) and on the Web at <i>www.xprogramming.com</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>XP is both a philosophy about programming
work and a set of guidelines to do it. Some of these guidelines are reflected
in other recent methodologies, but the two most important and distinct
contributions, in my opinion, are “write tests first” and “pair programming.”
Although he argues strongly for the whole process, Beck points out that if you
adopt only these two practices you’ll greatly improve your productivity and
reliability.</span></p>

<h3><a name="_Toc481064497"></a><a name="_Toc472654700"><span lang=EN-US>Write
tests first</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>Testing has traditionally been relegated to the last part of a
project, after you’ve “gotten everything working, but just to be sure.” It’s implicitly
had a low priority, and people who specialize in it have not been given a lot
of status and have often even been cordoned off in a basement, away from the
“real programmers.” Test teams have responded in kind, going so far as to wear
black clothing and cackling with glee whenever they break something (to be
honest, I’ve had this feeling myself when breaking compilers).</span></p>

<p class=MsoNormal><span lang=EN-US>XP completely revolutionizes the concept of
testing by giving it equal (or even greater) priority than the code. In fact,
you write the tests <i>before</i> you write the code that will be tested, and
the tests stay with the code forever. The tests must be executed successfully
every time you do an integration of the project (which is often, sometimes more
than once a day).</span></p>

<p class=MsoNormal><span lang=EN-US>Writing tests first has two extremely
important effects.</span></p>

<p class=MsoNormal><span lang=EN-US>First, it forces a clear definition of the </span><span lang=EN-US>interface of a class. I’ve often suggested that people “imagine the
perfect class to solve a particular problem” as a tool when trying to design
the system. The XP testing strategy goes further than that—it specifies exactly
what the class must look like, to the consumer of that class, and exactly how
the class must behave. In no uncertain terms. You can write all the prose, or
create all the diagrams you want, describing how a class should behave and what
it looks like, but nothing is as real as a set of tests. The former is a wish
list, but the tests are a contract that is enforced by the compiler and the
running program. It’s hard to imagine a more concrete description of a class
than the tests.</span></p>

<p class=MsoNormal><span lang=EN-US>While creating the tests, you are forced to
completely think out the class and will often discover needed functionality
that might be missed during the thought experiments of UML diagrams, CRC cards,
use cases, etc.</span></p>

<p class=MsoNormal><span lang=EN-US>The second important effect of writing the
tests first comes from running the tests every time you do a build of your
software. This activity gives you the other half of the testing that’s
performed by the compiler. If you look at the evolution of programming
languages from this perspective, you’ll see that the real improvements in the
technology have actually revolved around testing. Assembly language checked
only for syntax, but C imposed some semantic restrictions, and these prevented
you from making certain types of mistakes. OOP languages impose even more
semantic restrictions, which if you think about it are actually forms of
testing. “Is this data type being used properly?” and “Is this function being
called properly?” are the kinds of tests that are being performed by the
compiler or run-time system. We’ve seen the results of having these tests built
into the language: people have been able to write more complex systems, and get
them to work, with much less time and effort. I’ve puzzled over why this is,
but now I realize it’s the tests: you do something wrong, and the safety net of
the built-in tests tells you there’s a problem and points you to where it is.</span></p>

<p class=MsoNormal><span lang=EN-US>But the built-in testing afforded by the
design of the language can only go so far. At some point, <i>you</i> must step
in and add the rest of the tests that produce a full suite (in cooperation with
the compiler and run-time system) that verifies all of your program. And, just
like having a compiler watching over your shoulder, wouldn’t you want these
tests helping you right from the beginning? That’s why you write them first,
and run them automatically with every build of your system. Your tests become
an extension of the safety net provided by the language.</span></p>

<p class=MsoNormal><span lang=EN-US>One of the things that I’ve discovered
about the use of more and more powerful programming languages is that I am
emboldened to try more brazen experiments, because I know that the language
will keep me from wasting my time chasing bugs. The XP test scheme does the
same thing for your entire project. Because you know your tests will always
catch any problems that you introduce (and you regularly add any new tests as
you think of them), you can make big changes when you need to without worrying
that you’ll throw the whole project into complete disarray. This is incredibly
powerful.</span></p>

<h3><span lang=EN-US><a name="_Toc481064498"></a><a name="_Toc472654701">Pair
programming</a></span></h3>

<p class=MsoNormal><span lang=EN-US>Pair programming goes against the rugged
individualism that we’ve been indoctrinated into from the beginning, through
school (where we succeed or fail on our own, and working with our neighbors is
considered “cheating”), and media, especially Hollywood movies in which the
hero is usually fighting against mindless conformity</span><a href="#_ftn17"
name="_ftnref17" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[17]</span></span></span></span></a><span
lang=EN-US>. Programmers, too, are considered paragons of individuality—“cowboy
coders” as Larry Constantine likes to say. And yet XP, which is itself battling
against conventional thinking, says that code should be written with two people
per workstation. And that this should be done in an area with a group of
workstations, without the barriers that the facilities-design people are so
fond of. In fact, Beck says that the first task of converting to XP is to
arrive with screwdrivers and Allen wrenches and take apart everything that gets
in the way.</span><a href="#_ftn18" name="_ftnref18" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[18]</span></span></span></span></a><span lang=EN-US> (This
will require a manager who can deflect the ire of the facilities department.)</span></p>

<p class=MsoNormal><span lang=EN-US>The value of pair programming is that one
person is actually doing the coding while the other is thinking about it. The
thinker keeps the big picture in mind—not only the picture of the problem at
hand, but the guidelines of XP. If two people are working, it’s less likely
that one of them will get away with saying, “I don’t want to write the tests
first,” for example. And if the coder gets stuck, they can swap places. If both
of them get stuck, their musings may be overheard by someone else in the work
area who can contribute. Working in pairs keeps things flowing and on track.
Probably more important, it makes programming a lot more social and fun.</span></p>

<p class=MsoNormal><span lang=EN-US>I’ve begun using pair programming during
the exercise periods in some of my seminars and it seems to significantly
improve everyone’s experience.</span></p>

<h2><a name="_Toc481064499"></a><a name="_Toc472654702"><span lang=EN-US>Why
Java succeeds</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The reason </span><span
lang=EN-US>Java has been so successful is that the goal was to solve many of
the problems facing developers today. The goal of Java is improved
productivity. This productivity comes in many ways, but the language is
designed to aid you as much as possible, while hindering you as little as
possible with arbitrary rules or any requirement that you use a particular set
of features. Java is designed to be practical; Java language design decisions
were based on providing the maximum benefits to the programmer.</span></p>

<h3><a name="_Toc481064500"></a><a name="_Toc472654706"></a><a
name="_Toc312373791"><span lang=EN-US>Systems are easier <br>
to express and understand</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Classes designed to fit the problem tend to
express it better. This means that when you write the code, you’re describing
your solution in the terms of the problem space (“Put the grommet in the bin”)
rather than the terms of the computer, which is the solution space (“Set the
bit in the chip that means that the relay will close”). You deal with
higher-level concepts and can do much more with a single line of code.</span></p>

<p class=MsoNormal><span lang=EN-US>The other benefit of this ease of
expression is maintenance, which (if reports can be believed) takes a huge
portion of the cost over a program’s lifetime. If a program is easier to
understand, then it’s easier to maintain. This can also reduce the cost of
creating and maintaining the documentation.</span></p>

<h3><a name="_Toc481064501"></a><a name="_Toc472654707"></a><a
name="_Toc312373792"><span lang=EN-US>Maximal leverage with libraries</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The fastest way to create a program is to
use code that’s already written: a library. A major goal in Java is to make
library use easier. This is accomplished by casting libraries into new data
types (classes), so that bringing in a library means adding new types to the
language. Because the Java compiler takes care of how the library is
used—guaranteeing proper initialization and cleanup, and ensuring that
functions are called properly—you can focus on what you want the library to do,
not how you have to do it. </span></p>

<h3><a name="_Toc481064502"></a><a name="_Toc472654709"></a><a
name="_Toc312373793"><span lang=EN-US>Error handling</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Error handling in C is a notorious problem,
and one that is often ignored—finger-crossing is usually involved. If you’re
building a large, complex program, there’s nothing worse than having an error
buried somewhere with no clue as to where it came from. Java <i>exception
handling</i> is a way to guarantee that an error is noticed, and that something
happens as a result.</span></p>

<h3><a name="_Toc481064503"></a><a name="_Toc472654710"></a><a
name="_Toc312373794"><span lang=EN-US>Programming in the large</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Many traditional languages have built-in
limitations to program size and complexity. BASIC</span><span
lang=EN-US>, for example, can be great for pulling together quick solutions for
certain classes of problems, but if the program gets more than a few pages
long, or ventures out of the normal problem domain of that language, it’s like
trying to swim through an ever-more viscous fluid. There’s no clear line that
tells you when your language is failing you, and even if there were, you’d
ignore it. You don’t say, “My BASIC program just got too big; I’ll have to
rewrite it in C!” Instead, you try to shoehorn a few more lines in to add that
one new feature. So the extra costs come creeping up on you.</span></p>

<p class=MsoNormal><span lang=EN-US>Java is designed to aid </span><span lang=EN-US><i>programming in the large</i>—that is, to erase those
creeping-complexity boundaries between a small program and a large one. You
certainly don’t need to use OOP when you’re writing a “hello world” style
utility program, but the features are there when you need them. And the
compiler is aggressive about ferreting out bug-producing errors for small and
large programs alike.</span></p>

<h2><a name="_Toc312373815"></a><span
lang=EN-US><a name="_Toc481064504"></a><a name="_Toc472654711">Strategies for
transition</a></span></h2>

<p class=MsoNormal><span lang=EN-US>If you buy into OOP, your next question is
probably, “How can I get my manager/colleagues/department/peers to start using
objects?” Think about how you—one independent programmer—would go about
learning to use a new language and a new programming paradigm. You’ve done it
before. First comes education and examples; then comes a trial project to give
you a feel for the basics without doing anything too confusing. Then comes a
“real world” project that actually does something useful. Throughout your first
projects you continue your education by reading, asking questions of experts,
and trading hints with friends. This is the approach many experienced
programmers suggest for the switch to Java. Switching an entire company will of
course introduce certain group dynamics, but it will help at each step to
remember how one person would do it. </span></p>

<h3><a name="_Toc481064505"></a><a name="_Toc472654712"><span lang=EN-US>Guidelines</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Here are some guidelines to consider when
making the transition to OOP and Java:</span></p>

<h4><span lang=EN-US>1. </span><span lang=EN-US>Training</span></h4>

<p class=MsoNormal><span lang=EN-US>The first step is some form of education.
Remember the company’s investment in code, and try not to throw everything into
disarray for six to nine months while everyone puzzles over how interfaces
work. Pick a small group for indoctrination, preferably one composed of people
who are curious, work well together, and can function as their own support
network while they’re learning Java.</span></p>

<p class=MsoNormal><span lang=EN-US>An alternative approach that is sometimes
suggested is the education of all company levels at once, including overview
courses for strategic managers as well as design and programming courses for
project builders. This is especially good for smaller companies making
fundamental shifts in the way they do things, or at the division level of
larger companies. Because the cost is higher, however, some may choose to start
with project-level training, do a pilot project (possibly with an outside
mentor), and let the project team become the teachers for the rest of the
company.</span></p>

<h4><span lang=EN-US>2. Low-risk project</span></h4>

<p class=MsoNormal><span lang=EN-US>Try a low-risk project first and allow for
mistakes. Once you’ve gained some experience, you can either seed other
projects from members of this first team or use the team members as an OOP
technical support staff. This first project may not work right the first time,
so it should not be mission-critical for the company. It should be simple,
self-contained, and instructive; this means that it should involve creating
classes that will be meaningful to the other programmers in the company when
they get their turn to learn Java.</span></p>

<h4><span lang=EN-US>3. Model from success</span></h4>

<p class=MsoNormal><span lang=EN-US>Seek out examples of good object-oriented
design before starting from scratch. There’s a good probability that someone
has solved your problem already, and if they haven’t solved it exactly you can
probably apply what you’ve learned about abstraction to modify an existing
design to fit your needs. This is the general concept of <i>design patterns, </i>covered
in <i>Thinking in Patterns with Java</i>, downloadable at <i>www.BruceEckel.com</i>.</span></p>

<h4><span lang=EN-US>4. Use </span><span
lang=EN-US>existing class libraries</span></h4>

<p class=MsoNormal><span lang=EN-US>The primary economic motivation for
switching to OOP is the easy use of existing code in the form of class
libraries (in particular, the Standard Java libraries, which are covered
throughout this book). The shortest application development cycle will result
when you can create and use objects from off-the-shelf libraries. However, some
new programmers don’t understand this, are unaware of existing class libraries,
or, through fascination with the language, desire to write classes that may
already exist. Your success with OOP and Java will be optimized if you make an
effort to seek out and reuse other people’s code early in the transition
process.</span></p>

<h4><span lang=EN-US>5. Don’t rewrite existing code in Java</span></h4>

<p class=MsoNormal><span lang=EN-US>It is not usually the best use of your time
to take existing, functional code and rewrite it in Java. (If you must turn it
into objects, you can interface to the C or C++ code using the Java Native
Interface, described in Appendix B.) There are incremental benefits, especially
if the code is slated for reuse. But chances are you aren’t going to see the
dramatic increases in productivity that you hope for in your first few projects
unless that project is a new one. Java and OOP shine best when taking a project
from concept to reality.</span></p>

<h3><a name="_Toc312373817"></a><span lang=EN-US><a name="_Toc481064506"></a><a name="_Toc472654713">Management
obstacles</a></span></h3>

<p class=MsoNormal><span lang=EN-US>If you’re a manager, your job is to acquire
resources for your team, to overcome barriers to your team’s success, and in
general to try to provide the most productive and enjoyable environment so your
team is most likely to perform those miracles that are always being asked of
you. Moving to Java falls in all three of these categories, and it would be
wonderful if it didn’t cost you anything as well. Although moving to Java may
be cheaper—depending on your constraints—than the OOP alternatives for a team
of C programmers (and probably for programmers in other procedural languages),
it isn’t free, and there are obstacles you should be aware of before trying to
sell the move to Java within your company and embarking on the move itself.</span></p>

<h4><span lang=EN-US>Startup costs</span></h4>

<p class=MsoNormal><span lang=EN-US>The cost of moving to Java is more than
just the acquisition of Java compilers (the Sun Java compiler is free, so this
is hardly an obstacle). Your medium- and long-term costs will be minimized if
you invest in training (and possibly mentoring for your first project) and also
if you identify and purchase class libraries that solve your problem rather
than trying to build those libraries yourself. These are hard-money costs that
must be factored into a realistic proposal. In addition, there are the hidden
costs in loss of productivity while learning a new language and possibly a new
programming environment. </span><span lang=EN-US>Training and mentoring can certainly minimize these, but team members
must overcome their own struggles to understand the new technology. During this
process they will make more mistakes (this is a feature, because acknowledged
mistakes are the fastest path to learning) and be less productive. Even then,
with some types of programming problems, the right classes, and the right
development environment, it’s possible to be more productive while you’re
learning Java (even considering that you’re making more mistakes and writing
fewer lines of code per day) than if you’d stayed with C.</span></p>

<h4><span lang=EN-US>Performance issues</span></h4>

<p class=MsoNormal><span lang=EN-US>A common question is, “Doesn’t OOP
automatically make my programs a lot bigger and slower?” The answer is, “It
depends.” The extra safety features in Java have traditionally extracted a
performance penalty over a language like C++. Technologies such as “hotspot”
and compilation technologies have improved the speed significantly in most
cases, and efforts continue toward higher performance.</span></p>

<p class=MsoNormal><span lang=EN-US>When your focus is on rapid prototyping,
you can throw together components as fast as possible while ignoring efficiency
issues. If you’re using any third-party libraries, these are usually already
optimized by their vendors; in any case it’s not an issue while you’re in
rapid-development mode. When you have a system that you like, if it’s small and
fast enough, then you’re done. If not, you begin tuning with a profiling tool,
looking first for speedups that can be done by rewriting small portions of
code. If that doesn’t help, you look for modifications that can be made in the
underlying implementation so no code that uses a particular class needs to be
changed. Only if nothing else solves the problem do you need to change the
design. The fact that performance is so critical in that portion of the design
is an indicator that it must be part of the primary design criteria. You have
the benefit of finding this out early using rapid development.</span></p>

<p class=MsoNormal><span lang=EN-US>If you find a function that is a particular
bottleneck, you can rewrite it in C/C++ using Java’s <i>native methods</i>, the
subject of Appendix B.</span></p>

<h4><span lang=EN-US>Common design errors</span></h4>

<p class=MsoNormal><span lang=EN-US>When starting your team into OOP and Java,
programmers will typically go through a series of common design errors. This
often happens due to insufficient feedback from experts during the design and
implementation of early projects, because no experts have been developed within
the company, and because there may be resistance to retaining consultants. It’s
easy to feel that you understand OOP too early in the cycle and go off on a bad
tangent. Something that’s obvious to someone experienced with the language may
be a subject of great internal debate for a novice. Much of this trauma can be
skipped by using an experienced outside expert for </span><span lang=EN-US>training and mentoring.</span></p>

<h2><a name="_Toc481064507"></a><a name="_Toc473421309"></a><a
name="_Toc375545210"><span lang=EN-US>Java vs. C++?</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Java looks a lot like C++, and so naturally
it would seem that C++ will be replaced by Java. But I’m starting to question
this logic. For one thing, C++ still has some features that Java doesn’t, and
although there have been a lot of promises about Java someday being as fast or
faster than C++, we’ve seen steady improvements but no dramatic breakthroughs.
Also, there seems to be a continuing interest in C++, so I don’t think that
language is going away any time soon. (Languages seem to hang around. Speaking
at one of my “Intermediate/Advanced Java Seminars,” Allen Holub asserted that
the two most commonly used languages are Rexx and COBOL, in that order.)</span></p>

<p class=MsoNormal><span lang=EN-US>I’m beginning to think that the strength of
Java lies in a slightly different arena than that of C++. C++ is a language
that doesn’t try to fit a mold. Certainly it has been adapted in a number of
ways to solve particular problems. Some C++ tools combine libraries, component
models, and code-generation tools to solve the problem of developing windowed
end-user applications (for Microsoft Windows). And yet, what do the vast
majority of Windows developers use? Microsoft’s Visual Basic (VB). This despite
the fact that VB produces the kind of code that becomes unmanageable when the
program is only a few pages long (and syntax that can be positively
mystifying). As successful and popular as VB is, it’s not a very good example
of language design. It would be nice to have the ease and power of VB without
the resulting unmanageable code. And that’s where I think Java will shine: as
the “next VB.” You may or may not shudder to hear this, but think about it: so
much of Java is intended to make it easy for the programmer to solve application-level
problems like networking and cross-platform UI, and yet it has a language
design that allows the creation of very large and flexible bodies of code. Add
to this the fact that Java has the most robust type checking and error handling
systems I’ve ever seen in a language and you have the makings of a significant
leap forward in programming productivity.</span></p>

<p class=MsoNormal><span lang=EN-US>Should you use Java instead of C++ for your
project? Other than Web applets, there are two issues to consider. First, if
you want to use a lot of existing C++ libraries (and you’ll certainly get a lot
of productivity gains there), or if you have an existing C or C++ code base,
Java might slow your development down rather than speeding it up. </span></p>

<p class=MsoNormal><span lang=EN-US>If you’re developing all your code
primarily from scratch, then the simplicity of Java over C++ will significantly
shorten your development time—the anecdotal evidence (stories from C++ teams
that I’ve talked to who have switched to Java) suggests a doubling of
development speed over C++. If Java performance doesn’t matter or you can
somehow compensate for it, sheer time-to-market issues make it difficult to
choose C++ over Java.</span></p>

<p class=MsoNormal><span lang=EN-US>The biggest issue is performance.
Interpreted Java has been slow, even 20 to 50 times slower than C in the
original Java interpreters. This has improved greatly over time, but it will
still remain an important number. Computers are about speed; if it wasn’t
significantly faster to do something on a computer then you’d do it by hand.
(I’ve even heard it suggested that you start with Java, to gain the short
development time, then use a tool and support libraries to translate your code
to C++, if you need faster execution speed.)</span></p>

<p class=MsoNormal><span lang=EN-US>The key to making Java feasible for most
development projects is the appearance of speed improvements like so-called “</span><span lang=EN-US>just-in time” (JIT) compilers, Sun’s own “hotspot” technology, and
even native code compilers. Of course, native code compilers will eliminate the
touted cross-platform execution of the compiled programs, but they will also
bring the speed of the executable closer to that of C and C++. And
cross-compiling a program in Java should be a lot easier than doing so in C or
C++. (In theory, you just recompile, but that promise has been made before for
other languages.) </span></p>

<p class=MsoNormal><span lang=EN-US>You can find comparisons of Java and C++
and observations about Java realities in the appendices of the first edition of
this book (Available on this book’s accompanying CD ROM, as well as at <i>www.BruceEckel.com)</i>.</span></p>

<h2><a name="_Toc481064508"></a><a name="_Toc472654714"></a><a
name="_Toc312373818"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>This chapter attempts to give you a feel
for the broad issues of object-oriented programming and Java, including why OOP
is different, and why Java in particular is different, concepts of OOP
methodologies, and finally the kinds of issues you will encounter when moving
your own company to OOP and Java.</span></p>

<p class=MsoNormal><span lang=EN-US>OOP and Java may not be for everyone. It’s
important to evaluate your own needs and decide whether Java will optimally
satisfy those needs, or if you might be better off with another programming
system (including the one you’re currently using). If you know that your needs
will be very specialized for the foreseeable future and if you have specific
constraints that may not be satisfied by Java, then you owe it to yourself to
investigate the alternatives</span><a href="#_ftn19" name="_ftnref19" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[19]</span></span></span></span></a><span lang=EN-US>. Even
if you eventually choose Java as your language, you’ll at least understand what
the options were and have a clear vision of why you took that direction.</span></p>

<p class=MsoNormal><span lang=EN-US>You know what a procedural program looks
like: data definitions and function calls. To find the meaning of such a
program you have to work a little, looking through the function calls and
low-level concepts to create a model in your mind. This is the reason we need
intermediate representations when designing procedural programs—by themselves,
these programs tend to be confusing because the terms of expression are
oriented more toward the computer than to the problem you’re solving.</span></p>

<p class=MsoNormal><span lang=EN-US>Because Java adds many new concepts on top
of what you find in a procedural language, your natural assumption may be that
the <b>main(&nbsp;)</b> in a Java program will be far more complicated than for
the equivalent C program. Here, you’ll be pleasantly surprised: A well-written
Java program is generally far simpler and much easier to understand than the
equivalent C program. What you’ll see are the definitions of the objects that
represent concepts in your problem space (rather than the issues of the
computer representation) and messages sent to those objects to represent the
activities in that space. One of the delights of object-oriented programming is
that, with a well-designed program, it’s easy to understand the code by reading
it. Usually there’s a lot less code as well, because many of your problems will
be solved by reusing existing library code.</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection8>

<h1><a name="OLE_LINK5"></a><a name="_Toc481064509"></a><a name="_Toc477690722"></a><a
name="_Toc375545216"></a><a name="Chapter_2"></a><span lang=EN-US>2: Everything<br>
is an Object</span></h1>

<p class=Intro><span lang=EN-US>Although it is based on C++, Java is more of a
“pure” object-oriented language.</span></p>

<p class=MsoNormal><span lang=EN-US>Both C++ and Java are hybrid languages, but
in Java the designers felt that the hybridization was not as important as it
was in C++. A hybrid language allows multiple programming styles; the reason
C++ is hybrid is to support backward compatibility with the C language. Because
C++ is a superset of the C language, it includes many of that language’s
undesirable features, which can make some aspects of C++ overly complicated.</span></p>

<p class=MsoNormal><span lang=EN-US>The Java language assumes that you want to
do only object-oriented programming. This means that before you can begin you
must shift your mindset into an object-oriented world (unless it’s already
there)<i>.</i> The benefit of this initial effort is the ability to program in
a language that is simpler to learn and to use than many other OOP languages.
In this chapter we’ll see the basic components of a Java program and we’ll
learn that everything in Java is an object, even a Java program.</span></p>

<h2><a name="_Toc481064510"></a><a name="_Toc375545217"><span lang=EN-US>You
manipulate objects <br>
with references</span></a><span lang=EN-US> </span></h2>

<p class=MsoNormal><span lang=EN-US>Each programming language has its own means
of manipulating data. Sometimes the programmer must be constantly aware of what
type of manipulation is going on. Are you manipulating the object directly, or
are you dealing with some kind of indirect representation (a pointer in C or
C++) that must be treated with a special syntax?</span></p>

<p class=MsoNormal><span lang=EN-US>All this is simplified in Java. You treat
everything as an object, so there is a single consistent syntax that you use
everywhere. Although you <i>treat </i>everything as an object, the identifier
you manipulate is actually a “reference” to an object</span><a href="#_ftn20"
name="_ftnref20" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[20]</span></span></span></span></a><span
lang=EN-US>. You might imagine this scene as a television (the object) with
your remote control (the reference). As long as you’re holding this reference,
you have a connection to the television, but when someone says “change the
channel” or “lower the volume,” what you’re manipulating is the reference,
which in turn modifies the object. If you want to move around the room and
still control the television, you take the remote/reference with you, not the
television.</span></p>

<p class=MsoNormal><span lang=EN-US>Also, the remote control can stand on its
own, with no television. That is, just because you have a reference doesn’t
mean there’s necessarily an object connected to it. So if you want to hold a
word or sentence, you create a <b>String</b> reference:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>String s;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>But here you’ve created <i>only</i> the
reference, not an object. If you decided to send a message to <b>s</b> at this
point, you’ll get an error (at run-time) because <b>s</b> isn’t actually
attached to anything (there’s no television). A safer practice, then, is always
to initialize a reference when you create it:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>String s =
&quot;asdf&quot;;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>However, this uses a special Java feature:
strings can be initialized with quoted text. Normally, you must use a more
general type of initialization for objects.</span></p>

<h2><a name="_Toc481064511"></a><a name="_Toc375545218"><span lang=EN-US>You
must create <br>
all the objects</span></a></h2>

<p class=MsoNormal><span lang=EN-US>When you create a reference, you want to
connect it with a new object. You do so, in general, with the <b>new</b>
keyword. <b>new</b> says, “Make me a new one of these objects.” So in the above
example, you can say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>String s = new
String(&quot;asdf&quot;);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Not only does this mean “Make me a new <b>String</b>,”
but it also gives information about <i>how</i> to make the <b>String</b> by
supplying an initial character string.</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, <b>String</b> is not the only
type that exists. Java comes with a plethora of ready-made types. What’s more
important is that you can create your own types. In fact, that’s the
fundamental activity in Java programming, and it’s what you’ll be learning
about in the rest of this book.</span></p>

<h3><a name="_Toc481064512"></a><a name="_Toc375545219"><span lang=EN-US>Where
storage lives</span></a></h3>

<p class=MsoNormal><span lang=EN-US>It’s useful to visualize some aspects of
how things are laid out while the program is running, in particular how memory
is arranged. There are six different places to store data:</span></p>

<p class=Numbered><b><span lang=EN-US>Registers</span></b><span lang=EN-US>.
This is the fastest storage because it exists in a place different from that of
other storage: inside the processor. However, the number of registers is
severely limited, so registers are allocated by the compiler according to its
needs. You don’t have direct control, nor do you see any evidence in your
programs that registers even exist.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>18.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><span
lang=EN-US>The stack</span></b><span lang=EN-US>. This lives in the general RAM
(random-access memory) area, but has direct support from the processor via its <i>stack
pointer</i>. The stack pointer is moved down to create new memory and moved up
to release that memory. This is an extremely fast and efficient way to allocate
storage, second only to registers. The Java compiler must know, while it is
creating the program, the exact size and lifetime of all the data that is
stored on the stack, because it must generate the code to move the stack
pointer up and down. This constraint places limits on the flexibility of your
programs, so while some Java storage exists on the stack—in particular, object
references—Java objects themselves are not placed on the stack.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>19.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><span
lang=EN-US>The heap</span></b><span lang=EN-US>. This is a general-purpose pool
of memory (also in the RAM area) where all Java objects live. The nice thing
about the heap is that, unlike the stack, the compiler doesn’t need to know how
much storage it needs to allocate from the heap or how long that storage must
stay on the heap. Thus, there’s a great deal of flexibility in using storage on
the heap. Whenever you need to create an object, you simply write the code to
create it using <b>new</b>,<b> </b>and the storage is allocated on the heap
when that code is executed. Of course there’s a price you pay for this
flexibility: it takes more time to allocate heap storage than it does to allocate
stack storage (that is, if you even <i>could</i> create objects on the stack in
Java, as you can in C++).</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>20.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Static storage</span></b><span lang=EN-US>. “Static” is used here in
the sense of “in a fixed location” (although it’s also in RAM). Static storage
contains data that is available for the entire time a program is running. You
can use the <b>static</b> keyword to specify that a particular element of an
object is static, but Java objects themselves are never placed in static
storage.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>21.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Constant storage</span></b><span lang=EN-US>. Constant values are
often placed directly in the program code, which is safe since they can never
change. Sometimes constants are cordoned off by themselves so that they can be
optionally placed in read&#8209;only memory (ROM).</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>22.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Non-RAM storage</span></b><span lang=EN-US>. If data lives
completely outside a program it can exist while the program is not running,
outside the control of the program. The two primary examples of this are <i>streamed
objects,</i> in which objects are turned into streams of bytes, generally to be
sent to another machine, and <i>persistent objects, </i>in which the objects
are placed on disk so they will hold their state even when the program is terminated.
The trick with these types of storage is turning the objects into something
that can exist on the other medium, and yet can be resurrected into a regular
RAM-based object when necessary. Java provides support for <i>lightweight
persistence</i>, and future versions of Java might provide more complete
solutions for persistence.</span></p>

<h3><a name="_Toc481064513"></a><a name="_Toc375545220"><span lang=EN-US>Special
case: primitive types</span></a></h3>

<p class=MsoNormal><span lang=EN-US>There is a group of types that gets special
treatment; you can think of these as “primitive” types that you use quite often
in your programming. The reason for the special treatment is that to create an
object with <b>new</b>—especially a small, simple variable—isn’t very efficient
because <b>new</b> places objects on the heap. For these types Java falls back
on the approach taken by C and C++. That is, instead of creating the variable
using <b>new</b>, an “automatic” variable is created that <i>is not a reference</i>.
The variable holds the value, and it’s placed on the stack so it’s much more
efficient.</span></p>

<p class=MsoNormal><span lang=EN-US>Java determines the size of each primitive
type. These sizes don’t change from one machine architecture to another as they
do in most languages. This size invariance is one reason Java programs are so
portable.</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr>
   <td width=96 valign=top style='width:72.0pt;border-top:black 1.5pt;
   border-left:black 1.5pt;border-bottom:windowtext 1.5pt;border-right:black 1.0pt;
   border-style:solid;padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Primitive type</span></p>
   </td>
   <td width=60 valign=top style='width:45.0pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Size</span></p>
   </td>
   <td width=96 valign=top style='width:72.0pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Minimum</span></p>
   </td>
   <td width=114 valign=top style='width:85.65pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Maximum</span></p>
   </td>
   <td width=105 valign=top style='width:78.9pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Wrapper type</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>—</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>—</span></p>
  </td>
  <td width=114 valign=top style='width:85.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>—</span></p>
  </td>
  <td width=105 valign=top style='width:78.9pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Boolean</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>char</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>16-bit</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Unicode 0</span></p>
  </td>
  <td width=114 valign=top style='width:85.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Unicode 2<sup>16</sup>-
  1</span></p>
  </td>
  <td width=105 valign=top style='width:78.9pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Character</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>byte </span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>8-bit</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>-128</span></p>
  </td>
  <td width=114 valign=top style='width:85.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>+127</span></p>
  </td>
  <td width=105 valign=top style='width:78.9pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Byte</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>short</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>16-bit</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>-2<sup>15</sup></span></p>
  </td>
  <td width=114 valign=top style='width:85.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>+2<sup>15</sup>—1</span></p>
  </td>
  <td width=105 valign=top style='width:78.9pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Short</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>int</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>32-bit</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>-2<sup>31</sup></span></p>
  </td>
  <td width=114 valign=top style='width:85.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>+2<sup>31</sup>—1</span></p>
  </td>
  <td width=105 valign=top style='width:78.9pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Integer</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>long</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>64-bit</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>-2<sup>63</sup></span></p>
  </td>
  <td width=114 valign=top style='width:85.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>+2<sup>63</sup>—1</span></p>
  </td>
  <td width=105 valign=top style='width:78.9pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Long</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>float</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>32-bit</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>IEEE754</span></p>
  </td>
  <td width=114 valign=top style='width:85.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>IEEE754</span></p>
  </td>
  <td width=105 valign=top style='width:78.9pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Float</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>double</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>64-bit </span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>IEEE754</span></p>
  </td>
  <td width=114 valign=top style='width:85.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>IEEE754</span></p>
  </td>
  <td width=105 valign=top style='width:78.9pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Double</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>void</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>—</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>—</span></p>
  </td>
  <td width=114 valign=top style='width:85.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>—</span></p>
  </td>
  <td width=105 valign=top style='width:78.9pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Void</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>All numeric types are signed, so don’t
go looking for unsigned types.</span></p>

<p class=TableFollower><span lang=EN-US>The size of the <b>boolean</b> type is
not explicitly defined; it is only specified to be able to take the literal
values <b>true</b> or <b>false</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The primitive data types also have
“wrapper”<i> </i>classes for them. That means that if you want to make a
nonprimitive object on the heap to represent that primitive type, you use the
associated wrapper. For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>char c = 'x';</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Character C = new
Character(c);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Or you could also use:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Character C = new
Character('x');</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The reasons for doing this will be shown in
a later chapter.</span></p>

<h4><span lang=EN-US>High-precision numbers</span></h4>

<p class=MsoNormal><span lang=EN-US>Java includes two classes for performing
high-precision arithmetic: <b>BigInteger</b> and <b>BigDecimal</b>. Although
these approximately fit into the same category as the “wrapper” classes,
neither one has a primitive analogue.</span></p>

<p class=MsoNormal><span lang=EN-US>Both classes have methods that provide
analogues for the operations that you perform on primitive types. That is, you
can do anything with a <b>BigInteger</b> or <b>BigDecimal </b>that you can with
an <b>int</b> or <b>float</b>, it’s just that you must use method calls instead
of operators. Also, since there’s more involved, the operations will be slower.
You’re exchanging speed for accuracy.</span></p>

<p class=MsoNormal><b><span lang=EN-US>BigInteger</span></b><span lang=EN-US> supports
arbitrary-precision integers. This means that you can accurately represent
integral values of any size without losing any information during operations.</span></p>

<p class=MsoNormal><b><span lang=EN-US>BigDecimal</span></b><span lang=EN-US>
is for arbitrary-precision fixed-point numbers; you can use these for accurate
monetary calculations, for example.</span></p>

<p class=MsoNormal><span lang=EN-US>Consult your online documentation for
details about the constructors and methods you can call for these two classes.</span></p>

<h3><a name="_Toc481064514"></a><a name="_Toc375545221"><span lang=EN-US>Arrays
in Java</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Virtually all programming languages support
arrays. Using arrays in C and C++ is perilous because those arrays are only
blocks of memory. If a program accesses the array outside of its memory block
or uses the memory before initialization (common programming errors) there will
be unpredictable results.</span></p>

<p class=MsoNormal><span lang=EN-US>One of the primary goals of Java is safety,
so many of the problems that plague programmers in C and C++ are not repeated
in Java. A Java array is guaranteed to be initialized and cannot be accessed
outside of its range. The range checking comes at the price of having a small
amount of memory overhead on each array as well as verifying the index at
run-time, but the assumption is that the safety and increased productivity is
worth the expense.</span></p>

<p class=MsoNormal><span lang=EN-US>When you create an array of objects, you
are really creating an array of references, and each of those references is
automatically initialized to a special value with its own keyword: </span><span lang=EN-US><b>null</b>. When Java sees <b>null</b>, it recognizes that the
reference in question isn’t pointing to an object.<b> </b>You must assign an
object to each reference before you use it, and if you try to use a reference
that’s still <b>null,</b> the problem will be reported at run-time. Thus,
typical array errors are prevented in Java.</span></p>

<p class=MsoNormal><span lang=EN-US>You can also create an array of primitives.
Again, the compiler guarantees initialization because it zeroes the memory for
that array.</span></p>

<p class=MsoNormal><span lang=EN-US>Arrays will be covered in detail in later
chapters.</span></p>

<h2><a name="_Toc481064515"></a><a name="_Toc375545222"><span lang=EN-US>You
never need to <br>
destroy an object</span></a></h2>

<p class=MsoNormal><span lang=EN-US>In most programming languages, the concept
of the lifetime of a variable occupies a significant portion of the programming
effort. How long does the variable last? If you are supposed to destroy it,
when should you? Confusion over variable lifetimes can lead to a lot of bugs,
and this section shows how Java greatly simplifies the issue by doing all the
cleanup work for you.</span></p>

<h3><a name="_Toc481064516"></a><a name="_Toc375545223"><span lang=EN-US>Scoping</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Most procedural languages have the concept
of <i>scope</i>. This determines both the visibility and lifetime of the names
defined within that scope. In C, C++, and Java, scope is determined by the
placement of curly braces <b>{}</b>. So for example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int x = 12;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  /* only x available */</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int q = 96;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    /* both x &amp; q
available */</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  /* only x available */</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  /* q “out of scope” */</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>A variable defined within a scope is
available only to the end of that scope.</span></p>

<p class=MsoNormal><span lang=EN-US>Indentation makes Java code easier to read.
Since Java is a free-form language, the extra spaces, tabs, and carriage
returns do not affect the resulting program.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that you <i>cannot</i> do the
following, even though it is legal in C and C++:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int x = 12;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int x = 96; /*
illegal */</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The compiler will announce that the
variable <b>x </b>has already been defined. Thus the C and C++ ability to
“hide” a variable in a larger scope is not allowed because the Java designers
thought that it led to confusing programs.</span></p>

<h3><a name="_Toc481064517"></a><a name="_Toc375545224"><span lang=EN-US>Scope
of objects</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Java objects do not have the same lifetimes
as primitives. When you create a Java object using <b>new</b>, it hangs around
past the end of the scope. Thus if you use:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String s = new
String(&quot;a string&quot;);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} /* end of scope
*/</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>the reference <b>s</b> vanishes at the end
of the scope. However, the <b>String</b> object that <b>s</b> was pointing to
is still occupying memory. In this bit of code, there is no way to access the
object because the only reference to it is out of scope. In later chapters
you’ll see how the reference to the object can be passed around and duplicated
during the course of a program.</span></p>

<p class=MsoNormal><span lang=EN-US>It turns out that because objects created
with <b>new</b> stay around for as long as you want them, a whole slew of C++
programming problems simply vanish in Java. The hardest problems seem to occur
in C++ because you don’t get any help from the language in making sure that the
objects are available when they’re needed. And more important, in C++ you must
make sure that you destroy the objects when you’re done with them.</span></p>

<p class=MsoNormal><span lang=EN-US>That brings up an interesting question. If
Java leaves the objects lying around, what keeps them from filling up memory
and halting your program? This is exactly the kind of problem that would occur
in C++. This is where a bit of magic happens. Java has a <i>garbage collector</i>,
which looks at all the objects that were created with <b>new</b> and figures
out which ones are not being referenced anymore. Then it releases the memory
for those objects, so the memory can be used for new objects. This means that
you never need to worry about reclaiming memory yourself. You simply create
objects, and when you no longer need them they will go away by themselves. This
eliminates a certain class of programming problem: the so-called “memory leak,”
in which a programmer forgets to release memory.</span></p>

<h2><a name="_Toc481064518"></a><a name="_Toc375545225"><span lang=EN-US>Creating
new <br>
data types: class</span></a></h2>

<p class=MsoNormal><span lang=EN-US>If everything is an object, what determines
how a particular class of object looks and behaves? Put another way, what
establishes the <i>type</i> of an object? You might expect there to be a
keyword called “type,” and that certainly would have made sense. Historically,
however, most object-oriented languages have used the keyword <b>class</b> to
mean “I’m about to tell you what a new type of object looks like.” The <b>class</b>
keyword (which is so common that it will not be emboldened throughout this
book) is followed by the name of the new type. For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>class ATypeName {
/* class body goes here */ }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This introduces a new type, so you can now
create an object of this type using <b>new</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>ATypeName a = new
ATypeName();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>ATypeName</b>, the class body
consists only of a comment (the stars and slashes and what is inside, which
will be discussed later in this chapter), so there is not too much that you can
do with it. In fact, you cannot tell it to do much of anything (that is, you
cannot send it any interesting messages) until you define some methods for it.</span></p>

<h3><a name="_Toc481064519"></a><a name="_Toc375545226"><span lang=EN-US>Fields
and methods</span></a></h3>

<p class=MsoNormal><span lang=EN-US>When you define a class (and all you do in
Java is define classes, make objects of those classes, and send messages to
those objects), you can put two types of elements in your class: data members
(sometimes called <i>fields</i>), and member functions (typically called <i>methods</i>).
A data member is an object of any type that you can communicate with via its
reference. It can also be one of the primitive types (which isn’t a reference).
If it is a reference to an object, you must initialize that reference to
connect it to an actual object (using <b>new</b>, as seen earlier) in a special
function called a <i>constructor</i> (described fully in Chapter 4). If it is a
primitive type you can initialize it directly at the point of definition in the
class. (As you’ll see later, references can also be initialized at the point of
definition.)</span></p>

<p class=MsoNormal><span lang=EN-US>Each object keeps its own storage for its
data members; the data members are not shared among objects. Here is an example
of a class with some data members:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class DataOnly {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float f;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean b;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This class doesn’t <i>do</i> anything, but
you can create an object:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>DataOnly d = new
DataOnly();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can assign values to the data members,
but you must first know how to refer to a member of an object. This is
accomplished by stating the name of the object reference, followed by a period
(dot), followed by the name of the member inside the object:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>objectReference.member</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>d.i = 47;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>d.f = 1.1f;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>d.b = false;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It is also possible that your object might
contain other objects that contain data you’d like to modify. For this, you
just keep “connecting the dots.” For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>myPlane.leftTank.capacity
= 100;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>DataOnly </b>class cannot do much of
anything except hold data, because it has no member functions (methods). To
understand how those work, you must first understand <i>arguments</i> and <i>return
values</i>, which will be described shortly.</span></p>

<h4><span lang=EN-US>Default values for primitive members</span></h4>

<p class=MsoNormal><span lang=EN-US>When a primitive data type is a member of a
class, it is guaranteed to get a default value if you do not initialize it:</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr>
   <td width=133 valign=top style='width:100.05pt;border-top:black 1.5pt;
   border-left:black 1.5pt;border-bottom:windowtext 1.5pt;border-right:black 1.0pt;
   border-style:solid;padding:0cm 0cm 0cm 0cm'>
   <p class=Table style='page-break-after:avoid'><span lang=EN-US>Primitive
   type</span></p>
   </td>
   <td width=143 valign=top style='width:106.95pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Default</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td width=133 valign=top style='width:100.05pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean</span></p>
  </td>
  <td width=143 valign=top style='width:106.95pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>false</span></p>
  </td>
 </tr>
 <tr>
  <td width=133 valign=top style='width:100.05pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>char</span></p>
  </td>
  <td width=143 valign=top style='width:106.95pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>‘\u0000’ (null)</span></p>
  </td>
 </tr>
 <tr>
  <td width=133 valign=top style='width:100.05pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>byte</span></p>
  </td>
  <td width=143 valign=top style='width:106.95pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>(byte)0</span></p>
  </td>
 </tr>
 <tr>
  <td width=133 valign=top style='width:100.05pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>short</span></p>
  </td>
  <td width=143 valign=top style='width:106.95pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>(short)0</span></p>
  </td>
 </tr>
 <tr>
  <td width=133 valign=top style='width:100.05pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>int</span></p>
  </td>
  <td width=143 valign=top style='width:106.95pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>0</span></p>
  </td>
 </tr>
 <tr>
  <td width=133 valign=top style='width:100.05pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>long</span></p>
  </td>
  <td width=143 valign=top style='width:106.95pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>0L</span></p>
  </td>
 </tr>
 <tr>
  <td width=133 valign=top style='width:100.05pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>float</span></p>
  </td>
  <td width=143 valign=top style='width:106.95pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>0.0f</span></p>
  </td>
 </tr>
 <tr>
  <td width=133 valign=top style='width:100.05pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>double</span></p>
  </td>
  <td width=143 valign=top style='width:106.95pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>0.0d</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>Note carefully that the default values
are what Java guarantees when the variable is used <i>as a member of a class</i>.
This ensures that member variables of primitive types will always be
initialized (something C++ doesn’t do), reducing a source of bugs. However,
this initial value may not be correct or even legal for the program you are writing.
It’s best to always explicitly initialize your variables.</span></p>

<p class=MsoNormal><span lang=EN-US>This guarantee doesn’t apply to “local”
variables—those that are not fields of a class. Thus, if within a function
definition you have:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>int x;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Then <b>x</b> will get some arbitrary value
(as in C and C++); it will not automatically be initialized to zero. You are
responsible for assigning an appropriate value before you use <b>x</b>. If you
forget, Java definitely improves on C++: you get a compile-time error telling
you the variable might not have been initialized. (Many C++ compilers will warn
you about uninitialized variables, but in Java these are errors.)</span></p>

<h2><a name="_Toc481064520"></a><a name="_Toc375545227"><span lang=EN-US>Methods,
arguments, <br>
and return values</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Up until now, the term <i>function</i> has
been used to describe a named subroutine. The term that is more commonly used
in Java is <i>method,</i> as in “a way to do something.” If you want, you can
continue thinking in terms of functions. It’s really only a syntactic
difference, but from now on “method” will be used in this book rather than
“function.”</span></p>

<p class=MsoNormal><span lang=EN-US>Methods in Java determine the messages an
object can receive. In this section you will learn how simple it is to define a
method.</span></p>

<p class=MsoNormal><span lang=EN-US>The fundamental parts of a method are the
name, the arguments, the return type, and the body. Here is the basic form:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>returnType methodName(
/* argument list */ ) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  /* Method body */</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The return type is the type of the value
that pops out of the method after you call it. The argument list gives the
types and names for the information you want to pass into the method. The
method name and argument list together uniquely identify the method. </span></p>

<p class=MsoNormal><span lang=EN-US>Methods in Java can be created only as part
of a class. A method can be called only for an object,</span><a href="#_ftn21"
name="_ftnref21" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[21]</span></span></span></span></a><span
lang=EN-US> and that object must be able to perform that method call. If you
try to call the wrong method for an object, you’ll get an error message at
compile-time. You call a method for an object by naming the object followed by
a period (dot), followed by the name of the method and its argument list, like
this: <b>objectName.methodName(arg1, arg2, arg3)</b>. For example, suppose you
have a method <b>f(&nbsp;)</b> that takes no arguments and returns a value of
type <b>int</b>. Then, if you have an object called <b>a</b> for which <b>f(&nbsp;)</b>
can be called, you can say this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>int x = a.f();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The type of the return value must be
compatible with the type of <b>x</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>This act of calling a method is commonly
referred to as <i>sending a message to an object</i>. In the above example, the
message is <b>f(&nbsp;)</b> and the object is <b>a</b>. Object-oriented
programming is often summarized as simply “sending messages to objects.”</span></p>

<h3><a name="_Toc481064521"></a><a name="_Toc375545228"><span lang=EN-US>The
argument list</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The method argument list specifies what
information you pass into the method. As you might guess, this information—like
everything else in Java—takes the form of objects. So, what you must specify in
the argument list are the types of the objects to pass in and the name to use
for each one. As in any situation in Java where you seem to be handing objects
around, you are actually passing references</span><a href="#_ftn22"
name="_ftnref22" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[22]</span></span></span></span></a><span
lang=EN-US>. The type of the reference must be correct, however. If the
argument is supposed to be a <b>String</b>, what you pass in must be a string.</span></p>

<p class=MsoNormal><span lang=EN-US>Consider a method that takes a <b>String</b>
as its argument. Here is the definition, which must be placed within a class
definition for it to be compiled:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>int storage(String s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  return s.length() * 2;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This method tells you how many bytes are required
to hold the information in a particular <b>String. </b>(Each <b>char </b>in a <b>String
</b>is 16 bits, or two bytes, long, to support Unicode characters.) The
argument is of type <b>String</b> and is called <b>s</b>. Once <b>s</b> is
passed into the method, you can treat it just like any other object. (You can
send messages to it.) Here, the <b>length(&nbsp;)</b> method is called, which
is one of the methods for <b>String</b>s; it returns the number of characters
in a string.</span></p>

<p class=MsoNormal><span lang=EN-US>You can also see the use of the <b>return</b>
keyword, which does two things. First, it means “leave the method, I’m done.”
Second, if the method produces a value, that value is placed right after the <b>return</b>
statement. In this case, the return value is produced by evaluating the
expression <b>s.length(&nbsp;) * 2</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>You can return any type you want, but if
you don’t want to return anything at all, you do so by indicating that the
method returns <b>void</b>. Here are some examples:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>boolean flag() { return
true; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>float naturalLogBase() {
return 2.718f; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>void nothing() { return;
}</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>void nothing2() {}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When the return type is <b>void</b>, then
the <b>return</b> keyword is used only to exit the method, and is therefore
unnecessary when you reach the end of the method. You can return from a method
at any point, but if you’ve given a non-<b>void </b>return type then the
compiler will force you (with error messages) to return the appropriate type of
value regardless of where you return.</span></p>

<p class=MsoNormal><span lang=EN-US>At this point, it can look like a program
is just a bunch of objects with methods that take other objects as arguments
and send messages to those other objects. That is indeed much of what goes on,
but in the following chapter you’ll learn how to do the detailed low-level work
by making decisions within a method. For this chapter, sending messages will
suffice.</span></p>

<h2><a name="_Toc481064522"></a><a name="_Toc375545229"><span lang=EN-US>Building
a Java program</span></a></h2>

<p class=MsoNormal><span lang=EN-US>There are several other issues you must
understand before seeing your first Java program.</span></p>

<h3><a name="_Toc481064523"></a><a name="_Toc375545230"><span lang=EN-US>Name
visibility</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A problem in any programming language is
the control of names. If you use a name in one module of the program, and
another programmer uses the same name in another module, how do you distinguish
one name from another and prevent the two names from “clashing?” In C this is a
particular problem because a program is often an unmanageable sea of names. C++
classes (on which Java classes are based) nest functions within classes so they
cannot clash with function names nested within other classes. However, C++
still allowed global data and global functions, so clashing was still possible.
To solve this problem, C++ introduced <i>namespaces</i> using additional
keywords.</span></p>

<p class=MsoNormal><span lang=EN-US>Java was able to avoid all of this by
taking a fresh approach. To produce an unambiguous name for a library, the
specifier used is not unlike an Internet domain name. In fact, the Java
creators want you to use your Internet domain name in reverse since those are
guaranteed to be unique. Since my domain name is <b>BruceEckel.com</b>, my
utility library of foibles would be named <b>com.bruceeckel.utility.foibles</b>.
After your reversed domain name, the dots are intended to represent
subdirectories.</span></p>

<p class=MsoNormal><span lang=EN-US>In Java 1.0 and Java 1.1 the domain extensions
<b>com</b>, <b>edu</b>, <b>org</b>, <b>net</b>, etc., were </span><span lang=EN-US>capitalized by convention, so the library would appear: <b>COM.bruceeckel.utility.foibles</b>.
Partway through the development of Java 2, however, it was discovered that this
caused problems, and so now the entire package name is lowercase.</span></p>

<p class=MsoNormal><span lang=EN-US>This mechanism means that all of your files
automatically live in their own namespaces, and each class within a file must
have a unique identifier. So you do not need to learn special language features
to solve this problem—the language takes care of it for you.</span></p>

<h3><a name="_Toc481064524"></a><a name="_Toc375545231"><span lang=EN-US>Using
other components</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Whenever you want to use a predefined class
in your program, the compiler must know how to locate it. Of course, the class
might already exist in the same source code file that it’s being called from.
In that case, you simply use the class—even if the class doesn’t get defined
until later in the file. Java eliminates the “forward referencing” problem so
you don’t need to think about it.</span></p>

<p class=MsoNormal><span lang=EN-US>What about a class that exists in some
other file? You might think that the compiler should be smart enough to simply
go and find it, but there is a problem. Imagine that you want to use a class of
a particular name, but more than one definition for that class exists
(presumably these are different definitions). Or worse, imagine that you’re
writing a program, and as you’re building it you add a new class to your
library that conflicts with the name of an existing class.</span></p>

<p class=MsoNormal><span lang=EN-US>To solve this problem, you must eliminate
all potential ambiguities. This is accomplished by telling the Java compiler
exactly what classes you want using the <b>import</b> keyword. <b>import </b>tells
the compiler to bring in a <i>package</i>, which is a library of classes. (In
other languages, a library could consist of functions and data as well as
classes, but remember that all code in Java must be written inside a class.) </span></p>

<p class=MsoNormal><span lang=EN-US>Most of the time you’ll be using components
from the standard Java libraries that come with your compiler. With these, you
don’t need to worry about long, reversed domain names; you just say, for
example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>import
java.util.ArrayList;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>to tell the compiler that you want to use
Java’s <b>ArrayList</b> class. However, <b>util</b> contains a number of
classes and you might want to use several of them without declaring them all
explicitly. This is easily accomplished by using ‘<b>*</b>’ to indicate a wild
card:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>import
java.util.*;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It is more common to import a collection of
classes in this manner than to import classes individually.</span></p>

<h3><a name="_Toc481064525"></a><a name="_Toc375545232"><span lang=EN-US>The <b>static</b>
keyword</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Ordinarily, when you create a class you are
describing how objects of that class look and how they will behave. You don’t
actually get anything until you create an object of that class with <b>new</b>,
and at that point data storage is created and methods become available.</span></p>

<p class=MsoNormal><span lang=EN-US>But there are two situations in which this
approach is not sufficient. One is if you want to have only one piece of
storage for a particular piece of data, regardless of how many objects are
created, or even if no objects are created. The other is if you need a method
that isn’t associated with any particular object of this class. That is, you
need a method that you can call even if no objects are created. You can achieve
both of these effects with the <b>static</b> keyword. When you say something is
<b>static</b>, it means that data or method is not tied to any particular
object instance of that class. So even if you’ve never created an object of
that class you can call a <b>static</b> method or access a piece of <b>static</b>
data. With ordinary, non-<b>static</b> data and methods you must create an
object and use that object to access the data or method, since non-<b>static</b>
data and methods must know the particular object they are working with. Of
course, since <b>static</b> methods don’t need any objects to be created before
they are used, they cannot <i>directly </i>access non-<b>static</b> members or
methods by simply calling those other members without referring to a named
object (since non-<b>static</b> members and methods must be tied to a
particular object).</span></p>

<p class=MsoNormal><span lang=EN-US>Some object-oriented languages use the
terms <i>class data</i> and <i>class methods</i>, meaning that the data and
methods exist only for the class as a whole, and not for any particular objects
of the class. Sometimes the Java literature uses these terms too.</span></p>

<p class=MsoNormal><span lang=EN-US>To make a data member or method <b>static</b>,
you simply place the keyword before the definition. For example, the following
produces a <b>static</b> data member and initializes it:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class StaticTest {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    static int i = 47;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now even if you make two <b>StaticTest</b>
objects, there will still be only one piece of storage for <b>StaticTest.i.</b>
Both objects will share the same <b>i</b>.<b> </b>Consider:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>StaticTest st1 = new
StaticTest();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>StaticTest st2 =
new StaticTest();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>At this point, both <b>st1.i</b> and <b>st2.i</b>
have the same value of 47 since they refer to the same piece of memory.</span></p>

<p class=MsoNormal><span lang=EN-US>There are two ways to refer to a <b>static</b>
variable. As indicated above, you can name it via an object, by saying, for
example, <b>st2.i</b>. You can also refer to it directly through its class
name, something you cannot do with a non-static member. (This is the preferred
way to refer to a <b>static</b> variable since it emphasizes that variable’s <b>static</b>
nature.)</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>StaticTest.i++;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>++</b> operator increments the
variable. At this point, both <b>st1.i</b> and <b>st2.i</b> will have the value
48.</span></p>

<p class=MsoNormal><span lang=EN-US>Similar logic applies to static methods.
You can refer to a static method either through an object as you can with any
method, or with the special additional syntax <b>ClassName.method(&nbsp;)</b>.
You define a static method in a similar way:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class StaticFun {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void incr() {
StaticTest.i++; }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the <b>StaticFun</b>
method <b>incr(&nbsp;)</b> increments the <b>static</b> data <b>i</b>. You can
call <b>incr(&nbsp;)</b> in the typical way, through an object:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>StaticFun sf = new
StaticFun();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>sf.incr();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Or, because <b>incr(&nbsp;) </b>is a static
method, you can call it directly through its class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>StaticFun.incr();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>While <b>static</b>, when applied to a data
member, definitely changes the way the data is created (one for each class vs.
the non-<b>static </b>one for each object), when applied to a method it’s not
so dramatic. An important use of <b>static</b> for methods is to allow you to
call that method without creating an object. This is essential, as we will see,
in defining the <b>main(&nbsp;)</b> method that is the entry point for running
an application.</span></p>

<p class=MsoNormal><span lang=EN-US>Like any method, a <b>static</b> method can
create or use named objects of its type, so a <b>static</b> method is often
used as a “shepherd” for a flock of instances of its own type.</span></p>

<h2><a name="_Toc481064526"></a><a name="_Toc375545233"><span lang=EN-US>Your
first Java program</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Finally, here’s the program.</span><a
href="#_ftn23" name="_ftnref23" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[23]</span></span></span></span></a><span
lang=EN-US> It starts by printing a string, and then the date, using the <b>Date
</b>class from the Java standard library. Note that an additional style of comment
is introduced here: the ‘<b>//</b>’, which is a comment until the end of the
line:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// HelloDate.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class HelloDate {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Hello, it's: &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(new Date());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>At the beginning of each program file, you
must place the <b>import</b> statement to bring in any extra classes you’ll
need for the code in that file. Note that I say “extra;” that’s because there’s
a certain library of classes that are automatically brought into every Java
file: <b>java.lang</b>. Start up your Web browser and look at the documentation
from Sun. (If you haven’t downloaded it from <i>java.sun.com</i> or otherwise
installed the Java documentation, do so now). If you look at the list of the
packages, you’ll see all the different class libraries that come with Java.
Select <b>java.lang</b>. This will bring up a list of all the classes that are
part of that library. Since <b>java.lang</b> is implicitly included in every
Java code file, these classes are automatically available. There’s no <b>Date</b>
class listed in <b>java.lang</b>, which means you must import another library
to use that. If you don’t know the library where a particular class is, or if
you want to see all of the classes, you can select “Tree” in the Java documentation.
Now you can find every single class that comes with Java. Then you can use the
browser’s “find” function to find <b>Date</b>.<b> </b>When you do you’ll see it
listed as <b>java.util.Date</b>, which lets you know that it’s in the <b>util</b>
library and that you must <b>import java.util.*</b> in order to use <b>Date</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>If you go back to the beginning, select <b>java.lang</b>
and then <b>System</b>, you’ll see that the <b>System</b> class has several
fields, and if you select <b>out</b> you’ll discover that it’s a <b>static</b> <b>PrintStream
</b>object. Since it’s <b>static</b> you don’t need to create anything. The <b>out</b>
object is always there and you can just use it. What you can do with this <b>out</b>
object is determined by the type it is: a <b>PrintStream</b>. Conveniently, <b>PrintStream
</b>is shown in the description as a hyperlink, so if you click on that you’ll
see a list of all the methods you can call for <b>PrintStream</b>. There are
quite a few and these will be covered later in this book. For now all we’re
interested in is <b>println(&nbsp;)</b>, which in effect means “print what I’m
giving you out to the console and end with a new line.” Thus, in any Java program
you write you can say <b>System.out.println(“things”)</b> whenever you want to
print something to the console.</span></p>

<p class=MsoNormal><span lang=EN-US>The name of the class is the same as the
name of the file. When you’re creating a stand-alone program such as this one,
one of the classes in the file must have the same name as the file. (The
compiler complains if you don’t do this.) That class must contain a method
called <b>main(&nbsp;)</b> with the signature shown:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>public static void
main(String[] args) {</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>public</b> keyword means that the
method is available to the outside world (described in detail in Chapter 5).
The argument to <b>main(&nbsp;)</b> is an array of <b>String</b> objects. The <b>args</b>
won’t be used in this program, but the Java compiler insists that they be there
because they hold the arguments invoked on the command line.</span></p>

<p class=MsoNormal><span lang=EN-US>The line that prints the date is quite
interesting:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>System.out.println(new
Date());</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Consider the argument: a <b>Date</b> object
is being created just to send its value to <b>println(&nbsp;)</b>. As soon as
this statement is finished, that <b>Date</b> is unnecessary, and the garbage
collector can come along and get it anytime. We don’t need to worry about
cleaning it up.</span></p>

<h3><a name="_Toc375545234"></a><a name="_Toc481064527"><span lang=EN-US>Compiling
and running</span></a></h3>

<p class=MsoNormal><span lang=EN-US>To compile</span><span lang=EN-US> and run this program, and all the other programs in this book, you
must first have a Java programming environment. There are a number of
third-party development environments, but in this book we will assume that you
are using the JDK from Sun, which is free. If you are using another development
system, you will need to look in the documentation for that system to determine
how to compile and run programs.</span></p>

<p class=MsoNormal><span lang=EN-US>Get on the Internet and go to <i>java.sun.com</i>.
There you will find information and links that will lead you through the
process of downloading and installing the JDK for your particular platform.</span></p>

<p class=MsoNormal><span lang=EN-US>Once the JDK is installed, and you’ve set
up your computer’s path information so that it will find <b>javac</b></span><span lang=EN-US> and <b>java</b>, download and unpack the source code for this book
(you can find it on the CD ROM that’s bound in with this book, or at <i>www.BruceEckel.com</i>).
This will create a subdirectory for each chapter in this book. Move to subdirectory
<b>c02</b> and type:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>javac
HelloDate.java</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This command should produce no response. If
you get any kind of an error message it means you haven’t installed the JDK
properly and you need to investigate those problems. </span></p>

<p class=MsoNormal><span lang=EN-US>On the other hand, if you just get your
command prompt back, you can type:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>java HelloDate</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>and you’ll get the message and the date as
output.</span></p>

<p class=MsoNormal><span lang=EN-US>This is the process you can use to compile
and run each of the programs in this book. However, you will see that the
source code for this book also has a file called <b>makefile</b> in each
chapter, and this contains “make” commands for automatically building the files
for that chapter. See this book’s Web page at <i>www.BruceEckel.com</i> for
details on how to use the makefiles.</span></p>

<h2><a name="_Toc481064528"><span lang=EN-US>Comments and embedded
documentation</span></a></h2>

<p class=MsoNormal><span
lang=EN-US>There are two types of comments in Java. The first is the
traditional C-style comment that was inherited by C++. These comments begin
with a <b>/*</b> and continue, possibly across many lines, until a <b>*/</b>.
Note that many programmers will begin each line of a continued comment with a <b>*</b>,
so you’ll often see:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>/* This is a comment</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>*  that continues</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>*  across lines</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>*/</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Remember, however, that everything inside
the <b>/*</b> and <b>*/</b> is ignored, so there’s no difference in saying:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>/* This is a comment
that</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>continues across
lines */</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The second form of comment comes from C++.
It is the single-line comment, which starts at a <b>//</b> and continues until
the end of the line. This type of comment is convenient and commonly used
because it’s easy. You don’t need to hunt on the keyboard to find <b>/</b> and
then <b>*</b> (instead, you just press the same key twice), and you don’t need
to close the comment. So you will often see:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>// this is a
one-line comment</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<h3><a name="_Toc481064529"></a><a name="_Toc375545235"><span lang=EN-US>Comment
documentation</span></a></h3>

<p class=MsoNormal><span lang=EN-US>One of the thoughtful parts of the Java
language is that the designers didn’t consider writing code to be the only
important activity—they also thought about documenting it. Possibly the biggest
problem with documenting code has been maintaining that documentation. If the
documentation and the code are separate, it becomes a hassle to change the
documentation every time you change the code. The solution seems simple: link
the code to the documentation. The easiest way to do this is to put everything
in the same file. To complete the picture, however, you need a special comment
syntax to mark special documentation, and a tool to extract those comments and
put them in a useful form. This is what Java has done.</span></p>

<p class=MsoNormal><span lang=EN-US>The tool to extract the comments is called <i>javadoc.</i>
It uses some of the technology from the Java compiler to look for special
comment tags you put in your programs. It not only extracts the information
marked by these tags, but it also pulls out the class name or method name that
adjoins the comment. This way you can get away with the minimal amount of work
to generate decent program documentation.</span></p>

<p class=MsoNormal><span lang=EN-US>The output of javadoc is an HTML file that
you can view with your Web browser. This tool allows you to create and maintain
a single source file and automatically generate useful documentation. Because
of javadoc we have a standard for creating documentation, and it’s easy enough
that we can expect or even demand documentation with all Java libraries.</span></p>

<h3><a name="_Toc481064530"></a><a name="_Toc375545236"></a><a
name="_Ref348399283"><span lang=EN-US>Syntax</span></a></h3>

<p class=MsoNormal><span lang=EN-US>All of the javadoc commands occur only
within <b>/**</b> comments. The comments end with <b>*/ </b>as usual. There are
two primary ways to use javadoc: embed HTML, or use “doc tags.” Doc tags are
commands that start with a ‘<b>@</b>’ and are placed at the beginning of a
comment line. (A leading ‘<b>*</b>’, however, is ignored.)</span></p>

<p class=MsoNormal><span lang=EN-US>There are three “types” of comment
documentation, which correspond to the element the comment precedes: class,
variable, or method. That is, a class comment appears right before the
definition of a class; a variable comment appears right in front of the
definition of a variable, and a method comment appears right in front of the
definition of a method. As a simple example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>/** A class comment */</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class docTest {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  /** A variable comment
*/</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  /** A method comment
*/</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void f() {}</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that javadoc will process comment
documentation for only <b>public </b>and <b>protected </b>members. Comments for
<b>private </b>and “friendly” members (see Chapter 5) are ignored and you’ll
see no output. (However, you can use the <b>-private </b>flag to include <b>private</b>
members as well.) This makes sense, since only <b>public</b> and <b>protected</b>
members are available outside the file, which is the client programmer’s
perspective. However, all <b>class</b> comments are included in the output.</span></p>

<p class=MsoNormal><span lang=EN-US>The output for the above code is an HTML
file that has the same standard format as all the rest of the Java
documentation, so users will be comfortable with the format and can easily
navigate your classes. It’s worth entering the above code, sending it through
javadoc and viewing the resulting HTML file to see the results.</span></p>

<h3><a name="_Toc481064531"></a><a name="_Toc375545237"><span lang=EN-US>Embedded
HTML</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Javadoc passes HTML commands through to the
generated HTML document. This allows you full use of HTML; however, the primary
motive is to let you format code, such as:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>/**</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>* &lt;pre&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>* System.out.println(new
Date());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>* &lt;/pre&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>*/</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can also use HTML just as you would in
any other Web document to format the regular text in your descriptions:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>/**</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>* You can
&lt;em&gt;even&lt;/em&gt; insert a list:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>* &lt;ol&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>* &lt;li&gt; Item one</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>* &lt;li&gt; Item two</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>* &lt;li&gt; Item three</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>* &lt;/ol&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>*/</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that within the documentation comment,
asterisks at the beginning of a line are thrown away by javadoc, along with
leading spaces. Javadoc reformats everything so that it conforms to the
standard documentation appearance. Don’t use headings such as <b>&lt;h1&gt;</b>
or <b>&lt;hr&gt;</b> as embedded HTML because javadoc inserts its own headings
and yours will interfere with them.</span></p>

<p class=MsoNormal><span lang=EN-US>All types of comment documentation—class,
variable, and method—can support embedded HTML.</span></p>

<h3><a name="_Toc481064532"></a><a name="_Toc375545238"><b><span lang=EN-US>@see</span></b><span
lang=EN-US>: referring to other classes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>All three types of comment documentation (class,
variable, and method) can contain <b>@see</b> tags, which allow you to refer to
the documentation in other classes. Javadoc will generate HTML with the <b>@see</b>
tags hyperlinked to the other documentation. The forms are:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>@see classname</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>@see fully-qualified-classname</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>@see
fully-qualified-classname#method-name</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Each one adds a hyperlinked “See Also”
entry to the generated documentation. Javadoc will not check the hyperlinks you
give it to make sure they are valid.</span></p>

<h3><a name="_Toc481064533"></a><a name="_Toc375545239"><span lang=EN-US>Class
documentation tags</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Along with embedded HTML and <b>@see </b>references,
class documentation can include tags for version information and the author’s
name. Class documentation can also be used for <i>interfaces</i> (see Chapter
8).</span></p>

<h4><span lang=EN-US>@version</span></h4>

<p class=MsoNormal><span lang=EN-US>This is of the form:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>@version
version-information</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>in which <b>version-information</b> is any
significant information you see fit to include. When the <b>-version</b> flag
is placed on the javadoc command line, the version information will be called
out specially in the generated HTML documentation.</span></p>

<h4><span lang=EN-US>@author</span></h4>

<p class=MsoNormal><span lang=EN-US>This is of the form:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>@author author-information</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>in which <b>author-information</b> is,
presumably, your name, but it could also include your email address or any
other appropriate information. When the <b>-author </b>flag is placed on the
javadoc command line, the author information will be called out specially in
the generated HTML documentation.</span></p>

<p class=MsoNormal><span lang=EN-US>You can have multiple author tags for a
list of authors, but they must be placed consecutively. All the author
information will be lumped together into a single paragraph in the generated
HTML.</span></p>

<h4><span lang=EN-US>@since</span></h4>

<p class=MsoNormal><span lang=EN-US>This tag allows you to indicate the version
of this code that began using a particular feature. You’ll see it appearing in
the HTML Java documentation to indicate what version of the JDK is used.</span></p>

<h3><a name="_Toc481064534"></a><a name="_Toc375545240"><span lang=EN-US>Variable
documentation tags</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Variable documentation can include only
embedded HTML and <b>@see</b> references.</span></p>

<h3><a name="_Toc481064535"></a><a name="_Toc375545241"><span lang=EN-US>Method
documentation tags</span></a></h3>

<p class=MsoNormal><span lang=EN-US>As well as embedded documentation and <b>@see</b>
references, methods allow documentation tags for parameters, return values, and
exceptions.</span></p>

<h4><span lang=EN-US>@param</span></h4>

<p class=MsoNormal><span lang=EN-US>This is of the form:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>@param <i>parameter</i>-<i>name</i>
<i>description</i></span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>in which <b>parameter-name </b>is the
identifier in the parameter list, and <b>description </b>is text that can
continue on subsequent lines. The description is considered finished when a new
documentation tag is encountered. You can have any number of these, presumably
one for each parameter.</span></p>

<h4><span lang=EN-US>@return</span></h4>

<p class=MsoNormal><span lang=EN-US>This is of the form:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>@return <i>description</i></span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>in which <b>description</b> gives you the
meaning of the return value. It can continue on subsequent lines.</span></p>

<h4><span lang=EN-US>@throws</span></h4>

<p class=MsoNormal><span lang=EN-US>Exceptions will be demonstrated in Chapter
10, but briefly they are objects that can be “thrown” out of a method if that
method fails. Although only one exception object can emerge when you call a
method, a particular method might produce any number of different types of
exceptions, all of which need descriptions. So the form for the exception tag
is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>@throws <i>fully-qualified-class-name
description</i></span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>in which <b>fully-qualified-class-name</b>
gives an unambiguous name of an exception class that’s defined somewhere, and <b>description</b>
(which can continue on subsequent lines) tells you why this particular type of
exception can emerge from the method call.</span></p>

<h4><span lang=EN-US>@deprecated</span></h4>

<p class=MsoNormal><span lang=EN-US>This is used to tag features that were
superseded by an improved feature. The deprecated tag is a suggestion that you
no longer use this particular feature, since sometime in the future it is
likely to be removed. A method that is marked <b>@deprecated</b> causes the
compiler to issue a warning if it is used.</span></p>

<h3><a name="_Toc481064536"></a><a name="_Toc375545242"><span lang=EN-US>Documentation
example</span></a></h3>

<p class=MsoNormal><span lang=EN-US> Here is the first Java program again, this
time with documentation comments added:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c02:HelloDate.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>/** The first Thinking
in Java example program.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> * Displays a string and
today's date.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> * @author Bruce Eckel</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> * @author
www.BruceEckel.com</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> * @version 2.0 </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>*/</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class HelloDate {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  /** Sole entry point
to class &amp; application</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   * @param args array
of string arguments</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   * @return No return
value</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   * @exception
exceptions No exceptions thrown</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  */</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Hello, it's: &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(new Date());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The first line of the file uses my own
technique of putting a ‘<b>:</b>’ as a special marker for the comment line
containing the source file name. That line contains the path information to the
file (in this case, <b>c02 </b>indicates Chapter 2) followed by the file name</span><a
href="#_ftn24" name="_ftnref24" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[24]</span></span></span></span></a><span
lang=EN-US>. The last line also finishes with a comment, and this one indicates
the end of the source code listing, which allows it to be automatically
extracted from the text of this book and checked with a compiler.</span></p>

<h2><a name="_Toc312373851"></a><a name="_Toc481064537"></a><a
name="_Toc375545243"><span lang=EN-US>Coding style</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The unofficial standard in Java is to
capitalize the first letter of a class name. If the class name consists of
several words, they are run together (that is, you don’t use underscores to
separate the names), and the first letter of each embedded word is capitalized,
such as:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>class
AllTheColorsOfTheRainbow { // ...</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>For almost everything else: methods, fields
(member variables), and object reference names, the accepted style is just as
it is for classes <i>except</i> that the first letter of the identifier is
lowercase. For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class
AllTheColorsOfTheRainbow {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int
anIntegerRepresentingColors;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void
changeTheHueOfTheColor(int newHue) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // ...</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, you should remember that the
user must also type all these long names, and so be merciful. </span></p>

<p class=MsoNormal><span lang=EN-US>The Java code you will see in the Sun
libraries also follows the placement of open-and-close curly braces that you
see used in this book.</span></p>

<h2><a name="_Toc481064538"></a><a name="_Toc375545244"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>In this chapter you have seen enough of
Java programming to understand how to write a simple program, and you have gotten
an overview of the language and some of its basic ideas. However, the examples
so far have all been of the form “do this, then do that, then do something
else.” What if you want the program to make choices, such as “if the result of
doing this is red, do that; if not, then do something else”? The support in
Java for this fundamental programming activity will be covered in the next
chapter.</span></p>

<h2><a name="_Toc481064539"></a><a name="_Toc375545245"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>1. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Following the <b>HelloDate.java</b> example in
this chapter, create a “hello, world” program that simply prints out that
statement. You need only a single method in your class (the “main” one that
gets executed when the program starts). Remember to make it <b>static</b> and
to include the argument list, even though you don’t use the argument list.
Compile the program with <b>javac</b> and run it using <b>java</b>. If you are
using a different development environment than the JDK, learn how to compile
and run programs in that environment.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>2. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Find the code fragments involving <b>ATypeName</b>
and turn them into a program that compiles and runs.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>3. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Turn the <b>DataOnly</b> code fragments into a
program that compiles and runs.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>4. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 3 so that the values of the data
in <b>DataOnly</b> are assigned to and printed in <b>main(&nbsp;)</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>5. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a program that includes and calls the <b>storage(&nbsp;)</b>
method defined as a code fragment in this chapter.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>6. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Turn the <b>StaticFun</b> code fragments into a
working program.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>7. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a program that prints three arguments
taken from the command line. To do this, you’ll need to index into the
command-line array of <b>String</b>s.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>8. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Turn the <b>AllTheColorsOfTheRainbow</b> example
into a program that compiles and runs.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>9. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Find the code for the second version of <b>HelloDate.java</b>,
which is the simple comment documentation example. Execute <b>javadoc</b> on
the file and view the results with your Web browser.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>10. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Turn <b>docTest</b> into a file that compiles
and then run it through <b>javadoc</b>. Verify the resulting documentation with
your Web browser.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>11. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add an HTML list of items to the documentation
in Exercise 10.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>12. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Take the program in Exercise 1 and add comment
documentation to it. Extract this comment documentation into an HTML file using
<b>javadoc</b> and view it with your Web browser.<a name="_Toc375545246"></a><a
name="Chapter_3"></a></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection9>

<h1><a name="_Toc481064540"></a><a name="_Toc477690723"><span lang=EN-US>3: Controlling
Program Flow</span></a></h1>

<p class=Intro><span lang=EN-US>Like a sentient creature, a program must
manipulate its world and make choices during execution. </span></p>

<p class=MsoNormal><span lang=EN-US>In Java you manipulate objects and data
using operators, and you make choices with execution control statements. Java
was inherited from C++, so most of these statements and operators will be
familiar to C and C++ programmers. Java has also added some improvements and
simplifications.</span></p>

<p class=MsoNormal><span lang=EN-US>If you find yourself floundering a bit in
this chapter, make sure you go through the multimedia CD ROM bound into this
book: <i>Thinking in C: Foundations for Java and C++</i>. It contains audio
lectures, slides, exercises, and solutions specifically designed to bring you
up to speed with the C syntax necessary to learn Java.</span></p>

<h2><a name="_Toc481064541"></a><a name="_Toc375545247"><span lang=EN-US>Using
Java operators</span></a></h2>

<p class=MsoNormal><span lang=EN-US>An operator takes one or more arguments and
produces a new value. The arguments are in a different form than ordinary
method calls, but the effect is the same. You should be reasonably comfortable
with the general concept of operators from your previous programming
experience. Addition (<b>+</b>), subtraction and unary minus (<b>-</b>),
multiplication (<b>*</b>), division (<b>/</b>), and assignment (<b>=</b>) all
work much the same in any programming language.</span></p>

<p class=MsoNormal><span lang=EN-US>All operators produce a value from their
operands. In addition, an operator can change the value of an operand. This is
called a <i>side effect</i></span><span lang=EN-US>. The most common use for
operators that modify their operands is to generate the side effect, but you
should keep in mind that the value produced is available for your use just as
in operators without side effects.</span></p>

<p class=MsoNormal><span lang=EN-US>Almost all operators work only with
primitives. The exceptions are <b>‘=</b>’, ‘<b>==</b>’ and ‘<b>!=</b>’, which
work with all objects (and are a point of confusion for objects). In addition,
the <b>String </b>class supports ‘<b>+</b>’ and ‘<b>+=</b>’.</span></p>

<h3><a name="_Toc481064542"></a><a name="_Toc375545248"><span lang=EN-US>Precedence</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Operator precedence defines how an
expression evaluates when several operators are present. Java has specific
rules that determine the order of evaluation. The easiest one to remember is
that multiplication and division happen before addition and subtraction.
Programmers often forget the other precedence rules, so you should use
parentheses to make the order of evaluation explicit. For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>A = X + Y - 2/2 +
Z;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>has a very different meaning from the same statement
with a particular grouping of parentheses:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>A = X + (Y - 2)/(2
+ Z);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<h3><a name="_Toc481064543"></a><a name="_Toc375545249"><span lang=EN-US>Assignment</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Assignment is performed with the operator
=. It means “take the value of the right-hand side (often called the <i>rvalue</i></span><span lang=EN-US>) and copy it into the left-hand side (often called the <i>lvalue</i></span><span lang=EN-US>). An rvalue is any constant, variable or expression that can produce
a value, but an lvalue must be a distinct, named variable. (That is, there must
be a physical space to store a value.) For instance, you can assign a constant
value to a variable (<b>A = 4;</b>), but you cannot assign anything to constant
value—it cannot be an lvalue. (You can’t say <b>4 = A;</b>.)</span></p>

<p class=MsoNormal><span lang=EN-US>Assignment of primitives is quite
straightforward. Since the primitive holds the actual value and not a reference
to an object, when you assign primitives you copy the contents from one place
to another. For example, if you say <b>A = B</b> for primitives, then the
contents of <b>B</b> are copied into <b>A</b>. If you then go on to modify <b>A</b>,
<b>B</b> is naturally unaffected by this modification. As a programmer, this is
what you’ve come to expect for most situations.</span></p>

<p class=MsoNormal><span lang=EN-US>When you </span><span lang=EN-US>assign objects, however, things change. Whenever you manipulate an
object, what you’re manipulating is the reference, so when you assign “from one
object to another” you’re actually copying a reference from one place to another.
This means that if you say <b>C = D</b> for objects, you end up with both <b>C</b>
and <b>D</b> pointing to the object that, originally, only <b>D</b> pointed to.
The following example will demonstrate this. </span></p>

<p class=MsoNormal><a name="Running_programs"></a><span lang=EN-US>Here’s the
example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:Assignment.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Assignment with
objects is a bit tricky.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Number {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Assignment
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Number n1 = new
Number();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Number n2 = new
Number();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    n1.i = 9;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    n2.i = 47;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;1: n1.i: &quot; + n1.i +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;, n2.i:
&quot; + n2.i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    n1 = n2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;2: n1.i: &quot; + n1.i +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;, n2.i:
&quot; + n2.i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    n1.i = 27;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;3: n1.i: &quot; + n1.i +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;, n2.i:
&quot; + n2.i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Number</b> class is simple, and two
instances of it (<b>n1</b> and <b>n2</b>) are created within <b>main(&nbsp;)</b>.
The <b>i</b> value within each <b>Number</b> is given a different value, and
then <b>n2</b> is assigned to <b>n1</b>, and <b>n1</b> is changed. In many
programming languages you would expect <b>n1</b> and <b>n2</b> to be
independent at all times, but because you’ve assigned a reference here’s the
output you’ll see:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>1: n1.i: 9, n2.i: 47</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>2: n1.i: 47, n2.i: 47</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>3: n1.i: 27, n2.i:
27</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Changing the <b>n1</b> object appears to
change the <b>n2</b> object as well! This is because both <b>n1</b> and <b>n2</b>
contain the same reference, which is pointing to the same object. (The original
reference that was in <b>n1</b> that pointed to the object holding a value of 9
was overwritten during the assignment and effectively lost; its object will be
cleaned up by the garbage collector.)</span></p>

<p class=MsoNormal><span lang=EN-US>This phenomenon is often called </span><span lang=EN-US><i>aliasing</i> and it’s a fundamental way that Java works with
objects. But what if you don’t want aliasing to occur in this case? You could
forego the assignment and say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>n1.i = n2.i;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This retains the two separate objects
instead of tossing one and tying <b>n1 </b>and <b>n2</b> to the same object,
but you’ll soon realize that manipulating the fields within objects is messy
and goes against good object-oriented design principles. This is a nontrivial
topic, so it is left for Appendix A, which is devoted to aliasing. In the
meantime, you should keep in mind that assignment for objects can add
surprises.</span></p>

<h4><span lang=EN-US>Aliasing during method calls</span></h4>

<p class=MsoNormal><span
lang=EN-US>Aliasing will also occur when you pass an object into a method:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:PassObject.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Passing objects to
methods may not be what</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// you're used to.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Letter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  char c;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class PassObject
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void f(Letter
y) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    y.c = 'z';</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Letter x = new Letter();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.c = 'a';</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;1: x.c: &quot; + x.c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;2: x.c: &quot; + x.c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In many programming languages, the method <b>f(&nbsp;)</b>
would appear to be making a copy of its argument <b>Letter y</b> inside the
scope of the method. But once again a reference is being passed so the line</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>y.c = 'z';</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>is actually changing the object outside of <b>f(&nbsp;)</b>.
The output shows this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>1: x.c: a</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>2: x.c: z</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Aliasing and its solution is a complex
issue and, although you must wait until Appendix A for all the answers, you
should be aware of it at this point so you can watch for pitfalls.</span></p>

<h3><a name="_Toc481064544"></a><a name="_Toc375545250"><span lang=EN-US>Mathematical
operators</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The basic mathematical operators are the
same as the ones available in most programming languages: addition </span><span lang=EN-US>(<b>+</b>), subtraction</span><span
lang=EN-US> (<b>-</b>), division</span><span lang=EN-US> (<b>/</b>), multiplication</span><span lang=EN-US> (<b>*</b>) and modulus</span><span lang=EN-US> (<b>%</b>, which
produces the remainder from integer division). Integer division truncates,
rather than rounds, the result.</span></p>

<p class=MsoNormal><span lang=EN-US>Java also uses a shorthand notation to
perform an operation and an assignment at the same time. This is denoted by an
operator followed by an equal sign, and is consistent with all the operators in
the language (whenever it makes sense). For example, to add 4 to the variable <b>x</b>
and assign the result<b> </b>to <b>x</b>, use: <b>x += 4</b>. </span></p>

<p class=MsoNormal><span lang=EN-US>This example shows the use of the
mathematical operators:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:MathOps.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates the
mathematical operators.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class MathOps {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Create a shorthand
to save typing:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void prt(String
s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // shorthand to print
a string and an int:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
pInt(String s, int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(s + &quot; =
&quot; + i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // shorthand to print
a string and a float:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
pFlt(String s, float f) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(s + &quot; =
&quot; + f);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Create a random
number generator,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // seeds with
current time by default:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Random rand = new
Random();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i, j, k;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // '%' limits maximum
value to 99:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    j = rand.nextInt() %
100;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    k = rand.nextInt() %
100;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pInt(&quot;j&quot;,j);  pInt(&quot;k&quot;,k);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = j + k;
pInt(&quot;j + k&quot;, i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = j - k;
pInt(&quot;j - k&quot;, i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = k / j;
pInt(&quot;k / j&quot;, i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = k * j;
pInt(&quot;k * j&quot;, i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = k % j; pInt(&quot;k
% j&quot;, i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    j %= k; pInt(&quot;j
%= k&quot;, j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Floating-point
number tests:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    float u,v,w;  //
applies to doubles, too</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    v =
rand.nextFloat();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    w =
rand.nextFloat();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pFlt(&quot;v&quot;,
v); pFlt(&quot;w&quot;, w);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    u = v + w;
pFlt(&quot;v + w&quot;, u);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    u = v - w;
pFlt(&quot;v - w&quot;, u);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    u = v * w;
pFlt(&quot;v * w&quot;, u);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    u = v / w;
pFlt(&quot;v / w&quot;, u);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // the following
also works for</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // char, byte,
short, int, long,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // and double:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    u += v; pFlt(&quot;u
+= v&quot;, u);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    u -= v; pFlt(&quot;u
-= v&quot;, u);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    u *= v; pFlt(&quot;u
*= v&quot;, u);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    u /= v; pFlt(&quot;u
/= v&quot;, u);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The first thing you will see are some
shorthand methods for printing: the <b>prt(&nbsp;)</b> method prints a <b>String</b>,
the <b>pInt(&nbsp;)</b> prints a <b>String</b> followed by an <b>int</b> and
the <b>pFlt(&nbsp;)</b> prints a <b>String</b> followed by a <b>float</b>. Of
course, they all ultimately end up using <b>System.out.println(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>To generate numbers, the program first
creates a <b>Random</b> object. Because no arguments are passed during
creation, Java uses the current time as a seed for the random number generator.
The program generates a number of different types of random numbers with the <b>Random</b>
object simply by calling different methods: <b>nextInt(&nbsp;)</b>, <b>nextLong(&nbsp;)</b>,<b>
nextFloat(&nbsp;)</b> or<b> nextDouble(&nbsp;)</b>. </span></p>

<p class=MsoNormal><span lang=EN-US>The modulus operator, when used with the
result of the random number generator, limits the result to an upper bound of
the operand minus one (99 in this case).</span></p>

<h4><span lang=EN-US>Unary minus and plus operators</span></h4>

<p class=MsoNormal><span lang=EN-US>The unary minus (-)</span><span lang=EN-US> and unary plus (+)</span><span lang=EN-US> are the same operators as
binary minus and plus. The compiler figures out which use is intended by the
way you write the expression. For instance, the statement</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>x = -a;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>has an obvious meaning. The compiler is
able to figure out:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>x = a * -b;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>but the reader might get confused, so it is
clearer to say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>x = a * (-b);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The unary minus produces the negative of
the value. Unary plus provides symmetry with unary minus, although it doesn’t
have any effect.</span></p>

<h3><a name="_Toc481064545"></a><a name="_Toc375545251"><span lang=EN-US>Auto
increment and decrement</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Java, like C, is full of shortcuts.
Shortcuts can make code much easier to type, and either easier or harder to
read. </span></p>

<p class=MsoNormal><span lang=EN-US>Two of the nicer shortcuts are the
increment</span><span lang=EN-US> and decrement</span><span
lang=EN-US> operators (often referred to as the auto-increment</span><span lang=EN-US> and auto-decrement</span><span
lang=EN-US> operators). The decrement operator is <b>--</b> and means “decrease
by one unit.” The increment operator is <b>++</b> and means “increase by one
unit.” If <b>a</b> is an <b>int</b>, for example, the expression <b>++a</b> is
equivalent to (<b>a = a + 1</b>). Increment and decrement operators produce the
value of the variable as a result. </span></p>

<p class=MsoNormal><span lang=EN-US>There are two versions of each type of
operator, often called the prefix and postfix versions. Pre-increment means the
<b>++ </b>operator appears before the variable or expression, and
post-increment means the <b>++</b> operator appears after the variable or
expression. Similarly, pre-decrement means the <b>&#8209;&#8209; </b>operator
appears before the variable or expression, and post-decrement means the <b>&#8209;&#8209;</b>
operator appears after the variable or expression. For pre-increment and
pre-decrement, (i.e., <b>++a</b> or <b>&#8209;&#8209;a</b>), the operation is
performed and the value is produced. For post-increment and post-decrement
(i.e. <b>a++ </b>or <b>a&#8209;&#8209;</b>), the value is produced, then the
operation is performed. As an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:AutoInc.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates the ++
and -- operators.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class AutoInc {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i : &quot;
+ i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;++i :
&quot; + ++i); // Pre-increment</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i++ :
&quot; + i++); // Post-increment</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i : &quot;
+ i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;--i :
&quot; + --i); // Pre-decrement</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i-- :
&quot; + i--); // Post-decrement</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i : &quot;
+ i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void prt(String
s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output for this program is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i : 1</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>++i : 2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i++ : 2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i : 3</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>--i : 2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i-- : 2</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>i : 1</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that for the prefix form you
get the value after the operation has been performed, but with the postfix form
you get the value before the operation is performed. These are the only
operators (other than those involving assignment) that have side effects. (That
is, they change the operand rather than using just its value.)</span></p>

<p class=MsoNormal><span lang=EN-US>The increment operator is one explanation
for the name C++, implying “one step beyond C.” In an early Java speech, </span><span lang=EN-US>Bill Joy (one of the creators), said that “Java=C++--” (C plus plus
minus minus), suggesting that Java is C++ with the unnecessary hard parts
removed and therefore a much simpler language. As you progress in this book
you’ll see that many parts are simpler, and yet Java isn’t <i>that </i>much
easier than </span><span lang=EN-US>C++. </span></p>

<h3><a name="_Toc481064546"></a><a name="_Toc375545252"><span lang=EN-US>Relational
operators</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Relational operators generate a <b>boolean</b>
result. They evaluate the relationship between the values of the operands. A
relational expression produces <b>true</b> if the relationship is true, and <b>false</b>
if the relationship is untrue. The relational operators are less than (&lt;)</span><span lang=EN-US>, greater than (&gt;)</span><span
lang=EN-US>, less than or equal to (&lt;=)</span><span
lang=EN-US>, greater than or equal to (&gt;=)</span><span
lang=EN-US>, equivalent (==)</span><span
lang=EN-US> and not equivalent (!=)</span><span
lang=EN-US>.</span><span lang=EN-US> Equivalence and nonequivalence works with
all built-in data types, but the other comparisons won’t work with type <b>boolean</b></span><span lang=EN-US>.</span></p>

<h4><span lang=EN-US>Testing object equivalence</span></h4>

<p class=MsoNormal><span
lang=EN-US>The relational operators <b>==</b> and <b>!=</b> also work with all
objects, but their meaning often confuses the first-time Java programmer.
Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:Equivalence.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Equivalence
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer n1 = new
Integer(47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer n2 = new
Integer(47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(n1 == n2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(n1 != n2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The expression <b>System.out.println(n1 ==
n2)</b> will print the result of the <b>boolean</b> comparison within it.
Surely the output should be <b>true</b> and then <b>false</b>,<b> </b>since
both <b>Integer</b> objects are the same. But while the <i>contents</i> of the
objects are the same, the </span><span lang=EN-US>references are not the same and the operators <b>==</b> and <b>!= </b>compare
object references. So the output is actually <b>false</b> and then <b>true</b>.
Naturally, this surprises people at first.</span></p>

<p class=MsoNormal><span lang=EN-US>What if you want to compare the actual
contents of an object for equivalence? You must use the special method </span><span lang=EN-US><b>equals(&nbsp;)</b> that exists for all objects (not </span><span lang=EN-US>primitives, which work fine with <b>==</b> and <b>!=</b>). Here’s how
it’s used:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c03:EqualsMethod.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class EqualsMethod
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer n1 = new
Integer(47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer n2 = new
Integer(47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(n1.equals(n2));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The result will be <b>true</b>, as you
would expect. Ah, but it’s not as simple as that. If you create your own class,
like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c03:EqualsMethod2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Value {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
EqualsMethod2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Value v1 = new
Value();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Value v2 = new
Value();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    v1.i = v2.i = 100;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(v1.equals(v2));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>you’re back to square one: the result is <b>false</b>.
This is because the default behavior of <b>equals(&nbsp;)</b> is to compare
references. So unless you <i>override</i> <b>equals(&nbsp;)</b> in your new
class you won’t get the desired behavior. Unfortunately, you won’t learn about
overriding until Chapter 7, but being aware of the way <b>equals(&nbsp;)</b> behaves
might save you some grief in the meantime.</span></p>

<p class=MsoNormal><span lang=EN-US>Most of the Java library classes implement <b>equals(&nbsp;)</b>
so that it compares the contents of objects instead of their references.</span></p>

<h3><a name="_Toc481064547"></a><a name="_Toc375545253"><span lang=EN-US>Logical
operators</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The logical operators AND (&amp;&amp;)</span><span lang=EN-US>, OR (||)</span><span lang=EN-US> and </span><span lang=EN-US>NOT (!) produce a <b>boolean</b> value of <b>true</b> or <b>false</b>
</span><span lang=EN-US>based on the logical relationship of its arguments.
This example uses the relational and logical operators:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:Bool.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Relational and
logical operators.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Bool {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void main(String[]
args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Random rand = new
Random();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i =
rand.nextInt() % 100;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int j =
rand.nextInt() % 100;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i = &quot;
+ i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;j = &quot;
+ j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i &gt; j
is &quot; + (i &gt; j));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i &lt; j
is &quot; + (i &lt; j));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i &gt;= j
is &quot; + (i &gt;= j));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i &lt;= j
is &quot; + (i &lt;= j));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i == j is
&quot; + (i == j));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i != j is
&quot; + (i != j));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Treating an int
as a boolean is </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // not legal Java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//! prt(&quot;i
&amp;&amp; j is &quot; + (i &amp;&amp; j));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//! prt(&quot;i || j is
&quot; + (i || j));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//! prt(&quot;!i is
&quot; + !i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;(i &lt;
10) &amp;&amp; (j &lt; 10) is &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       + ((i &lt; 10)
&amp;&amp; (j &lt; 10)) );</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;(i &lt;
10) || (j &lt; 10) is &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       + ((i &lt; 10) ||
(j &lt; 10)) );</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void prt(String
s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can apply AND, OR, or NOT to <b>boolean</b>
values only. You can’t use a non-<b>boolean</b> as if it were a </span><span lang=EN-US><b>boolean</b> in a logical expression as you can in C and C++. You
can see the failed attempts at doing this commented out with a <b>//!</b>
comment marker. The subsequent expressions, however, produce <b>boolean</b>
values using relational comparisons, then use logical operations on the results.</span></p>

<p class=MsoNormal><span lang=EN-US>One output listing looked like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 85</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>j = 4</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i &gt; j is true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i &lt; j is false</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i &gt;= j is true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i &lt;= j is false</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i == j is false</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i != j is true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(i &lt; 10) &amp;&amp;
(j &lt; 10) is false</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>(i &lt; 10) || (j
&lt; 10) is true</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that a <b>boolean</b> value is
automatically converted to an appropriate text form if it’s used where a <b>String</b>
is expected.</span></p>

<p class=MsoNormal><span lang=EN-US>You can replace the definition for <b>int</b>
in the above program with any other primitive data type except <b>boolean</b>.
Be aware, however, that the comparison of floating-point numbers is very
strict. A number that is the tiniest fraction different from another number is
still “not equal.” A number that is the tiniest bit above zero is still
nonzero.</span></p>

<h4><span lang=EN-US>Short-circuiting</span></h4>

<p class=MsoNormal><span lang=EN-US>When dealing with </span><span lang=EN-US>logical operators you run into a phenomenon called “short
circuiting.” This means that the expression will be evaluated only <i>until</i>
the truth or falsehood of the entire expression can be unambiguously determined.
As a result, all the parts of a logical expression might not be evaluated.
Here’s an example that demonstrates short-circuiting:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c03:ShortCircuit.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates
short-circuiting behavior.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// with logical
operators.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ShortCircuit {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static boolean
test1(int val) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;test1(&quot; + val + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;result: &quot; + (val &lt; 1));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return val &lt; 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static boolean
test2(int val) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;test2(&quot; + val + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;result: &quot; + (val &lt; 2));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return val &lt; 2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static boolean test3(int
val) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;test3(&quot; + val + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;result: &quot; + (val &lt; 3));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return val &lt; 3;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(test1(0)
&amp;&amp; test2(2) &amp;&amp; test3(2))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;expression is true&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;expression is false&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Each test performs a comparison against the
argument and returns true or false. It also prints information to show you that
it’s being called. The tests are used in the expression:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>if(test1(0)
&amp;&amp; test2(2) &amp;&amp; test3(2))</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You might naturally think that all three
tests would be executed, but the output shows otherwise:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>test1(0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>result: true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>test2(2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>result: false</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>expression is
false</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The first test produced a <b>true</b>
result, so the expression evaluation continues. However, the second test
produced a <b>false</b> result. Since this means that the whole expression must
be <b>false</b>, why continue evaluating the rest of the expression? It could
be expensive. The reason for short-circuiting, in fact, is precisely that; you
can get a potential performance increase if all the parts of a logical
expression do not need to be evaluated.</span></p>

<h3><a name="_Toc481064548"></a><a name="_Toc375545254"><span lang=EN-US>Bitwise
operators</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The bitwise operators allow you to
manipulate individual bits in an integral primitive data type. Bitwise
operators perform boolean algebra</span><span
lang=EN-US> on the corresponding bits in the two arguments to produce the
result.</span></p>

<p class=MsoNormal><span lang=EN-US>The bitwise operators come from C’s
low-level orientation; you were often manipulating hardware directly and had to
set the bits in hardware registers. Java was originally designed to be embedded
in TV </span><span lang=EN-US>set-top boxes, so this low-level orientation
still made sense. However, you probably won’t use the bitwise operators much.</span></p>

<p class=MsoNormal><span lang=EN-US>The bitwise AND operator (<b>&amp;</b>)</span><span lang=EN-US> produces a one in the output bit if both input bits are one;
otherwise it produces a zero. The bitwise OR operator (<b>|</b>)</span><span lang=EN-US> produces a one in the output bit if either input bit is a one and
produces a zero only if both input bits are zero. The bitwise EXCLUSIVE OR, or
XOR (<b>^</b>),</span><span lang=EN-US> produces a one in the output bit if one or the other input bit is a
one, but not both. The bitwise NOT</span><span
lang=EN-US> (<b>~</b>, also called the <i>ones complement </i>operator</span><span lang=EN-US>) is a unary operator;</span><span lang=EN-US> it takes only one argument. (All other bitwise operators are binary
operators.</span><span lang=EN-US>) Bitwise NOT produces the opposite of the
input bit—a one if the input bit is zero, a zero if the input bit is one.</span></p>

<p class=MsoNormal><span lang=EN-US>The bitwise operators and logical operators
use the same characters, so it is helpful to have a mnemonic device to help you
remember the meanings: since bits are “small,” there is only one character in
the bitwise operators.</span></p>

<p class=MsoNormal><span lang=EN-US>Bitwise operators can be combined with the <b>=</b>
sign to unite the operation and assignment: <b>&amp;=</b></span><span lang=EN-US>, <b>|=</b></span><span lang=EN-US> and <b>^=</b></span><span lang=EN-US> are all legitimate. (Since <b>~</b> is a unary operator it cannot be
combined with the <b>=</b> sign.)</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>boolean</b> type is treated as a
one-bit value so it is somewhat different. You can perform a bitwise AND, OR
and XOR, but you can’t perform a bitwise NOT (presumably to prevent confusion
with the logical NOT). For <b>boolean</b>s the bitwise operators have the same
effect as the logical operators except that they do not short circuit. Also,
bitwise operations on <b>boolean</b>s include an XOR logical operator that is
not included under the list of “logical” operators. You’re prevented from using
<b>boolean</b>s in shift expressions, which is described next.</span></p>

<h3><a name="_Toc481064549"></a><a name="_Toc375545255"><span lang=EN-US>Shift
operators</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The shift operators also manipulate bits.
They can be used solely with primitive, integral types. The left-shift operator
(<b>&lt;&lt;</b>)</span><span lang=EN-US> produces the operand to the left of the operator shifted to the left
by the number of bits specified after the operator (inserting zeroes at the
lower-order bits). The signed right-shift operator (<b>&gt;&gt;</b>)</span><span lang=EN-US> produces the operand to the left of the operator shifted to the
right by the number of bits specified after the operator. The signed right
shift <b>&gt;&gt; </b>uses <i>sign extension</i></span><span lang=EN-US>: if the value is positive, zeroes are inserted at the higher-order
bits; if the value is negative, ones are inserted at the higher-order bits. Java
has also added the unsigned right shift <b>&gt;&gt;&gt;, </b>which<b> </b>uses <i>zero
extension</i></span><span lang=EN-US>: regardless of the sign, zeroes are
inserted at the higher-order bits.<i> </i>This operator does not exist in C or
C++.</span></p>

<p class=MsoNormal><span lang=EN-US>If you shift a <b>char</b>, <b>byte,</b> or
<b>short</b>, it will be promoted to <b>int</b> before the shift takes place,
and the result will be an <b>int</b>. Only the five low-order bits of the
right-hand side will be used. This prevents you from shifting more than the
number of bits in an <b>int</b>. If you’re operating on a <b>long</b>, you’ll
get a <b>long</b> result. Only the six low-order bits of the right-hand side
will be used so you can’t shift more than the number of bits in a <b>long</b>. </span></p>

<p class=MsoNormal><span lang=EN-US>Shifts can be combined with the equal sign
(<b>&lt;&lt;=</b> or <b>&gt;&gt;=</b> or <b>&gt;&gt;&gt;=</b>)</span><span lang=EN-US>. The lvalue is replaced by the lvalue shifted by the rvalue. There
is a problem, however, with the unsigned right shift combined with assignment.
If you use it with <b>byte</b> or <b>short</b> you don’t get the correct
results. Instead, these are promoted to <b>int</b> and right shifted, but then
truncated as they are assigned back into their variables, so you get <b>-1</b>
in those cases. The following example demonstrates this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:URShift.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Test of unsigned
right shift.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class URShift {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = -1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i &gt;&gt;&gt;= 10;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long l = -1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    l &gt;&gt;&gt;= 10;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(l);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    short s = -1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s &gt;&gt;&gt;= 10;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    byte b = -1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b &gt;&gt;&gt;= 10;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b = -1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(b&gt;&gt;&gt;10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In the last line, the resulting value is
not assigned back into <b>b</b>, but is printed directly and so the correct
behavior occurs.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example that demonstrates the use
of all the operators involving bits:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c03:BitManipulation.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using the bitwise
operators.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
BitManipulation {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Random rand = new
Random();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i =
rand.nextInt();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int j =
rand.nextInt();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinInt(&quot;-1&quot;,
-1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinInt(&quot;+1&quot;, +1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int maxpos =
2147483647;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinInt(&quot;maxpos&quot;, maxpos);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int maxneg =
-2147483648;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinInt(&quot;maxneg&quot;, maxneg);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinInt(&quot;i&quot;, i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinInt(&quot;~i&quot;, ~i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinInt(&quot;-i&quot;, -i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinInt(&quot;j&quot;, j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinInt(&quot;i
&amp; j&quot;, i &amp; j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinInt(&quot;i |
j&quot;, i | j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinInt(&quot;i ^
j&quot;, i ^ j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinInt(&quot;i
&lt;&lt; 5&quot;, i &lt;&lt; 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinInt(&quot;i
&gt;&gt; 5&quot;, i &gt;&gt; 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinInt(&quot;(~i)
&gt;&gt; 5&quot;, (~i) &gt;&gt; 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinInt(&quot;i
&gt;&gt;&gt; 5&quot;, i &gt;&gt;&gt; 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinInt(&quot;(~i)
&gt;&gt;&gt; 5&quot;, (~i) &gt;&gt;&gt; 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long l = rand.nextLong();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long m =
rand.nextLong();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinLong(&quot;-1L&quot;, -1L);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinLong(&quot;+1L&quot;, +1L);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long ll =
9223372036854775807L;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinLong(&quot;maxpos&quot;, ll);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long lln =
-9223372036854775808L;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinLong(&quot;maxneg&quot;, lln);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinLong(&quot;l&quot;, l);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinLong(&quot;~l&quot;,
~l);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinLong(&quot;-l&quot;, -l);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
pBinLong(&quot;m&quot;, m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinLong(&quot;l
&amp; m&quot;, l &amp; m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinLong(&quot;l |
m&quot;, l | m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinLong(&quot;l ^
m&quot;, l ^ m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinLong(&quot;l
&lt;&lt; 5&quot;, l &lt;&lt; 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinLong(&quot;l
&gt;&gt; 5&quot;, l &gt;&gt; 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinLong(&quot;(~l)
&gt;&gt; 5&quot;, (~l) &gt;&gt; 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinLong(&quot;l
&gt;&gt;&gt; 5&quot;, l &gt;&gt;&gt; 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pBinLong(&quot;(~l)
&gt;&gt;&gt; 5&quot;, (~l) &gt;&gt;&gt; 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
pBinInt(String s, int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s + &quot;, int:
&quot; + i + &quot;, binary: &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.print(&quot;   &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int j = 31; j
&gt;=0; j--)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(((1 &lt;&lt; j)
&amp;  i) != 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.print(&quot;1&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.print(&quot;0&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
pBinLong(String s, long l) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s + &quot;, long:
&quot; + l + &quot;, binary: &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.print(&quot;   &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 63; i
&gt;=0; i--)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(((1L &lt;&lt;
i) &amp; l) != 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.print(&quot;1&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.print(&quot;0&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The two methods at the end, <b>pBinInt(&nbsp;)</b>
and <b>pBinLong(&nbsp;)</b> take an <b>int</b> or a <b>long</b>, respectively,
and print it out in binary format along with a descriptive string. You can
ignore the implementation of these for now.</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll note the use of <b>System.out.print(&nbsp;)</b>
instead of <b>System.out.println(&nbsp;)</b>. The <b>print(&nbsp;)</b> method
does not emit a new line, so it allows you to output a line in pieces.</span></p>

<p class=MsoNormal><span lang=EN-US>As well as demonstrating the effect of all
the bitwise operators for <b>int</b> and <b>long</b>, this example also shows
the minimum, maximum, +1 and -1 values for <b>int</b> and <b>long</b> so you
can see what they look like. Note that the high bit represents the sign: 0
means positive and 1 means negative. The output for the <b>int</b> portion
looks like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>-1, int: -1, binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
11111111111111111111111111111111</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>+1, int: 1, binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   00000000000000000000000000000001</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>maxpos, int: 2147483647,
binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
01111111111111111111111111111111</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>maxneg, int:
-2147483648, binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
10000000000000000000000000000000</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i, int: 59081716,
binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
00000011100001011000001111110100</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>~i, int: -59081717,
binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   11111100011110100111110000001011</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>-i, int: -59081716,
binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
11111100011110100111110000001100</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>j, int: 198850956,
binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
00001011110110100011100110001100</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i &amp; j, int:
58720644, binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
00000011100000000000000110000100</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i | j, int: 199212028,
binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
00001011110111111011101111111100</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i ^ j, int: 140491384,
binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
00001000010111111011101001111000</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i &lt;&lt; 5, int:
1890614912, binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
01110000101100000111111010000000</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i &gt;&gt; 5, int:
1846303, binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
00000000000111000010110000011111</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(~i) &gt;&gt; 5, int:
-1846304, binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
11111111111000111101001111100000</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i &gt;&gt;&gt; 5, int:
1846303, binary: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
00000000000111000010110000011111</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(~i) &gt;&gt;&gt; 5,
int: 132371424, binary: </span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  
00000111111000111101001111100000</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The binary representation of the numbers is
referred to as </span><span
lang=EN-US><i>signed two’s complement</i>.</span></p>

<h3><a name="_Toc481064550"></a><a name="_Toc375545256"><span lang=EN-US>Ternary
if-else operator</span></a></h3>

<p class=MsoNormal><span lang=EN-US>This operator is unusual because it has
three operands. It is truly an operator because it produces a value, unlike the
ordinary if-else statement that you’ll see in the next section of this chapter</span><span lang=EN-US>. The expression is of the form:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>boolean-exp ?
value0 : value1</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If <i>boolean-exp</i> evaluates to <b>true</b>,
<i>value0</i> is evaluated and its result becomes the value produced by the
operator. If <i>boolean-exp</i> is <b>false</b>, <i>value1</i> is evaluated and
its result becomes the value produced by the operator.</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, you could use an ordinary <b>if-else
</b>statement (described later), but the ternary operator is much terser.
Although C (where this operator originated) prides itself on being a terse
language, and the ternary operator might have been introduced partly for efficiency,
you should be somewhat wary of using it on an everyday basis—it’s easy to
produce unreadable code.</span></p>

<p class=MsoNormal><span lang=EN-US>The conditional operator can be used for
its side effects or for the value it produces, but in general you want the
value since that’s what makes the operator distinct from the <b>if-else</b>.
Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>static int ternary(int
i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  return i &lt; 10 ? i *
100 : i * 10;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} </span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that this code is more compact
than what you’d need to write without the ternary operator:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>static int
alternative(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  if (i &lt; 10)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return i * 100;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return i * 10;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The second form is easier to understand,
and doesn’t require a lot more typing. So be sure to ponder your reasons when
choosing the ternary operator.</span></p>

<h3><a name="_Toc481064551"></a><a name="_Toc375545257"><span lang=EN-US>The
comma operator</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The comma is used in C and C++ not only as a
separator in function argument lists, but also as an operator for sequential
evaluation. The sole place that the comma <i>operator</i> is used in Java is in
<b>for</b> loops, which will be described later in this chapter.</span></p>

<h3><a name="_Toc481064552"></a><a name="_Toc375545258"><b><span lang=EN-US>String</span></b><span
lang=EN-US> operator +</span></a></h3>

<p class=MsoNormal><span lang=EN-US>There’s one special usage of an operator in
Java: the <b>+</b> operator can be used to </span><span
lang=EN-US>concatenate strings, as you’ve already seen. It seems a natural use
of the <b>+</b> even though it doesn’t fit with the traditional way that <b>+</b>
is used. This capability seemed like a good idea in C++, so </span><span lang=EN-US><i>operator overloading</i> was added to C++ to allow the C++
programmer to add meanings to almost any operator. Unfortunately, operator
overloading combined with some of the other restrictions in C++ turns out to be
a fairly complicated feature for programmers to design into their classes.
Although operator overloading would have been much simpler to implement in Java
than it was in C++, this feature was still considered too complex, so Java
programmers cannot implement their own overloaded operators as C++ programmers
can.</span></p>

<p class=MsoNormal><span lang=EN-US>The use of the <b>String +</b> has some
interesting behavior. If an expression begins with a <b>String</b>, then all
operands that follow must be <b>String</b>s (remember that the compiler will
turn a quoted sequence of characters into a <b>String</b>):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>int x = 0, y = 1, z = 2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>String sString =
&quot;x, y, z &quot;;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>System.out.println(sString
+ x + y + z);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Here, the Java compiler will convert <b>x</b>,
<b>y</b>, and <b>z</b> into their <b>String</b> representations instead of
adding them together first. And if you say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>System.out.println(x
+ sString);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Java will turn <b>x </b>into a <b>String</b>.</span></p>

<h3><a name="_Toc481064553"></a><a name="_Toc375545259"><span lang=EN-US>Common
pitfalls when using operators</span></a></h3>

<p class=MsoNormal><span lang=EN-US>One of the pitfalls when using operators is
trying to get away without parentheses when you are even the least bit
uncertain about how an expression will evaluate. This is still true in Java.</span></p>

<p class=MsoNormal><span lang=EN-US>An extremely common error in C and C++
looks like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>while(x = y) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ....</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The programmer was trying to test for
equivalence (<b>==</b>) rather than do an assignment. In C and C++ the result
of this assignment will always be <b>true</b> if <b>y </b>is nonzero, and
you’ll probably get an infinite loop. In Java, the result of this expression is
not a <b>boolean,</b> and the compiler expects a <b>boolean</b> and won’t
convert from an <b>int</b>, so it will conveniently give you a compile-time error
and catch the problem before you ever try to run the program. So the pitfall
never happens in </span><span
lang=EN-US>Java. (The only time you won’t get a compile-time error is when <b>x</b>
and <b>y</b> are <b>boolean</b>, in which case <b>x = y</b> is a legal
expression, and in the above case, probably an error.)</span></p>

<p class=MsoNormal><span lang=EN-US>A similar problem in C and C++ is using
bitwise AND and OR instead of the logical versions. Bitwise AND and OR use one
of the characters (<b>&amp;</b> or <b>|</b>) while logical AND and OR use two (<b>&amp;&amp;</b>
and <b>||</b>). Just as with <b>=</b> and <b>==</b>, it’s easy to type just one
character instead of two.</span><span lang=EN-US> In Java, the compiler again
prevents this because it won’t let you cavalierly use one type where it doesn’t
belong.</span></p>

<h3><a name="_Toc481064554"></a><a name="_Toc375545260"><span lang=EN-US>Casting
operators</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The word <i>cast</i> is used in the sense
of “casting into a mold.” Java will automatically change one type of data into
another when appropriate. For instance, if you assign an integral value to a
floating-point variable, the compiler will automatically convert the <b>int</b>
to a <b>float</b>. Casting allows you to make this type conversion explicit, or
to force it when it wouldn’t normally happen.</span></p>

<p class=MsoNormal><span lang=EN-US>To perform a cast, put the desired data
type (including all modifiers) inside parentheses to the left of any value.
Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>void casts() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = 200;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  long l = (long)i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  long l2 = (long)200;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>As you can see, it’s possible to perform a
cast on a numeric value as well as on a variable. In both casts shown here,
however, the cast is superfluous, since the compiler will automatically promote
an <b>int</b> value to a <b>long</b> when necessary. However, you are allowed
to use superfluous casts in to make a point or to make your code more clear. In
other situations, a cast may be essential just to get the code to compile.</span></p>

<p class=MsoNormal><span lang=EN-US>In C and C++, casting can cause some
headaches. In Java, casting is safe, with the exception that when you perform a
so-called </span><span
lang=EN-US><i>narrowing conversion</i> (that is, when you go from a data type
that can hold more information to one that doesn’t hold as much) you run the
risk of losing information.<i> </i>Here the compiler forces you to do a cast,
in effect saying “this can be a dangerous thing to do—if you want me to do it
anyway you must make the cast explicit.” With a </span><span lang=EN-US><i>widening conversion</i> an explicit cast is not needed because the
new type will more than hold the information from the old type so that no
information is ever lost.</span></p>

<p class=MsoNormal><span lang=EN-US>Java allows you to cast any primitive type
to any other primitive type, except for </span><span
lang=EN-US><b>boolean,</b> which doesn’t allow any casting at all. Class types
do not allow casting. To convert one to the other there must be special
methods. (<b>String</b> is a special case, and you’ll find out later in this
book that objects can be cast within a <i>family</i> of types; an <b>Oak</b>
can be cast to a <b>Tree</b> and vice-versa, but not to a foreign type such as
a <b>Rock</b>.)</span></p>

<h4><span lang=EN-US>Literals</span></h4>

<p class=MsoNormal><span lang=EN-US>Ordinarily when you insert a literal value
into a program the compiler knows exactly what type to make it. Sometimes,
however, the type is ambiguous. When this happens you must guide the compiler
by adding some extra information in the form of characters associated with the
literal value. The following code shows these characters:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:Literals.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Literals {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  char c = 0xffff; //
max char hex value</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  byte b = 0x7f; // max
byte hex value</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  short s = 0x7fff; //
max short hex value</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i1 = 0x2f; //
Hexadecimal (lowercase)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i2 = 0X2F; //
Hexadecimal (uppercase)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i3 = 0177; //
Octal (leading zero)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Hex and Oct also
work with long.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  long n1 = 200L; //
long suffix</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  long n2 = 200l; //
long suffix</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  long n3 = 200;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  //! long l6(200); //
not allowed</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float f1 = 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float f2 = 1F; //
float suffix</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float f3 = 1f; //
float suffix</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float f4 = 1e-45f; //
10 to the power</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float f5 = 1e+9f; //
float suffix</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  double d1 = 1d; //
double suffix</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  double d2 = 1D; //
double suffix</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  double d3 = 47e47d; //
10 to the power</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Hexadecimal (</span><span
lang=EN-US>base 16), which works with all the integral data types, is denoted
by a leading <b>0x</b> or <b>0X</b> followed by 0—9 and a—f either in upper or
lowercase. If you try to initialize a variable with a value bigger than it can
hold (regardless of the numerical form of the value), the compiler will give
you an error message. Notice in the above code the maximum possible hexadecimal
values for <b>char</b>, <b>byte,</b> and <b>short</b>. If you exceed these, the
compiler will automatically make the value an <b>int</b> and tell you that you
need a narrowing cast for the assignment. You’ll know you’ve stepped over the
line.</span></p>

<p class=MsoNormal><span lang=EN-US>Octal (</span><span
lang=EN-US>base 8) is denoted by a leading zero in the number and digits from
0-7. There is no literal representation for </span><span lang=EN-US>binary numbers in C, C++ or Java.</span></p>

<p class=MsoNormal><span lang=EN-US>A trailing character after a literal value
establishes its type. Upper or lowercase <b>L </b>means </span><span lang=EN-US><b>long</b>, upper or lowercase <b>F</b> means </span><span lang=EN-US><b>float</b> and upper or lowercase <b>D</b> means </span><span lang=EN-US><b>double</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Exponents use a notation that I’ve always
found rather dismaying: <b>1.39 e-47f</b>. In science and engineering, ‘e’
refers to the base of </span><span lang=EN-US>natural logarithms, approximately 2.718. (A more precise <b>double </b>value
is available in Java as <b>Math.E</b>.) This is used in exponentiation
expressions such as 1.39 x e<sup>-47</sup>, which means 1.39 x 2.718<sup>-47</sup>.
However, when </span><span lang=EN-US>FORTRAN was invented they decided that <b>e</b>
would naturally mean “ten to the power,” which is an odd decision because
FORTRAN was designed for science and engineering and one would think its
designers would be sensitive about introducing such an ambiguity.</span><a
href="#_ftn25" name="_ftnref25" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[25]</span></span></span></span></a><span
lang=EN-US> At any rate, this custom was followed in C, C++ and now Java. So if
you’re used to thinking in terms of <b>e</b> as the base of natural logarithms,
you must do a mental translation when you see an expression such as <b>1.39
e-47f</b> in Java; it means 1.39 x 10<sup>-47</sup>. </span></p>

<p class=MsoNormal><span lang=EN-US>Note that you don’t need to use the
trailing character when the compiler can figure out the appropriate type. With</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>long n3 = 200;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>there’s no ambiguity, so an <b>L</b> after
the 200 would be superfluous. However, with</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>float f4 = 1e-47f;
// 10 to the power</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>the compiler normally takes exponential
numbers as doubles, so without the trailing <b>f</b> it will give you an error
telling you that you must use a cast to convert <b>double</b> to <b>float</b>.</span></p>

<h4><span lang=EN-US>Promotion</span></h4>

<p class=MsoNormal><span lang=EN-US>You’ll discover that if you perform any
mathematical or bitwise operations on primitive data types that are smaller
than an <b>int</b> (that is, <b>char</b>, <b>byte,</b> or <b>short</b>), those
values will be </span><span
lang=EN-US>promoted to <b>int</b> before performing the operations, and the
resulting value will be of type <b>int</b>. So if you want to assign back into
the smaller type, you must use a cast. (And, since you’re assigning back into a
smaller type, you might be losing information.) In general, the largest data
type in an expression is the one that determines the size of the result of that
expression; if you multiply a <b>float</b> and a <b>double</b>, the result will
be <b>double</b>; if you add an <b>int</b> and a <b>long</b>, the result will
be <b>long</b>.</span></p>

<h3><a name="_Toc481064555"></a><a name="_Toc375545261"><span lang=EN-US>Java has
no “sizeof”</span></a><span lang=EN-US> </span></h3>

<p class=MsoNormal><span lang=EN-US>In C and C++, the </span><span
lang=EN-US><b>sizeof(&nbsp;)</b> operator satisfies a specific need: it tells
you the number of bytes allocated for data items. The most compelling need for <b>sizeof(&nbsp;)</b>
in C and C++ is </span><span
lang=EN-US>portability. Different data types might be different sizes on
different machines, so the programmer must find out how big those types are
when performing operations that are sensitive to size. For example, one
computer might store integers in 32 bits, whereas another might store integers
as 16 bits. Programs could store larger values in integers on the first
machine. As you might imagine, portability is a huge headache for C and C++
programmers.</span></p>

<p class=MsoNormal><span lang=EN-US>Java does not need a <b>sizeof(&nbsp;)</b>
operator for this purpose because all the data types are the same size on all
machines. You do not need to think about portability on this level—it is
designed into the language.</span></p>

<h3><a name="_Toc481064556"></a><a name="_Toc375545262"><span lang=EN-US>Precedence
revisited</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Upon hearing me complain about the
complexity of remembering </span><span lang=EN-US>operator precedence during one of my seminars, a student suggested a
mnemonic that is simultaneously a commentary: “Ulcer Addicts Really Like C A
lot.”</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=105 valign=top style='width:78.75pt;border-top:black 1.5pt;
  border-left:black 1.5pt;border-bottom:windowtext 1.5pt;border-right:black 1.0pt;
  border-style:solid;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Mnemonic</span></p>
  </td>
  <td width=171 valign=top style='width:128.25pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Operator type</span></p>
  </td>
  <td width=174 valign=top style='width:130.5pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Operators</span></p>
  </td>
 </tr>
 <tr>
  <td width=105 valign=top style='width:78.75pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Ulcer</span></p>
  </td>
  <td width=171 valign=top style='width:128.25pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Unary</span></p>
  </td>
  <td width=174 valign=top style='width:130.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>+ - ++--</span></p>
  </td>
 </tr>
 <tr>
  <td width=105 valign=top style='width:78.75pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Addicts</span></p>
  </td>
  <td width=171 valign=top style='width:128.25pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Arithmetic (and
  shift)</span></p>
  </td>
  <td width=174 valign=top style='width:130.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>* / % + -  &lt;&lt; &gt;&gt;</span></p>
  </td>
 </tr>
 <tr>
  <td width=105 valign=top style='width:78.75pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Really</span></p>
  </td>
  <td width=171 valign=top style='width:128.25pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Relational</span></p>
  </td>
  <td width=174 valign=top style='width:130.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>&gt; &lt; &gt;= &lt;= == !=</span></p>
  </td>
 </tr>
 <tr>
  <td width=105 valign=top style='width:78.75pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Like</span></p>
  </td>
  <td width=171 valign=top style='width:128.25pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Logical (and
  bitwise)</span></p>
  </td>
  <td width=174 valign=top style='width:130.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>&amp;&amp; ||  &amp;  |  ^ </span></p>
  </td>
 </tr>
 <tr>
  <td width=105 valign=top style='width:78.75pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>C</span></p>
  </td>
  <td width=171 valign=top style='width:128.25pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Conditional
  (ternary)</span></p>
  </td>
  <td width=174 valign=top style='width:130.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>A &gt; B ? X : Y</span></p>
  </td>
 </tr>
 <tr>
  <td width=105 valign=top style='width:78.75pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>A Lot</span></p>
  </td>
  <td width=171 valign=top style='width:128.25pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Assignment</span></p>
  </td>
  <td width=174 valign=top style='width:130.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>= </span><span lang=EN-US style='font-weight:
  normal'>(and compound assignment like</span><span lang=EN-US> *=</span><span
  lang=EN-US style='font-weight:normal'>)</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>Of course, with the shift and bitwise
operators distributed around the table it is not a perfect mnemonic, but for
non-bit operations it works.</span></p>

<h3><a name="_Toc481064557"></a><a name="_Toc375545263"><span lang=EN-US>A
compendium of operators</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The following example shows which </span><span lang=EN-US>primitive data types can be used with particular operators.
Basically, it is the same example repeated over and over, but using different
primitive data types. The file will compile without error because the lines
that would cause errors are commented out with a <b>//!</b>.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:AllOps.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Tests all the
operators on all the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// primitive data types
to show which</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// ones are accepted by
the Java compiler.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class AllOps {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // To accept the
results of a boolean test:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f(boolean b) {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void boolTest(boolean
x, boolean y) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Arithmetic
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x * y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x / y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x % y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x + y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x - y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x--;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = +y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = -y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Relational and
logical:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x &gt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x &gt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x &lt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x &lt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x == y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x != y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(!y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x &amp;&amp; y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x || y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Bitwise operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = ~y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x &amp; y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x | y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x ^ y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x &lt;&lt;
1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x &gt;&gt;
1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x
&gt;&gt;&gt; 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Compound
assignment:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x += y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x -= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x *= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x /= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x %= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x &lt;&lt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x &gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x &gt;&gt;&gt;=
1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &amp;= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x ^= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x |= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Casting:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! char c =
(char)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! byte B =
(byte)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! short s =
(short)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! int i = (int)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! long l =
(long)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! float f =
(float)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! double d =
(double)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void charTest(char x,
char y) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Arithmetic
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (char)(x * y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (char)(x / y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (char)(x % y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (char)(x + y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (char)(x - y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x--;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (char)+y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (char)-y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Relational and
logical:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x == y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x != y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(!x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x &amp;&amp;
y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x || y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Bitwise
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x= (char)~y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (char)(x &amp;
y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x  = (char)(x | y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (char)(x ^ y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (char)(x
&lt;&lt; 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (char)(x
&gt;&gt; 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (char)(x
&gt;&gt;&gt; 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Compound
assignment:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x += y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x -= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x *= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x /= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x %= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &lt;&lt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &gt;&gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &amp;= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x ^= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x |= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Casting:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! boolean b =
(boolean)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    byte B = (byte)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    short s = (short)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = (int)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long l = (long)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    float f = (float)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double d =
(double)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void byteTest(byte x,
byte y) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Arithmetic
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)(x* y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)(x / y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)(x % y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)(x + y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)(x - y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x--;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)+ y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)- y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Relational and
logical:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x == y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x != y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(!x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x &amp;&amp;
y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x || y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Bitwise
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)~y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)(x &amp;
y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)(x | y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)(x ^ y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)(x
&lt;&lt; 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)(x
&gt;&gt; 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (byte)(x
&gt;&gt;&gt; 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Compound
assignment:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x += y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x -= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x *= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x /= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x %= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &lt;&lt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &gt;&gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &amp;= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x ^= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x |= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Casting:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! boolean b =
(boolean)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    char c = (char)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    short s = (short)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = (int)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long l = (long)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    float f = (float)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double d =
(double)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void shortTest(short
x, short y) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Arithmetic
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)(x * y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)(x / y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)(x % y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)(x + y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)(x - y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x--;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)+y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)-y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Relational and
logical:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x == y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x != y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(!x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x &amp;&amp;
y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x || y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Bitwise
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)~y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)(x &amp;
y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)(x | y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)(x ^ y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)(x
&lt;&lt; 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)(x
&gt;&gt; 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = (short)(x
&gt;&gt;&gt; 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Compound
assignment:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x += y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x -= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x *= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x /= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x %= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &lt;&lt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &gt;&gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &amp;= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x ^= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x |= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Casting:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! boolean b =
(boolean)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    char c = (char)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    byte B = (byte)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = (int)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long l = (long)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    float f = (float)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double d =
(double)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void intTest(int x,
int y) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Arithmetic
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x * y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x / y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x % y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x + y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x - y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x--;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = +y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = -y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Relational and
logical:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x == y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x != y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(!x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x &amp;&amp;
y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x || y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Bitwise
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = ~y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x &amp; y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x | y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x ^ y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x &lt;&lt; 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x &gt;&gt; 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x &gt;&gt;&gt;
1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Compound
assignment:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x += y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x -= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x *= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x /= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x %= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &lt;&lt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &gt;&gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &amp;= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x ^= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x |= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Casting:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! boolean b =
(boolean)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    char c = (char)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    byte B = (byte)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    short s = (short)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long l = (long)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    float f = (float)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double d =
(double)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void longTest(long x,
long y) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Arithmetic
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x * y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x / y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x % y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x + y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x - y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x--;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = +y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = -y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Relational and
logical:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x == y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x != y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(!x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x &amp;&amp;
y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x || y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Bitwise
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = ~y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x &amp; y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x | y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x ^ y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x &lt;&lt; 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x &gt;&gt; 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x &gt;&gt;&gt;
1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Compound
assignment:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x += y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x -= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x *= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x /= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x %= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &lt;&lt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &gt;&gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x &amp;= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x ^= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x |= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Casting:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! boolean b =
(boolean)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    char c = (char)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    byte B = (byte)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    short s = (short)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = (int)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    float f = (float)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double d =
(double)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void floatTest(float
x, float y) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Arithmetic
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x * y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x / y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x % y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x + y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x - y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x--;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = +y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = -y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Relational and
logical:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x == y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x != y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(!x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x &amp;&amp;
y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x || y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Bitwise
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = ~y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x &amp; y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x | y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x ^ y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x &lt;&lt;
1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x &gt;&gt;
1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x
&gt;&gt;&gt; 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Compound
assignment:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x += y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x -= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x *= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x /= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x %= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x &lt;&lt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x &gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x &gt;&gt;&gt;=
1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x &amp;= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x ^= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x |= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Casting:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! boolean b =
(boolean)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    char c = (char)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    byte B = (byte)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    short s = (short)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = (int)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long l = (long)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double d =
(double)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void doubleTest(double
x, double y) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Arithmetic
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x * y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x / y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x % y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x + y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = x - y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x--;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = +y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x = -y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Relational and
logical:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &gt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt; y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x &lt;= y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x == y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x != y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(!x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x &amp;&amp;
y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! f(x || y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Bitwise
operators:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = ~y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x &amp; y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x | y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x ^ y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x &lt;&lt;
1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x &gt;&gt;
1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x = x
&gt;&gt;&gt; 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Compound
assignment:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x += y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x -= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x *= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x /= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x %= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x &lt;&lt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x &gt;&gt;= 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x &gt;&gt;&gt;=
1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x &amp;= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x ^= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x |= y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Casting:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! boolean b =
(boolean)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    char c = (char)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    byte B = (byte)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    short s = (short)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = (int)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long l = (long)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    float f = (float)x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that </span><span
lang=EN-US><b>boolean</b> is quite limited. You can assign to it the values <b>true</b>
and <b>false</b>, and you can test it for truth or falsehood, but you cannot
add booleans or perform any other type of operation on them.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>char</b>, <b>byte</b>, and <b>short</b>
you can see the effect of </span><span
lang=EN-US>promotion with the arithmetic operators. Each arithmetic operation
on any of those types results in an <b>int</b> result, which must be explicitly
cast back to the original type (a narrowing conversion that might lose
information) to assign back to that type. With <b>int</b> values, however, you
do not need to cast, because everything is already an <b>int</b>. Don’t be
lulled into thinking everything is safe, though. If you multiply two <b>int</b>s
that are big enough, you’ll </span><span
lang=EN-US>overflow the result. The following example demonstrates this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:Overflow.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Surprise! Java lets
you overflow.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Overflow {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int big =
0x7fffffff; // max int value</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;big =
&quot; + big);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int bigger = big *
4;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;bigger =
&quot; + bigger);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void prt(String
s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output of this is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>big = 2147483647</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>bigger = -4</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>and you get no errors or warnings from the
compiler, and no exceptions at run-time. Java is good, but it’s not <i>that</i>
good.</span></p>

<p class=MsoNormal><span lang=EN-US>Compound assignments do <i>not</i> require
casts for <b>char</b>, <b>byte,</b> or <b>short</b>, even though they are
performing promotions that have the same results as the direct arithmetic
operations. On the other hand, the lack of the cast certainly simplifies the code.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that, with the exception of <b>boolean</b>,
any </span><span lang=EN-US>primitive type can be cast to any other primitive
type. Again, you must be aware of the effect of a narrowing conversion </span><span lang=EN-US> when casting to a smaller type, otherwise you might unknowingly lose
information during the cast.</span></p>

<h2><a name="_Toc481064558"></a><a name="_Toc375545264"><span lang=EN-US>Execution
control</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Java uses all of C’s execution control
statements, so if you’ve programmed with C or C++ then most of what you see
will be familiar. Most procedural programming languages have some kind of
control statements, and there is often overlap among languages. In Java, the
keywords include <b>if-else</b>, <b>while</b>, <b>do-while</b>, <b>for</b>, and
a selection statement called <b>switch</b>. Java does not, however, support the
much-maligned <b>goto</b> (which can still be the most expedient way to solve
certain types of problems). You can still do a goto-like jump, but it is much
more constrained than a typical <b>goto</b>.</span></p>

<h3><a name="_Toc481064559"></a><a name="_Toc375545265"><span lang=EN-US>true
and false</span></a></h3>

<p class=MsoNormal><span lang=EN-US>All conditional statements use the truth or
falsehood of a conditional expression to determine the execution path. An
example of a conditional expression is <b>A == B</b>. This uses the conditional
operator <b>==</b> to see if the value of <b>A</b> is equivalent to the value
of <b>B</b>. The expression returns <b>true</b> or <b>false</b>. Any of the
relational operators you’ve seen earlier in this chapter can be used to produce
a conditional statement. Note that Java doesn’t allow you to use a number as a <b>boolean</b>,
even though it’s allowed in C and C++ (where truth is nonzero and falsehood is
zero). If you want to use a non-<b>boolean</b> in a <b>boolean</b> test, such
as <b>if(a)</b>, you must first convert it to a <b>boolean</b> value using a
conditional expression, such as <b>if(a != 0)</b>.</span></p>

<h3><a name="_Toc481064560"></a><a name="_Toc375545266"><span lang=EN-US>if-else</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The <b>if-else</b> statement is probably
the most basic way to control program flow. The <b>else</b> is optional, so you
can use <b>if</b> in two forms:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><b><span lang=EN-US>if(</span></b><span
lang=EN-US>Boolean-expression<b>)</b></span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  statement</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoCommentText><span lang=EN-US>or</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><b><span lang=EN-US>if(</span></b><span
lang=EN-US>Boolean-expression<b>)</b></span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  statement</span></p>

<p class=Code style='margin-left:0cm'><b><span lang=EN-US>else</span></b></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  statement</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The conditional must produce a <b>boolean</b>
result. The <i>statement</i> means either a simple statement terminated by a
semicolon or a compound statement, which is a group of simple statements
enclosed in braces. Any time the word “<i>statement</i>” is used, it always
implies that the statement can be simple or compound. </span></p>

<p class=MsoNormal><span lang=EN-US>As an example of <b>if-else</b>, here is a<b>
test(&nbsp;) </b>method that will tell you whether a guess is above, below, or
equivalent to a target number:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:IfElse.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class IfElse {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int test(int
testval, int target) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int result = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(testval &gt;
target)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      result = +1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else if(testval &lt;
target)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      result = -1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      result = 0; //
Match</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return result;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(test(10, 5));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(test(5, 10));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(test(5, 5));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-bottom:9.0pt;border:none'><span lang=EN-US
style='font-family:"Georgia","serif"'>It is conventional to indent the body of
a control flow statement so the reader might easily determine where it begins
and ends.</span></p>

<h4><b><span lang=EN-US>return</span></b></h4>

<p class=MsoNormal><span lang=EN-US>The <b>return</b> keyword has two purposes:
it specifies what value a method will return (if it doesn’t have a <b>void</b>
return value) and it causes that value to be returned immediately. The <b>test(&nbsp;)</b>
method above can be rewritten to take advantage of this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:IfElse2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class IfElse2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int test(int
testval, int target) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int result = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(testval &gt;
target)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return +1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else if(testval &lt;
target)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return -1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return 0; // Match</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(test(10, 5));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(test(5, 10));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(test(5, 5));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US> There’s no need for <b>else</b> because
the method will not continue after executing a <b>return</b>.</span></p>

<h3><a name="_Toc481064561"></a><a name="_Toc375545267"><span lang=EN-US>Iteration</span></a><span
lang=EN-US> </span></h3>

<p class=MsoNormal><b><span lang=EN-US>while</span></b><span lang=EN-US>, <b>do-while</b>
and <b>for</b> control looping and are sometimes classified as <i>iteration
statements</i>. A <i>statement</i> repeats until the controlling <i>Boolean</i>-<i>expression</i>
evaluates to false. The form for a <b>while</b> loop is</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><b><span lang=EN-US>while(</span></b><span
lang=EN-US>Boolean-expression<b>)</b></span></p>

<p class=CodeInline style='margin-left:0cm'><b><span lang=EN-US>  </span></b><span
lang=EN-US>statement</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <i>Boolean-expression</i> is evaluated
once at the beginning of the loop and again before each further iteration of
the <i>statement</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s a simple example that generates
random numbers until a particular condition is met:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:WhileTest.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates the
while loop.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class WhileTest {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double r = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(r &lt; 0.99d)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      r = Math.random();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(r);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This uses the <b>static</b> method <b>random(&nbsp;)</b>
in the <b>Math</b> library, which generates a <b>double </b>value between 0 and
1. (It includes 0, but not 1.) The conditional expression for the <b>while</b>
says “keep doing this loop until the number is 0.99 or greater.” Each time you
run this program you’ll get a different-sized list of numbers.</span></p>

<h3><a name="_Toc481064562"></a><a name="_Toc375545268"><span lang=EN-US>do-while</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The form for <b>do-while</b> is</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><b><span lang=EN-US>do</span></b></p>

<p class=Code style='margin-left:0cm'><b><span lang=EN-US>  </span></b><span
lang=EN-US>statement</span></p>

<p class=CodeInline style='margin-left:0cm'><b><span lang=EN-US>while(</span></b><span
lang=EN-US>Boolean-expression<b>);</b></span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The sole difference between <b>while</b> and
<b>do-while</b> is that the statement of the <b>do-while</b> always executes at
least once, even if the expression evaluates to false the first time. In a <b>while</b>,
if the conditional is false the first time the statement never executes. In
practice, <b>do-while</b> is less common than <b>while</b>.</span></p>

<h3><a name="_Toc481064563"></a><a name="_Toc375545269"><span lang=EN-US>for</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A <b>for</b> loop performs initialization
before the first iteration. Then it performs conditional testing and, at the
end of each iteration, some form of “stepping.” The form of the <b>for</b> loop
is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><b><span lang=EN-US>for(</span></b><span
lang=EN-US>initialization<b>;</b>&nbsp;Boolean-expression<b>;</b>&nbsp;step<b>)</b></span></p>

<p class=CodeInline style='margin-left:0cm'><b><span lang=EN-US>  </span></b><span
lang=EN-US>statement</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Any of the expressions <i>initialization</i>,
<i>Boolean-expression</i> or <i>step</i> can be empty. The expression is tested
before each iteration, and as soon as it evaluates to <b>false</b> execution
will continue at the line following the <b>for</b> statement. At the end of
each loop, the <i>step</i> executes.</span></p>

<p class=MsoNormal><b><span lang=EN-US>for</span></b><span lang=EN-US> loops
are usually used for “counting” tasks:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c03:ListCharacters.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates
&quot;for&quot; loop by listing</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// all the ASCII
characters.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ListCharacters {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  for( char c = 0; c
&lt; 128; c++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if (c != 26 )  //
ANSI Clear screen</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;value:
&quot; + (int)c +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;
character: &quot; + c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that the variable <b>c</b> is defined
at the point where it is used, inside the control expression of the <b>for</b>
loop, rather than at the beginning of the block denoted by the open curly
brace. The scope of <b>c </b>is the expression controlled by the <b>for</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Traditional procedural languages like C
require that all </span><span
lang=EN-US>variables be defined at the beginning of a block so when the
compiler creates a block it can allocate space for those variables. In Java and
C++ you can spread your variable declarations throughout the block, defining
them at the point that you need them. This allows a more natural coding style
and makes code easier to understand.</span></p>

<p class=MsoNormal><span lang=EN-US>You can define multiple variables within a <b>for</b>
statement, but they must be of the same type:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>for(int i = 0, j = 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i &lt; 10 &amp;&amp;
j != 11;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i++, j++)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  /* body of for
loop */;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>int </b>definition in the <b>for </b>statement
covers both <b>i </b>and <b>j</b>.<b> </b>The ability to define variables in
the control expression is limited to the <b>for</b> loop. You cannot use this
approach with any of the other selection or iteration statements.</span></p>

<h4><a name="_Toc375545270"><span lang=EN-US>The comma operator</span></a></h4>

<p class=MsoNormal><span lang=EN-US>Earlier in this chapter I stated that the </span><span lang=EN-US>comma <i>operator</i> (not the comma <i>separator</i>, which is used
to separate definitions and function arguments) has only one use in Java: in
the control expression of a <b>for</b> loop. In both the initialization and
step portions of the control expression you can have a number of statements
separated by commas, and those statements will be evaluated sequentially. The
previous bit of code uses this ability. Here’s another example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c03:CommaOperator.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
CommaOperator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 1, j = i
+ 10; i &lt; 5;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        i++, j = i * 2)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;i= &quot; + i + &quot; j= &quot; + j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s the output:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i= 1 j= 11</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i= 2 j= 4</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i= 3 j= 6</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>i= 4 j= 8</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that in both the initialization
and step portions the statements are evaluated in sequential order. Also, the
initialization portion can have any number of definitions <i>of one type</i>.</span></p>

<h3><a name="_Toc481064564"><span lang=EN-US>break and continue</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Inside the body of any of the iteration
statements you can also control the flow of the loop by using <b>break</b> and <b>continue</b>.
<b>break</b> quits the loop without executing the rest of the statements in the
loop. <b>continue</b> stops the execution of the current iteration and goes
back to the beginning of the loop to begin the next iteration.</span></p>

<p class=MsoNormal><span lang=EN-US>This program shows examples of <b>break</b>
and <b>continue</b> within <b>for </b>and <b>while</b> loops:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c03:BreakAndContinue.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates break
and continue keywords.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
BreakAndContinue {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 100; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i == 74) break;
// Out of for loop</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i % 9 != 0)
continue; // Next iteration</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // An &quot;infinite
loop&quot;:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int j = i * 27;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(j == 1269)
break; // Out of loop</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i % 10 != 0)
continue; // Top of loop</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In the <b>for</b> loop the value of <b>i</b>
never gets to 100 because the <b>break</b> statement breaks out of the loop
when <b>i</b> is 74. Normally, you’d use a <b>break</b> like this only if you
didn’t know when the terminating condition was going to occur. The <b>continue</b>
statement causes execution to go back to the top of the iteration loop (thus
incrementing <b>i</b>) whenever <b>i</b> is not evenly divisible by 9. When it
is, the value is printed.</span></p>

<p class=MsoNormal><span lang=EN-US>The second portion shows an “infinite loop”
that would, in theory, continue forever. However, inside the loop there is a <b>break</b>
statement that will break out of the loop. In addition, you’ll see that the <b>continue</b>
moves back to the top of the loop without completing the remainder. (Thus
printing happens in the second loop only when the value of <b>i</b> is
divisible by 10.) The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>9</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>18</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>27</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>36</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>45</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>54</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>63</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>72</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>10</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>20</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>30</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>40</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The value 0 is printed because 0 % 9
produces 0.</span></p>

<p class=MsoNormal><span lang=EN-US>A second form of the infinite loop is <b>for(;;)</b>.
The compiler treats both <b>while(true)</b> and <b>for(;;)</b> in the same way
so whichever one you use is a matter of programming taste.</span></p>

<h4><span lang=EN-US>The infamous “goto”</span></h4>

<p class=MsoNormal><span lang=EN-US>The </span><span
lang=EN-US><b>goto </b>keyword has been present in programming languages from
the beginning. Indeed, <b>goto</b> was the genesis of program control in
assembly language: “if condition A, then jump here, otherwise jump there.” If
you read the assembly code that is ultimately generated by virtually any
compiler, you’ll see that program control contains many jumps. However, a <b>goto
</b>is a jump at the source-code level, and that’s what brought it into
disrepute. If a program will always jump from one point to another, isn’t there
some way to reorganize the code so the flow of control is not so jumpy? <b>goto
</b>fell into true disfavor with the publication of the famous “Goto considered
harmful” paper by Edsger Dijkstra, and since then goto-bashing has been a
popular sport, with advocates of the cast-out keyword scurrying for cover.</span></p>

<p class=MsoNormal><span lang=EN-US>As is typical in situations like this, the
middle ground is the most fruitful. The problem is not the use of <b>goto</b>,
but the overuse of <b>goto</b>—in rare situations <b>goto</b> is actually the
best way to structure control flow.</span></p>

<p class=MsoNormal><span lang=EN-US>Although <b>goto </b>is a reserved word in
Java, it is not used in the language; Java has no <b>goto</b>. However, it does
have something that looks a bit like a jump tied in with the <b>break</b> and <b>continue</b>
keywords. It’s not a jump but rather a way to break out of an iteration
statement. <span style='display:none'> </span>The reason it’s often thrown in
with discussions of <b>goto</b> is because it uses the same mechanism: a label.</span></p>

<p class=MsoNormal><span lang=EN-US>A </span><span
lang=EN-US>label is an identifier followed by a colon, like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>label1:</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <i>only</i> place a label is useful in
Java is right before an iteration statement. And that means <i>right</i>
before—it does no good to put any other statement between the label and the
iteration. And the sole reason to put a label before an iteration is if you’re
going to nest another iteration or a switch inside it. That’s because the </span><span lang=EN-US><b>break</b> and </span><span
lang=EN-US><b>continue</b> keywords will normally interrupt only the current
loop, but when used with a label they’ll interrupt the loops up to where the
label exists:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>label1: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>outer-iteration {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  inner-iteration {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //…</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    <b>break</b>; // 1</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //…</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    <b>continue</b>;  //
2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //…</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    <b>continue</b>
label1; // 3</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //…</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    <b>break</b>
label1;  // 4</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In case 1, the <b>break</b> breaks out of
the inner iteration and you end up in the outer iteration. In case 2, the <b>continue</b>
moves back to the beginning of the inner iteration. But in case 3, the <b>continue
label1</b> breaks out of the inner iteration <i>and</i> the outer iteration,
all the way back to <b>label1</b>. Then it does in fact continue the iteration,
but starting at the outer iteration. In case 4, the <b>break label1</b> also
breaks all the way out to <b>label1</b>, but it does not re-enter the
iteration. It actually does break out of both iterations.</span></p>

<p class=MsoNormal><span lang=EN-US>Here is an example using <b>for</b> loops:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:LabeledFor.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Java’s &quot;labeled
for&quot; loop.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class LabeledFor
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    outer: // Can't have
statements here</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(; true ;) { //
infinite loop</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      inner: // Can't
have statements here</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(; i &lt; 10;
i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        prt(&quot;i =
&quot; + i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(i == 2) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
prt(&quot;continue&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          continue;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(i == 3) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
prt(&quot;break&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          i++; //
Otherwise i never</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>               // gets
incremented.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(i == 7) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
prt(&quot;continue outer&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          i++; //
Otherwise i never</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>               // gets
incremented.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          continue
outer;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(i == 8) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
prt(&quot;break outer&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          break outer;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int k = 0; k
&lt; 5; k++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          if(k == 3) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
prt(&quot;continue inner&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            continue
inner;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Can't break or
continue</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // to labels here</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void prt(String
s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This uses the <b>prt(&nbsp;)</b> method
that has been defined in the other examples.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that <b>break</b> breaks out of the <b>for</b>
loop, and that the increment-expression doesn’t occur until the end of the pass
through the <b>for</b> loop. Since <b>break</b> skips the increment expression,
the increment is performed directly in the case of <b>i == 3</b>. The <b>continue
outer</b> statement in the case of <b>i == 7 </b>also goes to the top of the
loop and also skips the increment, so it too is incremented directly.</span></p>

<p class=MsoNormal><span lang=EN-US>Here is the output:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>continue inner</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 1</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>continue inner</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>continue</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 3</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>break</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 4</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>continue inner</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 5</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>continue inner</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 6</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>continue inner</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 7</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>continue outer</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 8</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>break outer</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If not for the <b>break outer</b>
statement, there would be no way to get out of the outer loop from within an
inner loop, since <b>break</b> by itself can break out of only the innermost
loop. (The same is true for <b>continue</b>.)</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, in the cases where breaking out
of a loop will also exit the method, you can simply use a <b>return</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Here is a demonstration of labeled <b>break</b>
and <b>continue</b> statements with <b>while</b> loops:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c03:LabeledWhile.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Java's &quot;labeled
while&quot; loop.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
LabeledWhile {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    outer:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      prt(&quot;Outer
while loop&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        prt(&quot;i =
&quot; + i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(i == 1) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
prt(&quot;continue&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          continue;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(i == 3) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
prt(&quot;continue outer&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          continue
outer;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(i == 5) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
prt(&quot;break&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(i == 7) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
prt(&quot;break outer&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          break outer;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void prt(String
s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The same rules hold true for <b>while</b>:</span></p>

<p class=Numbered><span lang=EN-US>A plain <b>continue</b> goes to the top of
the innermost loop and continues.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>23.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>A labeled <b>continue</b> goes to the label and re-enters the loop
right after that label.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>24.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>A <b>break</b> “drops out of the bottom” of the loop.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>25.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>A labeled <b>break</b> drops out of the bottom of the end of the
loop denoted by the label. </span></p>

<p class=MsoNormal><span lang=EN-US>The output of this method makes it clear:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Outer while loop</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 1</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>continue</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 3</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>continue outer</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Outer while loop</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 4</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 5</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>break</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Outer while loop</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 6</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 7</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>break outer</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It’s important to remember that the <i>only</i>
reason to use labels in Java is when you have nested loops and you want to <b>break</b>
or <b>continue</b> through more than one nested level.</span></p>

<p class=MsoNormal><span lang=EN-US>In Dijkstra’s “goto considered harmful”
paper, what he specifically objected to was the labels, not the goto. He observed
that the number of bugs seems to increase with the number of labels in a program.
Labels and gotos make programs difficult to analyze statically, since it
introduces cycles in the program execution graph. Note that Java labels don’t
suffer from this problem, since they are constrained in their placement and
can’t be used to transfer control in an ad hoc manner. It’s also interesting to
note that this is a case where a language feature is made more useful by restricting
the power of the statement.</span></p>

<h3><a name="_Toc481064565"></a><a name="_Toc375545271"><span lang=EN-US>switch</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The <b>switch</b> is sometimes classified
as a <i>selection statement</i>. The <b>switch </b>statement selects from among
pieces of code based on the value of an integral expression. Its form is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><b><span lang=EN-US>switch(</span></b><span
lang=EN-US>integral-selector<b>) {</b></span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  <b>case</b>
integral-value1<b> :</b> statement<b>;</b> <b>break;</b> </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  <b>case</b>
integral-value2 <b>:</b> statement<b>;</b> <b>break;</b></span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  <b>case</b>
integral-value3 <b>:</b> statement<b>;</b> <b>break;</b></span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  <b>case</b>
integral-value4 <b>:</b> statement<b>;</b> <b>break;</b></span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  <b>case</b>
integral-value5 <b>:</b> statement<b>;</b> <b>break;</b></span></p>

<p class=Code style='margin-left:0cm'><b><span lang=EN-US>          // ...</span></b></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  <b>default:</b>
statement<b>;</b></span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><i><span lang=EN-US>Integral-selector</span></i><span
lang=EN-US> is an expression that produces an integral value. The <b>switch</b>
compares the result of <i>integral-selector</i> to each<i> integral-value</i>.
If it finds a match, the corresponding <i>statement</i> (simple or compound)
executes. If no match occurs, the <b>default</b> </span><span
lang=EN-US><i>statement</i> executes.</span></p>

<p class=MsoNormal><span lang=EN-US>You will notice in the above definition
that each <b>case</b></span><span lang=EN-US> ends with a <b>break</b>, which
causes execution to jump to the end of the <b>switch</b> body. This is the
conventional way to build a <b>switch</b> statement, but the <b>break</b> is
optional. If it is missing, the code for the following case statements execute
until a <b>break</b> is encountered. Although you don’t usually want this kind
of behavior, it can be useful to an experienced programmer. Note the last
statement, following the <b>default</b>, doesn’t have a <b>break</b> because
the execution just falls through to where the <b>break</b> would have taken it
anyway. You could put a <b>break</b> at the end of the <b>default</b> statement
with no harm if you considered it important for style’s sake.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>switch</b> statement is a clean way
to implement multi-way selection (i.e., selecting from among a number of
different execution paths), but it requires a selector that evaluates to an
integral value such as <b>int</b> or <b>char</b>. If you want to use, for
example, a string or a floating-point number as a selector, it won’t work in a <b>switch</b>
statement. For non-integral types, you must use a series of <b>if</b>
statements.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example that creates letters
randomly and determines whether they’re vowels or consonants:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c03:VowelsAndConsonants.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates the
switch statement.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
VowelsAndConsonants {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 100; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      char c =
(char)(Math.random() * 26 + 'a');</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.out.print(c
+ &quot;: &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      switch(c) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 'a':</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 'e':</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 'i':</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 'o':</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 'u':</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>               
System.out.println(&quot;vowel&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>                break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 'y':</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 'w':</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>               
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>                 
&quot;Sometimes a vowel&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>                break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      default:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>               
System.out.println(&quot;consonant&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Since <b>Math.random(&nbsp;)</b> generates
a value between 0 and 1, you need only multiply it by the upper bound of the
range of numbers you want to produce (26 for the letters in the alphabet) and
add an offset to establish the lower bound. </span></p>

<p class=MsoNormal><span lang=EN-US>Although it appears you’re switching on a
character here, the <b>switch</b> statement is actually using the integral
value of the character. The singly-quoted characters in the <b>case</b>
statements also produce integral values that are used for comparison.</span></p>

<p class=MsoNormal><span lang=EN-US>Notice how the <b>case</b>s can be
“stacked” on top of each other to provide multiple matches for a particular
piece of code. You should also be aware that it’s essential to put the <b>break</b>
statement at the end of a particular case, otherwise control will simply drop
through and continue processing on the next case.</span></p>

<h4><span lang=EN-US>Calculation details</span></h4>

<p class=Code style='margin-bottom:9.0pt;border:none'><span lang=EN-US
style='font-family:"Georgia","serif"'>The statement:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>char c =
(char)(Math.random() * 26 + 'a');</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>deserves a closer look. <b>Math.random(&nbsp;)</b>
produces a <b>double</b>, so the value 26 is converted to a <b>double</b> to
perform the multiplication, which also produces a <b>double</b>. This means
that <b>‘a’</b> must be converted to a <b>double</b> to perform the addition.
The <b>double</b> result is turned back into a <b>char</b> with a cast.</span></p>

<p class=MsoNormal><span lang=EN-US>What does the cast to <b>char</b> do? That
is, if you have the value 29.7 and you cast it to a <b>char</b>, is the
resulting value 30 or 29? The answer to this can be seen in this example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c03:CastingNumbers.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// What happens when you
cast a float </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// or double to an
integral value?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
CastingNumbers {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      above = 0.7,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      below = 0.4;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;above: &quot; + above);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;below: &quot; + below);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;(int)above:
&quot; + (int)above);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;(int)below:
&quot; + (int)below);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;(char)('a' +
above): &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (char)('a' +
above));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;(char)('a' +
below): &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (char)('a' + below));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>above: 0.7</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>below: 0.4</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(int)above: 0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(int)below: 0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(char)('a' + above): a</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>(char)('a' +
below): a</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>So the answer is that </span><span lang=EN-US>casting from a <b>float</b> or <b>double</b> to an integral value always
truncates.</span></p>

<p class=MsoNormal><span lang=EN-US>A second question concerns </span><span lang=EN-US><b>Math.random(&nbsp;)</b>. Does it produce a value from zero to one,
inclusive or exclusive of the value ‘1’? In math lingo, is it (0,1), or [0,1],
or (0,1] or [0,1)? (The square bracket means “includes” whereas the parenthesis
means “doesn’t include.”) Again, a test program might provide the answer:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c03:RandomBounds.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Does Math.random()
produce 0.0 and 1.0?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
RandomBounds {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void usage() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Usage: \n\t&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;RandomBounds
lower\n\t&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;RandomBounds
upper&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.exit(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length != 1)
usage();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args[0].equals(&quot;lower&quot;))
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
while(Math.random() != 0.0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        ; // Keep trying</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Produced 0.0!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else
if(args[0].equals(&quot;upper&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
while(Math.random() != 1.0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        ; // Keep trying</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.out.println(&quot;Produced
1.0!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      usage();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>To run the program, you type a command line
of either:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>java RandomBounds
lower</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>or</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>java RandomBounds
upper</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In both cases you are forced to break out
of the program manually, so it would <i>appear</i> that <b>Math.random(&nbsp;)</b>
never produces either 0.0 or 1.0. But this is where such an experiment can be
deceiving. If you consider</span><a href="#_ftn26" name="_ftnref26" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[26]</span></span></span></span></a><span lang=EN-US> that
there are about 2<sup>62</sup> different double fractions between 0 and 1, the
likelihood of reaching any one value experimentally might exceed the lifetime
of one computer, or even one experimenter. It turns out that 0.0 <i>is</i>
included in the output of <b>Math.random(&nbsp;)</b>. Or, in math lingo, it is
[0,1).</span></p>

<h2><a name="_Toc481064566"></a><a name="_Toc375545272"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>This chapter concludes the study of
fundamental features that appear in most programming languages: calculation,
operator precedence, type casting, and selection and iteration. Now you’re
ready to begin taking steps that move you closer to the world of
object-oriented programming. The next chapter will cover the important issues of
initialization and cleanup of objects, followed in the subsequent chapter by
the essential concept of implementation hiding.</span></p>

<h2><a name="_Toc481064567"></a><a name="_Toc375545273"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>, available
for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>There are two expressions in the section labeled
“precedence” early in this chapter. Put these expressions into a program and
demonstrate that they produce different results.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>13. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Put the methods ternary(&nbsp;) and
alternative(&nbsp;) into a working program.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>14. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>From the sections labeled “if-else” and
“return”, put the methods test(&nbsp;) and test2(&nbsp;) into a working
program.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>15. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a program that prints values from one to
100.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>16. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 4 so that the program exits by
using the break keyword at value 47. Try using return instead.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>17. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a function that takes two String
arguments, and uses all the Boolean comparisons to compare the two Strings and
print the results. For the == and !=, also perform the equals(&nbsp;) test. In
main(&nbsp;), call your function with some different String objects.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>18. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a program that generates 25 random int
values. For each value, use an if-then-else statement to classify it as greater
than, less than or equal to a second randomly-generated value.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>19. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 7 so that your code is
surrounded by an “infinite” while loop. It will then run until you interrupt it
from the keyboard (typically by pressing Control-C).</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>20. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a program that uses two nested for loops
and the modulus operator (%) to detect and print prime numbers (integral
numbers that are not evenly divisible by any other numbers except for
themselves and 1).</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>21. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a switch statement that prints a message
for each case, and put the switch inside a for loop that tries each case. Put a
break after each case and test it, then remove the breaks and see what happens.</span></p>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection10>

<h1><a name="_Toc481064568"></a><a name="_Toc477690724"></a><a
name="_Toc375545274"></a><a name="Chapter_4"></a><span lang=EN-US>4:
Initialization <br>
&amp; Cleanup</span></h1>

<p class=Intro><span lang=EN-US>As the computer revolution progresses, “unsafe”
programming has become one of the major culprits that makes programming
expensive.</span></p>

<p class=MsoNormal><span lang=EN-US>Two of these safety issues are <i>initialization</i>
and <i>cleanup</i>. Many C bugs occur when the programmer forgets to initialize
a variable. This is especially true with libraries when users don’t know how to
initialize a library component, or even that they must. Cleanup is a special
problem because it’s easy to forget about an element when you’re done with it,
since it no longer concerns you. Thus, the resources used by that element are
retained and you can easily end up running out of resources (most notably,
memory). </span></p>

<p class=MsoNormal><span lang=EN-US>C++ introduced the concept of a <i>constructor</i>,
a special method automatically called when an object is created. Java also
adopted the constructor, and in addition has a garbage collector that
automatically releases memory resources when they’re no longer being used. This
chapter examines the issues of initialization and cleanup, and their support in
Java.</span></p>

<h2><a name="_Toc481064569"></a><a name="_Toc375545275"></a><a
name="_Toc312373853"><span lang=EN-US>Guaranteed initialization <br>
with the constructor</span></a></h2>

<p class=MsoNormal><span lang=EN-US>You can imagine creating a method called <b>initialize(&nbsp;)</b>
for every class you write. The name is a hint that it should be called before
using the object. Unfortunately, this means the user must remember to call the
method. In Java, the class designer can guarantee initialization of every
object by providing a special method called a <i>constructor</i></span><span lang=EN-US>. If a class has a constructor, Java automatically calls that
constructor when an object is created, before users can even get their hands on
it. So initialization is guaranteed.</span></p>

<p class=MsoNormal><span lang=EN-US>The next challenge is what to name this method.
There are two issues. The first is that any name you use could clash with a
name you might like to use as a member in the class. The second is that because
the compiler is responsible for calling the constructor, it must always know
which method to call. The C++ solution seems the easiest and most logical, so
it’s also used in Java: the name of the constructor </span><span
lang=EN-US>is the same as the name of the class. It makes sense that such a
method will be called automatically on initialization.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s a simple class with a constructor:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c04:SimpleConstructor.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstration of a
simple constructor.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Rock {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Rock() { // This is
the constructor</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Creating Rock&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
SimpleConstructor {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Rock();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now, when an </span><span
lang=EN-US>object is created:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>new Rock();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>storage is allocated and the constructor is
called. It is guaranteed that the object will be properly initialized before
you can get your hands on it.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that the coding style of making the
first letter of all methods lowercase does not apply to constructors, since the
name of the constructor must match the name of the class <i>exactly</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>Like any method, the constructor can have
arguments</span><span lang=EN-US> to allow you to specify <i>how</i> an object
is created. The above example can easily be changed so the constructor takes an
argument:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c04:SimpleConstructor2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Constructors can have
arguments.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Rock2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Rock2(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Creating
Rock number &quot; + i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
SimpleConstructor2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Rock2(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Constructor arguments provide you with a
way to provide parameters for the initialization of an object. For example, if
the class <b>Tree</b> has a constructor that takes a single integer argument
denoting the height of the tree, you would create a <b>Tree</b> object like
this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Tree t = new
Tree(12);  // 12-foot tree</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If <b>Tree(int)</b> is your only
constructor, then the compiler won’t let you create a <b>Tree</b> object any
other way. </span></p>

<p class=MsoNormal><span lang=EN-US>Constructors eliminate a large class of
problems and make the code easier to read. In the preceding code fragment, for
example, you don’t see an explicit call to some <b>initialize(&nbsp;)</b>
method that is conceptually separate from definition. In Java, definition and
initialization are unified concepts—you can’t have one without the other.</span></p>

<p class=MsoNormal><span lang=EN-US>The constructor is an unusual type of
method because it has no return value</span><span lang=EN-US>. This is distinctly different from a <b>void</b> return value, in
which the method returns nothing but you still have the option to make it
return something else. Constructors return nothing and you don’t have an
option. If there was a return value, and if you could select your own, the
compiler would somehow need to know what to do with that return value.</span></p>

<h2><a name="_Toc481064570"></a><a name="_Toc375545276"><span lang=EN-US>Method
overloading</span></a></h2>

<p class=MsoNormal><span
lang=EN-US>One of the important features in any programming language is the use
of names. When you create an object, you give a name to a region of storage. A
method is a name for an action. By using names to describe your system, you
create a program that is easier for people to understand and change. It’s a lot
like writing prose—the goal is to communicate with your readers.</span></p>

<p class=MsoNormal><span lang=EN-US>You refer to all objects and methods by
using names. Well-chosen names make it easier for you and others to understand
your code. </span></p>

<p class=MsoNormal><span lang=EN-US>A problem arises when mapping the concept
of nuance in human language onto a programming language. Often, the same word
expresses a number of different meanings—it’s <i>overloaded</i>. This is
useful, especially when it comes to trivial differences. You say “wash the
shirt,” “wash the car,” and “wash the dog.” It would be silly to be forced to
say, “shirtWash the shirt,” “carWash the car,” and “dogWash the dog” just so
the listener doesn’t need to make any distinction about the action performed.
Most human languages are redundant, so even if you miss a few words, you can
still determine the meaning. We don’t need unique identifiers—we can deduce
meaning from context.</span></p>

<p class=MsoNormal><span lang=EN-US>Most programming languages (C in
particular) require you to have a unique identifier for each function. So you
could not have one function called <b>print(&nbsp;)</b> for printing integers
and another called <b>print(&nbsp;)</b> for printing floats—each function
requires a unique name.</span></p>

<p class=MsoNormal><span lang=EN-US>In Java (and C++), another factor forces
the overloading of method names: the constructor</span><span lang=EN-US>. Because the constructor’s name is predetermined by the name of the
class, there can be only one constructor name. But what if you want to create
an object in more than one way? For example, suppose you build a class that can
initialize itself in a standard way or by reading information from a file. You
need two constructors, one that takes no arguments (the <i>default</i> constructor,
also called the <i>no-arg</i> constructor), and one that takes a <b>String</b>
as an argument, which is the name of the file from which to initialize the
object. Both are constructors, so they must have the same name—the name of the
class. Thus, <i>method overloading</i> is essential to allow the same method
name to be used with different argument types. And although method overloading
is a must for constructors, it’s a general convenience and can be used with any
method. </span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example that shows both
overloaded constructors and overloaded ordinary methods:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c04:Overloading.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstration of both
constructor</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// and ordinary method
overloading.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Tree {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int height;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Tree() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;Planting a
seedling&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    height = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Tree(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;Creating
new Tree that is &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        + i + &quot;
feet tall&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    height = i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void info() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;Tree is
&quot; + height</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        + &quot; feet
tall&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void info(String s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(s + &quot;: Tree
is &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        + height +
&quot; feet tall&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void prt(String
s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Overloading
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 5; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Tree t = new
Tree(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t.info();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t.info(&quot;overloaded method&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Overloaded
constructor:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new Tree();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>A <b>Tree</b> object can be created either
as a seedling, with no argument, or as a plant grown in a nursery, with an
existing height. To support this, there are two constructors, one that takes no
arguments (we call constructors that take no arguments </span><span lang=EN-US><i>default constructors</i></span><a href="#_ftn27" name="_ftnref27"
title=""><span class=MsoFootnoteReference><span lang=EN-US style='font-size:
8.0pt'><span class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;
font-family:"Georgia","serif"'>[27]</span></span></span></span></a><span
lang=EN-US>) and one that takes the existing height.</span></p>

<p class=MsoNormal><span lang=EN-US>You might also want to call the <b>info(&nbsp;)</b>
method in more than one way. For example, with a <b>String</b> argument if you
have an extra message you want printed, and without if you have nothing more to
say. It would seem strange to give two separate names to what is obviously the
same concept. Fortunately, method overloading allows you to use the same name
for both.</span></p>

<h3><a name="_Toc481064571"></a><a name="_Toc375545277"><span lang=EN-US>Distinguishing
overloaded methods</span></a></h3>

<p class=MsoNormal><span lang=EN-US>If the methods have the same name, how can Java know which method you
mean? There’s a simple rule: each overloaded method must take a unique list of
argument types.</span></p>

<p class=MsoNormal><span lang=EN-US>If you think about this for a second, it
makes sense: how else could a programmer tell the difference between two
methods that have the same name, other than by the types of their arguments?</span></p>

<p class=MsoNormal><span lang=EN-US>Even differences in the ordering of
arguments are sufficient to distinguish two methods: (Although you don’t
normally want to take this approach, as it produces difficult-to-maintain
code.)</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c04:OverloadingOrder.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Overloading based on
the order of</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// the arguments.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
OverloadingOrder {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
print(String s, int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;String:
&quot; + s +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;, int:
&quot; + i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void print(int
i, String s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;int: &quot;
+ i +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;, String:
&quot; + s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(&quot;String
first&quot;, 11);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(99, &quot;Int
first&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The two <b>print(&nbsp;)</b> methods have
identical arguments, but the order is different, and that’s what makes them
distinct.</span></p>

<h3><a name="_Toc375545278"></a><a name="_Toc312373866"></a><a
name="_Toc481064572"><span lang=EN-US>Overloading with primitives</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A primitive can be automatically promoted
from a smaller type to a larger one and this can be slightly confusing in
combination with overloading. The following example demonstrates what happens
when a primitive is handed to an overloaded method:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c04:PrimitiveOverloading.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Promotion of
primitives and overloading.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
PrimitiveOverloading {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // boolean can't be
automatically converted</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void prt(String
s) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(s);
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(char x) {
prt(&quot;f1(char)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(byte x) {
prt(&quot;f1(byte)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(short x) {
prt(&quot;f1(short)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(int x) {
prt(&quot;f1(int)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(long x) {
prt(&quot;f1(long)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(float x) {
prt(&quot;f1(float)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(double x) {
prt(&quot;f1(double)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(byte x) {
prt(&quot;f2(byte)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(short x) {
prt(&quot;f2(short)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(int x) {
prt(&quot;f2(int)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(long x) {
prt(&quot;f2(long)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(float x) {
prt(&quot;f2(float)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(double x) {
prt(&quot;f2(double)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f3(short x) {
prt(&quot;f3(short)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f3(int x) {
prt(&quot;f3(int)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f3(long x) {
prt(&quot;f3(long)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f3(float x) {
prt(&quot;f3(float)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f3(double x) {
prt(&quot;f3(double)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f4(int x) {
prt(&quot;f4(int)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f4(long x) {
prt(&quot;f4(long)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f4(float x) {
prt(&quot;f4(float)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f4(double x) {
prt(&quot;f4(double)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f5(long x) {
prt(&quot;f5(long)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f5(float x) {
prt(&quot;f5(float)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f5(double x) {
prt(&quot;f5(double)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f6(float x) {
prt(&quot;f6(float)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f6(double x) {
prt(&quot;f6(double)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f7(double x) {
prt(&quot;f7(double)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void testConstVal() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;Testing
with 5&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
f1(5);f2(5);f3(5);f4(5);f5(5);f6(5);f7(5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void testChar() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    char x = 'x';</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;char
argument:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
f1(x);f2(x);f3(x);f4(x);f5(x);f6(x);f7(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void testByte() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    byte x = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;byte
argument:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
f1(x);f2(x);f3(x);f4(x);f5(x);f6(x);f7(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void testShort() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    short x = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;short
argument:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
f1(x);f2(x);f3(x);f4(x);f5(x);f6(x);f7(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void testInt() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int x = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;int
argument:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
f1(x);f2(x);f3(x);f4(x);f5(x);f6(x);f7(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void testLong() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long x = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;long
argument:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f1(x);f2(x);f3(x);f4(x);f5(x);f6(x);f7(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void testFloat() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    float x = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;float
argument:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
f1(x);f2(x);f3(x);f4(x);f5(x);f6(x);f7(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void testDouble() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double x = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;double
argument:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
f1(x);f2(x);f3(x);f4(x);f5(x);f6(x);f7(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PrimitiveOverloading
p = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
PrimitiveOverloading();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.testConstVal();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.testChar();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.testByte();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.testShort();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.testInt();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.testLong();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.testFloat();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.testDouble();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you view the output of this program,
you’ll see that the constant value 5 is treated as an <b>int</b>, so if an
overloaded method is available that takes an <b>int</b> it is used. In all
other cases, if you have a data type that is smaller than the argument in the
method, that data type is promoted. <b>char</b> produces a slightly different
effect, since if it doesn’t find an exact <b>char</b> match, it is promoted to <b>int</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>What happens if your argument is <i>bigger</i>
than the argument expected by the overloaded method? A modification of the
above program gives the answer:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c04:Demotion.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demotion of
primitives and overloading.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Demotion {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void prt(String
s) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(char x) {
prt(&quot;f1(char)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(byte x) {
prt(&quot;f1(byte)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(short x) {
prt(&quot;f1(short)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(int x) {
prt(&quot;f1(int)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(long x) {
prt(&quot;f1(long)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(float x) {
prt(&quot;f1(float)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f1(double x) {
prt(&quot;f1(double)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(char x) {
prt(&quot;f2(char)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(byte x) {
prt(&quot;f2(byte)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(short x) {
prt(&quot;f2(short)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(int x) {
prt(&quot;f2(int)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(long x) {
prt(&quot;f2(long)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(float x) {
prt(&quot;f2(float)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f3(char x) {
prt(&quot;f3(char)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f3(byte x) {
prt(&quot;f3(byte)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f3(short x) {
prt(&quot;f3(short)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f3(int x) {
prt(&quot;f3(int)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f3(long x) {
prt(&quot;f3(long)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f4(char x) {
prt(&quot;f4(char)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f4(byte x) {
prt(&quot;f4(byte)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f4(short x) {
prt(&quot;f4(short)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f4(int x) {
prt(&quot;f4(int)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f5(char x) {
prt(&quot;f5(char)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f5(byte x) {
prt(&quot;f5(byte)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f5(short x) {
prt(&quot;f5(short)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f6(char x) {
prt(&quot;f6(char)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f6(byte x) {
prt(&quot;f6(byte)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f7(char x) {
prt(&quot;f7(char)&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void testDouble() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double x = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;double
argument:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
f1(x);f2((float)x);f3((long)x);f4((int)x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
f5((short)x);f6((byte)x);f7((char)x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Demotion p = new
Demotion();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.testDouble();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Here, the methods take narrower primitive
values. If your argument is wider then you must </span><span
lang=EN-US><i>cast</i> to the necessary type using the type name in
parentheses. If you don’t do this, the compiler will issue an error message.</span></p>

<p class=MsoNormal><span lang=EN-US>You should be aware that this is a </span><span lang=EN-US><i>narrowing conversion,</i> which means you might lose information
during the cast. This is why the compiler forces you to do it—to flag the
narrowing conversion. </span></p>

<h3><a name="_Toc481064573"><span lang=EN-US>Overloading on return values</span></a></h3>

<p class=MsoNormal><span lang=EN-US>It is common to wonder “Why only class names and method argument
lists? Why not distinguish between methods based on their return values?” For example,
these two methods, which have the same name and arguments, are easily
distinguished from each other:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>void f() {}</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>int f() {}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This works fine when the compiler can
unequivocally determine the meaning from the context, as in <b>int x =
f(&nbsp;)</b>. However, you can call a method and ignore the return value; this
is often referred to as <i>calling a method for its </i></span><i><span lang=EN-US>side effect</span></i><span lang=EN-US> since you don’t care about
the return value but instead want the other effects of the method call. So if
you call the method this way:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>f();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>how can Java determine which <b>f(&nbsp;)</b>
should be called? And how could someone reading the code see it? Because of
this sort of problem, you cannot use return value types to distinguish
overloaded methods.</span></p>

<h3><a name="_Toc481064574"></a><a name="_Toc375545279"><span lang=EN-US>Default
constructors</span></a></h3>

<p class=MsoNormal><span lang=EN-US>As mentioned previously, a default
constructor (a.k.a. a “no-arg” constructor) </span><span lang=EN-US>is one without arguments, used to create a “vanilla object.” If you
create a class that has no constructors, the compiler will automatically create
a default constructor for you. For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c04:DefaultConstructor.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Bird {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
DefaultConstructor {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Bird nc = new Bird();
// default!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The line</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>new Bird();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>creates a new object and calls the default
constructor, even though one was not explicitly defined. Without it we would
have no method to call to build our object. However, if you define any
constructors (with or without arguments), the compiler will <i>not</i>
synthesize one for you:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Bush {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Bush(int i) {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Bush(double d) {}</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now if you say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>new Bush();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>the compiler will complain that it cannot
find a constructor that matches. It’s as if when you don’t put in any
constructors, the compiler says “You are bound to need <i>some</i> constructor,
so let me make one for you.” But if you write a constructor, the compiler says
“You’ve written a constructor so you know what you’re doing; if you didn’t put
in a default it’s because you meant to leave it out.”</span></p>

<h3><a name="_Toc481064575"></a><a name="_Toc375545280"><span lang=EN-US>The </span></a><span lang=EN-US><b>this </b>keyword</span></h3>

<p class=MsoNormal><span lang=EN-US>If you have two objects of the same type
called <b>a</b> and <b>b</b>, you might wonder how it is that you can call a
method <b>f(&nbsp;)</b> for both those objects:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Banana { void
f(int i) { /* ... */ } }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Banana a = new Banana(),
b = new Banana();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>a.f(1);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>b.f(2);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If there’s only one method called <b>f(&nbsp;)</b>,
how can that method know whether it’s being called for the object <b>a</b> or <b>b</b>?
</span></p>

<p class=MsoNormal><span lang=EN-US>To allow you to write the code in a
convenient object-oriented syntax in which you “send a message to an object,”
the compiler does some undercover work for you. There’s a secret first argument
passed to the method <b>f(&nbsp;)</b>, and that argument is the reference to
the object that’s being manipulated. So the two method calls above become
something like:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Banana.f(a,1);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Banana.f(b,2);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This is internal and you can’t write these
expressions and get the compiler to accept them, but it gives you an idea of
what’s happening.</span></p>

<p class=MsoNormal><span lang=EN-US>Suppose you’re inside a method and you’d
like to get the reference to the current object. Since that reference is passed
<i>secretly</i> by the compiler, there’s no identifier for it. However, for
this purpose there’s a keyword: <b>this</b>. The <b>this</b> keyword—which can
be used only inside a method—produces the reference to the object the method
has been called for. You can treat this reference just like any other object
reference. Keep in mind that if you’re calling a method of your class from
within another method of your class, you don’t need to use <b>this</b>; you
simply call the method. The current <b>this</b> reference is automatically used
for the other method. Thus you can say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Apricot {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void pick() { /* ...
*/ }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void pit() { pick();
/* ... */ }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Inside <b>pit(&nbsp;)</b>, you <i>could</i>
say <b>this.pick(&nbsp;)</b> but there’s no need to. The compiler does it for
you automatically. The <b>this</b> keyword is used only for those special cases
in which you need to explicitly use the reference to the current object. For example,
it’s often used in <b>return</b> statements when you want to return the
reference to the current object:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c04:Leaf.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Simple use of the
&quot;this&quot; keyword.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Leaf {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Leaf increment() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return this;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void print() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;i = &quot; + i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Leaf x = new Leaf();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
x.increment().increment().increment().print();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Because <b>increment(&nbsp;)</b> returns
the reference to the current object via the <b>this</b> keyword, multiple
operations can easily be performed on the same object.</span></p>

<h4><span lang=EN-US>Calling constructors from constructors</span></h4>

<p class=MsoNormal><span
lang=EN-US>When you write several constructors for a class, there are times
when you’d like to call one constructor from another to avoid duplicating code.
You can do this using the <b>this</b> keyword. </span></p>

<p class=MsoNormal><span lang=EN-US>Normally, when you say <b>this</b>, it is
in the sense of “this object” or “the current object,” and by itself it
produces the reference to the current object. In a constructor, the <b>this</b>
keyword takes on a different meaning when you give it an argument list: it
makes an explicit call to the constructor that matches that argument list. Thus
you have a straightforward way to call other constructors:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c04:Flower.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Calling constructors
with &quot;this.&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Flower {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int petalCount = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String s = new String(&quot;null&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Flower(int petals) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    petalCount = petals;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Constructor
w/ int arg only, petalCount= &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      + petalCount);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Flower(String ss) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Constructor
w/ String arg only, s=&quot; + ss);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s = ss;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Flower(String s, int
petals) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this(petals);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//!    this(s); // Can't
call two!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this.s = s; //
Another use of &quot;this&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;String &amp; int args&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Flower() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this(&quot;hi&quot;,
47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;default
constructor (no args)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void print() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//!    this(11); // Not
inside non-constructor!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;petalCount =
&quot; + petalCount + &quot; s = &quot;+ s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Flower x = new
Flower();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.print();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The constructor <b>Flower(String s, int
petals)</b> shows that, while you can call one constructor using <b>this</b>,
you cannot call two. In addition, the constructor call must be the first thing
you do or you’ll get a compiler error message.</span></p>

<p class=MsoNormal><span lang=EN-US>This example also shows another way you’ll
see <b>this</b> used. Since the name of the argument <b>s </b>and the name of
the member data <b>s</b> are the same, there’s an ambiguity. You can resolve it
by saying <b>this.s</b> to refer to the member data. You’ll often see this form
used in Java code, and it’s used in numerous places in this book.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>print(&nbsp;)</b> you can see that
the compiler won’t let you call a constructor from inside any method other than
a constructor.</span></p>

<h4><span lang=EN-US>The meaning of <b>static</b></span></h4>

<p class=MsoNormal><span lang=EN-US>With the <b>this </b>keyword in mind, you
can more fully understand what it means to make a </span><span lang=EN-US>method <b>static</b>. It means that there is no <b>this</b> for that
particular method. You cannot call non-<b>static</b> methods from inside <b>static</b>
methods</span><a href="#_ftn28" name="_ftnref28" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[28]</span></span></span></span></a><span lang=EN-US>
(although the reverse is possible), and you can call a <b>static</b> method for
the class itself, without any object. In fact, that’s primarily what a <b>static</b>
method is for. It’s as if you’re creating the equivalent of a global function
(from C). Except global functions are not permitted in Java, and putting the <b>static</b>
method inside a class allows it access to other <b>static </b>methods and to <b>static</b>
fields.</span></p>

<p class=MsoNormal><span lang=EN-US>Some people argue that <b>static</b>
methods are not object-oriented since they do have the semantics of a global
function; with a <b>static</b> method you don’t send a message to an object,
since there’s no <b>this</b>. This is probably a fair argument, and if you find
yourself using a <i>lot</i> of static methods you should probably rethink your
strategy. However, <b>static</b>s are pragmatic and there are times when you
genuinely need them, so whether or not they are “proper OOP” should be left to
the theoreticians. Indeed, even </span><span
lang=EN-US>Smalltalk has the equivalent in its “class methods.”</span></p>

<h2><a name="_Toc481064576"></a><a name="_Toc375545281"><span lang=EN-US>Cleanup:
finalization and <br>
garbage collection</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Programmers know about the importance of
initialization, but often forget the importance of cleanup. After all, who
needs to clean up an <b>int</b>? But with libraries, simply “letting go” of an
object once you’re done with it is not always safe. Of course, Java has the </span><span lang=EN-US>garbage collector to reclaim the memory of objects that are no longer
used. Now consider a very unusual case. Suppose your object allocates “special”
memory without using </span><span lang=EN-US><b>new</b>. The garbage collector
knows only how to release memory allocated <i>with</i> <b>new</b>, so it won’t
know how to release the object’s “special” memory. To handle this case, Java
provides a method called </span><span
lang=EN-US><b>finalize(&nbsp;)</b> that you can define for your class. Here’s
how it’s <i>supposed</i> to work. When the garbage collector is ready to release
the storage used for your object, it will first call <b>finalize(&nbsp;)</b>,
and only on the next garbage-collection pass will it reclaim the object’s
memory. So if you choose to use <b>finalize(&nbsp;)</b>, it gives you the
ability to perform some important cleanup <i>at the time of garbage collection</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>This is a potential programming pitfall
because some programmers, especially C++ programmers, might initially mistake <b>finalize(&nbsp;)</b>
for the </span><span lang=EN-US><i>destructor</i> in C++, which is a function that
is always called when an object is destroyed. But it is important to
distinguish between C++ and Java here, because in C++ <i>objects always get
destroyed</i> (in a bug-free program), whereas in Java objects do not always
get garbage-collected. Or, put another way:</span></p>

<p class=makeapoint><span lang=EN-US>Garbage collection is not destruction.</span></p>

<p class=MsoNormal><span lang=EN-US>If you remember this, you will stay out of
trouble. What it means is that if there is some activity that must be performed
before you no longer need an object, you must perform that activity yourself.
Java has no destructor or similar concept, so you must create an ordinary
method to perform this cleanup. For example, suppose in the process of creating
your object it draws itself on the screen. If you don’t explicitly erase its
image from the screen, it might never get cleaned up. If you put some kind of
erasing functionality inside <b>finalize(&nbsp;)</b>, then if an object is
garbage-collected, the image will first be removed from the screen, but if it
isn’t, the image will remain. So a second point to remember is:</span></p>

<p class=makeapoint><span lang=EN-US>Your objects might not get
garbage-collected.</span></p>

<p class=MsoNormal><span lang=EN-US>You might find that the storage for an
object never gets released because your program never nears the point of
running out of storage. If your program completes and the garbage collector
never gets around to releasing the storage for any of your objects, that
storage will be returned to the operating system <i>en masse</i> as the program
exits. This is a good thing, because garbage collection has some overhead, and
if you never do it you never incur that expense.</span></p>

<h3><a name="_Toc481064577"></a><a name="_Toc375545282"><span lang=EN-US>What
is <b>finalize(&nbsp;)</b> for?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>You might believe at this point that you
should not use <b>finalize(&nbsp;)</b> as a general-purpose cleanup method.
What good is it?</span></p>

<p class=MsoNormal><span lang=EN-US>A third point to remember is:</span></p>

<p class=makeapoint><span lang=EN-US>Garbage collection is only about memory.</span></p>

<p class=MsoNormal><span lang=EN-US>That is, the sole reason for the existence
of the garbage collector is to recover memory that your program is no longer
using. So any activity that is associated with garbage collection, most notably
your <b>finalize(&nbsp;)</b> method, must also be only about memory and its
deallocation. </span></p>

<p class=MsoNormal><span lang=EN-US>Does this mean that if your object contains
other objects <b>finalize(&nbsp;)</b> should explicitly release those objects?
Well, no—the garbage collector takes care of the release of all object memory
regardless of how the object is created. It turns out that the need for <b>finalize(&nbsp;)</b>
is limited to special cases, in which your object can allocate some storage in
some way other than creating an object. But, you might observe, everything in
Java is an object so how can this be?</span></p>

<p class=MsoNormal><span lang=EN-US>It would seem that <b>finalize(&nbsp;)</b>
is in place because of the possibility that you’ll do something C-like by
allocating memory using a mechanism other than the normal one in Java. This can
happen primarily through <i>native methods</i>, which are a way to call
non-Java code from Java. (Native methods are discussed in Appendix B.) C and
C++ are the only languages currently supported by native methods, but since
they can call subprograms in other languages, you can effectively call
anything. Inside the non-Java code, C’s <b>malloc(&nbsp;)</b> family of
functions might be called to allocate storage, and unless you call <b>free(&nbsp;)</b>
that storage will not be released, causing a memory leak. Of course, <b>free(&nbsp;)</b>
is a C and C++ function, so you’d need to call it in a native method inside
your <b>finalize(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>After reading this, you probably get the
idea that you won’t use <b>finalize(&nbsp;)</b> much. You’re correct; it is not
the appropriate place for normal cleanup to occur. So where should normal
cleanup be performed?</span></p>

<h3><a name="_Toc312373857"></a><a name="_Toc481064578"></a><a
name="_Toc375545283"><span lang=EN-US>You must perform cleanup</span></a></h3>

<p class=MsoNormal><span lang=EN-US>To clean up an object, the user of that
object must call a </span><span lang=EN-US>cleanup method at the point the
cleanup is desired. This sounds pretty straightforward, but it collides a bit
with the C++ concept of the </span><span lang=EN-US>destructor. In C++, all
objects are destroyed. Or rather, all objects <i>should be</i> destroyed. If the
C++ object is created as a local (i.e., on the stack—not possible in Java),
then the destruction happens at the closing curly brace of the scope in which
the object was created. If the object was created using <b>new</b> (like in
Java) the destructor is called when the programmer calls the C++ operator <b>delete</b>
(which doesn’t exist in Java). If the C++ programmer forgets to call <b>delete</b>,
the destructor is never called and you have a memory leak, plus the other parts
of the object never get cleaned up. This kind of bug can be very difficult to
track down.</span></p>

<p class=MsoNormal><span lang=EN-US>In contrast, Java doesn’t allow you to
create local objects—you must always use <b>new</b>. But in Java, there’s no
“delete” to call to release the object since the garbage collector releases the
storage for you. So from a simplistic standpoint you could say that because of
garbage collection, Java has no destructor. You’ll see as this book progresses,
however, that the presence of a </span><span
lang=EN-US>garbage collector does not remove the need for or utility of destructors.
(And you should never call </span><span
lang=EN-US><b>finalize(&nbsp;)</b> directly, so that’s not an appropriate
avenue for a solution.) If you want some kind of cleanup performed other than
storage release you must <i>still</i> explicitly call an appropriate method in
Java, which is the equivalent of a C++ destructor without the convenience.</span></p>

<p class=MsoNormal><span lang=EN-US>One of the things <b>finalize(&nbsp;)</b>
can be useful for is observing the process of garbage collection. The following
example shows you what’s going on and summarizes the previous descriptions of
garbage collection:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c04:Garbage.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstration of the
garbage</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// collector and
finalization</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Chair {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static boolean gcrun =
false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static boolean f =
false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int created =
0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int finalized =
0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Chair() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = ++created;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(created == 47) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Created 47&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void finalize()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(!gcrun) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // The first time
finalize() is called:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      gcrun = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Beginning
to finalize after &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        created + &quot;
Chairs have been created&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(i == 47) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Finalizing
Chair #47, &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Setting
flag to stop Chair creation&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      f = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    finalized++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(finalized &gt;=
created)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;All &quot;
+ finalized + &quot; finalized&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Garbage {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // As long as the
flag hasn't been set,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // make Chairs and
Strings:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(!Chair.f) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Chair();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
String(&quot;To take up space&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;After all
Chairs have been created:\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;total
created = &quot; + Chair.created +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;, total
finalized = &quot; + Chair.finalized);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Optional arguments
force garbage</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // collection &amp;
finalization:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &gt;
0) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(args[0].equals(&quot;gc&quot;) || </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        
args[0].equals(&quot;all&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(&quot;gc():&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        System.gc();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(args[0].equals(&quot;finalize&quot;) || </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         args[0].equals(&quot;all&quot;))
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(&quot;runFinalization():&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.runFinalization();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;bye!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The above program creates many <b>Chair</b>
objects, and at some point after the garbage collector begins running, the
program stops creating <b>Chair</b>s. Since the garbage collector can run at
any time, you don’t know exactly when it will start up, so there’s a flag
called <b>gcrun</b> to indicate whether the garbage collector has started
running yet. A second flag <b>f</b> is a way for <b>Chair</b> to tell the <b>main(&nbsp;)</b>
loop that it should stop making objects. Both of these flags are set within <b>finalize(&nbsp;)</b>,
which is called during garbage collection.</span></p>

<p class=MsoNormal><span lang=EN-US>Two other <b>static</b> variables, <b>created</b>
and <b>finalized</b>, keep track of the number of <b>Chair</b>s created versus
the number that get finalized by the garbage collector. Finally, each <b>Chair</b>
has its own (non-<b>static</b>) <b>int</b> <b>i</b> so it can keep track of
what number it is. When <b>Chair</b> number 47 is finalized, the flag is set to
<b>true</b> to bring the process of <b>Chair </b>creation to a stop.</span></p>

<p class=MsoNormal><span lang=EN-US>All this happens in <b>main(&nbsp;)</b>, in
the loop</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(!Chair.f) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Chair();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
String(&quot;To take up space&quot;);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>    }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You might wonder how this loop could ever
finish, since there’s nothing inside the loop that changes the value of <b>Chair.f</b>.
However, the <b>finalize(&nbsp;)</b> process will, eventually, when it
finalizes number 47.</span></p>

<p class=MsoNormal><span lang=EN-US>The creation of a <b>String</b> object
during each iteration is simply extra storage being allocated to encourage the
garbage collector to kick in, which it will do when it starts to get nervous
about the amount of memory available.</span></p>

<p class=MsoNormal><span lang=EN-US>When you run the program, you provide a
command-line argument of “gc,” “finalize,” or “all.” The “gc” argument will
call the <b>System.gc(&nbsp;)</b></span><span
lang=EN-US> method (to force execution of the garbage collector). Using the
“finalize” argument calls <b>System.runFinalization(&nbsp;)</b></span><span lang=EN-US> which—in theory—will cause any unfinalized objects to be finalized.
And “all” causes both methods to be called.</span></p>

<p class=MsoNormal><span lang=EN-US>The behavior of this program and the
version in the first edition of this book shows that the whole issue of garbage
collection and finalization has been evolving, with much of the evolution
happening behind closed doors. In fact, by the time you read this, the behavior
of the program may have changed once again.</span></p>

<p class=MsoNormal><span lang=EN-US>If <b>System.gc(&nbsp;)</b> is called, then
finalization happens to all the objects. This was not necessarily the case with
previous implementations of the JDK, although the documentation claimed
otherwise. In addition, you’ll see that it doesn’t seem to make any difference
whether <b>System.runFinalization(&nbsp;)</b> is called.</span></p>

<p class=MsoNormal><span lang=EN-US>However, you will see that only if <b>System.gc(&nbsp;)</b>
is called after all the objects are created and discarded will all the
finalizers be called. If you do not call <b>System.gc(&nbsp;)</b>, then only
some of the objects will be finalized. In Java 1.1, a method <b>System.runFinalizersOnExit(&nbsp;)</b>
was introduced that caused programs to run all the finalizers as they exited,
but the design turned out to be buggy and the method was deprecated. This is
yet another clue that the Java designers were thrashing about trying to solve
the garbage collection and finalization problem. We can only hope that things
have been worked out in Java 2.</span></p>

<p class=MsoNormal><span lang=EN-US>The preceding program shows that the
promise that finalizers will always be run holds true, but only if you
explicitly force it to happen yourself. If you don’t cause <b>System.gc(&nbsp;)
</b>to be called, you’ll get an output like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Created 47</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Beginning to finalize
after 3486 Chairs have been created</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Finalizing Chair #47,
Setting flag to stop Chair creation</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>After all Chairs have
been created:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>total created = 3881,
total finalized = 2684</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>bye!</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Thus, not all finalizers get called by the
time the program completes. If <b>System.gc(&nbsp;)</b> is called, it will
finalize and destroy all the objects that are no longer in use up to that
point. </span></p>

<p class=MsoNormal><span lang=EN-US>Remember that neither garbage collection
nor finalization is guaranteed. If the Java Virtual Machine (JVM) isn’t close
to running out of memory, then it will (wisely) not waste time recovering
memory through garbage collection.</span></p>

<h3><a name="_Toc481064579"><span lang=EN-US>The death condition</span></a></h3>

<p class=MsoNormal><span
lang=EN-US> </span><span
lang=EN-US>In general, you can’t rely on <b>finalize(&nbsp;) </b>being called,
and you must create separate “cleanup” functions and call them explicitly. So
it appears that <b>finalize(&nbsp;)</b> is only useful for obscure memory
cleanup that most programmers will never use. However, there is a very
interesting use of <b>finalize(&nbsp;)</b> which does not rely on it being
called every time. This is the verification of the <i>death condition</i></span><a
href="#_ftn29" name="_ftnref29" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[29]</span></span></span></span></a><span
lang=EN-US> of an object.</span></p>

<p class=MsoNormal><span lang=EN-US>At the point that you’re no longer
interested in an object—when it’s ready to be cleaned up—that object should be
in a state whereby its memory can be safely released. For example, if the
object represents an open file, that file should be closed by the programmer
before the object is garbage-collected. If any portions of the object are not
properly cleaned up, then you have a bug in your program that could be very
difficult to find. The value of <b>finalize(&nbsp;)</b> is that it can be used
to discover this condition, even if it isn’t always called. If one of the
finalizations happens to reveal the bug, then you discover the problem, which
is all you really care about.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s a simple example of how you might
use it:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c04:DeathCondition.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using finalize() to
detect an object that </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// hasn't been properly
cleaned up.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Book {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean checkedOut =
false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Book(boolean checkOut)
{ </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    checkedOut =
checkOut; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void checkIn() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    checkedOut = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void finalize()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(checkedOut)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Error: checked out&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
DeathCondition {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Book novel = new
Book(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Proper cleanup:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    novel.checkIn();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Drop the
reference, forget to clean up:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new Book(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Force garbage
collection &amp; finalization:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.gc();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The death condition is that all <b>Book</b>
objects are supposed to be checked in before they are garbage-collected, but in
<b>main(&nbsp;)</b> a programmer error doesn’t check in one of the books.
Without <b>finalize(&nbsp;)</b> to verify the death condition, this could be a
difficult bug to find.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that <b>System.gc(&nbsp;)</b> is used
to force finalization (and you should do this during program development to
speed debugging). But even if it isn’t, it’s highly probable that the errant <b>Book</b>
will eventually be discovered through repeated executions of the program
(assuming the program allocates enough storage to cause the garbage collector
to execute).</span></p>

<h3><a name="_Toc481064580"><span lang=EN-US>How a garbage collector works</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>If you come from a programming language where allocating objects on
the heap is expensive, you may naturally assume that Java’s scheme of
allocating everything (except primitives) on the heap is expensive. However, it
turns out that the garbage collector can have a significant impact on <i>increasing</i>
the speed of object creation. This might sound a bit odd at first—that storage
release affects storage allocation—but it’s the way some JVMs work and it means
that allocating storage for heap objects in Java can be nearly as fast as
creating storage on the stack in other languages.</span></p>

<p class=MsoNormal><span lang=EN-US>For example, you can think of the C++ heap
as a yard where each object stakes out its own piece of turf. This real estate
can become abandoned sometime later and must be reused. In some JVMs, the Java
heap is quite different; it’s more like a conveyor belt that moves forward
every time you allocate a new object. This means that object storage allocation
is remarkably rapid. The “heap pointer” is simply moved forward into virgin
territory, so it’s effectively the same as C++’s stack allocation. (Of course,
there’s a little extra overhead for bookkeeping but it’s nothing like searching
for storage.)</span></p>

<p class=MsoNormal><span lang=EN-US>Now you might observe that the heap isn’t
in fact a conveyor belt, and if you treat it that way you’ll eventually start
paging memory a lot (which is a big performance hit) and later run out. The
trick is that the garbage collector steps in and while it collects the garbage
it compacts all the objects in the heap so that you’ve effectively moved the
“heap pointer” closer to the beginning of the conveyor belt and further away
from a page fault. The garbage collector rearranges things and makes it
possible for the high-speed, infinite-free-heap model to be used while
allocating storage.</span></p>

<p class=MsoNormal><span lang=EN-US>To understand how this works, you need to
get a little better idea of the way the different garbage collector (GC)
schemes work. A simple but slow GC technique is reference counting. This means that
each object contains a reference counter, and every time a reference is
attached to an object the reference count is increased. Every time a reference
goes out of scope or is set to <b>null</b>, the reference count is decreased.
Thus, managing reference counts is a small but constant overhead that happens
throughout the lifetime of your program. The garbage collector moves through
the entire list of objects and when it finds one with a reference count of zero
it releases that storage. The one drawback is that if objects circularly refer
to each other they can have nonzero reference counts while still being garbage.
Locating such self-referential groups requires significant extra work for the
garbage collector. Reference counting is commonly used to explain one kind of
garbage collection but it doesn’t seem to be used in any JVM implementations.</span></p>

<p class=MsoNormal><span lang=EN-US>In faster schemes, garbage collection is
not based on reference counting. Instead, it is based on the idea that any
nondead object must ultimately be traceable back to a reference that lives
either on the stack or in static storage. The chain might go through several
layers of objects. Thus, if you start in the stack and the static storage area
and walk through all the references you’ll find all the live objects. For each
reference that you find, you must trace into the object that it points to and
then follow all the references in <i>that</i> object, tracing into the objects
they point to, etc., until you’ve moved through the entire web that originated
with the reference on the stack or in static storage. Each object that you move
through must still be alive. Note that there is no problem with detached
self-referential groups—these are simply not found, and are therefore
automatically garbage.</span></p>

<p class=MsoNormal><span lang=EN-US>In the approach described here, the JVM
uses an <i>adaptive </i>garbage-collection scheme, and what it does with the
live objects that it locates depends on the variant currently being used. One
of these variants is <i>stop-and-copy</i>. This means that—for reasons that
will become apparent—the program is first stopped (this is not a background
collection scheme). Then, each live object that is found is copied from one
heap to another, leaving behind all the garbage. In addition, as the objects
are copied into the new heap they are packed end-to-end, thus compacting the
new heap (and allowing new storage to simply be reeled off the end as
previously described).</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, when an object is moved from one
place to another, all references that point at (i.e., that <i>reference</i>)
the object must be changed. The reference that goes from the heap or the static
storage area to the object can be changed right away, but there can be other
references pointing to this object that will be encountered later during the
“walk.” These are fixed up as they are found (you could imagine a table that
maps old addresses to new ones).</span></p>

<p class=MsoNormal><span lang=EN-US>There are two issues that make these
so-called “copy collectors” inefficient. The first is the idea that you have
two heaps and you slosh all the memory back and forth between these two
separate heaps, maintaining twice as much memory as you actually need. Some
JVMs deal with this by allocating the heap in chunks as needed and simply
copying from one chunk to another.</span></p>

<p class=MsoNormal><span lang=EN-US>The second issue is the copying. Once your
program becomes stable it might be generating little or no garbage. Despite
that, a copy collector will still copy all the memory from one place to
another, which is wasteful. To prevent this, some JVMs detect that no new
garbage is being generated and switch to a different scheme (this is the “adaptive”
part). This other scheme is called <i>mark and sweep</i>, and it’s what earlier
versions of Sun’s JVM used all the time. For general use, mark and sweep is
fairly slow, but when you know you’re generating little or no garbage it’s
fast.</span></p>

<p class=MsoNormal><span lang=EN-US>Mark and sweep follows the same logic of
starting from the stack and static storage and tracing through all the
references to find live objects. However, each time it finds a live object that
object is marked by setting a flag in it, but the object isn’t collected yet.
Only when the marking process is finished does the sweep occur. During the
sweep, the dead objects are released. However, no copying happens, so if the
collector chooses to compact a fragmented heap it does so by shuffling objects
around.</span></p>

<p class=MsoNormal><span lang=EN-US>The “stop-and-copy” refers to the idea that
this type of garbage collection is <i>not</i> done in the background; instead,
the program is stopped while the GC occurs. In the Sun literature you’ll find
many references to garbage collection as a low-priority background process, but
it turns out that the GC was not implemented that way, at least in earlier
versions of the Sun JVM. Instead, the Sun garbage collector ran when memory got
low. In addition, mark-and-sweep requires that the program be stopped.</span></p>

<p class=MsoNormal><span lang=EN-US>As previously mentioned, in the JVM
described here memory is allocated in big blocks. If you allocate a large
object, it gets its own block. Strict stop-and-copy requires copying every live
object from the source heap to a new heap before you could free the old one,
which translates to lots of memory. With blocks, the GC can typically use dead
blocks to copy objects to as it collects. Each block has a <i>generation count</i>
to keep track of whether it’s alive. In the normal case, only the blocks
created since the last GC are compacted; all other blocks get their generation
count bumped if they have been referenced from somewhere. This handles the
normal case of lots of short-lived temporary objects. Periodically, a full
sweep is made—large objects are still not copied (just get their generation count
bumped) and blocks containing small objects are copied and compacted. The JVM
monitors the efficiency of GC and if it becomes a waste of time because all
objects are long-lived then it switches to mark-and-sweep. Similarly, the JVM
keeps track of how successful mark-and-sweep is, and if the heap starts to
become fragmented it switches back to stop-and-copy. This is where the
“adaptive” part comes in, so you end up with a mouthful: “adaptive generational
stop-and-copy mark-and-sweep.”</span></p>

<p class=MsoNormal><span lang=EN-US>There are a number of additional speedups
possible in a JVM. An especially important one involves the operation of the
loader and Just-In-Time (JIT) compiler. When a class must be loaded (typically,
the first time you want to create an object of that class), the <b>.class</b>
file is located and the byte codes for that class are brought into memory. At
this point, one approach is to simply JIT all the code, but this has two
drawbacks: it takes a little more time, which, compounded throughout the life
of the program, can add up; and it increases the size of the executable (byte
codes are significantly more compact than expanded JIT code) and this might
cause paging, which definitely slows down a program. An alternative approach is
<i>lazy evaluation,</i> which means that the code is not JIT compiled until
necessary. Thus, code that never gets executed might never get JIT compiled.</span></p>

<h2><a name="_Toc481064581"></a><a name="_Toc375545284"><span lang=EN-US>Member
initialization</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Java goes out of its way to guarantee that
variables are properly initialized before they are used. In the case of
variables that are defined locally to a method, this guarantee comes in the
form of a compile-time error. So if you say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i++;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>you’ll get an error message that says that <b>i</b>
might not have been initialized. Of course, the compiler could have given <b>i</b>
a default value, but it’s more likely that this is a programmer error and a
default value would have covered that up. Forcing the programmer to provide an
initialization value is more likely to catch a bug</span><span lang=EN-US>.</span></p>

<p class=MsoNormal><span lang=EN-US>If a </span><span lang=EN-US>primitive is a data member of a class, however, things are a bit
different. Since any method can initialize or use that data, it might not be
practical to force the user to initialize it to its appropriate value before
the data is used. However, it’s unsafe to leave it with a garbage value, so
each primitive data member of a class is guaranteed to get an initial value.
Those values can be seen here:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c04:InitialValues.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Shows default initial
values.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Measurement {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean t;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  char c;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  byte b;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  short s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  long l;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float f;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  double d;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void print() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Data
type      Initial value\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;boolean        &quot; + t + &quot;\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;char           [&quot; + c + &quot;] &quot;+ (int)c +&quot;\n&quot;+</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;byte           &quot; + b + &quot;\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;short          &quot; + s + &quot;\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;int            &quot; + i + &quot;\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;long           &quot; + l + &quot;\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;float          &quot; + f + &quot;\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;double         &quot; + d);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
InitialValues {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Measurement d = new
Measurement();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    d.print();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    /* In this case you
could also say:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Measurement().print();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    */</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output of this program is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Data type      Initial
value</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>boolean        false</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>char           [ ] 0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>byte           0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>short          0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>int            0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>long           0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>float          0.0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>double         0.0</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>char</b> value is a zero, which
prints as a space.</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll see later that when you define an
object reference inside a class without initializing it to a new object, that
reference is given a special value of <b>null</b> (which is a Java keyword).</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that even though the values are
not specified, they automatically get initialized. So at least there’s no
threat of working with uninitialized variables.</span></p>

<h3><a name="_Toc481064582"></a><a name="_Toc375545285"><span lang=EN-US>Specifying
initialization</span></a></h3>

<p class=MsoNormal><span lang=EN-US>What happens if you want to give a variable
an initial value? One direct way to do this is simply to assign the value at
the point you define the variable in the class. (Notice you cannot do this in
C++, although C++ novices always try.) Here the field definitions in class <b>Measurement</b>
are changed to provide initial values: </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Measurement {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean b = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  char c = 'x';</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  byte B = 47;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  short s = 0xff;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = 999;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  long l = 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float f = 3.14f;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  double d = 3.14159;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  //. . .</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can also initialize nonprimitive
objects in this same way. If <b>Depth</b> is a class, you can insert a variable
and initialize it like so:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Measurement {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Depth o = new Depth();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean b = true;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  // . . .</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you haven’t given <b>o</b> an initial
value and you try to use it anyway, you’ll get a run-time error called an <i>exception</i>
(covered in Chapter 10).</span></p>

<p class=MsoNormal><span lang=EN-US>You can even call a method to provide an
initialization value:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class CInit {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  //...</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This method can have arguments, of course,
but those arguments cannot be other class members that haven’t been initialized
yet. Thus, you can do this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class CInit {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int j = g(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  //...</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>But you cannot do this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class CInit {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int j = g(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  //...</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This is one place in which the compiler,
appropriately, <i>does</i> complain about </span><span lang=EN-US>forward referencing, since this has to do with the order of
initialization and not the way the program is compiled.</span></p>

<p class=MsoNormal><span lang=EN-US>This approach to initialization is simple
and straightforward. It has the limitation that <i>every</i> object of type <b>Measurement</b>
will get these same initialization values. Sometimes this is exactly what you
need, but at other times you need more flexibility.</span></p>

<h3><a name="_Toc481064583"></a><a name="_Toc375545286"><span lang=EN-US>Constructor
initialization</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The constructor can be used to perform
initialization, and this gives you greater flexibility in your programming
since you can call methods and perform actions at run-time to determine the
initial values. There’s one thing to keep in mind, however: you aren’t
precluding the automatic initialization, which happens before the constructor
is entered. So, for example, if you say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Counter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Counter() { i = 7; }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  // . . .</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>then <b>i </b>will first be initialized to
0, then to 7. This is true with all the primitive types and with object
references, including those that are given explicit initialization at the point
of definition. For this reason, the compiler doesn’t try to force you to
initialize elements in the constructor at any particular place, or before they
are used—initialization is already guaranteed</span><a href="#_ftn30"
name="_ftnref30" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[30]</span></span></span></span></a><span
lang=EN-US>.</span></p>

<h4><span lang=EN-US>Order of initialization</span></h4>

<p class=MsoNormal><span lang=EN-US>Within a class, the order of initialization is determined by the
order that the variables are defined within the class. The variable definitions
may be scattered throughout and in between method definitions, but the
variables are initialized before any methods can be called—even the
constructor. For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c04:OrderOfInitialization.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates
initialization order.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// When the constructor
is called to create a</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Tag object, you'll
see a message:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Tag {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Tag(int marker) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Tag(&quot; + marker + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Card {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Tag t1 = new Tag(1);
// Before constructor</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Card() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Indicate we're in
the constructor:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Card()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t3 = new Tag(33); //
Reinitialize t3</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Tag t2 = new Tag(2);
// After constructor</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Tag t3 = new Tag(3);
// At end</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
OrderOfInitialization {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void main(String[]
args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Card t = new Card();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t.f(); // Shows that
construction is done</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>Card</b>, the definitions of the <b>Tag</b>
objects are intentionally scattered about to prove that they’ll all get
initialized before the constructor is entered or anything else can happen. In
addition, <b>t3</b> is reinitialized inside the constructor. The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Tag(1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Tag(2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Tag(3)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Card()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Tag(33)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>f()</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Thus, the <b>t3</b> reference gets
initialized twice, once before and once during the constructor call. (The first
object is dropped, so it can be garbage-collected later.) This might not seem
efficient at first, but it guarantees proper initialization—what would happen
if an overloaded constructor were defined that did <i>not</i> initialize <b>t3</b>
and there wasn’t a “default” initialization for <b>t3</b> in its definition?</span></p>

<h4><span lang=EN-US>Static data initialization</span></h4>

<p class=MsoNormal><span lang=EN-US>When the </span><span lang=EN-US>data is <b>static</b> the same thing happens; if it’s a primitive and
you don’t initialize it, it gets the standard primitive initial values. If it’s
a reference to an object, it’s <b>null</b> unless you create a new object and
attach your reference to it.</span></p>

<p class=MsoNormal><span lang=EN-US>If you want to place initialization at the
point of definition, it looks the same as for non-<b>static</b>s. There’s only
a single piece of storage for a <b>static</b>, regardless of how many objects
are created. But the question arises of when the <b>static</b> storage gets
initialized. An example makes this question clear:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c04:StaticInitialization.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Specifying initial
values in a</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// class definition.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Bowl {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Bowl(int marker) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Bowl(&quot; + marker + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f(int marker) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;f(&quot; + marker + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Table {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Bowl b1 = new
Bowl(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Table() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Table()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b2.f(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f2(int marker) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;f2(&quot; + marker + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Bowl b2 = new
Bowl(2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Cupboard {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Bowl b3 = new Bowl(3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Bowl b4 = new
Bowl(4);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Cupboard() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Cupboard()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b4.f(2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f3(int marker) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;f3(&quot; + marker + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Bowl b5 = new
Bowl(5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
StaticInitialization {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Creating new
Cupboard() in main&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new Cupboard();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Creating new
Cupboard() in main&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new Cupboard();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t2.f2(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t3.f3(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Table t2 = new
Table();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Cupboard t3 =
new Cupboard();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>Bowl</span></b><span lang=EN-US> allows
you to view the creation of a class, and <b>Table</b> and <b>Cupboard</b>
create <b>static</b> members of <b>Bowl</b> scattered through their class
definitions. Note that <b>Cupboard</b> creates a non-<b>static</b> <b>Bowl b3</b>
prior to the <b>static</b> definitions. The output shows what happens:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Bowl(1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Bowl(2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Table()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>f(1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Bowl(4)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Bowl(5)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Bowl(3)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Cupboard()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>f(2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Creating new Cupboard()
in main</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Bowl(3)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Cupboard()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>f(2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Creating new Cupboard()
in main</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Bowl(3)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Cupboard()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>f(2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>f2(1)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>f3(1)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>static</b> initialization occurs
only if it’s necessary. If you don’t create a <b>Table </b>object and you never
refer to <b>Table.b1 </b>or <b>Table.b2</b>, the <b>static Bowl b1 </b>and <b>b2
</b>will never be created. However, they are initialized only when the <i>first
</i><b>Table </b>object is created (or the first <b>static</b> access occurs).
After that, the <b>static</b> objects are not reinitialized.</span></p>

<p class=MsoNormal><span lang=EN-US>The order of initialization is <b>static</b>s
first, if they haven’t already been initialized by a previous object creation,
and then the non-<b>static</b> objects. You can see the evidence of this in the
output.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s helpful to summarize the </span><span lang=EN-US>process of creating an object. Consider a class called <b>Dog</b>:</span></p>

<p class=Numbered><span lang=EN-US>The first time an object of type <b>Dog</b>
is created, <i>or</i> the first time a <b>static</b> method or <b>static </b>field
of class <b>Dog</b> is accessed, the Java interpreter must locate <b>Dog.class</b>,
which it does by searching through the classpath.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>26.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>As <b>Dog.class</b> is loaded (creating a <b>Class</b> object, which
you’ll learn about later), all of its <b>static</b> initializers are run. Thus,
<b>static </b>initialization takes place only once, as the <b>Class</b> object
is loaded for the first time.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>27.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>When you create a <b>new Dog(&nbsp;)</b>, the construction process
for a <b>Dog</b> object first allocates enough storage for a <b>Dog</b> object
on the heap.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>28.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>This storage is wiped to zero, automatically setting all the
primitives in that <b>Dog</b> object to their default values (zero for numbers
and the equivalent for <b>boolean</b> and <b>char</b>) and the references to <b>null</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>29.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Any initializations that occur at the point of field definition are
executed.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>30.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Constructors are executed. As you shall see in Chapter 6, this might
actually involve a fair amount of activity, especially when inheritance is
involved.</span></p>

<h4><span lang=EN-US>Explicit static initialization</span></h4>

<p class=MsoNormal><span lang=EN-US>Java allows you to group other <b>static</b>
initializations inside a special “</span><span lang=EN-US><b>static</b> construction clause” (sometimes called a </span><span lang=EN-US><i>static block</i>)<i> </i>in a class. It looks like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Spoon {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = 47;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  // . . .</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It appears to be a method, but it’s just
the <b>static</b> keyword followed by a method body. This code, like other <b>static</b>
initializations, is executed only once, the first time you make an object of
that class <i>or</i> the first time you access a <b>static</b> member of that
class (even if you never make an object of that class). For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c04:ExplicitStatic.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Explicit static
initialization</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// with the
&quot;static&quot; clause.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Cup {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Cup(int marker) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Cup(&quot; + marker + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f(int marker) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;f(&quot; + marker + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Cups {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Cup c1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Cup c2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c1 = new Cup(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c2 = new Cup(2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Cups() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Cups()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ExplicitStatic {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Inside
main()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Cups.c1.f(99);  //
(1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // static Cups x = new
Cups();  // (2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // static Cups y = new
Cups();  // (2) </span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>static</b> initializers for <b>Cups</b>
run when either the access of the <b>static</b> object <b>c1</b> occurs on the
line marked (1), or if line (1) is commented out and the lines marked (2) are
uncommented. If both (1) and (2) are commented out, the <b>static</b>
initialization for <b>Cups</b> never occurs. Also, it doesn’t matter if one or
both of the lines marked (2) are uncommented; the static initialization only
occurs once.</span></p>

<h4><span lang=EN-US>Non-static instance initialization</span></h4>

<p class=MsoNormal><span lang=EN-US>Java provides a similar syntax for initializing non-<b>static</b>
variables for each object. Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c04:Mugs.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Java &quot;Instance
Initialization.&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Mug {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Mug(int marker) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Mug(&quot; + marker + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f(int marker) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;f(&quot;
+ marker + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Mugs {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Mug c1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Mug c2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c1 = new Mug(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c2 = new Mug(2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;c1 &amp; c2 initialized&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Mugs() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Mugs()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Inside main()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Mugs x = new Mugs();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the instance
initialization clause:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c1 = new Mug(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c2 = new Mug(2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;c1 &amp; c2 initialized&quot;);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>looks exactly like the static
initialization clause except for the missing <b>static</b> keyword. This syntax
is necessary to support the initialization of <i>anonymous inner classes</i>
(see Chapter 8).</span></p>

<h2><a name="_Toc312373861"></a><a name="_Toc481064584"></a><a
name="_Toc375545287"><span lang=EN-US>Array initialization</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Initializing arrays in C is error-prone and
tedious. C++ uses <i>aggregate initialization</i> to make it much safer</span><a
href="#_ftn31" name="_ftnref31" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[31]</span></span></span></span></a><span
lang=EN-US>. Java has no “aggregates” like C++, since everything is an object
in Java. It does have arrays, and these are supported with </span><span lang=EN-US>array initialization.</span></p>

<p class=MsoNormal><span lang=EN-US>An array is simply a sequence of either
objects or primitives, all the same type and packaged together under one
identifier name. Arrays are defined and used with the square-brackets </span><span lang=EN-US><i>indexing operator</i> <b>[&nbsp;]</b>. To define an array you
simply follow your type name with empty square brackets:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>int[] a1;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can also put the square brackets after
the identifier to produce exactly the same meaning:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>int a1[];</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This conforms to expectations from C and
C++ programmers. The former style, however, is probably a more sensible syntax,
since it says that the type is “an <b>int</b> array.” That style will be used
in this book.</span></p>

<p class=MsoNormal><span lang=EN-US>The compiler doesn’t allow you to tell it
how big the array is. This brings us back to that issue of “references.” All
that you have at this point is a reference to an array, and there’s been no
space allocated for the array. To create storage for the array you must write
an initialization expression. For arrays, initialization can appear anywhere in
your code, but you can also use a special kind of initialization expression
that must occur at the point where the array is created. This special initialization
is a set of values surrounded by curly braces. The storage allocation (the
equivalent of using <b>new</b>) is taken care of by the compiler in this case.
For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>int[] a1 = { 1, 2,
3, 4, 5 };</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>So why would you ever define an array
reference without an array?</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>int[] a2;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Well, it’s possible to assign one array to
another in Java, so you can say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>a2 = a1;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>What you’re really doing is copying a
reference, as demonstrated here:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c04:Arrays.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Arrays of primitives.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Arrays {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] a1 = { 1, 2,
3, 4, 5 };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] a2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a2 = a1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a2.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a2[i]++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a1.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;a1[&quot;
+ i + &quot;] = &quot; + a1[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that <b>a1</b> is given an
initialization value while <b>a2</b> is not; <b>a2</b> is assigned later—in
this case, to another array. </span></p>

<p class=MsoNormal><span lang=EN-US>There’s something new here: all arrays have
an intrinsic member (whether they’re arrays of objects or arrays of primitives)
that you can query—but not change—to tell you how many elements there are in
the array. This member is <b>length</b></span><span lang=EN-US>. Since arrays in Java, like C and C++, start counting from element
zero, the largest element you can index is <b>length - 1</b>. If you go out of </span><span lang=EN-US>bounds, C and C++ quietly accept this and allow you to stomp all over
your memory, which is the source of many infamous bugs. However, Java protects
you against such problems by causing a run-time error (an <i>exception</i>, the
subject of Chapter 10) if you step out of bounds. Of course, checking every
array access costs time and code and there’s no way to turn it off, which means
that array accesses might be a source of inefficiency in your program if they
occur at a critical juncture. For Internet security and programmer
productivity, the Java designers thought that this was a worthwhile trade-off.</span></p>

<p class=MsoNormal><span lang=EN-US>What if you don’t know how many elements
you’re going to need in your array while you’re writing the program? You simply
use <b>new</b> to create the elements in the array. Here, </span><span lang=EN-US><b>new</b> works even though it’s creating an array of primitives (<b>new</b>
won’t create a nonarray primitive):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c04:ArrayNew.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creating arrays with
new.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ArrayNew {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Random rand =
new Random();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int pRand(int
mod) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
Math.abs(rand.nextInt()) % mod + 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] a;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a = new
int[pRand(20)];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;length of a
= &quot; + a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;a[&quot; +
i + &quot;] = &quot; + a[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Since the size of the array is chosen at random
(using the <b>pRand(&nbsp;)</b> method), it’s clear that array creation is
actually happening at run-time. In addition, you’ll see from the output of this
program that array elements of primitive types are automatically initialized to
“empty” values. (For numerics and <b>char</b>, this is zero, and for <b>boolean</b>,
it’s <b>false</b>.)</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, the array could also have been
defined and initialized in the same statement:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>int[] a = new
int[pRand(20)];</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you’re dealing with an array of
nonprimitive objects, you must always use <b>new</b>. Here, the reference issue
comes up again because what you create is an array of references. Consider the
wrapper type <b>Integer</b></span><span
lang=EN-US><b>,</b> which is a class and not a primitive:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c04:ArrayClassObj.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creating an array of
nonprimitive objects.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ArrayClassObj {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Random rand =
new Random();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int pRand(int
mod) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
Math.abs(rand.nextInt()) % mod + 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer[] a = new
Integer[pRand(20)];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;length of a
= &quot; + a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a[i] = new
Integer(pRand(500));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;a[&quot; +
i + &quot;] = &quot; + a[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Here, even after <b>new</b> is called to
create the array:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Integer[] a = new
Integer[pRand(20)];</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>it’s only an array of references, and not
until the reference itself is initialized by creating a new <b>Integer</b>
object is the initialization complete:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>a[i] = new
Integer(pRand(500));</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you forget to create the object,
however, you’ll get an exception at run-time when you try to read the empty
array location.</span></p>

<p class=MsoNormal><span lang=EN-US>Take a look at the formation of the <b>String
</b>object inside the print statements. You can see that the reference to the <b>Integer</b>
object is automatically converted to produce a <b>String </b>representing the
value inside the object.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s also possible to initialize arrays of
objects using the curly-brace-enclosed list. There are two forms:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c04:ArrayInit.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Array initialization.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ArrayInit {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer[] a = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(1),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(2),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(3),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer[] b = new
Integer[] {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(1),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(2),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(3),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This is useful at times, but it’s more
limited since the size of the array is determined at compile-time. The final
comma in the list of initializers is optional. (This feature makes for easier
maintenance of long lists.)</span></p>

<p class=MsoNormal><span lang=EN-US>The second form of array initialization
provides a convenient syntax to create and call methods that can produce the
same effect as C’s </span><span
lang=EN-US><i>variable argument lists</i> (known as “varargs” in C). These can
include unknown quantity of arguments as well as unknown types. Since all
classes are ultimately inherited from the common root class <b>Object</b> (a
subject you will learn more about as this book progresses), you can create a
method that takes an array of <b>Object</b> and call it like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c04:VarArgs.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using the array
syntax to create</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// variable argument
lists.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class A { int i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class VarArgs {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void f(Object[]
x) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; x.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(x[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(new Object[] { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new Integer(47),
new VarArgs(), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new Float(3.14),
new Double(11.11) });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(new Object[]
{&quot;one&quot;, &quot;two&quot;, &quot;three&quot; });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(new Object[] {new
A(), new A(), new A()});</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>At this point, there’s not much you can do
with these unknown objects, and this program uses the automatic <b>String</b>
conversion to do something useful with each <b>Object</b>. In Chapter 12, which
covers <i>run-time type identification</i> (RTTI), you’ll learn how to discover
the exact type of such objects so that you can do something more interesting
with them.</span></p>

<h3><a name="_Toc481064585"><span lang=EN-US>Multidimensional arrays</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Java allows you to easily create </span><span lang=EN-US>multidimensional arrays:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c04:MultiDimArray.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creating
multidimensional arrays.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
MultiDimArray {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Random rand =
new Random();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int pRand(int
mod) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
Math.abs(rand.nextInt()) % mod + 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void prt(String
s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[][] a1 = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      { 1, 2, 3, },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      { 4, 5, 6, },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a1.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int j = 0; j
&lt; a1[i].length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
prt(&quot;a1[&quot; + i + &quot;][&quot; + j +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            &quot;] =
&quot; + a1[i][j]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // 3-D array with
fixed length:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[][][] a2 = new
int[2][2][4];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a2.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int j = 0; j
&lt; a2[i].length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int k = 0; k
&lt; a2[i][j].length;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            k++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
prt(&quot;a2[&quot; + i + &quot;][&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              j +
&quot;][&quot; + k +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              &quot;] =
&quot; + a2[i][j][k]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // 3-D array with
varied-length vectors:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[][][] a3 = new
int[pRand(7)][][];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a3.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a3[i] = new
int[pRand(5)][];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int j = 0; j
&lt; a3[i].length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        a3[i][j] = new
int[pRand(5)];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a3.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int j = 0; j
&lt; a3[i].length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int k = 0; k
&lt; a3[i][j].length;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            k++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
prt(&quot;a3[&quot; + i + &quot;][&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              j +
&quot;][&quot; + k +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              &quot;] =
&quot; + a3[i][j][k]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Array of
nonprimitive objects:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer[][] a4 = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      { new Integer(1),
new Integer(2)},</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      { new Integer(3),
new Integer(4)},</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      { new Integer(5),
new Integer(6)},</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a4.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int j = 0; j
&lt; a4[i].length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
prt(&quot;a4[&quot; + i + &quot;][&quot; + j +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            &quot;] =
&quot; + a4[i][j]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer[][] a5;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a5 = new
Integer[3][];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a5.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a5[i] = new
Integer[3];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int j = 0; j
&lt; a5[i].length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        a5[i][j] = new
Integer(i*j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a5.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int j = 0; j
&lt; a5[i].length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
prt(&quot;a5[&quot; + i + &quot;][&quot; + j +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            &quot;] =
&quot; + a5[i][j]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The code used for printing uses <b>length</b>
so that it doesn’t depend on fixed array sizes.</span></p>

<p class=MsoNormal><span lang=EN-US>The first example shows a multidimensional
array of primitives. You delimit each vector in the array with curly braces:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[][] a1 = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      { 1, 2, 3, },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      { 4, 5, 6, },</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>    };</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Each set of square brackets moves you into
the next level of the array.</span></p>

<p class=MsoNormal><span lang=EN-US>The second example shows a
three-dimensional array allocated with <b>new</b>. Here, the whole array is
allocated at once:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>int[][][] a2 = new
int[2][2][4];</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>But the third example shows that each
vector in the arrays that make up the matrix can be of any length:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[][][] a3 = new
int[pRand(7)][][];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a3.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a3[i] = new
int[pRand(5)][];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int j = 0; j
&lt; a3[i].length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        a3[i][j] = new
int[pRand(5)];</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>    }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The first <b>new</b> creates an array with
a random-length first element and the rest undetermined. The second <b>new</b>
inside the <b>for</b> loop fills out the elements but leaves the third index
undetermined until you hit the third <b>new</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>You will see from the output that array
values are automatically initialized to zero if you don’t give them an explicit
initialization value.</span></p>

<p class=MsoNormal><span lang=EN-US>You can deal with arrays of nonprimitive
objects in a similar fashion, which is shown in the fourth example,
demonstrating the ability to collect many <b>new</b> expressions with curly
braces:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer[][] a4 = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      { new Integer(1),
new Integer(2)},</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      { new Integer(3),
new Integer(4)},</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      { new Integer(5),
new Integer(6)},</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>    };</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The fifth example shows how an array of
nonprimitive objects can be built up piece by piece:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer[][] a5;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a5 = new
Integer[3][];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a5.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a5[i] = new
Integer[3];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int j = 0; j
&lt; a5[i].length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        a5[i][j] = new
Integer(i*j);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>    }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>i*j</b> is just to put an
interesting value into the <b>Integer</b>.</span></p>

<h2><a name="_Toc481064586"></a><a name="_Toc375545288"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>This seemingly elaborate mechanism for
initialization, the constructor, should give you a strong hint about the
critical importance placed on initialization in the language. As Stroustrup was
designing C++, one of the first observations he made about productivity in C
was that improper initialization of variables causes a significant portion of
programming problems. These kinds of bugs are hard to find, and similar issues
apply to improper cleanup. Because constructors allow you to <i>guarantee</i>
proper initialization and cleanup (the compiler will not allow an object to be
created without the proper constructor calls), you get complete control and
safety.</span></p>

<p class=MsoNormal><span lang=EN-US>In C++, destruction is quite important
because objects created with <b>new</b> must be explicitly destroyed. In Java,
the garbage collector automatically releases the memory for all objects, so the
equivalent cleanup method in Java isn’t necessary much of the time. In cases
where you don’t need destructor-like behavior, Java’s garbage collector greatly
simplifies programming, and adds much-needed safety in managing memory. Some
garbage collectors can even clean up other resources like graphics and file
handles. However, the garbage collector does add a run-time cost, the expense
of which is difficult to put into perspective because of the overall slowness
of Java interpreters at this writing. As this changes, we’ll be able to
discover if the overhead of the garbage collector will preclude the use of Java
for certain types of programs. (One of the issues is the unpredictability of
the garbage collector.)</span></p>

<p class=MsoNormal><span lang=EN-US>Because of the guarantee that all objects
will be constructed, there’s actually more to the constructor than what is
shown here. In particular, when you create new classes using either <i>composition</i>
or <i>inheritance</i> the guarantee of construction also holds, and some
additional syntax is necessary to support this. You’ll learn about composition,
inheritance, and how they affect constructors in future chapters.</span></p>

<h2><a name="_Toc481064587"></a><a name="_Toc375545289"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with a default constructor (one
that takes no arguments) that prints a message. Create an object of this class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>22. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add an overloaded constructor to Exercise 1 that
takes a <b>String</b> argument and prints it along with your message.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>23. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an array of object references of the
class you created in Exercise 2, but don’t actually create objects to assign
into the array. When you run the program, notice whether the initialization messages
from the constructor calls are printed.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>24. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Complete Exercise 3 by creating objects to
attach to the array of references. </span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>25. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an array of <b>String</b> objects and
assign a string to each element. Print the array using a <b>for</b> loop.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>26. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class called <b>Dog</b> with an
overloaded <b>bark(&nbsp;)</b> method. This method should be overloaded based
on various primitive data types, and print different types of barking, howling,
etc., depending on which overloaded version is called. Write a <b>main(&nbsp;)</b>
that calls all the different versions.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>27. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 6 so that two of the overloaded
methods have two arguments (of two different types), but in reversed order
relative to each other. Verify that this works.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>28. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class without a constructor, and then
create an object of that class in <b>main(&nbsp;)</b> to verify that the default
constructor is automatically synthesized.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>29. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with two methods. Within the
first method, call the second method twice: the first time without using <b>this</b>,
and the second time using <b>this</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>30. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with two (overloaded)
constructors. Using <b>this</b>, call the second constructor inside the first
one.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>31. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with a <b>finalize(&nbsp;)</b>
method that prints a message. In <b>main(&nbsp;)</b>, create an object of your
class. Explain the behavior of your program.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>32. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 11 so that your <b>finalize(&nbsp;)</b>
will always be called.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>33. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class called <b>Tank</b> that can be
filled and emptied, and has a <i>death condition</i> that it must be empty when
the object is cleaned up. Write a <b>finalize(&nbsp;)</b> that verifies this
death condition. In <b>main(&nbsp;)</b>, test the possible scenarios that can
occur when your <b>Tank</b> is used.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>34. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class containing an <b>int</b> and a <b>char</b>
that are not initialized, and print their values to verify that Java performs
default initialization.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>35. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class containing an uninitialized <b>String</b>
reference. Demonstrate that this reference is initialized by Java to <b>null</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>36. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with a <b>String </b>field that
is initialized at the point of definition, and another one that is initialized
by the constructor. What is the difference between the two approaches?</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>37. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with a <b>static String </b>field
that is initialized at the point of definition, and another one that is
initialized by the <b>static </b>block. Add a <b>static</b> method that prints
both fields and demonstrates that they are both initialized before they are
used.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>38. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with a <b>String</b> that is
initialized using “instance initialization.” Describe a use for this feature
(other than the one specified in this book).</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>39. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a method that creates and initializes a
two-dimensional array of <b>double</b>. The size of the array is determined by
the arguments of the method, and the initialization values are a range
determined by beginning and ending values that are also arguments of the
method. Create a second method that will print the array generated by the first
method. In <b>main(&nbsp;)</b> test the methods by creating and printing
several different sizes of arrays.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>40. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Repeat Exercise 19 for a three-dimensional
array.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>41. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Comment the line marked (1) in <b>ExplicitStatic.java</b>
and verify that the static initialization clause is not called. Now uncomment
one of the lines marked (2) and verify that the static initialization clause <i>is</i>
called. Now uncomment the other line marked (2) and verify that static
initialization only occurs once.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>42. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Experiment with <b>Garbage.java</b> by running
the program using the arguments “gc,” “finalize,” or “all.” Repeat the process
and see if you detect any patterns in the output. Change the code so that <b>System.runFinalization(&nbsp;)
</b>is called <i>before</i> <b>System.gc(&nbsp;)</b> and observe the results.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection11>

<h1><a name="_Toc481064588"></a><a name="_Toc477690725"></a><a
name="_Toc375545290"></a><a name="Chapter_5"></a><span lang=EN-US>5: Hiding the
Implementation</span></h1>

<p class=Intro><span lang=EN-US>A primary consideration in object-oriented
design is “separating the things that change from the things that stay the
same.”</span></p>

<p class=MsoNormal><span lang=EN-US>This is particularly important for
libraries. The user (<i>client programmer</i></span><span
lang=EN-US>) of that library must be able to rely on the part they use, and
know that they won’t need to rewrite code if a new version of the library comes
out. On the flip side, the library creator</span><span
lang=EN-US> must have the freedom to make modifications and improvements with
the certainty that the client programmer’s code won’t be affected by those
changes.</span></p>

<p class=MsoNormal><span lang=EN-US>This can be achieved through convention.
For example, the library programmer must agree to not remove existing methods
when modifying a class in the library, since that would break the client
programmer’s code. The reverse situation is thornier, however. In the case of a
data member, how can the library creator know which data members have been
accessed by client programmers? This is also true with methods that are only
part of the implementation of a class, and not meant to be used directly by the
client programmer. But what if the library creator wants to rip out an old
implementation and put in a new one? Changing any of those members might break
a client programmer’s code. Thus the library creator is in a strait jacket and
can’t change anything.</span></p>

<p class=MsoNormal><span lang=EN-US>To solve this problem, Java provides </span><span lang=EN-US><i>access specifiers</i> to allow the library creator to say what is
available to the client programmer and what is not. The levels of </span><span lang=EN-US>access control from “most access” to “least access” are </span><span lang=EN-US><b>public</b>, <b>protected</b>, “</span><span
lang=EN-US>friendly” (which has no keyword), </span><span
lang=EN-US>and<b> </b></span><span lang=EN-US><b>private</b>. From the previous
paragraph you might think that, as a </span><span lang=EN-US>library designer, you’ll want to keep everything as “private” as
possible, and expose only the methods that you want the client programmer to
use. This is exactly right, even though it’s often counterintuitive for people
who program in other languages (especially C) and are used to accessing
everything without restriction. By the end of this chapter you should be
convinced of the value of access control in Java.</span></p>

<p class=MsoNormal><span lang=EN-US>The concept of a library of components and
the control over who can access the components of that library is not complete,
however. There’s still the question of how the components are bundled together
into a cohesive library unit. This is controlled with the <b>package</b>
keyword in Java, and the access specifiers are affected by whether a class is
in the same package or in a separate package. So to begin this chapter, you’ll
learn how library components are placed into packages. Then you’ll be able to
understand the complete meaning of the access specifiers.</span></p>

<h2><a name="_Toc481064589"></a><a name="_Toc375545291"><span lang=EN-US>package</span><span
lang=EN-US>: the library unit</span></a></h2>

<p class=MsoNormal><span lang=EN-US>A </span><span
lang=EN-US>package is what you get when you use the </span><span
lang=EN-US><b>import</b> keyword to bring in an entire library, such as</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>import
java.util.*;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This brings in the entire utility </span><span lang=EN-US>library that’s part of the standard Java distribution. Since, for
example, the class <b>ArrayList</b> is in <b>java.util</b>, you can now either
specify the full name <b>java.util.ArrayList</b> (which you can do without the <b>import</b>
statement), or you can simply say <b>ArrayList</b> (because of the <b>import</b>).</span></p>

<p class=MsoNormal><span lang=EN-US>If you want to bring in a single class, you
can name that class in the <b>import</b> statement</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>import
java.util.ArrayList;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now you can use <b>ArrayList</b> with no
qualification. However, none of the other classes in <b>java.util</b> are
available.</span></p>

<p class=MsoNormal><span lang=EN-US>The reason for all this importing is to
provide a mechanism to manage “</span><span
lang=EN-US>name spaces.” The names of all your class members are insulated from
each other. A method <b>f(&nbsp;)</b> inside a class <b>A</b> will not </span><span lang=EN-US>clash with an <b>f(&nbsp;)</b> that has the same signature (argument
list) in class <b>B</b>. But what about the class names? Suppose you create a <b>stack</b>
class that is installed on a machine that already has a <b>stack</b> class
that’s written by someone else? With Java on the Internet, this can happen
without the user knowing it, since classes can get downloaded automatically in
the process of running a Java program.</span></p>

<p class=MsoNormal><span lang=EN-US>This potential clashing of names is why
it’s important to have complete control over the name spaces in Java, and to be
able to create a completely unique name regardless of the constraints of the
Internet.</span></p>

<p class=MsoNormal><span lang=EN-US>So far, most of the examples in this book
have existed in a single file and have been designed for local use, and haven’t
bothered with package names. (In this case the class name is placed in the
“default package.”) This is certainly an option, and for simplicity’s sake this
approach will be used whenever possible throughout the rest of this book.
However, if you’re planning to create libraries or programs that are friendly
to other Java programs on the same machine, you must think about preventing
class name clashes.</span></p>

<p class=MsoNormal><span lang=EN-US>When you create a source-code file for
Java, it’s commonly called a </span><span
lang=EN-US><i>compilation unit</i> (sometimes a </span><span
lang=EN-US><i>translation unit</i>). Each compilation unit must have a name
ending in <b>.java</b>, and inside the compilation unit there can be a <b>public</b>
class that must have the same name as the file (including capitalization, but
excluding the <b>.java</b> filename extension). There can be only<i> one</i> </span><span lang=EN-US><b>public</b> class in each compilation unit, otherwise the compiler
will complain. The rest of the classes in that compilation unit, if there are
any, are hidden from the world outside that package because they’re <i>not</i> <b>public</b>,
and they comprise “support” classes for the main <b>public</b> class.</span></p>

<p class=MsoNormal><span lang=EN-US>When you compile a <b>.java</b> file you
get an output file with exactly the same name but an extension of <b>.class</b>
<i>for each class in the </i><b>.java</b> file. Thus you can end up with quite
a few <b>.class</b> files from a small number of <b>.java</b> files. If you’ve
programmed with a compiled language, you might be used to the compiler spitting
out an intermediate form (usually an “obj” file) that is then packaged together
with others of its kind using a linker (to create an executable file) or a
librarian (to create a library). That’s not how Java works. A working program
is a bunch of <b>.class</b> files, which can be packaged and compressed into a </span><span lang=EN-US>JAR file (using Java’s <b>jar </b>archiver). The Java interpreter is
responsible for finding, loading, and interpreting these files</span><a
href="#_ftn32" name="_ftnref32" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[32]</span></span></span></span></a><span
lang=EN-US>.</span></p>

<p class=MsoNormal><span lang=EN-US>A library is also a bunch of these class
files. Each file has one class that is <b>public</b> (you’re not forced to have
a <b>public</b> class, but it’s typical), so there’s one component for each
file. If you want to say that all these components (that are in their own
separate <b>.java </b>and <b>.class </b>files) belong together, that’s where
the <b>package</b> keyword comes in.</span></p>

<p class=MsoNormal><span lang=EN-US>When you say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>package mypackage;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>at the beginning of a file (if you use a <b>package
</b>statement, it <i>must </i>appear as the first noncomment in the file),
you’re stating that this compilation unit is part of a library named <b>mypackage</b>.
Or, put another way, you’re saying that the <b>public</b> class name within
this compilation unit is under the umbrella of the name <b>mypackage</b>, and
if anyone wants to use the name they must either fully specify the name or use
the <b>import</b> keyword in combination with <b>mypackage</b> (using the
choices given previously). Note that the convention for Java package names is
to use all lowercase letters, even for intermediate words.</span></p>

<p class=MsoNormal><span lang=EN-US>For example, suppose the name of the file
is <b>MyClass.java</b>. This means there can be one and only one <b>public</b>
class in that file, and the name of that class must be <b>MyClass</b>
(including the capitalization):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package mypackage;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class MyClass {</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  // . . .</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now, if someone wants to use <b>MyClass</b>
or, for that matter, any of the other <b>public</b> classes in <b>mypackage</b>,
they must use the <b>import</b> keyword to make the name or names in <b>mypackage</b>
available. The alternative is to give the fully qualified name:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>mypackage.MyClass
m = new mypackage.MyClass();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>import</b> keyword can make this
much cleaner:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import mypackage.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// . . . </span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>MyClass m = new
MyClass();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It’s worth keeping in mind that what the <b>package</b>
and <b>import</b> keywords allow you to do, as a library designer, is to divide
up the single global name space so you won’t have clashing names, no matter how
many people get on the Internet and start writing classes in Java.</span></p>

<h3><a name="_Toc481064590"></a><a name="_Toc375545292"><span lang=EN-US>Creating
unique package names</span></a></h3>

<p class=MsoNormal><span lang=EN-US>You might observe that, since a package
never really gets “packaged” into a single file, a package could be made up of
many <b>.class</b> files, and things could get a bit cluttered. To prevent
this, a logical thing to do is to place all the <b>.class</b> files for a
particular package into a single directory; that is, use the hierarchical file
structure of the operating system to your advantage. This is one way that Java
references the problem of clutter; you’ll see the other way later when the <b>jar</b>
utility is introduced. </span></p>

<p class=MsoNormal><span lang=EN-US>Collecting the package files into a single
subdirectory solves two other problems: creating unique package names, and finding
those classes that might be buried in a directory structure someplace. This is
accomplished, as was introduced in Chapter 2, by encoding the path of the
location of the <b>.class</b> file into the name of the <b>package</b>. The compiler
enforces this, but by convention, the first part of the <b>package</b> name is
the Internet domain name of the creator of the class, reversed. Since Internet
domain names are guaranteed to be unique, <i>if</i> you follow this convention
it’s guaranteed that your <b>package</b> name will be unique and thus you’ll
never have a name clash. (That is, until you lose the domain name to someone
else who starts writing Java code with the same path names as you did.) Of
course, if you don’t have your own domain name then you must fabricate an
unlikely combination (such as your first and last name) to create unique
package names. If you’ve decided to start publishing Java code it’s worth the
relatively small effort to get a domain name.</span></p>

<p class=MsoNormal><span lang=EN-US>The second part of this trick is resolving the
<b>package</b> name into a directory on your machine, so when the Java program
runs and it needs to </span><span lang=EN-US>load the <b>.class </b>file (which it does dynamically, at the point
in the program where it needs to create an object of that particular class, or
the first time you access a <b>static </b>member of the class), it can locate
the directory where the <b>.class </b>file resides.</span></p>

<p class=MsoNormal><span lang=EN-US>The Java interpreter proceeds as follows.
First, it finds the environment variable </span><span
lang=EN-US>CLASSPATH (set via the operating system, sometimes by the
installation program that installs Java or a Java-based tool on your machine).
CLASSPATH contains one or more directories that are used as roots for a search
for <b>.class</b> files. Starting at that root, the interpreter will take the
package name and replace each dot with a slash to generate a path name from the
CLASSPATH root (so <b>package foo.bar.baz</b> becomes <b>foo\bar\baz </b>or <b>foo/bar/baz
</b>or possibly something else, depending on your operating system). This is
then concatenated to the various entries in the CLASSPATH. That’s where it
looks for the <b>.class</b> file with the name corresponding to the class
you’re trying to create. (It also searches some standard directories relative
to where the Java interpreter resides).</span></p>

<p class=MsoNormal><span lang=EN-US>To understand this, consider my domain
name, which is <b>bruceeckel.com</b>. By reversing this, <b>com.bruceeckel</b>
establishes my unique global name for my classes. (The com, edu, org, etc.,
extension was formerly capitalized in Java packages, but this was changed in
Java 2 so the entire package name is lowercase.) I can further subdivide this
by deciding that I want to create a library named <b>simple</b>, so I’ll end up
with a package name:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.simple;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now this package name can be used as an
umbrella name space for the following two files:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:simple:Vector.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creating a package.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.simple;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Vector {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Vector() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;com.bruceeckel.util.Vector&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When you create your own packages, you’ll
discover that the <b>package</b> statement must be the first noncomment code in
the file. The second file looks much the same:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:simple:List.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creating a package.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package com.bruceeckel.simple;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class List {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public List() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;com.bruceeckel.util.List&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Both of these files are placed in the
subdirectory on my system:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>C:\DOC\JavaT\com\bruceeckel\simple</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you walk back through this, you can see
the package name <b>com.bruceeckel.simple</b>, but what about the first portion
of the path? That’s taken care of in the CLASSPATH environment variable, which
is, on my machine:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>CLASSPATH=.;D:\JAVA\LIB;C:\DOC\JavaT</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the CLASSPATH can contain
a number of alternative search paths. </span></p>

<p class=MsoNormal><span lang=EN-US>There’s a variation when using JAR files,
however. You must put the name of the JAR file in the classpath, not just the
path where it’s located. So for a </span><span
lang=EN-US>JAR named <b>grape.jar</b> your classpath would include:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>CLASSPATH=.;D:\JAVA\LIB;C:\flavors\grape.jar</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Once the classpath is set up properly, the
following file can be placed in any directory:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c05:LibTest.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Uses the library.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.simple.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class LibTest {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Vector v = new
Vector();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    List l = new List();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When the compiler encounters the <b>import</b>
statement, it begins searching at the directories specified by CLASSPATH,
looking for subdirectory com\bruceeckel\simple, then seeking the compiled files
of the appropriate names (<b>Vector.class</b> for <b>Vector</b> and <b>List.class</b>
for <b>List</b>). Note that both the classes and the desired methods in <b>Vector</b>
and <b>List</b> must be <b>public</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Setting the CLASSPATH has been such a trial
for beginning Java users (it was for me, when I started) that Sun made the JDK
in Java 2 a bit smarter. You’ll find that, when you install it, even if you
don’t set a CLASSPATH you’ll be able to compile and run basic Java programs. To
compile and run the source-code package for this book (available on the CD ROM
packaged with this book, or at <i>www.BruceEckel.com</i>), however, you will
need to make some modifications to your CLASSPATH (these are explained in the
source-code package).</span></p>

<h4><span lang=EN-US>Collisions</span></h4>

<p class=MsoNormal><span lang=EN-US>What happens if two libraries are imported
via * and they include the same </span><span lang=EN-US>names? For example, suppose a program does this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.simple.*;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>import
java.util.*;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Since <b>java.util.*</b> also contains a <b>Vector</b>
class, this causes a potential collision. However, as long as you don’t write
the code that actually causes the collision, everything is OK—this is good
because otherwise you might end up doing a lot of typing to prevent collisions
that would never happen.</span></p>

<p class=MsoNormal><span lang=EN-US>The collision <i>does</i> occur if you now
try to make a <b>Vector</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Vector v = new
Vector();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Which <b>Vector</b> class does this refer
to? The compiler can’t know, and the reader can’t know either. So the compiler
complains and forces you to be explicit. If I want the standard Java <b>Vector</b>,
for example, I must say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>java.util.Vector v
= new java.util.Vector();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Since this (along with the CLASSPATH)
completely specifies the location of that <b>Vector</b>, there’s no need for
the <b>import java.util.*</b> statement unless I’m using something else from <b>java.util</b>.</span></p>

<h3><a name="_Toc481064591"></a><a name="_Toc375545293"><span lang=EN-US>A
custom tool library</span></a><a name="COM_EckelObjects_tools"></a></h3>

<p class=MsoNormal><span lang=EN-US>With this knowledge, you can now create
your own libraries of tools to reduce or eliminate duplicate code. Consider,
for example, creating an alias for <b>System.out.println(&nbsp;)</b> to reduce
typing. This can be part of a package called <b>tools</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:tools:P.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The P.rint &amp;
P.rintln shorthand.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.tools;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class P {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
rint(String s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.print(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
rintln(String s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can use this shorthand to print a <b>String</b>
either with a newline (<b>P.rintln(&nbsp;)</b>) or without a newline (<b>P.rint(&nbsp;)</b>).<a
name=AAASpellcheck></a></span></p>

<p class=MsoNormal><span lang=EN-US>You can guess that the location of this
file must be in a directory that starts at one of the CLASSPATH locations, then
continues <b>com/bruceeckel/tools</b>. After compiling, the <b>P.class</b> file
can be used anywhere on your system with an <b>import</b> statement:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c05:ToolTest.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Uses the tools
library.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.tools.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ToolTest {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
P.rintln(&quot;Available from now on!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
P.rintln(&quot;&quot; + 100); // Force it to be a String</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
P.rintln(&quot;&quot; + 100L);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
P.rintln(&quot;&quot; + 3.14159);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Notice that all objects can easily be
forced into <b>String</b> representations by putting them in a <b>String </b>expression;
in the above case, starting the expression with an empty <b>String </b>does the
trick. But this brings up an interesting observation. If you call <b>System.out.println(100)</b>,
it works without casting it to a <b>String</b>. With some extra overloading,
you can get the <b>P</b> class to do this as well (this is an exercise at the
end of this chapter).</span></p>

<p class=MsoNormal><span lang=EN-US>So from now on, whenever you come up with a
useful new utility, you can add it to the <b>tools</b> directory. (Or to your
own personal <b>util</b> or <b>tools</b> directory.)</span></p>

<h3><a name="_Toc375545294"></a><a name="_Toc481064592"><span lang=EN-US>Using
imports to change behavior</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A feature that is missing from Java is C’s <i>conditional
compilation</i>, which allows you to change a switch and get different behavior
without changing any other code. The reason such a feature was left out of Java
is probably because it is most often used in C to solve cross-platform issues:
different portions of the code are compiled depending on the platform that the
code is being compiled for. Since Java is intended to be automatically
cross-platform, such a feature should not be necessary.</span></p>

<p class=MsoNormal><span lang=EN-US>However, there are other valuable uses for
conditional compilation. A very common use is for debugging code. The debugging
features are enabled during development, and disabled in the shipping product.
Allen Holub (<i>www.holub.com</i>) came up with the idea of using packages to
mimic conditional compilation. He used this to create a Java version of C’s
very useful <i>assertion mechanism</i>, whereby you can say “this should be
true” or “this should be false” and if the statement doesn’t agree with your
assertion you’ll find out about it. Such a tool is quite helpful during
debugging.</span></p>

<p class=MsoNormal><span lang=EN-US>Here is the class that you’ll use for
debugging:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:tools:debug:Assert.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Assertion tool for
debugging.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.tools.debug;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Assert {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static void
perr(String msg) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.err.println(msg);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public final static
void is_true(boolean exp) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(!exp)
perr(&quot;Assertion failed&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public final static
void is_false(boolean exp){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(exp) perr(&quot;Assertion
failed&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public final static
void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  is_true(boolean exp,
String msg) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(!exp)
perr(&quot;Assertion failed: &quot; + msg);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public final static
void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  is_false(boolean exp,
String msg) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(exp)
perr(&quot;Assertion failed: &quot; + msg);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This class simply encapsulates Boolean
tests, which print error messages if they fail. In Chapter 10, you’ll learn
about a more sophisticated tool for dealing with errors called <i>exception
handling</i>, but the <b>perr(&nbsp;)</b> method will work fine in the meantime.</span></p>

<p class=MsoNormal><span lang=EN-US>The output is printed to the console <i>standard
error</i> stream by writing to <b>System.err</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>When you want to use this class, you add a
line in your program:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.tools.debug.*;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>To remove the assertions so you can ship
the code, a second <b>Assert</b> class is created, but in a different package:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:tools:Assert.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Turning off the
assertion output </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// so you can ship the
program.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.tools;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Assert {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public final static
void is_true(boolean exp){}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public final static
void is_false(boolean exp){}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public final static
void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  is_true(boolean exp,
String msg) {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public final static
void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  is_false(boolean exp,
String msg) {}</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now if you change the previous <b>import</b>
statement to:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.tools.*;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The program will no longer print
assertions. Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c05:TestAssert.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrating the
assertion tool.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Comment the
following, and uncomment the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// subsequent line to
change assertion behavior:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import com.bruceeckel.tools.debug.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// import
com.bruceeckel.tools.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class TestAssert
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Assert.is_true((2 +
2) == 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Assert.is_false((1 +
1) == 2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Assert.is_true((2 +
2) == 5, &quot;2 + 2 == 5&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Assert.is_false((1 +
1) == 2, &quot;1 +1 != 2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>By changing the <b>package</b> that’s
imported, you change your code from the debug version to the production
version. This technique can be used for any kind of conditional code.</span></p>

<h3><a name="_Toc481064593"><span lang=EN-US>Package caveat</span></a></h3>

<p class=MsoNormal><span lang=EN-US>It’s worth remembering that anytime you
create a package, you implicitly specify a </span><span lang=EN-US>directory structure when you give the package a name. The package <i>must</i>
live in the directory indicated by its name, which must be a directory that is
searchable starting from the CLASSPATH. Experimenting with the <b>package</b>
keyword can be a bit frustrating at first, because unless you adhere to the
package-name to directory-path rule, you’ll get a lot of mysterious run-time
messages about not being able to find a particular class, even if that class is
sitting there in the same directory. If you get a message like this, try
commenting out the <b>package</b> statement, and if it runs you’ll know where
the problem lies.</span></p>

<h2><a name="_Toc481064594"></a><a name="_Toc375545295"><span lang=EN-US>Java
access specifiers</span></a></h2>

<p class=MsoNormal><span lang=EN-US>When used, the Java </span><span lang=EN-US>access specifiers </span><span lang=EN-US><b>public</b>, </span><span lang=EN-US><b>protected,</b> and </span><span
lang=EN-US><b>private</b> are placed in front of each definition for each
member in your class, whether it’s a field or a method. Each access specifier
controls the access for only that particular definition. This is a distinct
contrast to C++, in which the access specifier controls all the definitions
following it until another access specifier comes along.</span></p>

<p class=MsoNormal><span lang=EN-US>One way or another, everything has some
kind of access specified for it. In the following sections, you’ll learn all
about the various types of access, starting with the default access.</span></p>

<h3><a name="_Toc481064595"></a><a name="_Toc375545296"></a><a
name="_Toc312373840"><span lang=EN-US>“Friend</span></a><span lang=EN-US>ly”</span></h3>

<p class=MsoNormal><span lang=EN-US>What if you give no access specifier at all,
as in all the examples before this chapter? The default access has no keyword,
but it is commonly referred to as “friendly.” It means that all the other
classes in the current package have access to the friendly member, but to all
the classes outside of this package the member appears to be <b>private</b>.
Since a compilation unit—a file—can belong only to a single package, all the
classes within a single compilation unit are automatically friendly with each
other. Thus, friendly elements are also said to have </span><span lang=EN-US><i>package access</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>Friendly access allows you to group related
classes together in a package so that they can easily interact with each other.
When you put classes together in a package (thus granting mutual access to
their friendly members; e.g., making them “friends”) you “own” the code in that
package. It makes sense that only code you own should have friendly access to
other code you own. You could say that friendly access gives a meaning or a
reason for grouping classes together in a package. In many languages the way
you organize your definitions in files can be willy-nilly, but in Java you’re
compelled to </span><span lang=EN-US>organize them in a sensible fashion. In
addition, you’ll probably want to exclude classes that shouldn’t have access to
the classes being defined in the current package.</span></p>

<p class=MsoNormal><span lang=EN-US>The class controls which code has access to
its members. There’s no magic way to “break in.” Code from another package
can’t show up and say, “Hi, I’m a friend of <b>Bob</b>’s!” and expect to see
the <b>protected</b>, friendly, and <b>private</b> members of <b>Bob</b>. The
only way to grant access to a member is to:</span></p>

<p class=Numbered><span lang=EN-US>Make the member <b>public</b>. Then
everybody, everywhere, can access it.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>31.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Make the member friendly by leaving off any access specifier, and
put the other classes in the same package. Then the other classes can access
the member.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>32.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>As you’ll see in Chapter 6, when inheritance is introduced, an
inherited class can access a <b>protected</b> member as well as a <b>public</b>
member (but not <b>private</b> members). It can access friendly members only if
the two classes are in the same package. But don’t worry about that now.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>33.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Provide “accessor/mutator” methods (also known as “get/set” methods)
that read and change the value. This is the most civilized approach in terms of
OOP, and it is fundamental to JavaBeans, as you’ll see in Chapter 13.</span></p>

<h3><a name="_Toc481064596"></a><a name="_Toc375545297"></a><a
name="_Ref351419800"><b><span lang=EN-US>public</span></b><span lang=EN-US>:
interface access</span></a></h3>

<p class=MsoNormal><span lang=EN-US>When you use the <b>public</b> keyword, it </span><span lang=EN-US>means that the member declaration that immediately follows <b>public</b>
is available to everyone, in particular to the client programmer who uses the
library. Suppose you define a package <b>dessert</b> containing the following
compilation unit:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c05:dessert:Cookie.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creates a library.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package c05.dessert;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Cookie {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Cookie() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
System.out.println(&quot;Cookie constructor&quot;); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void bite() {
System.out.println(&quot;bite&quot;); }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Remember, <b>Cookie.java</b> must reside in
a subdirectory called <b>dessert</b>, in a directory under <b>c05 </b>(indicating
Chapter 5 of this book) that must be under one of the CLASSPATH directories.
Don’t make the mistake of thinking that Java will always look at the current
directory as one of the starting points for searching. If you don’t have a ‘<b>.</b>’
as one of the paths in your CLASSPATH, Java won’t look there.</span></p>

<p class=MsoNormal><span lang=EN-US>Now if you create a program that uses <b>Cookie</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c05:Dinner.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Uses the library.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import c05.dessert.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Dinner {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Dinner() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
System.out.println(&quot;Dinner constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Cookie x = new
Cookie();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x.bite(); //
Can't access</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>you can create a <b>Cookie</b> object,
since its constructor is <b>public</b> and the class is <b>public</b>. (We’ll
look more at the concept of a <b>public</b> class later.) However, the <b>bite(&nbsp;)</b>
member is inaccessible inside <b>Dinner.java</b> since <b>bite(&nbsp;)</b> is
friendly only within package <b>dessert</b>.</span></p>

<h4><span lang=EN-US>The default package</span></h4>

<p class=MsoNormal><span
lang=EN-US>You might be surprised to discover that the following code compiles,
even though it would appear that it breaks the rules:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c05:Cake.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Accesses a class in a
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// separate compilation
unit.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Cake {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Pie x = new Pie();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In a second file, in the same directory:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c05:Pie.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The other class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Pie {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f() {
System.out.println(&quot;Pie.f()&quot;); }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You might initially view these as
completely foreign files, and yet <b>Cake</b> is able to create a <b>Pie</b>
object and call its <b>f(&nbsp;)</b> method! (Note that you must have ‘.’ in
your CLASSPATH in order for the files to compile.) You’d typically think that <b>Pie</b>
and <b>f(&nbsp;)</b> are friendly and therefore not available to <b>Cake</b>.
They <i>are</i> friendly—that part is correct. The reason that they are
available in <b>Cake.java</b> is because they are in the same directory and
have no explicit package name. Java treats files like this as implicitly part
of the “default package” for that directory, and therefore friendly to all the
other files in that directory.</span></p>

<h3><a name="_Toc481064597"></a><a name="_Toc375545298"><b><span lang=EN-US>private</span></b><span
lang=EN-US>: you can’t touch that!</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The <b>private</b> </span><span
lang=EN-US>keyword means that no one can access that member except that particular
class, inside methods of that class. Other classes in the same package cannot
access <b>private </b>members, so it’s as if you’re even insulating the class
against yourself. On the other hand, it’s not unlikely that a package might be
created by several people collaborating together, so <b>private</b> allows you
to freely change that member without concern that it will affect another class
in the same package. </span></p>

<p class=MsoNormal><span lang=EN-US>The default “friendly” package access often
provides an adequate amount of hiding; remember, a “friendly” member is
inaccessible to the user of the package. This is nice, since the default access
is the one that you normally use (and the one that you’ll get if you forget to
add any access control). Thus, you’ll typically think about access for the members
that you explicitly want to make <b>public</b> for the client programmer, and
as a result, you might not<i> </i>initially think you’ll use the <b>private </b>keyword
often since it’s tolerable to get away without it. (This is a distinct contrast
with C++.) However, it turns out that the consistent use of <b>private</b> is
very important, especially where multithreading is concerned. (As you’ll see in
Chapter 14.)</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example of the use of <b>private</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c05:IceCream.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates
&quot;private&quot; keyword.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Sundae {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Sundae() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Sundae
makeASundae() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new Sundae();
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class IceCream {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! Sundae x = new
Sundae();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Sundae x =
Sundae.makeASundae();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This shows an example in which <b>private</b>
comes in handy: you might want to control how an object is created and prevent
someone from directly accessing a particular constructor (or all of them). In
the example above, you cannot create a <b>Sundae</b> object via its
constructor; instead you must call the <b>makeASundae(&nbsp;)</b> method to do
it for you</span><a href="#_ftn33" name="_ftnref33" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[33]</span></span></span></span></a><span lang=EN-US>.</span></p>

<p class=MsoNormal><span lang=EN-US>Any method that you’re certain is only a
“helper” method for that class can be made <b>private,</b> to ensure that you
don’t accidentally use it elsewhere in the package and thus prohibit yourself
from changing or removing the method. Making a method <b>private</b> guarantees
that you retain this option.</span></p>

<p class=MsoNormal><span lang=EN-US>The same is true for a <b>private </b>field
inside a class. Unless you must expose the underlying implementation (which is
a much rarer situation than you might think), you should make all fields <b>private</b>.
However, just because a reference to an object is <b>private</b> inside a class
doesn't mean that some other object can't have a <b>public</b> reference to the
same object. (See Appendix A for issues about aliasing.)</span></p>

<h3><a name="_Toc481064598"></a><a name="_Toc375545299"></a><a
name="_Toc312373839"><b><span lang=EN-US>protected</span></b></a><span
lang=EN-US>: “sort of friendly”</span></h3>

<p class=MsoNormal><span lang=EN-US>The <b>protected</b> access specifier
requires a jump ahead to understand</span><span
lang=EN-US>. First, you should be aware that you don’t need to understand this
section to continue through this book up through inheritance (Chapter 6). But
for completeness, here is a brief description and example using <b>protected</b>.
</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>protected</b> keyword deals with a
concept called </span><span lang=EN-US><i>inheritance</i>, which takes an
existing class and adds new members to that class without touching the existing
class, which we refer to as the </span><span lang=EN-US><i>base</i> <i>class</i>. You can also change the behavior of
existing members of the class. To inherit from an existing class, you say that
your new class </span><span lang=EN-US><b>extends </b>an existing class, like
this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>class Foo extends
Bar {</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The rest of the class definition looks the
same.</span></p>

<p class=MsoNormal><span lang=EN-US>If you create a new package and you inherit
from a class in another package, the only members you have access to are the <b>public</b>
members of the original package. (Of course, if you perform the inheritance in
the <i>same</i> package, you have the normal package access to all the “friendly”
members.) Sometimes the creator of the base class would like to take a
particular member and grant access to derived classes but not the world in
general. That’s what <b>protected</b> does. If you refer back to the file <b>Cookie.java</b>,
the following class <i>cannot</i> access the “friendly” member:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c05:ChocolateChip.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Can't access friendly
member</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// in another class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import c05.dessert.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ChocolateChip extends Cookie {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public ChocolateChip()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     &quot;ChocolateChip
constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ChocolateChip x =
new ChocolateChip();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x.bite(); //
Can't access bite</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>One of the interesting things about
inheritance is that if a method <b>bite(&nbsp;)</b> exists in class <b>Cookie</b>,
then it also exists in any class inherited from <b>Cookie</b>. But since <b>bite(&nbsp;)</b>
is “friendly” in a foreign package, it’s unavailable to us in this one. Of
course, you could make it <b>public</b>, but then everyone would have access
and maybe that’s not what you want. If we change the class <b>Cookie</b> as follows:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Cookie {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Cookie() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Cookie constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected void bite()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;bite&quot;); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>then <b>bite(&nbsp;)</b> still has
“friendly” access within package <b>dessert</b>, but it is also accessible to
anyone inheriting from <b>Cookie</b>. However, it is <i>not</i> </span><span lang=EN-US><b>public</b>.</span></p>

<h2><a name="_Toc481064599"></a><a name="_Toc375545301"><span lang=EN-US>Interface
and implementation</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Access control is often referred to as <i>implementation
hiding</i></span><span lang=EN-US>. Wrapping data and methods within classes in
combination with implementation hiding is often called <i>encapsulation</i></span><a
href="#_ftn34" name="_ftnref34" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[34]</span></span></span></span></a><span lang=EN-US>. The result is a data type with characteristics and behaviors. </span></p>

<p class=MsoNormal><span lang=EN-US>Access control puts boundaries within a
data type for two important reasons. The first is to establish what the client
programmers can and can’t use. You can build your internal mechanisms into the
structure without worrying that the client programmers will accidentally treat
the internals as part of the interface that they should be using.</span></p>

<p class=MsoNormal><span lang=EN-US>This feeds directly into the second reason,
which is to separate the interface from the implementation. </span><span lang=EN-US> If the structure is used in a set of programs, but client
programmers can’t do anything but send messages to the <b>public</b> interface,
then you can change anything that’s <i>not</i> <b>public</b> (e.g., “friendly,”
<b>protected</b>, or <b>private</b>) without requiring modifications to client
code.</span></p>

<p class=MsoNormal><span lang=EN-US>We’re now in the world of object-oriented
programming, where a <b>class</b> is actually describing “a class of objects,”
as you would describe a class of fishes or a class of birds. Any object belonging
to this class will share these characteristics and behaviors. The class is a
description of the way all objects of this type will look and act.</span></p>

<p class=MsoNormal><span lang=EN-US>In the original OOP </span><span lang=EN-US>language, Simula-67</span><span lang=EN-US>, the keyword <b>class</b>
</span><span lang=EN-US>was used to describe a new data type. The same keyword
has been used for most object-oriented languages. This is the focal point of
the whole language: the creation of new data types that are more than just
boxes containing data and methods.</span></p>

<p class=MsoNormal><span lang=EN-US>The class is the fundamental OOP concept in
Java. It is one of the keywords that will <i>not </i>be set in bold in this
book—it becomes annoying with a word repeated as often as “class.”</span></p>

<p class=MsoNormal><span lang=EN-US>For clarity, you might prefer a </span><span lang=EN-US>style of creating classes that puts the <b>public</b> members at the
beginning, followed by the <b>protected</b>, friendly, and <b>private</b>
members. The advantage is that the user of the class can then read down from
the top and see first what’s important to them (the <b>public</b> members,
because they can be accessed outside the file), and stop reading when they
encounter the non-<b>public</b> members, which are part of the internal implementation:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class X {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
pub1(&nbsp;) { /* . . . */ }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void pub2(&nbsp;)
{ /* . . . */ }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
pub3(&nbsp;) { /* . . . */ }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private void
priv1(&nbsp;) { /* . . . */ }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private void
priv2(&nbsp;) { /* . . . */ }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private void
priv3(&nbsp;) { /* . . . */ }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // . . .</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This will make it only partially easier to
read because the interface and implementation are still mixed together. That
is, you still see the source code—the implementation—because it’s right there
in the class. In addition, the comment documentation supported by javadoc
(described in Chapter 2) lessens the importance of code readability by the
client programmer. Displaying the interface to the consumer of a class is
really the job of the </span><span
lang=EN-US><i>class browser</i>, a tool whose job is to look at all the available
classes and show you what you can do with them (i.e., what members are
available) in a useful fashion. By the time you read this, browsers should be
an expected part of any good Java development tool.</span></p>

<h2><a name="_Toc312373850"></a><a name="_Toc481064600"></a><a
name="_Toc375545302"><span lang=EN-US>Class access</span></a></h2>

<p class=MsoNormal><span lang=EN-US>In Java, the access specifiers can also be
used to determine which classes <i>within</i> a library will be available to
the users of that library. If you want a class to be available to a client
programmer, you place the <b>public</b> keyword somewhere before the opening
brace of the class body. This controls whether the client programmer can even
create an object of the class. </span></p>

<p class=MsoNormal><span lang=EN-US>To control the access of a class, the
specifier must appear before the keyword <b>class</b>.<b> </b>Thus you can say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>public class
Widget {</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now if the name of your library is <b>mylib</b>
any client programmer can access <b>Widget</b> by saying</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>import
mylib.Widget;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>or</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>import mylib.*;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>However, there’s an extra set of
constraints:</span></p>

<p class=Numbered><span lang=EN-US>There can be only one <b>public</b> class
per compilation unit (file). The idea is that each compilation unit has a
single public interface represented by that <b>public</b> class. It can have as
many supporting “friendly” classes as you want. If you have more than one <b>public</b>
class inside a compilation unit, the compiler will give you an error message.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>34.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>The name of the <b>public</b> class must exactly match the name of
the file containing the compilation unit, including capitalization. So for <b>Widget</b>,
the name of the file must be <b>Widget.java</b>, not <b>widget.java</b> or <b>WIDGET.java</b>.
Again, you’ll get a compile-time error if they don’t agree.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>35.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>It is possible, though not typical, to have a compilation unit with
no <b>public</b> class at all. In this case, you can name the file whatever you
like.</span></p>

<p class=MsoNormal><span lang=EN-US>What if you’ve got a class inside <b>mylib</b>
that you’re just using to accomplish the tasks performed by <b>Widget</b> or
some other <b>public</b> class in <b>mylib</b>? You don’t want to go to the
bother of creating documentation for the client programmer, and you think that
sometime later you might want to completely change things and rip out your
class altogether, substituting a different one. To give you this flexibility,
you need to ensure that no client programmers become dependent on your
particular implementation details hidden inside <b>mylib</b>. To accomplish
this, you just leave the <b>public</b> keyword off the class, in which case it
becomes friendly. (That class can be used only within that package.)</span></p>

<p class=MsoNormal><span lang=EN-US>Note that a class cannot be <b>private </b>(that
would make it accessible to no one but the class), or <b>protected</b></span><a
href="#_ftn35" name="_ftnref35" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[35]</span></span></span></span></a><span
lang=EN-US>. So you have only two choices for class access: “friendly” or <b>public</b>.
If you don’t want anyone else to have access to that class, you can make all
the constructors <b>private</b>, thereby preventing anyone but you, inside a <b>static</b>
member of the class, from creating an object of that class</span><a
href="#_ftn36" name="_ftnref36" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[36]</span></span></span></span></a><span
lang=EN-US>. Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c05:Lunch.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates class
access specifiers.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Make a class
effectively private</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// with private
constructors:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Soup {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Soup() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // (1) Allow creation
via static method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static Soup
makeSoup() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new Soup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // (2) Create a static
object and</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // return a reference
upon request.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // (The
&quot;Singleton&quot; pattern):</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static Soup
ps1 = new Soup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static Soup
access() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return ps1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Sandwich { // Uses
Lunch</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f() { new
Lunch(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Only one public class
allowed per file:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Lunch {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void test() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Can't do this!
Private constructor:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! Soup priv1 = new
Soup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Soup priv2 =
Soup.makeSoup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Sandwich f1 = new
Sandwich();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Soup.access().f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Up to now, most of the methods have been
returning either <b>void</b> or a primitive type, so the definition:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static Soup
access() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return ps1;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>might look a little confusing at first. The
word before the method name (<b>access</b>) tells what the method returns. So
far this has most often been <b>void,</b> which means it returns nothing. But
you can also return a reference to an object, which is what happens here. This
method returns a reference to an object of class <b>Soup</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>class Soup</b> shows how to prevent
direct creation of a class by making all the constructors <b>private</b>.
Remember that if you don’t explicitly create at least one constructor, the
default constructor (a constructor with no arguments) will be created for you.
By writing the default constructor, it won’t be created automatically. By
making it <b>private</b>, no one can create an object of that class. But now
how does anyone use this class? The above example shows two options. First, a <b>static</b>
method is created that creates a new <b>Soup</b> and returns a reference to it.
This could be useful if you want to do some extra operations on the <b>Soup</b>
before returning it, or if you want to keep count of how many <b>Soup</b>
objects to create (perhaps to restrict their population).</span></p>

<p class=MsoNormal><span lang=EN-US>The second option uses what’s called a </span><span lang=EN-US><i>design pattern</i>, which is covered in <i>Thinking in Patterns
with Java</i>, downloadable at <i>www.BruceEckel.com</i>. This particular
pattern is called a “</span><span
lang=EN-US>singleton” because it allows only a single object to ever be
created. The object of class <b>Soup</b> is created as a <b>static</b> <b>private
</b>member of <b>Soup</b>, so there’s one and only one, and you can’t get at it
except through the <b>public</b> method <b>access(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>As previously mentioned, if you don’t put
an access specifier for class access it defaults to “friendly.” This means that
an object of that class can be created by any other class in the package, but
not outside the package. (Remember, all the files within the same directory
that don’t have explicit <b>package </b>declarations are implicitly part of the
default package for that directory.) However, if a <b>static</b> member of that
class is <b>public</b>, the client programmer can still access that <b>static</b>
member even though they cannot create an object of that class.</span></p>

<h2><a name="_Toc481064601"></a><a name="_Toc375545303"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>In any relationship it’s important to have
boundaries that are respected by all parties involved. When you create a
library, you establish a relationship with the user of that library—the client
programmer—who is another programmer, but one putting together an application
or using your library to build a bigger library.</span></p>

<p class=MsoNormal><span lang=EN-US>Without rules, client programmers can do
anything they want with all the members of a class, even if you might prefer
they don’t directly manipulate some of the members. Everything’s naked to the
world.</span></p>

<p class=MsoNormal><span lang=EN-US>This chapter looked at how classes are
built to form libraries; first, the way a group of classes is packaged within a
library, and second, the way the class controls access to its members.</span></p>

<p class=MsoNormal><span lang=EN-US>It is estimated that a C programming
project begins to break down somewhere between 50K and 100K lines of code
because C has a single “name space” so names begin to collide, causing an extra
management overhead. In Java, the <b>package</b> keyword, the package naming
scheme, and the <b>import</b> keyword give you complete control over names, so
the issue of name collision is easily avoided.</span></p>

<p class=MsoNormal><span lang=EN-US>There are two reasons for controlling
access </span><span lang=EN-US>to members. The first is to keep users’ hands
off tools that they shouldn’t touch; tools that are necessary for the internal
machinations of the data type, but not part of the interface that users need to
solve their particular problems. So making methods and fields <b>private</b> is
a service to users because they can easily see what’s important to them and
what they can ignore. It simplifies their understanding of the class.</span></p>

<p class=MsoNormal><span lang=EN-US>The second and most important reason for
access control is to allow the library designer to change the internal workings
of the class without worrying about how it will affect the client programmer.
You might build a class one way at first, and then discover that restructuring
your code will provide much greater speed. If the interface and implementation
are clearly separated and protected, you can accomplish this without forcing
the user to rewrite their code.</span></p>

<p class=Code style='margin-bottom:9.0pt;border:none'><span lang=EN-US
style='font-family:"Georgia","serif"'>Access specifiers in Java give valuable
control to the creator of a class. The users of the class can clearly see
exactly what they can use and what to ignore. More important, though, is the
ability to ensure that no user becomes dependent on any part of the underlying
implementation of a class. If you know this as the creator of the class, you
can change the underlying implementation with the knowledge that no client programmer
will be affected by the changes because they can’t access that part of the
class.</span></p>

<p class=MsoNormal><span lang=EN-US>When you have the ability to change the
underlying implementation, you can not only improve your design </span><span lang=EN-US>later, but you also have the freedom to make mistakes</span><span lang=EN-US>. No matter how carefully you plan and design you’ll make mistakes.
Knowing that it’s relatively safe to make these mistakes means you’ll be more
experimental, you’ll learn faster, and you’ll finish your project sooner.</span></p>

<p class=MsoNormal><span lang=EN-US>The public interface to a class is what the
user <i>does</i> see, so that is the most important part of the class to get
“right” during analysis and design. Even that allows you some leeway for
change. If you don’t get the interface right the first time, you can <i>add</i>
more methods</span><span lang=EN-US>, as long as you don’t remove any that client programmers have
already used in their code.</span></p>

<h2><a name="_Toc481064602"></a><a name="_Toc375545304"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a program that creates an <b>ArrayList</b>
object without explicitly importing <b>java.util.*</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>43. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In the section labeled “package: the library
unit,” turn the code fragments concerning <b>mypackage</b> into a compiling and
running set of Java files.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>44. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In the section labeled “Collisions,” take the
code fragments and turn them into a program, and verify that collisions do in
fact occur.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>45. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Generalize the class <b>P</b> defined in this
chapter by adding all the overloaded versions of <b>rint(&nbsp;)</b> and <b>rintln(&nbsp;)</b>
necessary to handle all the different basic Java types.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>46. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Change the import statement in <b>TestAssert.java</b>
to enable and disable the assertion mechanism.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>47. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with <b>public</b>, <b>private</b>,
<b>protected,</b> and “friendly” data members and method members. Create an
object of this class and see what kind of compiler messages you get when you
try to access all the class members. Be aware that classes in the same directory
are part of the “default” package.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>48. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with <b>protected</b> data.
Create a second class in the same file with a method that manipulates the <b>protected</b>
data in the first class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>49. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Change the class <b>Cookie </b>as specified in
the section labeled “<b>protected</b>: ‘sort of friendly.’” Verify that <b>bite(&nbsp;)
</b>is not <b>public</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>50. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In the section titled “Class access” you’ll find
code fragments describing <b>mylib</b> and <b>Widget</b>. Create this library,
then create a <b>Widget</b> in a class that is not part of the <b>mylib</b>
package.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>51. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a new directory and edit your CLASSPATH
to include that new directory. Copy the <b>P.class</b> file (produced by
compiling <b>com.bruceeckel.tools.P.java</b>)<b> </b>to your new directory and
then change the names of the file, the <b>P</b> class inside and the method
names. (You might also want to add additional output to watch how it works.)
Create another program in a different directory that uses your new class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>52. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Following the form of the example <b>Lunch.java</b>,
create a class called <b>ConnectionManager</b> that manages a fixed array of <b>Connection</b>
objects. The client programmer must not be able to explicitly create <b>Connection</b>
objects, but can only get them via a <b>static</b> method in <b>ConnectionManager</b>.
When the <b>ConnectionManager</b> runs out of objects, it returns a <b>null</b>
reference. Test the classes in <b>main(&nbsp;)</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>53. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create the following file in the c05/local
directory (presumably in your CLASSPATH):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:54.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>///:
c05:local:PackagedClass.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package c05.local;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class PackagedClass {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public PackagedClass()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Creating a
packaged class&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer style='margin-left:97.2pt'><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:54.0pt'><span lang=EN-US>Then create the
following file in a directory other than c05:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:54.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>///:
c05:foreign:Foreign.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package c05.foreign;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import c05.local.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Foreign {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   public static void
main (String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      PackagedClass pc =
new PackagedClass();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer style='margin-left:97.2pt'><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='margin-left:54.0pt'><span lang=EN-US>Explain why the
compiler generates an error. Would making the <b>Foreign</b> class part of the <b>c05.local</b>
package change anything?</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection12>

<h1><a name="_Toc481064603"></a><a name="_Toc477690726"></a><a
name="_Toc375545305"></a><a name="Chapter_6"></a><span lang=EN-US>6: Reusing
Classes</span></h1>

<p class=Intro><span lang=EN-US>One of the most compelling features about Java
is code reuse</span><span lang=EN-US>. But to be revolutionary, you’ve got to
be able to do a lot more than copy code and change it.</span></p>

<p class=MsoNormal><span lang=EN-US>That’s the approach used in procedural
languages like C, and it hasn’t worked very well. Like everything in Java, the
solution revolves around the class. You reuse code by creating new classes, but
instead of creating them from scratch, you use existing classes that someone
has already built and debugged.</span></p>

<p class=MsoNormal><span lang=EN-US>The trick is to use the classes without
soiling the existing code. In this chapter you’ll see two ways to accomplish
this. The first is quite straightforward: You simply create objects of your
existing class inside the new class. This is called <i>composition,</i> </span><span lang=EN-US>because the new class is composed of objects of existing classes.
You’re simply reusing the functionality of the code, not its form.</span></p>

<p class=MsoNormal><span lang=EN-US>The second approach is more subtle. It
creates a new class as a <i>type of</i> an existing class. You literally take
the form of the existing class and add code to it without modifying the
existing class. This magical act is called <i>inheritance</i></span><span lang=EN-US>, and the compiler does most of the work. Inheritance is one of the
cornerstones of object-oriented programming, and has additional implications
that will be explored in Chapter 7.</span></p>

<p class=MsoNormal><span lang=EN-US>It turns out that much of the syntax and
behavior are similar for both composition and inheritance (which makes sense
because they are both ways of making new types from existing types). In this
chapter, you’ll learn about these code reuse mechanisms.</span></p>

<h2><a name="_Toc481064604"></a><a name="_Toc375545306"></a><a
name="_Toc312374014"></a><a name="_Toc305628723"></a><a name="_Toc305593251"><span
lang=EN-US>Composition syntax</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Until now, composition has been used quite
frequently. You simply place object references inside new classes. For example,
suppose you’d like an object that holds several <b>String</b> objects, a couple
of primitives, and an object of another class. For the nonprimitive objects,
you put references inside your new class, but you define the primitives
directly:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c06:SprinklerSystem.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Composition for code
reuse.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class WaterSource {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private String s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  WaterSource() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;WaterSource()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s = new
String(&quot;Constructed&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { return s; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
SprinklerSystem {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private String valve1,
valve2, valve3, valve4;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  WaterSource source;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float f;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void print() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;valve1 = &quot; + valve1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;valve2 = &quot; + valve2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;valve3 = &quot; + valve3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;valve4 = &quot; + valve4);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;i = &quot; + i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;f = &quot; + f);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;source = &quot; + source);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    SprinklerSystem x =
new SprinklerSystem();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.print();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>One of the methods defined in <b>WaterSource
</b>is special: <b>toString(&nbsp;)</b>. You will learn later that every
nonprimitive object has a </span><span lang=EN-US><b>toString(&nbsp;)</b> method, and it’s called in special situations
when the compiler wants a <b>String</b> but it’s got one of these objects. So
in the expression:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>System.out.println(&quot;source
= &quot; + source);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>the compiler sees you trying to add a <b>String</b>
object (&quot;<b>source = </b>&quot;) to a <b>WaterSource</b>. This doesn’t
make sense to it, because you can only “add” a <b>String</b> to another <b>String</b>,
so it says “I’ll turn <b>source</b> into a <b>String</b> by calling <b>toString(&nbsp;)</b>!”
After doing this it can combine the two <b>String</b>s and pass the resulting <b>String</b>
to <b>System.out.println(&nbsp;)</b>. Any time you want to allow this behavior
with a class you create you need only write a <b>toString(&nbsp;)</b> method. </span></p>

<p class=MsoNormal><span lang=EN-US>At first glance, you might assume—Java
being as safe and careful as it is—that the compiler would automatically
construct objects for each of the references in the above code; for example,
calling the default constructor for <b>WaterSource</b> to initialize <b>source</b>.
The output of the print statement is in fact:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>valve1 = null</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>valve2 = null</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>valve3 = null</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>valve4 = null</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>f = 0.0</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>source = null</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Primitives that are fields in a class are
automatically </span><span lang=EN-US>initialized to zero, as noted in Chapter 2. But the object references
are initialized to <b>null</b>, and if you try to call methods for any of them
you’ll get an exception. It’s actually pretty good (and useful) that you can
still print them out without throwing an exception.</span></p>

<p class=MsoNormal><span lang=EN-US>It makes sense that the compiler doesn’t
just create a default object for every reference because that would incur
unnecessary overhead in many cases. If you want the references initialized, you
can do it:</span></p>

<p class=Numbered><span lang=EN-US>At the point the objects are defined. This
means that they’ll always be initialized before the constructor is called.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>36.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>In the constructor for that class.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>37.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Right before you actually need to use the object. This is often
called <i>lazy initialization</i></span><span lang=EN-US>. It can reduce overhead in situations where the object doesn’t need
to be created every time.</span></p>

<p class=MsoNormal><span lang=EN-US>All three approaches are shown here:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:Bath.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Constructor
initialization with composition.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Soap {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private String s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Soap() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Soap()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s = new
String(&quot;Constructed&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { return s; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Bath {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private String </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Initializing at
point of definition:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s1 = new
String(&quot;Happy&quot;), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s2 =
&quot;Happy&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s3, s4;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Soap castille;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float toy;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Bath() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Inside Bath()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s3 = new
String(&quot;Joy&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = 47;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    toy = 3.14f;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    castille = new
Soap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void print() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Delayed
initialization:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(s4 == null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s4 = new
String(&quot;Joy&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;s1 = &quot; + s1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;s2 = &quot; + s2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;s3 = &quot; + s3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;s4 = &quot; + s4);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;i = &quot; + i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;toy = &quot; + toy);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;castille
= &quot; + castille);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Bath b = new Bath();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b.print();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that in the <b>Bath </b>constructor a
statement is executed before any of the initializations take place. When you
don’t initialize at the point of definition, there’s still no guarantee that
you’ll perform any initialization before you send a message to an object
reference—except for the inevitable run-time exception.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s the output for the program:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Inside Bath()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Soap()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>s1 = Happy</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>s2 = Happy</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>s3 = Joy</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>s4 = Joy</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 47</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>toy = 3.14</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>castille =
Constructed</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When <b>print(&nbsp;)</b> is called it
fills in <b>s4</b> so that all the fields are properly initialized by the time
they are used.</span></p>

<h2><a name="_Toc481064605"></a><a name="_Toc375545307"></a><a
name="_Toc312374015"></a><a name="_Toc305628724"></a><a name="_Toc305593252"><span
lang=EN-US>Inheritance syntax</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Inheritance is an integral part of Java
(and OOP languages in general). It turns out that you’re always doing
inheritance when you create a class, because unless you explicitly inherit from
some other class, you implicitly inherit from Java’s </span><span
lang=EN-US>standard root class <b>Object</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The syntax for composition is obvious, but
to perform inheritance there’s a distinctly different form. When you inherit,
you say “This new class is like that old class.” You state this in code by
giving the name of the class as usual, but before the opening brace of the
class body, put the </span><span lang=EN-US>keyword <b>extends</b> followed by
the name of the </span><span lang=EN-US><i>base class</i>. When you do this,
you automatically get all the data members and methods in the base class.
Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:Detergent.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Inheritance syntax
&amp; properties.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Cleanser {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private String s = new
String(&quot;Cleanser&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
append(String a) { s += a; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void dilute() {
append(&quot; dilute()&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void apply() {
append(&quot; apply()&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void scrub() {
append(&quot; scrub()&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void print() {
System.out.println(s); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Cleanser x = new
Cleanser();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.dilute();
x.apply(); x.scrub();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.print();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Detergent
extends Cleanser {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Change a method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void scrub() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    append(&quot;
Detergent.scrub()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super.scrub(); //
Call base-class version</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Add methods to the
interface:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void foam() {
append(&quot; foam()&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Test the new class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Detergent x = new
Detergent();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.dilute();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.apply();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.scrub();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.foam();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.print();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Testing base class:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Cleanser.main(args);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This demonstrates a number of features.
First, in the <b>Cleanser</b> <b>append(&nbsp;)</b> method, <b>String</b>s are
concatenated to <b>s</b> using the <b>+=</b> operator, which is one of the
operators (along with ‘<b>+</b>’) that the Java designers “overloaded” to work
with </span><span
lang=EN-US><b>String</b>s.</span></p>

<p class=MsoNormal><span lang=EN-US>Second, both <b>Cleanser</b> and <b>Detergent</b>
contain a </span><span lang=EN-US><b>main(&nbsp;)</b> method. You can create a <b>main(&nbsp;)</b>
for each one of your classes, and it’s often recommended to code this way so
that your test code is wrapped in with the class. Even if you have a lot of
classes in a program, only the <b>main(&nbsp;)</b> for the class invoked on the
command line will be called. (As long as <b>main(&nbsp;)</b> is <b>public</b>,
it doesn’t matter whether the class that it’s part of is <b>public</b>.) So in
this case, when you say <b>java Detergent</b>, <b>Detergent.main(&nbsp;)</b>
will be called. But you can also say <b>java Cleanser </b>to invoke <b>Cleanser.main(&nbsp;)</b>,
even though <b>Cleanser</b> is not a <b>public</b> class. This technique of
putting a <b>main(&nbsp;)</b> in each class allows easy </span><span lang=EN-US>unit testing for each class. And you don’t need to remove the <b>main(&nbsp;)</b>
when you’re finished testing; you can leave it in for later testing.</span></p>

<p class=MsoNormal><span lang=EN-US>Here, you can see that <b>Detergent.main(&nbsp;)</b>
calls <b>Cleanser.main(&nbsp;)</b> explicitly, passing it the same arguments
from the command line (however, you could pass it any <b>String</b> array).</span></p>

<p class=MsoNormal><span lang=EN-US>It’s important that all of the methods in <b>Cleanser
</b>are <b>public</b>. Remember that if you leave off any access specifier the
member defaults to “friendly,” which allows access only to package members.
Thus, <i>within this package</i>, anyone could use those methods if there were
no access specifier. <b>Detergent</b> would have no trouble, for example.
However, if a class from some other package were to inherit from <b>Cleanser</b>
it could access only <b>public </b>members. So to plan for inheritance, as a
general rule make all fields <b>private </b>and all methods <b>public</b>.<b> </b>(<b>protected
</b>members also allow access by derived classes; you’ll learn about this
later.) Of course, in particular cases you must make adjustments, but this is a
useful guideline.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that <b>Cleanser</b> has a set of
methods in its interface: <b>append(&nbsp;)</b>, <b>dilute(&nbsp;)</b>, <b>apply(&nbsp;)</b>,
<b>scrub(&nbsp;)</b>, and <b>print(&nbsp;)</b>. Because <b>Detergent</b> is <i>derived
from</i> <b>Cleanser</b> (via the </span><span
lang=EN-US><b>extends</b> keyword) it automatically gets all these methods in
its interface, even though you don’t see them all explicitly defined in <b>Detergent</b>.
You can think of inheritance, then, as <i>reusing the interface.</i> (The
implementation also comes with it, but that part isn’t the primary point.)</span></p>

<p class=MsoNormal><span lang=EN-US>As seen in <b>scrub(&nbsp;)</b>, it’s
possible to take a method that’s been defined in the base class and modify it.
In this case, you might want to call the method from the base class inside the
new version. But inside <b>scrub(&nbsp;)</b> you cannot simply call <b>scrub(&nbsp;)</b>,
since that would produce a recursive call, which isn’t what you want. To solve
this problem Java has the </span><span
lang=EN-US>keyword <b>super</b> that refers to the “</span><span
lang=EN-US>superclass” that the current class has been inherited from. Thus the
expression <b>super.scrub(&nbsp;)</b> calls the base-class version of the
method <b>scrub(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>When inheriting you’re not restricted to
using the methods of the base class. You can also add new methods to the
derived class exactly the way you put any method in a class: just define it.
The method <b>foam(&nbsp;)</b> is an example of this.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>Detergent.main(&nbsp;) </b>you can
see that for a <b>Detergent</b> object you can call all the methods that are
available in <b>Cleanser</b> as well as in <b>Detergent </b>(i.e., <b>foam(&nbsp;)</b>).</span></p>

<h3><a name="_Toc481064606"></a><a name="_Toc375545308"><span lang=EN-US>Initializing
the base class</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>Since there are now two classes involved—the base class and the </span><span lang=EN-US>derived class—instead of just one, it can be a bit confusing to try
to imagine the resulting object produced by a derived class. From the outside,
it looks like the new class has the same interface as the base class and maybe
some additional methods and fields. But inheritance doesn’t just copy the
interface of the base class. When you create an object of the derived class, it
contains within it a <i>subobject</i> of the base class. This </span><span lang=EN-US>subobject is the same as if you had created an object of the base
class by itself. It’s just that, from the outside, the subobject of the base
class is wrapped within the derived-class object.</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, it’s essential that the
base-class subobject be initialized correctly and there’s only one way to
guarantee that: perform the initialization in the constructor, by calling the
base-class constructor, which has all the appropriate knowledge and privileges
to perform the base-class initialization. Java automatically inserts calls to
the base-class constructor in the derived-class constructor. The following
example shows this working with three levels of inheritance:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:Cartoon.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Constructor calls
during inheritance.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Art {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Art() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Art constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Drawing extends
Art {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Drawing() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Drawing constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Cartoon
extends Drawing {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Cartoon() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Cartoon constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Cartoon x = new
Cartoon();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output for this program shows the
automatic calls:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Art constructor</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Drawing constructor</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Cartoon
constructor</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the construction happens
from the base “outward,” so the base class is initialized before the
derived-class constructors can access it.</span></p>

<p class=MsoNormal><span lang=EN-US>Even if you don’t create a constructor for <b>Cartoon(&nbsp;)</b>,
the compiler will </span><span
lang=EN-US>synthesize a default constructor for you that calls the base class
constructor.</span></p>

<h4><span lang=EN-US>Constructors with arguments</span></h4>

<p class=MsoNormal><span lang=EN-US>The above example has default </span><span
lang=EN-US>constructors; that is, they don’t have any arguments. It’s easy for
the compiler to call these because there’s no question about what arguments to
pass. If your class doesn’t have default arguments, or if you want to call a
base-class constructor that has an argument, you must explicitly write the
calls to the base-class constructor using the </span><span
lang=EN-US><b>super</b> keyword and the appropriate argument list:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:Chess.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Inheritance,
constructors and arguments.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Game {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Game(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Game constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class BoardGame extends
Game {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  BoardGame(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;BoardGame constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Chess
extends BoardGame {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Chess() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(11);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Chess
constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Chess x = new
Chess();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you don’t call the base-class
constructor in <b>BoardGame(&nbsp;)</b>, the compiler will complain that it
can’t find a constructor of the form <b>Game(&nbsp;)</b>. In addition, the call
to the base-class constructor <i>must</i> be the first thing you do in the
derived-class constructor. (The compiler will remind you if you get it wrong.)</span></p>

<h4><span lang=EN-US>Catching base constructor exceptions</span></h4>

<p class=MsoNormal><span lang=EN-US>As just noted, the compiler forces you to place the base-class
constructor call first in the body of the derived-class constructor. This means
nothing else can appear before it. As you’ll see in Chapter 10, this also
prevents a derived-class constructor from catching any exceptions that come
from a base class. This can be inconvenient at times.</span></p>

<h2><a name="_Toc481064607"></a><a name="_Toc375545309"></a><a
name="_Toc312374019"></a><a name="_Toc305628726"></a><a name="_Toc305593254"><span
lang=EN-US>Combining composition <br>
and inheritance</span></a></h2>

<p class=MsoNormal><span
lang=EN-US>It is very common to use composition and inheritance together. The
following example shows the creation of a more complex class, using both
inheritance and composition, along with the necessary </span><span
lang=EN-US>constructor initialization:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c06:PlaceSetting.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Combining composition
&amp; inheritance.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Plate {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Plate(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Plate constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class DinnerPlate
extends Plate {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  DinnerPlate(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;DinnerPlate
constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Utensil {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Utensil(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Utensil constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Spoon extends
Utensil {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Spoon(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Spoon constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Fork extends
Utensil {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Fork(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Fork
constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Knife extends
Utensil {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Knife(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Knife constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A cultural way of
doing something:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Custom {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Custom(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Custom constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
PlaceSetting extends Custom {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Spoon sp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Fork frk;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Knife kn;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  DinnerPlate pl;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  PlaceSetting(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(i + 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sp = new Spoon(i +
2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    frk = new Fork(i +
3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    kn = new Knife(i +
4);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pl = new
DinnerPlate(i + 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;PlaceSetting
constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PlaceSetting x = new
PlaceSetting(9);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>While the compiler forces you to initialize
the base classes, and requires that you do it right at the beginning of the
constructor, it doesn’t watch over you to make sure that you initialize the
member objects, so you must remember to pay attention to that.</span></p>

<h3><a name="_Toc481064608"></a><a name="_Toc375545310"><span lang=EN-US>Guaranteeing
proper cleanup</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Java doesn’t have the C++ concept of a </span><span lang=EN-US><i>destructor</i>, a method that is automatically called when an
object is destroyed. The reason is probably that in Java the practice is simply
to forget about objects rather than to destroy them, allowing the </span><span lang=EN-US>garbage collector to reclaim the memory as necessary.</span></p>

<p class=MsoNormal><span lang=EN-US>Often this is fine, but there are times
when your class might perform some activities during its lifetime that require
cleanup. As mentioned in Chapter 4, you can’t know when the garbage collector
will be called, or if it will be called. So if you want something cleaned up
for a class, you must explicitly write a special method to do it, and make sure
that the client programmer knows that they must call this method. On top of
this—as described in Chapter 10 (“</span><span
lang=EN-US>Error Handling with Exceptions”)—you must guard against an exception
by putting such cleanup in a </span><span lang=EN-US><b>finally</b> clause.</span></p>

<p class=MsoNormal><span lang=EN-US>Consider an example of a computer-aided
design system that draws pictures on the screen:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:CADSystem.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Ensuring proper
cleanup.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Shape(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Shape constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void cleanup() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Shape
cleanup&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Circle extends
Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Circle(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Drawing a Circle&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void cleanup() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Erasing a Circle&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super.cleanup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Triangle extends
Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Triangle(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Drawing a Triangle&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void cleanup() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Erasing a Triangle&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super.cleanup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Line extends Shape
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int start,
end;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Line(int start, int
end) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(start);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this.start = start;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this.end = end;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Drawing a Line: &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           start +
&quot;, &quot; + end);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void cleanup() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Erasing a Line: &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           start +
&quot;, &quot; + end);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super.cleanup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class CADSystem
extends Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Circle c;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Triangle t;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Line[] lines =
new Line[10];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  CADSystem(int i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(i + 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int j = 0; j
&lt; 10; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      lines[j] = new
Line(j, j*j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c = new Circle(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t = new Triangle(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Combined constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void cleanup() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;CADSystem.cleanup()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // The order of
cleanup is the reverse </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // of the order of
initialization</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t.cleanup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.cleanup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i =
lines.length - 1; i &gt;= 0; i--)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
lines[i].cleanup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super.cleanup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    CADSystem x = new
CADSystem(47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Code and
exception handling...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      x.cleanup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Everything in this system is some kind of <b>Shape</b>
(which is itself a kind of <b>Object</b> since it’s implicitly inherited from
the root class). Each class redefines <b>Shape</b>’s <b>cleanup(&nbsp;)</b>
method in addition to calling the base-class version of that method using <b>super</b>.
The specific <b>Shape</b> classes—<b>Circle</b>, <b>Triangle</b> and <b>Line</b>—all
have constructors that “draw,” although any method called during the lifetime
of the object could be responsible for doing something that needs cleanup. Each
class has its own <b>cleanup(&nbsp;)</b> method to restore nonmemory things
back to the way they were before the object existed.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>main(&nbsp;)</b>, you can see two
keywords that are new, and won’t officially be introduced until Chapter 10: </span><span lang=EN-US><b>try</b> and </span><span lang=EN-US><b>finally</b>. The <b>try</b>
keyword indicates that the block that follows (delimited by curly braces) is a <i>guarded
region</i>, which means that it is given special treatment. One of these
special treatments is that the code in the <b>finally</b> clause following this
guarded region is <i>always</i> executed, no matter how the <b>try</b> block
exits. (With exception handling, it’s possible to leave a <b>try</b> block in a
number of nonordinary ways.) Here, the <b>finally</b> clause is saying “always
call <b>cleanup(&nbsp;)</b> for <b>x</b>, no matter what happens.” These keywords
will be explained thoroughly in Chapter 10.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that in your cleanup method you must
also pay attention to the calling order for the base-class and member-object
cleanup methods in case one subobject depends on another. In general, you
should follow the same form that is imposed by a C++ compiler on its
destructors: First perform all of the cleanup work specific to your class, in
the reverse order of creation. (In general, this requires that base-class
elements still be viable.) Then call the base-class cleanup method, as
demonstrated here.</span></p>

<p class=MsoNormal><span lang=EN-US>There can be many cases in which the
cleanup issue is not a problem; you just let the garbage collector do the work.
But when you must do it explicitly, diligence and attention is required.</span></p>

<h4><a name="_Toc312374020"><span lang=EN-US>Order of </span></a><span
lang=EN-US>garbage collection</span></h4>

<p class=MsoNormal><span lang=EN-US>There’s not much you can rely on when it
comes to </span><span
lang=EN-US>garbage collection. The garbage collector might never be called. If
it is, it can reclaim objects in any order it wants. It’s best to not rely on garbage
collection for anything but memory reclamation. If you want cleanup to take
place, make your own cleanup methods and don’t rely on </span><span
lang=EN-US><b>finalize(&nbsp;)</b>. (As mentioned in Chapter 4, Java can be
forced to call all the finalizers.)</span></p>

<h3><a name="_Toc481064609"></a><a name="_Toc375545311"></a><a
name="_Toc312374021"><span lang=EN-US>Name hiding</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Only C++ programmers might be surprised by
name hiding, since it works differently in that language. </span><span lang=EN-US>If a Java base class has a method name that’s overloaded several
times, redefining that method name in the derived class will <i>not </i>hide
any of the base-class versions. Thus overloading works regardless of whether
the method was defined at this level or in a base class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:Hide.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Overloading a
base-class method name</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// in a derived class
does not hide the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// base-class versions.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Homer {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  char doh(char c) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;doh(char)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return 'd';</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float doh(float f) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;doh(float)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return 1.0f;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Milhouse {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Bart extends Homer
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void doh(Milhouse m)
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Hide {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Bart b = new Bart();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b.doh(1); //
doh(float) used</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b.doh('x');</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b.doh(1.0f);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b.doh(new
Milhouse());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>As you’ll see in the next chapter, it’s far
more common to override methods of the same name using exactly the same
signature and return type as in the base class. It can be confusing otherwise
(which is why C++ disallows it, to prevent you from making what is probably a
mistake).</span></p>

<h2><a name="_Toc481064610"></a><a name="_Toc375545312"></a><a
name="_Toc312374023"></a><a name="_Toc305628727"></a><a name="_Toc305593255"><span
lang=EN-US>Choosing composition <br>
vs. inheritance</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Both composition and inheritance allow you to place subobjects</span><span lang=EN-US> inside your new class. You might wonder about the difference between
the two, and when to choose one over the other.</span></p>

<p class=MsoNormal><span lang=EN-US>Composition is generally used when you want
the features of an existing class inside your new class, but not its interface.
That is, you embed an object so that you can use it to implement functionality
in your new class, but the user of your new class sees the interface you’ve
defined for the new class rather than the interface from the embedded object.
For this effect, you embed <b>private</b> objects of existing classes inside
your new class. </span></p>

<p class=MsoNormal><span lang=EN-US>Sometimes it makes sense to allow the class
user to directly access the composition of your new class; that is, to make the
member objects <b>public</b>. The member objects use implementation hiding
themselves, so this is a safe thing to do. When the user knows you’re
assembling a bunch of parts, it makes the interface easier to understand. A <b>car</b>
object is a good example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:Car.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Composition with
public objects.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Engine {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void start() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void rev() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void stop() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Wheel {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
inflate(int psi) {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Window {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void rollup()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void rolldown()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Door {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Window window =
new Window();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void open() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void close() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Car {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Engine engine =
new Engine();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Wheel[] wheel =
new Wheel[4];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Door left = new
Door(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       right = new
Door(); // 2-door</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Car() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 4; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      wheel[i] = new
Wheel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Car car = new Car();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
car.left.window.rollup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
car.wheel[0].inflate(72);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Because the composition of a car is part of
the analysis of the problem (and not simply part of the underlying design),
making the members <b>public</b> assists the client programmer’s understanding
of how to use the class and requires less code complexity for the creator of
the class. However, keep in mind that this is a special case and that in
general you should make fields <b>private</b>.</span></p>

<p class=MsoNormal><span
lang=EN-US>When you inherit, you take an existing class and make a special
version of it. In general, this means that you’re taking a general-purpose
class and specializing it for a particular need. With a little thought, you’ll
see that it would make no sense to compose a car using a vehicle object—a car
doesn’t contain a vehicle, it <i>is</i> a vehicle. The </span><span
lang=EN-US><i>is-a</i> relationship is expressed with inheritance, and the </span><span lang=EN-US><i>has-a</i> relationship is expressed with composition.</span></p>

<h2><a name="_Toc481064611"></a><a name="_Toc375545313"></a><a
name="_Toc312374027"></a><a name="_Toc305628728"></a><a name="_Toc305593256"><span
lang=EN-US>protected</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Now that you’ve been introduced to
inheritance, the keyword <b>protected</b></span><span
lang=EN-US> finally has meaning. In an ideal world, <b>private</b> members
would always be hard-and-fast <b>private</b>, but in real projects there are
times when you want to make something hidden from the world at large and yet
allow access for members of derived classes. The <b>protected</b> keyword is a
nod to pragmatism. It says “This is <b>private</b> as far as the class user is
concerned, but available to anyone who inherits from this class or anyone else
in the same <b>package</b>.” That is, </span><span lang=EN-US><b>protected</b> in Java is automatically “friendly.”</span></p>

<p class=MsoNormal><span lang=EN-US>The best tack to take is to leave the data
members </span><span lang=EN-US><b>private</b>—you should always preserve your
right to change the underlying implementation. You can then allow controlled
access to inheritors of your class through </span><span
lang=EN-US><b>protected </b>methods:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:Orc.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The protected
keyword.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Villain {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected int read() {
return i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected void set(int
ii) { i = ii; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Villain(int ii)
{ i = ii; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int value(int
m) { return m*i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Orc extends
Villain {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int j;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Orc(int jj) {
super(jj); j = jj; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void change(int
x) { set(x); }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that <b>change(&nbsp;)</b> has
access to <b>set(&nbsp;)</b> because it’s <b>protected</b>.</span></p>

<h2><a name="_Toc481064612"></a><a name="_Toc375545314"></a><a
name="_Toc312374030"></a><a name="_Toc305628730"></a><a name="_Toc305593258"><span
lang=EN-US>Incremental development</span></a></h2>

<p class=MsoNormal><span lang=EN-US>One of the advantages of inheritance is
that it supports <i>incremental development</i></span><span lang=EN-US> by allowing you to introduce new code without causing bugs in
existing code. This also isolates new bugs inside the new code. By inheriting
from an existing, functional class and adding data members and methods (and
redefining existing methods), you leave the existing code—that someone else
might still be using—untouched and unbugged. If a bug happens, you know that
it’s in your new code, which is much shorter and easier to read than if you had
modified the body of existing code.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s rather amazing how cleanly the classes
are separated. You don’t even need the source code for the methods in order to
reuse the code. At most, you just import a package. (This is true for both
inheritance and composition.)</span></p>

<p class=MsoNormal><span lang=EN-US>It’s important to realize that program
development is an incremental process, just like human learning. You can do as
much analysis as you want, but you still won’t know all the answers when you
set out on a project. You’ll have much more success—and more immediate
feedback—if you start out to “grow” your project as an organic, evolutionary
creature, rather than constructing it all at once like a glass-box skyscraper.</span></p>

<p class=MsoNormal><span lang=EN-US>Although inheritance for experimentation
can be a useful technique, at some point after things stabilize you need to
take a new look at your class hierarchy with an eye to collapsing it into a
sensible structure. Remember that underneath it all, inheritance is meant to
express a relationship that says “This new class is a <i>type of</i> that old
class.” Your program should not be concerned with pushing bits around, but
instead with creating and manipulating objects of various types to express a
model in the terms that come from the </span><span
lang=EN-US>problem space.</span></p>

<h2><a name="_Toc481064613"></a><a name="_Toc375545315"></a><a
name="_Toc312374031"></a><a name="_Toc305628731"></a><a name="_Toc305593259"><span
lang=EN-US>Upcasting</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The most important aspect of inheritance is
not that it provides methods for the new class. It’s the relationship expressed
between the new class and the base class. This </span><span
lang=EN-US>relationship can be summarized by saying “The new class <i>is a type
of</i> the existing class.” </span></p>

<p class=MsoNormal><span lang=EN-US>This description is not just a fanciful way
of explaining inheritance—it’s supported directly by the language. As an
example, consider a base class called <b>Instrument</b> that represents musical
instruments, and a derived class called <b>Wind</b>. Because inheritance means
that all of the methods in the base class are also available in the derived
class, any message you can send to the base class can also be sent to the
derived class. If the <b>Instrument</b> class has a <b>play(&nbsp;)</b> method,
so will <b>Wind</b> instruments. This means we can accurately say that a <b>Wind</b>
object is also a type of <b>Instrument</b>. The following example shows how the
compiler supports this notion:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:Wind.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Inheritance &amp;
upcasting.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
tune(Instrument i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i.play();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Wind objects are
instruments</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// because they have the
same interface:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Wind extends
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Wind flute = new
Wind();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Instrument.tune(flute); // Upcasting</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>What’s interesting in this example is the <b>tune(&nbsp;)</b>
method, which accepts an <b>Instrument</b> reference. However, in <b>Wind</b>.<b>main(&nbsp;)</b>
the <b>tune(&nbsp;)</b> method is called by giving it a <b>Wind</b> reference.
Given that Java is particular about type checking, it seems strange that a
method that accepts one type will readily accept another type, until you
realize that a <b>Wind</b> object is also an <b>Instrument</b> object, and
there’s no method that <b>tune(&nbsp;)</b> could call for an <b>Instrument</b>
that isn’t also in <b>Wind</b>. Inside <b>tune(&nbsp;)</b>, the code works for <b>Instrument</b>
and anything derived from <b>Instrument</b>, and the act of converting a <b>Wind</b>
reference into an <b>Instrument</b> reference is called <i>upcasting</i>.</span></p>

<h3><a name="_Toc481064614"></a><a name="_Toc375545316"></a><a
name="_Toc312374032"><span lang=EN-US>Why “upcasting”?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The reason for the term is historical, and
based on the way class inheritance diagrams </span><span lang=EN-US>have traditionally been drawn: with the root at the top of the page,
growing downward. (Of course, you can draw your diagrams any way you find
helpful.) The inheritance diagram for <b>Wind.java</b> is then: </span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=100 height=113 src="TIJ2_files/image017.png"></span></p>

<p class=MsoNormal><span lang=EN-US>Casting from derived to base moves <i>up</i>
on the inheritance diagram, so it’s commonly referred to as <i>upcasting</i>.
Upcasting is always safe because you’re going from a more specific type to a
more general type. That is, the derived class is a superset of the base class.
It might contain more methods than the base class, but it must contain <i>at
least</i> the methods in the base class. The only thing that can occur to the
class interface during the upcast is that it can lose methods, not gain them.
This is why the compiler allows upcasting without any explicit casts or other
special notation.</span></p>

<p class=MsoNormal><span lang=EN-US>You can also perform the reverse of
upcasting, called </span><span lang=EN-US><i>downcasting</i>, but this involves
a dilemma that is the subject of Chapter 12.</span></p>

<h4><a name="_Toc312374033"><span lang=EN-US>Composition vs. inheritance</span></a><span
lang=EN-US> revisited</span></h4>

<p class=MsoNormal><span lang=EN-US>In object-oriented programming, the most
likely way that you’ll create and use code is by simply packaging data and
methods together into a class, and using objects of that class. You’ll also use
existing classes to build new classes with composition. Less frequently, you’ll
use inheritance. So although inheritance gets a lot of emphasis while learning
OOP, it doesn’t mean that you should use it everywhere you possibly can. On the
contrary, you should use it sparingly, only when it’s clear that inheritance is
useful. </span><span lang=EN-US>One of the clearest ways to determine whether
you should use composition or inheritance is to ask whether you’ll ever need to
upcast from your new class to the base class. If you must upcast, then
inheritance is necessary, but if you don’t need to upcast, then you should look
closely at whether you need inheritance. The next chapter (polymorphism)
provides one of the most compelling reasons for upcasting, but if you remember
to ask “Do I need to upcast?” you’ll have a good tool for deciding between
composition and inheritance.</span></p>

<h2><a name="_Toc312374036"></a><a name="_Toc305628732"></a><a
name="_Toc305593260"></a><a name="_Toc481064615"></a><a name="_Toc375545317"><span
lang=EN-US>The <b>final</b> keyword</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Java’s </span><span
lang=EN-US><b>final</b> keyword has slightly different meanings depending on
the context, but in general it says “This cannot be changed.” You might want to
prevent changes for two reasons: design or efficiency. Because these two
reasons are quite different, it’s possible to misuse the <b>final</b> keyword.</span></p>

<p class=MsoNormal><span lang=EN-US>The following sections discuss the three
places where <b>final</b> can be used: for data, methods, and classes.</span></p>

<h3><a name="_Toc481064616"></a><a name="_Toc375545318"><span lang=EN-US>Final
data</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Many programming languages have a way to
tell the compiler that a piece of data is “constant.” A constant is useful for
two reasons: </span></p>

<p class=Numbered><span lang=EN-US>It can be a <i>compile-time constant</i>
that won’t ever change.</span></p>

<p class=Numbered><span lang=EN-US>It can be a value initialized at run-time
that you don’t want changed.</span></p>

<p class=MsoNormal><span lang=EN-US>In the case of a compile-time constant, the
compiler is allowed to “fold” the </span><span lang=EN-US>constant value into any calculations in which it’s used; that is, the
calculation can be performed at compile-time, eliminating some run-time
overhead. In Java, these sorts of constants must be </span><span
lang=EN-US>primitives and are expressed using the <b>final</b> keyword. A value
must be given at the time of definition of such a constant.</span></p>

<p class=MsoNormal><span lang=EN-US>A field that is both </span><span lang=EN-US><b>static</b> and <b>final</b> has only one piece of storage that
cannot be changed.</span></p>

<p class=MsoNormal><span lang=EN-US>When using </span><span lang=EN-US><b>final</b> with object references rather than primitives the
meaning gets a bit confusing. With a primitive, <b>final</b> makes the <i>value</i>
a constant, but with an object reference, <b>final</b> makes the <i>reference</i>
a constant. Once the reference is initialized to an object, it can never be
changed to point to another object. However, the object itself can be modified;
Java does not provide a way to make any arbitrary object a constant. (You can,
however, write your class so that objects have the effect of being constant.)
This restriction includes arrays, which are also objects.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example that demonstrates <b>final</b>
fields:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:FinalData.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The effect of final
on fields.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Value {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class FinalData {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Can be compile-time
constants</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  final int i1 = 9;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static final int
VAL_TWO = 99;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Typical public
constant:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static final
int VAL_THREE = 39;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Cannot be
compile-time constants:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  final int i4 =
(int)(Math.random()*20);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static final int i5 =
(int)(Math.random()*20);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Value v1 = new
Value();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  final Value v2 = new
Value();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static final Value v3
= new Value();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Arrays:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  final int[] a = { 1,
2, 3, 4, 5, 6 };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
print(String id) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      id + &quot;:
&quot; + &quot;i4 = &quot; + i4 + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;, i5 =
&quot; + i5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    FinalData fd1 = new
FinalData();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! fd1.i1++; //
Error: can't change value</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fd1.v2.i++; //
Object isn't constant!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fd1.v1 = new
Value(); // OK -- not final</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; fd1.a.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fd1.a[i]++; //
Object isn't constant!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! fd1.v2 = new
Value(); // Error: Can't </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! fd1.v3 = new
Value(); // change reference</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! fd1.a = new
int[3];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
fd1.print(&quot;fd1&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Creating new FinalData&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    FinalData fd2 = new
FinalData();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
fd1.print(&quot;fd1&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
fd2.print(&quot;fd2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Since <b>i1</b> and <b>VAL_TWO</b> are <b>final</b>
primitives with compile-time values, they can both be used as compile-time
constants and are not different in any important way. <b>VAL_THREE</b> is the
more typical way you’ll see such constants defined: <b>public</b> so they’re
usable outside the package, <b>static</b> to emphasize that there’s only one,
and <b>final</b> to say that it’s a constant. Note that </span><span lang=EN-US><b>final static</b> primitives with constant initial values (that is,
compile-time constants) are named with all capitals by convention, with words
separated by underscores (This is just like C constants, which is where the
convention originated.) Also note that <b>i5</b> cannot be known at
compile-time, so it is not capitalized.</span></p>

<p class=MsoNormal><span lang=EN-US>Just because something is <b>final</b>
doesn’t mean that its value is known at compile-time. This is demonstrated by
initializing <b>i4</b> and <b>i5</b> at run-time using randomly generated
numbers. This portion of the example also shows the difference between making a
<b>final</b> value <b>static</b> or non-<b>static</b>. This difference shows up
only when the values are initialized at run-time, since the compile-time values
are treated the same by the compiler. (And presumably optimized out of
existence.) The difference is shown in the output from one run:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>fd1: i4 = 15, i5 = 9</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Creating new FinalData</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>fd1: i4 = 15, i5 = 9</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>fd2: i4 = 10, i5 =
9</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that the values of <b>i4</b> for <b>fd1</b>
and <b>fd2</b> are unique, but the value for <b>i5</b> is not changed by
creating the second <b>FinalData</b> object. That’s because it’s <b>static</b>
and is initialized once upon loading and not each time a new object is created.</span></p>

<p class=MsoNormal><span lang=EN-US>The variables <b>v1</b> through <b>v4</b>
demonstrate the meaning of a <b>final</b> reference. As you can see in <b>main(&nbsp;)</b>,
just because <b>v2</b> is <b>final</b> doesn’t mean that you can’t change its
value. However, you cannot rebind <b>v2</b> to a new object, precisely because
it’s <b>final</b>. That’s what <b>final</b> means for a reference. You can also
see the same meaning holds true for an array, which is just another kind of
reference. (There is no way that I know of to make the array references
themselves <b>final</b>.) Making references <b>final</b> seems less useful than
making primitives <b>final</b>.</span></p>

<h4><span lang=EN-US>Blank finals</span></h4>

<p class=MsoNormal><span lang=EN-US>Java allows the creation of </span><span lang=EN-US><i>blank finals</i>, which are fields that are declared as <b>final</b>
but are not given an initialization value. In all cases, the blank final <i>must</i>
be initialized before it is used, and the compiler ensures this. However, blank
finals provide much more flexibility in the use of the <b>final</b> keyword
since, for example, a <b>final</b> field inside a class can now be different
for each object and yet it retains its immutable quality. Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:BlankFinal.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &quot;Blank&quot;
final data members.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Poppet { }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class BlankFinal {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  final int i = 0; //
Initialized final</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  final int j; // Blank
final</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  final Poppet p; //
Blank final reference</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Blank finals MUST
be initialized</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // in the constructor:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  BlankFinal() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    j = 1; // Initialize
blank final</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p = new Poppet();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  BlankFinal(int x) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    j = x; // Initialize
blank final</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p = new Poppet();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BlankFinal bf = new
BlankFinal();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You’re forced to perform assignments to <b>final</b>s
either with an expression at the point of definition of the field or in every
constructor. This way it’s guaranteed that the <b>final</b> field is always
initialized before use.</span></p>

<h4><span lang=EN-US>Final arguments</span></h4>

<p class=MsoNormal><span lang=EN-US>Java allows you to make </span><span lang=EN-US>arguments <b>final</b> by declaring them as such in the argument
list. This means that inside the method you cannot change what the argument
reference points to:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c06:FinalArguments.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using
&quot;final&quot; with method arguments.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Gizmo {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void spin() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
FinalArguments {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void with(final Gizmo
g) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! g = new Gizmo();
// Illegal -- g is final</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void without(Gizmo g)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g = new Gizmo(); //
OK -- g not final</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g.spin();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // void f(final int i)
{ i++; } // Can't change</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // You can only read
from a final primitive:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int g(final int i) {
return i + 1; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    FinalArguments bf =
new FinalArguments();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bf.without(null);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bf.with(null);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that you can still assign a <b>null</b>
reference to an argument that’s final without the compiler catching it, just
like you can with a non-<b>final</b> argument.</span></p>

<p class=MsoNormal><span lang=EN-US>The methods <b>f(&nbsp;)</b> and <b>g(&nbsp;)</b>
show what happens when primitive arguments are <b>final</b>: you can read the
argument, but you can't change it.</span></p>

<h3><a name="_Toc481064617"></a><a name="_Toc375545319"><span lang=EN-US>Final
methods</span></a></h3>

<p class=MsoNormal><span lang=EN-US>There are two reasons for </span><span lang=EN-US><b>final</b> methods. The first is to put a “lock” on the method to
prevent any inheriting class from changing its meaning. This is done for design
reasons when you want to make sure that a method’s behavior is retained during
inheritance and cannot be overridden.</span></p>

<p class=MsoNormal><span lang=EN-US>The second reason for <b>final</b> methods
is efficiency. If you make a method <b>final</b>, you are allowing the compiler
to turn any calls to that method into </span><span lang=EN-US><i>inline</i> calls. When the compiler sees a <b>final</b> method
call it can (at its discretion) skip the normal approach of inserting code to
perform the method call mechanism (push arguments on the stack, hop over to the
method code and execute it, hop back and clean off the stack arguments, and
deal with the return value) and instead replace the method call with a copy of
the actual code in the method body. This eliminates the overhead of the method
call. Of course, if a method is big, then your code begins to bloat and you probably
won’t see any performance gains from inlining, since any improvements will be
dwarfed by the amount of time spent inside the method. It is implied that the
Java compiler is able to detect these situations and choose wisely whether to
inline a <b>final</b> method. However, it’s better to not trust that the
compiler is able to do this and make a method <b>final</b> only if it’s quite
small or if you want to explicitly prevent overriding.</span></p>

<h4><span lang=EN-US>final and private</span></h4>

<p class=MsoNormal><span
lang=EN-US>Any <b>private</b> methods in a class are implicitly <b>final</b>.
Because you can’t access a <b>private </b>method, you can’t override it (even
though the compiler doesn’t give an error message if you try to override it,
you haven’t overridden the method, you’ve just created a new method). You can
add the <b>final</b> specifier to a <b>private</b> method but it doesn’t give
that method any extra meaning.</span></p>

<p class=MsoNormal><span lang=EN-US>This issue can cause confusion, because if
you try to override a <b>private</b> method (which is implicitly <b>final</b>)<b>
</b>it seems to work:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c06:FinalOverridingIllusion.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// It only looks like
you can override</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// a private or private
final method.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class WithFinals {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Identical to
&quot;private&quot; alone:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private final void f()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;WithFinals.f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Also automatically
&quot;final&quot;:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private void g() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;WithFinals.g()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class OverridingPrivate
extends WithFinals {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private final void f()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;OverridingPrivate.f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private void g() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;OverridingPrivate.g()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class OverridingPrivate2
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  extends
OverridingPrivate {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public final void f()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;OverridingPrivate2.f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void g() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;OverridingPrivate2.g()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
FinalOverridingIllusion {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    OverridingPrivate2
op2 = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
OverridingPrivate2();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    op2.f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    op2.g();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // You can upcast:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    OverridingPrivate op
= op2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // But you can't
call the methods:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! op.f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! op.g();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Same here:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    WithFinals wf = op2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! wf.f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! wf.g();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>“Overriding” can only occur if something is
part of the base-class interface. That is, you must be able to upcast an object
to its base type and call the same method (the point of this will become clear
in the next chapter). If a method is <b>private</b>, it isn’t part of the
base-class interface. It is just some code that’s hidden away inside the class,
and it just happens to have that name, but if you create a <b>public</b>, <b>protected</b>
or “friendly” method in the derived class, there’s no connection to the method
that might happen to have that name in the base class. Since a <b>private </b>method
is unreachable and effectively invisible, it doesn’t factor into anything
except for the code organization of the class for which it was defined.</span></p>

<h3><a name="_Toc481064618"></a><a name="_Toc375545320"><span lang=EN-US>Final
classes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>When you say that an entire class is <b>final</b>
(by preceding its definition with the <b>final</b> keyword), you state that you
don’t want to inherit from this class or allow anyone else to do so. In other
words, for some reason the design of your class is such that there is never a
need to make any changes, or for safety or security reasons you don’t want
subclassing. Alternatively, you might be dealing with an efficiency issue, and
you want to make sure that any activity involved with objects of this class are
as efficient as possible.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:Jurassic.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Making an entire
class final.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class SmallBrain {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>final class Dinosaur {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = 7;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int j = 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  SmallBrain x = new
SmallBrain();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//! class Further
extends Dinosaur {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// error: Cannot extend
final class 'Dinosaur'</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Jurassic {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Dinosaur n = new
Dinosaur();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    n.f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    n.i = 40;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    n.j++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that the data members can be <b>final</b>
or not, as you choose. The same rules apply to <b>final</b> for data members
regardless of whether the class is defined as <b>final</b>. Defining the class
as <b>final</b> simply prevents inheritance—nothing more. However, because it
prevents </span><span lang=EN-US>inheritance all methods in a <b>final</b>
class are implicitly <b>final</b>, since there’s no way to override them. So
the compiler has the same efficiency options as it does if you explicitly
declare a method <b>final</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>You can add the <b>final</b> specifier to a
method in a <b>final</b> class, but it doesn’t add any meaning.</span></p>

<h3><a name="_Toc481064619"></a><a name="_Toc375545321"><span lang=EN-US>Final
caution</span></a></h3>

<p class=MsoNormal><span lang=EN-US>It can seem to be sensible to make a method
<b>final</b> while you’re designing a class. You might feel that </span><span lang=EN-US>efficiency is very important when using your class and that no one
could possibly want to override your methods anyway. Sometimes this is true.</span></p>

<p class=MsoNormal><span lang=EN-US>But be careful with your assumptions. In
general, it’s difficult to anticipate how a class can be reused, especially a
general-purpose class. If you define a method as <b>final</b> you might prevent
the possibility of reusing your class through inheritance in some other
programmer’s project simply because you couldn’t imagine it being used that
way.</span></p>

<p class=MsoNormal><span lang=EN-US>The standard Java library is a good example
of this. In particular, the Java 1.0/1.1 <b>Vector</b> class was commonly used
and might have been even more useful if, in the name of efficiency, all the
methods hadn’t been made <b>final</b>. It’s easily conceivable that you might
want to inherit and override with such a fundamentally useful class, but the
designers somehow decided this wasn’t appropriate. This is ironic for two
reasons. First, <b>Stack </b>is inherited from <b>Vector</b>, which says that a
<b>Stack </b><i>is</i> a <b>Vector</b>, which isn’t really true from a logical
standpoint. Second, many of the most important methods of <b>Vector</b>, such
as <b>addElement(&nbsp;) </b>and <b>elementAt(&nbsp;)</b> are <b>synchronized</b>.
As you will see in Chapter 14, this incurs a significant performance overhead
that probably wipes out any gains provided by <b>final</b>. This lends credence
to the theory that programmers are consistently bad at guessing where
optimizations should occur. It’s just too bad that such a clumsy design made it
into the standard library where we must all cope with it. (Fortunately, the
Java 2 container library replaces <b>Vector</b> with <b>ArrayList</b>, which
behaves much more civilly. Unfortunately, there’s still plenty of new code
being written that uses the old container library.)</span></p>

<p class=MsoNormal><span lang=EN-US>It’s also interesting to note that <b>Hashtable</b>,
another important standard library class, does <i>not</i> have any <b>final</b>
methods. As mentioned elsewhere in this book, it’s quite obvious that some
classes were designed by completely different people than others. (You’ll see
that the method names in <b>Hashtable</b> are much briefer compared to those in
<b>Vector</b>, another piece of evidence.) This is precisely the sort of thing
that should <i>not</i> be obvious to consumers of a class library. When things
are inconsistent it just makes more work for the user. Yet another paean to the
value of design and code walkthroughs. (Note that the Java 2 container library
replaces <b>Hashtable</b> with <b>HashMap</b>.)</span></p>

<h2><a name="_Toc481064620"></a><a name="_Toc375545322"><span lang=EN-US>Initialization
and <br>
class loading</span></a></h2>

<p class=MsoNormal><span lang=EN-US>In more traditional languages, programs are loaded all at once as
part of the startup process. This is followed by initialization, and then the
program begins. The process of initialization in these languages must be
carefully controlled so that the order of initialization of <b>static</b>s
doesn’t cause trouble. C++, for example, has problems if one <b>static</b>
expects another <b>static </b>to be valid before the second one has been
initialized.</span></p>

<p class=MsoNormal><span lang=EN-US>Java doesn’t have this problem because it
takes a different approach to loading. Because everything in Java is an object,
many activities become easier, and this is one of them. As you will learn more
fully in the next chapter, the compiled code for each class exists in its own
separate file. That file isn’t loaded until the code is needed. In general, you
can say that “Class code is loaded at the point of first use.” This is often
not until the first object of that class is constructed, but loading also
occurs when a <b>static </b>field or <b>static</b> method is accessed.</span></p>

<p class=MsoNormal><span lang=EN-US>The point of first use is also where the <b>static</b>
initialization takes place. All the <b>static</b> objects and the <b>static</b>
code block will be initialized in textual </span><span
lang=EN-US>order (that is, the order that you write them down in the class
definition) at the point of loading. The <b>static</b>s, of course, are
initialized only once.</span></p>

<h3><a name="_Toc481064621"></a><a name="_Toc375545323"><span lang=EN-US>Initialization
with inheritance</span></a></h3>

<p class=MsoNormal><span lang=EN-US>It’s helpful to look at the whole </span><span lang=EN-US>initialization process, including inheritance, to get a full picture
of what happens. Consider the following code:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c06:Beetle.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The full process of
initialization.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Insect {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = 9;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int j;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Insect() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;i = &quot;
+ i + &quot;, j = &quot; + j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    j = 39;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int x1 = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;static
Insect.x1 initialized&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int prt(String
s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return 47;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Beetle extends
Insect {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int k =
prt(&quot;Beetle.k initialized&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Beetle() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;k = &quot;
+ k);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;j = &quot;
+ j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int x2 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;static
Beetle.x2 initialized&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;Beetle
constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Beetle b = new
Beetle();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output for this program is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>static Insect.x1
initialized</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>static Beetle.x2
initialized</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Beetle constructor</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>i = 9, j = 0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Beetle.k initialized</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>k = 47</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>j = 39</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The first thing that happens when you run
Java on <b>Beetle</b> is that you try to access <b>Beetle.main(&nbsp;) </b>(a <b>static
</b>method), so the loader goes out and finds the compiled code for the <b>Beetle</b>
</span><span lang=EN-US>class (this happens to be in a file called <b>Beetle.class</b>).
In the process of loading it, the loader notices that it has a base class
(that’s what the <b>extends </b>keyword says), which it then loads. This will
happen whether or not you’re going to make an object of that base class. (Try
commenting out the object creation to prove it to yourself.)</span></p>

<p class=MsoNormal><span lang=EN-US>If the base class has a base class, that
second base class would then be loaded, and so on. Next, the </span><span lang=EN-US><b>static</b> initialization in the root base class (in this case, <b>Insect</b>)
is performed, and then the next derived class, and so on. This is important
because the derived-class static initialization might depend on the base class
member being initialized properly.</span></p>

<p class=MsoNormal><span lang=EN-US>At this point, the necessary classes have
all been loaded so the object can be created. First, all the primitives in this
object are set to their default values and the object references are set to <b>null</b>—this
happens in one fell swoop by setting the memory in the object to binary zero.<b>
</b>Then the base-class constructor will be called. In this case the call is
automatic, but you can also specify the base-class constructor call (as the
first operation in the <b>Beetle(&nbsp;)</b> constructor) using <b>super</b>.
The base class construction goes through the same process in the same order as
the derived-class constructor. After the base-class constructor completes, the
instance variables are initialized in textual order. Finally, the rest of the
body of the constructor is executed.</span></p>

<h2><a name="_Toc481064622"></a><a name="_Toc375545324"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Both inheritance and composition allow you
to create a new type from existing types. Typically, however, you use
composition to reuse existing types as part of the underlying implementation of
the new type, and inheritance when you want to reuse the interface. Since the
derived class has the base-class interface, it can be <i>upcast</i> to the base,
which is critical for polymorphism, as you’ll see in the next chapter. </span></p>

<p class=MsoNormal><span lang=EN-US>Despite the strong emphasis on inheritance
in object-oriented programming, when you start a design you should generally
prefer composition during the first cut and use inheritance only when it is
clearly necessary. Composition tends to be more flexible. In addition, by using
the added artifice of inheritance with your member type, you can change the
exact type, and thus the behavior, of those member objects at run-time.
Therefore, you can change the behavior of the composed object at run-time.</span></p>

<p class=MsoNormal><span lang=EN-US>Although code reuse through composition and
inheritance is helpful for rapid project development, you’ll generally want to </span><span lang=EN-US>redesign your class hierarchy before allowing other programmers to
become dependent on it. Your goal is a hierarchy in which each class has a
specific use and is neither too big (encompassing so much functionality that
it’s unwieldy to reuse) nor annoyingly small (you can’t use it by itself or
without adding functionality).</span></p>

<h2><a name="_Toc481064623"></a><a name="_Toc375545325"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create two classes, <b>A</b> and <b>B</b>, with
default constructors (empty argument lists) that announce themselves. Inherit a
new class called <b>C</b> from <b>A</b>, and create a member of class <b>B</b>
inside <b>C</b>. Do not create a constructor for <b>C</b>. Create an object of
class <b>C</b> and observe the results.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>54. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 1 so that <b>A</b> and <b>B</b>
have constructors with arguments instead of default constructors. Write a
constructor for <b>C</b> and perform all initialization within <b>C</b>’s
constructor. </span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>55. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a simple class. Inside a second class,
define a field for an object of the first class. Use lazy initialization to
instantiate this object.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>56. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Inherit a new class from class <b>Detergent</b>.
Override <b>scrub(&nbsp;)</b> and add a new method called <b>sterilize(&nbsp;)</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>57. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Take the file <b>Cartoon.java</b> and comment
out the constructor for the <b>Cartoon</b> class. Explain what happens.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>58. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Take the file <b>Chess.java</b> and comment out
the constructor for the <b>Chess</b> class. Explain what happens.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>59. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Prove that default constructors are created for
you by the compiler.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>60. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Prove that the base-class constructors are (a)
always called, and (b) called before derived-class constructors.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>61. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a base class with only a nondefault
constructor, and a derived class with both a default and nondefault
constructor. In the derived-class constructors, call the base-class
constructor.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>62. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class called <b>Root</b> that contains
an instance of each of classes (that you also create) named <b>Component1</b>, <b>Component2</b>,<b>
</b>and <b>Component3</b>. Derive a class <b>Stem</b> from <b>Root</b> that
also contains an instance of each “component.” All classes should have default
constructors that print a message about that class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>63. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 10 so that each class only has
nondefault constructors.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>64. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add a proper hierarchy of <b>cleanup(&nbsp;)</b>
methods to all the classes in Exercise 11.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>65. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with a method that is overloaded
three times. Inherit a new class, add a new overloading of the method, and show
that all four methods are available in the derived class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>66. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In <b>Car.java</b> add a <b>service(&nbsp;)</b>
method to <b>Engine</b> and call this method in <b>main(&nbsp;)</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>67. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class inside a package. Your class
should contain a <b>protected</b> method. Outside of the package, try to call
the <b>protected</b> method and explain the results. Now inherit from your
class and call the <b>protected</b> method from inside a method of your derived
class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>68. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class called <b>Amphibian</b>. From
this, inherit a class called <b>Frog</b>. Put appropriate methods in the base
class. In <b>main(&nbsp;)</b>, create a <b>Frog</b> and upcast it to <b>Amphibian</b>,
and demonstrate that all the methods still work.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>69. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 16 so that <b>Frog</b> overrides
the method definitions from the base class (provides new definitions using the
same method signatures). Note what happens in <b>main(&nbsp;)</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>70. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with a <b>static final</b> field
and a <b>final</b> field and demonstrate the difference between the two.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>71. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with a blank <b>final</b>
reference to an object. Perform the initialization of the blank <b>final</b>
inside a method (not the constructor) right before you use it. Demonstrate the
guarantee that the <b>final</b> must be initialized before use, and that it
cannot be changed once initialized.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>72. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with a <b>final</b> method.
Inherit from that class and attempt to override that method.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>73. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a <b>final</b> class and attempt to
inherit from it.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>74. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Prove that class loading takes place only once.
Prove that loading may be caused by either the creation of the first instance
of that class, or the access of a <b>static</b> member.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>75. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In <b>Beetle.java</b>, inherit a specific type
of  beetle from class <b>Beetle</b>, following the same format as the existing
classes. Trace and explain the output.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection13>

<h1><a name="_Toc481064624"></a><a name="_Toc477690727"></a><a
name="_Toc375545326"></a><a name="Chapter_7"></a><span lang=EN-US>7:
Polymorphism</span></h1>

<p class=Intro><a name=A></a><span lang=EN-US>Polymorphism is the third
essential feature of an object-oriented programming language, after data
abstraction and inheritance. </span></p>

<p class=MsoNormal><span lang=EN-US>It provides another dimension of separation
of interface from implementation, to decouple <i>what</i> from <i>how</i>.
Polymorphism allows improved code organization and readability as well as the
creation of <i>extensible</i> programs that can be “grown” not only during the
original creation of the project but also when new features are desired.</span></p>

<p class=MsoNormal><span lang=EN-US>Encapsulation creates new data types by
combining characteristics and behaviors. Implementation hiding separates the
interface from the implementation by making the details <b>private</b>. This
sort of mechanical organization makes ready sense to someone with a procedural
programming background. But polymorphism deals with </span><span
lang=EN-US>decoupling in terms of <i>types</i>. In the last chapter, you saw
how </span><span lang=EN-US>inheritance allows the treatment of an object as
its own type <i>or</i> its base type. This ability is critical because it
allows many types (derived from the same base type) to be treated as if they
were one type, and a single piece of code to work on all those different types
equally. The </span><span
lang=EN-US>polymorphic method call allows one type to express its distinction
from another, similar type, as long as they’re both derived from the same base
type. This distinction is expressed through differences in behavior of the
methods that you can call through the base class.</span></p>

<p class=MsoNormal><span lang=EN-US>In this chapter, you’ll learn about
polymorphism (also called </span><span lang=EN-US><i>dynamic binding</i> or <i>late binding</i> or <i>run-time binding</i>)<i>
</i>starting from the basics, with simple examples that strip away everything
but the polymorphic behavior of the program.</span></p>

<h2><a name="_Toc481064625"></a><a name="_Toc375545327"></a><a
name="_Toc312374040"></a><a name="_Toc305628735"></a><a name="_Toc305593263"><span
lang=EN-US>Upcasting</span></a><span lang=EN-US> revisited</span></h2>

<p class=MsoNormal><span lang=EN-US>In Chapter 6 you saw how an object can be
used as its own type or as an object of its base type. Taking an object
reference and treating it as a reference to its base type is called <i>upcasting,</i></span><span lang=EN-US> because of the way inheritance trees are drawn with the base class
at the top.</span></p>

<p class=MsoNormal><span lang=EN-US>You also saw a problem arise, which is
embodied in the following:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c07:music:Music.java
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Inheritance &amp;
upcasting.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Note {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int value;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Note(int val) {
value = val; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static final
Note</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MIDDLE_C = new
Note(0), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    C_SHARP  = new
Note(1),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    B_FLAT   = new
Note(2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} // Etc.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play(Note
n) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Instrument.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Wind objects are
instruments</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// because they have the
same interface:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Wind extends
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Redefine interface
method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play(Note
n) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Wind.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Music {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
tune(Instrument i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
i.play(Note.MIDDLE_C);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Wind flute = new
Wind();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    tune(flute); //
Upcasting</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The method <b>Music.tune(&nbsp;)</b>
accepts an <b>Instrument </b>reference, but also anything derived from <b>Instrument</b>.
In <b>main(&nbsp;)</b>, you can see this happening as a <b>Wind</b> reference
is passed to <b>tune(&nbsp;)</b>, with no cast necessary. This is acceptable;
the interface in <b>Instrument</b> must exist in <b>Wind</b>, because <b>Wind</b>
is inherited from <b>Instrument</b>. Upcasting from <b>Wind</b> to <b>Instrument</b>
may “narrow” that interface, but it cannot make it anything less than the full
interface to <b>Instrument</b>.</span></p>

<h3><a name="_Toc481064626"><span lang=EN-US>Forgetting the object type</span></a></h3>

<p class=MsoNormal><span lang=EN-US>This program might seem strange to you. Why
should anyone intentionally <i>forget</i> the type of an object? This is what
happens when you upcast, and it seems like it could be much more
straightforward if <b>tune(&nbsp;)</b> simply takes a <b>Wind</b> reference as
its argument. This brings up an essential point: If you did that, you’d need to
write a new <b>tune(&nbsp;)</b> for every type of <b>Instrument</b> in your
system. Suppose we follow this reasoning and add <b>Stringed</b> and <b>Brass</b>
instruments:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c07:music2:Music2.java </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Overloading instead
of upcasting.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Note {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int value;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Note(int val)
{ value = val; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static final
Note</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MIDDLE_C = new
Note(0), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    C_SHARP = new
Note(1),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    B_FLAT = new
Note(2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} // Etc.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play(Note
n) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Instrument.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Wind extends
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play(Note
n) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Wind.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Stringed extends
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play(Note
n) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Stringed.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Brass extends
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play(Note
n) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Brass.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Music2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
tune(Wind i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
i.play(Note.MIDDLE_C);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
tune(Stringed i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
i.play(Note.MIDDLE_C);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
tune(Brass i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
i.play(Note.MIDDLE_C);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Wind flute = new
Wind();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Stringed violin =
new Stringed();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Brass frenchHorn =
new Brass();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    tune(flute); // No
upcasting</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    tune(violin);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    tune(frenchHorn);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This works, but there’s a major drawback:
You must write type-specific methods for each new <b>Instrument</b> class you
add. This means more programming in the first place, but it also means that if
you want to add a new method like <b>tune(&nbsp;)</b> or a new type of <b>Instrument</b>,
you’ve got a lot of work to do. Add the fact that the compiler won’t give you
any error messages if you forget to overload one of your methods and the whole
process of working with types becomes unmanageable.</span></p>

<p class=MsoNormal><span lang=EN-US>Wouldn’t it be much nicer if you could just
write a single method that takes the </span><span lang=EN-US>base class as its argument, and not any of the specific derived
classes? That is, wouldn’t it be nice if you could forget that there are </span><span lang=EN-US>derived classes, and write your code to talk only to the base class?</span></p>

<p class=MsoNormal><span lang=EN-US>That’s exactly what polymorphism allows you
to do. However, most programmers who come from a procedural programming
background have a bit of trouble with the way polymorphism works.</span></p>

<h2><a name="_Toc481064627"></a><a name="_Toc375545329"></a><a
name="_Toc312374041"></a><a name="_Toc305628736"></a><a name="_Toc305593264"><span
lang=EN-US>The </span></a><span lang=EN-US>twist</span></h2>

<p class=MsoNormal><span lang=EN-US>The difficulty with <b>Music</b>.<b>java</b>
can be seen by running the program. The output is <b>Wind.play(&nbsp;)</b>.
This is clearly the desired output, but it doesn’t seem to make sense that it
would work that way. Look at the <b>tune(&nbsp;)</b> method:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
tune(Instrument i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
i.play(Note.MIDDLE_C);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It receives an <b>Instrument</b> reference.
So how can the compiler possibly know that this <b>Instrument</b> reference
points to a <b>Wind</b> in this case and not a <b>Brass </b>or <b>Stringed</b>?
The compiler can’t. To get a deeper understanding of the issue, it’s helpful to
examine the subject of <i>binding</i>.</span></p>

<h3><a name="_Toc481064628"></a><a name="_Toc375545330"></a><a
name="_Toc312374042"><span lang=EN-US>Method-call binding</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Connecting a method call to a method body is called <i>binding</i>.
When binding is performed before the program is run (by the compiler and
linker, if there is one), it’s called <i>early binding</i></span><span lang=EN-US>. You might not have heard the term before because it has never been
an option with procedural languages. C compilers have only one kind of method
call, and that’s early binding.</span></p>

<p class=MsoNormal><span lang=EN-US>The confusing part of the above program
revolves around early binding because the compiler cannot know the correct
method to call when it has only an <b>Instrument</b> reference.</span></p>

<p class=MsoNormal><span lang=EN-US>The solution is called <i>late binding</i></span><span lang=EN-US>, which means that the binding occurs at run-time based on the type
of object. Late binding is also called <i>dynamic binding</i></span><span lang=EN-US> or <i>run-time binding</i></span><span lang=EN-US>. When a language implements late binding, there must be some
mechanism to determine the type of the object at run-time and to call the
appropriate method. That is, the compiler still doesn’t know the object type,
but the method-call mechanism finds out and calls the correct method body. The
late-binding mechanism varies from language to language, but you can imagine
that some sort of type information must be installed in the objects.</span></p>

<p class=MsoNormal><span lang=EN-US>All method binding in Java uses late
binding unless a method has been declared </span><span lang=EN-US><b>final</b>. This means that ordinarily you don’t need to make any
decisions about whether late binding will occur—it happens automatically.</span></p>

<p class=MsoNormal><span lang=EN-US>Why would you declare a method <b>final</b>?
As noted in the last chapter, it prevents anyone from overriding that method.
Perhaps more important, it effectively “turns off” dynamic binding, or rather
it tells the compiler that dynamic binding isn’t necessary. This allows the
compiler to generate slightly more efficient code for <b>final</b> method
calls. However, in most cases it won’t make any overall performance difference
in your program, so it’s best to only use <b>final</b> as a design decision,
and not as an attempt to improve performance.</span></p>

<h3><a name="_Toc481064629"></a><a name="_Toc375545331"><span lang=EN-US>Producing
the right behavior</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Once you know that all method binding in
Java happens polymorphically via late binding, you can write your code to talk
to the base class and know that all the derived-class cases will work correctly
using the same code. Or to put it another way, you “send a message to an object
and let the object figure out the right thing to do.”</span></p>

<p class=MsoNormal><span lang=EN-US>The classic example in OOP is the “</span><span lang=EN-US>shape” example. This is commonly used because it is easy to
visualize, but unfortunately it can confuse novice programmers into thinking
that OOP is just for graphics programming, which is of course not the case.</span></p>

<p class=MsoNormal><span lang=EN-US>The shape example has a base class called <b>Shape
</b>and various derived types: <b>Circle</b>, <b>Square</b>, <b>Triangle</b>,
etc. The reason the example works so well is that it’s easy to say “a circle is
a type of shape” and be understood.<b> </b>The inheritance diagram shows the
relationships:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=445 height=238 src="TIJ2_files/image018.png"></span></p>

<p class=MsoNormal style='margin-top:6.0pt'><span lang=EN-US>The upcast could
occur in a statement as simple as:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Shape s = new
Circle();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Here, a <b>Circle</b> object is created and
the resulting reference is immediately assigned to a <b>Shape</b>, which would
seem to be an error (assigning one type to another); and yet it’s fine because
a <b>Circle</b> <i>is</i> a <b>Shape</b> by inheritance. So the compiler agrees
with the statement and doesn’t issue an error message.</span></p>

<p class=MsoNormal><span lang=EN-US>Suppose you call one of the base-class
methods (that have been overridden in the derived classes):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>s.draw();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Again, you might expect that <b>Shape</b>’s
<b>draw(&nbsp;)</b> is called because this is, after all, a <b>Shape</b>
reference—so how could the compiler know to do anything else? And yet the
proper <b>Circle.draw(&nbsp;)</b> is called because of late binding (polymorphism).</span></p>

<p class=MsoNormal><span lang=EN-US>The following example puts it a slightly
different way:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c07:Shapes.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Polymorphism in Java.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Shape { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void draw() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void erase() {} </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Circle extends
Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void draw() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Circle.draw()&quot;); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void erase() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Circle.erase()&quot;); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Square extends
Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void draw() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Square.draw()&quot;); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void erase() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Square.erase()&quot;);
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Triangle extends
Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void draw() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Triangle.draw()&quot;); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void erase() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Triangle.erase()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Shapes {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static Shape
randShape() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    switch((int)(Math.random()
* 3)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      default:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 0: return new
Circle();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 1: return new
Square();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 2: return new
Triangle();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Shape[] s = new
Shape[9];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Fill up the array
with shapes:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; s.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s[i] =
randShape();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Make polymorphic
method calls:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; s.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s[i].draw();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The base class <b>Shape</b> establishes the
common interface to anything inherited from <b>Shape</b>—that is, all shapes
can be drawn and erased. The derived classes override these definitions to
provide unique behavior for each specific type of shape.</span></p>

<p class=MsoNormal><span lang=EN-US>The main class <b>Shapes</b> contains a <b>static</b>
method <b>randShape(&nbsp;)</b> that produces a reference to a
randomly-selected <b>Shape</b> object each time you call it. Note that the
upcasting happens in each of the <b>return</b> statements, which take a
reference to a <b>Circle</b>, <b>Square</b>, or <b>Triangle</b> and sends it
out of the method as the return type, <b>Shape</b>. So whenever you call this
method you never get a chance to see what specific type it is, since you always
get back a plain <b>Shape</b> reference.</span></p>

<p class=MsoNormal><b><span lang=EN-US>main(&nbsp;)</span></b><span lang=EN-US>
contains an array of <b>Shape</b> references filled through calls to <b>randShape(&nbsp;)</b>.
At this point you know you have <b>Shape</b>s, but you don’t know anything more
specific than that (and neither does the compiler). However, when you step
through this array and call <b>draw(&nbsp;)</b> for each one, the correct
type-specific behavior magically occurs, as you can see from one output
example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Circle.draw()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Triangle.draw()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Circle.draw()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Circle.draw()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Circle.draw()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Square.draw()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Triangle.draw()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Square.draw()</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Square.draw()</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, since the shapes are all chosen
randomly each time, your runs will have different results. The point of
choosing the shapes randomly is to drive home the understanding that the
compiler can have no special knowledge that allows it to make the correct calls
at compile-time. All the calls to <b>draw(&nbsp;)</b> are made through dynamic
binding.</span></p>

<h3><a name="_Toc481064630"></a><a name="_Toc375545332"><span lang=EN-US>Extensibility</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Now let’s return to the musical instrument
example. Because of polymorphism, you can add as many new types as you want to
the system without changing the <b>tune(&nbsp;)</b> method. In a well-designed
OOP program, most or all of your methods will follow the model of <b>tune(&nbsp;)</b>
and communicate only with the base-class interface</span><span lang=EN-US>. Such a program is <i>extensible</i></span><span
lang=EN-US> because you can add new functionality by inheriting new data types
from the common base class. The methods that manipulate the base-class
interface will not need to be changed at all to accommodate the new classes.</span></p>

<p class=MsoNormal><span lang=EN-US>Consider what happens if you take the
instrument example and add more methods in the base class and a number of new
classes. Here’s the diagram:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=376 height=412 src="TIJ2_files/image019.png"></span></p>

<p class=MsoNormal><span lang=EN-US>All these new classes work correctly with
the old, unchanged <b>tune(&nbsp;)</b> method. Even if <b>tune(&nbsp;)</b> is
in a separate file and new methods are added to the interface of <b>Instrument</b>,
<b>tune(&nbsp;)</b> works correctly without recompilation. Here is the implementation
of the above diagram:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c07:music3:Music3.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// An extensible
program.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Instrument.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
&quot;Instrument&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Wind extends
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Wind.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {
return &quot;Wind&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Percussion extends
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Percussion.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {
return &quot;Percussion&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Stringed extends
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Stringed.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {
return &quot;Stringed&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Brass extends Wind
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Brass.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Brass.adjust()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Woodwind extends
Wind {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Woodwind.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {
return &quot;Woodwind&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Music3 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Doesn't care about
type, so new types</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // added to the system
still work right:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
tune(Instrument i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i.play();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
tuneAll(Instrument[] e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; e.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      tune(e[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Instrument[]
orchestra = new Instrument[5];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Upcasting during
addition to the array:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Wind();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Percussion();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Stringed();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Brass();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Woodwind();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    tuneAll(orchestra);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The new methods are <b>what(&nbsp;)</b>,
which returns a <b>String</b> reference with a description of the class, and <b>adjust(&nbsp;)</b>,
which provides some way to adjust each instrument.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>main(&nbsp;)</b>, when you place
something inside the <b>Instrument </b>array you automatically upcast to <b>Instrument</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the <b>tune(&nbsp;)</b>
method is blissfully ignorant of all the code changes that have happened around
it, and yet it works correctly. This is exactly what polymorphism is supposed
to provide. Your code changes don’t cause damage to parts of the program that
should not be affected. Put another way, polymorphism is one of the most
important techniques that allow the programmer to “separate the things that
change from the things that stay the same.”</span></p>

<h2><a name="_Toc481064631"></a><a name="_Toc375545333"><span lang=EN-US>Overriding
vs. overloading</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Let’s take a different look at the first example in this chapter. In
the following program, the interface of the method <b>play(&nbsp;)</b> is
changed in the process of overriding it, which means that you haven’t <i>overridden</i>
the method, but instead <i>overloaded </i>it. The compiler allows you to
overload methods so it gives no complaint. But the behavior is probably not
what you want. Here’s the example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c07:WindError.java </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Accidentally changing
the interface.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class NoteX {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static final
int</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MIDDLE_C = 0,
C_SHARP = 1, C_FLAT = 2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class InstrumentX {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play(int
NoteX) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;InstrumentX.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class WindX extends
InstrumentX {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // OOPS! Changes the
method interface:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play(NoteX
n) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;WindX.play(NoteX n)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class WindError {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
tune(InstrumentX i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
i.play(NoteX.MIDDLE_C);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    WindX flute = new
WindX();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    tune(flute); // Not
the desired behavior!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>There’s another confusing aspect thrown in
here. In <b>InstrumentX</b>, the <b>play(&nbsp;)</b> method takes an <b>int</b>
that has the identifier <b>NoteX</b>. That is, even though <b>NoteX</b> is a
class name, it can also be used as an identifier without complaint. But in <b>WindX</b>,
<b>play(&nbsp;)</b> takes a <b>NoteX</b> reference that has an identifier <b>n.</b>
(Although you could even say <b>play(NoteX NoteX)</b> without an error.) Thus
it appears that the programmer intended to override <b>play(&nbsp;)</b> but
mistyped the method a bit. The compiler, however, assumed that an overload and
not an override was intended. Note that if you follow the standard Java naming
convention, the argument identifier would be <b>noteX</b> (lowercase ‘n’),
which would distinguish it from the class name.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>tune</b>, the <b>InstrumentX</b> <b>i</b>
is sent the <b>play(&nbsp;)</b> message, with one of <b>NoteX</b>’s members (<b>MIDDLE_C</b>)
as an argument. Since <b>NoteX</b> contains <b>int</b> definitions, this means
that the <b>int</b> version of the now-overloaded <b>play(&nbsp;)</b> method is
called, and since that has <i>not</i> been overridden the base-class version is
used.</span></p>

<p class=MsoNormal><span lang=EN-US>The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>InstrumentX.play()</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This certainly doesn’t appear to be a
polymorphic method call. Once you understand what’s happening, you can fix the
problem fairly easily, but imagine how difficult it might be to find the bug if
it’s buried in a program of significant size.</span></p>

<h2><a name="_Toc481064632"></a><a name="_Toc375545334"><span lang=EN-US>Abstract
classes <br>
and methods</span></a></h2>

<p class=MsoNormal><span lang=EN-US>In all the instrument examples, the methods
in the base class <b>Instrument</b> were always “dummy” methods. If these
methods are ever called, you’ve done something wrong. That’s because the intent
of <b>Instrument</b> is to create a <i>common interface</i> for all the classes
derived from it.</span></p>

<p class=MsoNormal><span lang=EN-US>The only reason to establish this common
interface</span><span lang=EN-US> is so it can be expressed differently for
each different subtype. It establishes a basic form, so you can say what’s in
common with all the derived classes. Another way of saying this is to call <b>Instrument</b>
an <i>abstract base class</i> </span><span lang=EN-US>(or simply an <i>abstract class</i>). You create an abstract class
when you want to manipulate a set of classes through this common interface. All
derived-class methods that match the signature of the base-class declaration will
be called using the dynamic binding mechanism. (However, as seen in the last
section, if the method’s name is the same as the base class but the arguments
are different, you’ve got overloading, which probably isn’t what you want.)</span></p>

<p class=MsoNormal><span lang=EN-US>If you have an abstract class like <b>Instrument</b>,
objects of that class almost always have no meaning. That is, <b>Instrument</b>
is meant to express only the interface, and not a particular implementation, so
creating an <b>Instrument</b> object makes no sense, and you’ll probably want
to prevent the user from doing it. This can be accomplished by making all the
methods in <b>Instrument</b> print error messages, but that delays the
information until run-time and requires reliable exhaustive testing on the
user’s part. It’s always better to catch problems at compile-time.</span></p>

<p class=MsoNormal><span lang=EN-US>Java provides a mechanism for doing this
called the <i>abstract method</i></span><a href="#_ftn37" name="_ftnref37"
title=""><span class=MsoFootnoteReference><span lang=EN-US style='font-size:
8.0pt'><span class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;
font-family:"Georgia","serif"'>[37]</span></span></span></span></a><span
lang=EN-US>. This is a method that is incomplete; it has only a declaration and
no method body. Here is the syntax for an abstract method declaration:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>abstract void f();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>A class containing abstract methods is
called an <i>abstract class</i>. If a class contains one or more abstract
methods, the class must be qualified as <b>abstract</b>. (Otherwise, the
compiler gives you an error message.)</span></p>

<p class=MsoNormal><span lang=EN-US>If an abstract class is incomplete, what is
the compiler supposed to do when someone tries to make an object of that class?
It cannot safely create an object of an abstract class, so you get an error
message from the compiler. This way the compiler ensures the purity of the
abstract class, and you don’t need to worry about misusing it.</span></p>

<p class=MsoNormal><span lang=EN-US>If you </span><span lang=EN-US>inherit from an abstract class and you want to make objects of the
new type, you must provide method definitions for all the abstract methods in
the base class. If you don’t (and you may choose not to), then the derived
class is also abstract and the compiler will force you to qualify <i>that</i>
class with the </span><span lang=EN-US><b>abstract</b> keyword.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s possible to create a class as <b>abstract</b>
without including any <b>abstract</b> methods. This is useful when you’ve got a
class in which it doesn’t make sense to have any <b>abstract</b> methods, and
yet you want to prevent any instances of that class.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Instrument</b> class can easily be
turned into an <b>abstract</b> class. Only some of the methods will be <b>abstract</b>,
since making a class abstract doesn’t force you to make all the methods <b>abstract</b>.<b>
</b>Here’s what it looks like:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=367 height=403 src="TIJ2_files/image020.png"></span></p>

<p class=MsoNormal><span lang=EN-US>Here’s the orchestra example modified to
use <b>abstract</b> classes and methods:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c07:music4:Music4.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Abstract classes and
methods.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>abstract class
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i; // storage
allocated for each</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public abstract void
play();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
&quot;Instrument&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public abstract void
adjust();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Wind extends
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Wind.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {
return &quot;Wind&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Percussion extends
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Percussion.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {
return &quot;Percussion&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Stringed extends
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Stringed.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {
return &quot;Stringed&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Brass extends Wind
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Brass.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust() {
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Brass.adjust()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Woodwind extends
Wind {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Woodwind.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {
return &quot;Woodwind&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Music4 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Doesn't care about
type, so new types</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // added to the system
still work right:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
tune(Instrument i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i.play();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
tuneAll(Instrument[] e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; e.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      tune(e[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Instrument[]
orchestra = new Instrument[5];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Upcasting during
addition to the array:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Wind();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Percussion();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Stringed();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Brass();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Woodwind();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    tuneAll(orchestra);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that there’s really no change
except in the base class.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s helpful to create <b>abstract </b>classes
and methods because they make the abstractness of a class explicit, and tell
both the user and the compiler how it was int<a name="_Toc375545338">ended to
be used.</a></span></p>

<h2><a name="_Toc481064633"><span lang=EN-US>Constructors and polymorphism</span></a></h2>

<p class=MsoNormal><span lang=EN-US>As usual, </span><span lang=EN-US>constructors are different from other kinds of methods. This is also
true when polymorphism is involved. Even though constructors are not
polymorphic (although you can have a kind of “virtual constructor,” as you will
see in Chapter 12), it’s important to understand the way constructors work in
complex hierarchies and with polymorphism. This understanding will help you
avoid unpleasant entanglements.</span></p>

<h3><a name="_Toc481064634"></a><a name="_Toc375545339"><span lang=EN-US>Order
of constructor calls</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>The order of constructor calls was briefly discussed in Chapter 4
and again in Chapter 6, but that was before polymorphism was introduced. </span></p>

<p class=MsoNormal><span lang=EN-US>A constructor for the base class is always
called in the constructor for a derived class, chaining up the inheritance
hierarchy so that a constructor for every base class is called. This makes
sense because the constructor has a special job: to see that the object is
built properly. A derived class has access to its own members only, and not to
those of the base class (whose members are typically <b>private</b>). Only the
base-class constructor has the proper knowledge and access to initialize its
own elements. Therefore, it’s essential that all constructors get called,
otherwise the entire object wouldn’t be constructed. That’s why the compiler
enforces a constructor call for every portion of a derived class. It will
silently call the default constructor if you don’t explicitly call a base-class
constructor in the derived-class constructor body. If there is no default
constructor, the compiler will complain. (In the case where a class has no
constructors, the compiler will automatically synthesize a default constructor.)</span></p>

<p class=MsoNormal><span lang=EN-US>Let’s take a look at an example that shows
the effects of composition, inheritance, and polymorphism on the order of
construction:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c07:Sandwich.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Order of constructor
calls.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Meal {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Meal() {
System.out.println(&quot;Meal()&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Bread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Bread() {
System.out.println(&quot;Bread()&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Cheese {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Cheese() {
System.out.println(&quot;Cheese()&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Lettuce {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Lettuce() {
System.out.println(&quot;Lettuce()&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Lunch extends Meal
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Lunch() {
System.out.println(&quot;Lunch()&quot;);}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class PortableLunch
extends Lunch {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  PortableLunch() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;PortableLunch()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Sandwich extends
PortableLunch {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Bread b = new Bread();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Cheese c = new
Cheese();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Lettuce l = new
Lettuce();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Sandwich() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Sandwich()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new Sandwich();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This example creates a complex class out of
other classes, and each class has a constructor that announces itself. The
important class is <b>Sandwich</b>, which reflects three levels of inheritance
(four, if you count the implicit inheritance from <b>Object</b>) and three
member objects. When a <b>Sandwich</b> object is created in <b>main(&nbsp;)</b>,
the output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Meal()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Lunch()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>PortableLunch()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Bread()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Cheese()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Lettuce()</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Sandwich()</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This means that the order of constructor
calls for a complex object is as follows: </span></p>

<p class=Numbered><span lang=EN-US>The base-class constructor is called. This
step is repeated recursively such that the root of the hierarchy is constructed
first, followed by the next-derived class, etc., until the most-derived class
is reached.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>38.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Member initializers are called in the order of declaration.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>39.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>The body of the derived-class constructor is called.</span></p>

<p class=MsoNormal><span lang=EN-US>The order of the constructor calls is
important. When you inherit, you know all about the base class and can access
any <b>public</b> and <b>protected</b> members of the base class. This means
that you must be able to assume that all the members of the base class are
valid when you’re in the derived class. In a normal method, construction has
already taken place, so all the members of all parts of the object have been built.
<span style='text-transform:uppercase'>i</span>nside the constructor, however,
you must be able to assume that all members that you use have been built. The
only way to guarantee this is for the base-class constructor to be called
first. Then when you’re in the derived-class constructor, all the members you
can access in the base class have been initialized. “Knowing that all members
are valid” inside the constructor is also the reason that, whenever possible,
you should initialize all member objects (that is, objects placed in the class
using composition) at their point of definition in the class (e.g., <b>b</b>, <b>c,</b>
and <b>l</b> in the example above). If you follow this practice, you will help
ensure that all base class members <i>and</i> member objects of the current
object have been initialized. Unfortunately, this doesn’t handle every case, as
you will see in the next section.</span></p>

<h3><a name="_Toc481064635"><span lang=EN-US>Inheritance and <b>finalize(&nbsp;)</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>When you use composition to create a new
class, you never worry about finalizing the member objects of that class. Each
member is an independent object, and thus is </span><span
lang=EN-US>garbage collected and finalized regardless of whether it happens to
be a member of your class. With inheritance, however, you must override </span><span lang=EN-US><b>finalize(&nbsp;)</b> in the derived class if you have any special
cleanup that must happen as part of garbage collection. When you override <b>finalize(&nbsp;)</b>
in an inherited class, it’s important to remember to call the base-class
version of <b>finalize(&nbsp;)</b>, since otherwise the base-class finalization
will not happen. The following example proves this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c07:Frog.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Testing finalize with
inheritance.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class DoBaseFinalization
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static boolean
flag = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Characteristic {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Characteristic(String
c) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s = c;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Creating
Characteristic &quot; + s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected void
finalize() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;finalizing
Characteristic &quot; + s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class LivingCreature {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Characteristic p = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Characteristic(&quot;is alive&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  LivingCreature() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;LivingCreature()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected void
finalize() throws Throwable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;LivingCreature finalize&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Call base-class
version LAST!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(DoBaseFinalization.flag)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super.finalize();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Animal extends
LivingCreature {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Characteristic p = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Characteristic(&quot;has heart&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Animal() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Animal()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected void
finalize() throws Throwable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Animal finalize&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(DoBaseFinalization.flag)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super.finalize();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Amphibian extends
Animal {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Characteristic p = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Characteristic(&quot;can live in water&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Amphibian() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Amphibian()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected void
finalize() throws Throwable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Amphibian finalize&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(DoBaseFinalization.flag)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super.finalize();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Frog
extends Amphibian {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Frog() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Frog()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected void
finalize() throws Throwable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Frog finalize&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(DoBaseFinalization.flag)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super.finalize();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length != 0
&amp;&amp; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      
args[0].equals(&quot;finalize&quot;))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      
DoBaseFinalization.flag = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Not finalizing bases&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new Frog(); //
Instantly becomes garbage</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Bye!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Force finalizers
to be called:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.gc();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The class <b>DoBaseFinalization</b> simply
holds a flag that indicates to each class in the hierarchy whether to call </span><span lang=EN-US><b>super.finalize(&nbsp;)</b>. This flag is set based on a
command-line argument, so you can view the behavior with and without base-class
finalization.</span></p>

<p class=MsoNormal><span lang=EN-US>Each class in the hierarchy also contains a
member object of class <b>Characteristic</b>. You will see that regardless of
whether the base class finalizers are called, the <b>Characteristic</b> member
objects are always finalized.</span></p>

<p class=MsoNormal><span lang=EN-US>Each overridden <b>finalize(&nbsp;) </b>must
have access to at least <b>protected </b>members since the <b>finalize(&nbsp;) </b>method
in class <b>Object </b>is <b>protected</b> and the compiler will not allow you
to reduce the access during inheritance. (“</span><span lang=EN-US>Friendly” is less accessible than <b>protected</b>.)<b> </b></span></p>

<p class=MsoNormal><span
lang=EN-US>In <b>Frog.main(&nbsp;)</b>,<b> </b>the <b>DoBaseFinalization </b>flag
is configured and a single <b>Frog </b>object is created. Remember that garbage
collection—and in particular finalization—might not happen for any particular
object, so to enforce this, the call to <b>System.gc(&nbsp;)</b> triggers
garbage collection, and thus finalization. Without base-class finalization, the
output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Not finalizing bases</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Creating Characteristic
is alive</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>LivingCreature()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Creating Characteristic
has heart</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Animal()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Creating Characteristic
can live in water</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Amphibian()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Frog()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Bye!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Frog finalize</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>finalizing
Characteristic is alive</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>finalizing
Characteristic has heart</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>finalizing
Characteristic can live in water</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that, indeed, no finalizers are
called for the base classes of <b>Frog</b> (the member objects <i>are</i>
finalized, as you would expect). But if you add the “finalize” argument on the
command line, you get:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Creating Characteristic
is alive</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>LivingCreature()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Creating Characteristic
has heart</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Animal()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Creating Characteristic
can live in water</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Amphibian()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Frog()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>bye!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Frog finalize</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Amphibian finalize</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Animal finalize</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>LivingCreature finalize</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>finalizing
Characteristic is alive</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>finalizing
Characteristic has heart</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>finalizing
Characteristic can live in water</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Although the order the member objects are
finalized is the same order that they are created, technically the </span><span lang=EN-US>order of finalization of objects is unspecified. With base classes,
however, you have control over the order of finalization. The best order to use
is the one that’s shown here, which is the reverse of the order of
initialization. Following the form that’s used in C++ for destructors, you
should perform the derived-class finalization first, then the base-class
finalization. That’s because the derived-class finalization could call some
methods in the base class that require that the base-class components are still
alive, so you must not destroy them prematurely.</span></p>

<h3><a name="_Toc481064636"></a><a name="_Toc375545340"></a><a
name="_Toc312374057"><span lang=EN-US>Behavior of polymorphic methods <br>
inside constructors</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>The hierarchy of constructor calls brings up an interesting dilemma.
What happens if you’re inside a constructor and you call a dynamically bound
method of the object being constructed? Inside an ordinary method you can
imagine what will happen—the dynamically bound call is resolved at run-time
because the object cannot know whether it belongs to the class that the method
is in or some class derived from it. For consistency, you might think this is
what should happen inside constructors.</span></p>

<p class=MsoNormal><span lang=EN-US>This is not exactly the case. If you call a
dynamically bound method inside a constructor, the overridden definition for
that method is used. However, the <i>effect</i> can be rather unexpected, and
can conceal some difficult-to-find bugs.</span></p>

<p class=MsoNormal><span lang=EN-US>Conceptually, the constructor’s job is to
bring the object into existence (which is hardly an ordinary feat). Inside any
constructor, the entire object might be only partially formed—you can know only
that the base-class objects have been initialized, but you cannot know which
classes are inherited from you. A dynamically bound method call, however,
reaches “outward” into the inheritance hierarchy. It calls a method in a
derived class. If you do this inside a constructor, you call a method that
might manipulate members that haven’t been initialized yet—a sure recipe for
disaster.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see the problem in the following
example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c07:PolyConstructors.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Constructors and
polymorphism</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// don't produce what
you might expect.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>abstract class Glyph {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  abstract void draw();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Glyph() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Glyph() before draw()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    draw(); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Glyph() after draw()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class RoundGlyph extends
Glyph {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int radius = 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  RoundGlyph(int r) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    radius = r;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;RoundGlyph.RoundGlyph(), radius = &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      + radius);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void draw() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;RoundGlyph.draw(), radius = &quot; + radius);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
PolyConstructors {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new RoundGlyph(5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>Glyph</b>, the <b>draw(&nbsp;)</b>
method is <b>abstract</b>, so it is designed to be overridden. Indeed, you are
forced to override it in <b>RoundGlyph</b>. But the <b>Glyph</b> constructor
calls this method, and the call ends up in <b>RoundGlyph.draw(&nbsp;)</b>,
which would seem to be the intent. But look at the output:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Glyph() before draw()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>RoundGlyph.draw(),
radius = 0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Glyph() after draw()</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>RoundGlyph.RoundGlyph(),
radius = 5</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When <b>Glyph</b>’s constructor calls <b>draw(&nbsp;)</b>,
the value of <b>radius</b> isn’t even the default initial value 1. It’s 0. This
would probably result in either a dot or nothing at all being drawn on the
screen, and you’d be left staring, trying to figure out why the program won’t
work.</span></p>

<p class=MsoNormal><span lang=EN-US>The </span><span lang=EN-US>order of initialization described in the previous section isn’t quite
complete, and that’s the key to solving the mystery. The actual process of
initialization is:</span></p>

<p class=Numbered><span lang=EN-US>The storage allocated for the object is initialized
to binary zero before anything else happens.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>40.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>The base-class constructors are called as described previously. At
this point, the overridden <b>draw(&nbsp;)</b> method is called (yes, <i>before
</i>the <b>RoundGlyph </b>constructor is called), which discovers a <b>radius</b>
value of zero, due to step 1.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>41.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Member initializers are called in the order of declaration.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>42.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>The body of the derived-class constructor is called.</span></p>

<p class=MsoNormal><span lang=EN-US>There’s an upside to this, which is that
everything is at least initialized to zero (or whatever zero means for that particular
data type) and not just left as garbage. This includes object references that
are embedded inside a class via composition, which become <b>null</b>. So if
you forget to initialize that reference you’ll get an exception at run-time.
Everything else gets zero, which is usually a telltale value when looking at
output.</span></p>

<p class=MsoNormal><span lang=EN-US>On the other hand, you should be pretty
horrified at the outcome of this program. You’ve done a perfectly logical
thing, and yet the behavior is mysteriously wrong, with no complaints from the compiler.
(C++ produces more rational behavior in this situation.) Bugs like this could
easily be buried and take a long time to discover.</span></p>

<p class=MsoNormal><span lang=EN-US>As a result, a good guideline for
constructors is, “Do as little as possible to set the object into a good state,
and if you can possibly avoid it, don’t call any methods.” The only safe
methods to call inside a constructor are those that are </span><span lang=EN-US><b>final</b> in the base class. (This also applies to </span><span lang=EN-US><b>private</b> methods, which are automatically <b>final</b>.) These
cannot be overridden and thus cannot produce this kind of surprise.</span></p>

<h2><a name="_Toc481064637"></a><a name="_Toc375545341"><span lang=EN-US>Designing
with inheritance</span></a></h2>

<p class=MsoNormal><span
lang=EN-US>Once you learn about polymorphism, it can seem that everything ought
to be inherited because polymorphism is such a clever tool. This can burden
your designs; in fact if you choose inheritance first when you’re using an
existing class to make a new class, things can become needlessly complicated.</span></p>

<p class=MsoNormal><span lang=EN-US>A better approach is to choose </span><span lang=EN-US>composition first, when it’s not obvious which one you should use.
Composition does not force a design into an inheritance hierarchy. But
composition is also more flexible since it’s possible to dynamically choose a
type (and thus behavior) when using composition, whereas inheritance requires
an exact type to be known at compile-time. The following example illustrates
this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c07:Transmogrify.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Dynamically changing
the behavior of</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// an object via
composition.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>abstract class Actor {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  abstract void act();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class HappyActor extends
Actor {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void act() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;HappyActor&quot;); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class SadActor extends
Actor {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void act() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;SadActor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Stage {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Actor a = new
HappyActor();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void change() { a =
new SadActor(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void go() { a.act(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
Transmogrify {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Stage s = new
Stage();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s.go(); // Prints
&quot;HappyActor&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s.change();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s.go(); // Prints
&quot;SadActor&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>A <b>Stage</b> object contains a reference
to an <b>Actor</b>, which is initialized to a <b>HappyActor</b> object. This
means <b>go(&nbsp;)</b> produces a particular behavior. But since a reference
can be rebound to a different object at run-time, a reference for a <b>SadActor</b>
object can be substituted in <b>a</b> and then the behavior produced by <b>go(&nbsp;)</b>
changes. Thus you gain dynamic flexibility at run-time. (This is also called
the <i>State Pattern.</i> See <i>Thinking in Patterns with Java</i>,
downloadable at <i>www.BruceEckel.com.</i>) In contrast, you can’t decide to
inherit differently at run-time; that must be completely determined at
compile-time. </span></p>

<p class=MsoNormal><span lang=EN-US>A general guideline is “Use inheritance to
express differences in behavior, and fields to express variations in state.” In
the above example, both are used: two different classes are inherited to express
the difference in the <b>act(&nbsp;)</b> method, and <b>Stage</b> uses
composition to allow its state to be changed. In this case, that change in
state happens to produce a change in behavior.</span></p>

<h3><a name="_Toc481064638"></a><a name="_Toc375545342"><span lang=EN-US>Pure
inheritance vs. extension</span></a></h3>

<p class=MsoNormal><span lang=EN-US>When studying inheritance, it would seem that the cleanest way to
create an inheritance hierarchy is to take the “pure” approach. That is, only
methods that have been established in the base class or <b>interface</b> are to
be overridden in the derived class, as seen in this diagram:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=328 height=220 src="TIJ2_files/image021.png"></span></p>

<p class=MsoNormal><span lang=EN-US>This can be termed a pure “</span><span lang=EN-US>is-a” relationship because the interface of a class establishes what
it is. Inheritance guarantees that any derived class will have the interface of
the base class and nothing less. If you follow the above diagram, derived
classes will also have <i>no more</i> than the base class interface.</span></p>

<p class=MsoNormal><span lang=EN-US>This can be thought of as </span><span lang=EN-US><i>pure substitution</i>, because derived class objects can be
perfectly substituted for the base class, and you never need to know any extra
information about the subclasses when you’re using them:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=361 height=74 src="TIJ2_files/image022.png"></span></p>

<p class=MsoNormal><span lang=EN-US>That is, the base class can receive any
message you can send to the derived class because the two have exactly the same
interface. All you need to do is upcast from the derived class and never look
back to see what exact type of object you’re dealing with. Everything is
handled through polymorphism.</span></p>

<p class=MsoNormal><span lang=EN-US>When you see it this way, it seems like a
pure “is-a” relationship is the only sensible way to do things, and any other </span><span lang=EN-US>design indicates muddled thinking and is by definition broken. This
too is a trap. As soon as you start thinking this way, you’ll turn around and
discover that extending the interface (which, unfortunately, the keyword </span><span lang=EN-US><b>extends</b> seems to encourage) is the perfect solution to a
particular problem. This could be termed an </span><span
lang=EN-US>“is-like-a” relationship because the derived class is <i>like</i>
the base class—it has the same fundamental interface—but it has other features
that require additional methods to implement:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=228 height=273 src="TIJ2_files/image023.png"></span></p>

<p class=MsoNormal><span lang=EN-US>While this is also a useful and sensible
approach (depending on the situation) it has a drawback. The extended part of
the interface in the derived class is not available from the base class, so
once you upcast you can’t call the new methods:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=325 height=97 src="TIJ2_files/image024.png"></span></p>

<p class=MsoNormal><span lang=EN-US>If you’re not upcasting in this case, it
won’t bother you, but often you’ll get into a situation in which you need to
rediscover the exact type of the object so you can access the extended methods
of that type. The following section shows how this is done.</span></p>

<h3><a name="_Toc481064639"></a><a name="_Toc375545343"><span lang=EN-US>Downcasting
and run-time <br>
type identification</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Since you lose the specific type
information via an <i>upcast</i> (moving up the inheritance hierarchy), it
makes sense that to retrieve the type information—that is, to move back down
the inheritance hierarchy—you use a </span><span
lang=EN-US><i>downcast</i>. However, you know an upcast is always safe; the
base class cannot have a bigger interface than the derived class, therefore
every message you send through the base class interface is guaranteed to be
accepted. But with a downcast, you don’t really know that a shape (for example)
is actually a circle. It could instead be a triangle or square or some other type.</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=232 height=247 src="TIJ2_files/image025.png"></span></p>

<p class=MsoNormal><span lang=EN-US>To solve this problem there must be some
way to guarantee that a downcast is correct, so you won’t accidentally cast to
the wrong type and then send a message that the object can’t accept. This would
be quite unsafe.</span></p>

<p class=MsoNormal><span lang=EN-US>In some languages (like C++) you must
perform a special operation in order to get a type-safe downcast, but in Java <i>every
cast</i> is checked! So even though it looks like you’re just performing an
ordinary parenthesized cast, at run-time this cast is checked to ensure that it
is in fact the type you think it is. If it isn’t, you get a <b>ClassCastException</b>.
This act of checking types at run-time is called </span><span lang=EN-US><i>run-time type identification </i>(RTTI). The following example
demonstrates the behavior of RTTI:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c07:RTTI.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Downcasting &amp;
Run-time Type</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Identification
(RTTI).</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Useful {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void g() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MoreUseful extends
Useful {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void g() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void u() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void v() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void w() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class RTTI {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Useful[] x = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Useful(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new MoreUseful()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x[0].f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x[1].g();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Compile-time:
method not found in Useful:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x[1].u();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
((MoreUseful)x[1]).u(); // Downcast/RTTI</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
((MoreUseful)x[0]).u(); // Exception thrown</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>As in the diagram, <b>MoreUseful</b>
extends the interface of <b>Useful</b>. But since it’s inherited, it can also
be upcast to a <b>Useful</b>. You can see this happening in the initialization
of the array <b>x</b> in <b>main(&nbsp;)</b>. Since both objects in the array
are of class <b>Useful</b>, you can send the <b>f(&nbsp;)</b> and <b>g(&nbsp;)</b>
methods to both, and if you try to call <b>u(&nbsp;)</b> (which exists only in <b>MoreUseful</b>)
you’ll get a compile-time error message.</span></p>

<p class=MsoNormal><span lang=EN-US>If you want to access the extended
interface of a <b>MoreUseful</b> object, you can try to downcast. If it’s the
correct type, it will be successful. Otherwise, you’ll get a </span><span lang=EN-US><b>ClassCastException</b>. You don’t need to write any special code
for this exception, since it indicates a programmer error that could happen
anywhere in a program.</span></p>

<p class=MsoNormal><span lang=EN-US>There’s more to RTTI than a simple cast.
For example, there’s a way to see what type you’re dealing with <i>before</i>
you try to downcast it. All of Chapter 12 is devoted to the study of different
aspects of Java run-time type identification.</span></p>

<h2><a name="_Toc481064640"></a><a name="_Toc375545344"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Polymorphism </span><span
lang=EN-US>means “different forms.” In object-oriented programming, you have
the same face (the common interface in the base class) and different forms
using that face: the different versions of the dynamically bound methods.</span></p>

<p class=MsoNormal><span lang=EN-US>You’ve seen in this chapter that it’s
impossible to understand, or even create, an example of polymorphism without using
data abstraction and inheritance. Polymorphism is a feature that cannot be
viewed in isolation (like a <b>switch</b> statement can, for example), but
instead works only in concert, as part of a “big picture” of class
relationships. People are often confused by other, non-object-oriented features
of Java, like method overloading, which are sometimes presented as
object-oriented. Don’t be fooled: If it isn’t late binding, it isn’t polymorphism.</span></p>

<p class=MsoNormal><span lang=EN-US>To use polymorphism—and thus
object-oriented techniques—effectively in your programs you must expand your
view of programming to include not just members and messages of an individual
class, but also the commonality among classes and their relationships with each
other. Although this requires significant effort, it’s a worthy struggle,
because the results are faster program development, better code organization,
extensible programs, and easier code maintenance.</span></p>

<h2><a name="_Toc481064641"></a><a name="_Toc375545345"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add a new method in the base class of <b>Shapes.java</b>
that prints a message, but don’t override it in the derived classes. Explain
what happens. Now override it in one of the derived classes but not the others,
and see what happens. Finally, override it in all the derived classes.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>76. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add a new type of <b>Shape</b> to <b>Shapes.java</b>
and verify in <b>main(&nbsp;) </b>that polymorphism works for your new type as
it does in the old types.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>77. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Change <b>Music3.java</b> so that <b>what(&nbsp;)</b>
becomes the root <b>Object </b>method <b>toString(&nbsp;)</b>. Try printing the
<b>Instrument</b> objects using <b>System.out.println(&nbsp;)</b> (without any
casting).</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>78. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add a new type of <b>Instrument</b> to <b>Music3.java</b>
and verify that polymorphism works for your new type.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>79. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>Music3.java</b> so that it randomly
creates <b>Instrument</b> objects the way <b>Shapes.java</b> does.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>80. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an inheritance hierarchy of <b>Rodent</b>:
<b>Mouse</b>, <b>Gerbil</b>, <b>Hamster</b>, etc. In the base class, provide
methods that are common to all <b>Rodent</b>s, and override these in the
derived classes to perform different behaviors depending on the specific type
of <b>Rodent</b>. Create an array of <b>Rodent</b>, fill it with different
specific types of <b>Rodent</b>s, and call your base-class methods to see what
happens.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>81. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 6 so that <b>Rodent</b> is an <b>abstract</b>
class. Make the methods of <b>Rodent</b> abstract whenever possible.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>82. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class as <b>abstract</b> without
including any <b>abstract</b> methods, and verify that you cannot create any
instances of that class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>83. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add class <b>Pickle</b> to <b>Sandwich.java</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>84. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 6 so that it demonstrates the
order of initialization of the base classes and derived classes. Now add member
objects to both the base and derived classes, and show the order in which their
initialization occurs during construction.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>85. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a 3-level inheritance hierarchy. Each
class in the hierarchy should have a <b>finalize(&nbsp;)</b> method, and it
should properly call the base-class version of <b>finalize(&nbsp;)</b>.
Demonstrate that your hierarchy works properly.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>86. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a base class with two methods. In the
first method, call the second method. Inherit a class and override the second
method. Create an object of the derived class, upcast it to the base type, and
call the first method. Explain what happens.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>87. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a base class with an <b>abstract</b> <b>print(&nbsp;)
</b>method that is overridden in a derived class. The overridden version of the
method prints the value of an <b>int </b>variable defined in the derived class.
At the point of definition of this variable, give it a nonzero value. In the
base-class constructor, call this method. In <b>main(&nbsp;)</b>, create an
object of the derived type, and then call its <b>print(&nbsp;)</b> method.
Explain the results.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>88. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Following the example in <b>Transmogrify.java</b>,
create a <b>Starship</b> class containing an <b>AlertStatus</b> reference that
can indicate three different states. Include methods to change the states.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>89. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an <b>abstract</b> class with no methods.
Derive a class and add a method. Create a <b>static</b> method that takes a
reference to the base class, downcasts it to the derived class, and calls the
method. In <b>main(&nbsp;)</b>, demonstrate that it works. Now put the <b>abstract</b>
declaration for the method in the base class, thus eliminating the need for the
downcast.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection14>

<h1><a name="_Toc375545346"></a><a name="_Toc481064642"></a><a
name="_Toc477690728"></a><a name="Chapter_8"></a><span lang=EN-US>8: Interfaces
&amp; Inner Classes</span></h1>

<p class=Intro><span lang=EN-US>Interfaces and inner classes provide more
sophisticated ways to organize and control the objects in your system.</span></p>

<p class=MsoNormal><span lang=EN-US>C++, for example, does not contain such
mechanisms, although the clever programmer may simulate them. The fact that
they exist in Java indicates that they were considered important enough to
provide direct support through language keywords.</span></p>

<p class=MsoNormal><span lang=EN-US>In Chapter 7, you learned about the <b>abstract</b>
keyword, which allows you to create one or more methods in a class that have no
definitions—you provide part of the interface without providing a corresponding
implementation, which is created by inheritors. The <b>interface</b> keyword
produces a completely abstract class, one that provides no implementation at
all. You’ll learn that the <b>interface </b>is more than just an abstract class
taken to the extreme, since it allows you to perform a variation on C++’s
“multiple inheritance,” by creating a class that can be upcast to more than one
base type.</span></p>

<p class=MsoNormal><span lang=EN-US>At first, inner classes look like a simple
code-hiding mechanism: you place classes inside other classes. You’ll learn,
however, that the inner class does more than that—it knows about and can
communicate with the surrounding class—and that the kind of code you can write
with inner classes is more elegant and clear, although it is a new concept to
most. It takes some time to become comfortable with design using inner classes.</span></p>

<h2><a name="_Toc481064643"><span lang=EN-US>Interfaces</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The </span><span
lang=EN-US><b>interface</b> keyword takes the <b>abstract</b><b> </b>concept
one step further. You could think of it as a “pure” <b>abstract</b><b> </b>class.
It allows the creator to establish the form for a class: method names, argument
lists, and return types, but no method bodies. An <b>interface</b> can also
contain fields, but these are implicitly </span><span
lang=EN-US><b>static</b> and </span><span lang=EN-US><b>final</b>. An <b>interface</b>
provides only a form, but no </span><span
lang=EN-US>implementation.</span></p>

<p class=MsoNormal><span lang=EN-US>An <b>interface</b> says: “This is what all
classes that <i>implement</i> this particular interface will look like.” Thus,
any code that uses a particular <b>interface</b> knows what methods might be
called for that <b>interface</b>, and that’s all. So the <b>interface</b> is
used to establish a “protocol” between classes. (Some object-oriented
programming languages have a keyword called </span><span lang=EN-US><i>protocol</i> to do the same thing.)</span></p>

<p class=MsoNormal><span lang=EN-US>To create an <b>interface</b>, use the <b>interface</b>
keyword instead of the <b>class</b> keyword. Like a class, you can add the </span><span lang=EN-US><b>public</b> keyword before the <b>interface </b>keyword (but only
if that <b>interface</b> is defined in a file of the same name) or leave it off
to give “</span><span lang=EN-US>friendly” status so that it is only usable
within the same package.</span></p>

<p class=MsoNormal><span lang=EN-US>To make a class that conforms to a particular
<b>interface</b> (or group of <b>interface</b>s) use the </span><span lang=EN-US><b>implements</b> keyword. You’re saying “The <b>interface</b> is
what it looks like but now I’m going to say how it <i>works</i>.” Other than
that, it looks like inheritance. The diagram for the instrument example shows
this:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=376 height=406 src="TIJ2_files/image026.png"></span></p>

<p class=MsoNormal><span lang=EN-US>Once you’ve implemented an <b>interface</b>,
that implementation becomes an ordinary class that can be extended in the
regular way.</span></p>

<p class=MsoNormal><span lang=EN-US>You can choose to explicitly declare the
method declarations in an <b>interface</b> as <b>public</b>. But they are <b>public</b>
even if you don’t say it. So when you <b>implement</b> an <b>interface</b>, the
methods from the <b>interface</b> must be defined as <b>public</b>. Otherwise
they would default to “friendly,” and you’d be reducing the accessibility of a
method during inheritance, which is not allowed by the Java compiler.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see this in the modified version of
the <b>Instrument</b> example. Note that every method in the <b>interface</b>
is strictly a declaration, which is the only thing the compiler allows. In
addition, none of the methods in <b>Instrument</b> are declared as <b>public</b>,
but they’re automatically <b>public</b> anyway:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c08:music5:Music5.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Interfaces.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Compile-time
constant:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = 5; // static
&amp; final</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Cannot have method
definitions:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void play(); //
Automatically public</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String what();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void adjust();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Wind implements
Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Wind.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {
return &quot;Wind&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Percussion
implements Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Percussion.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {
return &quot;Percussion&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Stringed
implements Instrument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Stringed.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {
return &quot;Stringed&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Brass extends Wind
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Brass.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void adjust() {
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Brass.adjust()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Woodwind extends
Wind {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void play() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Woodwind.play()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String what() {
return &quot;Woodwind&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Music5 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Doesn't care about
type, so new types</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // added to the system
still work right:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
tune(Instrument i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i.play();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
tuneAll(Instrument[] e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; e.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      tune(e[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Instrument[]
orchestra = new Instrument[5];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Upcasting during
addition to the array:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Wind();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Percussion();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Stringed();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Brass();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    orchestra[i++] = new
Woodwind();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    tuneAll(orchestra);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The rest of the code works the same. It
doesn’t matter if you are </span><span
lang=EN-US>upcasting to a “regular” class called <b>Instrument</b>, an <b>abstract</b>
class called <b>Instrument</b>, or to an </span><span
lang=EN-US><b>interface</b> called <b>Instrument</b>. The behavior is the same.
In fact, you can see in the <b>tune(&nbsp;)</b> method that there isn’t any
evidence about whether <b>Instrument</b> is a “regular” class, an <b>abstract</b>
class, or an <b>interface</b>. This is the intent: Each approach gives the
programmer different control over the way objects are created and used.</span></p>

<h3><a name="_Toc481064644"></a><a name="_Toc375545336"><span lang=EN-US>“Multiple
inheritance” in Java</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The <b>interface</b> isn’t simply a “more
pure” form of <b>abstract</b> class. It has a higher purpose than that. Because
an <b>interface</b> has no implementation at all—that is, there is no storage
associated with an <b>interface—</b>there’s nothing to prevent many <b>interface</b>s
from being combined. This is valuable because there are times when you need to
say “An <b>x</b> is an <b>a</b> <i>and</i> a <b>b</b> <i>and</i> a <b>c</b>.”
In C++, this act of combining multiple class interfaces is called </span><span lang=EN-US><i>multiple inheritance</i>, and it carries some rather sticky
baggage because each class can have an implementation. In Java, you can perform
the same act, but only one of the classes can have an implementation, so the
problems seen in C++ do not occur with Java when combining multiple interfaces:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=454 height=172 src="TIJ2_files/image027.png"></span></p>

<p class=MsoNormal><span lang=EN-US>In a derived class, you aren’t forced to
have a base class that is either an <b>abstract</b> or “concrete” (one with no <b>abstract</b>
methods). If you <i>do</i> inherit from a non-<b>interface</b>,<b> </b>you can
inherit from only one. All the rest of the base elements must be <b>interface</b>s.
You place all the interface names after the <b>implements </b>keyword and
separate them with commas. You can have as many <b>interface</b>s as you
want—each one becomes an independent type that you can upcast to. The following
example shows a concrete class combined with several <b>interface</b>s to
produce a new class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Adventure.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Multiple interfaces.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface CanFight {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void fight();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface CanSwim {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void swim();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface CanFly {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void fly();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class ActionCharacter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void fight() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Hero extends
ActionCharacter </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    implements CanFight,
CanSwim, CanFly {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void swim() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void fly() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Adventure {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void t(CanFight
x) { x.fight(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void u(CanSwim
x) { x.swim(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void v(CanFly
x) { x.fly(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void w(ActionCharacter
x) { x.fight(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Hero h = new Hero();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t(h); // Treat it as
a CanFight</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    u(h); // Treat it as
a CanSwim</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    v(h); // Treat it as
a CanFly</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    w(h); // Treat it as
an ActionCharacter</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that <b>Hero</b> combines the
concrete class <b>ActionCharacter</b> with the interfaces <b>CanFight</b>, <b>CanSwim</b>,
and <b>CanFly</b>. When you combine a concrete class with interfaces this way,
the concrete class must come first, then the interfaces. (The compiler gives an
error otherwise.)</span></p>

<p class=MsoNormal><span lang=EN-US>Note that the signature for <b>fight(&nbsp;)</b>
is the same in the <b>interface CanFight</b> and the class <b>ActionCharacter</b>,
and that <b>fight(&nbsp;)</b> is <i>not</i> provided with a definition in <b>Hero</b>.
The rule for an <b>interface</b> is that you can inherit from it (as you will
see shortly), but then you’ve got another <b>interface</b>. If you want to
create an object of the new type, it must be a class with all definitions provided.
Even though <b>Hero</b> does not explicitly provide a definition for <b>fight(&nbsp;)</b>,
the definition comes along with <b>ActionCharacter</b> so it is automatically
provided and it’s possible to create objects of <b>Hero</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>In class <b>Adventure</b>, you can see that
there are four methods that take as arguments the various interfaces and the
concrete class. When a <b>Hero</b> object is created, it can be passed to any
of these methods, which means it is being upcast to each <b>interface</b> in
turn. Because of the way interfaces are designed in Java, this works without a
hitch and without any particular effort on the part of the programmer.</span></p>

<p class=MsoNormal><span lang=EN-US>Keep in mind that the core reason for
interfaces is shown in the above example: to be able to upcast to more than one
base type. However, a second reason for using interfaces is the same as using
an <b>abstract </b>base class: to prevent the client programmer from making an
object of this class and to establish that it is only an interface. This brings
up a question: Should you use an </span><span lang=EN-US><b>interface</b> or an <b>abstract</b> class? An <b>interface</b>
gives you the benefits of an <b>abstract</b> class <i>and</i> the benefits of
an <b>interface</b>, so if it’s possible to create your base class without any
method definitions or member variables you should always prefer <b>interface</b>s
to <b>abstract</b> classes. In fact, if you know something is going to be a
base class, your first choice should be to make it an <b>interface</b>, and
only if you’re forced to have method definitions or member variables should you
change to an <b>abstract</b> class, or if necessary a concrete class.</span></p>

<h4><span lang=EN-US>Name collisions when combining interfaces</span></h4>

<p class=MsoNormal><span
lang=EN-US>You can encounter a small pitfall when implementing multiple
interfaces. In the above example, both <b>CanFight</b> and <b>ActionCharacter</b>
have an identical <b>void fight(&nbsp;)</b> method. This is no problem because
the method is identical in both cases, but what if it’s not? Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c08:InterfaceCollision.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface I1 { void f();
}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface I2 { int f(int
i); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface I3 { int f();
}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class C { public int f()
{ return 1; } }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class C2 implements I1,
I2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int f(int i) {
return 1; } // overloaded</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class C3 extends C
implements I2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int f(int i) {
return 1; } // overloaded</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class C4 extends C
implements I3 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Identical, no
problem:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int f() {
return 1; } </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Methods differ only
by return type:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//! class C5 extends C
implements I1 {}</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>//! interface I4
extends I1, I3 {} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The difficulty occurs because overriding,
implementation, and overloading get unpleasantly mixed together, and overloaded
functions cannot differ only by return type. When the last two lines are
uncommented, the error messages say it all:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>InterfaceCollision.java:23:
f() in C cannot </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>implement f() in I1;
attempting to use </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>incompatible return type</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>found   : int</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>required: void</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>InterfaceCollision.java:24:
interfaces I3 and I1 are incompatible; both define f</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>(), but with
different return type</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Using the same method names in different
interfaces that are intended to be combined generally causes confusion in the
readability of the code, as well. Strive to avoid it.</span></p>

<h3><a name="_Toc481064645"></a><a name="_Toc375545337"><span lang=EN-US>Extending
an interface <br>
with inheritance</span></a></h3>

<p class=MsoNormal><span lang=EN-US>You can easily add new method declarations
to an </span><span
lang=EN-US><b>interface</b> using inheritance, and you can also combine several
<b>interface</b>s into a new <b>interface</b> with inheritance. In both cases
you get a new <b>interface</b>, as seen in this example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:HorrorShow.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Extending an
interface with inheritance.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface Monster {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void menace();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface
DangerousMonster extends Monster {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void destroy();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface Lethal {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void kill();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class DragonZilla
implements DangerousMonster {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void menace()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void destroy()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface Vampire </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    extends
DangerousMonster, Lethal {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void drinkBlood();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class HorrorShow {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void u(Monster
b) { b.menace(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
v(DangerousMonster d) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    d.menace();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    d.destroy();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    DragonZilla if2 =
new DragonZilla();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    u(if2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    v(if2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>DangerousMonster</span></b><span
lang=EN-US> is a simple extension to <b>Monster</b> that produces a new <b>interface</b>.
This is implemented in <b>DragonZilla</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The syntax used in <b>Vampire</b> works <i>only</i>
when inheriting interfaces. Normally, you can use </span><span
lang=EN-US><b>extends</b> with only a single class, but since an <b>interface</b>
can be made from multiple other interfaces, <b>extends</b> can refer to
multiple base interfaces when building a new <b>interface</b>. As you can see,
the <b>interface</b> names are simply separated with commas.</span></p>

<h3><a name="_Toc481064646"><span lang=EN-US>Grouping constants</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Because any fields you put into an <b>interface</b>
are automatically <b>static</b> and <b>final</b>, the <b>interface</b> is a
convenient tool for </span><span lang=EN-US>creating groups of constant values, much as you would with an <b>enum</b>
in C or C++. For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Months.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using interfaces to
create groups of constants.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package c08;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface Months
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JANUARY = 1,
FEBRUARY = 2, MARCH = 3, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    APRIL = 4, MAY = 5,
JUNE = 6, JULY = 7, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    AUGUST = 8,
SEPTEMBER = 9, OCTOBER = 10,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    NOVEMBER = 11,
DECEMBER = 12;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Notice the Java style of using all
uppercase letters (with underscores to separate multiple words in a single
identifier) for <b>static</b> <b>final</b>s that have constant initializers.</span></p>

<p class=MsoNormal><span lang=EN-US>The fields in an <b>interface </b>are
automatically <b>public</b>, so it’s unnecessary to specify that.</span></p>

<p class=MsoNormal><span lang=EN-US>Now you can use the constants from outside
the package by importing <b>c08.*</b> or <b>c08.Months</b> just as you would
with any other package, and referencing the values with expressions like <b>Months.JANUARY</b>.
Of course, what you get is just an <b>int</b>, so there isn’t the extra type
safety that C++’s <b>enum</b> has, but this (commonly used) technique is
certainly an improvement over hard-coding numbers into your programs. (That
approach is often referred to as using “magic numbers” and it produces very
difficult-to-maintain code.)</span></p>

<p class=MsoNormal><span lang=EN-US>If you do want extra type safety, you can
build a class like this</span><a href="#_ftn38" name="_ftnref38" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[38]</span></span></span></span></a><span lang=EN-US>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Month2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A more robust
enumeration system.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package c08;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public final class
Month2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private String name;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Month2(String
nm) { name = nm; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { return name; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public final static
Month2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JAN = new
Month2(&quot;January&quot;), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    FEB = new Month2(&quot;February&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MAR = new
Month2(&quot;March&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    APR = new
Month2(&quot;April&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MAY = new
Month2(&quot;May&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JUN = new
Month2(&quot;June&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JUL = new
Month2(&quot;July&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    AUG = new
Month2(&quot;August&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    SEP = new
Month2(&quot;September&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    OCT = new Month2(&quot;October&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    NOV = new
Month2(&quot;November&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    DEC = new
Month2(&quot;December&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public final static
Month2[] month =  {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JAN, JAN, FEB, MAR,
APR, MAY, JUN,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JUL, AUG, SEP, OCT,
NOV, DEC</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Month2 m =
Month2.JAN;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    m =
Month2.month[12];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(m
== Month2.DEC);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(m.equals(Month2.DEC));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The class is called <b>Month2</b>, since
there’s already a <b>Month</b> in the standard Java library. It’s a <b>final</b>
class with a <b>private</b> constructor so no one can inherit from it or make
any instances of it. The only instances are the <b>final static</b> ones
created in the class itself: <b>JAN</b>, <b>FEB</b>, <b>MAR</b>, etc. These
objects are also used in the array <b>month</b>, which lets you choose months
by number instead of by name. (Notice the extra <b>JAN</b> in the array to
provide an offset by one, so that December is month 12.) In <b>main(&nbsp;)</b>
you can see the </span><span
lang=EN-US>type safety: <b>m</b> is a <b>Month2</b> object so it can be
assigned only to a <b>Month2</b>. The previous example <b>Months.java </b>provided
only <b>int</b> values, so an <b>int</b> variable intended to represent a month
could actually be given any integer value, which wasn’t very safe.</span></p>

<p class=MsoNormal><span lang=EN-US>This approach also allows you to use <b>==</b>
or <b>equals(&nbsp;)</b> interchangeably, as shown at the end of <b>main(&nbsp;)</b>.</span></p>

<h3><a name="_Toc481064647"><span lang=EN-US>Initializing fields in interfaces</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Fields defined in interfaces are automatically <b>static</b> and <b>final</b>.
These cannot be “blank finals,” but they can be initialized with nonconstant
expressions. For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:RandVals.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Initializing
interface fields with </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// non-constant
initializers.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface RandVals
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int rint =
(int)(Math.random() * 10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  long rlong =
(long)(Math.random() * 10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float rfloat =
(float)(Math.random() * 10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  double rdouble =
Math.random() * 10;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Since the fields are <b>static</b>, they
are initialized when the class is first loaded, which happens when any of the
fields are accessed for the first time. Here’s a simple test:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c08:TestRandVals.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
TestRandVals {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(RandVals.rint);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(RandVals.rlong);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(RandVals.rfloat);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(RandVals.rdouble);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The fields, of course, are not part of the
interface but instead are stored in the <b>static</b> storage area for that
interface.</span></p>

<h3><a name="_Toc481064648"><span lang=EN-US>Nesting interfaces</span></a></h3>

<p class=MsoNormal><a href="#_ftn39" name="_ftnref39" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[39]</span></span></span></span></a><span
lang=EN-US>Interfaces may be nested within classes and within other interfaces.
This reveals a number of very interesting features:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c08:NestingInterfaces.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class A {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  interface B {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    void f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public class BImp
implements B {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class BImp2
implements B {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public interface C {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    void f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class CImp implements
C {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class CImp2
implements C {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private interface D {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    void f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class DImp
implements D {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public class DImp2
implements D {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public D getD() {
return new DImp2(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private D dRef;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void receiveD(D
d) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    dRef = d; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    dRef.f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface E {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  interface G {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    void f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Redundant
&quot;public&quot;:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public interface H {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    void f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void g();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Cannot be private
within an interface:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  //! private interface
I {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
NestingInterfaces {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public class BImp
implements A.B {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class CImp implements
A.C {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Cannot implement a
private interface except</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // within that
interface's defining class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  //! class DImp
implements A.D {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  //!  public void f()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  //! }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class EImp implements
E {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void g() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class EGImp implements
E.G {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class EImp2 implements
E {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void g() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    class EG implements
E.G {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    A a = new A();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Can't access A.D:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! A.D ad =
a.getD();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Doesn't return
anything but A.D:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! A.DImp2 di2 =
a.getD();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Cannot access a
member of the interface:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! a.getD().f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Only another A
can do anything with getD():</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    A a2 = new A();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
a2.receiveD(a.getD());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The syntax for nesting an interface within
a class is reasonably obvious, and just like non-nested interfaces these can
have <b>public</b> or “friendly” visibility. You can also see that both <b>public</b>
and “friendly” nested interfaces can be implemented as a <b>public</b>,
“friendly,” and <b>private</b> nested classes.</span></p>

<p class=MsoNormal><span lang=EN-US>As a new twist, </span><span lang=EN-US>interfaces can also be <b>private</b> as seen in <b>A.D</b> (the same
qualification syntax is used for nested interfaces as for nested classes). What
good is a <b>private</b> nested interface? You might guess that it can only be
implemented as a <b>private</b> nested class as in <b>DImp</b>, but <b>A.DImp2</b>
shows that it can also be implemented as a <b>public</b> class. However, <b>A.DImp2</b>
can only be used as itself. You are not allowed to mention the fact that it
implements the <b>private</b> interface, so implementing a <b>private</b>
interface is a way to force the definition of the methods in that interface
without adding any type information (that is, without allowing any upcasting).</span></p>

<p class=MsoNormal><span lang=EN-US>The method <b>getD(&nbsp;)</b> produces a
further quandary concerning the <b>private</b> interface: it’s a <b>public</b>
method that returns a reference to a <b>private</b> interface. What can you do
with the return value of this method? In <b>main(&nbsp;)</b>, you can see
several attempts to use the return value, all of which fail. The only thing
that works is if the return value is handed to an object that has permission to
use it—in this case, another <b>A</b>, via the <b>received(&nbsp;)</b> method.</span></p>

<p class=MsoNormal><span lang=EN-US>Interface <b>E</b> shows that interfaces
can be nested within each other. However, the rules about interfaces—in
particular, that all interface elements must be <b>public</b>—are strictly
enforced here, so an interface nested within another interface is automatically
<b>public</b> and cannot be made <b>private</b>.</span></p>

<p class=MsoNormal><b><span lang=EN-US>NestingInterfaces</span></b><span
lang=EN-US> shows the various ways that nested interfaces can be implemented.
In particular, notice that when you implement an interface, you are not
required to implement any interfaces nested within. Also, <b>private</b>
interfaces cannot be implemented outside of their defining classes.</span></p>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>Initially, these features may
seem like they are added strictly for syntactic consistency, but I generally
find that once you know about a feature, you often discover places where it is
useful.</span></p>

<h2><a name="_Toc481064649"><span lang=EN-US>Inner classes</span></a></h2>

<p class=MsoNormal><span lang=EN-US>It’s possible to place a class definition
within another class definition. This is called an <i>inner class</i>. The </span><span lang=EN-US>inner class is a valuable feature because it allows you to group
classes that logically belong together and to control the visibility of one
within the other. However, it’s important to understand that inner classes are
distinctly different from composition.</span></p>

<p class=MsoNormal><span lang=EN-US>Often, while you’re learning about them,
the need for inner classes isn’t immediately obvious. At the end of this
section, after all of the syntax and semantics of inner classes have been
described, you’ll find examples that should make clear the benefits of inner
classes.</span></p>

<p class=MsoNormal><span lang=EN-US>You create an inner class just as you’d
expect—by placing the class definition inside a surrounding class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Parcel1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creating inner
classes.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Parcel1 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Contents {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int i = 11;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public int value() {
return i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Destination {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private String
label;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Destination(String
whereTo) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      label = whereTo;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String readLabel() {
return label; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Using inner classes
looks just like</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // using any other
class, within Parcel1:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
ship(String dest) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Contents c = new
Contents();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Destination d = new
Destination(dest);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(d.readLabel());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel1 p = new
Parcel1();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
p.ship(&quot;Tanzania&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The inner classes, when used inside <b>ship(&nbsp;)</b>,
look just like the use of any other classes. Here, the only practical
difference is that the names are nested within <b>Parcel1</b>. You’ll see in a
while that this isn’t the only difference.</span></p>

<p class=MsoNormal><span lang=EN-US>More typically, an outer class will have a
method that returns a reference to an inner class, like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Parcel2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Returning a reference
to an inner class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Parcel2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Contents {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int i = 11;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public int value() {
return i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Destination {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private String
label;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Destination(String
whereTo) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      label = whereTo;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String readLabel() {
return label; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Destination
to(String s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Destination(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Contents cont()
{ </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Contents(); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
ship(String dest) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Contents c = cont();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Destination d =
to(dest);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(d.readLabel());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel2 p = new
Parcel2();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
p.ship(&quot;Tanzania&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel2 q = new
Parcel2();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Defining
references to inner classes:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel2.Contents c =
q.cont();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel2.Destination
d = q.to(&quot;Borneo&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you want to make an object of the inner
class anywhere except from within a non-<b>static</b> method of the outer
class, you must specify the type of that object as <i>OuterClassName.InnerClassName</i>,
as seen in <b>main(&nbsp;)</b>.</span></p>

<h3><a name="_Toc481064650"><span lang=EN-US>Inner classes and upcasting</span></a></h3>

<p class=MsoNormal><span lang=EN-US>So far, inner classes don’t seem that dramatic. After all, if it’s
hiding you’re after, Java already has a perfectly good hiding mechanism—just
allow the class to be “</span><span lang=EN-US>friendly” (visible only within a
</span><span lang=EN-US>package) rather than creating it as an inner class.</span></p>

<p class=MsoNormal><span lang=EN-US>However, inner classes really come into
their own when you start upcasting to a base class, and in particular to an <b>interface</b>.
(The effect of producing an interface reference from an object that implements
it is essentially the same as upcasting to a base class.) That’s because the
inner class—the implementation of the <b>interface</b>—can then be completely
unseen and unavailable to anyone, which is convenient for hiding the
implementation. All you get back is a reference to the base class or the <b>interface</b>.
</span></p>

<p class=MsoNormal><span lang=EN-US>First, the common interfaces will be
defined in their own files so they can be used in all the examples:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Destination.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
Destination {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String readLabel();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Contents.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
Contents {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int value();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now <b>Contents</b> and <b>Destination</b>
represent interfaces available to the client programmer. (The <b>interface</b>,
remember, automatically makes all of its members <b>public</b>.) </span></p>

<p class=MsoNormal><span lang=EN-US>When you get back a reference to the base
class or the <b>interface</b>, it’s possible that you can’t even find out the
exact type, as shown here:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Parcel3.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Returning a reference
to an inner class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Parcel3 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class
PContents implements Contents {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int i = 11;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public int value() {
return i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected class
PDestination</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      implements
Destination {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private String
label;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private
PDestination(String whereTo) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      label = whereTo;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public String
readLabel() { return label; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Destination
dest(String s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
PDestination(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Contents cont()
{ </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
PContents(); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Test {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel3 p = new
Parcel3();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Contents c =
p.cont();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Destination d =
p.dest(&quot;Tanzania&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Illegal -- can't
access private class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //!
Parcel3.PContents pc = p.new PContents();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that since <b>main(&nbsp;) </b>is in <b>Test</b>,
when you want to run this program you don’t execute <b>Parcel3</b>, but
instead:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>java Test</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In the example, <b>main(&nbsp;) </b>must be
in a separate class in order to demonstrate the privateness of the inner class <b>PContents</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>Parcel3</b>, something new has been
added: the inner class <b>PContents</b> is <b>private </b>so no one but <b>Parcel3</b>
can access it. <b>PDestination</b> is <b>protected</b>, so no one but <b>Parcel3</b>,
classes in the <b>Parcel3</b> package (since <b>protected</b> also gives
package access—that is, <b>protected</b> is also “friendly”), and the
inheritors of <b>Parcel3 </b>can access <b>PDestination</b>. This means that
the client programmer has restricted knowledge and access to these members. In
fact, you can’t even downcast to a <b>private</b> inner class (or a <b>protected</b>
inner class unless you’re an inheritor), because you can’t access the name, as
you can see in <b>class Test</b>. Thus, the <b>private</b> inner class provides
a way for the class designer to completely prevent any type-coding dependencies
and to completely hide details about implementation. In addition, extension of
an <b>interface</b> is useless from the client programmer’s perspective since
the client programmer cannot access any additional methods that aren’t part of
the <b>public</b> <b>interface</b> class. This also provides an opportunity for
the Java compiler to generate more efficient code.</span></p>

<p class=MsoNormal><span lang=EN-US>Normal (non-inner) classes cannot be made <b>private</b>
or <b>protected—</b>only <b>public</b> or “friendly.”</span></p>

<h3><a name="_Toc481064651"><span lang=EN-US>Inner classes <br>
in methods and scopes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>What you’ve seen so far encompasses the typical use for inner classes.
In general, the code that you’ll write and read involving inner classes will be
“plain” inner classes that are simple and easy to understand. However, the
design for inner classes is quite complete and there are a number of other,
more obscure, ways that you can use them if you choose: inner classes can be
created within a method or even an arbitrary scope. There are two reasons for
doing this:</span></p>

<p class=Numbered><span lang=EN-US>As shown previously, you’re implementing an
interface of some kind so that you can create and return a reference.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>43.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>You’re solving a complicated problem and you want to create a class
to aid in your solution, but you don’t want it publicly available.</span></p>

<p class=MsoNormal><span lang=EN-US>In the following examples, the previous
code will be modified to use: </span></p>

<p class=Numbered><span lang=EN-US>A class defined within a method </span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>44.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>A class defined within a scope inside a method</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>45.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>An anonymous class implementing an interface</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>46.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>An anonymous class extending a class that has a nondefault
constructor</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>47.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>An anonymous class that performs field initialization</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>48.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>An anonymous class that performs construction using instance
initialization (anonymous inner classes cannot have constructors)</span></p>

<p class=MsoNormal><span lang=EN-US>Although it’s an ordinary class with an
implementation, <b>Wrapping</b> is also being used as a common “interface” to
its derived classes:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Wrapping.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Wrapping {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Wrapping(int x)
{ i = x; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int value() {
return i; }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll notice above that <b>Wrapping</b>
has a constructor that requires an argument, to make things a bit more
interesting.</span></p>

<p class=MsoNormal><span lang=EN-US>The first example shows the creation of an
entire class within the scope of a method (instead of the scope of another
class):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Parcel4.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Nesting a class
within a method.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Parcel4 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Destination
dest(String s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    class PDestination</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        implements
Destination {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      private String
label;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      private
PDestination(String whereTo) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        label = whereTo;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public String
readLabel() { return label; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
PDestination(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel4 p = new
Parcel4();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Destination d =
p.dest(&quot;Tanzania&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The class <b>PDestination</b> is part of <b>dest(&nbsp;)</b>
rather than being part of <b>Parcel4</b>. (Also notice that you could use the
class identifier <b>PDestination </b>for an inner class inside each class in
the same subdirectory without a name clash.) Therefore, <b>PDestination </b>cannot
be accessed outside of <b>dest(&nbsp;)</b>.<b> </b>Notice the upcasting that
occurs in the return statement—nothing comes out of <b>dest(&nbsp;)</b> except
a reference to <b>Destination</b>, the base class. Of course, the fact that the
name of the class <b>PDestination</b> is placed inside <b>dest(&nbsp;)</b>
doesn’t mean that <b>PDestination</b> is not a valid object once <b>dest(&nbsp;)</b>
returns.</span></p>

<p class=MsoNormal><span lang=EN-US>The next example shows how you can nest an </span><span
lang=EN-US>inner class within any arbitrary scope:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Parcel5.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Nesting a class
within a scope.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Parcel5 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private void
internalTracking(boolean b) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(b) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      class TrackingSlip
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        private String
id;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
TrackingSlip(String s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          id = s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String getSlip()
{ return id; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      TrackingSlip ts =
new TrackingSlip(&quot;slip&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String s =
ts.getSlip();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Can't use it
here! Out of scope:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! TrackingSlip ts
= new TrackingSlip(&quot;x&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void track() {
internalTracking(true); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel5 p = new
Parcel5();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.track();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The class <b>TrackingSlip</b> is nested
inside the scope of an <b>if</b> statement. This does not mean that the class
is conditionally created—it gets compiled along with everything else. However,
it’s not available outside the scope in which it is defined.<b> </b>Other than
that, it looks just like an ordinary class.</span></p>

<h3><a name="_Toc481064652"><span lang=EN-US>Anonymous inner classes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The next example looks a little strange:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Parcel6.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A method that returns
an anonymous inner class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Parcel6 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Contents cont()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Contents() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      private int i =
11;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public int value()
{ return i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }; // Semicolon
required in this case</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel6 p = new
Parcel6();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Contents c =
p.cont();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>cont(&nbsp;)</b> method combines the
creation of the return value with the definition of the class that represents
that return value! In addition, the class is anonymous—it has no name. To make
matters a bit worse, it looks like you’re starting out to create a <b>Contents</b>
object:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>return new
Contents()</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>But then, before you get to the semicolon,
you say, “But wait, I think I’ll slip in a class definition”:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>return new Contents() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i = 11;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int value() {
return i; }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>};</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>What this strange syntax means is: “Create
an object of an anonymous class that’s inherited from <b>Contents</b>.” The
reference returned by the <b>new</b> expression is automatically upcast to a <b>Contents</b>
reference. The anonymous inner-class syntax is a shorthand for:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MyContents
implements Contents {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i = 11;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int value() {
return i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>return new
MyContents();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In the anonymous inner class, <b>Contents</b>
is created using a default constructor. The following code shows what to do if
your base class needs a constructor with an argument:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Parcel7.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// An anonymous inner
class that calls </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// the base-class
constructor.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Parcel7 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Wrapping
wrap(int x) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Base constructor
call:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Wrapping(x) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public int value()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        return
super.value() * 47;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }; // Semicolon
required</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel7 p = new
Parcel7();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Wrapping w =
p.wrap(10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>That is, you simply pass the appropriate
argument to the base-class constructor, seen here as the <b>x </b>passed in <b>new
Wrapping(x)</b>. An anonymous class cannot have a constructor where you would
normally call <b>super(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>In both of the previous examples, the
semicolon doesn’t mark the end of the class body (as it does in C++). Instead,
it marks the end of the expression that happens to contain the anonymous class.
Thus, it’s identical to the use of the semicolon everywhere else.</span></p>

<p class=MsoNormal><span lang=EN-US>What happens if you need to perform some
kind of initialization for an object of an </span><span lang=EN-US>anonymous inner class? Since it’s anonymous, there’s no name to give
the constructor—so you can’t have a constructor. You can, however, perform
initialization at the point of definition of your fields:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Parcel8.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// An anonymous inner
class that performs </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// initialization. A
briefer version</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// of Parcel5.java.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Parcel8 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Argument must be
final to use inside </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // anonymous inner
class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Destination
dest(final String dest) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Destination() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      private String
label = dest;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public String
readLabel() { return label; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel8 p = new
Parcel8();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Destination d =
p.dest(&quot;Tanzania&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you’re defining an anonymous inner class
and want to use an object that’s defined outside the anonymous inner class, the
compiler requires that the outside object be <b>final</b>. This is why the
argument to <b>dest(&nbsp;) </b>is <b>final</b>.<b> </b>If you forget, you’ll
get a compile-time error message.</span></p>

<p class=MsoNormal><span lang=EN-US>As long as you’re simply assigning a field,
the above approach is fine. But what if you need to perform some
constructor-like activity? With </span><span lang=EN-US><i>instance initialization</i>, you can, in effect, create a constructor
for an anonymous inner class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Parcel9.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using &quot;instance
initialization&quot; to perform </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// construction on an
anonymous inner class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Parcel9 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Destination </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  dest(final String
dest, final float price) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Destination() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      private int cost;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Instance
initialization for each object:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        cost =
Math.round(price);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(cost &gt;
100)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.out.println(&quot;Over budget!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      private String
label = dest;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public String
readLabel() { return label; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel9 p = new
Parcel9();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Destination d =
p.dest(&quot;Tanzania&quot;, 101.395F);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Inside the instance initializer you can see
code that couldn’t be executed as part of a field initializer (that is, the <b>if</b>
statement). So in effect, an instance initializer is the constructor for an
anonymous inner class. Of course, it’s limited; you can’t overload instance
initializers so you can have only one of these constructors.</span></p>

<h3><a name="_Toc481064653"><span lang=EN-US>The link to the outer class</span></a></h3>

<p class=MsoNormal><span lang=EN-US>So far, it appears that inner classes are
just a name-hiding and code-organization scheme, which is helpful but not
totally compelling. However, there’s another twist. When you create an inner
class, an object of that inner class has a link to the enclosing object that
made it, and so it can access the members of that enclosing object—<i>without </i>any
special qualifications. In addition, </span><span lang=EN-US>inner classes have access rights to all the elements in the enclosing
class</span><a href="#_ftn40" name="_ftnref40" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[40]</span></span></span></span></a><span lang=EN-US>. The
following example demonstrates this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Sequence.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Holds a sequence of
Objects.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface Selector {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean end();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Object current();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Sequence {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Object[] obs;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int next = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Sequence(int
size) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    obs = new
Object[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void add(Object
x) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(next &lt;
obs.length) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      obs[next] = x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      next++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class
SSelector implements Selector {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public boolean end()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return i ==
obs.length;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Object
current() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return obs[i];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void next() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i &lt;
obs.length) i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Selector
getSelector() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
SSelector();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Sequence s = new
Sequence(10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
s.add(Integer.toString(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Selector sl =
s.getSelector();    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(!sl.end()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(sl.current());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      sl.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Sequence</b> is simply a fixed-sized
array of <b>Object</b> with a class wrapped around it. You call <b>add(&nbsp;)</b>
to add a new <b>Object</b> to the end of the sequence (if there’s room left).
To fetch each of the objects in a <b>Sequence</b>, there’s an interface called <b>Selector</b>,
which allows you to see if you’re at the <b>end(&nbsp;)</b>, to look at the <b>current(&nbsp;)</b>
<b>Object</b>, and to move to the <b>next(&nbsp;)</b> <b>Object</b> in the <b>Sequence</b>.
Because <b>Selector</b> is an <b>interface</b>, many other classes can
implement the <b>interface</b> in their own ways, and many methods can take the
<b>interface</b> as an argument, in order to create generic code.</span></p>

<p class=MsoNormal><span lang=EN-US>Here, the <b>SSelector</b> is a <b>private</b>
class that provides <b>Selector</b> functionality. In <b>main(&nbsp;)</b>, you
can see the creation of a <b>Sequence</b>, followed by the addition of a number
of <b>String</b> objects. Then, a <b>Selector</b> is produced with a call to <b>getSelector(&nbsp;)</b>
and this is used to move through the <b>Sequence</b> and select each item.</span></p>

<p class=MsoNormal><span lang=EN-US>At first, the creation of <b>SSelector</b> looks
like just another inner class. But examine it closely. Note that each of the
methods <b>end(&nbsp;)</b>, <b>current(&nbsp;),</b> and <b>next(&nbsp;)</b>
refer to <b>obs</b>, which is a reference that isn’t part of <b>SSelector</b>,
but is instead a <b>private </b>field in the enclosing class. However, the inner
class can access methods and fields from the enclosing class as if they owned
them. This turns out to be very convenient, as you can see in the above
example.</span></p>

<p class=MsoNormal><span lang=EN-US>So an inner class has automatic access to
the members of the enclosing class. How can this happen? The </span><span
lang=EN-US>inner class must keep a reference to the particular object of the
enclosing class that was responsible for creating it. Then when you refer to a
member of the enclosing class, that (hidden) reference is used to select that
member. Fortunately, the compiler takes care of all these details for you, but
you can also understand now that an object of an inner class can be created
only in association with an object of the enclosing class. Construction of the
inner class object requires the reference to the object of the enclosing class,
and the compiler will complain if it cannot access that reference. Most of the
time this occurs without any intervention on the part of the programmer.</span></p>

<h3><a name="_Toc481064654"><b><span lang=EN-US>static</span></b><span
lang=EN-US> inner classes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>If you don’t need a connection between the inner class object and the
outer class object, then you can make the inner class <b>static</b>. To
understand the meaning of <b>static</b> when applied to inner classes, you must
remember that the object of an ordinary inner class implicitly keeps a
reference to the object of the enclosing class that created it. This is not
true, however, when you say an inner class is <b>static</b>. A <b>static </b>inner
class means:</span></p>

<p class=Numbered><span lang=EN-US>You don’t need an outer-class object in
order to create an object of a <b>static</b> inner class.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>49.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>You can’t access an outer-class object from an object of a <b>static</b>
inner class.</span></p>

<p class=MsoNormal><b><span lang=EN-US>static</span></b><span lang=EN-US> inner
classes are different than non-<b>static</b> inner classes in another way, as
well. Fields and methods in non-<b>static</b> inner classes can only be at the
outer level of a class, so non-<b>static</b> inner classes cannot have <b>static</b>
data, <b>static</b> fields, or <b>static</b> inner classes. However, <b>static</b>
inner classes can have all of these:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Parcel10.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Static inner classes.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Parcel10 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static class
PContents </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements Contents {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int i = 11;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public int value() {
return i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected static class
PDestination</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      implements
Destination {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private String
label;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private
PDestination(String whereTo) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      label = whereTo;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public String
readLabel() { return label; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Static inner
classes can contain </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // other static
elements:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public static void
f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    static int x = 10;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    static class
AnotherLevel {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public static void
f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      static int x = 10;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static
Destination dest(String s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
PDestination(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static Contents
cont() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
PContents();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Contents c = cont();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Destination d =
dest(&quot;Tanzania&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>main(&nbsp;)</b>, no object of <b>Parcel10</b>
is necessary; instead you use the normal syntax for selecting a <b>static</b>
member to call the methods that return references to <b>Contents</b> and <b>Destination</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>As you will see shortly, in an ordinary
(non-<b>static</b>) inner class, the link to the outer class object is achieved
with a special <b>this</b> reference. A <b>static</b> inner class does not have
this special <b>this</b> reference, which makes it analogous to a <b>static</b>
method.</span></p>

<p class=MsoNormal><span lang=EN-US>Normally you can’t put any code inside an <b>interface</b>,
but a <b>static</b> inner class can be part of an <b>interface</b>. Since the
class is <b>static </b>it doesn’t violate the rules for interfaces—the <b>static
</b>inner class is only placed inside the namespace of the interface:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:IInterface.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Static inner classes
inside interfaces.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface IInterface {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static class Inner {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i, j, k;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Inner() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Earlier in this book I suggested putting a <b>main(&nbsp;)
</b>in every class to act as a test</span><span
lang=EN-US> bed for that class. One drawback to this is the amount of extra
compiled code you must carry around. If this is a problem, you can use a <b>static</b>
inner class to hold your test code:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:TestBed.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Putting test code in
a static inner class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class TestBed {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  TestBed() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f() {
System.out.println(&quot;f()&quot;); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
Tester {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public static void main(String[]
args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      TestBed t = new
TestBed();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t.f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This generates a separate class called <b>TestBed$Tester</b>
(to run the program, you say <b>java TestBed$Tester</b>). You can use this
class for testing, but you don’t need to include it in your shipping product.</span></p>

<h3><a name="_Toc481064655"><span lang=EN-US>Referring to the outer class
object</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>If you need to produce the reference to the outer class object, you
name the outer class followed by a dot and <b>this</b>. For example, in the
class <b>Sequence.SSelector</b>, any of its methods can produce the stored
reference to the outer class <b>Sequence</b> by saying <b>Sequence.this</b>.
The resulting reference is automatically the correct type. (This is known and
checked at compile-time, so there is no run-time overhead.)</span></p>

<p class=MsoNormal><span lang=EN-US>Sometimes you want to tell some other
object to create an object of one of its inner classes. To do this you must
provide a reference to the other outer class object in the <b>new</b>
expression, like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Parcel11.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creating instances of
inner classes.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Parcel11 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Contents {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int i = 11;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public int value() {
return i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Destination {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private String
label;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Destination(String
whereTo) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      label = whereTo;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String readLabel() {
return label; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel11 p = new
Parcel11();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Must use instance
of outer class</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // to create an
instances of the inner class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel11.Contents c
= p.new Contents();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Parcel11.Destination
d =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      p.new
Destination(&quot;Tanzania&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>To create an object of the inner class
directly, you don’t follow the same form and refer to the outer class name <b>Parcel11</b>
as you might expect, but instead you must use an <i>object</i> of the outer
class to make an object of the inner class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Parcel11.Contents
c = p.new Contents();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Thus, it’s not possible to create an object
of the inner class unless you already have an object of the outer class. This
is because the object of the inner class is quietly connected to the object of
the outer class that it was made from. However, if you make a <b>static</b>
inner class, then it doesn’t need a reference to the outer class object.</span></p>

<h3><a name="_Toc481064656"><span lang=EN-US>Reaching outward from a
multiply-nested class</span></a></h3>

<p class=MsoNormal><a href="#_ftn41" name="_ftnref41" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[41]</span></span></span></span></a><span lang=EN-US>It doesn’t matter how deeply an inner class may be nested—it can
transparently access all of the members of all the classes it is nested within,
as seen here:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c08:MultiNestingAccess.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Nested classes can
access all members of all</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// levels of the classes
they are nested within.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MNA {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private void f() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class A {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private void g() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public class B {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      void h() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        g();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
MultiNestingAccess {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MNA mna = new MNA();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MNA.A mnaa = mna.new
A();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MNA.A.B mnaab =
mnaa.new B();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    mnaab.h();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that in <b>MNA.A.B</b>, the methods
<b>g(&nbsp;)</b> and <b>f(&nbsp;)</b> are callable without any qualification
(despite the fact that they are <b>private</b>). This example also demonstrates
the syntax necessary to create objects of multiply-nested inner classes when
you create the objects in a different class. The “<b>.new</b>” syntax produces
the correct scope so you do not have to qualify the class name in the
constructor call.</span></p>

<h3><a name="_Toc481064657"><span lang=EN-US>Inheriting from inner classes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Because the inner class constructor must attach to a reference of the
enclosing class object, things are slightly complicated when you inherit from
an inner class. The problem is that the “secret” reference to the enclosing
class object <i>must</i> be initialized, and yet in the derived class there’s
no longer a default object to attach to. The answer is to use a syntax provided
to make the association explicit:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c08:InheritInner.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Inheriting an inner
class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class WithInner {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Inner {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
InheritInner </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    extends
WithInner.Inner {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  //! InheritInner() {}
// Won't compile</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  InheritInner(WithInner
wi) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    wi.super();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    WithInner wi = new
WithInner();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    InheritInner ii =
new InheritInner(wi);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that <b>InheritInner</b> is
extending only the inner class, not the outer one. But when it comes time to
create a constructor, the default one is no good and you can’t just pass a
reference to an enclosing object. In addition, you must use the syntax</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>enclosingClassReference.super();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span
lang=EN-US>inside the constructor. This provides the necessary reference and
the program will then compile.</span></p>

<h3><a name="_Toc481064658"><span lang=EN-US>Can inner classes be overridden?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>What happens when you create an inner
class, then inherit from the enclosing class and redefine the inner class? That
is, is it possible to override an inner class? This seems like it would be a
powerful concept, but </span><span lang=EN-US>“overriding” an inner class as if it were another method of the outer
class doesn’t really do anything:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:BigEgg.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// An inner class cannot
be overriden </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// like a method.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Egg {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected class Yolk {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Yolk() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Egg.Yolk()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Yolk y;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Egg() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;New Egg()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    y = new Yolk();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class BigEgg
extends Egg {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public class Yolk {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Yolk() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;BigEgg.Yolk()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new BigEgg();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The default constructor is synthesized automatically
by the compiler, and this calls the base-class default constructor. You might
think that since a <b>BigEgg</b> is being created, the “overridden” version of <b>Yolk</b>
would be used, but this is not the case. The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>New Egg()</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Egg.Yolk()</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This example simply shows that there isn’t
any extra inner class magic going on when you inherit from the outer class. The
two inner classes are completely separate entities, each in their own
namespace. However, it’s still possible to explicitly inherit from the inner
class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:BigEgg2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Proper inheritance of
an inner class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Egg2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected class Yolk {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Yolk() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Egg2.Yolk()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void f() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Egg2.Yolk.f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Yolk y = new
Yolk();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Egg2() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;New Egg2()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
insertYolk(Yolk yy) { y = yy; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void g() {
y.f(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class BigEgg2
extends Egg2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public class Yolk
extends Egg2.Yolk {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Yolk() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;BigEgg2.Yolk()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void f() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;BigEgg2.Yolk.f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public BigEgg2() {
insertYolk(new Yolk()); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Egg2 e2 = new
BigEgg2();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    e2.g();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now <b>BigEgg2.Yolk</b> explicitly <b>extends</b>
<b>Egg2.Yolk</b> and overrides its methods. The method <b>insertYolk(&nbsp;) </b>allows
<b>BigEgg2 </b>to upcast one of its own <b>Yolk </b>objects into the <b>y</b>
reference in <b>Egg2</b>, so when <b>g(&nbsp;)</b> calls <b>y.f(&nbsp;)</b> the
overridden version of <b>f(&nbsp;)</b> is used. The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Egg2.Yolk()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>New Egg2()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Egg2.Yolk()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>BigEgg2.Yolk()</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>BigEgg2.Yolk.f()</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The second call to <b>Egg2.Yolk(&nbsp;)</b>
is the base-class constructor call of the <b>BigEgg2.Yolk</b> constructor. You
can see that the overridden version of <b>f(&nbsp;)</b> is used when <b>g(&nbsp;)</b>
is called.</span></p>

<h3><a name="_Toc481064659"><span lang=EN-US>Inner class identifiers</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Since every class produces a <b>.class </b>file
that holds all the information about how to create objects of this type (this
information produces a “meta-class” called the <b>Class </b>object), you might
guess that </span><span lang=EN-US>inner classes must also produce <b>.class</b> files to contain the
information for <i>their</i> <b>Class</b> objects. The names of these
files/classes have a strict formula: the name of the enclosing class, followed
by a ‘<b>$</b>’, followed by the name of the inner class. For example, the <b>.class</b>
files created by <b>InheritInner.java</b> include:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>InheritInner.class</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>WithInner$Inner.class</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>WithInner.class</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If inner classes are anonymous, the
compiler simply starts generating numbers as inner class identifiers. If inner
classes are nested within inner classes, their names are simply appended after
a ‘<b>$</b>’ and the outer class identifier(s).</span></p>

<p class=MsoNormal><span lang=EN-US>Although this scheme of generating internal
names is simple and straightforward, it’s also robust and handles most
situations</span><a href="#_ftn42" name="_ftnref42" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[42]</span></span></span></span></a><span lang=EN-US>. Since
it is the standard naming scheme for Java, the generated files are
automatically platform-independent. (Note that the Java compiler is changing
your inner classes in all sorts of other ways in order to make them work.)</span></p>

<h3><a name="_Toc481064660"><span lang=EN-US>Why inner classes?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>At this point you’ve seen a lot of syntax
and semantics describing the way inner classes work, but this doesn’t answer
the question of why they exist. Why did Sun go to so much trouble to add this
fundamental language feature?</span></p>

<p class=MsoNormal><span lang=EN-US>Typically, the inner class inherits from a
class or implements an <b>interface</b>, and the code in the inner class
manipulates the outer class object that it was created within. So you could say
that an inner class provides a kind of window into the outer class.</span></p>

<p class=MsoNormal><span lang=EN-US>A question that cuts to the heart of inner
classes is this: if I just need a reference to an <b>interface</b>, why don’t I
just make the outer class implement that <b>interface</b>? The answer is “If
that’s all you need, then that’s how you should do it.” So what is it that
distinguishes an inner class implementing an <b>interface</b> from an outer
class implementing the same <b>interface</b>? The answer is that you can’t
always have the convenience of <b>interface</b>s—sometimes you’re working with
implementations. So the most compelling reason for inner classes is:</span></p>

<p class=MsoNormal style='margin-left:36.0pt'><i><span lang=EN-US>Each inner
class can independently inherit from an implementation. Thus, the inner class
is not limited by whether the outer class is already inheriting from an
implementation.</span></i></p>

<p class=MsoNormal><span lang=EN-US>Without the ability that inner classes
provide to inherit—in effect—from more than one concrete or <b>abstract </b>class,
some design and programming problems would be intractable. So one way to look
at the inner class is as the completion of the solution of the
multiple-inheritance problem. Interfaces solve part of the problem, but inner
classes effectively allow “multiple implementation inheritance.” That is, inner
classes effectively allow you to inherit from more than one non-<b>interface</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>To see this in more detail, consider a
situation where you have two interfaces that must somehow be implemented within
a class. Because of the flexibility of interfaces, you have two choices: a
single class or an inner class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c08:MultiInterfaces.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Two ways that a class
can </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// implement multiple interfaces.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface A {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface B {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class X implements A, B
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Y implements A {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  B makeB() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Anonymous inner
class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new B() {};</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
MultiInterfaces {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void takesA(A
a) {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void takesB(B
b) {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    X x = new X();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Y y = new Y();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    takesA(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    takesA(y);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    takesB(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    takesB(y.makeB());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, this assumes that the structure
of your code makes logical sense either way. However, you’ll ordinarily have
some kind of guidance from the nature of the problem about whether to use a
single class or an inner class. But without any other constraints, in the above
example the approach you take doesn’t really make much difference from an implementation
standpoint. Both of them work.</span></p>

<p class=MsoNormal><span lang=EN-US>However, if you have <b>abstract</b> or
concrete classes instead of <b>interface</b>s, you are suddenly limited to
using inner classes if your class must somehow implement both of the others:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c08:MultiImplementation.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// With concrete or
abstract classes, inner </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// classes are the only
way to produce the effect</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// of &quot;multiple
implementation inheritance.&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class C {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>abstract class D {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Z extends C {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  D makeD() { return new
D() {}; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class MultiImplementation
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void takesC(C
c) {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void takesD(D
d) {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Z z = new Z();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    takesC(z);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    takesD(z.makeD());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you didn’t need to solve the “multiple
implementation inheritance” problem, you could conceivably code around
everything else without the need for inner classes. But with inner classes you
have these additional features:</span></p>

<p class=Numbered><span lang=EN-US>The inner class can have multiple instances,
each with its own state information that is independent of the information in
the outer class object.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>50.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>In a single outer class you can have several inner classes, each of
which implement the same <b>interface</b> or inherit from the same class in a
different way. An example of this will be shown shortly.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>51.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>The point of creation of the inner class object is not tied to the
creation of the outer class object.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>52.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>There is no potentially confusing “is-a” relationship with the inner
class; it’s a separate entity.</span></p>

<p class=MsoNormal><span lang=EN-US>As an example, if <b>Sequence.java</b> did
not use inner classes, you’d have to say “a <b>Sequence</b> is a <b>Selector</b>,”
and you’d only be able to have one <b>Selector</b> in existence for a
particular <b>Sequence</b>. Also, you can have a second method, <b>getRSelector(&nbsp;)</b>,
that produces a <b>Selector</b> that moves backward through the sequence. This
kind of flexibility is only available with inner classes.</span></p>

<h4><span lang=EN-US>Closures &amp; Callbacks</span></h4>

<p class=MsoNormal><span lang=EN-US>A <i>closure</i> is a callable object that
retains information from the scope in which it was created. From this
definition, you can see that an inner class is an object-oriented closure,
because it doesn’t just contain each piece of information from the outer class
object (“the scope in which it was created”), but it automatically holds a
reference back to the whole outer class object, where it has permission to
manipulate all the members, even <b>private</b> ones.</span></p>

<p class=MsoNormal><span lang=EN-US>One of the most compelling arguments made to include some kind of </span><span lang=EN-US>pointer mechanism in Java was to allow <i>callbacks</i>. With a
callback, some other object is given a piece of information that allows it to
call back into the originating object at some later point. This is a very
powerful concept, as you will see in Chapters 13 and 16. If a callback is
implemented using a pointer, however, you must rely on the programmer to behave
and not misuse the pointer. As you’ve seen by now, Java tends to be more
careful than that, so pointers were not included in the language.</span></p>

<p class=MsoNormal><span lang=EN-US>The closure provided by the inner class is
a perfect solution; more flexible and far safer than a pointer. Here’s a simple
example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c08:Callbacks.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using inner classes
for callbacks</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface Incrementable
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void increment();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Very simple to just
implement the interface:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Callee1 implements
Incrementable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
increment() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MyIncrement {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
increment() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Other operation&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
f(MyIncrement mi) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    mi.increment();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// If your class must
implement increment() in</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// some other way, you
must use an inner class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Callee2 extends
MyIncrement {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private void incr() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class Closure
implements Incrementable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
increment() { incr(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Incrementable
getCallbackReference() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Closure();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Caller {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Incrementable
callbackReference;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Caller(Incrementable
cbh) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    callbackReference =
cbh;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void go() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
callbackReference.increment();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Callbacks {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Callee1 c1 = new
Callee1();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Callee2 c2 = new
Callee2();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MyIncrement.f(c2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Caller caller1 = new
Caller(c1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Caller caller2 = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Caller(c2.getCallbackReference());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    caller1.go();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    caller1.go();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    caller2.go();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    caller2.go();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This example also provides a further
distinction between implementing an interface in an outer class vs. doing so in
an inner class. <b>Callee1</b> is clearly the simpler solution in terms of the
code. <b>Callee2</b> inherits from <b>MyIncrement</b> which already has a
different <b>increment(&nbsp;)</b> method which does something unrelated to
that which is expected by the <b>Incrementable</b> interface. When <b>MyIncrement</b>
is inherited into <b>Callee2</b>, <b>increment(&nbsp;)</b> can’t be overridden
for use by <b>Incrementable</b>, so you’re forced to provide a separate
implementation using an inner class. Also note that when you create an inner
class you do not add to or modify the interface of the outer class.</span></p>

<p class=MsoNormal><span lang=EN-US>Notice that everything except <b>getCallbackReference(&nbsp;)</b>
in <b>Callee2</b> is <b>private</b>. To allow <i>any</i> connection to the
outside world, the <b>interface Incrementable</b> is essential. Here you can
see how <b>interface</b>s allow for a complete separation of interface from
implementation.</span></p>

<p class=MsoNormal><span lang=EN-US>The inner class <b>Closure</b> simply
implements <b>Incrementable</b> to provide a hook back into <b>Callee2</b>—but
a safe hook. Whoever gets the <b>Incrementable</b> reference can, of course,
only call <b>increment(&nbsp;)</b> and has no other abilities (unlike a
pointer, which would allow you to run wild).</span></p>

<p class=MsoNormal><b><span lang=EN-US>Caller</span></b><span lang=EN-US> takes
an <b>Incrementable</b> reference in its constructor (although the capturing of
the callback reference could happen at any time) and then, sometime latter,
uses the reference to “call back” into the <b>Callee</b> class.</span></p>

<p class=MsoNormal><span lang=EN-US>The value of the callback is in its
flexibility—you can dynamically decide what functions will be called at
run-time. The benefit of this will become more evident in Chapter 13, where callbacks
are used everywhere to implement graphical user interface (GUI) functionality.</span></p>

<h3><a name="_Toc481064661"><span lang=EN-US>Inner classes &amp; control
frameworks</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A more concrete example of the use of inner
classes can be found in something that I will refer to here as a </span><span lang=EN-US><i>control framework</i>. </span></p>

<p class=MsoNormal><span lang=EN-US>An </span><span
lang=EN-US><i>application framework</i> is a class or a set of classes that’s
designed to solve a particular type of problem. To apply an application
framework, you inherit from one or more classes and override some of the
methods. The code you write in the overridden methods customizes the general
solution provided by that application framework, in order to solve your
specific problem. The control framework is a particular type of application<i> </i>framework
dominated by the need to respond to events; a system that primarily responds to
events is called an </span><span
lang=EN-US><i>event-driven</i> <i>system</i>. One of the most important
problems in application programming is the </span><span lang=EN-US>graphical user interface (GUI), which is almost entirely
event-driven. As you will see in Chapter 13, the Java Swing library is a
control framework that elegantly solves the GUI problem and that heavily uses
inner classes.</span></p>

<p class=MsoNormal><span lang=EN-US>To see how inner classes allow the simple
creation and use of control frameworks, consider a control framework whose job
is to execute events whenever those events are “ready.” Although “ready” could
mean anything, in this case the default will be based on clock time. What
follows is a control framework that contains no specific information about what
it’s controlling. First, here is the interface that describes any control
event. It’s an <b>abstract</b> class instead of an actual <b>interface</b>
because the default behavior is to perform the control based on time, so some
of the implementation can be included here:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c08:controller:Event.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The common methods
for any control event.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package c08.controller;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>abstract public class
Event {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private long evtTime;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Event(long
eventTime) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    evtTime = eventTime;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean ready()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
System.currentTimeMillis() &gt;= evtTime;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  abstract public void
action();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  abstract public String
description();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The constructor simply captures the time
when you want the <b>Event</b> to run, while <b>ready(&nbsp;)</b> tells you
when it’s time to run it. Of course, <b>ready(&nbsp;)</b> could be overridden
in a derived class to base the <b>Event</b> on something other than time.</span></p>

<p class=MsoNormal><b><span lang=EN-US>action(&nbsp;)</span></b><span
lang=EN-US> is the method that’s called when the <b>Event</b> is <b>ready(&nbsp;)</b>,
and <b>description(&nbsp;)</b> gives textual information about the <b>Event</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The following file contains the actual
control framework that manages and fires events. The first class is really just
a “helper” class whose job is to hold <b>Event</b> objects. You can replace it
with any appropriate container, and in Chapter 9 you’ll discover other containers
that will do the trick without requiring you to write this extra code:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c08:controller:Controller.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Along with Event, the
generic</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// framework for all
control systems:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package c08.controller;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// This is just a way to
hold Event objects.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class EventSet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Event[] events
= new Event[100];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int index = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int next = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void add(Event
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(index &gt;=
events.length)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return; // (In
real life, throw exception)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    events[index++] = e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Event getNext()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    boolean looped =
false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int start = next;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    do {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      next = (next + 1)
% events.length;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // See if it has
looped to the beginning:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(start == next)
looped = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // If it loops
past start, the list </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // is empty:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if((next == (start
+ 1) % events.length)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         &amp;&amp;
looped)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        return null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } while(events[next]
== null);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return events[next];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
removeCurrent() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    events[next] = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Controller
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private EventSet es =
new EventSet();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
addEvent(Event c) { es.add(c); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Event e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while((e =
es.getNext()) != null) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(e.ready()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        e.action();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(e.description());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        es.removeCurrent();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>EventSet</span></b><span lang=EN-US>
arbitrarily holds 100 <b>Event</b>s. (If a “real” container from Chapter 9 is
used here you don’t need to worry about its maximum size, since it will resize
itself). The <b>index</b> is used to keep track of the next available space,
and <b>next</b> is used when you’re looking for the next <b>Event</b> in the
list, to see whether you’ve looped around. This is important during a call to <b>getNext(&nbsp;)</b>,
because <b>Event</b> objects are removed from the list (using <b>removeCurrent(&nbsp;)</b>)<b>
</b>once they’re run, so <b>getNext(&nbsp;)</b> will encounter holes in the
list as it moves through it.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that <b>removeCurrent(&nbsp;)</b>
doesn’t just set some flag indicating that the object is no longer in use.
Instead, it sets the reference to <b>null</b>. This is important because if the
</span><span lang=EN-US>garbage collector sees a reference that’s still in use then it can’t
clean up the object. If you think your references might hang around (as they
would here), then it’s a good idea to set them to <b>null</b> to give the
garbage collector permission to clean them up.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Controller</span></b><span lang=EN-US>
is where the actual work goes on. It uses an <b>EventSet</b> to hold its <b>Event</b>
objects, and <b>addEvent(&nbsp;)</b> allows you to add new events to this list.
But the important method is <b>run(&nbsp;)</b>. This method loops through the <b>EventSet</b>,
hunting for an <b>Event</b> object that’s <b>ready(&nbsp;)</b> to run. For each
one it finds <b>ready(&nbsp;)</b>,<b> </b>it calls the <b>action(&nbsp;)</b>
method, prints out the <b>description(&nbsp;),</b> and then removes the <b>Event</b>
from the list. </span></p>

<p class=MsoNormal><span lang=EN-US>Note that so far in this design you know
nothing about exactly <i>what</i> an <b>Event</b> does. And this is the crux of
the design; how it “separates the things that change from the things that stay
the same.” Or, to use my term, the “</span><span lang=EN-US>vector of change” is the different actions of the various kinds of <b>Event</b>
objects, and you express different actions by creating different <b>Event</b>
subclasses.</span></p>

<p class=MsoNormal><span lang=EN-US>This is where inner classes come into play.
They allow two things: </span></p>

<p class=Numbered><span lang=EN-US>To create the entire implementation of a
control-framework application in a single class, thereby encapsulating
everything that’s unique about that implementation. Inner classes are used to
express the many different kinds of <b>action(&nbsp;)</b> necessary to solve
the problem. In addition, the following example uses <b>private</b> inner
classes so the implementation is completely hidden and can be changed with impunity.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>53.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Inner classes keep this implementation from becoming awkward, since
you’re able to easily access any of the members in the outer class. Without
this ability the code might become unpleasant enough that you’d end up seeking
an alternative.</span></p>

<p class=MsoNormal><span lang=EN-US>Consider a particular implementation of the
control framework designed to control greenhouse functions</span><a
href="#_ftn43" name="_ftnref43" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[43]</span></span></span></span></a><span
lang=EN-US>. Each action is entirely different: turning lights, water, and
thermostats on and off, ringing bells, and restarting the system. But the
control framework is designed to easily isolate this different code. Inner
classes allow you to have multiple derived versions of the same base class, <b>Event</b>,
within a single class. For each type of action you inherit a new <b>Event</b>
inner class, and write the control code inside of <b>action(&nbsp;)</b>. </span></p>

<p class=MsoNormal><span lang=EN-US>As is typical with an application
framework, the class <b>GreenhouseControls</b> is inherited from <b>Controller</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c08:GreenhouseControls.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// This produces a
specific application of the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// control system, all
in a single class. Inner</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// classes allow you to
encapsulate different</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// functionality for
each type of event.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import c08.controller.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
GreenhouseControls </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    extends Controller {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean light
= false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean water
= false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private String thermostat
= &quot;Day&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class LightOn
extends Event {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public LightOn(long
eventTime) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super(eventTime);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void action()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Put hardware
control code here to </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // physically turn
on the light.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      light = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public String
description() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return &quot;Light
is on&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class LightOff
extends Event {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public LightOff(long
eventTime) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super(eventTime);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void action()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Put hardware
control code here to </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // physically turn
off the light.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      light = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public String
description() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return &quot;Light
is off&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class WaterOn
extends Event {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public WaterOn(long
eventTime) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super(eventTime);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void action()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Put hardware
control code here</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      water = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public String
description() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
&quot;Greenhouse water is on&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class WaterOff
extends Event {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public WaterOff(long
eventTime) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super(eventTime);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void action()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Put hardware
control code here</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      water = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public String
description() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
&quot;Greenhouse water is off&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class
ThermostatNight extends Event {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public
ThermostatNight(long eventTime) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super(eventTime);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void action()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Put hardware
control code here</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      thermostat =
&quot;Night&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public String
description() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
&quot;Thermostat on night setting&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class
ThermostatDay extends Event {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public
ThermostatDay(long eventTime) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super(eventTime);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void action()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Put hardware
control code here</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      thermostat =
&quot;Day&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public String
description() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
&quot;Thermostat on day setting&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // An example of an
action() that inserts a </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // new one of itself
into the event list:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int rings;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class Bell
extends Event {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Bell(long
eventTime) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super(eventTime);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void action()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Ring every 2
seconds, 'rings' times:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Bing!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(--rings &gt; 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        addEvent(new
Bell(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.currentTimeMillis() + 2000));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public String
description() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return &quot;Ring
bell&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class Restart
extends Event {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Restart(long
eventTime) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super(eventTime);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void action()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      long tm =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Instead of
hard-wiring, you could parse</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // configuration
information from a text</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // file here:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      rings = 5;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      addEvent(new
ThermostatNight(tm));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      addEvent(new
LightOn(tm + 1000));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      addEvent(new
LightOff(tm + 2000));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      addEvent(new
WaterOn(tm + 3000));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      addEvent(new
WaterOff(tm + 8000));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      addEvent(new
Bell(tm + 9000));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      addEvent(new
ThermostatDay(tm + 10000));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Can even add a
Restart object!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      addEvent(new
Restart(tm + 20000));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public String
description() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return &quot;Restarting
system&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    GreenhouseControls
gc = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
GreenhouseControls();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long tm =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    gc.addEvent(gc.new
Restart(tm));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    gc.run();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  } </span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that <b>light</b>, <b>water</b>, <b>thermostat,</b>
and <b>rings</b> all belong to the outer class <b>GreenhouseControls</b>, and
yet the inner classes can access those fields without qualification or special
permission. Also, most of the <b>action(&nbsp;)</b> methods involve some sort
of hardware control, which would most likely involve calls to non-Java code.</span></p>

<p class=MsoNormal><span lang=EN-US>Most of the <b>Event</b> classes look
similar, but <b>Bell</b> and <b>Restart</b> are special. <b>Bell</b> rings, and
if it hasn’t yet rung enough times it adds a new <b>Bell</b> object to the
event list, so it will ring again later. Notice how inner classes <i>almost</i>
look like multiple inheritance: <b>Bell</b> has all the methods of <b>Event</b>
and it also appears to have all the methods of the outer class <b>GreenhouseControls</b>.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Restart</span></b><span lang=EN-US> is
responsible for initializing the system, so it adds all the appropriate events.
Of course, a more flexible way to accomplish this is to avoid hard-coding the
events and instead read them from a file. (An exercise in Chapter 11 asks you
to modify this example to do just that.) Since <b>Restart(&nbsp;)</b> is just another
<b>Event</b> object, you can also add a <b>Restart</b> object within <b>Restart.action(&nbsp;)</b>
so that the system regularly restarts itself. And all you need to do in <b>main(&nbsp;)</b>
is create a <b>GreenhouseControls</b> object and add a <b>Restart</b> object to
get it going.</span></p>

<p class=Code style='margin-bottom:9.0pt;border:none'><span lang=EN-US
style='font-family:"Georgia","serif"'>This example should move you a long way
toward appreciating the value of inner classes, especially when used within a
control framework. However, in Chapter 13 you’ll see how elegantly inner
classes are used to describe the actions of a graphical user interface. By the
time you finish that chapter you should be fully convinced.</span></p>

<h2><a name="_Toc481064662"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Interfaces and inner classes are more
sophisticated concepts than what you’ll find in many OOP languages. For
example, there’s nothing like them in C++. Together, they solve the same
problem that C++ attempts to solve with its multiple inheritance (MI) feature.
However, MI in C++ turns out to be rather difficult to use, while Java
interfaces and inner classes are, by comparison, much more accessible.</span></p>

<p class=MsoNormal><span lang=EN-US>Although the features themselves are
reasonably straightforward, the use of these features is a design issue, much
the same as polymorphism. Over time, you’ll become better at recognizing
situations where you should use an interface, or an inner class, or both. But
at this point in this book you should at least be comfortable with the syntax
and semantics. As you see these language features in use you’ll eventually
internalize them.</span></p>

<h2><a name="_Toc481064663"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Prove that the fields in an <b>interface</b> are
implicitly <b>static</b> and <b>final</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>90. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an <b>interface</b> containing three
methods, in its own <b>package</b>. Implement the interface in a different <b>package</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>91. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Prove that all the methods in an <b>interface</b>
are automatically <b>public</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>92. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In <b>c07:Sandwich.java</b>, create an interface
called <b>FastFood</b> (with appropriate methods) and change <b>Sandwich</b> so
that it also implements <b>FastFood</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>93. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create three <b>interface</b>s, each with two
methods. Inherit a new <b>interface</b> from the three, adding a new method.
Create a class by implementing the new <b>interface</b> and also inheriting
from a concrete class. Now write four methods, each of which takes one of the
four <b>interface</b>s as an argument. In <b>main(&nbsp;)</b>, create an object
of your class and pass it to each of the methods.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>94. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 5 by creating an <b>abstract</b>
class and inheriting that into the derived class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>95. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>Music5.java</b> by adding a <b>Playable</b>
<b>interface</b>. Remove the <b>play(&nbsp;)</b> declaration from <b>Instrument</b>.
Add <b>Playable</b> to the derived classes by including it in the <b>implements</b>
list. Change <b>tune(&nbsp;)</b> so that it takes a <b>Playable</b> instead of
an <b>Instrument</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>96. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Change Exercise 6 in Chapter 7 so that <b>Rodent</b>
is an <b>interface</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>97. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In <b>Adventure.java</b>, add an <b>interface</b>
called <b>CanClimb</b>, following the form of the other interfaces.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>98. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a program that imports and uses <b>Month2.java</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>99. <span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Following the example given in <b>Month2.java</b>,
create an enumeration of days of the week.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>100. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an <b>interface</b> with at least one
method, in its own package. Create a class in a separate package. Add a <b>protected</b>
inner class that implements the <b>interface</b>. In a third package, inherit
from your class and, inside a method, return an object of the <b>protected</b>
inner class, upcasting to the <b>interface</b> during the return.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>101. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an <b>interface</b> with at least one method,
and implement that <b>interface</b> by defining an inner class within a method,
which returns a reference to your <b>interface</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>102. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Repeat Exercise 13 but define the inner class
within a scope within a method.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>103. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Repeat Exercise 13 using an anonymous inner
class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>104. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a <b>private</b> inner class that
implements a <b>public</b> <b>interface</b>. Write a method that returns a
reference to an instance of the <b>private</b> inner class, upcast to the <b>interface</b>.
Show that the inner class is completely hidden by trying to downcast to it.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>105. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with a nondefault constructor and
no default constructor. Create a second class that has a method which returns a
reference to the first class. Create the object to return by making an
anonymous inner class that inherits from the first class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>106. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with a <b>private</b> field and a
<b>private</b> method. Create an inner class with a method that modifies the
outer class field and calls the outer class method. In a second outer class
method, create an object of the inner class and call it’s method, then show the
effect on the outer class object.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>107. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Repeat Exercise 18 using an anonymous inner
class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>108. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class containing a <b>static</b> inner
class. In <b>main(&nbsp;)</b>, create an instance of the inner class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>109. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an <b>interface</b> containing a <b>static</b>
inner class. Implement this <b>interface</b> and create an instance of the
inner class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>110. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class containing an inner class that
itself contains an inner class. Repeat this using <b>static</b> inner classes.
Note the names of the <b>.class</b> files produced by the compiler.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>111. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with an inner class. In a
separate class, make an instance of the inner class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>112. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with an inner class that has a
nondefault constructor. Create a second class with an inner class that inherits
from the first inner class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>113. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Repair the problem in <b>WindError.java</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>114. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>Sequence.java</b> by adding a method <b>getRSelector(&nbsp;)</b>
that produces a different implementation of the <b>Selector</b> <b>interface</b>
that moves backward through the sequence from the end to the beginning.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>115. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an <b>interface</b> <b>U </b>with three
methods. Create a class <b>A </b>with a method that produces a reference to a <b>U</b>
by building an anonymous inner class. Create a second class <b>B </b>that
contains an array of <b>U</b>. <b>B</b> should have one method that accepts and
stores a reference to a <b>U</b> in the array, a second method that sets a reference
in the array (specified by the method argument) to <b>null</b> and a third
method that moves through the array and calls the methods in <b>U</b>. In <b>main(&nbsp;)</b>,
create a group of <b>A</b> objects and a single <b>B</b>. Fill the <b>B</b>
with <b>U</b> references produced by the <b>A</b> objects. Use the <b>B</b> to
call back into all the <b>A</b> objects. Remove some of the <b>U</b> references
from the <b>B</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>116. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In <b>GreenhouseControls.java</b>, add <b>Event</b>
inner classes that turn fans on and off.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>117. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Show that an inner class has access to the <b>private</b>
elements of its outer class. Determine whether the reverse is true.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection15>

<h1><a name="_Toc481064664"></a><a name="_Toc477690729"><span lang=EN-US>9:
Holding <br>
Your Objects</span></a></h1>

<p class=Intro><a name="OLE_LINK2"><span lang=EN-US>It’s a fairly simple
program that has only a fixed quantity of objects with known lifetimes.</span></a></p>

<p class=MsoNormal><span lang=EN-US>In general, your programs will always be
creating new objects based on some criteria that will be known only at the time
the program is running. You won’t know until run-time the quantity or even the
exact type of the objects you need. To solve the general programming problem,
you need to be able to create any number of objects, anytime, anywhere.</span><span
lang=EN-US> So you can’t rely on creating a named reference to hold each one of
your objects:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>MyObject
myReference;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>since you’ll never know how many of these
you’ll actually need.</span></p>

<p class=MsoNormal><span lang=EN-US>To solve this rather essential problem,
Java has several ways to hold objects (or rather, references to objects). The
built-in type is the array, which has been discussed before. Also, the Java
utilities library has a reasonably complete set of </span><span
lang=EN-US><i>container</i><i> classes</i> (also known as </span><span lang=EN-US><i>collection</i> <i>classes</i>, but because the Java 2 libraries
use the name <b>Collection</b> to refer to a particular subset of the library,
I shall use the more inclusive term “container”). Containers provide
sophisticated ways to hold and even manipulate your objects.</span></p>

<h2><a name="_Toc481064665"></a><a name="_Toc375545347"><span lang=EN-US>Arrays</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Most of the necessary introduction to </span><span lang=EN-US>arrays is in the last section of Chapter 4, which showed how you
define and initialize an array. Holding objects is the focus of this chapter,
and an array is just one way to hold objects. But there are a number of other
ways to hold objects, so what makes an array special?</span></p>

<p class=MsoNormal><span lang=EN-US>There are two issues that distinguish
arrays from other types of containers: </span><span
lang=EN-US>efficiency and </span><span
lang=EN-US>type. The array is the most efficient way that Java provides to
store and randomly access a sequence of objects (actually, object references).
The array is a simple linear sequence, which makes element access fast, but you
pay for this speed: when you create an array object, its size is fixed and cannot
be changed for the lifetime of that array object. You might suggest creating an
array of a particular size and then, if you run out of space, creating a new
one and moving all the references from the old one to the new one. This is the
behavior of the <b>ArrayList </b>class, which will be studied later in this
chapter. However, because of the overhead of this size flexibility, an <b>ArrayList</b>
is measurably less efficient than an array.</span></p>

<p class=MsoNormal><span lang=EN-US>The </span><span
lang=EN-US><b>vector</b> container class in C++ <i>does</i> know the type of
objects it holds, but it has a different drawback when compared with arrays in
Java: the C++ <b>vector</b>’s <b>operator[]</b> doesn’t do bounds checking, so
you can run past the end</span><a href="#_ftn44" name="_ftnref44" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[44]</span></span></span></span></a><span lang=EN-US>. In
Java, you get bounds checking regardless of whether you’re using an array or a
container—you’ll get a </span><span
lang=EN-US><b>RuntimeException</b> if you exceed the bounds. As you’ll learn in
Chapter 10, this type of exception indicates a programmer error, and thus you
don’t need to check for it in your code. As an aside, the reason the C++ <b>vector</b>
doesn’t check bounds with every access is speed—in Java you have the constant
performance overhead of bounds checking all the time for both arrays and
containers.</span></p>

<p class=MsoNormal><span lang=EN-US>The other generic container classes that
will be studied in this chapter, </span><span lang=EN-US><b>List</b>, </span><span lang=EN-US><b>Set</b>, and </span><span lang=EN-US><b>Map</b>, all deal with
objects as if they had no specific type. That is, they treat them as type </span><span lang=EN-US><b>Object</b>, the root class of all classes in Java. This works fine
from one standpoint: you need to build only one container, and any Java object
will go into that container. (Except for primitives—these can be placed in
containers as constants using the Java primitive wrapper classes, or as
changeable values by wrapping in your own class.) This is the second place
where an array is superior to the generic containers: when you create an array,
you create it to hold a specific type. This means that you get compile-time
type checking to prevent you from putting the wrong type in, or mistaking the
type that you’re extracting. Of course, Java will prevent you from sending an
inappropriate message to an object, either at compile-time or at run-time. So
it’s not much riskier one way or the other, it’s just nicer if the compiler
points it out to you, faster at run-time, and there’s less likelihood that the
end user will get surprised by an exception.</span></p>

<p class=MsoNormal><span lang=EN-US>For efficiency and type checking it’s
always worth trying to use an array if you can. However, when you’re trying to
solve a more general problem arrays can be too restrictive. After looking at
arrays, the rest of this chapter will be devoted to the container classes
provided by Java.</span></p>

<h3><a name="_Toc375545348"></a><a name="_Toc481064666"><span lang=EN-US>Arrays
are first-class objects</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>Regardless of what type of array you’re working with, the array
identifier is actually a reference to a true object that’s created on the heap.
This is the object that holds the references to the other objects, and it can
be created either implicitly, as part of the array initialization syntax, or
explicitly with a <b>new</b> expression. Part of the array object (in fact, the
only field or method you can access) is the read-only <b>length</b> member that
tells you how many elements can be stored in that array object. </span><span lang=EN-US>The ‘<b>[]</b>’ syntax is the only other access that you have to the
array object.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example shows the various
ways that an array can be initialized, and how the array references can be
assigned to different array objects. It also shows that </span><span lang=EN-US>arrays of objects and </span><span
lang=EN-US>arrays of primitives are almost identical in their use. The only
difference is that arrays of objects hold references, while arrays of
primitives hold the primitive values directly.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:ArraySize.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Initialization &amp;
re-assignment of arrays.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Weeble {} // A
small mythical creature</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ArraySize {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Arrays of
objects:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Weeble[] a; // Null
reference</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Weeble[] b = new
Weeble[5]; // Null references</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Weeble[] c = new
Weeble[4];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; c.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      c[i] = new
Weeble();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Aggregate
initialization:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Weeble[] d = { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Weeble(), new
Weeble(), new Weeble()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Dynamic aggregate
initialization:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a = new Weeble[] {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Weeble(), new
Weeble()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;a.length=&quot; + a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;b.length = &quot; + b.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // The references
inside the array are </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // automatically
initialized to null:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; b.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;b[&quot; + i + &quot;]=&quot; + b[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;c.length = &quot; + c.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;d.length = &quot; + d.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a = d;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;a.length
= &quot; + a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Arrays of
primitives:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] e; // Null
reference</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] f = new
int[5];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] g = new
int[4];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; g.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      g[i] = i*i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] h = { 11, 47,
93 };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Compile error:
variable e not initialized:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
//!System.out.println(&quot;e.length=&quot; + e.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;f.length = &quot; + f.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // The primitives
inside the array are</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // automatically
initialized to zero:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; f.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;f[&quot; + i + &quot;]=&quot; + f[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;g.length = &quot; + g.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;h.length = &quot; + h.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    e = h;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;e.length = &quot; + e.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    e = new int[] { 1, 2
};</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;e.length
= &quot; + e.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s the output from the program:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>b.length = 5</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>b[0]=null</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>b[1]=null</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>b[2]=null</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>b[3]=null</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>b[4]=null</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>c.length = 4</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>d.length = 3</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>a.length = 3</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>a.length = 2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>f.length = 5</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>f[0]=0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>f[1]=0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>f[2]=0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>f[3]=0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>f[4]=0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>g.length = 4</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>h.length = 3</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>e.length = 3</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>e.length = 2</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The array <b>a</b> is initially just a </span><span lang=EN-US><b>null </b>reference, and the compiler prevents you from doing
anything with this reference until you’ve properly initialized it. The array <b>b</b>
is initialized to point to an array of <b>Weeble</b> references, but no actual <b>Weeble</b>
objects are ever placed in that array. However, you can still ask what the size
of the array is, since <b>b</b> is pointing to a legitimate object. This brings
up a slight drawback: you can’t find out how many elements are actually <i>in</i>
the array, since <b>length</b> tells you only how many elements <i>can</i> be
placed in the array; that is, the size of the array object, not the number of
elements it actually holds. However, when an array object is created its
references are automatically initialized to <b>null</b>, so you can see whether
a particular array slot has an object in it by checking to see whether it’s <b>null</b>.
Similarly, an array of primitives is automatically initialized to zero for
numeric types, <b>(char)0 </b>for <b>char</b>, and<b> false</b> for <b>boolean</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Array <b>c</b> shows the creation of the
array object followed by the assignment of <b>Weeble</b> objects to all the
slots in the array. Array <b>d</b> shows the “aggregate initialization” syntax
that causes the array object to be created (implicitly with <b>new</b> on the
heap, just like for array <b>c</b>) <i>and</i> initialized with <b>Weeble</b>
objects, all in one statement.</span></p>

<p class=MsoNormal><span lang=EN-US>The next array initialization could be thought of as a “dynamic
aggregate initialization.” The aggregate initialization used by <b>d</b> must
be used at the point of <b>d</b>’s definition, but with the second syntax you
can create and initialize an array object anywhere. For example, suppose <b>hide(&nbsp;)</b>
is a method that takes an array of <b>Weeble</b> objects. You could call it by
saying:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>hide(d);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>but you can also dynamically create the
array you want to pass as the argument:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>hide(new Weeble[]
{ new Weeble(), new Weeble() });</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In some situations this new syntax provides
a more convenient way to write code.</span></p>

<p class=MsoNormal><span lang=EN-US>The expression</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>a = d;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>shows how you can take a reference that’s
attached to one array object and assign it to another array object, just as you
can do with any other type of object reference. Now both <b>a</b> and <b>d</b>
are pointing to the same array object on the heap.</span></p>

<p class=MsoNormal><span lang=EN-US>The second part of <b>ArraySize.java</b>
shows that primitive arrays work just like object arrays <i>except</i> that
primitive arrays hold the primitive values directly.</span></p>

<h4><a name="_Toc375545349"><span lang=EN-US>Containers of primitives</span></a></h4>

<p class=MsoNormal><span
lang=EN-US>Container classes can hold only references to objects. An array,
however, can be created to hold primitives directly, as well as references to
objects. It <i>is</i> possible to use the “wrapper” classes such as <b>Integer</b>,
<b>Double,</b> etc. to place primitive values inside a container, but the
wrapper classes for primitives can be awkward to use. In addition, it’s much
more efficient to create and access an array of primitives than a container of
wrapped primitives.</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, if you’re using a primitive type
and you need the flexibility of a container that automatically expands when
more space is needed, the array won’t work and you’re forced to use a container
of wrapped primitives. You might think that there should be a specialized type
of <b>ArrayList</b> for each of the primitive data types, but Java doesn’t
provide this for you. Some sort of templatizing mechanism might someday provide
a better way for Java to handle this problem.</span><a href="#_ftn45"
name="_ftnref45" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[45]</span></span></span></span></a></p>

<h3><a name="_Toc481064667"><span lang=EN-US>Returning an array</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Suppose you’re writing a method and you
don’t just want to return just one thing, but a whole bunch of things.
Languages like C and C++ make this difficult because you can’t just return an
array, only a pointer to an array. This introduces problems because it becomes
messy to control the lifetime of the array, which easily leads to memory leaks.</span></p>

<p class=MsoNormal><span lang=EN-US>Java takes a similar approach, but you just
“return an array.” Actually, of course, you’re returning a reference to an
array, but with Java you never worry about responsibility for that array—it
will be around as long as you need it, and the garbage collector will clean it
up when you’re done.</span></p>

<p class=MsoNormal><span lang=EN-US>As an example, consider returning an array
of <b>String</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:IceCream.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Returning arrays from
methods.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class IceCream {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static String[] flav =
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;Chocolate&quot;, &quot;Strawberry&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Vanilla Fudge
Swirl&quot;, &quot;Mint Chip&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Mocha Almond
Fudge&quot;, &quot;Rum Raisin&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Praline
Cream&quot;, &quot;Mud Pie&quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static String[]
flavorSet(int n) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Force it to be
positive &amp; within bounds:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    n = Math.abs(n) %
(flav.length + 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] results =
new String[n];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    boolean[] picked = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
boolean[flav.length];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for (int i = 0; i
&lt; n; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int t;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      do </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        t =
(int)(Math.random() * flav.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while (picked[t]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      results[i] =
flav[t];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      picked[t] = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return results;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 20; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
&quot;flavorSet(&quot; + i + &quot;) = &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String[] fl =
flavorSet(flav.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int j = 0; j
&lt; fl.length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(&quot;\t&quot; + fl[j]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The method <b>flavorSet(&nbsp;)</b> creates
an array of <b>String</b> called <b>results</b>. The size of this array is <b>n</b>,
determined by the argument you pass into the method. Then it proceeds to choose
flavors randomly from the array <b>flav</b> and place them into <b>results</b>,
which it finally returns. Returning an array is just like returning any other
object—it’s a reference. It’s not important that the array was created within <b>flavorSet(&nbsp;)</b>,
or that the array was created anyplace else, for that matter. The garbage
collector takes care of cleaning up the array when you’re done with it, and the
array will persist for as long as you need it.</span></p>

<p class=MsoNormal><span lang=EN-US>As an aside, notice that when <b>flavorSet(&nbsp;)</b>
chooses flavors randomly, it ensures that a random choice hasn’t been picked
before. This is performed in a <b>do</b> loop that keeps making random choices
until it finds one that’s not already in the <b>picked</b> array. (Of course, a
<b>String</b> comparison could also have been performed to see if the random
choice was already in the <b>results</b> array, but <b>String</b> comparisons
are inefficient.) If it’s successful, it adds the entry and finds the next one
(<b>i </b>gets incremented). </span></p>

<p class=MsoNormal><b><span lang=EN-US>main(&nbsp;)</span></b><span lang=EN-US>
prints out 20 full sets of flavors, so you can see that <b>flavorSet(&nbsp;)</b>
chooses the flavors in a random order each time. It’s easiest to see this if
you redirect the output into a file. And while you’re looking at the file,
remember, you just <i>want</i> the ice cream, you don’t <i>need</i> it.</span></p>

<h3><a name="_Toc481064668"><span lang=EN-US>The <b>Arrays</b> class</span></a></h3>

<p class=MsoNormal><span lang=EN-US>In <b>java.util</b>, you’ll find the </span><span lang=EN-US><b>Arrays</b> class, which holds a set of <b>static</b> methods that
perform utility functions for arrays. There are four basic functions: <b>equals(&nbsp;)</b>,
to compare two arrays for equality; <b>fill(&nbsp;)</b>, to fill an array with
a value; <b>sort(&nbsp;)</b>, to sort the array; and <b>binarySearch(&nbsp;)</b>,
to find an element in a sorted array. All of these methods are overloaded for
all the primitive types and <b>Object</b>s. In addition, there’s a single <b>asList(&nbsp;)</b>
method that takes any array and turns it into a <b>List</b> container—which
you’ll learn about later in this chapter.</span></p>

<p class=MsoNormal><span lang=EN-US>While useful, the <b>Arrays</b> class stops
short of being fully functional. For example, it would be nice to be able to
easily print the elements of an array without having to code a <b>for</b> loop
by hand every time. And as you’ll see, the <b>fill(&nbsp;)</b> method only
takes a single value and places it in the array, so if you wanted—for
example—to fill an array with randomly generated numbers, <b>fill(&nbsp;)</b>
is no help.</span></p>

<p class=MsoNormal><span lang=EN-US>Thus it makes sense to supplement the <b>Arrays</b>
class with some additional utilities, which will be placed in the <b>package</b>
<b>com.bruceeckel.util</b> for convenience. These will print an array of any
type, and fill an array with values or objects that are created by an object
called a <i>generator</i> that you can define.</span></p>

<p class=MsoNormal><span
lang=EN-US>Because code needs to be created for each primitive type as well as <b>Object</b>,
there’s a lot of nearly duplicated code</span><a href="#_ftn46" name="_ftnref46"
title=""><span class=MsoFootnoteReference><span lang=EN-US style='font-size:
8.0pt'><span class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;
font-family:"Georgia","serif"'>[46]</span></span></span></span></a><span
lang=EN-US>. For example, a “generator” interface is required for each type
because the return type of <b>next(&nbsp;)</b> must be different in each case:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:util:Generator.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
Generator { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Object next(); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:util:BooleanGenerator.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
BooleanGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:util:ByteGenerator.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
ByteGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  byte next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: com:bruceeckel:util:CharGenerator.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
CharGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  char next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:util:ShortGenerator.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
ShortGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  short next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: com:bruceeckel:util:IntGenerator.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
IntGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:util:LongGenerator.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
LongGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  long next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: com:bruceeckel:util:FloatGenerator.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
FloatGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  float next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:util:DoubleGenerator.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
DoubleGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  double next();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><b>Arrays2</b> contains a variety of <b>print(&nbsp;)</b>
functions, overloaded for each type. You can simply print an array, you can add
a message before the array is printed, or you can print a range of elements
within an array. The <b>print(&nbsp;)</b> code is self-explanatory:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:util:Arrays2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A supplement to
java.util.Arrays, to provide</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// additional useful
functionality when working</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// with arrays. Allows
any array to be printed,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// and to be filled via
a user-defined </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &quot;generator&quot;
object.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Arrays2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static void</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  start(int from, int
to, int length) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(from != 0 || to
!= length)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(&quot;[&quot;+ from +&quot;:&quot;+ to +&quot;] &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.print(&quot;(&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static void
end() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
print(Object[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(String msg,
Object[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.print(msg
+ &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(Object[] a, int
from, int to){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start(from, to,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(a[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i &lt; to -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.print(&quot;, &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    end();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
print(boolean[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(String msg,
boolean[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.print(msg
+ &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(boolean[] a, int
from, int to) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start(from, to,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(a[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i &lt; to -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.print(&quot;, &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    end();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
print(byte[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(String msg,
byte[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.print(msg
+ &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(byte[] a, int
from, int to) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start(from, to,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(a[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i &lt; to -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.print(&quot;, &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    end();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
print(char[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(String msg,
char[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.print(msg
+ &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(char[] a, int
from, int to) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start(from, to,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(a[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i &lt; to -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.print(&quot;, &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    end();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
print(short[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(String msg,
short[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.print(msg
+ &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(short[] a, int
from, int to) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start(from, to,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(a[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i &lt; to - 1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.print(&quot;, &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    end();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
print(int[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(String msg,
int[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.print(msg
+ &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(int[] a, int
from, int to) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start(from, to,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(a[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i &lt; to - 1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        System.out.print(&quot;,
&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    end();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
print(long[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(String msg,
long[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.print(msg
+ &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(long[] a, int
from, int to) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start(from, to,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(a[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i &lt; to - 1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.print(&quot;, &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    end();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
print(float[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(String msg,
float[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.print(msg
+ &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(float[] a, int
from, int to) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start(from, to,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i &lt;
to; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(a[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i &lt; to - 1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.print(&quot;, &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    end();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
print(double[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(String msg,
double[] a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.print(msg
+ &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    print(a, 0,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  print(double[] a, int
from, int to){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start(from, to,
a.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(a[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i &lt; to - 1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        System.out.print(&quot;,
&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    end();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Fill an array using
a generator:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(Object[] a,
Generator gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fill(a, 0,
a.length, gen);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(Object[] a, int
from, int to, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       Generator gen){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a[i] = gen.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(boolean[] a,
BooleanGenerator gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fill(a, 0,
a.length, gen);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(boolean[] a, int
from, int to,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       BooleanGenerator
gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a[i] = gen.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(byte[] a,
ByteGenerator gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fill(a, 0,
a.length, gen);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(byte[] a, int
from, int to, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       ByteGenerator
gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a[i] = gen.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(char[] a,
CharGenerator gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fill(a, 0,
a.length, gen);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(char[] a, int
from, int to, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       CharGenerator
gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i &lt;
to; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a[i] = gen.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(short[] a,
ShortGenerator gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fill(a, 0,
a.length, gen);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(short[] a, int
from, int to, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       ShortGenerator
gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a[i] = gen.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(int[] a,
IntGenerator gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fill(a, 0,
a.length, gen);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(int[] a, int
from, int to, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       IntGenerator gen)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a[i] = gen.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(long[] a,
LongGenerator gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fill(a, 0,
a.length, gen);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(long[] a, int
from, int to, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       LongGenerator
gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a[i] = gen.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(float[] a,
FloatGenerator gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fill(a, 0,
a.length, gen);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(float[] a, int
from, int to, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       FloatGenerator
gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a[i] = gen.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(double[] a,
DoubleGenerator gen) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fill(a, 0,
a.length, gen);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(double[] a, int
from, int to,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       DoubleGenerator
gen){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = from; i
&lt; to; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a[i] = gen.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static Random
r = new Random();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
RandBooleanGenerator </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements
BooleanGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public boolean
next() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
r.nextBoolean();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
RandByteGenerator </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements ByteGenerator
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public byte next() {
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
(byte)r.nextInt();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static String ssource
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;abcdefghijklmnopqrstuvwxyz&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static char[] src =
ssource.toCharArray();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
RandCharGenerator </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements
CharGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public char next() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int pos =
Math.abs(r.nextInt());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return src[pos %
src.length];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
RandStringGenerator</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements Generator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int len;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private
RandCharGenerator cg = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
RandCharGenerator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public
RandStringGenerator(int length) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      len = length;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Object next()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      char[] buf = new
char[len];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; len; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        buf[i] =
cg.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return new String(buf);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
RandShortGenerator </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements
ShortGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public short next()
{ </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
(short)r.nextInt();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
RandIntGenerator </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements
IntGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int mod =
10000;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public
RandIntGenerator() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public
RandIntGenerator(int modulo) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      mod = modulo;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public int next() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return r.nextInt()
% mod; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
RandLongGenerator </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements
LongGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public long next() {
return r.nextLong(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
RandFloatGenerator </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements
FloatGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public float next()
{ return r.nextFloat(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
RandDoubleGenerator </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements
DoubleGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public double next()
{return r.nextDouble();}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>To fill an array of elements using a
generator, the <b>fill(&nbsp;)</b> method takes a reference to an appropriate
generator <b>interface</b>, which has a <b>next(&nbsp;)</b> method that will
somehow produce an object of the right type (depending on how the interface is
implemented). The <b>fill(&nbsp;)</b> method simply calls <b>next(&nbsp;)</b>
until the desired range has been filled. Now you can create any generator by
implementing the appropriate <b>interface</b>, and use your generator with <b>fill(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Random data generators are useful for
testing, so a set of inner classes is created to implement all the primitive
generator interfaces, as well as a <b>String</b> generator to represent <b>Object</b>.
You can see that <b>RandStringGenerator</b> uses <b>RandCharGenerator</b> to
fill an array of characters, which is then turned into a <b>String</b>. The
size of the array is determined by the constructor argument.</span></p>

<p class=MsoNormal><span lang=EN-US>To generate numbers that aren’t too large, <b>RandIntGenerator</b>
defaults to a modulus of 10,000, but the overloaded constructor allows you to
choose a smaller value.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s a program to test the library, and
to demonstrate how it is used:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:TestArrays2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Test and demonstrate
Arrays2 utilities</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class TestArrays2
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int size = 6;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Or get the size
from the command line:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length != 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      size =
Integer.parseInt(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    boolean[] a1 = new
boolean[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    byte[] a2 = new
byte[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    char[] a3 = new
char[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    short[] a4 = new
short[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] a5 = new
int[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long[] a6 = new
long[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    float[] a7 = new
float[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double[] a8 = new
double[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] a9 = new
String[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a1, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandBooleanGenerator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a1 = &quot;, a1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a1,
size/3, size/3 + size/3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a2,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandByteGenerator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a2 = &quot;, a2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a2,
size/3, size/3 + size/3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a3,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandCharGenerator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a3 = &quot;, a3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a3,
size/3, size/3 + size/3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a4,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandShortGenerator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a4);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(&quot;a4
= &quot;, a4);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a4,
size/3, size/3 + size/3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a5,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandIntGenerator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a5 = &quot;, a5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a5,
size/3, size/3 + size/3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a6,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandLongGenerator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a6);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a6 = &quot;, a6);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a6,
size/3, size/3 + size/3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a7,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandFloatGenerator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a7);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a7 = &quot;, a7);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a7,
size/3, size/3 + size/3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a8,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandDoubleGenerator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a8);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a8 = &quot;, a8);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a8,
size/3, size/3 + size/3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a9,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandStringGenerator(7));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a9);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a9 = &quot;, a9);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.print(a9,
size/3, size/3 + size/3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>size</b> parameter has a default
value, but you can also set it from the command line.</span></p>

<h3><a name="_Toc481064669"><span lang=EN-US>Filling an array</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The Java standard library <b>Arrays</b>
also has a <b>fill(&nbsp;)</b> method, but that is rather trivial—it only
duplicates a single value into each location, or in the case of objects, copies
the same reference into each location. Using <b>Arrays2.print(&nbsp;)</b>, the </span><span lang=EN-US><b>Arrays.fill(&nbsp;)</b> methods can be easily demonstrated:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:FillingArrays.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using Arrays.fill()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
FillingArrays {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int size = 6;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Or get the size from
the command line:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length != 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      size =
Integer.parseInt(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    boolean[] a1 = new
boolean[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    byte[] a2 = new
byte[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    char[] a3 = new
char[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    short[] a4 = new
short[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] a5 = new
int[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long[] a6 = new
long[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    float[] a7 = new
float[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double[] a8 = new
double[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] a9 = new
String[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(a1,
true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a1 = &quot;, a1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(a2,
(byte)11);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a2 = &quot;, a2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(a3,
'x');</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a3 = &quot;, a3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(a4,
(short)17);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a4 = &quot;, a4);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(a5, 19);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a5 = &quot;, a5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(a6, 23);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a6 = &quot;, a6);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(a7, 29);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a7 = &quot;, a7);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(a8, 47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a8 = &quot;, a8);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(a9,
&quot;Hello&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a9 = &quot;, a9);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Manipulating
ranges:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(a9, 3,
5, &quot;World&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;a9 = &quot;, a9);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can either fill the entire array, or—as
the last two statements show—a range of elements. But since you can only
provide a single value to use for filling using <b>Arrays.fill(&nbsp;)</b>, the
<b>Arrays2.fill(&nbsp;)</b> methods produce much more interesting results.</span></p>

<h3><a name="_Toc481064670"><span lang=EN-US>Copying an array</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The Java standard library provides a <b>static
</b>method, </span><span lang=EN-US><b>System.arraycopy(&nbsp;)</b>, which can
make much faster copies of an array than if you use a <b>for</b> loop to perform
the copy by hand. <b>System.arraycopy(&nbsp;) </b>is overloaded to handle all
types. Here’s an example that manipulates arrays of <b>int</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:CopyingArrays.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using
System.arraycopy()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class CopyingArrays
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] i = new
int[25];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] j = new
int[25];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(i, 47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(j, 99);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;i = &quot;, i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;j = &quot;, j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.arraycopy(i,
0, j, 0, i.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;j = &quot;, j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] k = new
int[10];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(k, 103);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.arraycopy(i,
0, k, 0, k.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;k = &quot;, k);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(k, 103);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.arraycopy(k,
0, i, 0, k.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;i = &quot;, i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Objects:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer[] u = new
Integer[10];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer[] v = new
Integer[5];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(u, new
Integer(47));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(v, new
Integer(99));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;u = &quot;, u);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;v = &quot;, v);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.arraycopy(v,
0, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      u, u.length/2,
v.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;u = &quot;, u);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The arguments to <b>arraycopy(&nbsp;)</b>
are the source array, the offset into the source array from whence to start
copying, the destination array, the offset into the destination array where the
copying begins, and the number of elements to copy. Naturally, any violation of
the array boundaries will cause an exception.</span></p>

<p class=MsoNormal><span lang=EN-US>The example shows that both primitive
arrays and object arrays can be copied. However, if you copy arrays of objects
then only the references get copied—there’s no duplication of the objects
themselves. This is called a <i>shallow copy</i> (see Appendix A).</span></p>

<h3><a name="_Toc375545350"></a><a name="_Toc481064671"><span lang=EN-US>Comparing
arrays</span></a></h3>

<p class=MsoNormal><span lang=EN-US><b>Arrays</b> provides the overloaded
method <b>equals(&nbsp;)</b> to compare entire arrays for equality. Again,
these are overloaded for all the primitives, and for <b>Object</b>. To be
equal, the arrays must have the same number of elements and each element must
be equivalent to each corresponding element in the other array, using the <b>equals(&nbsp;)
</b>for each element. (For primitives, that primitive’s wrapper class <b>equals(&nbsp;)</b>
is used; for example, <b>Integer.equals(&nbsp;) </b>for <b>int</b>.)<b> </b>Here’s
an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:ComparingArrays.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using Arrays.equals()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ComparingArrays {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] a1 = new
int[10];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] a2 = new
int[10];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(a1, 47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(a2, 47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(Arrays.equals(a1, a2));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a2[3] = 11;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(Arrays.equals(a1, a2));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] s1 = new
String[5];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.fill(s1,
&quot;Hi&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] s2 =
{&quot;Hi&quot;, &quot;Hi&quot;, &quot;Hi&quot;, &quot;Hi&quot;,
&quot;Hi&quot;};</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(Arrays.equals(s1, s2));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Originally, <b>a1</b> and <b>a2</b> are
exactly equal, so the output is “true,” but then one of the elements is changed
so the second line of output is “false.” In the last case, all the elements of <b>s1</b>
point to the same object, but <b>s2</b> has five unique objects. However, array
equality is based on contents (via <b>Object.equals(&nbsp;)</b>) and so the
result is “true.”</span></p>

<h3><a name="_Toc481064672"><span lang=EN-US>Array element comparisons</span></a></h3>

<p class=MsoNormal><span lang=EN-US>One of the missing features in the Java 1.0
and 1.1 libraries is algorithmic operations—even simple </span><span lang=EN-US>sorting. This was a rather confusing situation to someone expecting
an adequate standard library. Fortunately, Java 2 remedies the situation, at
least for the sorting problem.</span></p>

<p class=MsoNormal><span lang=EN-US>A problem with writing generic sorting code
is that sorting must perform comparisons based on the actual type of the
object. Of course, one approach is to write a different sorting method for
every different type, but you should be able to recognize that this does not
produce code that is easily reused for new types.</span></p>

<p class=MsoNormal><span lang=EN-US>A primary goal of programming design is to
“separate things that change from things that stay the same,” and here, the
code that stays the same is the general sort algorithm, but the thing that
changes from one use to the next is the way objects are compared. So instead of
hard-wiring the comparison code into many different sort routines, the technique
of the </span><span lang=EN-US><i>callback</i> is used. With a callback, the
part of the code that varies from case to case is encapsulated inside its own
class, and the part of the code that’s always the same will call back to the
code that changes. That way you can make different objects to express different
ways of comparison and feed them to the same sorting code.</span></p>

<p class=MsoNormal><span lang=EN-US>In Java 2, there are two ways to provide
comparison functionality. The first is with the <i>natural comparison method</i>
that is imparted to a class by implementing the <b>java.lang.Comparable</b>
interface. This is a very simple interface with a single method, </span><span lang=EN-US><b>compareTo(&nbsp;)</b>. This method takes another <b>Object</b> as
an argument, and produces a negative value if the argument is less than the
current object, zero if the argument is equal, and a positive value if the
argument is greater than the current object.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s a class that implements </span><span lang=EN-US><b>Comparable</b> and demonstrates the comparability by using the
Java standard library method <b>Arrays.sort(&nbsp;)</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:CompType.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Implementing
Comparable in a class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class CompType
implements Comparable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int j;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public CompType(int
n1, int n2) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = n1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    j = n2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return &quot;[i =
&quot; + i + &quot;, j = &quot; + j + &quot;]&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int
compareTo(Object rv) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int rvi =
((CompType)rv).i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return (i &lt; rvi ?
-1 : (i == rvi ? 0 : 1));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static Random
r = new Random();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static int
randInt() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
Math.abs(r.nextInt()) % 100;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static
Generator generator() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Generator() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public Object
next() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        return new
CompType(randInt(),randInt());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    CompType[] a = new
CompType[10];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a,
generator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;before sorting, a = &quot;, a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.sort(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;after sorting, a = &quot;, a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When you define the comparison function,
you are responsible for deciding what it means to compare one of your objects
to another. Here, only the <b>i</b> values are used in the comparison, and the <b>j</b>
values are ignored.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>static randInt(&nbsp;)</b> method
produces positive values between zero and 100, and the <b>generator(&nbsp;)</b>
method produces an object that implements the <b>Generator</b> interface, by
creating an anonymous inner class (see Chapter 8). This builds <b>CompType</b>
objects by initializing them with random values. In <b>main(&nbsp;)</b>, the
generator is used to fill an array of <b>CompType</b>, which is then sorted. If
<b>Comparable</b> hadn’t been implemented, then you’d get a compile-time error
message when you tried to call <b>sort(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Now suppose someone hands you a class that
doesn’t implement <b>Comparable</b>, or they hand you this class that <i>does</i>
implement <b>Comparable</b>, but you decide you don’t like the way it works and
would rather have a different comparison function for the type. To do this, you
use the second approach for comparing objects, by creating a separate class
that implements an interface called </span><span
lang=EN-US><b>Comparator</b>. This has two methods, <b>compare(&nbsp;)</b> and <b>equals(&nbsp;)</b>.
However, you don’t have to implement <b>equals(&nbsp;)</b> except for special
performance needs, because anytime you create a class it is implicitly
inherited from <b>Object</b>, which has an <b>equals(&nbsp;)</b>. So you can
just use the default <b>Object</b> <b>equals(&nbsp;)</b> and satisfy the
contract imposed by the interface.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Collections</b> class (which we’ll
look at more later) contains a single <b>Comparator</b> that reverses the
natural sorting order. This can easily be applied to the <b>CompType</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Reverse.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The
Collecions.reverseOrder() Comparator.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Reverse {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    CompType[] a = new
CompType[10];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a,
CompType.generator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;before sorting, a = &quot;, a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.sort(a,
Collections.reverseOrder());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;after sorting, a = &quot;, a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The call to <b>Collections.reverseOrder(&nbsp;)</b>
produces the reference to the <b>Comparator</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>As a second example, the following <b>Comparator</b>
compares <b>CompType</b> objects based on their <b>j</b> values rather than
their <b>i</b> values:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:ComparatorTest.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Implementing a
Comparator for a class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class CompTypeComparator
implements Comparator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int
compare(Object o1, Object o2) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int j1 =
((CompType)o1).j;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int j2 =
((CompType)o2).j;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return (j1 &lt; j2 ?
-1 : (j1 == j2 ? 0 : 1));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ComparatorTest {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    CompType[] a = new
CompType[10];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a,
CompType.generator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;before sorting, a = &quot;, a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.sort(a, new
CompTypeComparator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;after sorting, a = &quot;, a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>compare(&nbsp;)</b> method must
return a negative integer, zero, or a positive integer if the first argument is
less than, equal to, or greater than the second, respectively.</span></p>

<h3><a name="_Toc481064673"><span lang=EN-US>Sorting an array</span></a></h3>

<p class=MsoNormal><span lang=EN-US>With the built-in sorting methods, you can
sort any array of primitives, and any array of objects that either implements <b>Comparable</b>
or has an associated <b>Comparator</b>. This fills a big hole in the Java
libraries—believe it or not, there was no support in Java 1.0 or 1.1 for
sorting <b>String</b>s! Here’s an example that generates random <b>String</b>
objects and sorts them:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:StringSorting.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Sorting an array of
Strings.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
StringSorting {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] sa = new
String[30];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(sa,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandStringGenerator(5));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;Before sorting: &quot;, sa);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.sort(sa);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;After sorting: &quot;, sa);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>One thing you’ll notice about the output in
the <b>String</b> sorting algorithm is that it’s </span><span lang=EN-US><i>lexicographic</i>, so it puts all the words starting with
uppercase letters first, followed by all the words starting with lowercase
letters. (Telephone books are typically sorted this way.) You may also want to
group the words together regardless of case, and you can do this by defining a <b>Comparator
</b>class, thereby overriding the default <b>String Comparable </b>behavior.
For reuse, this will be added to the “util” package:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:util:AlphabeticComparator.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Keeping upper and
lowercase letters together.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
AlphabeticComparator </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>implements Comparator{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int
compare(Object o1, Object o2) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s1 =
(String)o1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s2 =
(String)o2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
s1.toLowerCase().compareTo(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s2.toLowerCase());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Each <b>String</b> is converted to
lowercase before the comparison. <b>String</b>’s built-in <b>compareTo(&nbsp;)</b>
method provides the desired functionality.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s a test using <b>AlphabeticComparator</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:AlphabeticSorting.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Keeping upper and
lowercase letters together.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
AlphabeticSorting {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] sa = new
String[30];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(sa,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandStringGenerator(5));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;Before sorting: &quot;, sa);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.sort(sa, new
AlphabeticComparator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;After sorting: &quot;, sa);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The sorting algorithm that’s used in the
Java standard library is designed to be optimal for the particular type you’re
sorting—a Quicksort for primitives, and a stable merge sort for objects. So you
shouldn’t need to spend any time worrying about performance unless your
profiling tool points you to the sorting process as a bottleneck.</span></p>

<h3><a name="_Toc481064674"><span lang=EN-US>Searching a sorted array</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Once an array is sorted, you can perform a
fast search for a particular item using </span><span
lang=EN-US><b>Arrays.binarySearch(&nbsp;)</b>. However, it’s very important
that you do not try to use </span><span
lang=EN-US><b>binarySearch(&nbsp;)</b> on an unsorted array; the results will
be unpredictable. The following example uses a <b>RandIntGenerator</b> to fill
an array, then to produces values to search for:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:ArraySearching.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using
Arrays.binarySearch().</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ArraySearching
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int[] a = new
int[100];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.RandIntGenerator gen = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandIntGenerator(1000);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(a,
gen);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.sort(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Arrays2.print(&quot;Sorted array: &quot;, a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int r =
gen.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int location =
Arrays.binarySearch(a, r);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(location &gt;=
0) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(&quot;Location of &quot; + r + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot; is
&quot; + location + &quot;, a[&quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          location +
&quot;] = &quot; + a[location]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        break; // Out of
while loop</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In the <b>while</b> loop, random values are
generated as search items, until one of them is found.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Arrays.binarySearch(&nbsp;)</span></b><span
lang=EN-US> produces a value greater than or equal to zero if the search item
is found. Otherwise, it produces a negative value representing the place that
the element should be inserted if you are maintaining the sorted array by hand.
The value produced is </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>-(insertion point)
- 1</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The insertion point is the index of the
first element greater than the key, or <b>a.size(&nbsp;)</b>, if all elements
in the array are less than the specified key.</span></p>

<p class=MsoNormal><span lang=EN-US>If the array contains duplicate elements,
there is no guarantee which one will be found. The algorithm is thus not really
designed to support duplicate elements, as much as tolerate them. If you need a
sorted list of nonduplicated elements, however, use a <b>TreeSet</b>, which
will be introduced later in this chapter. This takes care of all the details
for you automatically. Only in cases of performance bottlenecks should you
replace the <b>TreeSet</b> with a hand-maintained array.</span></p>

<p class=MsoNormal><span lang=EN-US>If you have sorted an object array using a <b>Comparator</b>
(primitive arrays do not allow sorting with a <b>Comparator</b>), you must
include that same <b>Comparator</b> when you perform a <b>binarySearch(&nbsp;)</b>
(using the overloaded version of the function that’s provided). For example,
the <b>AlphabeticSorting.java</b> program can be modified to perform a search:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:AlphabeticSearch.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Searching with a
Comparator.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
AlphabeticSearch {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] sa = new
String[30];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays2.fill(sa,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Arrays2.RandStringGenerator(5));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    AlphabeticComparator
comp =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
AlphabeticComparator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.sort(sa,
comp);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int index =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Arrays.binarySearch(sa, sa[10], comp);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Index = &quot; + index);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Comparator</b> must be passed to the
overloaded <b>binarySearch(&nbsp;)</b> as the third argument. In the above
example, success is guaranteed because the search item is plucked out of the
array itself.</span></p>

<h3><a name="_Toc481064675"><span lang=EN-US>Array summary</span></a></h3>

<p class=MsoNormal><span lang=EN-US>To summarize what you’ve seen so far, your
first and most efficient choice to hold a group of objects should be an array,
and you’re forced into this choice if you want to hold a group of primitives.
In the remainder of this chapter we’ll look at the more general case, when you
don’t know at the time you’re writing the program how many objects you’re going
to need, or if you need a more sophisticated way to store your objects. Java
provides a library of </span><span lang=EN-US><i>container classes</i> to solve
this problem, the basic types of which are </span><span
lang=EN-US><b>List</b>, </span><span lang=EN-US><b>Set</b>,<b> </b>and </span><span lang=EN-US><b>Map</b>. You can solve a surprising number of problems using these
tools.</span></p>

<p class=MsoNormal><span lang=EN-US>Among their other characteristics—<b>Set</b>,
for example, holds only one object of each value, and <b>Map</b> is an </span><span lang=EN-US><i>associative array</i> that lets you associate any object with any
other object—the Java container classes will automatically resize themselves.
So, unlike arrays, you can put in any number of objects and you don’t need to
worry about how big to make the container while you’re writing the program.</span></p>

<h2><a name="_Toc481064676"><span lang=EN-US>Introduction to containers</span></a></h2>

<p class=MsoNormal><span lang=EN-US>To me, container classes are one of the
most powerful tools for raw development because they significantly increase
your programming muscle. </span><span lang=EN-US>The Java 2 containers represent a thorough redesign</span><a
href="#_ftn47" name="_ftnref47" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[47]</span></span></span></span></a><span
lang=EN-US> of the rather poor showings in Java 1.0 and 1.1. Some of the
redesign makes things tighter and more sensible. It also fills out the
functionality of the containers library, providing the behavior of </span><span lang=EN-US>linked lists, </span><span lang=EN-US>queues, and </span><span lang=EN-US>deques (double-ended queues, pronounced “decks”).</span></p>

<p class=MsoNormal><span lang=EN-US>The design of a containers library is
difficult (true of most library design problems). In </span><span lang=EN-US>C++, the container classes covered the bases with many different
classes. This was better than what was available prior to the C++ container
classes (nothing), but it didn’t translate well into Java. On the other
extreme, I’ve seen a containers library that consists of a single class,
“container,” which acts like both a linear sequence and an associative array at
the same time. The Java 2 container library strikes a balance: the full
functionality that you expect from a mature container library, but easier to
learn and use than the C++ container classes and other similar container
libraries. The result can seem a bit odd in places. Unlike some of the
decisions made in the early Java libraries, these oddities were not accidents,
but carefully considered decisions based on trade-offs in complexity. It might
take you a little while to get comfortable with some aspects of the library,
but I think you’ll find yourself rapidly acquiring and using these new tools.</span></p>

<p class=MsoNormal><span lang=EN-US>The Java 2 container library takes the
issue of “holding your objects” and divides it into two distinct concepts: </span></p>

<p class=Numbered><b><span lang=EN-US>Collection</span></b><span lang=EN-US>: a
group of individual elements, often with some rule applied to them. A <b>List</b>
must hold the elements in a particular sequence, and a <b>Set</b> cannot have
any duplicate elements. (A <i>bag</i>, which is not implemented in the Java
container library—since <b>List</b>s provide you with enough of that
functionality—has no such rules.)</span></p>

<p class=Numbered><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>54.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></b><b><span
lang=EN-US>Map</span></b><span lang=EN-US>: a group of key-value object pairs.
At first glance, this might seem like it ought to be a <b>Collection</b> of
pairs, but when you try to implement it that way the design gets awkward, so it’s
clearer to make it a separate concept. On the other hand, it’s convenient to
look at portions of a <b>Map</b> by creating a <b>Collection</b> to represent
that portion. Thus, a <b>Map</b> can return a <b>Set</b> of its keys, a <b>Collection
</b>of its values, or a <b>Set </b>of its pairs. <b>Map</b>s, like arrays, can
easily be expanded to multiple dimensions without adding new concepts: you
simply make a <b>Map</b> whose values are <b>Map</b>s (and the values of <i>those</i>
<b>Map</b>s can be <b>Map</b>s, etc.).</span></p>

<p class=MsoNormal><span lang=EN-US>We will first look at the general features
of containers, then go into details, and finally learn why there are different
versions of some containers, and how to choose between them.</span></p>

<h3><a name="_Toc375545351"></a><a name="_Ref348399494"></a><a
name="_Toc481064677"><span lang=EN-US>Printing containers</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Unlike arrays, the containers print nicely
without any help. Here’s an example that also introduces you to the basic types
of containers:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:PrintingContainers.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Containers print
themselves automatically.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
PrintingContainers {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Collection
fill(Collection c) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
c.add(&quot;dog&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
c.add(&quot;dog&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
c.add(&quot;cat&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return c;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Map fill(Map m)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
m.put(&quot;dog&quot;, &quot;Bosco&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
m.put(&quot;dog&quot;, &quot;Spot&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
m.put(&quot;cat&quot;, &quot;Rags&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return m;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(fill(new ArrayList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(fill(new HashSet()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(fill(new HashMap()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>As mentioned before, there are two basic
categories in the Java container library. The distinction is based on the
number of items that are held in each location of the container. The <b>Collection</b>
category only holds one item in each location (the name is a bit misleading
since entire container libraries are often called “collections”). It includes
the <b>List</b>, which holds a group of items in a specified sequence, and the <b>Set</b>,
which only allows the addition of one item of each type. The <b>ArrayList </b>is
a type of <b>List</b>, and <b>HashSet </b>is a type of <b>Set</b>. To add items
to any <b>Collection</b>, there’s an <b>add(&nbsp;)</b> method.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Map</b> holds key-value pairs,
rather like a mini database. The above program uses one flavor of <b>Map</b>,<b>
</b>the <b>HashMap</b>. If you have a <b>Map</b> that associates states with
their capitals and you want to know the capital of Ohio, you look it up—almost
as if you were indexing into an array. (Maps are also called </span><span lang=EN-US><i>associative arrays</i>.) To add elements to a <b>Map</b> there’s a
<b>put(&nbsp;)</b> method that takes a key and a value as arguments. The above
example only shows adding elements and does not look the elements up after
they’re added. That will be shown later.</span></p>

<p class=MsoNormal><span lang=EN-US>The overloaded <b>fill(&nbsp;)</b> methods
fill <b>Collection</b>s and <b>Map</b>s, respectively. If you look at the
output, you can see that the default printing behavior (provided via the
container’s various <b>toString(&nbsp;)</b> methods) produces quite readable
results, so no additional printing support is necessary as it was with arrays:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>[dog, dog, cat]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>[cat, dog]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>{cat=Rags,
dog=Spot}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>A <b>Collection</b> is printed surrounded
by square braces, with each element separated by a comma. A <b>Map</b> is
surrounded by curly braces, with each key and value associated with an equal
sign (keys on the left, values on the right).</span></p>

<p class=MsoNormal><span lang=EN-US>You can also immediately see the basic
behavior of the different containers. The <b>List</b> holds the objects exactly
as they are entered, without any reordering or editing. The <b>Set</b>,
however, only accepts one of each object and it uses its own internal ordering
method (in general, you are only concerned with whether or not something is a
member of the <b>Set</b>, not the order in which it appears—for that you’d use
a <b>List</b>). And the <b>Map</b> also only accepts one of each type of item,
based on the key, and it also has its own internal ordering and does not care
about the order in which you enter the items.</span></p>

<h3><a name="_Toc481064678"><span lang=EN-US>Filling containers</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Although the problem of printing the
containers is taken care of, filling containers suffers from the same
deficiency as <b>java.util.Arrays</b>. Just like <b>Arrays</b>, there is a
companion class called <b>Collections</b> containing <b>static</b> utility
methods including one called </span><span
lang=EN-US><b>fill(&nbsp;)</b>. This <b>fill(&nbsp;)</b> also just duplicates a
single object reference throughout the container, and also only works for <b>List</b>
objects and not <b>Set</b>s or <b>Map</b>s:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:FillingLists.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The
Collections.fill() method.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
FillingLists {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    List list = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
list.add(&quot;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections.fill(list, &quot;Hello&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(list);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This method is made even less useful by the
fact that it can only replace elements that are already in the <b>List</b>, and
will not add new elements.</span></p>

<p class=MsoNormal><span lang=EN-US>To be able to create interesting examples,
here is a complementary <b>Collections2</b> library (part of <b>com.bruceeckel.util
</b>for convenience) with a <b>fill(&nbsp;)</b> method that uses a </span><span lang=EN-US>generator to add elements, and allows you to specify the number of
elements you want to <b>add(&nbsp;)</b>. The <b>Generator interface</b> defined
previously will work for <b>Collection</b>s, but the <b>Map</b> requires its
own generator <b>interface</b> since a pair of objects (one key and one value)
must be produced by each call to <b>next(&nbsp;)</b>. Here is the <b>Pair</b>
class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:util:Pair.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Pair {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object key,
value;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Pair(Object k, Object
v) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    key = k;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    value = v;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Next, the generator <b>interface</b> that
produces the <b>Pair</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:util:MapGenerator.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
MapGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Pair next();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>With these, a set of utilities for working
with the </span><span
lang=EN-US>container classes can be developed:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:util:Collections2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// To fill any type of
container </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// using a generator
object.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
Collections2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Fill an array using
a generator:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(Collection c,
Generator gen, int count) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; count; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      c.add(gen.next());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  fill(Map m,
MapGenerator gen, int count) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; count; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Pair p = gen.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      m.put(p.key,
p.value);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
RandStringPairGenerator</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements
MapGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private
Arrays2.RandStringGenerator gen;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public
RandStringPairGenerator(int len) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      gen = new
Arrays2.RandStringGenerator(len);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Pair next() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return new
Pair(gen.next(), gen.next());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Default object so
you don't have </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // to create your own:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static
RandStringPairGenerator rsp =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
RandStringPairGenerator(10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
StringPairGenerator</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements
MapGenerator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int index =
-1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private String[][]
d;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public
StringPairGenerator(String[][] data) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      d = data;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Pair next() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Force the index
to wrap:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      index = (index +
1) % d.length;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return new
Pair(d[index][0], d[index][1]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public
StringPairGenerator reset() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      index = -1; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return this;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Use a predefined
dataset:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static
StringPairGenerator geography =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new StringPairGenerator(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
CountryCapitals.pairs);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Produce a sequence
from a 2D array:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static class
StringGenerator</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements Generator {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private String[][]
d;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int
position;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int index =
-1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    StringGenerator(String[][]
data, int pos) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      d = data;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      position = pos;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Object next()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Force the index
to wrap:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      index = (index +
1) % d.length;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
d[index][position];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public
StringGenerator reset() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      index = -1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return this;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Use a predefined
dataset:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static
StringGenerator countries =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
StringGenerator(CountryCapitals.pairs,0);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static
StringGenerator capitals =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
StringGenerator(CountryCapitals.pairs,1);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Both versions of <b>fill(&nbsp;)</b> take
an argument that determines the number of items to add to the container. In
addition, there are two generators for the map: <b>RandStringPairGenerator</b>,
which creates any number of pairs of gibberish <b>String</b>s with length
determined by the constructor argument; and <b>StringPairGenerator</b>, which
produces pairs of <b>String</b>s given a two-dimensional array of <b>String</b>.
The <b>StringGenerator</b> also takes a two-dimensional array of <b>String </b>but
generates single items rather than <b>Pair</b>s.<b> </b>The <b>static rsp</b>, <b>geography</b>,<b>
countries</b>, and <b>capitals</b> objects provide prebuilt generators, the
last three using<b> </b>all the countries of the world and their capitals. Note
that if you try to create more pairs than are available, the generators will
loop around to the beginning, and if you are putting the pairs into a <b>Map</b>,
the duplicates will just be ignored.</span></p>

<p class=MsoNormal><span lang=EN-US>Here is the predefined dataset, which
consists of country names and their capitals. It is set in a small font to
prevent taking up unnecessary space:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: com:bruceeckel:util:CountryCapitals.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>public class CountryCapitals {</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>  public static final String[][] pairs = {</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    // Africa</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;ALGERIA&quot;,&quot;Algiers&quot;},
{&quot;ANGOLA&quot;,&quot;Luanda&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;BENIN&quot;,&quot;Porto-Novo&quot;},
{&quot;BOTSWANA&quot;,&quot;Gaberone&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;BURKINA FASO&quot;,&quot;Ouagadougou&quot;},
{&quot;BURUNDI&quot;,&quot;Bujumbura&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;CAMEROON&quot;,&quot;Yaounde&quot;},
{&quot;CAPE VERDE&quot;,&quot;Praia&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;CENTRAL AFRICAN
REPUBLIC&quot;,&quot;Bangui&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;CHAD&quot;,&quot;N'djamena&quot;}, 
{&quot;COMOROS&quot;,&quot;Moroni&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;CONGO&quot;,&quot;Brazzaville&quot;},
{&quot;DJIBOUTI&quot;,&quot;Dijibouti&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;EGYPT&quot;,&quot;Cairo&quot;},
{&quot;EQUATORIAL GUINEA&quot;,&quot;Malabo&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;ERITREA&quot;,&quot;Asmara&quot;},
{&quot;ETHIOPIA&quot;,&quot;Addis Ababa&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;GABON&quot;,&quot;Libreville&quot;},
{&quot;THE GAMBIA&quot;,&quot;Banjul&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;GHANA&quot;,&quot;Accra&quot;},
{&quot;GUINEA&quot;,&quot;Conakry&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;GUINEA&quot;,&quot;-&quot;},
{&quot;BISSAU&quot;,&quot;Bissau&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;CETE D'IVOIR (IVORY
COAST)&quot;,&quot;Yamoussoukro&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;KENYA&quot;,&quot;Nairobi&quot;},
{&quot;LESOTHO&quot;,&quot;Maseru&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;LIBERIA&quot;,&quot;Monrovia&quot;},
{&quot;LIBYA&quot;,&quot;Tripoli&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;MADAGASCAR&quot;,&quot;Antananarivo&quot;},
{&quot;MALAWI&quot;,&quot;Lilongwe&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;MALI&quot;,&quot;Bamako&quot;},
{&quot;MAURITANIA&quot;,&quot;Nouakchott&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;MAURITIUS&quot;,&quot;Port Louis&quot;},
{&quot;MOROCCO&quot;,&quot;Rabat&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;MOZAMBIQUE&quot;,&quot;Maputo&quot;},
{&quot;NAMIBIA&quot;,&quot;Windhoek&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;NIGER&quot;,&quot;Niamey&quot;},
{&quot;NIGERIA&quot;,&quot;Abuja&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;RWANDA&quot;,&quot;Kigali&quot;}, {&quot;SAO
TOME E PRINCIPE&quot;,&quot;Sao Tome&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;SENEGAL&quot;,&quot;Dakar&quot;},
{&quot;SEYCHELLES&quot;,&quot;Victoria&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;SIERRA LEONE&quot;,&quot;Freetown&quot;},
{&quot;SOMALIA&quot;,&quot;Mogadishu&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;SOUTH AFRICA&quot;,&quot;Pretoria/Cape
Town&quot;}, {&quot;SUDAN&quot;,&quot;Khartoum&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;SWAZILAND&quot;,&quot;Mbabane&quot;},
{&quot;TANZANIA&quot;,&quot;Dodoma&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;TOGO&quot;,&quot;Lome&quot;},
{&quot;TUNISIA&quot;,&quot;Tunis&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;UGANDA&quot;,&quot;Kampala&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;DEMOCRATIC REPUBLIC OF THE CONGO
(ZAIRE)&quot;,&quot;Kinshasa&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;ZAMBIA&quot;,&quot;Lusaka&quot;},
{&quot;ZIMBABWE&quot;,&quot;Harare&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    // Asia</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;AFGHANISTAN&quot;,&quot;Kabul&quot;},
{&quot;BAHRAIN&quot;,&quot;Manama&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;BANGLADESH&quot;,&quot;Dhaka&quot;},
{&quot;BHUTAN&quot;,&quot;Thimphu&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;BRUNEI&quot;,&quot;Bandar Seri
Begawan&quot;}, {&quot;CAMBODIA&quot;,&quot;Phnom Penh&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;CHINA&quot;,&quot;Beijing&quot;},
{&quot;CYPRUS&quot;,&quot;Nicosia&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;INDIA&quot;,&quot;New Delhi&quot;},
{&quot;INDONESIA&quot;,&quot;Jakarta&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;IRAN&quot;,&quot;Tehran&quot;},
{&quot;IRAQ&quot;,&quot;Baghdad&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;ISRAEL&quot;,&quot;Jerusalem&quot;},
{&quot;JAPAN&quot;,&quot;Tokyo&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;JORDAN&quot;,&quot;Amman&quot;},
{&quot;KUWAIT&quot;,&quot;Kuwait City&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;LAOS&quot;,&quot;Vientiane&quot;},
{&quot;LEBANON&quot;,&quot;Beirut&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;MALAYSIA&quot;,&quot;Kuala Lumpur&quot;},
{&quot;THE MALDIVES&quot;,&quot;Male&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;MONGOLIA&quot;,&quot;Ulan Bator&quot;},
{&quot;MYANMAR (BURMA)&quot;,&quot;Rangoon&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;NEPAL&quot;,&quot;Katmandu&quot;},
{&quot;NORTH KOREA&quot;,&quot;P'yongyang&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;OMAN&quot;,&quot;Muscat&quot;}, {&quot;PAKISTAN&quot;,&quot;Islamabad&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;PHILIPPINES&quot;,&quot;Manila&quot;},
{&quot;QATAR&quot;,&quot;Doha&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;SAUDI ARABIA&quot;,&quot;Riyadh&quot;},
{&quot;SINGAPORE&quot;,&quot;Singapore&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;SOUTH KOREA&quot;,&quot;Seoul&quot;},
{&quot;SRI LANKA&quot;,&quot;Colombo&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;SYRIA&quot;,&quot;Damascus&quot;},
{&quot;TAIWAN (REPUBLIC OF CHINA)&quot;,&quot;Taipei&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;THAILAND&quot;,&quot;Bangkok&quot;},
{&quot;TURKEY&quot;,&quot;Ankara&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;UNITED ARAB EMIRATES&quot;,&quot;Abu
Dhabi&quot;}, {&quot;VIETNAM&quot;,&quot;Hanoi&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;YEMEN&quot;,&quot;Sana'a&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    // Australia and Oceania</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;AUSTRALIA&quot;,&quot;Canberra&quot;},
{&quot;FIJI&quot;,&quot;Suva&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;KIRIBATI&quot;,&quot;Bairiki&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;MARSHALL ISLANDS&quot;,&quot;Dalap-Uliga-Darrit&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;MICRONESIA&quot;,&quot;Palikir&quot;},
{&quot;NAURU&quot;,&quot;Yaren&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;NEW ZEALAND&quot;,&quot;Wellington&quot;},
{&quot;PALAU&quot;,&quot;Koror&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;PAPUA NEW GUINEA&quot;,&quot;Port
Moresby&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;SOLOMON ISLANDS&quot;,&quot;Honaira&quot;},
{&quot;TONGA&quot;,&quot;Nuku'alofa&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;TUVALU&quot;,&quot;Fongafale&quot;}, {&quot;VANUATU&quot;,&quot;&lt;
Port-Vila&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;WESTERN SAMOA&quot;,&quot;Apia&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    // Eastern Europe and former USSR </span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;ARMENIA&quot;,&quot;Yerevan&quot;},
{&quot;AZERBAIJAN&quot;,&quot;Baku&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;BELARUS
(BYELORUSSIA)&quot;,&quot;Minsk&quot;},
{&quot;GEORGIA&quot;,&quot;Tbilisi&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;KAZAKSTAN&quot;,&quot;Almaty&quot;},
{&quot;KYRGYZSTAN&quot;,&quot;Alma-Ata&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;MOLDOVA&quot;,&quot;Chisinau&quot;},
{&quot;RUSSIA&quot;,&quot;Moscow&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;TAJIKISTAN&quot;,&quot;Dushanbe&quot;},
{&quot;TURKMENISTAN&quot;,&quot;Ashkabad&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;UKRAINE&quot;,&quot;Kyiv&quot;},
{&quot;UZBEKISTAN&quot;,&quot;Tashkent&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    // Europe </span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;ALBANIA&quot;,&quot;Tirana&quot;},
{&quot;ANDORRA&quot;,&quot;Andorra la Vella&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;AUSTRIA&quot;,&quot;Vienna&quot;},
{&quot;BELGIUM&quot;,&quot;Brussels&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;BOSNIA&quot;,&quot;-&quot;},
{&quot;HERZEGOVINA&quot;,&quot;Sarajevo&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;CROATIA&quot;,&quot;Zagreb&quot;},
{&quot;CZECH REPUBLIC&quot;,&quot;Prague&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;DENMARK&quot;,&quot;Copenhagen&quot;},
{&quot;ESTONIA&quot;,&quot;Tallinn&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;FINLAND&quot;,&quot;Helsinki&quot;},
{&quot;FRANCE&quot;,&quot;Paris&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;GERMANY&quot;,&quot;Berlin&quot;},
{&quot;GREECE&quot;,&quot;Athens&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;HUNGARY&quot;,&quot;Budapest&quot;},
{&quot;ICELAND&quot;,&quot;Reykjavik&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;IRELAND&quot;,&quot;Dublin&quot;},
{&quot;ITALY&quot;,&quot;Rome&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;LATVIA&quot;,&quot;Riga&quot;},
{&quot;LIECHTENSTEIN&quot;,&quot;Vaduz&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;LITHUANIA&quot;,&quot;Vilnius&quot;},
{&quot;LUXEMBOURG&quot;,&quot;Luxembourg&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;MACEDONIA&quot;,&quot;Skopje&quot;},
{&quot;MALTA&quot;,&quot;Valletta&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;MONACO&quot;,&quot;Monaco&quot;},
{&quot;MONTENEGRO&quot;,&quot;Podgorica&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;THE
NETHERLANDS&quot;,&quot;Amsterdam&quot;},
{&quot;NORWAY&quot;,&quot;Oslo&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;POLAND&quot;,&quot;Warsaw&quot;},
{&quot;PORTUGAL&quot;,&quot;Lisbon&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;ROMANIA&quot;,&quot;Bucharest&quot;},
{&quot;SAN MARINO&quot;,&quot;San Marino&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;SERBIA&quot;,&quot;Belgrade&quot;},
{&quot;SLOVAKIA&quot;,&quot;Bratislava&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;SLOVENIA&quot;,&quot;Ljujiana&quot;},
{&quot;SPAIN&quot;,&quot;Madrid&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;SWEDEN&quot;,&quot;Stockholm&quot;},
{&quot;SWITZERLAND&quot;,&quot;Berne&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;UNITED KINGDOM&quot;,&quot;London&quot;},
{&quot;VATICAN CITY&quot;,&quot;---&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    // North and Central America</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;ANTIGUA AND BARBUDA&quot;,&quot;Saint
John's&quot;}, {&quot;BAHAMAS&quot;,&quot;Nassau&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;BARBADOS&quot;,&quot;Bridgetown&quot;},
{&quot;BELIZE&quot;,&quot;Belmopan&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;CANADA&quot;,&quot;Ottawa&quot;},
{&quot;COSTA RICA&quot;,&quot;San Jose&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;CUBA&quot;,&quot;Havana&quot;},
{&quot;DOMINICA&quot;,&quot;Roseau&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;DOMINICAN REPUBLIC&quot;,&quot;Santo
Domingo&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;EL SALVADOR&quot;,&quot;San Salvador&quot;},
{&quot;GRENADA&quot;,&quot;Saint George's&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;GUATEMALA&quot;,&quot;Guatemala City&quot;},
{&quot;HAITI&quot;,&quot;Port-au-Prince&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;HONDURAS&quot;,&quot;Tegucigalpa&quot;},
{&quot;JAMAICA&quot;,&quot;Kingston&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;MEXICO&quot;,&quot;Mexico City&quot;},
{&quot;NICARAGUA&quot;,&quot;Managua&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;PANAMA&quot;,&quot;Panama City&quot;},
{&quot;ST. KITTS&quot;,&quot;-&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;NEVIS&quot;,&quot;Basseterre&quot;},
{&quot;ST. LUCIA&quot;,&quot;Castries&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;ST. VINCENT AND THE
GRENADINES&quot;,&quot;Kingstown&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;UNITED STATES OF
AMERICA&quot;,&quot;Washington, D.C.&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    // South America</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;ARGENTINA&quot;,&quot;Buenos Aires&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;BOLIVIA&quot;,&quot;Sucre (legal)/La
Paz(administrative)&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;BRAZIL&quot;,&quot;Brasilia&quot;},
{&quot;CHILE&quot;,&quot;Santiago&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;COLOMBIA&quot;,&quot;Bogota&quot;},
{&quot;ECUADOR&quot;,&quot;Quito&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;GUYANA&quot;,&quot;Georgetown&quot;},
{&quot;PARAGUAY&quot;,&quot;Asuncion&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;PERU&quot;,&quot;Lima&quot;},
{&quot;SURINAME&quot;,&quot;Paramaribo&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;TRINIDAD AND TOBAGO&quot;,&quot;Port of
Spain&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    {&quot;URUGUAY&quot;,&quot;Montevideo&quot;},
{&quot;VENEZUELA&quot;,&quot;Caracas&quot;},</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>  };</span></p>

<p class=CodeInline style='margin-left:0cm;line-height:normal'><span
lang=EN-US style='font-size:9.0pt'>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This is simply a two-dimensional array of <b>String</b>
data</span><a href="#_ftn48" name="_ftnref48" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[48]</span></span></span></span></a><span lang=EN-US>.
Here’s a simple test using the <b>fill(&nbsp;)</b> methods and generators:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:FillTest.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class FillTest {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Generator sg = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Arrays2.RandStringGenerator(7);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    List list = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections2.fill(list, sg, 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(list + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    List list2 = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections2.fill(list2, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.capitals, 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(list2 + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Set set = new
HashSet();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections2.fill(set, sg, 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(set + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Map m = new
HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(m,
Collections2.rsp, 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(m
+ &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Map m2 = new
HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections2.fill(m2, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.geography, 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(m2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>With these tools you can easily test the
various containers by filling them with interesting data.</span></p>

<h2><a name="_Toc481064679"><span lang=EN-US>Container disadvantage: <br>
unknown type</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The “disadvantage” to using the Java
containers is that you lose type information when you put an object into a
container. This happens because the programmer of that container class had no
idea what specific type you wanted to put in the container, and making the
container hold only your type would prevent it from being a general-purpose
tool. So instead, the container holds references to <b>Object</b>, which is the
root of all the classes so it holds any type. (Of course, this doesn’t include
primitive types, since they aren’t inherited from anything.) This is a great
solution, except: </span></p>

<p class=Numbered><span lang=EN-US>Since the type information is thrown away when
you put an object reference into a container, there’s no restriction on the
type of object that can be put into your container, even if you mean it to hold
only, say, cats. Someone could just as easily put a dog into the container.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>55.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Since the type information is lost, the only thing the container
knows that it holds is a reference to an object. You must perform a cast to the
correct type before you use it.</span></p>

<p class=MsoNormal><span lang=EN-US>On the up side, Java won’t let you <i>misuse</i>
the objects that you put into a container. If you throw a dog into a container
of cats and then try to treat everything in the container as a cat, you’ll get
a run-time exception when you pull the dog reference out of the cat container
and try to cast it to a cat.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example using the basic workhorse
container, <b>ArrayList</b>. For starters, you can think of <b>ArrayList</b> as
“an array that automatically expands itself.” Using an <b>ArrayList</b> is
straightforward: create one, put objects in using </span><span lang=EN-US><b>add(&nbsp;),</b> and later get them out with </span><span lang=EN-US><b>get(&nbsp;) </b>using an index—just like you would with an array
but without the square brackets</span><a href="#_ftn49" name="_ftnref49"
title=""><span class=MsoFootnoteReference><span lang=EN-US style='font-size:
8.0pt'><span class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;
font-family:"Georgia","serif"'>[49]</span></span></span></span></a><span
lang=EN-US>. <b>ArrayList</b> also has a method </span><span lang=EN-US><b>size(&nbsp;)</b> to let you know how many elements have been added
so you don’t inadvertently run off the end and cause an exception.</span></p>

<p class=MsoNormal><span lang=EN-US>First, <b>Cat</b> and <b>Dog</b> classes
are created:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Cat.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Cat {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int catNumber;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Cat(int i) { catNumber
= i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void print() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Cat #&quot; + catNumber);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Dog.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Dog {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int dogNumber;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Dog(int i) { dogNumber
= i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void print() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Dog #&quot; + dogNumber);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>Cat</span></b><span lang=EN-US>s and <b>Dog</b>s
are placed into the container, then pulled out:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:CatsAndDogs.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Simple container
example.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class CatsAndDogs
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList cats = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 7; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cats.add(new
Cat(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Not a problem to
add a dog to cats:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cats.add(new
Dog(7));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; cats.size(); i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
((Cat)cats.get(i)).print();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Dog is detected
only at run-time</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The classes <b>Cat</b> and <b>Dog</b> are
distinct—they have nothing in common except that they are <b>Object</b>s. (If
you don’t explicitly say what class you’re inheriting from, you automatically
inherit from <b>Object</b>.) Since <b>ArrayList</b> holds <b>Object</b>s, you
can not only put <b>Cat</b> objects into this container using the <b>ArrayList </b>method
<b>add(&nbsp;)</b>, but you can also add <b>Dog</b> objects without complaint
at either compile-time or run-time. When you go to fetch out what you think are
<b>Cat</b> objects using the <b>ArrayList</b> method <b>get(&nbsp;)</b>, you
get back a reference to an object that you must cast to a <b>Cat</b>. Then you
need to surround the entire expression with parentheses to force the evaluation
of the cast before calling the <b>print(&nbsp;)</b> method for <b>Cat</b>,
otherwise you’ll get a syntax error. Then, at run-time, when you try to cast
the <b>Dog</b> object to a <b>Cat</b>, you’ll get an exception.</span></p>

<p class=MsoNormal><span lang=EN-US>This is more than just an annoyance. It’s
something that can create difficult-to-find bugs. If one part (or several
parts) of a program inserts objects into a container, and you discover only in
a separate part of the program through an exception that a bad object was
placed in the container, then you must find out where the bad insert occurred.
On the upside, it’s convenient to start with some standardized container
classes for programming, despite the scarcity and awkwardness.</span></p>

<h3><a name="_Toc481064680"><span lang=EN-US>Sometimes it works anyway</span></a></h3>

<p class=MsoNormal><span lang=EN-US>It turns out that in some cases things seem
to work correctly without casting back to your original type. One case is quite
special: the <b>String</b> class has some extra help from the compiler to make
it work smoothly. Whenever the compiler expects a <b>String</b> object and it
hasn’t got one, it will automatically call the </span><span lang=EN-US><b>toString(&nbsp;)</b> method that’s defined in <b>Object</b> and
can be overridden by any Java class. This method produces the desired <b>String</b>
object, which is then used wherever it was wanted.</span></p>

<p class=MsoNormal><span lang=EN-US>Thus, all you need to do to make objects of
your class print is to override the <b>toString(&nbsp;)</b> method, as shown in
the following example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Mouse.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Overriding
toString().</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Mouse {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int
mouseNumber;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Mouse(int i) {
mouseNumber = i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Override
Object.toString():</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return &quot;This is
Mouse #&quot; + mouseNumber;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int getNumber()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return mouseNumber;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:WorksAnyway.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// In special cases,
things just </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// seem to work
correctly.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MouseTrap {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
caughtYa(Object m) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Mouse mouse =
(Mouse)m; // Cast from Object</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Mouse: &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
mouse.getNumber());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class WorksAnyway
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList mice = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 3; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      mice.add(new
Mouse(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; mice.size(); i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // No cast
necessary, automatic </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // call to
Object.toString():</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Free
mouse: &quot; + mice.get(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
MouseTrap.caughtYa(mice.get(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see <b>toString(&nbsp;)</b>
overridden in <b>Mouse</b>. In the second <b>for</b> loop in <b>main(&nbsp;)</b>
you find the statement:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>System.out.println(&quot;Free
mouse: &quot; + mice.get(i));</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>After the ‘<b>+</b>’ sign the compiler
expects to see a </span><span
lang=EN-US><b>String</b> object. <b>get(&nbsp;)</b> produces an <b>Object</b>,
so to get the desired <b>String</b> the compiler implicitly calls <b>toString(&nbsp;)</b>.
Unfortunately, you can work this kind of magic only with <b>String</b>; it
isn’t available for any other type.</span></p>

<p class=MsoNormal><span lang=EN-US>A second approach to hiding the cast has
been placed inside <b>MouseTrap</b>. The <b>caughtYa(&nbsp;)</b> method accepts
not a <b>Mouse</b>, but an <b>Object,</b> which it then casts to a <b>Mouse</b>.
This is quite presumptuous, of course, since by accepting an <b>Object</b>
anything could be passed to the method. However, if the cast is incorrect—if
you passed the wrong type—you’ll get an exception at run-time. This is not as
good as compile-time checking but it’s still robust. Note that in the use of
this method:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>MouseTrap.caughtYa(mice.get(i));</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>no cast is necessary.</span></p>

<h3><a name="_Toc481064681"><span lang=EN-US>Making a type-conscious <b>ArrayList</b></span></a></h3>

<p class=MsoNormal><span
lang=EN-US>You might not want to give up on this issue just yet. A more
ironclad solution is to create a new class using the <b>ArrayList</b>, such
that it will accept only your type and produce only your type:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:MouseList.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A type-conscious
ArrayList.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class MouseList {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private ArrayList list
= new ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void add(Mouse
m) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    list.add(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Mouse get(int
index) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
(Mouse)list.get(index);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int size() {
return list.size(); }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s a test for the new container:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:MouseListTest.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
MouseListTest {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MouseList mice = new
MouseList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 3; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      mice.add(new
Mouse(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; mice.size(); i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
MouseTrap.caughtYa(mice.get(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This is similar to the previous example,
except that the new <b>MouseList</b> class has a <b>private </b>member of type <b>ArrayList</b>,
and methods just like <b>ArrayList</b>. However, it doesn’t accept and produce
generic <b>Object</b>s, only <b>Mouse</b> objects. </span></p>

<p class=MsoNormal><span lang=EN-US>Note that if <b>MouseList</b> had instead
been <i>inherited</i> from <b>ArrayList</b>, the <b>add(</b><b>Mouse)</b>
method would simply overload the existing <b>add(Object)</b> and there would
still be no restriction on what type of objects could be added. Thus, the <b>MouseList</b>
becomes a <i>surrogate</i> to the <b>ArrayList</b>, performing some activities
before passing on the responsibility (see <i>Thinking in Patterns with Java</i>,
downloadable at <i>www.BruceEckel.com</i>).</span></p>

<p class=MsoNormal><span lang=EN-US>Because a <b>MouseList</b> will accept only
a <b>Mouse</b>, if you say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>mice.add(new
Pigeon());</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>you will get an error message <i>at
compile-time</i>. This approach, while more tedious from a coding standpoint,
will tell you immediately if you’re using a type improperly.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that no cast is necessary when using <b>get(&nbsp;)</b>—it’s
always a <b>Mouse</b>.</span></p>

<h4><span lang=EN-US>Parameterized types</span></h4>

<p class=MsoNormal><span lang=EN-US>This kind of problem isn’t isolated—there
are numerous cases in which you need to create new types based on other types,
and in which it is useful to have specific type information at compile-time.
This is the concept of a </span><span lang=EN-US><i>parameterized type</i>. In C++, this is directly supported by the
language with </span><span lang=EN-US><i>templates</i>. It is likely that a
future version of Java will support some variation of parameterized types; the
current front-runner automatically creates classes similar to <b>MouseList</b>.</span></p>

<h2><a name="_Toc481064682"></a><a name="_Toc375545352"><span lang=EN-US>Iterators</span></a></h2>

<p class=MsoNormal><span lang=EN-US>In any container class, you must have a way
to put things in and a way to get things out. After all, that’s the primary job
of a container—to hold things. In the </span><span
lang=EN-US><b>ArrayList</b>, <b>add(&nbsp;)</b> is the way that you insert
objects, and <b>get(&nbsp;)</b> is <i>one</i> way to get things out. <b>ArrayList</b>
is quite flexible—you can select anything at any time, and select multiple
elements at once using different indexes.</span></p>

<p class=MsoNormal><span lang=EN-US>If you want to start thinking at a higher
level, there’s a drawback: you need to know the exact type of the container in
order to use it. This might not seem bad at first, but what if you start out
using an <b>ArrayList</b>, and later on in your program you discover that
because of the way you are using the container it would be much more efficient
to use a <b>Linked</b><b>List</b> instead? Or suppose you’d like to write a
piece of generic code that doesn’t know or care what type of container it’s
working with, so that it could be used on different types of containers without
rewriting that code?</span></p>

<p class=MsoNormal><span lang=EN-US>The concept of an </span><span
lang=EN-US><i>iterator</i> can be used to achieve this abstraction. An iterator
is an object whose job is to move through a sequence of objects and select each
object in that sequence without the client programmer knowing or caring about
the underlying structure of that sequence. In addition, an iterator is usually
what’s called a “light-weight” object: one that’s cheap to create. For that
reason, you’ll often find seemingly strange constraints for iterators; for
example, some iterators can move in only one direction.</span></p>

<p class=MsoNormal><span lang=EN-US>The Java <b>Iterator</b> is an example of
an iterator with these kinds of constraints. There’s not much you can do with
one except</span><span lang=EN-US>:</span></p>

<p class=Numbered><span lang=EN-US>Ask a container to hand you an <b>Iterator</b>
using a method called <b>iterator(&nbsp;)</b>.<b> </b>This <b>Iterator </b>will
be ready to return the first element in the sequence on your first call to its <b>next(&nbsp;)</b>
method.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>56.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Get the next object in the sequence with <b>next(&nbsp;)</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>57.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>See if there <i>are</i> any more objects in the sequence with <b>hasNext(&nbsp;)</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>58.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Remove the last element returned by the iterator with <b>remove(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>That’s all. It’s a simple implementation of
an iterator, but still powerful (and there’s a more sophisticated <b>ListIterator</b>
for <b>List</b>s). To see how it works, let’s revisit the <b>CatsAndDogs.java</b>
program from earlier in this chapter. In the original version, the method <b>get(&nbsp;)</b>
was used to select each element, but in the following modified version an
Iterator is used:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:CatsAndDogs2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Simple container with
Iterator.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
CatsAndDogs2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList cats = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 7; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cats.add(new Cat(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator e =
cats.iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(e.hasNext())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
((Cat)e.next()).print();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the last few lines now use
an <b>Iterator</b> to step through the sequence instead of a <b>for</b> loop.
With the <b>Iterator</b>, you don’t need to worry about the number of elements
in the container. That’s taken care of for you by </span><span lang=EN-US><b>hasNext(&nbsp;)</b> and </span><span lang=EN-US><b>next(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>As another example, consider the creation
of a general-purpose printing method:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:HamsterMaze.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using an Iterator.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Hamster {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int
hamsterNumber;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Hamster(int i) {
hamsterNumber = i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return &quot;This is
Hamster #&quot; + hamsterNumber;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Printer {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
printAll(Iterator e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(e.hasNext())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(e.next());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class HamsterMaze
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList v = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 3; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v.add(new
Hamster(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Printer.printAll(v.iterator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Look closely at <b>printAll(&nbsp;)</b>.
Note that there’s no information about the type of sequence. All you have is an
<b>Iterator</b>, and that’s all you need to know about the sequence: that you
can get the next object, and that you can know when you’re at the end. This
idea of taking a container of objects and passing through it to perform an
operation on each one is powerful, and will be seen throughout this book.</span></p>

<p class=MsoNormal><span lang=EN-US>The example is even more generic, since it
implicitly uses the <b>Object.</b><b>toString(&nbsp;)</b> method. The <b>println(&nbsp;)</b>
method is overloaded for all the primitive types as well as <b>Object</b>; in
each case a <b>String</b> is automatically produced by calling the appropriate <b>toString(&nbsp;)</b>
method. </span></p>

<p class=MsoNormal><span lang=EN-US>Although it’s unnecessary, you can be more
explicit using a cast, which has the effect of calling <b>toString(&nbsp;)</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>System.out.println((String)e.next());</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In general, however, you’ll want to do
something more than call <b>Object</b> methods, so you’ll run up against the
type-casting issue again. You must assume you’ve gotten an <b>Iterator</b> to a
sequence of the particular type you’re interested in, and cast the resulting
objects to that type (getting a run-time exception if you’re wrong).</span></p>

<h4><span lang=EN-US>Unintended recursion</span></h4>

<p class=MsoNormal><span lang=EN-US>Because (like every other class), </span><span lang=EN-US>the Java standard containers are inherited from <b>Object</b>, they<b>
</b>contain a <b>toString(&nbsp;)</b> method. This has been overridden so that
they can produce a <b>String</b> representation of themselves, including the
objects they hold. Inside <b>ArrayList</b>, for example, the <b>toString(&nbsp;)</b>
steps through the elements of the <b>ArrayList</b> and calls <b>toString(&nbsp;)</b>
for each one. Suppose you’d like to print the address of your class. It seems
to make sense to simply refer to <b>this </b>(in particular, C++ programmers
are prone to this approach):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:InfiniteRecursion.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Accidental recursion.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
InfiniteRecursion {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String toString()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return &quot;
InfiniteRecursion address: &quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      + this +
&quot;\n&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList v = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v.add(new
InfiniteRecursion());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(v);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you simply create an <b>InfiniteRecursion</b>
object and then print it, you’ll get an endless sequence of exceptions. This is
also true if you place the <b>InfiniteRecursion</b> objects in an <b>ArrayList</b>
and print that <b>ArrayList</b> as shown here. What’s happening is automatic
type conversion for <b>String</b>s. When you say: </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&quot;InfiniteRecursion
address: &quot; + this</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The compiler sees a <b>String</b> followed
by a ‘<b>+</b>’ and<b> </b>something that’s not a <b>String</b>, so it tries to
convert <b>this</b> to a <b>String</b>. It does this conversion by calling <b>toString(&nbsp;)</b>,
which produces a </span><span lang=EN-US>recursive call. </span></p>

<p class=MsoNormal><span lang=EN-US>If you really do want to print the address
of the object in this case, the solution is to call the <b>Object</b> <b>toString(&nbsp;)</b>
method, which does just that. So instead of saying <b>this</b>, you’d say <b>super.toString(&nbsp;)</b>.
(This only works if you're directly inheriting from <b>Object</b>, or if none
of your parent classes have overridden the <b>toString(&nbsp;)</b> method.)</span></p>

<h2><a name="_Toc375545359"></a><a name="_Toc481064683"><span lang=EN-US>Container
taxonomy</span></a></h2>

<p class=MsoNormal><b><span lang=EN-US>Collection</span></b><span lang=EN-US>s
and <b>Map</b>s may be implemented in different ways, according to your programming
needs. It’s helpful to look at a diagram of the Java 2 containers:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=478 height=432 src="TIJ2_files/image028.png"></span></p>

<p class=MsoNormal><span lang=EN-US>This diagram can be a bit overwhelming at
first, but you’ll see that there are really only three container components: <b>Map</b>,
<b>List</b>, and <b>Set</b>, and only two or three implementations of each one
(with, typically, a preferred version). When you see this, the containers are
not so daunting.</span></p>

<p class=MsoNormal><span lang=EN-US>The dotted boxes represent <b>interface</b>s,
the dashed boxes represent <b>abstract</b> classes, and the solid boxes are
regular (concrete) classes. The dotted-line arrows indicate that a particular
class is implementing an <b>interface</b> (or in the case of an <b>abstract</b>
class, partially implementing that <b>interface</b>). The solid arrows show
that a class can produce objects of the class the arrow is pointing to. For
example, any <b>Collection</b> can produce an <b>Iterator</b>, while a <b>List</b>
can produce a <b>ListIterator</b> (as well as an ordinary <b>Iterator</b>,
since <b>List</b> is inherited from <b>Collection</b>).</span></p>

<p class=MsoNormal><span lang=EN-US>The interfaces that are concerned with
holding objects are <b>Collection</b>, <b>List</b>, <b>Set</b>, and <b>Map</b>.<b>
</b>Ideally, you’ll write most of your code to talk to these interfaces, and
the only place where you’ll specify the precise type you’re using is at the
point of creation. So you can create a <b>List</b> like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>List x = new
LinkedList();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, you can also decide to make <b>x
</b>a <b>LinkedList </b>(instead of a generic <b>List</b>)<b> </b>and carry the
precise type information around with <b>x</b>. The beauty (and the intent) of
using the <b>interface</b> is that if you decide you want to change your
implementation, all you need to do is change it at the point of creation, like
this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>List x = new
ArrayList();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The rest of your code can remain untouched
(some of this genericity can also be achieved with iterators).</span></p>

<p class=MsoNormal><span lang=EN-US>In the class hierarchy, you can see a
number of classes whose names begin with “<b>Abstract</b>,” and these can seem
a bit confusing at first. They are simply tools that partially implement a
particular interface. If you were making your own <b>Set</b>, for example, you
wouldn’t start with the <b>Set</b> interface and implement all the methods,
instead you’d inherit from </span><span lang=EN-US><b>AbstractSet</b> and do
the minimal necessary work to make your new class. However, the containers
library contains enough functionality to satisfy your needs virtually all the
time. So for our purposes, you can ignore any class that begins with “<b>Abstract</b>.”</span></p>

<p class=MsoNormal><span lang=EN-US>Therefore, when you look at the diagram,
you’re really concerned with only those <b>interface</b>s at the top of the
diagram and the concrete classes (those with solid boxes around them). You’ll
typically make an object of a concrete class, upcast it to the corresponding <b>interface</b>,
and then use the <b>interface</b> throughout the rest of your code. In
addition, you do not need to consider the legacy elements when writing new
code. Therefore, the diagram can be greatly simplified to look like this:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=490 height=256 src="TIJ2_files/image029.png"></span></p>

<p class=MsoNormal><span lang=EN-US>Now it only includes the interfaces and
classes that you will encounter on a regular basis, and also the elements that
we will focus on in this chapter.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s a simple example, which fills a <b>Collection</b>
(represented here with an <b>ArrayList</b>) with <b>String</b> objects, and
then prints each element in the <b>Collection</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:SimpleCollection.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A simple example
using Java 2 Collections.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
SimpleCollection {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Upcast because we
just want to</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // work with
Collection features</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collection c = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-family:"Verdana","sans-serif";
display:none'>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
c.add(Integer.toString(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator it =
c.iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(it.hasNext())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(it.next());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The first line in <b>main(&nbsp;)</b>
creates an </span><span lang=EN-US><b>ArrayList</b> object and then upcasts it
to a <b>Collection</b>. Since this example uses only the <b>Collection </b>methods,
any object of a class inherited from <b>Collection</b> would work, but <b>ArrayList</b>
is the typical workhorse <b>Collection</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>add(&nbsp;)</b> method, as its name
suggests, puts a new element in the <b>Collection</b>. However, the
documentation carefully states that <b>add(&nbsp;)</b> “ensures that this
Container contains the specified element.” This is to allow for the meaning of <b>Set</b>,
which adds the element only if it isn’t already there. With an <b>ArrayList</b>,
or any sort of <b>List</b>, <b>add(&nbsp;)</b> always means “put it in,”
because <b>List</b>s don’t care if there are duplicates.</span></p>

<p class=MsoNormal><span lang=EN-US>All <b>Collection</b>s can produce an </span><span lang=EN-US><b>Iterator</b> via their </span><span
lang=EN-US><b>iterator(&nbsp;)</b> method. Here, an <b>Iterator</b> is created
and used to traverse the <b>Collection</b>, printing each element.</span></p>

<h2><a name="_Toc481064684"><b><span lang=EN-US>Collection</span></b><span
lang=EN-US> functionality</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The following table shows everything you
can do with a <b>Collection</b> (not including the methods that automatically
come through with <b>Object</b>), and thus, everything you can do with a <b>Set</b>
or a <b>List</b>. (<b>List</b> also has additional functionality.) <b>Map</b>s
are not inherited from <b>Collection</b>, and will be treated separately.</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=480
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:1.5pt;border-left:
  1.5pt;border-bottom:1.0pt;border-right:1.0pt;border-color:black;border-style:
  solid;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean add(Object)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Ensures that the
  container holds the argument. Returns false if it doesn’t add the argument.
  (This is an “optional” method, described later in this chapter.)</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean <br>
  addAll(Collection)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Adds all the
  elements in the argument. Returns </span><span lang=EN-US>true</span><span
  lang=EN-US style='font-weight:normal'> if any elements were added.
  (“Optional.”)</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>void clear(&nbsp;)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Removes all the
  elements in the container. (“Optional.”)</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean <br>
  contains(Object)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>true</span><span lang=EN-US style='font-weight:
  normal'> if the container holds the argument. </span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean containsAll(Collection)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>true</span><span lang=EN-US style='font-weight:
  normal'> if the container holds all the elements in the argument. </span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean isEmpty(&nbsp;)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>true</span><span lang=EN-US style='font-weight:
  normal'> if the container has no elements. </span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Iterator iterator(&nbsp;)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns an </span><span
  lang=EN-US>Iterator</span><span lang=EN-US style='font-weight:normal'> that
  you can use to move through the elements in the container. </span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean <br>
  remove(Object)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>If the argument is
  in the container, one instance of that element is removed. Returns </span><span
  lang=EN-US>true</span><span lang=EN-US style='font-weight:normal'> if a
  removal occurred. (“Optional.”)</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean removeAll(Collection)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Removes all the
  elements that are contained in the argument. Returns </span><span lang=EN-US>true</span><span
  lang=EN-US style='font-weight:normal'> if any removals occurred.
  (“Optional.”)</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean retainAll(Collection)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Retains only
  elements that are contained in the argument (an “intersection” from set
  theory). Returns </span><span lang=EN-US>true</span><span lang=EN-US
  style='font-weight:normal'> if any changes occurred. (“Optional.”)</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>int size(&nbsp;)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns the number
  of elements in the container. </span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Object[] toArray(&nbsp;)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns an array
  containing all the elements in the container.</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Object[] <br>
  toArray(Object[] a)</span></p>
  </td>
  <td width=282 valign=top style='width:211.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns an array
  containing all the elements in the container, whose type is that of the array
  a rather than plain </span><span lang=EN-US>Object</span><span lang=EN-US
  style='font-weight:normal'> (you must cast the array to the right type).</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>Notice that there’s no <b>get(&nbsp;)</b>
function for random-access element selection. That’s because <b>Collection</b>
also includes <b>Set</b>, which maintains its own internal ordering (and thus
makes random-access lookup meaningless). Thus, if you want to examine all the
elements of a <b>Collection</b> you must use an iterator; that’s the only way
to fetch things back.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example demonstrates all of
these methods. Again, these work with anything that inherits from <b>Collection</b>,
but an <b>ArrayList</b> is used as a kind of “least-common denominator”:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Collection1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Things you can do
with all Collections.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Collection1
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collection c = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(c,
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.countries, 10);    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
c.add(&quot;ten&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.add(&quot;eleven&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Make an array
from the List:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object[] array =
c.toArray(); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Make a String
array from the List:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] str = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
(String[])c.toArray(new String[1]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Find max and min
elements; this means</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // different things
depending on the way</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // the Comparable
interface is implemented:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Collections.max(c) = &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections.max(c));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Collections.min(c) = &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections.min(c));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Add a Collection
to another Collection</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collection c2 = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections2.fill(c2, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.countries, 10);    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.addAll(c2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
c.remove(CountryCapitals.pairs[0][0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
c.remove(CountryCapitals.pairs[1][0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Remove all
components that are in the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // argument
collection:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.removeAll(c2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.addAll(c2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Is an element in
this Collection?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String val =
CountryCapitals.pairs[3][0];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;c.contains(&quot; + val  + &quot;) = &quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
c.contains(val));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Is a Collection
in this Collection?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;c.containsAll(c2) = &quot;+ c.containsAll(c2));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collection c3 =
((List)c).subList(3, 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Keep all the
elements that are in both</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // c2 and c3 (an
intersection of sets):</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c2.retainAll(c3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Throw away all
the elements </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // in c2 that also
appear in c3:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c2.removeAll(c3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;c.isEmpty() = &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      c.isEmpty());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c = new ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(c,
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.countries, 10);    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.clear(); // Remove
all elements</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;after c.clear():&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>ArrayList</span></b><span lang=EN-US>s
are created containing different sets of data and upcast to <b>Collection</b>
objects, so it’s clear that nothing other than the <b>Collection</b> interface
is being used. <b>main(&nbsp;)</b> uses simple exercises to show all of the
methods in <b>Collection</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The following sections describe the various
implementations of <b>List</b>, <b>Set,</b> and <b>Map</b> and indicate in each
case (with an asterisk) which one should be your default choice. You’ll notice
that the legacy classes <b>Vector</b>, <b>Stack</b>, and <b>Hashtable</b> are <i>not</i>
included because in all cases there are preferred classes within the Java 2
Containers.</span></p>

<h2><a name="_Toc481064685"><b><span lang=EN-US>List</span></b><span
lang=EN-US> functionality</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The basic <b>List</b> is quite simple to
use, as you’ve seen so far with <b>ArrayList</b>. Although most of the time
you’ll just use <b>add(&nbsp;)</b> to insert objects, <b>get(&nbsp;)</b> to get
them out one at a time, and <b>iterator(&nbsp;)</b> to get an <b>Iterator</b>
to the sequence, there’s also a set of other methods that can be useful. </span></p>

<p class=MsoNormal><span lang=EN-US>In addition, there are actually two types
of <b>List</b>: the basic <b>ArrayList</b>, which excels at randomly accessing
elements, and the much more powerful <b>LinkedList</b> (which is not designed
for fast random access, but has a much more general set of methods).</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=108 valign=top style='width:81.0pt;border-top:1.5pt;border-left:
  1.5pt;border-bottom:1.0pt;border-right:1.0pt;border-color:black;border-style:
  solid;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>List</span><span lang=EN-US style='font-weight:
  normal'> (interface)</span></p>
  </td>
  <td width=360 valign=top style='width:270.0pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Order is the most
  important feature of a </span><span lang=EN-US>List</span><span lang=EN-US
  style='font-weight:normal'>; it promises to maintain elements in a particular
  sequence. </span><span lang=EN-US>List</span><span lang=EN-US
  style='font-weight:normal'> adds a number of methods to </span><span
  lang=EN-US>Collection</span><span lang=EN-US style='font-weight:normal'> that
  allow insertion and removal of elements in the middle of a </span><span
  lang=EN-US>List</span><span lang=EN-US style='font-weight:normal'>. (This is
  recommended only for a </span><span lang=EN-US>LinkedList</span><span
  lang=EN-US style='font-weight:normal'>.) A </span><span lang=EN-US>List</span><span
  lang=EN-US style='font-weight:normal'> will produce a </span><span
  lang=EN-US>ListIterator</span><span lang=EN-US style='font-weight:normal'>,
  and using this you can traverse the </span><span lang=EN-US>List</span><span
  lang=EN-US style='font-weight:normal'> in both directions, as well as insert
  and remove elements in the middle of the </span><span lang=EN-US>List</span><span
  lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=108 valign=top style='width:81.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>ArrayList</span><span lang=EN-US
  style='font-weight:normal'>*</span></p>
  </td>
  <td width=360 valign=top style='width:270.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>A </span><span
  lang=EN-US>List</span><span lang=EN-US style='font-weight:normal'>
  implemented with an array. Allows rapid random access to elements, but is
  slow when inserting and removing elements from the middle of a list. </span><span
  lang=EN-US>ListIterator</span><span lang=EN-US style='font-weight:normal'>
  should be used only for back-and-forth traversal of an </span><span
  lang=EN-US>ArrayList</span><span lang=EN-US style='font-weight:normal'>, but
  not for inserting and removing elements, which is expensive compared to </span><span
  lang=EN-US>LinkedList</span><span lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=108 valign=top style='width:81.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>LinkedList</span></p>
  </td>
  <td width=360 valign=top style='width:270.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Provides optimal
  sequential access, with inexpensive insertions and deletions from the middle
  of the </span><span lang=EN-US>List</span><span lang=EN-US style='font-weight:
  normal'>. Relatively slow for random access. (Use </span><span lang=EN-US>ArrayList</span><span
  lang=EN-US style='font-weight:normal'> instead.) Also has </span><span
  lang=EN-US>addFirst(&nbsp;)</span><span lang=EN-US style='font-weight:normal'>,
  </span><span lang=EN-US>addLast(&nbsp;)</span><span lang=EN-US
  style='font-weight:normal'>, </span><span lang=EN-US>getFirst(&nbsp;)</span><span
  lang=EN-US style='font-weight:normal'>, </span><span lang=EN-US>getLast(&nbsp;)</span><span
  lang=EN-US style='font-weight:normal'>, </span><span lang=EN-US>removeFirst(&nbsp;)</span><span
  lang=EN-US style='font-weight:normal'>, and </span><span lang=EN-US>removeLast(&nbsp;)</span><span
  lang=EN-US style='font-weight:normal'> (which are not defined in any
  interfaces or base classes) to allow it to be used as a stack, a queue, and a
  deque.</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>The methods in the following example
each cover a different group of activities: things that every list can do (<b>basicTest(&nbsp;)</b>),
moving around with an <b>Iterator</b> (<b>iterMotion(&nbsp;)</b>)<b> </b>versus
changing things with an <b>Iterator</b> (<b>iterManipulation(&nbsp;)</b>),
seeing the effects of <b>List</b> manipulation (<b>testVisual(&nbsp;)</b>), and
operations available only to <b>LinkedList</b>s.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:List1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Things you can do
with Lists.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class List1 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static List
fill(List a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections2.countries.reset();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(a,
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.countries, 10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return a;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static boolean b;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Object o;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Iterator it;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static ListIterator
lit;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
basicTest(List a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.add(1,
&quot;x&quot;); // Add at location 1</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
a.add(&quot;x&quot;); // Add at end</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Add a collection:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.addAll(fill(new
ArrayList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Add a collection
starting at location 3:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.addAll(3, fill(new
ArrayList())); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b =
a.contains(&quot;1&quot;); // Is it in there?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Is the entire
collection in there?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b =
a.containsAll(fill(new ArrayList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Lists allow
random access, which is cheap</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // for ArrayList,
expensive for LinkedList:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o = a.get(1); // Get
object at location 1</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i =
a.indexOf(&quot;1&quot;); // Tell index of object</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b = a.isEmpty(); //
Any elements inside?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    it = a.iterator();
// Ordinary Iterator</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    lit =
a.listIterator(); // ListIterator</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    lit =
a.listIterator(3); // Start at loc 3</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i =
a.lastIndexOf(&quot;1&quot;); // Last match </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.remove(1); //
Remove location 1</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
a.remove(&quot;3&quot;); // Remove this object</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.set(1,
&quot;y&quot;); // Set location 1 to &quot;y&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Keep everything
that's in the argument</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // (the intersection
of the two sets):</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.retainAll(fill(new
ArrayList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Remove everything
that's in the argument:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.removeAll(fill(new
ArrayList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = a.size(); // How
big is it?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.clear(); // Remove
all elements</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
iterMotion(List a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ListIterator it =
a.listIterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b = it.hasNext();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b =
it.hasPrevious();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o = it.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = it.nextIndex();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o = it.previous();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = it.previousIndex();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
iterManipulation(List a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ListIterator it =
a.listIterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
it.add(&quot;47&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Must move to an
element after add():</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    it.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Remove the
element that was just produced:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    it.remove(); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Must move to an
element after remove():</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    it.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Change the
element that was just produced:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
it.set(&quot;47&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
testVisual(List a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    List b = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fill(b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.print(&quot;b
= &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.addAll(b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.addAll(fill(new
ArrayList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Insert, remove,
and replace elements</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // using a
ListIterator:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ListIterator x =
a.listIterator(a.size()/2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
x.add(&quot;one&quot;); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(x.next());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.remove();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(x.next());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
x.set(&quot;47&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Traverse the list
backwards:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x =
a.listIterator(a.size());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
while(x.hasPrevious())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.out.print(x.previous()
+ &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;testVisual finished&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // There are some
things that only</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // LinkedLists can do:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
testLinkedList() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    LinkedList ll = new
LinkedList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fill(ll);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(ll);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Treat it like a
stack, pushing:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
ll.addFirst(&quot;one&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
ll.addFirst(&quot;two&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(ll);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Like
&quot;peeking&quot; at the top of a stack:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(ll.getFirst());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Like popping a
stack:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(ll.removeFirst());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(ll.removeFirst());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Treat it like a
queue, pulling elements</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // off the tail end:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(ll.removeLast());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // With the above
operations, it's a dequeue!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(ll);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Make and fill a
new list each time:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    basicTest(fill(new
LinkedList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    basicTest(fill(new
ArrayList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    iterMotion(fill(new
LinkedList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    iterMotion(fill(new
ArrayList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
iterManipulation(fill(new LinkedList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
iterManipulation(fill(new ArrayList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    testVisual(fill(new
LinkedList()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    testLinkedList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>basicTest(&nbsp;)</b> and <b>iterMotion(&nbsp;)</b>
the calls are simply made to show the proper syntax, and while the return value
is captured, it is not used. In some cases, the return value isn’t captured
since it isn’t typically used. You should look up the full usage of each of
these methods in the online documentation from <i>java.sun.com</i> before you
use them.</span></p>

<h3><a name="_Toc481064686"><span lang=EN-US>Making a stack from a <b>LinkedList</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>A </span><span
lang=EN-US>stack</span><span lang=EN-US> is sometimes referred to as a
“last-in, first-out” (</span><span lang=EN-US>LIFO) container. That is,
whatever you “push” on the stack last is the first item you can “pop” out. Like
all of the other containers in Java, what you push and pop are <b>Object</b>s,
so you must cast what you pop, unless you’re just using <b>Object</b> behavior.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>LinkedList</b> has methods that
directly implement stack functionality, so you can also just use a <b>LinkedList</b>
rather than making a stack class. However, a stack class can sometimes tell the
story better:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:StackL.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Making a stack from a
LinkedList.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class StackL {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private LinkedList
list = new LinkedList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
push(Object v) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    list.addFirst(v);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object top() {
return list.getFirst(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object pop() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
list.removeFirst(); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    StackL stack = new
StackL();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
stack.push(Collections2.countries.next());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(stack.top());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(stack.top());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(stack.pop());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(stack.pop());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(stack.pop());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you want only stack behavior,
inheritance is inappropriate here because it would produce a class with all the
rest of the <b>LinkedList</b> methods (you’ll see later that this very mistake
was made by the Java 1.0 library designers with <b>Stack</b>).</span></p>

<h3><a name="_Toc481064687"><span lang=EN-US>Making a queue from a <b>LinkedList</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>A </span><span
lang=EN-US><i>queue</i> is a “<i>first-in, first-out</i>” (</span><span lang=EN-US>FIFO) container. That is, you put things in at one end, and pull them
out at the other. So the order in which you put them in will be the same order
that they come out. </span><span lang=EN-US><b>LinkedList</b> has methods to
support queue behavior, so these can be used in a <b>Queue</b> class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Queue.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Making a queue from a
LinkedList.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Queue {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private LinkedList
list = new LinkedList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void put(Object
v) { list.addFirst(v); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object get() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
list.removeLast(); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean
isEmpty() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
list.isEmpty(); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Queue queue = new
Queue();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
queue.put(Integer.toString(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
while(!queue.isEmpty())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(queue.get());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can also easily create a <i>deque</i>
(double-ended queue) from a <b>LinkedList</b>. This is like a queue, but you can
add and remove elements from either end.</span></p>

<h2><a name="_Toc481064688"><b><span lang=EN-US>Set</span></b><span lang=EN-US>
functionality</span></a></h2>

<p class=MsoNormal><span lang=EN-US><b>Set</b> has exactly the same interface
as <b>Collection</b>, so there isn’t any extra functionality like there is with
the two different <b>List</b>s. Instead, the <b>Set</b> is exactly a <b>Collection</b>,
it just has different behavior. (This is the ideal use of inheritance and
polymorphism: to express different behavior.) A <b>Set</b> refuses to hold more
than one instance of each object value (what constitutes the “value” of an
object is more complex, as you shall see). </span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=108 valign=top style='width:80.85pt;border-top:1.5pt;border-left:
  1.5pt;border-bottom:1.0pt;border-right:1.0pt;border-color:black;border-style:
  solid;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Set</span><span lang=EN-US style='font-weight:
  normal'> (interface)</span></p>
  </td>
  <td width=360 valign=top style='width:270.15pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Each element that
  you add to the </span><span lang=EN-US>Set</span><span lang=EN-US
  style='font-weight:normal'> must be unique; otherwise the </span><span
  lang=EN-US>Set</span><span lang=EN-US style='font-weight:normal'> doesn’t add
  the duplicate element. </span><span lang=EN-US>Object</span><span lang=EN-US
  style='font-weight:normal'>s added to a </span><span lang=EN-US>Set</span><span
  lang=EN-US style='font-weight:normal'> must define </span><span lang=EN-US>equals(&nbsp;)</span><span
  lang=EN-US style='font-weight:normal'> to establish object uniqueness. </span><span
  lang=EN-US>Set</span><span lang=EN-US style='font-weight:normal'> has exactly
  the same interface as </span><span lang=EN-US>Collection</span><span
  lang=EN-US style='font-weight:normal'>. The </span><span lang=EN-US>Set</span><span
  lang=EN-US style='font-weight:normal'> interface does not guarantee it will
  maintain its elements in any particular order.</span></p>
  </td>
 </tr>
 <tr>
  <td width=108 valign=top style='width:80.85pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>HashSet</span><span lang=EN-US
  style='font-weight:normal'>*</span></p>
  </td>
  <td width=360 valign=top style='width:270.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>For </span><span
  lang=EN-US>Set</span><span lang=EN-US style='font-weight:normal'>s where fast
  lookup time is important. </span><span lang=EN-US>Object</span><span
  lang=EN-US style='font-weight:normal'>s must also define </span><span
  lang=EN-US>hashCode(&nbsp;)</span><span lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=108 valign=top style='width:80.85pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>TreeSet</span></p>
  </td>
  <td width=360 valign=top style='width:270.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>An ordered </span><span
  lang=EN-US>Set</span><span lang=EN-US style='font-weight:normal'> backed by a
  tree. This way, you can extract an ordered sequence from a </span><span
  lang=EN-US>Set</span><span lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>The following example does <i>not</i>
show everything you can do with a <b>Set</b>, since the interface is the same
as <b>Collection</b>, and so was exercised in the previous example. Instead,
this demonstrates the behavior that makes a <b>Set</b> unique:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Set1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Things you can do
with Sets.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Set1 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static
Collections2.StringGenerator gen = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections2.countries;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
testVisual(Set a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(a,
gen.reset(), 10);    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(a,
gen.reset(), 10);    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(a,
gen.reset(), 10);    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(a); // No duplicates!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Add another set
to this one:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.addAll(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
a.add(&quot;one&quot;); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
a.add(&quot;one&quot;); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
a.add(&quot;one&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Look something
up:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;a.contains(\&quot;one\&quot;): &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
a.contains(&quot;one&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;HashSet&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    testVisual(new
HashSet());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;TreeSet&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    testVisual(new
TreeSet());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Duplicate values are added to the <b>Set</b>,
but when it is printed you’ll see the <b>Set</b> has accepted only one instance
of each value.</span></p>

<p class=MsoNormal><span lang=EN-US>When you run this program you’ll notice
that the order maintained by the <b>HashSet</b> is different from <b>TreeSet</b>,
since each has a different way of storing elements so they can be located
later. (<b>TreeSet</b> keeps them sorted, while <b>HashSet</b> uses a hashing
function, which is designed specifically for rapid lookups.) When creating your
own types, be aware that a <b>Set</b> needs a way to maintain a storage order,
which means you must implement the <b>Comparable </b>interface and define the <b>compareTo(&nbsp;)
</b>method. Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Set2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Putting your own type
in a Set.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MyType implements
Comparable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public MyType(int n) {
i = n; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean
equals(Object o) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (o instanceof
MyType) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &amp;&amp; (i == ((MyType)o).i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int hashCode()
{ return i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { return i + &quot; &quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int
compareTo(Object o) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i2 =
((MyType)o).i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return (i2 &lt; i ?
-1 : (i2 == i ? 0 : 1));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Set2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static Set
fill(Set a, int size) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; size; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a.add(new
MyType(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return a;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
test(Set a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fill(a, 10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fill(a, 10); // Try
to add duplicates</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fill(a, 10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.addAll(fill(new
TreeSet(), 10));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new HashSet());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new TreeSet());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The form for the definitions for </span><span lang=EN-US><b>equals(&nbsp;)</b> and <b>hashCode(&nbsp;)</b> will be described
later in this chapter. You must define an <b>equals(&nbsp;)</b> in both cases,
but the <b>hashCode(&nbsp;)</b> is absolutely necessary only if the class will
be placed in a <b>HashSet</b> (which is likely, since that should generally be
your first choice as a <b>Set</b> implementation). However, as a programming
style you should always override <b>hashCode(&nbsp;)</b> when you override <b>equals(&nbsp;)</b>.
This process will be fully detailed later in this chapter.</span></p>

<p class=MsoNormal><span lang=EN-US>In the <b>compareTo(&nbsp;)</b>, note that
I did <i>not</i> use the “simple and obvious” form <b>return i-i2</b>. Although
this is a common programming error, it would only work properly if <b>i</b> and
<b>i2</b> were “unsigned”<b> int</b>s (if Java <i>had </i>an “unsigned”
keyword, which it does not). It breaks for Java’s signed <b>int</b>, which is
not big enough to represent the difference of two signed <b>int</b>s. If <b>i</b>
is a large positive integer and <b>j</b> is a large negative integer, <b>i-j</b>
will overflow and return a negative value, which will not work. </span></p>

<h3><a name="_Toc481064689"><b><span lang=EN-US>SortedSet</span></b></a></h3>

<p class=MsoNormal style='margin-bottom:3.0pt'><span lang=EN-US>If you have a <b>SortedSet</b>
(of which <b>TreeSet</b> is the only one available), the elements are guaranteed
to be in sorted order which allows additional functionality to be provided with
these methods in the <b>SortedSet</b> interface:</span></p>

<p class=TabularText><b><span lang=EN-US>Comparator comparator():</span></b><span
lang=EN-US> Produces the <b>Comparator</b> used for this <b>Set</b>, or <b>null</b>
for natural ordering. </span></p>

<p class=TabularText><b><span lang=EN-US>Object first():</span></b><span
lang=EN-US> Produces the lowest element. </span></p>

<p class=TabularText><b><span lang=EN-US>Object last():</span></b><span
lang=EN-US> Produces the highest element. </span></p>

<p class=TabularText><b><span lang=EN-US>SortedSet subSet(fromElement,
toElement):</span></b><span lang=EN-US> Produces a view of this <b>Set</b> with
elements from <b>fromElement</b>, inclusive, to <b>toElement</b>, exclusive. </span></p>

<p class=TabularText><b><span lang=EN-US>SortedSet headSet(toElement):</span></b><span
lang=EN-US> Produces a view of this <b>Set</b> with elements less than <b>toElement</b>.
</span></p>

<p class=TabularText style='margin-bottom:9.0pt'><b><span lang=EN-US>SortedSet
tailSet(fromElement):</span></b><span lang=EN-US> Produces a view of this <b>Set</b>
with elements greater than or equal to <b>fromElement</b>.</span></p>

<h2><a name="_Toc481064690"><b><span lang=EN-US>Map</span></b><span lang=EN-US>
functionality</span></a></h2>

<p class=MsoNormal><span lang=EN-US>An <b>ArrayList</b> allows you to select
from a sequence of objects using a number, so in a sense it associates numbers
to objects. But what if you’d like to select from a sequence of objects using
some other criterion? A stack is an example: its selection criterion is “the
last thing pushed on the stack.” A powerful twist on this idea of “selecting
from a sequence” is alternately termed a </span><span
lang=EN-US><i>map</i>, a </span><span lang=EN-US><i>dictionary,</i> or an </span><span lang=EN-US><i>associative array</i>. Conceptually, it seems like an <b>ArrayList</b>,
but instead of looking up objects using a number, you look them up using <i>another
object</i>! This is often a key process in a program.</span></p>

<p class=MsoNormal><span lang=EN-US>The concept shows up in Java as the <b>Map </b>interface.
The <b>put(Object key, Object value)</b> method adds a value (the thing you want),
and associates it with a key (the thing you look it up with). <b>get(Object
key)</b> produces the value given the corresponding key. You can also test a <b>Map</b>
to see if it contains a key or a value with <b>containsKey(&nbsp;)</b> and <b>containsValue(&nbsp;)</b>.
</span></p>

<p class=MsoNormal><span lang=EN-US>The standard Java library contains two
different types of <b>Map</b>s: <b>HashMap</b> and <b>TreeMap</b>. Both have
the same interface (since they both implement <b>Map</b>), but they differ in
one distinct way: efficiency. If you look at what must be done for a <b>get(&nbsp;)</b>,
it seems pretty slow to search through (for example) an <b>ArrayList</b> for
the key. This is where <b>HashMap</b> speeds things up. Instead of a slow
search for the key, it uses a special value called a </span><span
lang=EN-US><i>hash code</i>.<i> </i>The hash code is a way to take some
information in the object in question and turn it into a “relatively unique” <b>int</b>
for that object. All Java objects can produce a hash code, and </span><span lang=EN-US><b>hashCode(&nbsp;)</b> is a method in the root class </span><span lang=EN-US><b>Object</b>. A <b>HashMap </b>takes the <b>hashCode(&nbsp;)</b> of
the object and uses it to quickly hunt for the key. This results in a dramatic
performance improvement</span><a href="#_ftn50" name="_ftnref50" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[50]</span></span></span></span></a><span lang=EN-US>.</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:1.5pt;border-left:
  1.5pt;border-bottom:1.0pt;border-right:1.0pt;border-color:black;border-style:
  solid;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Map</span><span lang=EN-US style='font-weight:
  normal'> (interface)</span></p>
  </td>
  <td width=360 valign=top style='width:270.0pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Maintains
  key-value associations (pairs), so you can look up a value using a key.</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid windowtext 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>HashMap</span><span lang=EN-US
  style='font-weight:normal'>*</span></p>
  </td>
  <td width=360 valign=top style='width:270.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Implementation
  based on a hash table. (Use this instead of </span><span lang=EN-US>Hashtable</span><span
  lang=EN-US style='font-weight:normal'>.) Provides constant-time performance
  for inserting and locating pairs. Performance can be adjusted via
  constructors that allow you to set the <i>capacity</i> and <i>load factor</i>
  of the hash table.</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>TreeMap</span></p>
  </td>
  <td width=360 valign=top style='width:270.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Implementation
  based on a red-black tree. When you view the keys or the pairs, they will be
  in sorted order (determined by </span><span lang=EN-US>Comparable</span><span
  lang=EN-US style='font-weight:normal'> or </span><span lang=EN-US>Comparator</span><span
  lang=EN-US style='font-weight:normal'>, discussed later). The point of a </span><span
  lang=EN-US>TreeMap</span><span lang=EN-US style='font-weight:normal'> is that
  you get the results in sorted order. </span><span lang=EN-US>TreeMap</span><span
  lang=EN-US style='font-weight:normal'> is the only </span><span lang=EN-US>Map</span><span
  lang=EN-US style='font-weight:normal'> with the </span><span lang=EN-US>subMap(&nbsp;)</span><span
  lang=EN-US style='font-weight:normal'> method, which allows you to return a
  portion of the tree.</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>Sometimes you’ll also need to know the
details of how hashing works, so we’ll look at that a little later.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example uses the <b>Collections2.</b><b>fill(&nbsp;)</b>
method and the test data sets that were previously defined:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Map1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Things you can do
with Maps.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Map1 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static
Collections2.StringPairGenerator geo = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections2.geography;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static
Collections2.RandStringPairGenerator </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    rsp = Collections2.rsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Producing a Set of
the keys:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
printKeys(Map m) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.print(&quot;Size = &quot; + m.size() +&quot;, &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.print(&quot;Keys: &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(m.keySet());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Producing a
Collection of the values:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
printValues(Map m) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.print(&quot;Values: &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(m.values());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
test(Map m) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(m,
geo, 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Map has 'Set'
behavior for keys:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(m,
geo.reset(), 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    printKeys(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    printValues(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String key =
CountryCapitals.pairs[4][0];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String value =
CountryCapitals.pairs[4][1];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;m.containsKey(\&quot;&quot; + key +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;\&quot;):
&quot; + m.containsKey(key));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;m.get(\&quot;&quot; + key + &quot;\&quot;): &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      + m.get(key));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;m.containsValue(\&quot;&quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      + value +
&quot;\&quot;): &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
m.containsValue(value)); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Map m2 = new
TreeMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections2.fill(m2, rsp, 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    m.putAll(m2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    printKeys(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    key =
m.keySet().iterator().next().toString();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;First key in map: &quot;+key);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    m.remove(key);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    printKeys(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    m.clear();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;m.isEmpty(): &quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      + m.isEmpty());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(m,
geo.reset(), 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Operations on the
Set change the Map:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
m.keySet().removeAll(m.keySet());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;m.isEmpty(): &quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      + m.isEmpty());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Testing HashMap&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new HashMap());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Testing TreeMap&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new TreeMap());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>printKeys(&nbsp;)</b> and <b>printValues(&nbsp;)</b>
methods are not only useful utilities, they also demonstrate how to produce <b>Collection</b>
views of a <b>Map</b>. The <b>keySet(&nbsp;)</b> method produces a <b>Set</b>
backed by the keys in the <b>Map</b>. Similar treatment is given to <b>values(&nbsp;)</b>,
which produces a <b>Collection</b> containing all the values in the <b>Map.</b>
(Note that keys must be unique, while values may contain duplicates.) Since
these <b>Collection</b>s are backed by the <b>Map</b>, any changes in a <b>Collection</b>
will be reflected in the associated <b>Map</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The rest of the program provides simple
examples of each <b>Map</b> operation, and tests each type of <b>Map</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>As an example of the use of a <b>HashMap</b>,
consider a program to check the randomness of Java’s </span><span lang=EN-US><b>Math.random(&nbsp;)</b> method. Ideally, it would produce a
perfect distribution of random numbers, but to test this you need to generate a
bunch of random numbers and count the ones that fall in the various ranges. A <b>HashMap</b>
is perfect for this, since it associates objects with objects (in this case,
the value object contains the number produced by <b>Math.random(&nbsp;)</b>
along with the number of times that number appears):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Statistics.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Simple demonstration
of HashMap.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Counter { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = 1; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
Integer.toString(i); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Statistics {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    HashMap hm = new
HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10000; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Produce a
number between 0 and 20:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Integer r = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
Integer((int)(Math.random() * 20));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(hm.containsKey(r))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)hm.get(r)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        hm.put(r, new
Counter());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(hm);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>main(&nbsp;)</b>, each time a random
number is generated it is wrapped inside an <b>Integer</b> object so that
reference can be used with the <b>HashMap</b>. (You can’t use a primitive with
a container, only an object reference.) The <b>containsKey(&nbsp;)</b> method
checks to see if this key is already in the container. (That is, has the number
been found already?) If so, the </span><span
lang=EN-US><b>get(&nbsp;)</b> method produces the associated value for the key,
which in this case is a <b>Counter</b> object. The value <b>i</b> inside the
counter is incremented to indicate that one more of this particular random
number has been found.</span></p>

<p class=MsoNormal><span lang=EN-US>If the key has not been found yet, the
method </span><span lang=EN-US><b>put(&nbsp;)</b> will place a new key-value
pair into the <b>HashMap</b>. Since <b>Counter</b> automatically initializes
its variable <b>i</b> to one when it’s created, it indicates the first
occurrence of this particular random number.</span></p>

<p class=MsoNormal><span lang=EN-US>To display the <b>HashMap</b>, it is simply
printed. The <b>HashMap</b> <b>toString(&nbsp;)</b> method moves through all
the key-value pairs and calls the <b>toString(&nbsp;)</b> for each one. The <b>Integer.toString(&nbsp;)</b>
is predefined, and you can see the <b>toString(&nbsp;)</b> for <b>Counter</b>.
The output from one run (with some line breaks added) is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>{19=526, 18=533, 17=460,
16=513, 15=521, 14=495,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 13=512, 12=483, 11=488,
10=487, 9=514, 8=523,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 7=497, 6=487, 5=480,
4=489, 3=509, 2=503, 1=475,</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US> 0=505}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You might wonder at the necessity of the
class <b>Counter,</b> which seems like it doesn’t even have the functionality
of the wrapper class <b>Integer</b>. Why not use <b>int</b> or <b>Integer</b>?
Well, you can’t use an <b>int</b> because all of the containers can hold only<b>
Object </b>references. After seeing containers the wrapper classes might begin
to make a little more sense to you, since you can’t put any of the primitive
types in containers. However, the only thing you <i>can</i> do with the Java </span><span lang=EN-US>wrappers is to initialize them to a particular value and read that
value. That is, there’s no way to change a value once a wrapper object has been
created. This makes the <b>Integer</b> wrapper immediately useless to solve our
problem, so we’re forced to create a new class that does satisfy the need.</span></p>

<h3><a name="_Toc481064691"><b><span lang=EN-US>SortedMap</span></b></a></h3>

<p class=MsoNormal style='margin-bottom:3.0pt'><span lang=EN-US>If you have a <b>SortedMap</b>
(of which <b>TreeMap</b> is the only one available), the keys are guaranteed to
be in sorted order which allows additional functionality to be provided with
these methods in the <b>SortedMap</b> interface:</span></p>

<p class=TabularText><b><span lang=EN-US>Comparator comparator():</span></b><span
lang=EN-US> Produces the comparator used for this <b>Map</b>, or <b>null</b>
for natural ordering. </span></p>

<p class=TabularText><b><span lang=EN-US>Object firstKey():</span></b><span
lang=EN-US> Produces the lowest key. </span></p>

<p class=TabularText><b><span lang=EN-US>Object lastKey():</span></b><span
lang=EN-US> Produces the highest key. </span></p>

<p class=TabularText><b><span lang=EN-US>SortedMap subMap(fromKey, toKey):</span></b><span
lang=EN-US> Produces a view of this <b>Map</b> with keys from <b>fromKey</b>,
inclusive, to <b>toKey</b>, exclusive. </span></p>

<p class=TabularText><b><span lang=EN-US>SortedMap headMap(toKey):</span></b><span
lang=EN-US> Produces a view of this <b>Map</b> with keys less than <b>toKey</b>.
</span></p>

<p class=TabularText style='margin-bottom:9.0pt'><b><span lang=EN-US>SortedMap
tailMap(fromKey):</span></b><span lang=EN-US> Produces a view of this <b>Map</b>
with keys greater than or equal to <b>fromKey</b>.</span></p>

<h3><a name="_Toc481064692"><span lang=EN-US>Hashing and hash codes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>In the previous example, a standard library
class (<b>Integer</b>) was used as a key for the <b>HashMap</b>. It worked fine
as a key, because it has all the necessary wiring to make it work correctly as
a key. But a common pitfall occurs with <b>HashMap</b>s when you create your
own classes to be used as keys. For example, consider a weather predicting
system that matches <b>Groundhog</b> objects to <b>Prediction</b> objects. It
seems fairly straightforward—you create the two classes, and use <b>Groundhog</b>
as the key and <b>Prediction</b> as the value:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:SpringDetector.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Looks plausible, but
doesn't work.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Groundhog {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int ghNumber;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Groundhog(int n) {
ghNumber = n; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Prediction {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean shadow =
Math.random() &gt; 0.5;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(shadow)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return &quot;Six
more weeks of Winter!&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return &quot;Early
Spring!&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
SpringDetector {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    HashMap hm = new HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      hm.put(new
Groundhog(i), new Prediction());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;hm = &quot; + hm + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Looking up
prediction for Groundhog #3:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Groundhog gh = new
Groundhog(3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(hm.containsKey(gh))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println((Prediction)hm.get(gh));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Key not found: &quot; + gh);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Each <b>Groundhog</b> is given an identity
number, so you can look up a <b>Prediction</b> in the <b>HashMap</b> by saying,
“Give me the <b>Prediction </b>associated with <b>Groundhog</b> number 3.” The <b>Prediction</b>
class contains a <b>boolean</b> that is initialized using <b>Math.random(&nbsp;)</b>,
and a <b>toString(&nbsp;)</b> that interprets the result for you. In <b>main(&nbsp;)</b>,
a <b>HashMap</b> is filled with <b>Groundhog</b>s and their associated <b>Prediction</b>s.
The <b>HashMap </b>is printed so you can see that it has been filled. Then a <b>Groundhog</b>
with an identity number of 3 is used as a key to look up the prediction for <b>Groundhog</b>
#3 (which you can see must be in the <b>Map</b>).</span></p>

<p class=MsoNormal><span lang=EN-US>It seems simple enough, but it doesn’t
work. The problem is that <b>Groundhog</b> is inherited from the common root
class <b>Object</b> (which is what happens if you don’t specify a base class,
thus all classes are ultimately inherited from <b>Object</b>). It is <b>Object</b>’s
<b>hashCode(&nbsp;)</b> method that is used to generate the hash code for each
object, and by default it just uses the address of its object. Thus, the first
instance of <b>Groundhog(3)</b> does <i>not</i> produce a hash code equal to
the hash code for the second instance of <b>Groundhog(3)</b> that we tried to
use as a lookup.</span></p>

<p class=MsoNormal><span lang=EN-US>You might think that all you need to do is
write an appropriate override for </span><span
lang=EN-US><b>hashCode(&nbsp;)</b>. But it still won’t work until you’ve done
one more thing: override the </span><span
lang=EN-US><b>equals(&nbsp;)</b> that is also part of <b>Object</b>. This
method is used by the <b>HashMap</b> when trying to determine if your key is
equal to any of the keys in the table. Again, the default <b>Object.equals(&nbsp;)</b>
simply compares object addresses, so one <b>Groundhog(3)</b> is not equal to
another <b>Groundhog(3)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Thus, to use your own classes as keys in a <b>HashMap</b>,
you must override both <b>hashCode(&nbsp;)</b> and <b>equals(&nbsp;)</b>, as
shown in the following solution to the problem above:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:SpringDetector2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A class that's used
as a key in a HashMap </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// must override
hashCode() and equals().</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Groundhog2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int ghNumber;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Groundhog2(int n) {
ghNumber = n; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int hashCode()
{ return ghNumber; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean
equals(Object o) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return (o instanceof
Groundhog2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &amp;&amp; (ghNumber
== ((Groundhog2)o).ghNumber);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
SpringDetector2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    HashMap hm = new
HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      hm.put(new
Groundhog2(i),new Prediction());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;hm
= &quot; + hm + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Looking up
prediction for groundhog #3:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Groundhog2 gh = new
Groundhog2(3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(hm.containsKey(gh))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println((Prediction)hm.get(gh));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that this uses the <b>Prediction</b>
class from the previous example, so <b>SpringDetector.java</b> must be compiled
first or you’ll get a compile-time error when you try to compile<b>
SpringDetector2.java</b>.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Groundhog2.hashCode(&nbsp;)</span></b><span
lang=EN-US> returns the groundhog number as an identifier. In this example, the
programmer is responsible for ensuring that no two groundhogs exist with the
same ID number. The <b>hashCode(&nbsp;) </b>is not required to return a unique
identifier (something you’ll understand better later in this chapter), but the <b>equals(&nbsp;)</b>
method must be able to strictly determine whether two objects are equivalent.</span></p>

<p class=MsoNormal><span lang=EN-US>Even though it appears that the <b>equals(&nbsp;)</b>
method is only checking to see whether the argument is an instance of <b>Groundhog2</b>
(using the <b>instanceof</b> keyword, which is fully explained in Chapter 12),
the <b>instanceof</b> actually quietly does a second sanity check, to see if
the object is <b>null</b>, since <b>instanceof</b> produces <b>false</b> if the
left-hand argument is <b>null</b>. Assuming it’s the correct type and not <b>null</b>,
the comparison is based on the actual <b>ghNumber</b>s. This time, when you run
the program, you’ll see it produces the correct output.</span></p>

<p class=MsoNormal><span lang=EN-US>When creating your own class to use in a <b>HashSet</b>,
you must pay attention to the same issues as when it is used as a key in a <b>HashMap</b>.</span></p>

<h4><span lang=EN-US>Understanding <b>hashCode(&nbsp;)</b></span></h4>

<p class=MsoNormal><span lang=EN-US>The above example is only a start toward
solving the problem correctly. It shows that if you do not override </span><span lang=EN-US><b>hashCode(&nbsp;)</b> and </span><span
lang=EN-US><b>equals(&nbsp;)</b> for your key, the hashed data structure (<b>HashSet</b>
or <b>HashMap</b>) will not be able to deal with your key properly. However, to
get a good solution for the problem you need to understand what’s going on
inside the hashed data structure.</span></p>

<p class=MsoNormal><span lang=EN-US>First, consider the motivation behind </span><span lang=EN-US>hashing: you want to look up an object using another object. But you
can accomplish this with a <b>TreeSet</b> or <b>TreeMap</b>, too. It’s also
possible to implement your own <b>Map</b>. To do so, the <b>Map.entrySet(&nbsp;)</b>
method must be supplied to produce a set of <b>Map.Entry</b> objects. <b>MPair</b>
will be defined as the new type of </span><span
lang=EN-US><b>Map.Entry</b>. In order for it to be placed in a <b>TreeSet</b>
it must implement <b>equals(&nbsp;)</b> and be <b>Comparable</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:MPair.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A Map implemented
with ArrayLists.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class MPair </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>implements Map.Entry,
Comparable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Object key, value;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  MPair(Object k, Object
v) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    key = k;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    value = v;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object getKey()
{ return key; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object
getValue() { return value; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object
setValue(Object v){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object result =
value;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    value = v;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return result;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean
equals(Object o) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
key.equals(((MPair)o).key);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int
compareTo(Object rv) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
((Comparable)key).compareTo(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ((MPair)rv).key);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-bottom:9.0pt;border:none'><span lang=EN-US
style='font-family:"Georgia","serif"'>Notice that the comparisons are only
interested in the keys, so duplicate values are perfectly acceptable.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example implements a <b>Map</b>
using a pair of <b>ArrayLists</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:SlowMap.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A Map implemented
with ArrayLists.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class SlowMap
extends AbstractMap {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private ArrayList </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    keys = new
ArrayList(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    values = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object
put(Object key, Object value) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object result =
get(key);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(!keys.contains(key)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      keys.add(key);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      values.add(value);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
values.set(keys.indexOf(key), value);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return result;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object
get(Object key) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(!keys.contains(key))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
values.get(keys.indexOf(key));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Set entrySet()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Set entries = new
HashSet();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ki =
keys.iterator(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      vi =
values.iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(ki.hasNext())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      entries.add(new
MPair(ki.next(), vi.next()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return entries;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    SlowMap m = new SlowMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(m,
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.geography, 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(m);    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoCommentText><span lang=EN-US>The <b>put(&nbsp;)</b> method simply
places the keys and values in corresponding <b>ArrayList</b>s. In <b>main(&nbsp;)</b>,
a <b>SlowMap</b> is loaded and then printed to show that it works.</span></p>

<p class=MsoNormal><span lang=EN-US>This shows that it’s not that hard to
produce a new type of <b>Map</b>. But as the name suggests, a <b>SlowMap </b>isn’t
very fast, so you probably wouldn’t use it if you had an alternative available.
The problem is in the lookup of the key: there is no order so a simple linear
search is used, which is the slowest way to look something up.</span></p>

<p class=MsoNormal><span lang=EN-US>The whole point of hashing is speed:
hashing allows the lookup to happen quickly. Since the bottleneck is in the
speed of the key lookup, one of the solutions to the problem could be by
keeping the keys sorted and then using <b>Collections.binarySearch(&nbsp;)</b>
to perform the lookup (an exercise at the end of this chapter will walk you
through this process).</span></p>

<p class=MsoNormal><span lang=EN-US>Hashing goes further by saying that all you
want to do is to store the key <i>somewhere</i> so that it can be quickly
found. As you’ve seen in this chapter, the fastest structure in which to store
a group of elements is an array, so that will be used for representing the key
information (note carefully that I said “key information,” and not the key
itself). Also seen in this chapter was the fact that an array, once allocated,
cannot be resized, so we have a problem: we want to be able to store any number
of values in the <b>Map</b>, but if the number of keys is fixed by the array
size, how can this be?</span></p>

<p class=MsoNormal><span lang=EN-US>The answer is that the array will not hold
the keys. From the key object, a number will be derived that will index into
the array. This number is the </span><span
lang=EN-US><i>hash code</i>, produced by the <b>hashCode(&nbsp;)</b> method (in
computer science parlance, this is the </span><span
lang=EN-US><i>hash function</i>) defined in <b>Object</b> and presumably
overridden by your class. To solve the problem of the fixed-size array, more
than one key may produce the same index. That is, there may be </span><span lang=EN-US><i>collisions</i>. Because of this, it doesn’t matter how big the
array is because each key object will land somewhere in that array.</span></p>

<p class=MsoNormal><span lang=EN-US>So the process of looking up a value starts
by computing the hash code and using it to index into the array. If you could
guarantee that there were no collisions (which could be possible if you have a
fixed number of values) then you’d have a </span><span lang=EN-US><i>perfect hashing function</i>, but that’s a special case. In all
other cases, collisions are handled by </span><span
lang=EN-US><i>external chaining:</i> the array points not directly to a value,
but instead to a list of values. These values are searched in a linear fashion
using the <b>equals(&nbsp;)</b> method. Of course, this aspect of the search is
much slower, but if the hash function is good there will only be a few values
in each slot, at the most. So instead of searching through the entire list, you
quickly jump to a slot where you have to compare a few entries to find the value.
This is much faster, which is why the <b>HashMap</b> is so quick.</span></p>

<p class=MsoNormal><span lang=EN-US>Knowing the basics of hashing, it’s
possible to implement a simple hashed <b>Map</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:SimpleHashMap.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A demonstration
hashed Map.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
SimpleHashMap extends AbstractMap {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Choose a prime
number for the hash table</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // size, to achieve a
uniform distribution:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private final static
int SZ = 997;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private LinkedList[]
bucket= new LinkedList[SZ];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object
put(Object key, Object value) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object result =
null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int index =
key.hashCode() % SZ;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(index &lt; 0)
index = -index;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(bucket[index] ==
null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      bucket[index] =
new LinkedList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    LinkedList pairs =
bucket[index];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MPair pair = new
MPair(key, value);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ListIterator it =
pairs.listIterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    boolean found =
false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(it.hasNext())
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Object iPair =
it.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(iPair.equals(pair)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        result =
((MPair)iPair).getValue();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        it.set(pair); //
Replace old with new</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        found = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(!found)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
bucket[index].add(pair);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return result;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object
get(Object key) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int index =
key.hashCode() % SZ;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(index &lt; 0)
index = -index;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(bucket[index] ==
null) return null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    LinkedList pairs =
bucket[index];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MPair match = new
MPair(key, null);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ListIterator it =
pairs.listIterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(it.hasNext())
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Object iPair =
it.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(iPair.equals(match))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        return
((MPair)iPair).getValue();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Set entrySet()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Set entries = new
HashSet();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; bucket.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(bucket[i] ==
null) continue;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Iterator it =
bucket[i].iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
while(it.hasNext())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        entries.add(it.next());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return entries;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    SimpleHashMap m =
new SimpleHashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(m,
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.geography, 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(m);    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Because the “slots” in a hash table are
often referred to as <i>buckets,</i> the array that represents the actual table
is called <b>bucket</b>. To promote even distribution, the number of buckets is
typically a prime number. Notice that it is an array of <b>LinkedList</b>,
which automatically provides for collisions—each new item is simply added to
the end of the list.</span></p>

<p class=MsoNormal><span lang=EN-US>The return value of <b>put(&nbsp;)</b> is <b>null</b>
or, if the key was already in the list, the old value associated with that key.
The return value is <b>result</b>, which is initialized to <b>null</b>, but if
a key is discovered in the list then <b>result</b> is assigned to that key.</span></p>

<p class=MsoNormal><span lang=EN-US>For both <b>put(&nbsp;)</b> and <b>get(&nbsp;)</b>,
the first thing that happens is that the <b>hashCode(&nbsp;)</b> is called for
the key, and the result is forced to a positive number. Then it is forced to
fit into the <b>bucket</b> array using the modulus operator and the size of the
array. If that location is <b>null</b>, it means there are no elements that
hash to that location, so a new <b>LinkedList</b> is created to hold the object
that just did. However, the normal process is to look through the list to see
if there are duplicates, and if there are, the old value is put into <b>result</b>
and the new value replaces the old. The <b>found</b> flag keeps track of
whether an old key-value pair was found and, if not, the new pair is appended
to the end of the list.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>get(&nbsp;)</b>, you’ll see very
similar code as that contained in <b>put(&nbsp;)</b>, but simpler. The index is
calculated into the <b>bucket</b> array, and if a <b>LinkedList</b> exists it
is searched for a match.</span></p>

<p class=MsoNormal><b><span lang=EN-US>entrySet(&nbsp;)</span></b><span
lang=EN-US> must find and traverse all the lists, adding them to the result <b>Set</b>.
Once this method has been created, the <b>Map</b> can be tested by filling it
with values and then printing them.</span></p>

<h4><b><span lang=EN-US>HashMap</span></b><span lang=EN-US> performance factors</span></h4>

<p class=MsoNormal style='margin-bottom:3.0pt'><span lang=EN-US>To understand
the issues, some terminology is necessary:</span></p>

<p class=TabularText><span
lang=EN-US><b><i>Capacity</i></b><i>:</i> The number of buckets in the table.</span></p>

<p class=TabularText><span
lang=EN-US><b><i>Initial capacity</i></b><i>:</i> The number of buckets when
the table is created. <b>HashMap</b> and <b>HashSet</b>: have constructors that
allow you to specify the initial capacity.</span></p>

<p class=TabularText><span
lang=EN-US><b><i>Size</i></b><i>:</i> The number of entries currently in the
table.</span></p>

<p class=TabularText style='margin-bottom:9.0pt'><span
lang=EN-US><b><i>Load factor</i></b><i>:</i> size/capacity. A load factor of 0
is an empty table, 0.5 is a half-full table, etc. A lightly-loaded table will
have few collisions and so is optimal for insertions and lookups (but will slow
down the process of traversing with an iterator). <b>HashMap</b> and <b>HashSet</b>
have constructors that allow you to specify the load factor, which means that
when this load factor is reached the container will automatically increase the
capacity (the number of buckets) by roughly doubling it, and will redistribute
the existing objects into the new set of buckets (this is called <i>rehashing</i>).</span></p>

<p class=MsoNormal><span lang=EN-US>The default load factor used by <b>HashMap </b>is
0.75 (it doesn’t rehash until the table is ¾ full). This seems to be a good
trade-off between time and space costs. A higher load factor decreases the
space required by the table but increases the lookup cost, which is important
because lookup is what you do most of the time (including both <b>get(&nbsp;)</b>
and <b>put(&nbsp;)</b>).</span></p>

<p class=MsoNormal><span lang=EN-US>If you know that you’ll be storing many
entries in a <b>HashMap</b>, creating it with an appropriately large initial
capacity will prevent the overhead of automatic rehashing.</span></p>

<h3><a name="_Toc481064693"><span lang=EN-US>Overriding <b>hashCode(&nbsp;)</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>Now that you understand what’s involved in
the function of the <b>HashMap</b>, the issues involved in writing a </span><span lang=EN-US><b>hashCode(&nbsp;)</b> will make more sense.</span></p>

<p class=MsoNormal><span lang=EN-US>First of all, you don’t have control of the
creation of the actual value that’s used to index into the array of buckets.
That is dependent on the capacity of the particular <b>HashMap</b> object, and
that capacity changes depending on how full the container is, and what the load
factor is. The value produced by your <b>hashCode(&nbsp;)</b> will be further
processed in order to create the bucket index (in <b>SimpleHashMap</b> the
calculation is just a modulo by the size of the bucket array). </span></p>

<p class=MsoNormal><span lang=EN-US>The most important factor in creating a <b>hashCode(&nbsp;)</b>
is that, regardless of when <b>hashCode(&nbsp;)</b> is called, it produces the
same value for a particular object every time it is called. If you end up with
an object that produces one <b>hashCode(&nbsp;) </b>value when it is <b>put(&nbsp;)</b>
into a <b>HashMap</b>, and another during a <b>get(&nbsp;)</b>, you won’t be
able to retrieve the objects. So if your <b>hashCode(&nbsp;)</b> depends on
mutable data in the object the user must be made aware that changing the data
will effectively produce a different key by generating a different <b>hashCode(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>In addition, you will probably <i>not </i>want
to generate a <b>hashCode(&nbsp;) </b>that is based on unique object information—in
particular, the value of <b>this</b> makes a bad <b>hashCode(&nbsp;) </b>because
then you can’t generate a new identical key to the one used to <b>put(&nbsp;) </b>the
original key-value pair. This was the problem that occurred in <b>SpringDetector.java</b>
because the default implementation of <b>hashCode(&nbsp;) </b><i>does</i> use
the object address. So you’ll want to use information in the object that
identifies the object in a meaningful way.</span></p>

<p class=MsoNormal><span lang=EN-US>One example is found in the <b>String</b>
class. <b>String</b>s have the special characteristic that if a program has
several <b>String</b> objects that contain identical character sequences, then
those <b>String</b> objects all map to the same memory (the mechanism for this
is described in Appendix A). So it makes sense that the <b>hashCode(&nbsp;)</b>
produced by two separate instances of <b>new String(“hello”)</b> should be
identical. You can see it by running this program:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:StringHashCode.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
StringHashCode {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Hello&quot;.hashCode());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Hello&quot;.hashCode());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>For this to work, the <b>hashCode(&nbsp;)</b>
for <b>String</b> must be based on the contents of the <b>String</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>So for a <b>hashCode(&nbsp;)</b> to be
effective, it must be fast and it must be meaningful: that is, it must generate
a value based on the contents of the object. Remember that this value doesn’t
have to be unique—you should lean toward speed rather than uniqueness—but
between <b>hashCode(&nbsp;)</b> and <b>equals(&nbsp;)</b> the identity of the
object must be completely resolved.</span></p>

<p class=MsoNormal><span lang=EN-US>Because the <b>hashCode(&nbsp;)</b> is
further processed before the bucket index is produced, the range of values is
not important; it just needs to generate an <b>int</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>There’s one other factor: a good <b>hashCode(&nbsp;)</b>
should result in an even distribution of values. If the values tend to cluster,
then the <b>HashMap</b> or <b>HashSet </b>will be more heavily loaded in some
areas and will not be as fast as it could be with an evenly distributed hashing
function.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example that follows these
guidelines:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:CountedString.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creating a good
hashCode().</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
CountedString {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private String s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int id = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static
ArrayList created = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
CountedString(String str) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s = str;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    created.add(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator it =
created.iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Id is the total
number of instances</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // of this string in
use by CountedString:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(it.hasNext())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(it.next().equals(s))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        id++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return &quot;String:
&quot; + s + &quot; id: &quot; + id +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot; hashCode():
&quot; + hashCode() + &quot;\n&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int hashCode()
{ </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return s.hashCode()
* id;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean
equals(Object o) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return (o instanceof
CountedString)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &amp;&amp;
s.equals(((CountedString)o).s)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &amp;&amp; id ==
((CountedString)o).id;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    HashMap m = new
HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    CountedString[] cs =
new CountedString[10];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; cs.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cs[i] = new
CountedString(&quot;hi&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      m.put(cs[i], new
Integer(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; cs.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(&quot;Looking up &quot; + cs[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(m.get(cs[i]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>CountedString</span></b><span
lang=EN-US> includes a <b>String</b> and an <b>id</b> that represents the
number of <b>CountedString</b> objects that contain an identical <b>String</b>.
The counting is accomplished in the constructor by iterating through the <b>static
ArrayList</b> where all the <b>String</b>s are stored.</span></p>

<p class=MsoNormal><span lang=EN-US>Both <b>hashCode(&nbsp;)</b> and <b>equals(&nbsp;)</b>
produce results based on both fields; if they were just based on the <b>String</b>
alone or the <b>id</b> alone there would be duplicate matches for distinct
values.</span></p>

<p class=MsoNormal><span lang=EN-US>Note how simple the <b>hashCode(&nbsp;)</b>
is: <b>String</b>’s <b>hashCode(&nbsp;)</b> is multiplied by the <b>id</b>.
Smaller is generally better (and faster) for <b>hashCode(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>main(&nbsp;)</b>, a bunch of <b>CountedString</b>
objects are created, using the same <b>String</b> to show that the duplicates
create unique values because of the count <b>id</b>. The <b>HashMap</b> is
displayed so that you can see how it is stored internally (no discernible
orders) and then each key is looked up individually to demonstrate that the
lookup mechanism is working properly.</span></p>

<h2><a name="_Toc481064694"><span lang=EN-US>Holding references</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The <b>java.lang.ref</b> library contains a
set of classes that allow greater flexibility in garbage collection, which are
especially useful when you have large objects that may cause memory exhaustion.
There are three classes inherited from the abstract class </span><span lang=EN-US><b>Reference</b>: </span><span
lang=EN-US><b>SoftReference</b>,<b> </b></span><span
lang=EN-US><b>WeakReference</b>, and<b> </b></span><span
lang=EN-US><b>PhantomReference</b>. Each of these provides a different level of
indirection for the garbage collector, if the object in question is <i>only</i>
reachable through one of these <b>Reference</b> objects. </span></p>

<p class=MsoNormal><span lang=EN-US>If an object is </span><span lang=EN-US><i>reachable</i> it means that somewhere in your program the object
can be found. This could mean that you have an ordinary reference on the stack
that goes right to the object, but you might also have a reference to an object
that has a reference to the object in question; there could be many
intermediate links. If an object is reachable, the garbage collector cannot
release it because it’s still in use by your program. If an object isn’t
reachable, there’s no way for your program to use it so it’s safe to
garbage-collect that object.</span></p>

<p class=MsoNormal><span lang=EN-US>You use <b>Reference</b> objects when you
want to continue to hold onto a reference to that object—you want to be able to
reach that object—but you also want to allow the garbage collector to release
that object. Thus, you have a way to go on using the object, but if </span><span lang=EN-US>memory exhaustion is imminent you allow that object to be released.</span></p>

<p class=MsoNormal><span lang=EN-US>You accomplish this by using a <b>Reference</b>
object as an intermediary between you and the ordinary reference, <i>and</i>
there must be no ordinary references to the object (ones that are not wrapped
inside <b>Reference</b> objects). If the garbage collector discovers that an
object is reachable through an ordinary reference, it will not release that
object.</span></p>

<p class=MsoNormal><span lang=EN-US>In the order <b>SoftReference</b>,<b>
WeakReference</b>, and<b> PhantomReference</b>, each one is “weaker” than the
last, and corresponds to a different level of reachability. Soft references are
for implementing memory-sensitive caches. Weak references are for implementing
“canonicalizing mappings”—where instances of objects can be simultaneously used
in multiple places in a program, to save storage—that do not prevent their keys
(or values) from being reclaimed. Phantom references are for scheduling
pre-mortem cleanup actions in a more flexible way than is possible with the
Java finalization mechanism.</span></p>

<p class=MsoNormal><span lang=EN-US>With <b>SoftReference</b>s and<b>
WeakReference</b>s, you have a choice about whether to place them on a <b>ReferenceQueue</b>
(the device used for premortem cleanup actions), but a <b>PhantomReference</b>
can only be built on a <b>ReferenceQueue</b>. Here’s a simple demonstration:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:References.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates
Reference objects</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.lang.ref.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class VeryBig {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static final int SZ =
10000;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  double[] d = new
double[SZ];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String ident;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public VeryBig(String
id) { ident = id; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { return ident; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void finalize()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Finalizing &quot; + ident);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class References
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static ReferenceQueue
rq= new ReferenceQueue();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
checkQueue() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object inq = rq.poll();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(inq != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;In queue: &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
(VeryBig)((Reference)inq).get());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int size = 10;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Or, choose size
via the command line:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &gt;
0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      size =
Integer.parseInt(args[0]);    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    SoftReference[] sa =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
SoftReference[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; sa.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      sa[i] = new
SoftReference(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
VeryBig(&quot;Soft &quot; + i), rq);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Just created: &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        (VeryBig)sa[i].get());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      checkQueue();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    WeakReference[] wa =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
WeakReference[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; wa.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      wa[i] = new
WeakReference(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
VeryBig(&quot;Weak &quot; + i), rq);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Just created: &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
(VeryBig)wa[i].get());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      checkQueue();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    SoftReference s =
new SoftReference(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
VeryBig(&quot;Soft&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    WeakReference w =
new WeakReference(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
VeryBig(&quot;Weak&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.gc();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PhantomReference[]
pa =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new PhantomReference[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; pa.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      pa[i] = new
PhantomReference(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
VeryBig(&quot;Phantom &quot; + i), rq);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Just created: &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
(VeryBig)pa[i].get());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      checkQueue();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When you run this program (you’ll want to
pipe the output through a “more” utility so that you can view the output in
pages), you’ll see that the objects are garbage-collected, even though you
still have access to them through the <b>Reference</b> object (to get the
actual object reference, you use <b>get(&nbsp;)</b>). You’ll also see that the <b>ReferenceQueue</b>
always produces a <b>Reference</b> containing a <b>null</b> object. To make use
of this, you can inherit from the particular <b>Reference</b> class you’re
interested in and add more useful methods to the new type of <b>Reference</b>.</span></p>

<h3><a name="_Toc481064695"><span lang=EN-US>The <b>WeakHashMap</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>The containers library has a special <b>Map</b>
to hold weak references: the </span><span
lang=EN-US><b>WeakHashMap</b>. This class is designed to make the creation of
canonicalized mappings easier. In such a mapping, you are saving storage by
making only one instance of a particular value. When the program needs that
value, it looks up the existing object in the mapping and uses that (rather
than creating one from scratch). The mapping may make the values as part of its
initialization, but it’s more likely that the values are made on demand. </span></p>

<p class=MsoNormal><span lang=EN-US>Since this is a storage-saving technique,
it’s very convenient that the <b>WeakHashMap</b> allows the garbage collector
to automatically clean up the keys and values. You don’t have to do anything
special to the keys and values you want to place in the <b>WeakHashMap</b>;
these are automatically wrapped in <b>WeakReference</b>s by the map. The
trigger to allow cleanup is if the key is no longer in use, as demonstrated
here:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:CanonicalMapping.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates
WeakHashMap.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.lang.ref.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Key {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String ident;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Key(String id)
{ ident = id; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { return ident; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int hashCode()
{ </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
ident.hashCode();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean
equals(Object r) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return (r instanceof
Key)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &amp;&amp;
ident.equals(((Key)r).ident);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void finalize()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Finalizing Key &quot;+ ident);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Value {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String ident;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Value(String
id) { ident = id; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { return ident; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void finalize()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Finalizing Value &quot;+ident);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
CanonicalMapping {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int size = 1000;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Or, choose size
via the command line:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &gt;
0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      size =
Integer.parseInt(args[0]);    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Key[] keys = new
Key[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    WeakHashMap whm =
new WeakHashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; size; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Key k = new
Key(Integer.toString(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Value v = new Value(Integer.toString(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i % 3 == 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        keys[i] = k; //
Save as &quot;real&quot; references</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      whm.put(k, v);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.gc();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Key</b> class must have a <b>hashCode(&nbsp;)</b>
and an <b>equals(&nbsp;)</b> since it is being used as a key in a hashed data
structure, as described previously in this chapter.</span></p>

<p class=MsoNormal><span lang=EN-US>When you run the program you’ll see that
the garbage collector will skip every third key, because an ordinary reference
to that key has also been placed in the <b>keys</b> array and thus those
objects cannot be garbage-collected.</span></p>

<h2><a name="_Toc481064696"></a><a name="_Toc375545358"><span lang=EN-US>Iterators
revisited</span></a></h2>

<p class=MsoNormal><span lang=EN-US>We can now demonstrate the true power of
the </span><span lang=EN-US><b>Iterator</b>: the ability to separate the
operation of traversing a sequence from the underlying structure of that
sequence. In the following example, the class <b>PrintData</b> uses an <b>Iterator</b>
to move through a sequence and call the </span><span
lang=EN-US><b>toString(&nbsp;)</b> method for every object. Two different types
of containers are created—an </span><span lang=EN-US><b>ArrayList</b> and a </span><span lang=EN-US><b>HashMap</b>—and they are each filled with, respectively, <b>Mouse </b>and
<b>Hamster </b>objects. (These classes are defined earlier in this chapter.)
Because an <b>Iterator </b>hides the structure of the underlying container, <b>PrintData</b>
doesn’t know or care what kind of container the <b>Iterator </b>comes from:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Iterators2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Revisiting Iterators.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class PrintData {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
print(Iterator e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(e.hasNext())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(e.next());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Iterators2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList v = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 5; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v.add(new
Mouse(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    HashMap m = new
HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 5; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      m.put(new
Integer(i), new Hamster(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;ArrayList&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
PrintData.print(v.iterator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;HashMap&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
PrintData.print(m.entrySet().iterator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>For the <b>HashMap</b>, the <b>entrySet(&nbsp;)</b>
method produces a <b>Set</b> of <b>Map.entry</b> objects, which contain both
the key and the value for each entry, so you see both of them printed.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that <b>PrintData.print(&nbsp;)</b>
takes advantage of the fact that the objects in these containers are of class <b>Object</b>
so the call <b>toString(&nbsp;)</b> by <b>System.out.println(&nbsp;) </b>is
automatic. It’s more likely that in your problem, you must make the assumption that
your <b>Iterator</b> is walking through a container of some specific type. For
example, you might assume that everything in the container is a <b>Shape</b>
with a <b>draw(&nbsp;)</b> method. Then you must downcast from the <b>Object </b>that
<b>Iterator.next(&nbsp;)</b> returns to produce a <b>Shape</b>.</span></p>

<h2><a name="_Toc481064697"><span lang=EN-US>Choosing an implementation</span></a></h2>

<p class=MsoNormal><span lang=EN-US>By now you should understand that there are
really only three container components: <b>Map</b>, <b>List</b>, and <b>Set</b>,
and only two or three implementations of each interface. If you need to use the
functionality offered by a particular <b>interface</b>, how do you decide which
particular implementation to use?</span></p>

<p class=MsoNormal><span lang=EN-US>To understand the answer, you must be aware
that each different implementation has its own features, strengths, and
weaknesses. For example, you can see in the diagram that the “feature” of <b>Hashtable</b>,
<b>Vector</b>, and <b>Stack</b> is that they are legacy classes, so that old
code doesn’t break. On the other hand, it’s best if you don’t use those for new
(Java 2) code.</span></p>

<p class=MsoNormal><span lang=EN-US>The distinction between the other
containers often comes down to what they are “backed by”; that is, the data
structures that physically implement your desired <b>interface</b>. This means
that, for example, <b>ArrayList</b> and<b> LinkedList </b>implement the <b>List</b>
interface so your program will produce the same results regardless of the one
you use. However, <b>ArrayList</b> is backed by an array, while the <b>LinkedList</b>
is implemented in the usual way for a doubly linked list, as individual objects
each containing data along with references to the previous and next elements in
the list. Because of this, if you want to do many insertions and removals in
the middle of a list, a <b>LinkedList</b> is the appropriate choice. (<b>LinkedList</b>
also has additional functionality that is established in </span><span lang=EN-US><b>AbstractSequentialList</b>.) If not, an <b>ArrayList</b> is
typically faster.</span></p>

<p class=MsoNormal><span lang=EN-US>As another example, a <b>Set</b> can be
implemented as either a <b>TreeSet</b> or a <b>HashSet</b>. A <b>TreeSet</b> is
backed by a <b>TreeMap</b> and is designed to produce a constantly sorted set.
However, if you’re going to have larger quantities in your <b>Set</b>, the
performance of <b>TreeSet</b> insertions will get slow. When you’re writing a
program that needs a <b>Set</b>, you should choose <b>HashSet</b> by default,
and change to <b>TreeSet</b> when it's more important to have a constantly
sorted set.</span></p>

<h3><a name="_Toc481064698"><span lang=EN-US>Choosing between <b>List</b>s</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The most convincing way to see the differences
between the implementations of <b>List</b> is with a performance test. The
following code establishes an inner base class to use as a test framework, then
creates an array of </span><span lang=EN-US>anonymous inner classes, one for each different test. Each of these
inner classes is called by the <b>test(&nbsp;)</b> method. This approach allows
you to easily add and remove new kinds of tests.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:ListPerformance.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates
performance differences in Lists.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ListPerformance {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private abstract
static class Tester {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String name;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int size; // Test quantity</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Tester(String name,
int size) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      this.name = name;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      this.size = size;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    abstract void
test(List a, int reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static
Tester[] tests = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Tester(&quot;get&quot;, 300) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      void test(List a,
int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; reps; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          for(int j = 0;
j &lt; a.size(); j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            a.get(j);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Tester(&quot;iteration&quot;, 300) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      void test(List a,
int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; reps; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Iterator it =
a.iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
while(it.hasNext())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            it.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Tester(&quot;insert&quot;, 5000) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      void test(List a,
int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        int half =
a.size()/2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String s =
&quot;test&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        ListIterator it
= a.listIterator(half);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; size * 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          it.add(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Tester(&quot;remove&quot;, 5000) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      void test(List a,
int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        ListIterator it
= a.listIterator(3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
while(it.hasNext()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          it.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          it.remove();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
test(List a, int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // A trick to print
out the class name:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Testing &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
a.getClass().getName());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; tests.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.fill(a, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Collections2.countries.reset(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        tests[i].size);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(tests[i].name);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      long t1 =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      tests[i].test(a,
reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      long t2 =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.out.println(&quot;:
&quot; + (t2 - t1));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
testArray(int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Testing array as List&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Can only do first
two tests on an array:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 2; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String[] sa = new
String[tests[i].size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Arrays2.fill(sa, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Collections2.countries.reset());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      List a =
Arrays.asList(sa);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(tests[i].name);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      long t1 =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      tests[i].test(a,
reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      long t2 =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;: &quot; + (t2 - t1));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int reps = 50000;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Or, choose the
number of repetitions</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // via the command
line:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &gt;
0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      reps =
Integer.parseInt(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(reps + &quot; repetitions&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    testArray(reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new
ArrayList(), reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new
LinkedList(), reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new Vector(),
reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The inner class <b>Tester</b> is <b>abstract</b>,
to provide a base class for the specific tests. It contains a <b>String</b> to
be printed when the test starts, a <b>size </b>parameter to be used by the test
for quantity of elements or repetitions of tests, a constructor to initialize
the fields, and an <b>abstract</b> method <b>test(&nbsp;)</b> that does the
work. All the different types of tests are collected in one place, the array <b>tests</b>,
which is initialized with different anonymous inner classes that inherit from <b>Tester</b>.
To add or remove tests, simply add or remove an inner class definition from the
array, and everything else happens automatically.</span></p>

<p class=MsoNormal><span lang=EN-US>To compare array access to container access
(primarily against <b>ArrayList</b>), a special test is created for arrays by
wrapping one as a <b>List</b> using <b>Arrays.asList(&nbsp;)</b>. Note that
only the first two tests can be performed in this case, because you cannot
insert or remove elements from an array.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>List</b> that’s handed to <b>test(&nbsp;)</b>
is first filled with elements, then each test in the <b>tests</b> array is
timed. The results will vary from machine to machine; they are intended to give
only an order of magnitude comparison between the performance of the different
containers. Here is a summary of one run:</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border:solid black 1.5pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US>Type</span></p>
  </td>
  <td width=61 valign=top style='width:45.8pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US>Get</span></p>
  </td>
  <td width=83 valign=top style='width:62.2pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US>Iteration</span></p>
  </td>
  <td width=66 valign=top style='width:49.5pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US>Insert</span></p>
  </td>
  <td width=78 valign=top style='width:58.5pt;border:solid black 1.5pt;
  border-left:none;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US>Remove</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>array</span></p>
  </td>
  <td width=61 valign=top style='width:45.8pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>1430</span></p>
  </td>
  <td width=83 valign=top style='width:62.2pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>3850</span></p>
  </td>
  <td width=66 valign=top style='width:49.5pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>na</span></p>
  </td>
  <td width=78 valign=top style='width:58.5pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>na</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US>ArrayList</span></p>
  </td>
  <td width=61 valign=top style='width:45.8pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>3070</span></p>
  </td>
  <td width=83 valign=top style='width:62.2pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>12200</span></p>
  </td>
  <td width=66 valign=top style='width:49.5pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>500</span></p>
  </td>
  <td width=78 valign=top style='width:58.5pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>46850</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US>LinkedList</span></p>
  </td>
  <td width=61 valign=top style='width:45.8pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>16320</span></p>
  </td>
  <td width=83 valign=top style='width:62.2pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>9110</span></p>
  </td>
  <td width=66 valign=top style='width:49.5pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>110</span></p>
  </td>
  <td width=78 valign=top style='width:58.5pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>60</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US>Vector</span></p>
  </td>
  <td width=61 valign=top style='width:45.8pt;border-top:none;border-left:none;
  border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>4890</span></p>
  </td>
  <td width=83 valign=top style='width:62.2pt;border-top:none;border-left:none;
  border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>16250</span></p>
  </td>
  <td width=66 valign=top style='width:49.5pt;border-top:none;border-left:none;
  border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>550</span></p>
  </td>
  <td width=78 valign=top style='width:58.5pt;border-top:none;border-left:none;
  border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-right:0cm'><span lang=EN-US style='font-weight:
  normal'>46850</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>As expected, arrays are faster than any
container for random-access lookups and iteration. You can see that random
accesses (<b>get(&nbsp;)</b>) are cheap for <b>ArrayList</b>s and expensive for
<b>LinkedList</b>s. (Oddly, iteration is <i>faster</i> for a </span><span lang=EN-US><b>LinkedList</b> than an </span><span
lang=EN-US><b>ArrayList</b>, which is a bit counterintuitive.) On the other
hand, insertions and removals from the middle of a list are dramatically
cheaper for a <b>LinkedList</b> than for an <b>ArrayList</b>—<i>especially</i>
removals. </span><span lang=EN-US><b>Vector </b>is generally not as fast as <b>ArrayList</b>,
and it should be avoided; it’s only in the library for legacy code support (the
only reason it works in this program is because it was adapted to be a <b>List</b>
in Java 2).<b> </b>The best approach is probably to choose an <b>ArrayList</b>
as your default, and to change to a <b>LinkedList</b> if you discover
performance problems due to many insertions and removals from the middle of the
list. And of course, if you are working with a fixed-sized group of elements,
use an array.</span></p>

<h3><a name="_Toc481064699"><span lang=EN-US>Choosing between <b>Set</b>s</span></a></h3>

<p class=MsoNormal><span lang=EN-US>You can choose between a </span><span lang=EN-US><b>TreeSet </b>and a </span><span lang=EN-US><b>HashSet</b>,
depending on the size of the </span><span lang=EN-US><b>Set</b> (if you need to
produce an ordered sequence from a <b>Set</b>, use <b>TreeSet</b>).<b> </b>The
following test program gives an indication of this trade-off:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:SetPerformance.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
SetPerformance {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private abstract
static class Tester {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String name;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Tester(String name)
{ this.name = name; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    abstract void
test(Set s, int size, int reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static
Tester[] tests = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Tester(&quot;add&quot;) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      void test(Set s,
int size, int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; reps; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          s.clear();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
Collections2.fill(s, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
Collections2.countries.reset(),size);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Tester(&quot;contains&quot;) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      void test(Set s,
int size, int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; reps; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          for(int j = 0;
j &lt; size; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
s.contains(Integer.toString(j));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Tester(&quot;iteration&quot;) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      void test(Set s,
int size, int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; reps * 10; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Iterator it =
s.iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
while(it.hasNext())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            it.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  test(Set s, int size,
int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Testing &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
s.getClass().getName() + &quot; size &quot; + size);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(s,
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.countries.reset(), size);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; tests.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.out.print(tests[i].name);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      long t1 =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      tests[i].test(s,
size, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      long t2 =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;: &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        ((double)(t2 -
t1)/(double)size));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void main(String[]
args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int reps = 50000;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Or, choose the
number of repetitions</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // via the command
line:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &gt;
0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      reps =
Integer.parseInt(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Small:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new TreeSet(),
10, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new HashSet(),
10, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Medium:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new TreeSet(),
100, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new HashSet(),
100, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Large:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new TreeSet(),
1000, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new HashSet(),
1000, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The following table shows the results of
one run. (Of course, this will be different according to the computer and JVM
you are using; you should run the test yourself as well):</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td valign=top style='border-top:black 1.5pt;border-left:black 1.5pt;
  border-bottom:windowtext 1.5pt;border-right:black 1.0pt;border-style:solid;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Type</span></p>
  </td>
  <td valign=top style='border-top:solid black 1.5pt;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Test size</span></p>
  </td>
  <td valign=top style='border-top:solid black 1.5pt;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Add</span></p>
  </td>
  <td valign=top style='border-top:solid black 1.5pt;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Contains</span></p>
  </td>
  <td valign=top style='border-top:solid black 1.5pt;border-left:none;
  border-bottom:solid windowtext 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Iteration</span></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border-top:none;border-left:solid black 1.5pt;
  border-bottom:none;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>10</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>138.0</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>115.0</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>187.0</span></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border-top:none;border-left:solid black 1.5pt;
  border-bottom:none;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>TreeSet </span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>100</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>189.5</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>151.1</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>206.5</span></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>1000</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>150.6</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>177.4</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>40.04</span></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border-top:none;border-left:solid black 1.5pt;
  border-bottom:none;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>10</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>55.0</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>82.0</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>192.0</span></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border-top:none;border-left:solid black 1.5pt;
  border-bottom:none;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>HashSet </span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>100</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>45.6</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>90.0</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.0pt;
  border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>202.2</span></p>
  </td>
 </tr>
 <tr>
  <td valign=top style='border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.5pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>1000</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.5pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>36.14</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.5pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>106.5</span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid black 1.5pt;
  border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>39.39</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>The performance of <b>HashSet</b> is
generally superior to <b>TreeSet</b> for all operations (but in particular
addition and lookup, the two most important operations). The only reason <b>TreeSet</b>
exists is because it maintains its elements in sorted order, so you only use it
when you need a sorted <b>Set</b>.</span></p>

<h3><a name="_Toc481064700"><span lang=EN-US>Choosing between <b>Map</b>s</span></a></h3>

<p class=MsoNormal><span lang=EN-US>When choosing between implementations of </span><span lang=EN-US><b>Map</b>, the size of the <b>Map</b> is what most strongly affects
performance, and the following test program gives an indication of this
trade-off:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:MapPerformance.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates
performance differences in Maps.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
MapPerformance {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private abstract
static class Tester {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String name;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Tester(String name)
{ this.name = name; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    abstract void
test(Map m, int size, int reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static
Tester[] tests = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Tester(&quot;put&quot;) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      void test(Map m,
int size, int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; reps; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          m.clear();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
Collections2.fill(m, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
Collections2.geography.reset(), size);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Tester(&quot;get&quot;) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      void test(Map m,
int size, int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; reps; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          for(int j = 0;
j &lt; size; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
m.get(Integer.toString(j));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Tester(&quot;iteration&quot;) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      void test(Map m,
int size, int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; reps * 10; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Iterator it =
m.entrySet().iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          while(it.hasNext())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            it.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  test(Map m, int size,
int reps) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Testing &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
m.getClass().getName() + &quot; size &quot; + size);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(m,
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Collections2.geography.reset(),
size);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; tests.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(tests[i].name);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      long t1 =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      tests[i].test(m,
size, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      long t2 =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.out.println(&quot;:
&quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        ((double)(t2 -
t1)/(double)size));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int reps = 50000;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Or, choose the
number of repetitions</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // via the command
line:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &gt;
0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      reps =
Integer.parseInt(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Small:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new TreeMap(),
10, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new HashMap(),
10, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new
Hashtable(), 10, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Medium:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new TreeMap(),
100, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new HashMap(),
100, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new
Hashtable(), 100, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Large:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new TreeMap(),
1000, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new HashMap(),
1000, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new
Hashtable(), 1000, reps);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Because the size of the map is the issue,
you’ll see that the timing tests divide the time by the size to normalize each
measurement. Here is one set of results. (Yours will probably be different.)</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr>
   <td width=102 valign=top style='width:76.5pt;border-top:windowtext 1.5pt;
   border-left:black 1.5pt;border-bottom:windowtext 1.5pt;border-right:black 1.0pt;
   border-style:solid;padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Type </span></p>
   </td>
   <td width=60 valign=top style='width:45.0pt;border-top:solid windowtext 1.5pt;
   border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Test size</span></p>
   </td>
   <td width=60 valign=top style='width:45.0pt;border-top:solid windowtext 1.5pt;
   border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Put</span></p>
   </td>
   <td width=72 valign=top style='width:53.85pt;border-top:solid windowtext 1.5pt;
   border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Get</span></p>
   </td>
   <td width=96 valign=top style='width:72.0pt;border-top:solid windowtext 1.5pt;
   border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Iteration</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:none;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>10</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>143.0</span></p>
  </td>
  <td width=72 valign=top style='width:53.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>110.0</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>186.0</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:none;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>TreeMap </span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>100</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>201.1</span></p>
  </td>
  <td width=72 valign=top style='width:53.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>188.4</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>280.1</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>1000</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>222.8</span></p>
  </td>
  <td width=72 valign=top style='width:53.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>205.2</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>40.7</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:none;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='page-break-after:avoid'><span lang=EN-US> </span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>10</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>66.0</span></p>
  </td>
  <td width=72 valign=top style='width:53.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>83.0</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>197.0</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:none;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>HashMap</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>100</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>80.7</span></p>
  </td>
  <td width=72 valign=top style='width:53.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>135.7</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>278.5</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>1000</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>48.2</span></p>
  </td>
  <td width=72 valign=top style='width:53.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>105.7</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>41.4</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:none;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US> </span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>10</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>61.0</span></p>
  </td>
  <td width=72 valign=top style='width:53.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>93.0</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>302.0</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:none;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Hashtable</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>100</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>90.6</span></p>
  </td>
  <td width=72 valign=top style='width:53.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>143.3</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>329.0</span></p>
  </td>
 </tr>
 <tr>
  <td width=102 valign=top style='width:76.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>1000</span></p>
  </td>
  <td width=60 valign=top style='width:45.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>54.1</span></p>
  </td>
  <td width=72 valign=top style='width:53.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>110.95</span></p>
  </td>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>47.3</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>As you might expect, </span><span lang=EN-US><b>Hashtable</b> performance is roughly equivalent to <b>HashMap</b>.
(You can also see that <b>HashMap</b> is generally a bit faster. <b>HashMap</b>
is intended to replace <b>Hashtable</b>.) The </span><span
lang=EN-US><b>TreeMap </b>is generally slower than the <b>HashMap</b>, so why
would you use it? So you could use it not as a <b>Map</b>,<b> </b>but as a way
to create an ordered list. The behavior of a tree is such that it’s always in
order and doesn’t have to be specially sorted. Once you fill a <b>TreeMap</b>,
you can call </span><span lang=EN-US><b>keySet(&nbsp;)</b> to get a <b>Set</b>
view of the keys, then </span><span lang=EN-US><b>toArray(&nbsp;)</b> to
produce an array of those keys. You can then use the <b>static </b>method <b>Arrays.binarySearch(&nbsp;)</b>
(discussed later) to rapidly find objects in your sorted array. Of course, you
would probably only do this if, for some reason, the behavior of a <b>HashMap</b>
was unacceptable, since <b>HashMap </b>is designed to rapidly find things.
Also, you can easily create a <b>HashMap </b>from a <b>TreeMap </b>with a
single object creation In the end, when you’re using a <b>Map </b>your first
choice should be <b>HashMap</b>, and only if you need a constantly sorted <b>Map</b>
will you need <b>TreeMap</b>.</span></p>

<h2><a name="_Toc481064701"><span lang=EN-US>Sorting and searching <b>List</b>s</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Utilities to perform sorting and searching for </span><span lang=EN-US><b>List</b>s have the same names and signatures as those for sorting
arrays of objects, but are <b>static </b>methods of </span><span
lang=EN-US><b>Collections</b> instead of <b>Arrays</b>. Here’s an example,
modified from <b>ArraySearching.java</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:ListSortSearch.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Sorting and searching
Lists with 'Collections.'</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ListSortSearch {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    List list = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections2.fill(list, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.capitals, 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(list + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections.shuffle(list);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;After shuffling: &quot;+list);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections.sort(list);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(list + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object key =
list.get(12);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int index = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections.binarySearch(list, key);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Location of &quot; + key + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot; is &quot; +
index + &quot;, list.get(&quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      index + &quot;) =
&quot; + list.get(index));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    AlphabeticComparator
comp =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
AlphabeticComparator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections.sort(list, comp);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(list + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    key = list.get(12);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    index = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections.binarySearch(list, key, comp);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Location
of &quot; + key + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot; is &quot; +
index + &quot;, list.get(&quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      index + &quot;) =
&quot; + list.get(index));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The use of these methods is identical to
the ones in <b>Arrays</b>, but you’re using a <b>List</b> instead of an array.
Just like searching and sorting with arrays, if you sort using a <b>Comparator</b>
you must <b>binarySearch(&nbsp;)</b> using the same <b>Comparator</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>This program also demonstrates the </span><span lang=EN-US><b>shuffle(&nbsp;)</b> method in <b>Collections</b>, which randomizes
the order of a <b>List</b>.</span></p>

<h2><a name="_Toc481064702"><span lang=EN-US>Utilities</span></a></h2>

<p class=MsoNormal><span lang=EN-US>There are a number of other useful
utilities in the <b>Collections</b> class: </span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=246 valign=top style='width:184.5pt;border-top:1.5pt;border-left:
  1.5pt;border-bottom:1.0pt;border-right:1.0pt;border-color:black;border-style:
  solid;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>enumeration(Collection) </span></p>
  </td>
  <td width=240 valign=top style='width:180.0pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Produces an
  old-style </span><span lang=EN-US>Enumeration</span><span lang=EN-US
  style='font-weight:normal'> for the argument.</span></p>
  </td>
 </tr>
 <tr>
  <td width=246 valign=top style='width:184.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>max(Collection) </span></p>
  <p class=Table><span lang=EN-US>min(Collection)</span></p>
  </td>
  <td width=240 valign=top style='width:180.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Produces the
  maximum or minimum element in the argument using the natural comparison
  method of the objects in the </span><span lang=EN-US>Collection</span><span
  lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=246 valign=top style='width:184.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>max(Collection, Comparator) </span></p>
  <p class=Table><span lang=EN-US>min(Collection, Comparator)</span></p>
  </td>
  <td width=240 valign=top style='width:180.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Produces the
  maximum or minimum element in the </span><span lang=EN-US>Collection</span><span
  lang=EN-US style='font-weight:normal'> using the </span><span lang=EN-US>Comparator</span><span
  lang=EN-US style='font-weight:normal'>. </span></p>
  </td>
 </tr>
 <tr>
  <td width=246 valign=top style='width:184.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>reverse(&nbsp;)</span></p>
  </td>
  <td width=240 valign=top style='width:180.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Reverses all the
  elements in place.</span></p>
  </td>
 </tr>
 <tr>
  <td width=246 valign=top style='width:184.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>copy(List dest, List src)</span></p>
  </td>
  <td width=240 valign=top style='width:180.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Copies elements
  from src to dest.</span></p>
  </td>
 </tr>
 <tr>
  <td width=246 valign=top style='width:184.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>fill(List list, Object o)</span></p>
  </td>
  <td width=240 valign=top style='width:180.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Replaces all the
  elements of list with o.</span></p>
  </td>
 </tr>
 <tr>
  <td width=246 valign=top style='width:184.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>nCopies(int n, Object o) </span></p>
  </td>
  <td width=240 valign=top style='width:180.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns an
  immutable </span><span lang=EN-US>List</span><span lang=EN-US
  style='font-weight:normal'> of size n whose references all point to o. </span></p>
  </td>
 </tr>
</table>

</div>

<p class=MsoNormal style='margin-top:6.0pt'><span lang=EN-US>Note that <b>min(&nbsp;)</b>
and <b>max(&nbsp;)</b> work with <b>Collection</b> objects, not with <b>List</b>s,
so you don’t need to worry about whether the <b>Collection</b> should be sorted
or not. (As mentioned earlier, you <i>do</i> need to <b>sort(&nbsp;)</b> a <b>List</b>
or an array before performing a <b>binarySearch(&nbsp;)</b>.)</span></p>

<h3><a name="_Toc481064703"><span lang=EN-US>Making a <b>Collection</b> or <b>Map</b>
unmodifiable</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>Often it is convenient to create a read-only version of a <b>Collection</b>
or <b>Map</b>. The <b>Collections</b> class allows you to do this by passing
the original container into a method that hands back a read-only version. There
are four variations on this method, one each for <b>Collection</b> (if you
don’t want to treat a <b>Collection </b>as a more specific type), <b>List</b>, <b>Set,</b>
and <b>Map</b>. This example shows the proper way to build read-only versions
of each:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:ReadOnly.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using the
Collections.unmodifiable methods.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ReadOnly {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static
Collections2.StringGenerator gen = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Collections2.countries;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collection c = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(c,
gen, 25); // Insert data</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c =
Collections.unmodifiableCollection(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(c); // Reading is OK</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
c.add(&quot;one&quot;); // Can't change it</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    List a = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(a,
gen.reset(), 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a =
Collections.unmodifiableList(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ListIterator lit =
a.listIterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(lit.next()); // Reading OK</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
lit.add(&quot;one&quot;); // Can't change it</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Set s = new
HashSet();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(s,
gen.reset(), 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s =
Collections.unmodifiableSet(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s); // Reading OK</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //!
s.add(&quot;one&quot;); // Can't change it</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Map m = new
HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(m,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.geography, 25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    m = Collections.unmodifiableMap(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(m); // Reading OK</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //!
m.put(&quot;Ralph&quot;, &quot;Howdy!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In each case, you must fill the container
with meaningful data <i>before</i> you make it read-only. Once it is loaded,
the best approach is to replace the existing reference with the reference that
is produced by the “unmodifiable” call. That way, you don’t run the risk of
accidentally changing the contents once you’ve made it unmodifiable. On the
other hand, this tool also allows you to keep a modifiable container as <b>private</b>
within a class and to return a read-only reference to that container from a
method call. So you can change it from within the class, but everyone else can
only read it.</span></p>

<p class=MsoNormal><span lang=EN-US>Calling the “unmodifiable” method for a
particular type does not cause compile-time checking, but once the
transformation has occurred, any calls to methods that modify the contents of a
particular container will produce an <b>UnsupportedOperationException</b>.</span></p>

<h3><a name="_Toc481064704"><span lang=EN-US>Synchronizing a <b>Collection</b>
or <b>Map</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>The </span><span
lang=EN-US><b>synchronized</b> keyword is an important part of the subject of </span><span lang=EN-US><i>multithreading</i>, a more complicated topic that will not be
introduced until Chapter 14. Here, I shall note only that the <b>Collections</b>
class contains a way to automatically synchronize an entire container. The
syntax is similar to the “unmodifiable” methods:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:Synchronization.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using the
Collections.synchronized methods.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
Synchronization {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void main(String[]
args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collection c = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections.synchronizedCollection(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
ArrayList());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    List list =
Collections.synchronizedList(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new ArrayList());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Set s =
Collections.synchronizedSet(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new HashSet());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Map m = Collections.synchronizedMap(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new HashMap());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In this case, you immediately pass the new
container through the appropriate “synchronized” method; that way there’s no
chance of accidentally exposing the unsynchronized version.</span></p>

<h4><span lang=EN-US>Fail fast</span></h4>

<p class=MsoNormal><span
lang=EN-US>The Java containers also have a mechanism to prevent more than one
process from modifying the contents of a container. The problem occurs if
you’re iterating through a container and some other process steps in and
inserts, removes, or changes an object in that container. Maybe you’ve already
passed that object, maybe it’s ahead of you, maybe the size of the container
shrinks after you call <b>size(&nbsp;)</b>—there are many scenarios for
disaster. The Java containers library incorporates a <i>fail-fast</i> mechanism
that looks for any changes to the container other than the ones your process is
personally responsible for. If it detects that someone else is modifying the
container, it immediately produces a <b>ConcurrentModificationException</b>.
This is the “fail-fast” aspect—it doesn’t try to detect a problem later on
using a more complex algorithm.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s quite easy to see the fail-fast
mechanism in operation—all you have to do is create an iterator and then add
something to the collection that the iterator is pointing to, like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:FailFast.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates the
&quot;fail fast&quot; behavior.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class FailFast {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collection c = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator it =
c.iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.add(&quot;An
object&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Causes an
exception:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s =
(String)it.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The exception happens because something is
placed in the container <i>after</i> the iterator is acquired from the
container. The possibility that two parts of the program could be modifying the
same container produces an uncertain state, so the exception notifies you that
you should change your code—in this case, acquire the iterator <i>after</i> you
have added all the elements to the container.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that you cannot benefit from this kind
of monitoring when you’re accessing the elements of a <b>List</b> using <b>get(&nbsp;)</b>.</span></p>

<h2><a name="_Toc481064705"><span lang=EN-US>Unsupported operations</span></a></h2>

<p class=MsoNormal><span lang=EN-US>It’s possible to turn an array into a <b>List</b> with the <b>Arrays.asList(&nbsp;)</b>
method:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Unsupported.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Sometimes methods
defined in the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Collection interfaces
don't work!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Unsupported
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static
String[] s = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;one&quot;,
&quot;two&quot;, &quot;three&quot;, &quot;four&quot;, &quot;five&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;six&quot;,
&quot;seven&quot;, &quot;eight&quot;, &quot;nine&quot;, &quot;ten&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static List a =
Arrays.asList(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static List a2 =
a.subList(3, 6);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(a2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;a.contains(&quot; + s[0] + &quot;) = &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a.contains(s[0]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;a.containsAll(a2) = &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
a.containsAll(a2));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;a.isEmpty() = &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a.isEmpty());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;a.indexOf(&quot; + s[5] + &quot;) = &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a.indexOf(s[5]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Traverse
backwards:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ListIterator lit =
a.listIterator(a.size());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
while(lit.hasPrevious())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print(lit.previous() + &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Set the elements
to different values:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a.size(); i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a.set(i,
&quot;47&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Compiles, but
won't run:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
lit.add(&quot;X&quot;); // Unsupported operation</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.clear(); //
Unsupported</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.add(&quot;eleven&quot;);
// Unsupported</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.addAll(a2); //
Unsupported</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.retainAll(a2); //
Unsupported</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.remove(s[0]); //
Unsupported</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a.removeAll(a2); //
Unsupported</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll discover that only a portion of the <b>Collection</b>
and <b>List </b>interfaces are actually implemented. The rest of the methods
cause the unwelcome appearance of something called an <b>UnsupportedOperationException</b>.
You’ll learn all about exceptions in the next chapter, but the short story is
that the <b>Collection</b> <b>interface</b>—as well as some of the other <b>interface</b>s
in the Java containers library—contain “optional” methods, which might or might
not be “supported” in the concrete class that <b>implements</b> that <b>interface</b>.
Calling an unsupported method causes an <b>UnsupportedOperationException</b> to
indicate a programming error.</span></p>

<p class=MsoNormal><span lang=EN-US>“What?!?” you say, incredulous. “The whole
point of <b>interface</b>s and base classes is that they promise these methods
will do something meaningful! This breaks that promise—it says that not only
will calling some methods <i>not</i> perform a meaningful behavior, they will
stop the program! Type safety was just thrown out the window!” </span></p>

<p class=MsoNormal><span lang=EN-US>It’s not quite that bad. With a <b>Collection</b>,
<b>List</b>, <b>Set</b>, or <b>Map</b>, the compiler still restricts you to
calling only the methods in that <b>interface</b>, so it’s not like Smalltalk
(in which you can call any method for any object, and find out only when you
run the program whether your call does anything). In addition, most methods
that take a <b>Collection</b> as an argument only read from that <b>Collection</b>—all
the “read” methods of <b>Collection </b>are <i>not</i> optional.</span></p>

<p class=MsoNormal><span lang=EN-US>This approach prevents an explosion of
interfaces in the design. Other designs for container libraries always seem to
end up with a confusing plethora of interfaces to describe each of the
variations on the main theme and are thus difficult to learn. It’s not even
possible to capture all of the special cases in <b>interface</b>s, because
someone can always invent a new <b>interface</b>. The “unsupported operation”
approach achieves an important goal of the Java containers library: the containers
are simple to learn and use; unsupported operations are a special case that can
be learned later. For this approach to work, however:</span></p>

<p class=Numbered><span lang=EN-US>The <b>UnsupportedOperationException</b>
must be a rare event. That is, for most classes all operations should work, and
only in special cases should an operation be unsupported. This is true in the
Java containers library, since the classes you’ll use 99 percent of the time—<b>ArrayList</b>,
<b>LinkedList</b>, <b>HashSet</b>, and <b>HashMap</b>, as well as the other
concrete implementations—support all of the operations. The design does provide
a “back door” if you want to create a new <b>Collection</b> without providing
meaningful definitions for all the methods in the <b>Collection</b> <b>interface</b>,
and yet still fit it into the existing library.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>59.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>When an operation <i>is</i> unsupported, there should be reasonable
likelihood that an <b>UnsupportedOperationException</b> will appear at
implementation time, rather than after you’ve shipped the product to the
customer. After all, it indicates a programming error: you’ve used an implementation
incorrectly. This point is less certain, and is where the experimental nature
of this design comes into play. Only over time will we find out how well it
works.</span></p>

<p class=MsoNormal><span lang=EN-US>In the example above, </span><span lang=EN-US><b>Arrays.asList(&nbsp;)</b> produces a <b>List</b> that is backed by
a fixed-size array. Therefore it makes sense that the only supported operations
are the ones that don’t change the size of the array. If, on the other hand, a
new <b>interface</b> were required to express this different kind of behavior
(called, perhaps, “<b>FixedSizeList</b>”), it would throw open the door to
complexity and soon you wouldn’t know where to start when trying to use the
library.</span></p>

<p class=MsoNormal><span lang=EN-US>The documentation for a method that takes a
<b>Collection</b>, <b>List</b>, <b>Set</b>, or <b>Map</b> as an argument should
specify which of the optional methods must be implemented. For example, sorting
requires the <b>set(&nbsp;)</b> and <b>Iterator.set(&nbsp;) </b>methods, but
not <b>add(&nbsp;)</b> and <b>remove(&nbsp;)</b>. </span></p>

<h2><a name="_Toc481064706"><span lang=EN-US>Java 1.0/1.1 containers</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Unfortunately, a lot of code was written
using the Java 1.0/1.1 containers, and even new code is sometimes written using
these classes. So although you should never use the old containers when writing
new code, you’ll still need to be aware of them. However, the old containers
were quite limited, so there’s not that much to say about them. (Since they are
in the past, I will try to refrain from overemphasizing some of the hideous
design decisions.)</span></p>

<h3><a name="_Toc375545355"></a><a name="_Toc481064707"><span lang=EN-US>Vector
&amp; Enumeration</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The only self-expanding sequence in Java
1.0/1.1 was the </span><span lang=EN-US><b>Vector</b>, and so it saw a lot of
use. Its flaws are too numerous to describe here (see the first edition of this
book, available on this book’s CD ROM and as a free download from <i>www.BruceEckel.com</i>).
Basically, you can think of it as an <b>ArrayList</b> with long, awkward method
names. In the Java 2 container library, <b>Vector</b> was adapted so that it
could fit as a <b>Collection </b>and a <b>List</b>, so in the following example
the <b>Collections2.fill(&nbsp;)</b> method is successfully used. This turns
out to be a bit perverse, as it may confuse some people into thinking that <b>Vector</b>
has gotten better, when it is actually included only to support pre-Java 2
code.</span></p>

<p class=MsoNormal><span lang=EN-US>The Java 1.0/1.1 version of the iterator
chose to invent a new name, “enumeration,” instead of using a term that
everyone was already familiar with. The </span><span
lang=EN-US><b>Enumeration</b> interface is smaller than <b>Iterator</b>, with
only two methods, and it uses longer method names: <b>boolean</b> <b>hasMoreElements(&nbsp;)</b>
produces <b>true</b> if this enumeration contains more elements, and <b>Object
nextElement(&nbsp;) </b>returns the next element of this enumeration if there
are any more (otherwise it throws an exception).</span></p>

<p class=MsoNormal><b><span lang=EN-US>Enumeration</span></b><span lang=EN-US>
is only an interface, not an implementation, and even new libraries sometimes
still use the old <b>Enumeration</b>—which is unfortunate but generally
harmless. Even though you should always use <b>Iterator</b> when you can in
your own code, you must be prepared for libraries that want to hand you an <b>Enumeration</b>.</span></p>

<p class=MsoNormal><span
lang=EN-US>In addition, you can produce an <b>Enumeration</b> for any <b>Collection</b>
by using the <b>Collections.enumeration(&nbsp;)</b> method, as seen in this
example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c09:Enumerations.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Java 1.0/1.1 Vector
and Enumeration.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Enumerations {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Vector v = new
Vector();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v, Collections2.countries,
100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Enumeration e =
v.elements();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
while(e.hasMoreElements())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(e.nextElement());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Produce an
Enumeration from a Collection:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    e =
Collections.enumeration(new ArrayList());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The Java 1.0/1.1 <b>Vector</b> has only an <b>addElement(&nbsp;)</b>
method, but <b>fill(&nbsp;)</b> uses the <b>add(&nbsp;)</b> method that was
pasted on as <b>Vector</b> was turned into a <b>List</b>. To produce an <b>Enumeration</b>,
you call <b>elements(&nbsp;)</b>, then you can use it to perform a forward
iteration.</span></p>

<p class=MsoNormal><span lang=EN-US>The last line creates an <b>ArrayList</b>
and uses <b>enumeration(&nbsp;)</b> to adapt an <b>Enumeration</b> from the <b>ArrayList</b>
<b>Iterator</b>. Thus, if you have old code that wants an <b>Enumeration</b>,
you can still use the new containers.</span></p>

<h3><a name="_Toc481064708"><span lang=EN-US>Hashtable</span></a></h3>

<p class=MsoNormal><span lang=EN-US>As you’ve seen in the performance
comparison in this chapter, the basic </span><span
lang=EN-US><b>Hashtable</b> is very similar to the <b>HashMap</b>, even down to
the method names. There’s no reason to use <b>Hashtable</b> instead of <b>HashMap</b>
in new code.</span></p>

<h3><a name="_Toc481064709"></a><a name="_Toc375545356"><span lang=EN-US>Stack</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The concept of the stack was introduced
earlier, with the <b>LinkedList</b>.<b> </b>What’s rather odd about the Java
1.0/1.1 <b>Stack </b>is that instead of using a </span><span
lang=EN-US><b>Vector</b> as a building block, </span><span
lang=EN-US><b>Stack </b>is <i>inherited</i> from <b>Vector</b>. So it has all
of the characteristics and behaviors of a <b>Vector</b> plus some extra <b>Stack</b>
behaviors. It’s difficult to know whether the designers explicitly decided that
this was an especially useful way of doing things, or whether it was just a
naive design.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s a simple demonstration of <b>Stack</b>
that pushes each line from a <b>String</b> array:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Stacks.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstration of
Stack Class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Stacks {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static String[] months
= { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;January&quot;,
&quot;February&quot;, &quot;March&quot;, &quot;April&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;May&quot;,
&quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;October&quot;,
&quot;November&quot;, &quot;December&quot; };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Stack stk = new
Stack();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; months.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      stk.push(months[i]
+ &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;stk = &quot; + stk);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Treating a stack
as a Vector:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
stk.addElement(&quot;The last line&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;element 5 =
&quot; + stk.elementAt(5));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;popping elements:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(!stk.empty())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(stk.pop());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Each line in the <b>months </b>array is
inserted into the <b>Stack</b> with <b>push(&nbsp;)</b>, and later fetched from
the top of the stack with a <b>pop(&nbsp;)</b>. To make a point, <b>Vector </b>operations
are also performed on the <b>Stack</b> object. This is possible because, by
virtue of inheritance, a <b>Stack</b> <i>is</i> a <b>Vector</b>. Thus, all
operations that can be performed on a <b>Vector</b> can also be performed on a <b>Stack</b>,
such as <b>elementAt(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>As mentioned earlier, you should use a <b>LinkedList</b>
when you want stack behavior.</span></p>

<h3><a name="_Toc481064710"><span lang=EN-US>BitSet</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A </span><span
lang=EN-US><b>BitSet</b> is used if you want to efficiently store a lot of
on-off information. It’s efficient only from the standpoint of size; if you’re
looking for efficient access, it is slightly slower than using an array of some
native type.</span></p>

<p class=MsoNormal><span lang=EN-US>In addition, the minimum size of the <b>BitSet</b>
is that of a <b>long</b>: 64 bits. This implies that if you’re storing anything
smaller, like 8 bits, a <b>BitSet</b> will be wasteful; you’re better off
creating your own class, or just an array, to hold your flags if size is an
issue.</span></p>

<p class=MsoNormal><span lang=EN-US>A normal container expands as you add more
elements, and the <b>BitSet</b> does this as well. The following example shows
how the <b>BitSet </b>works:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c09:Bits.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstration of
BitSet.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Bits {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
printBitSet(BitSet b) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;bits: &quot; + b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String bbits = new
String();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int j = 0; j
&lt; b.size() ; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      bbits += (b.get(j)
? &quot;1&quot; : &quot;0&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;bit pattern: &quot; + bbits);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Random rand = new
Random();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Take the LSB of
nextInt():</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    byte bt =
(byte)rand.nextInt();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BitSet bb = new
BitSet();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 7; i
&gt;=0; i--)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(((1 &lt;&lt; i)
&amp;  bt) != 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        bb.set(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        bb.clear(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;byte value: &quot; + bt);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    printBitSet(bb);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    short st =
(short)rand.nextInt();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BitSet bs = new BitSet();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 15; i
&gt;=0; i--)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(((1 &lt;&lt; i)
&amp;  st) != 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        bs.set(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        bs.clear(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;short value: &quot; + st);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    printBitSet(bs);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int it =
rand.nextInt();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BitSet bi = new
BitSet();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 31; i
&gt;=0; i--)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(((1 &lt;&lt; i)
&amp;  it) != 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        bi.set(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        bi.clear(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;int value: &quot; + it);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    printBitSet(bi);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Test bitsets
&gt;= 64 bits:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BitSet b127 = new
BitSet();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b127.set(127);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;set bit 127: &quot; + b127);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BitSet b255 = new
BitSet(65);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b255.set(255);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;set bit 255: &quot; + b255);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BitSet b1023 = new
BitSet(512);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b1023.set(1023);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b1023.set(1024);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;set bit 1023: &quot; + b1023);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The random number generator is used to
create a random <b>byte</b>, <b>short</b>, and <b>int</b>, and each one is
transformed into a corresponding bit pattern in a <b>BitSet</b>. This works
fine because a <b>BitSet</b> is 64 bits, so none of these cause it to increase
in size. Then a <b>BitSet</b> of 512 bits is created. The constructor allocates
storage for twice that number of bits. However, you can still set bit 1024 or
greater.</span></p>

<h2><a name="_Toc481064711"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>To review the containers provided in the
standard Java library:</span></p>

<p class=Numbered><span lang=EN-US>An array associates numerical indices to
objects. It holds objects of a known type so that you don’t have to cast the
result when you’re looking up an object. It can be multidimensional, and it can
hold primitives. However, its size cannot be changed once you create it.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>60.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>A <b>Collection</b> holds single elements, while a <b>Map</b> holds
associated pairs.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>61.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Like an array, a <b>List</b> also associates numerical indices to
objects—you can think of arrays and <b>List</b>s as ordered containers. The <b>List</b>
automatically resizes itself as you add more elements. But a <b>List</b> can
hold only <b>Object reference</b>s, so it won’t hold primitives and you must
always cast the result when you pull an <b>Object </b>reference out of a
container.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>62.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Use an <b>ArrayList</b> if you’re doing a lot of random accesses,
and a <b>LinkedList</b> if you will be doing a lot of insertions and removals
in the middle of the list.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>63.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>The behavior of queues, deques, and stacks is provided via the <b>LinkedList</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>64.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>A <b>Map</b> is a way to associate not numbers, but <i>objects</i>
with other objects. The design of a <b>HashMap</b> is focused on rapid access,
while a <b>TreeMap</b> keeps its keys in sorted order, and thus is not as fast
as a <b>HashMap</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>65.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>A <b>Set</b> only accepts one of each type of object. <b>HashSet</b>s
provide maximally fast lookups, while <b>TreeSet</b>s keep the elements in
sorted order.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>66.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>There’s no need to use the legacy classes <b>Vector</b>, <b>Hashtable</b>
and <b>Stack</b> in new code.</span></p>

<p class=MsoNormal><span lang=EN-US>The containers are tools that you can use
on a day-to-day basis to make your programs simpler, more powerful, and more
effective.</span></p>

<h2><a name="_Toc481064712"></a><a name="_Toc375545360"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an array of <b>double</b> and <b>fill(&nbsp;)</b>
it using <b>RandDoubleGenerator</b>. Print the results.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>118. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a new class called <b>Gerbil</b> with an <b>int
gerbilNumber </b>that’s initialized in the constructor (similar to the <b>Mouse
</b>example in this chapter). Give it a method called <b>hop(&nbsp;)</b> that
prints out which gerbil number this is, and that it’s hopping. Create an <b>ArrayList</b>
and add a bunch of <b>Gerbil</b> objects to the <b>List</b>. Now use the <b>get(&nbsp;)</b>
method to move through the <b>List</b> and call <b>hop(&nbsp;)</b> for each <b>Gerbil</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>119. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 2 so you use an <b>Iterator</b>
to move through the <b>List</b> while calling <b>hop(&nbsp;)</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>120. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Take the <b>Gerbil</b> class in Exercise 2 and
put it into a <b>Map</b> instead, associating the name of the <b>Gerbil</b> as
a <b>String</b> (the key) for each <b>Gerbil </b>(the value) you put in the
table. Get an <b>Iterator</b> for the <b>keySet(&nbsp;)</b> and use it to move
through the <b>Map</b>, looking up the <b>Gerbil</b> for each key and printing
out the key and telling the <b>gerbil</b> to <b>hop(&nbsp;)</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>121. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a <b>List</b> (try both <b>ArrayList </b>and
<b>LinkedList</b>)<b> </b>and fill it using <b>Collections2.countries</b>. Sort
the list and print it, then apply <b>Collections.shuffle(&nbsp;)</b> to the
list repeatedly, printing it each time so that you can see how the <b>shuffle(&nbsp;)</b>
method randomizes the list differently each time.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>122. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Demonstrate that you can’t add anything but a <b>Mouse</b>
to a <b>MouseList</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>123. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>MouseList.java</b> so that it inherits
from <b>ArrayList</b> instead of using composition. Demonstrate the problem
with this approach.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>124. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Repair <b>CatsAndDogs.java</b> by creating a <b>Cats</b>
container (utilizing <b>ArrayList</b>)<b> </b>that will only accept and
retrieve <b>Cat</b> objects.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>125. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a container that encapsulates an array of
<b>String</b>, and that only adds <b>String</b>s and gets <b>String</b>s, so
that there are no casting issues during use. If the internal array isn’t big
enough for the next add, your container should automatically resize it. In <b>main(&nbsp;)</b>,
compare the performance of your container with an <b>ArrayList</b> holding <b>String</b>s.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>126. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Repeat Exercise 9 for a container of <b>int</b>,
and compare the performance to an <b>ArrayList</b> holding <b>Integer</b>
objects. In your performance comparison, include the process of incrementing
each object in the container.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>127. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Using the utilities in <b>com.bruceeckel.util</b>,
create an array of each primitive type and of <b>String</b>, then fill each array
using an appropriate generator, and print each array using the appropriate <b>print(&nbsp;)</b>
method.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>128. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a generator that produces character names
from your favorite movies (you can use <i>Snow White</i> or <i>Star Wars </i>as
a fallback), and loops around to the beginning when it runs out of names. Use
the utilities in <b>com.bruceeckel.util</b> to fill an array, an <b>ArrayList</b>,
a <b>LinkedList</b> and both types of <b>Set</b>, then print each container.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>129. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class containing two <b>String</b>
objects, and make it <b>Comparable</b> so that the comparison only cares about
the first <b>String</b>. Fill an array and an <b>ArrayList </b>with objects of
your class, using the <b>geography </b>generator. Demonstrate that sorting
works properly. Now make a <b>Comparator</b> that only cares about the second <b>String</b>
and demonstrate that sorting works properly; also perform a binary search using
your <b>Comparator</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>130. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 13 so that an alphabetic sort is
used.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>131. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Use <b>Arrays2.RandStringGenerator</b> to fill a
<b>TreeSet</b> but using alphabetic ordering. Print the <b>TreeSet</b> to
verify the sort order.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>132. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create both an <b>ArrayList</b> and a <b>LinkedList</b>,
and fill each using the <b>Collections2.capitals</b> generator. Print each list
using an ordinary <b>Iterator</b>, then insert one list into the other using a <b>ListIterator</b>,
inserting at every other location. Now perform the insertion starting at the
end of the first list and moving backward.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>133. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a method that uses an <b>Iterator</b> to
step through a <b>Collection</b> and print the <b>hashCode(&nbsp;)</b> of each
object in the container. Fill all the different types of <b>Collection</b>s
with objects and apply your method to each container.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>134. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Repair the problem in <b>InfiniteRecursion.java</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>135. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class, then make an initialized array
of objects of your class. Fill a <b>List</b> from your array. Create a subset
of your <b>List</b> using <b>subList(&nbsp;)</b>, and then remove this subset
from your <b>List</b> using <b>removeAll(&nbsp;)</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><a name=B></a><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>136. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Change Exercise 6 in Chapter 7 to use an <b>ArrayList</b>
to hold the <b>Rodent</b>s and an <b>Iterator</b> to move through the sequence
of <b>Rodent</b>s. Remember that an <b>ArrayList</b> holds only <b>Object</b>s
so you must use a cast when accessing individual <b>Rodent</b>s.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>137. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Following the <b>Queue.java</b> example, create
a <b>Deque</b> class and test it.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>138. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Use a <b>TreeMap</b> in <b>Statistics.java</b>.
Now add code that tests the performance difference between <b>HashMap</b> and <b>TreeMap</b>
in that program.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>139. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Produce a <b>Map</b> and a <b>Set </b>containing
all the countries that begin with ‘A.’</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>140. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Using <b>Collections2.countries</b>, fill a <b>Set</b>
multiple times with the same data and verify that the <b>Set</b> ends up with
only one of each instance. Try this with both kinds of <b>Set</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>141. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Starting with <b>Statistics.java</b>, create a
program that runs the test repeatedly and looks to see if any one number tends
to appear more than the others in the results.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>142. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Rewrite <b>Statistics.java</b> using a <b>HashSet</b>
of <b>Counter</b> objects (you’ll have to modify <b>Counter</b> so that it will
work in the <b>HashSet</b>). Which approach seems better?</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>143. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify the class in Exercise 13 so that it will
work with <b>HashSet</b>s and as a key in <b>HashMap</b>s.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>144. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Using <b>SlowMap.java</b> for inspiration,
create a <b>SlowSet</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>145. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Apply the tests in <b>Map1.java</b> to <b>SlowMap</b>
to verify that it works. Fix anything in <b>SlowMap </b>that doesn’t work
correctly.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>146. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Implement the rest of the <b>Map</b> interface
for <b>SlowMap</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>147. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>MapPerformance.java</b> to include
tests of <b>SlowMap</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>148. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>SlowMap</b> so that instead of two <b>ArrayList</b>s,
it holds a single <b>ArrayList</b> of <b>MPair</b> objects. Verify that the
modified version works correctly. Using <b>MapPerformance.java</b>, test the
speed of your new <b>Map</b>. Now change the <b>put(&nbsp;)</b> method so that
it performs a <b>sort(&nbsp;)</b> after each pair is entered, and modify <b>get(&nbsp;)</b>
to use <b>Collections.binarySearch(&nbsp;)</b> to look up the key. Compare the
performance of the new version with the old ones.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>149. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add a <b>char</b> field to <b>CountedString</b>
that is also initialized in the constructor, and modify the <b>hashCode(&nbsp;)</b>
and <b>equals(&nbsp;)</b> methods to include the value of this <b>char</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>150. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>SimpleHashMap</b> so that it reports
collisions, and test this by adding the same data set twice so that you see
collisions.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>151. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>SimpleHashMap</b> so that it reports
the number of “probes” necessary when collisions occur. That is, how many calls
to <b>next(&nbsp;)</b> must be made on the <b>Iterator</b>s that walk the <b>LinkedList</b>s
looking for matches?</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>152. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Implement the <b>clear(&nbsp;)</b> and <b>remove(&nbsp;)</b>
methods for <b>SimpleHashMap</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>153. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Implement the rest of the <b>Map</b> interface
for <b>SimpleHashMap</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>154. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add a <b>private</b> <b>rehash(&nbsp;)</b>
method to <b>SimpleHashMap</b> that is invoked when the load factor exceeds
0.75. During rehashing, double the number of buckets, then search for the first
prime number greater than that to determine the new number of buckets.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>155. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Following the example in <b>SimpleHashMap.java</b>,
create and test a <b>SimpleHashSet</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>156. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>SimpleHashMap</b> to use <b>ArrayList</b>s
instead of <b>LinkedList</b>s. Modify <b>MapPerformance.java</b> to compare the
performance of the two implementations.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>157. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Using the HTML documentation for the JDK
(downloadable from <i>java.sun.com</i>), look up the <b>HashMap</b> class.
Create a <b>HashMap</b>, fill it with elements, and determine the load factor.
Test the lookup speed with this map, then attempt to increase the speed by
making a new <b>HashMap</b> with a larger initial capacity and copying the old
map into the new one, running your lookup speed test again on the new map.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>158. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In Chapter 8, locate the <b>GreenhouseControls.java</b>
example, which consists of three files. In <b>Controller.java</b>, the class <b>EventSet</b>
is just a container. Change the code to use a <b>LinkedList</b> instead of an <b>EventSet</b>.
This will require more than just replacing <b>EventSet</b> with <b>LinkedList</b>;
you’ll also need to use an <b>Iterator</b> to cycle through the set of events.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>159. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>(Challenging). Write your own hashed map class,
customized for a particular key type: <b>String </b>for this example. Do not
inherit it from <b>Map</b>. Instead, duplicate the methods so that the <b>put(&nbsp;)</b>
and <b>get(&nbsp;)</b> methods specifically take <b>String</b> objects, not <b>Object</b>s,
as keys. Everything that involves keys should not use generic types, but
instead work with <b>String</b>s, to avoid the cost of upcasting and
downcasting. Your goal is to make the fastest possible custom implementation.
Modify <b>MapPerformance.java</b> to test your implementation vs. a <b>HashMap</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>160. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>(Challenging). Find the source code for <b>List</b>
in the Java source code library that comes with all Java distributions. Copy
this code and make a special version called <b>intList</b> that holds only <b>int</b>s.
Consider what it would take to make a special version of <b>List</b> for all
the primitive types. Now consider what happens if you want to make a linked
list class that works with all the primitive types. If parameterized types are
ever implemented in Java, they will provide a way to do this work for you
automatically (as well as many other benefits).</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection16>

<h1><a name="_Toc375545361"></a><a name="Chapter_9"></a><a name="_Toc481064713"></a><a
name="_Toc477690730"><span lang=EN-US>10: Error Handling <br>
with Exceptions</span></a></h1>

<p class=Intro><a name="OLE_LINK1"><span lang=EN-US>The basic philosophy of
Java is that “badly formed code will not be run.”</span></a></p>

<p class=MsoNormal><span lang=EN-US>The ideal time to catch an </span><span lang=EN-US>error is at compile-time, before you even try to run the program.
However, not all errors can be detected at compile-time. The rest of the
problems must be handled at run-time, through some formality that allows the
originator of the error to pass appropriate information to a recipient who will
know how to handle the difficulty properly.</span></p>

<p class=MsoNormal><span lang=EN-US>In C and other earlier languages, there
could be several of these formalities, and they were generally established by
convention and not as part of the programming language. Typically, you returned
a special value or set a flag, and the recipient was supposed to look at the
value or the flag and determine that something was amiss. However, as the years
passed, it was discovered that programmers who use a library tend to think of
themselves as invincible—as in, “Yes, errors might happen to others, but not in
<i>my</i> code.” So, not too surprisingly, they wouldn’t check for the error conditions
(and sometimes the error conditions were too silly to check for</span><a
href="#_ftn51" name="_ftnref51" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[51]</span></span></span></span></a><span
lang=EN-US>). If you <i>were</i> thorough enough to check for an error every
time you called a method, your code could turn into an unreadable nightmare.
Because programmers could still coax systems out of these languages they were
resistant to admitting the truth: This approach to handling errors was a major
limitation to creating large, robust, maintainable programs.</span></p>

<p class=MsoNormal><span lang=EN-US>The solution is to take the casual nature
out of error handling and to enforce formality. This actually has a long
history, since implementations of <i>exception handling</i> go back to
operating systems in the 1960s, and even to BASIC’s “<b>on error goto</b>.” But
C++ exception handling was based on Ada, and Java’s is based primarily on C++
(although it looks even more like Object Pascal).</span></p>

<p class=MsoNormal><span lang=EN-US>The word “exception” is meant in the sense
of “I take exception to that.” At the point where the problem occurs you might
not know what to do with it, but you do know that you can’t just continue on
merrily; you must stop and somebody, somewhere, must figure out what to do. But
you don’t have enough information in the current context to fix the problem. So
you hand the problem out to a higher context where someone is qualified to make
the proper decision (much like a chain of command).</span></p>

<p class=MsoNormal><span lang=EN-US>The other rather significant benefit of
exceptions is that they clean up error handling code. Instead of checking for a
particular error and dealing with it at multiple places in your program, you no
longer need to check at the point of the method call (since the exception will
guarantee that someone catches it). And, you need to handle the problem in only
one place, the so-called </span><span
lang=EN-US><i>exception handler</i>. This saves you code, and it separates the
code that describes what you want to do from the code that is executed when
things go awry. In general, reading, writing, and debugging code becomes much
clearer with exceptions than when using the old way of error handling.</span></p>

<p class=MsoNormal><span lang=EN-US>Because exception handling is enforced by
the Java compiler, there are only so many examples that can be written in this
book without learning about exception handling. This chapter introduces you to
the code you need to write to properly handle exceptions, and the way you can
generate your own exceptions if one of your methods gets into trouble.</span></p>

<h2><a name="_Toc481064714"></a><a name="_Toc375545362"><span lang=EN-US>Basic
exceptions</span></a></h2>

<p class=MsoNormal><span lang=EN-US>An </span><span
lang=EN-US><i>exceptional condition</i> is a problem that prevents the
continuation of the method or scope that you’re in. It’s important to
distinguish an exceptional condition from a normal problem, in which you have
enough information in the current context to somehow cope with the difficulty.
With an exceptional condition, you cannot continue processing because you don’t
have the information necessary to deal with the problem <i>in the current
context</i>. All you can do is jump out of the current context and relegate
that problem to a higher context. This is what happens when you throw an
exception.</span></p>

<p class=MsoNormal><span lang=EN-US>A simple example is a divide. If you’re
about to divide by zero, it’s worth checking to make sure you don’t go ahead
and perform the divide. But what does it mean that the denominator is zero?
Maybe you know, in the context of the problem you’re trying to solve in that
particular method, how to deal with a zero denominator. But if it’s an unexpected
value, you can’t deal with it and so must throw an exception rather than
continuing along that path.</span></p>

<p class=MsoNormal><span lang=EN-US>When you throw an </span><span
lang=EN-US>exception, several things happen. First, the exception object is
created in the same way that any Java object is created: on the heap, with <b>new</b>.
Then the current path of execution (the one you couldn’t continue) is stopped
and the reference for the exception object is ejected from the current context.
At this point the exception handling mechanism takes over and begins to look
for an appropriate place to continue executing the program. This appropriate
place is the <i>exception handler,</i> whose job is to recover from the problem
so the program can either try another tack or just continue.</span></p>

<p class=MsoNormal><span lang=EN-US>As a simple example of throwing an
exception, consider an object reference called <b>t</b>. It’s possible that you
might be passed a reference that hasn’t been initialized, so you might want to
check before trying to call a method using that object reference. You can send
information about the error into a larger context by creating an object
representing your information and “throwing” it out of your current context.
This is called <i>throwing an exception.</i> Here’s what it looks like:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>if(t == null)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  throw new
NullPointerException();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This throws the exception, which allows
you—in the current context—to abdicate responsibility for thinking about the
issue further. It’s just magically handled somewhere else. Precisely <i>where </i>will
be shown shortly.</span></p>

<h3><a name="_Toc481064715"></a><a name="_Toc375545363"><span lang=EN-US>Exception
arguments</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>Like any object in Java, you always create exceptions on the heap
using <b>new</b>, which allocates storage and calls a constructor. There are
two constructors in all standard exceptions: the first is the default
constructor, and the second takes a string argument so you can place pertinent
information in the exception:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>if(t == null)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  throw new
NullPointerException(&quot;t = null&quot;);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This string can later be extracted using
various methods, as will be shown shortly.</span></p>

<p class=MsoNormal><span lang=EN-US>The </span><span
lang=EN-US>keyword <b>throw</b> causes a number of relatively magical things to
happen. Typically, you’ll first use <b>new</b> to create<b> </b>an object that
represents the error condition. You give the resulting reference to <b>throw</b>.
The object is, in effect, “returned” from the method, even though that object
type isn’t normally what the method is designed to return. A simplistic way to
think about exception handling is as an alternate return mechanism, although
you get into trouble if you take that analogy too far. You can also exit from
ordinary scopes by throwing an exception. But a value is returned, and the
method or scope exits.</span></p>

<p class=MsoNormal><span lang=EN-US>Any similarity to an ordinary return from a
method ends here, because <i>where</i> you return is someplace completely
different from where you return for a normal method call. (You end up in an
appropriate exception handler that might be miles away—many levels lower on the
call stack—from where the exception was thrown.)</span></p>

<p class=MsoNormal><span lang=EN-US>In addition, you can throw any type of <b>Throwable</b>
object that you want. Typically, you’ll throw a different class of exception
for each different type of error. The information about the error is
represented both inside the exception object and implicitly in the type of
exception object chosen, so someone in the bigger context can figure out what
to do with your exception. (Often, the only information is the type of
exception object, and nothing meaningful is stored within the exception
object.)</span></p>

<h2><a name="_Toc481064716"></a><a name="_Toc375545364"></a><a
name="_Toc312374113"></a><a name="_Toc305628770"></a><a name="_Toc305593298"><span
lang=EN-US>Catching an exception</span></a></h2>

<p class=MsoNormal><span lang=EN-US>If a method throws an exception, it must assume that exception is
“caught” and dealt with. One of the advantages of Java exception handling is
that it allows you to concentrate on the problem you’re trying to solve in one
place, and then deal with the errors from that code in another place.</span></p>

<p class=MsoNormal><span lang=EN-US>To see how an exception is caught, you must
first understand the concept of a </span><span lang=EN-US><i>guarded region,</i> which is a section of code that might produce
exceptions, and which is followed by the code to handle those exceptions.</span></p>

<h3><a name="_Toc481064717"></a><a name="_Toc375545365"></a><a
name="_Toc312374114"><span lang=EN-US>The <b>try</b> block</span></a></h3>

<p class=MsoNormal><span lang=EN-US>If you’re inside a method and you throw an
exception (or another method you call within this method throws an exception),
that method will exit in the process of throwing. If you don’t want a <b>throw </b>to
exit the method, you can set up a special block within that method to capture
the exception. This is called the <i>try</i> <i>block</i></span><span lang=EN-US> because you “try” your various method calls there. The try block is
an ordinary scope, preceded by the keyword <b>try</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Code that might
generate exceptions</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you were checking for errors carefully
in a programming language that didn’t support exception handling, you’d have to
surround every method call with setup and error testing code, even if you call
the same method several times. With exception handling, you put everything in a
try block and capture all the exceptions in one place. This means your code is
a lot easier to write and easier to read because the goal of the code is not
confused with the error checking.</span></p>

<h3><a name="_Toc481064718"></a><a name="_Toc375545366"></a><a
name="_Toc312374115"><span lang=EN-US>Exception handlers</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Of course, the thrown exception must end up
someplace. This “place” is the <i>exception handler</i></span><i><span lang=EN-US>,</span></i><span lang=EN-US> and there’s one for every exception
type you want to catch. Exception handlers immediately follow the try block and
are denoted by the keyword <b>catch</b></span><span
lang=EN-US>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Code that might
generate exceptions</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} catch(Type1 id1) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Handle exceptions
of Type1</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} catch(Type2 id2) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Handle exceptions
of Type2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} catch(Type3 id3) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Handle exceptions
of Type3</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>// etc...</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Each catch clause (exception handler) is
like a little method that takes one and only one argument of a particular type.
The identifier (<b>id1</b>, <b>id2</b>, and so on) can be used inside the
handler, just like a method argument. Sometimes you never use the identifier
because the type of the exception gives you enough information to deal with the
exception, but the identifier must still be there.</span></p>

<p class=MsoNormal><span lang=EN-US>The handlers must appear directly after the
try block. If an exception is thrown, the exception handling mechanism goes
hunting for the first handler with an argument that matches the type of the
exception. Then it enters that catch clause, and the exception is considered
handled. The search for handlers stops once the catch clause is finished. Only
the matching catch clause executes; it’s not like a <b>switch</b> statement in
which you need a <b>break</b> after each <b>case</b> to prevent the remaining
ones from executing.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that, within the try block, a number
of different method calls might generate the same exception, but you need only
one handler.</span></p>

<h4><span lang=EN-US>Termination vs. resumption</span></h4>

<p class=MsoNormal><span
lang=EN-US>There are two basic models in exception handling theory. In <i>termination</i>
(which is what Java and C++ support), you assume the error is so critical that
there’s no way to get back to where the exception occurred. Whoever threw the
exception decided that there was no way to salvage the situation, and they
don’t <i>want</i> to come back.</span></p>

<p class=MsoNormal><span lang=EN-US>The alternative is called <i>resumption</i>.
It means that the exception handler is expected to do something to rectify the
situation, and then the faulting method is retried, presuming success the
second time. If you want resumption, it means you still hope to continue
execution after the exception is handled. In this case, your exception is more
like a method call—which is how you should set up situations in Java in which
you want resumption-like behavior. (That is, don’t throw an exception; call a
method that fixes the problem.) Alternatively, place your <b>try</b> block
inside a <b>while</b> loop that keeps reentering the <b>try</b> block until the
result is satisfactory.</span></p>

<p class=MsoNormal><span lang=EN-US>Historically, programmers using operating
systems that supported resumptive exception handling eventually ended up using
termination-like code and skipping resumption. So although resumption sounds
attractive at first, it isn’t quite so useful in practice. The dominant reason
is probably the </span><span lang=EN-US><i>coupling </i>that results: your
handler must often be aware of where the exception is thrown from and contain
nongeneric code specific to the throwing location. This makes the code
difficult to write and maintain, especially for large systems where the
exception can be generated from many points.</span></p>

<h2><a name="_Toc481064719"></a><a name="_Toc375545373"><span lang=EN-US>Creating
your own exceptions</span></a></h2>

<p class=MsoNormal><span lang=EN-US>You’re not stuck using the existing Java </span><span lang=EN-US>exceptions. This is important because you’ll often need to create
your own exceptions to denote a special error that your library is capable of
creating, but which was not foreseen when the Java exception hierarchy was
created.</span></p>

<p class=MsoNormal><span lang=EN-US>To create your own exception class, you’re
forced to inherit from an existing type of exception, preferably one that is
close in meaning to your new exception (this is often not possible, however).
The most trivial way to create a new type of exception is just to let the
compiler create the default constructor for you, so it requires almost no code
at all:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c10:SimpleExceptionDemo.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Inheriting your own
exceptions.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class SimpleException
extends Exception {} </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
SimpleExceptionDemo {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void f() throws
SimpleException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Throwing
SimpleException from f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throw new
SimpleException ();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    SimpleExceptionDemo
sed = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
SimpleExceptionDemo();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      sed.f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(SimpleException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Caught it!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When the compiler creates the default
constructor, it which automatically (and invisibly) calls the base-class
default constructor. Of course, in this case you don’t get a <b>SimpleException(String)</b>
constructor, but in practice that isn’t used much. As you’ll see, the most
important thing about an exception is the class name, so most of the time an
exception like the one shown above is satisfactory.</span></p>

<p class=MsoNormal><span lang=EN-US>Here, the result is printed to the console </span><span lang=EN-US><i>standard error</i> stream by writing to </span><span
lang=EN-US><b>System.err</b>. This is usually a better place to send error
information than <b>System.out</b>, which may be redirected. If you send output
to <b>System.err</b> it will not be redirected along with <b>System.out</b> so
the user is more likely to notice it.</span></p>

<p class=MsoNormal><span lang=EN-US>Creating an exception class that also has a
constructor that takes a <b>String</b> is also quite simple:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c10:FullConstructors.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Inheriting your own
exceptions.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MyException
extends Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public MyException()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
MyException(String msg) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(msg);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
FullConstructors {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void f()
throws MyException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Throwing MyException
from f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throw new
MyException();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void g()
throws MyException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Throwing
MyException from g()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throw new
MyException(&quot;Originated in g()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(MyException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      g();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(MyException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The added code is small—the addition of two
constructors that define the way <b>MyException</b> is created. In the second
constructor, the base-class constructor with a <b>String</b> argument is
explicitly invoked by using the <b>super</b> keyword.</span></p>

<p class=MsoNormal><span lang=EN-US>The stack trace information is sent to <b>System.err</b>
so that it’s more likely it will be noticed in the event that <b>System.out</b>
has been redirected.</span></p>

<p class=MsoNormal><span lang=EN-US>The output of the program is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:10.0pt'>Throwing
MyException from f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:10.0pt'>MyException</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:10.0pt'>       
at FullConstructors.f(FullConstructors.java:16)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:10.0pt'>       
at FullConstructors.main(FullConstructors.java:24)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:10.0pt'>Throwing
MyException from g()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:10.0pt'>MyException:
Originated in g()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:10.0pt'>       
at FullConstructors.g(FullConstructors.java:20)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US style='font-size:
10.0pt'>        at FullConstructors.main(FullConstructors.java:29)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see the absence of the detail
message in the <b>MyException</b> thrown from <b>f(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The process of creating your own exceptions
can be taken further. You can add extra constructors and members:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c10:ExtraFeatures.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Further embellishment
of exception classes.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MyException2
extends Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public MyException2()
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
MyException2(String msg) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(msg);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
MyException2(String msg, int x) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(msg);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int val() {
return i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ExtraFeatures {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void f()
throws MyException2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Throwing
MyException2 from f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throw new
MyException2();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void g()
throws MyException2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Throwing
MyException2 from g()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throw new
MyException2(&quot;Originated in g()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void h()
throws MyException2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Throwing
MyException2 from h()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throw new
MyException2(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Originated
in h()&quot;, 47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(MyException2
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      g();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(MyException2
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      h();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(MyException2
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.err.println(&quot;e.val()
= &quot; + e.val());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>A data member <b>i</b> has been added,
along with a method that reads that value and an additional constructor that
sets it. The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Throwing MyException2
from f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>MyException2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at ExtraFeatures.f(ExtraFeatures.java:22)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
ExtraFeatures.main(ExtraFeatures.java:34)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Throwing MyException2
from g()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>MyException2: Originated
in g()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
ExtraFeatures.g(ExtraFeatures.java:26)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
ExtraFeatures.main(ExtraFeatures.java:39)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Throwing MyException2
from h()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>MyException2: Originated
in h()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
ExtraFeatures.h(ExtraFeatures.java:30)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
ExtraFeatures.main(ExtraFeatures.java:44)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>e.val() = 47</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Since an exception is just another kind of
object, you can continue this process of embellishing the power of your
exception classes. Keep in mind, however, that all this dressing-up might be
lost on the client programmers using your packages, since they might simply
look for the exception to be thrown and nothing more. (That’s the way most of
the Java library exceptions are used.) </span></p>

<h2><a name="_Toc481064720"></a><a name="_Toc375545367"></a><a
name="_Toc312374116"><span lang=EN-US>The exception specification</span></a></h2>

<p class=MsoNormal><span lang=EN-US>In Java, you’re required to inform the
client programmer, who calls your method, of the exceptions that might be thrown
from your method. This is civilized, because the caller can know exactly what
code to write to catch all potential exceptions. Of course, if source code is
available, the client programmer could hunt through and look for <b>throw</b>
statements, but often a library doesn’t come with sources. To prevent this from
being a problem, Java provides syntax (and <i>forces </i>you to use that
syntax) to allow you to politely tell the client programmer what exceptions
this method throws, so the client programmer can handle them. This is the <i>exception
specification,</i> and it’s part of the method declaration, appearing after the
argument list.</span></p>

<p class=MsoNormal><span lang=EN-US>The exception specification uses an
additional keyword, <b>throws</b>, followed by a list of all the potential
exception types. So your method definition might look like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>void f() throws
TooBig, TooSmall, DivZero { //... </span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you say</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>void f() { // ...</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>it means that no exceptions are thrown from
the method. (<i>Except </i>for the exceptions of type <b>RuntimeException</b>,
which can reasonably be thrown anywhere—this will be described later.)</span></p>

<p class=MsoNormal><span lang=EN-US>You can’t lie about an exception
specification—if your method causes exceptions and doesn’t handle them, the
compiler will detect this and tell you that you must either handle the
exception or indicate with an exception specification that it may be thrown
from your method. By enforcing exception specifications from top to bottom,
Java guarantees that exception correctness can be ensured <i>at compile-time</i></span><a
href="#_ftn52" name="_ftnref52" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[52]</span></span></span></span></a><span
lang=EN-US>.</span></p>

<p class=MsoNormal><span lang=EN-US>There is one place you can lie: you can
claim to throw an exception that you really don’t. The compiler takes your word
for it, and forces the users of your method to treat it as if it really does
throw that exception. This has the beneficial effect of being a placeholder for
that exception, so you can actually start throwing the exception later without
requiring changes to existing code. It’s also important for creating <b>abstract</b>
base classes and <b>interface</b>s whose derived classes or implementations may
need to throw exceptions.</span></p>

<h3><a name="_Toc481064721"></a><a name="_Toc375545368"></a><a
name="_Toc312374118"><span lang=EN-US>Catching any exception</span></a></h3>

<p class=MsoNormal><span lang=EN-US>It is possible to create a handler that catches any type of
exception. You do this by catching the base-class exception type <b>Exception</b>
(there are other types of base exceptions, but <b>Exception</b> is the base
that’s pertinent to virtually all programming activities):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>catch(Exception e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
System.err.println(&quot;Caught an exception&quot;);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This will catch any exception, so if you
use it you’ll want to put it at the <i>end</i> of your list of handlers to
avoid preempting any exception handlers that might otherwise follow it.</span></p>

<p class=MsoNormal><span lang=EN-US>Since the <b>Exception</b> class is the
base of all the exception classes that are important to the programmer, you
don’t get much specific information about the exception, but you can call the
methods that come from <i>its</i> base type </span><span lang=EN-US><b>Throwable</b>:</span></p>

<p class=MsoNormal><b><span lang=EN-US>String getMessage(&nbsp;)<br>
String </span></b><a
href="../../../../My%20Documents/ProgToolsjdk1.3docsapijavalangThrowable.html#getLocalizedMessage()"><b><span
lang=EN-US style='color:windowtext;text-decoration:none'>getLocalizedMessage</span></b></a><b><span
lang=EN-US>(&nbsp;)</span></b><b><span lang=EN-US><br>
</span></b><span lang=EN-US>Gets the detail message, or a message adjusted for
this particular locale.</span></p>

<p class=MsoNormal><b><span lang=EN-US>String toString(&nbsp;)<br>
</span></b><span lang=EN-US>Returns a short description of the Throwable,
including the detail message if there is one.</span></p>

<p class=MsoNormal><b><span lang=EN-US>void </span></b><span
lang=EN-US><b>printStackTrace(&nbsp;) <br>
void printStackTrace(PrintStream)<br>
void </b></span><a
href="../../../../My%20Documents/ProgToolsjdk1.3docsapijavalangThrowable.html#printStackTrace(java.io.PrintWriter)"><b><span
lang=EN-US style='color:windowtext;text-decoration:none'>printStackTrace</span></b></a><b><span
lang=EN-US>(</span></b><a
href="../../../../My%20Documents/ProgToolsjdk1.3docsapijavaioPrintWriter.html"><b><span
lang=EN-US style='color:windowtext;text-decoration:none'>PrintWriter</span></b></a><b><span
lang=EN-US>) <br>
</span></b><span lang=EN-US>Prints the Throwable and the Throwable’s call stack
trace. The call stack shows the sequence of method calls that brought you to
the point at which the exception was thrown. The first version prints to
standard error, the second and third prints to a stream of your choice (in Chapter
11, you’ll understand why there are two types of streams).</span></p>

<p class=MsoNormal><b><span lang=EN-US>Throwable </span></b><a
href="../../../../My%20Documents/ProgToolsjdk1.3docsapijavalangThrowable.html#fillInStackTrace()"><b><span
lang=EN-US style='color:windowtext;text-decoration:none'>fillInStackTrace</span></b></a><b><span
lang=EN-US>(&nbsp;)</span></b><span lang=EN-US><br>
Records information within this <b>Throwable </b>object about the current state
of the stack frames. Useful when an application is rethrowing an error or
exception (more about this shortly).</span></p>

<p class=MsoNormal><span lang=EN-US>In addition, you get some other methods
from <b>Throwable</b>’s base type <b>Object</b> (everybody’s base type). The
one that might come in handy for exceptions is </span><span lang=EN-US><b>getClass(&nbsp;)</b>, which returns an object representing the
class of this object. You can in turn query this <b>Class</b> object for its
name with <b>getName(&nbsp;)</b> or <b>toString(&nbsp;)</b>. You can also do
more sophisticated things with <b>Class</b> objects that aren’t necessary in
exception handling. <b>Class</b> objects will be studied later in this book.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example that shows the use of the
basic <b>Exception</b> methods:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c10:ExceptionMethods.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrating the
Exception Methods.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ExceptionMethods {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw new
Exception(&quot;Here's my Exception&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Exception e)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Caught Exception&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;e.getMessage():
&quot; + e.getMessage());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
&quot;e.getLocalizedMessage(): &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        
e.getLocalizedMessage());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;e.toString(): &quot; + e);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;e.printStackTrace():&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output for this program is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Caught Exception</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>e.getMessage(): Here's
my Exception</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>e.getLocalizedMessage():
Here's my Exception</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>e.toString():
java.lang.Exception: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   Here's my Exception</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>e.printStackTrace():</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>java.lang.Exception:
Here's my Exception</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> at
ExceptionMethods.main(ExceptionMethods.java:7)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>java.lang.Exception: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   Here's my Exception</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US> at
ExceptionMethods.main(ExceptionMethods.java:7)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the methods provide
successively more information—each is effectively a superset of the previous
one.</span></p>

<h3><a name="_Toc481064722"></a><a name="_Toc375545369"></a><a
name="_Toc312374119"><span lang=EN-US>Rethrowing an exception</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>Sometimes you’ll want to rethrow the exception that you just caught,
particularly when you use <b>Exception</b> to catch any exception. Since you
already have the reference to the current exception, you can simply rethrow
that reference:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>catch(Exception e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
System.err.println(&quot;An exception was thrown&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throw e;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Rethrowing an exception causes the
exception to go to the exception handlers in the next-higher context. Any
further <b>catch</b> clauses for the same <b>try</b> block are still ignored.
In addition, everything about the exception object is preserved, so the handler
at the higher context that catches the specific exception type can extract all
the information from that object.</span></p>

<p class=MsoNormal><span lang=EN-US>If you simply rethrow the current
exception, the information that you print about that exception in </span><span lang=EN-US><b>printStackTrace(&nbsp;) </b>will pertain to the exception’s origin,
not the place where you rethrow it. If you want to install new stack trace
information, you can do so by calling </span><span lang=EN-US><b>fillInStackTrace(&nbsp;)</b>, which returns an exception object
that it creates by stuffing the current stack information into the old
exception object. Here’s what it looks like:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c10:Rethrowing.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrating
fillInStackTrace()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Rethrowing
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void f()
throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;originating
the exception in f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throw new
Exception(&quot;thrown from f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void g()
throws Throwable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Exception e)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Inside
g(), e.printStackTrace()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e; // 17</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // throw
e.fillInStackTrace(); // 18</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  main(String[] args)
throws Throwable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      g();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Exception e)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Caught in
main, e.printStackTrace()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The important line numbers are marked as
comments. With line 17 uncommented (as shown), the output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>originating the
exception in f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Inside g(), e.printStackTrace()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>java.lang.Exception:
thrown from f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
Rethrowing.f(Rethrowing.java:8)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
Rethrowing.g(Rethrowing.java:12)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
Rethrowing.main(Rethrowing.java:24)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Caught in main,
e.printStackTrace()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>java.lang.Exception:
thrown from f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
Rethrowing.f(Rethrowing.java:8)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
Rethrowing.g(Rethrowing.java:12)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>        at
Rethrowing.main(Rethrowing.java:24)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>So the exception stack trace always
remembers its true point of origin, no matter how many times it gets rethrown.</span></p>

<p class=MsoNormal><span lang=EN-US>With line 17 commented and line 18
uncommented, <b>fillInStackTrace(&nbsp;)</b> is used instead, and the result
is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>originating the
exception in f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Inside g(),
e.printStackTrace()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>java.lang.Exception:
thrown from f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
Rethrowing.f(Rethrowing.java:8)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at Rethrowing.g(Rethrowing.java:12)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
Rethrowing.main(Rethrowing.java:24)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Caught in main,
e.printStackTrace()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>java.lang.Exception:
thrown from f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
Rethrowing.g(Rethrowing.java:18)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>        at
Rethrowing.main(Rethrowing.java:24)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Because of <b>fillInStackTrace(&nbsp;)</b>,
line 18 becomes the new </span><span
lang=EN-US>point of origin of the exception.</span></p>

<p class=MsoNormal><span lang=EN-US>The class <b>Throwable</b> must appear in
the exception specification for <b>g(&nbsp;)</b> and <b>main(&nbsp;)</b>
because <b>fillInStackTrace(&nbsp;)</b> produces a reference to a <b>Throwable</b>
object. Since </span><span lang=EN-US><b>Throwable</b> is a base class of <b>Exception</b>,
it’s possible to get an object that’s a <b>Throwable</b> but <i>not</i> an <b>Exception</b>,
so the handler for <b>Exception</b> in <b>main(&nbsp;) </b>might miss it. To
make sure everything is in order, the compiler forces an exception
specification for <b>Throwable</b>. For example, the exception in the following
program is <i>not</i> caught in <b>main(&nbsp;)</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c10:ThrowOut.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ThrowOut {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  main(String[] args)
throws Throwable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw new
Throwable(); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Exception e)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Caught in main()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It’s also possible to rethrow a different
exception from the one you caught. If you do this, you get a similar effect as
when you use <b>fillInStackTrace(&nbsp;)</b>—the information about the original
site of the exception is lost, and what you’re left with is the information
pertaining to the new <b>throw</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c10:RethrowNew.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Rethrow a different
object </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// from the one that was
caught.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class OneException
extends Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
OneException(String s) { super(s); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class TwoException
extends Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
TwoException(String s) { super(s); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class RethrowNew
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void f()
throws OneException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;originating
the exception in f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throw new
OneException(&quot;thrown from f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws TwoException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(OneException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Caught in
main, e.printStackTrace()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw new
TwoException(&quot;from main()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>originating the
exception in f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Caught in main,
e.printStackTrace()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>OneException: thrown
from f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
RethrowNew.f(RethrowNew.java:17)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
RethrowNew.main(RethrowNew.java:22)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Exception in thread
&quot;main&quot; TwoException: from main()</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>        at
RethrowNew.main(RethrowNew.java:27)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The final exception knows only that it came
from <b>main(&nbsp;)</b>, and not from <b>f(&nbsp;)</b>. </span></p>

<p class=MsoNormal><span lang=EN-US>You never have to worry about cleaning up
the previous exception, or any exceptions for that matter. They’re all
heap-based objects created with <b>new</b>, so the garbage collector
automatically cleans them all up.</span></p>

<h2><a name="_Toc481064723"></a><a name="_Toc375545370"><span lang=EN-US>Standard
Java exceptions</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The Java class <b>Throwable</b> describes
anything that can be thrown as an exception. There are two general types of <b>Throwable</b>
objects (“types of” = “inherited from”). </span><span
lang=EN-US><b>Error</b> represents compile-time and system errors that you
don’t worry about catching (except in special cases). </span><span
lang=EN-US><b>Exception</b> is the basic type that can be thrown from any of
the standard Java library class methods and from your methods and run-time
accidents. So the Java programmer’s base type of interest is <b>Exception</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The best way to get an overview of the
exceptions is to browse the HTML Java documentation that you can download from <i>java.sun.com.</i>
It’s worth doing this once just to get a feel for the various exceptions, but
you’ll soon see that there isn’t anything special between one exception and the
next except for the name. Also, the number of exceptions in Java keeps
expanding; basically it’s pointless to print them in a book. Any new library
you get from a third-party vendor will probably have its own exceptions as
well. The important thing to understand is the concept and what you should do
with the exceptions.</span></p>

<p class=MsoNormal><span lang=EN-US>The basic idea is that the name of the
exception represents the problem that occurred, and the exception name is intended
to be relatively self-explanatory. The exceptions are not all defined in <b>java.lang</b>;
some are created to support other libraries such as <b>util</b>, <b>net,</b>
and <b>io</b>, which you can see from their full class names or what they are
inherited from. For example, all I/O exceptions are inherited from <b>java.io.IOException</b>.</span></p>

<h3><a name="_Toc481064724"></a><a name="_Toc375545372"><span lang=EN-US>The
special case of <b>RuntimeException</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>The first example in this chapter was</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>if(t == null)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  throw new
NullPointerException();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It can be a bit horrifying to think that
you must check for <b>null</b> on every reference that is passed into a method
(since you can’t know if the caller has passed you a valid reference).
Fortunately, you don’t—this is part of the standard run-time checking that Java
performs for you, and if any call is made to a <b>null</b> reference, Java will
automatically throw a </span><span lang=EN-US><b>NullPointerException</b>. So the above bit of code is always
superfluous. </span></p>

<p class=MsoNormal><span lang=EN-US>There’s a whole group of exception types
that are in this category. They’re always thrown automatically by Java and you
don’t need to include them in your exception specifications. Conveniently
enough, they’re all grouped together by putting them under a single base class
called <b>RuntimeException</b>, which is a perfect example of inheritance: it
establishes a family of types that have some characteristics and behaviors in
common. Also, you never need to write an exception specification saying that a
method might throw a <b>RuntimeException</b>, since that’s just assumed.
Because they indicate bugs, you virtually never catch a </span><span lang=EN-US><b>RuntimeException</b>—it’s dealt with automatically. If you were
forced to check for <b>RuntimeException</b>s your code could get messy. Even
though you don’t typically catch <b>RuntimeExceptions</b>,<b> </b>in your own
packages you might choose to throw some of the <b>RuntimeException</b>s. </span></p>

<p class=MsoNormal><span lang=EN-US>What happens when you don’t catch such
exceptions? Since the compiler doesn’t enforce exception specifications for
these, it’s quite plausible that a <b>RuntimeException</b> could percolate all
the way out to your <b>main(&nbsp;) </b>method without being caught. To see
what happens in this case, try the following example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c10:NeverCaught.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Ignoring
RuntimeExceptions.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class NeverCaught
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void f() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throw new
RuntimeException(&quot;From f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void g() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can already see that a <b>RuntimeException
</b>(or anything inherited from it) is a special case, since the compiler
doesn’t require an exception specification for these types.</span></p>

<p class=MsoNormal><span lang=EN-US>The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Exception in thread
&quot;main&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>java.lang.RuntimeException:
From f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
NeverCaught.f(NeverCaught.java:9)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        at
NeverCaught.g(NeverCaught.java:12)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>        at
NeverCaught.main(NeverCaught.java:15)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>So the answer is: If a <b>RuntimeException</b>
gets all the way out to <b>main(&nbsp;)</b> without being caught, <b>printStackTrace(&nbsp;)</b>
is called for that exception as the program exits.</span></p>

<p class=MsoNormal><span lang=EN-US>Keep in mind that you can only ignore <b>RuntimeException</b>s
in your coding, since all other handling is carefully enforced by the compiler.
The reasoning is that a <b>RuntimeException</b> represents a programming error:</span></p>

<p class=Numbered><span lang=EN-US>An error you cannot catch (receiving a <b>null</b>
reference handed to your method by a client programmer, for example) .</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>67.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>An error that you, as a programmer, should have checked for in your
code (such as <b>ArrayIndexOutOfBoundsException</b> where you should have paid
attention to the size of the array). </span></p>

<p class=MsoNormal><span lang=EN-US>You can see what a tremendous benefit it is
to have exceptions in this case, since they help in the debugging process.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s interesting to notice that you cannot
classify Java exception handling as a single-purpose tool. Yes, it is designed
to handle those pesky run-time errors that will occur because of forces outside
your code’s control, but it’s also essential for certain types of programming
bugs that the compiler cannot detect.</span></p>

<h2><a name="_Toc481064725"><span lang=EN-US>Performing cleanup <br>
with finally</span></a></h2>

<p class=MsoNormal><span lang=EN-US>There’s often some piece of code that you
want to execute whether or not an exception is thrown within a <b>try</b>
block. This usually pertains to some operation other than memory recovery
(since that’s taken care of by the garbage collector). To achieve this effect,
you use a </span><span lang=EN-US><b>finally</b> clause</span><a href="#_ftn53"
name="_ftnref53" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[53]</span></span></span></span></a><span
lang=EN-US> at the end of all the exception handlers. The full picture of an
exception handling section is thus:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><b><span lang=EN-US>try</span></b><span
lang=EN-US> {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // The guarded region:
Dangerous activities</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // that might throw A,
B, or C </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} <b>catch</b>(A a1) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Handler for
situation A</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} <b>catch</b>(B b1) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Handler for
situation B</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} <b>catch</b>(C c1) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Handler for
situation C</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} <b>finally</b> {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Activities that
happen every time</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>To demonstrate that the <b>finally</b>
clause always runs, try this program:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c10:FinallyWorks.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The finally clause is
always executed.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class ThreeException
extends Exception {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
FinallyWorks {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int count = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        //
Post-increment is zero first time:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(count++ == 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          throw new
ThreeException();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        System.out.println(&quot;No
exception&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(ThreeException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;ThreeException&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;In finally clause&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(count == 2)
break; // out of &quot;while&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This program also gives a hint for how you
can deal with the fact that exceptions in Java (like exceptions in C++) do not
allow you to resume back to where the exception was thrown, as discussed
earlier. If you place your <b>try</b> block in a loop, you can establish a condition
that must be met before you continue the program. You can also add a <b>static</b>
counter or some other device to allow the loop to try several different
approaches before giving up. This way you can build a greater level of
robustness into your programs.</span></p>

<p class=MsoNormal><span lang=EN-US>The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>ThreeException</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>In finally clause</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>No exception</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>In finally clause</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Whether an exception is thrown or not, the <b>finally</b>
clause is always executed.</span></p>

<h3><a name="_Toc481064726"></a><a name="_Toc375545375"><span lang=EN-US>What’s
<b>finally</b> for?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>In a language without garbage collection <i>and</i>
without automatic </span><span lang=EN-US>destructor calls</span><a
href="#_ftn54" name="_ftnref54" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[54]</span></span></span></span></a><span
lang=EN-US>, <b>finally</b> is important because it allows the programmer to
guarantee the release of memory regardless of what happens in the </span><span lang=EN-US><b>try</b> block. But Java has garbage collection, so releasing
memory is virtually never a problem. Also, it has no destructors to call. So
when do you need to use </span><span
lang=EN-US><b>finally</b> in Java?</span></p>

<p class=MsoNormal><b><span lang=EN-US>finally</span></b><span lang=EN-US> is
necessary when you need to set something <i>other</i> than memory back to its
original state. This is some kind of cleanup like an open file or network
connection, something you’ve drawn on the screen, or even a switch in the
outside world, as modeled in the following example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c10:OnOffSwitch.java
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Why use finally?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Switch {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean state = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean read() {
return state; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void on() { state =
true; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void off() { state =
false; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class OnOffException1
extends Exception {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class OnOffException2
extends Exception {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class OnOffSwitch
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Switch sw = new
Switch();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void f() throws
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    OnOffException1,
OnOffException2 {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      sw.on();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Code that can
throw exceptions...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      sw.off();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(OnOffException1 e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;OnOffException1&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      sw.off();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(OnOffException2 e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;OnOffException2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      sw.off();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The goal here is to make sure that the
switch is off when <b>main(&nbsp;)</b> is completed, so <b>sw.off(&nbsp;)</b>
is placed at the end of the try block and at the end of each exception handler.
But it’s possible that an exception could be thrown that isn’t caught here, so <b>sw.off(&nbsp;)
</b>would be missed. However, with <b>finally</b> you can place the cleanup
code from a try block in just one place:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c10:WithFinally.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Finally Guarantees
cleanup.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class WithFinally
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Switch sw = new
Switch();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      sw.on();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Code that can
throw exceptions...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      OnOffSwitch.f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(OnOffException1
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;OnOffException1&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(OnOffException2 e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;OnOffException2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      sw.off();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Here the <b>sw.off(&nbsp;)</b> has been
moved to just one place, where it’s guaranteed to run no matter what happens.</span></p>

<p class=MsoNormal><span lang=EN-US>Even in cases in which the exception is not
caught in the current set of <b>catch</b> clauses, <b>finally</b> will be
executed before the exception handling mechanism continues its search for a
handler at the next higher level:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c10:AlwaysFinally.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Finally is always
executed.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class FourException
extends Exception {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
AlwaysFinally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Entering
first try block&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Entering
second try block&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        throw new
FourException();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot;finally
in 2nd try block&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(FourException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Caught
FourException in 1st try block&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;finally in
1st try block&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output for this program shows you what
happens:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Entering first try block</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Entering second try
block</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>finally in 2nd try block</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Caught FourException in
1st try block</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>finally in 1st try
block</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>finally</b> statement will also be
executed in situations in which <b>break</b> and <b>continue</b> statements are
involved. Note that, along with the labeled <b>break</b> and labeled <b>continue</b>,
<b>finally</b> eliminates the need for a <b>goto </b>statement in Java.</span></p>

<h3><a name="_Toc481064727"><span lang=EN-US>Pitfall: the lost exception</span></a></h3>

<p class=MsoNormal><span lang=EN-US>In general, Java’s exception implementation
is quite outstanding, but unfortunately there’s a flaw. Although exceptions are
an indication of a crisis in your program and should never be ignored, it’s
possible for an exception to simply be </span><span
lang=EN-US>lost. This happens with a particular configuration using a </span><span lang=EN-US><b>finally</b> clause:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c10:LostMessage.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// How an exception can
be lost.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class
VeryImportantException extends Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return &quot;A very
important exception!&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class HoHumException
extends Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return &quot;A
trivial exception&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class LostMessage
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f() throws
VeryImportantException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throw new
VeryImportantException();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void dispose() throws
HoHumException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throw new
HoHumException();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    LostMessage lm = new
LostMessage();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      lm.f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      lm.dispose();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Exception in thread
&quot;main&quot; A trivial exception</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    at
LostMessage.dispose(LostMessage.java:21)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>    at
LostMessage.main(LostMessage.java:29)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that there’s no evidence of the
<b>VeryImportantException</b>, which is simply replaced by the <b>HoHumException</b>
in the <b>finally</b> clause. This is a rather serious pitfall, since it means
that an exception can be completely lost, and in a far more subtle and
difficult-to-detect fashion than the example above. In contrast, C++ treats the
situation in which a second exception is thrown before the first one is handled
as a dire programming error. Perhaps a future version of Java will repair this
problem (on the other hand, you will typically wrap any method that throws an
exception, such as <b>dispose(&nbsp;)</b>, inside a <b>try-catch</b> clause).</span></p>

<h2><a name="_Toc375545374"></a><a name="_Toc481064728"><span lang=EN-US>Exception
restrictions</span></a></h2>

<p class=MsoNormal><span lang=EN-US>When you override a method, you can throw
only the exceptions that have been specified in the base-class version of the
method. This is a useful restriction, since it means that code that works with
the base class will automatically work with any object derived from the base
class (a fundamental OOP concept, of course), including exceptions.</span></p>

<p class=MsoNormal><span lang=EN-US>This example demonstrates the kinds of
restrictions imposed (at compile-time) for exceptions:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c10:StormyInning.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Overridden methods
may throw only the </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// exceptions specified
in their base-class </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// versions, or
exceptions derived from the </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// base-class
exceptions.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class BaseballException
extends Exception {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Foul extends
BaseballException {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Strike extends
BaseballException {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>abstract class Inning {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Inning() throws BaseballException
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void event () throws
BaseballException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   // Doesn't actually
have to throw anything</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  abstract void atBat()
throws Strike, Foul;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void walk() {} //
Throws nothing</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class StormException
extends Exception {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class RainedOut extends
StormException {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class PopFoul extends
Foul {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface Storm {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void event() throws
RainedOut;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void rainHard() throws
RainedOut;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
StormyInning extends Inning </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    implements Storm {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // OK to add new
exceptions for </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // constructors, but
you must deal </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // with the base
constructor exceptions:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  StormyInning() throws
RainedOut, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BaseballException {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  StormyInning(String s)
throws Foul, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BaseballException {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Regular methods
must conform to base class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//! void walk() throws
PopFoul {} //Compile error</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Interface CANNOT
add exceptions to existing</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // methods from the
base class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//! public void event()
throws RainedOut {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // If the method
doesn't already exist in the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // base class, the
exception is OK:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void rainHard()
throws RainedOut {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // You can choose to
not throw any exceptions,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // even if base
version does:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void event() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Overridden methods
can throw </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // inherited
exceptions:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void atBat() throws
PopFoul {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      StormyInning si =
new StormyInning();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      si.atBat();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(PopFoul e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Pop foul&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(RainedOut e)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Rained out&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(BaseballException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Generic error&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Strike not thrown
in derived version.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // What happens if
you upcast?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Inning i = new
StormyInning();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      i.atBat();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // You must catch
the exceptions from the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // base-class
version of the method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Strike e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Strike&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Foul e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Foul&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(RainedOut e)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Rained out&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(BaseballException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Generic
baseball exception&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>Inning</b>, you can see that both the
constructor and the <b>event(&nbsp;)</b> method say they will throw an
exception, but they never do. This is legal because it allows you to force the
user to catch any exceptions that might be added in overridden versions of <b>event(&nbsp;)</b>.
The same idea holds for <b>abstract</b> methods, as seen in <b>atBat(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>interface Storm</b> is interesting
because it contains one method (<b>event(&nbsp;)</b>) that is defined in <b>Inning</b>,
and one method that isn’t. Both methods throw a new type of exception, <b>RainedOut</b>.
When <b>StormyInning</b> <b>extends Inning</b> and <b>implements Storm</b>,
you’ll see that the <b>event(&nbsp;)</b> method in <b>Storm</b> <i>cannot</i>
change the exception interface of <b>event(&nbsp;)</b> in <b>Inning</b>. Again,
this makes sense because otherwise you’d never know if you were catching the
correct thing when working with the base class. Of course, if a method described
in an <b>interface</b> is not in the base class, such as <b>rainHard(&nbsp;)</b>,<b>
</b>then there’s no problem if it throws exceptions.</span></p>

<p class=MsoNormal><span lang=EN-US>The restriction on exceptions does not
apply to </span><span lang=EN-US>constructors. You can see in <b>StormyInning </b>that
a constructor can throw anything it wants, regardless of what the base-class
constructor throws. However, since a base-class constructor must always be
called one way or another (here, the default constructor is called
automatically), the derived-class constructor must declare any base-class
constructor exceptions in its exception specification. Note that a
derived-class constructor cannot catch exceptions thrown by its base-class
constructor.</span></p>

<p class=MsoNormal><span lang=EN-US>The reason <b>StormyInning.walk(&nbsp;)</b>
will not compile is that it throws an exception, while <b>Inning.walk(&nbsp;)</b>
does not. If this was allowed, then you could write code that called <b>Inning.walk(&nbsp;)</b>
and that didn’t have to handle any exceptions, but then when you substituted an
object of a class derived from <b>Inning</b>, exceptions would be thrown so
your code would break. By forcing the derived-class methods to conform to the
exception specifications of the base-class methods, substitutability of objects
is maintained.</span></p>

<p class=MsoNormal><span lang=EN-US>The overridden <b>event(&nbsp;)</b> method
shows that a derived-class version of a method may choose not to throw any
exceptions, even if the base-class version does. Again, this is fine since it
doesn’t break any code that is written—assuming the base-class version throws
exceptions. Similar logic applies to <b>atBat(&nbsp;)</b>, which throws <b>PopFoul</b>,
an exception that is derived from <b>Foul</b> thrown by the base-class version
of <b>atBat(&nbsp;)</b>. This way, if someone writes code that works with <b>Inning</b>
and calls <b>atBat(&nbsp;)</b>, they must catch the <b>Foul</b> exception.
Since <b>PopFoul</b> is derived from <b>Foul</b>, the exception handler will
also catch <b>PopFoul</b>. </span></p>

<p class=MsoNormal><span lang=EN-US>The last point of interest is in <b>main(&nbsp;)</b>.
Here you can see that if you’re dealing with exactly a <b>StormyInning</b>
object, the compiler forces you to catch only the exceptions that are specific
to that class, but if you upcast to the base type then the compiler (correctly)
forces you to catch the exceptions for the base type. All these constraints
produce much more robust exception-handling code</span><a href="#_ftn55"
name="_ftnref55" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[55]</span></span></span></span></a><span
lang=EN-US>.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s useful to realize that although
exception specifications are enforced by the compiler during inheritance, the
exception specifications are not part of the type of a method, which is
comprised of only the method name and argument types. Therefore, you cannot
overload methods based on exception specifications. In addition, just because
an exception specification exists in a base-class version of a method doesn’t
mean that it must exist in the derived-class version of the method. This is
quite different from inheritance rules, where a method in the base class must
also exist in the derived class. Put another way, the “exception specification
interface” for a particular method may narrow during inheritance and
overriding, but it may not widen—this is precisely the opposite of the rule for
the class interface during inheritance.</span></p>

<h2><a name="_Toc481064729"></a><a name="_Toc375545376"></a><a
name="_Toc312374122"></a><a name="_Toc305628772"></a><a name="_Toc305593300"><span
lang=EN-US>Constructors</span></a></h2>

<p class=MsoNormal><span lang=EN-US>When writing code with exceptions, it’s particularly important that
you always ask, “If an exception occurs, will this be properly cleaned up?”
Most of the time you’re fairly safe, but in constructors there’s a problem. The
constructor puts the object into a safe starting state, but it might perform
some operation—such as opening a file—that doesn’t get cleaned up until the
user is finished with the object and calls a special cleanup method. If you
throw an exception from inside a constructor, these cleanup behaviors might not
occur properly. This means that you must be especially diligent while you write
your constructor.</span></p>

<p class=MsoNormal><span lang=EN-US>Since you’ve just learned about </span><span lang=EN-US><b>finally</b>, you might think that it is the correct solution. But
it’s not quite that simple, because <b>finally </b>performs the cleanup code <i>every
time,</i> even in the situations in which you don’t want the cleanup code
executed until the cleanup method runs. Thus, if you do perform cleanup in <b>finally</b>,
you must set some kind of flag when the constructor finishes normally so that
you don’t do anything in the <b>finally</b> block if the flag is set. Because
this isn’t particularly elegant (you are coupling your code from one place to another),
it’s best if you try to avoid performing this kind of cleanup in <b>finally</b>
unless you are forced to.</span></p>

<p class=MsoNormal><span lang=EN-US>In the following example, a class called <b>InputFile</b>
is created that opens a file and allows you to read it one line (converted into
a <b>String</b>) at a time. It uses the classes </span><span lang=EN-US><b>FileReader</b> and </span><span lang=EN-US><b>BufferedReader</b> from the Java standard I/O library that will be
discussed in Chapter 11, but which are simple enough that you probably won’t
have any trouble understanding their basic use:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c10:Cleanup.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Paying attention to
exceptions</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// in constructors.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class InputFile {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private BufferedReader
in;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  InputFile(String
fname) throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      in = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
FileReader(fname));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Other code that
might throw exceptions</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(FileNotFoundException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Could not
open &quot; + fname);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Wasn't open, so
don't close it</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Exception e)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // All other
exceptions must close it</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        in.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(IOException e2) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
&quot;in.close() unsuccessful&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e; //
Rethrow</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Don't close it
here!!!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String getLine() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s = in.readLine();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(IOException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;readLine()
unsuccessful&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s =
&quot;failed&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void cleanup() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      in.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(IOException
e2) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;in.close()
unsuccessful&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Cleanup {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      InputFile in = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
InputFile(&quot;Cleanup.java&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int i = 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while((s =
in.getLine()) != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(&quot;&quot;+ i++ + &quot;: &quot; + s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      in.cleanup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Exception e)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Caught in
main, e.printStackTrace()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The constructor for <b>InputFile</b> takes
a <b>String</b> argument, which is the name of the file you want to open.
Inside a <b>try</b> block, it creates a <b>FileReader</b> using the file name.
A <b>FileReader</b> isn’t particularly useful until you turn around and use it
to create a <b>BufferedReader</b> that you can actually talk to—notice that one
of the benefits of <b>InputFile</b> is that it combines these two actions.</span></p>

<p class=MsoNormal><span lang=EN-US>If the <b>FileReader</b> constructor is
unsuccessful, it throws a </span><span lang=EN-US><b>FileNotFoundException</b>, which must be caught separately because
that’s the one case in which you don’t want to close the file since it wasn’t
successfully opened. Any <i>other</i> catch clauses must close the file because
it <i>was</i> opened by the time those catch clauses are entered. (Of course,
this is trickier if more than one method can throw a <b>FileNotFoundException</b>.
In that case, you might want to break things into several <b>try </b>blocks.)
The <b>close(&nbsp;)</b> method might throw an exception so it is tried and
caught even though it’s within the block of another <b>catch</b> clause—it’s
just another pair of curly braces to the Java compiler. After performing local
operations, the exception is rethrown, which is appropriate because this
constructor failed, and you wouldn’t want the calling method to assume that the
object had been properly created and was valid.</span></p>

<p class=MsoNormal><span lang=EN-US>In this example, which doesn’t use the
aforementioned flagging technique, the <b>finally</b> clause is definitely <i>not</i>
the place to <b>close(&nbsp;)</b> the file, since that would close it every
time the constructor completed. Since we want the file to be open for the
useful lifetime of the <b>InputFile</b> object this would not be appropriate.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>getLine(&nbsp;)</b> method returns a
<b>String</b> containing the next line in the file. It calls </span><span lang=EN-US><b>readLine(&nbsp;),</b> which can throw an exception, but that
exception is caught so <b>getLine(&nbsp;)</b> doesn’t throw any exceptions. One
of the design issues with </span><span
lang=EN-US>exceptions is whether to handle an exception completely at this
level, to handle it partially and pass the same exception (or a different one)
on, or whether to simply pass it on. Passing it on, when appropriate, can
certainly simplify coding. The <b>getLine(&nbsp;)</b> method becomes:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>String getLine() throws
IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  return in.readLine();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>But of course, the caller is now
responsible for handling any <b>IOException</b> that might arise.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>cleanup(&nbsp;)</b> method must be
called by the user when finished using the <b>InputFile</b> object. This will
release the system resources (such as file handles) that are used by the <b>BufferedReader</b>
and/or <b>FileReader</b> objects</span><a href="#_ftn56" name="_ftnref56"
title=""><span class=MsoFootnoteReference><span lang=EN-US style='font-size:
8.0pt'><span class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;
font-family:"Georgia","serif"'>[56]</span></span></span></span></a><span
lang=EN-US>. You don’t want to do this until you’re finished with the <b>InputFile</b>
object, at the point you’re going to let it go. You might think of putting such
functionality into a </span><span lang=EN-US><b>finalize(&nbsp;)</b> method,
but as mentioned in Chapter 4 you can’t always be sure that <b>finalize(&nbsp;)</b>
will be called (even if you <i>can</i> be sure that it will be called, you
don’t know <i>when</i>). This is one of the downsides to Java: all
cleanup—other than memory cleanup—doesn’t happen automatically, so you must
inform the client programmer that they are responsible, and possibly guarantee
that cleanup occurs using <b>finalize(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>Cleanup.java</b> an <b>InputFile</b>
is created to open the same source file that creates the program, the file is
read in a line at a time, and line numbers are added. All exceptions are caught
generically in <b>main(&nbsp;)</b>, although you could choose greater
granularity.</span></p>

<p class=MsoNormal><span lang=EN-US>One of the benefits of this example is to
show you why exceptions are introduced at this point in the book—you can’t do
basic I/O without using exceptions. Exceptions are so integral to programming
in Java, especially because the compiler enforces them, that you can accomplish
only so much without knowing how to work with them.</span></p>

<h2><a name="_Toc481064730"></a><a name="_Toc375545377"></a><a
name="_Toc312374124"></a><a name="_Toc305628773"></a><a name="_Toc305593301"><span
lang=EN-US>Exception matching</span></a></h2>

<p class=MsoNormal><span lang=EN-US>When an exception is thrown, the exception
handling system looks through the “nearest” handlers in the order they are
written. When it finds a match, the exception is considered handled, and no
further searching occurs. </span></p>

<p class=MsoNormal><span lang=EN-US>Matching an exception doesn’t require a
perfect match between the exception and its handler. A derived-class object
will match a handler for the base class, as shown in </span><span lang=EN-US>this example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c10:Human.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Catching exception
hierarchies.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Annoyance extends
Exception {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Sneeze extends
Annoyance {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Human {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw new
Sneeze();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Sneeze s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Caught Sneeze&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Annoyance a)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Caught Annoyance&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Sneeze</b> exception will be caught
by the first <b>catch</b> clause that it matches—which is the first one, of
course. However, if you remove the first catch clause, leaving only:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw new
Sneeze();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Annoyance a)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Caught Annoyance&quot;);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>    }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The code will still work because it’s
catching the base class of <b>Sneeze</b>. Put another way, <b>catch(Annoyance
e)</b> will catch an <b>Annoyance</b> <i>or any class derived from it</i>. This
is useful because if you decide to add more  derived exceptions to a method,
then the client programmer’s code will not need changing as long as the client
catches the base class exceptions.</span></p>

<p class=MsoNormal><span lang=EN-US>If you try to “mask” the derived-class
exceptions by putting the base-class catch clause first, like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw new
Sneeze();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Annoyance a)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Caught Annoyance&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Sneeze s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Caught Sneeze&quot;);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>    }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>the compiler will give you an error
message, since it sees that the <b>Sneeze</b> catch-clause can never be
reached.</span></p>

<h3><a name="_Toc481064731"></a><a name="_Toc375545378"></a><a
name="_Toc312374128"><span lang=EN-US>Exception</span></a><span lang=EN-US>
guidelines</span></h3>

<p class=MsoNormal><span
lang=EN-US>Use exceptions to:</span></p>

<p class=Numbered><span lang=EN-US>Fix the problem and call the method that
caused the exception again.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>68.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Patch things up and continue without retrying the method.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>69.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Calculate some alternative result instead of what the method was
supposed to produce.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>70.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Do whatever you can in the current context and rethrow the <i>same</i>
exception to a higher context.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>71.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Do whatever you can in the current context and throw a <i>different</i>
exception to a higher context.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>72.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Terminate the program.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>73.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Simplify. (If your exception scheme makes things more complicated,
then it is painful and annoying to use.)</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>74.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Make your library and program safer. (This is a short-term investment
for debugging, and a long-term investment (for application robustness.)</span></p>

<h2><a name="_Toc481064732"></a><a name="_Toc375545379"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Improved error recovery</span><span lang=EN-US> is one of the most powerful ways that you can increase the
robustness of your code. Error recovery is a fundamental concern for every
program you write, but it’s especially important in Java, where one of the
primary goals is to create program components for others to use. <i>To create a
robust system, each component must be robust.</i></span></p>

<p class=MsoNormal><span lang=EN-US>The goals for exception handling in Java
are to simplify the creation of large, reliable programs using less code than
currently possible, and with more confidence that your application doesn’t have
an unhandled error.</span></p>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>Exceptions are not terribly
difficult to learn, and are one of those features that provide immediate and
significant benefits to your project. Fortunately, Java enforces all aspects of
exceptions so it’s guaranteed that they will be used consistently by both
library designers and client programmers.</span></p>

<h2><a name="_Toc481064733"></a><a name="_Toc375545380"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with a <b>main(&nbsp;)</b> that
throws an object of class <b>Exception</b> inside a <b>try</b> block. Give the
constructor for <b>Exception</b> a <b>String</b> argument. Catch the exception
inside a <b>catch</b> clause and print the <b>String</b> argument. Add a <b>finally</b>
clause and print a message to prove you were there.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>161. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create your own exception class using the <b>extends</b>
keyword. Write a constructor for this class that takes a <b>String</b> argument
and stores it inside the object with a <b>String</b> reference. Write a method
that prints out the stored <b>String</b>. Create a <b>try-catch</b> clause to
exercise your new exception.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>162. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a class with a method that throws an
exception of the type created in Exercise 2. Try compiling it without an exception
specification to see what the compiler says. Add the appropriate exception
specification. Try out your class and its exception inside a try-catch clause.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>163. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Define an object reference and initialize it to <b>null</b>.
Try to call a method through this reference. Now wrap the code in a <b>try-catch</b>
clause to catch the exception.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>164. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class with two methods, <b>f(&nbsp;)</b>
and <b>g(&nbsp;)</b>. In <b>g(&nbsp;)</b>, throw an exception of a new type
that you define. In <b>f(&nbsp;)</b>, call <b>g(&nbsp;)</b>, catch its
exception and, in the <b>catch</b> clause, throw a different exception (of a
second type that you define). Test your code in <b>main(&nbsp;)</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>165. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create three new types of exceptions. Write a
class with a method that throws all three. In <b>main(&nbsp;)</b>, call the
method but only use a single <b>catch</b> clause that will catch all three types
of exceptions.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>166. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write code to generate and catch an <b>ArrayIndexOutOfBoundsException</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>167. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create your own resumption-like behavior using a
<b>while</b> loop that repeats until an exception is no longer thrown.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>168. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a three-level hierarchy of exceptions.
Now create a base-class <b>A </b>with a method that throws an exception at the
base of your hierarchy. Inherit <b>B</b> from <b>A</b> and override the method
so it throws an exception at level two of your hierarchy. Repeat by inheriting
class <b>C</b> from <b>B</b>. In <b>main(&nbsp;)</b>, create a <b>C</b> and
upcast it to <b>A</b>, then call the method.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>169. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Demonstrate that a derived-class constructor
cannot catch exceptions thrown by its base-class constructor.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>170. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Show that <b>OnOffSwitch.java</b> can fail by
throwing a <b>RuntimeException</b> inside the <b>try</b> block.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>171. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Show that <b>WithFinally.java</b> doesn’t fail
by throwing a <b>RuntimeException</b> inside the <b>try</b> block.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>172. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 6 by adding a <b>finally</b>
clause. Verify your <b>finally</b> clause is executed, even if a <b>NullPointerException</b>
is thrown.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>173. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an example where you use a flag to
control whether cleanup code is called, as described in the second paragraph
after the heading “Constructors.”</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>174. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>StormyInning.java</b> by adding an <b>UmpireArgument</b>
exception type, and methods that throw this exception. Test the modified
hierarchy.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>175. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Remove the first catch clause in <b>Human.java</b>
and verify that the code still compiles and runs properly.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>176. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add a second level of exception loss to <b>LostMessage.java</b>
so that the <b>HoHumException</b> is itself replaced by a third exception.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>177. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In Chapter 5, find the two programs called <b>Assert.java</b>
and modify these to throw their own type of exception instead of printing to <b>System.err</b>.
This exception should be an inner class that extends <b>RuntimeException</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>178. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add an appropriate set of exceptions to <b>c08:GreenhouseControls.java</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection17>

<h1><a name="_Toc481064734"></a><a name="_Toc477690731"></a><a
name="_Toc375545381"></a><a name="Chapter_10"></a><span lang=EN-US>11: The Java
<br>
I/O System</span></h1>

<p class=Intro><span lang=EN-US>Creating a good input/output (I/O) system is
one of the more difficult tasks for the language designer.</span></p>

<p class=MsoNormal><span lang=EN-US>This is evidenced by the number of
different approaches. The challenge seems to be in covering all eventualities.
Not only are there different sources and sinks of I/O that you want to
communicate with (files, the console, network connections), but you need to
talk to them in a wide variety of ways (sequential, random-access, buffered,
binary, character, by lines, by words, etc.).</span></p>

<p class=MsoNormal><span lang=EN-US>The Java library designers attacked this
problem by creating lots of classes. In fact, there are so many classes for
Java’s I/O system that it can be intimidating at first (ironically, the Java
I/O design actually prevents an explosion of classes). There was also a
significant change in the I/O </span><span
lang=EN-US>library after Java 1.0, when the original <b>byte</b>-oriented
library was supplemented with <b>char</b>-oriented, Unicode-based I/O classes.
As a result there are a fair number of classes to learn before you understand
enough of Java’s I/O picture that you can use it properly. In addition, it’s
rather important to understand the evolution history of the I/O library, even
if your first reaction is “don’t bother me with history, just show me how to
use it!” The problem is that without the historical perspective you will
rapidly become confused with some of the classes and when you should and
shouldn’t use them.</span></p>

<p class=MsoNormal><span lang=EN-US>This chapter will give you an introduction
to the variety of I/O classes in the standard Java library and how to use them.
</span></p>

<h2><a name="_Toc375545382"></a><a name="_Toc481064735"></a><a
name="_Toc375545390"><span lang=EN-US>The <b>File</b> class</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Before getting into the classes that
actually read and write data to streams, we’ll look a utility provided with the
library to assist you in handling file directory issues.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>File </b>class has a deceiving
name—you might think it refers to a file, but it doesn’t. It can represent
either the <i>name</i> of a particular file or the <i>names</i> of a set of
files in a directory. If it’s a set of files, you can ask for the set with the <b>list(&nbsp;)</b>
method, and this returns an array of <b>String</b>. It makes sense to return an
array rather than one of the flexible container classes because the number of
elements is fixed, and if you want a different directory listing you just
create a different <b>File</b> object. In fact, “FilePath” would have been a
better name for the class. This section shows an example of the use of this
class, including the associated <b>FilenameFilter</b> <b>interface</b>.</span></p>

<h3><a name="_Toc481064736"></a><a name="_Toc375545391"><span lang=EN-US>A
directory lister</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Suppose you’d like to see a directory
listing. The <b>File</b> object can be listed in two ways. If you call <b>list(&nbsp;)</b>
with no arguments, you’ll get the full list that the <b>File</b> object
contains. However, if you want a restricted list—for example, if you want all
of the files with an extension of <b>.java</b>—then you use a “directory
filter,” which is a class that tells how to select the <b>File</b> objects for
display.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s the code for the example. Note that
the result has been effortlessly sorted (alphabetically) using the <b>java.utils.Array.sort(&nbsp;)</b>
method and the <b>AlphabeticComparator</b> defined in Chapter 9:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:DirList.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Displays directory
listing.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class DirList {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    File path = new
File(&quot;.&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] list;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length == 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      list =
path.list();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      list =
path.list(new DirFilter(args[0]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.sort(list,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
AlphabeticComparator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; list.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(list[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class DirFilter
implements FilenameFilter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String afn;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  DirFilter(String afn)
{ this.afn = afn; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean
accept(File dir, String name) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Strip path
information:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String f = new
File(name).getName();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
f.indexOf(afn) != -1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>DirFilter</b> class “implements” the
<b>interface</b> <b>FilenameFilter</b>. It’s useful to see how simple the <b>FilenameFilter</b>
<b>interface</b> is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
FilenameFilter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean accept(File
dir, String name);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It says all that this type of object does
is provide a method called <b>accept(&nbsp;)</b>. The whole reason behind the
creation of this class is to provide the <b>accept(&nbsp;)</b> method to the <b>list(&nbsp;)</b>
method so that <b>list(&nbsp;)</b> can “call back” <b>accept(&nbsp;)</b> to
determine which file names should be included in the list. Thus, this technique
is often referred to as a </span><span lang=EN-US><i>callback</i> or sometimes
a </span><span lang=EN-US><i>functor</i> (that is, <b>DirFilter</b> is a functor
because its only job is to hold a method) or the </span><span lang=EN-US><i>Command</i> <i>Pattern</i>. Because <b>list(&nbsp;)</b> takes a <b>FilenameFilter</b>
object as its argument, it means that you can pass an object of any class that
implements <b>FilenameFilter</b> to choose (even at run-time) how the <b>list(&nbsp;)</b>
method will behave. The purpose of a callback is to provide flexibility in the
behavior of code.</span></p>

<p class=MsoNormal><b><span lang=EN-US>DirFilter</span></b><span lang=EN-US>
shows that just because an <b>interface</b> contains only a set of methods,
you’re not restricted to writing only those methods. (You must at least provide
definitions for all the methods in an interface, however.) In this case, the <b>DirFilter</b>
constructor is also created.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>accept(&nbsp;)</b> method must
accept a <b>File</b> object representing the directory that a particular file
is found in, and a <b>String</b> containing the name of that file. You might
choose to use or ignore either of these arguments, but you will probably at
least use the file name. Remember that the <b>list(&nbsp;)</b> method is calling
<b>accept(&nbsp;)</b> for each of the file names in the directory object to see
which one should be included—this is indicated by the <b>boolean</b> result
returned by <b>accept(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>To make sure the element you’re working
with is only the file name and contains no path information, all you have to do
is take the <b>String</b> object and create a <b>File</b> object out of it,
then call <b>getName(&nbsp;)</b>, which strips away all the path information
(in a platform-independent way). Then <b>accept(&nbsp;)</b> uses the </span><span lang=EN-US><b>String </b>class <b>indexOf(&nbsp;)</b> method to see if the
search string <b>afn</b> appears anywhere in the name of the file. If <b>afn</b>
is found within the string, the return value is the starting index of <b>afn</b>,
but if it’s not found the return value is -1. Keep in mind that this is a
simple string search and does not have “glob” expression wildcard matching—such
as “fo?.b?r*”—which is much more difficult to implement.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>list(&nbsp;)</b> method returns an
array. You can query this array for its length and then move through it
selecting the array elements. This ability to easily pass an array in and out
of a method is a tremendous improvement over the behavior of C and C++.</span></p>

<h4><span lang=EN-US>Anonymous inner classes</span></h4>

<p class=MsoNormal><span lang=EN-US>This example is ideal for rewriting using
an </span><span lang=EN-US>anonymous inner class (described in Chapter 8). As a
first cut, a method <b>filter(&nbsp;) </b>is created that returns a reference
to a <b>FilenameFilter</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:DirList2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Uses anonymous inner
classes.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class DirList2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static
FilenameFilter </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  filter(final String
afn) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Creation of
anonymous inner class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
FilenameFilter() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String fn = afn;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public boolean
accept(File dir, String n) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // Strip path
information:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String f = new
File(n).getName();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        return
f.indexOf(fn) != -1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }; // End of
anonymous inner class</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    File path = new
File(&quot;.&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] list;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length == 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      list =
path.list();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      list =
path.list(filter(args[0]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.sort(list,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
AlphabeticComparator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; list.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.out.println(list[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that the argument to <b>filter(&nbsp;)</b>
must be </span><span lang=EN-US><b>final</b>. This is required by the anonymous
inner class so that it can use an object from outside its scope.</span></p>

<p class=MsoNormal><span lang=EN-US>This design is an improvement because the <b>FilenameFilter</b>
class is now tightly bound to <b>DirList2</b>. However, you can take this
approach one step further and define the anonymous inner class as an argument
to <b>list(&nbsp;)</b>, in which case it’s even smaller:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:DirList3.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Building the anonymous
inner class &quot;in-place.&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class DirList3 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(final String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    File path = new
File(&quot;.&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] list;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length == 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      list =
path.list();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      list =
path.list(new FilenameFilter() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        public boolean </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        accept(File dir,
String n) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          String f = new
File(n).getName();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          return
f.indexOf(args[0]) != -1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Arrays.sort(list,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
AlphabeticComparator());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; list.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(list[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The argument to <b>main(&nbsp;)</b> is now <b>final</b>,
since the anonymous inner class uses <b>args[0]</b> directly.</span></p>

<p class=MsoNormal><span lang=EN-US>This shows you how anonymous inner classes
allow the creation of quick-and-dirty classes to solve problems. Since
everything in Java revolves around classes, this can be a useful coding
technique. One benefit is that it keeps the code that solves a particular
problem isolated together in one spot. On the other hand, it is not always as
easy to read, so you must use it judiciously.</span></p>

<h3><a name="_Toc481064737"></a><a name="_Toc375545392"><span lang=EN-US>Checking
for and creating directories</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The <b>File</b> class is more than just a
representation for an existing file or directory. You can also use a <b>File</b>
object to create a new </span><span lang=EN-US>directory or an entire directory path if it doesn’t exist. You can
also look at the </span><span lang=EN-US>characteristics of files (size, last modification date, read/write),
see whether a <b>File</b> object represents a file or a directory, and delete a
file. This program shows some of the other methods available with the <b>File</b>
class (see the HTML documentation from <i>java.sun.com </i>for the full set):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c11:MakeDirectories.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates the use
of the File class to</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// create directories
and manipulate files.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
MakeDirectories {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private final static
String usage =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;Usage:MakeDirectories path1 ...\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Creates each
path\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;Usage:MakeDirectories -d path1 ...\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Deletes each
path\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;Usage:MakeDirectories -r path1 path2\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Renames from
path1 to path2\n&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static void
usage() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.err.println(usage);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.exit(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static void
fileData(File f) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Absolute
path: &quot; + f.getAbsolutePath() +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;\n Can read:
&quot; + f.canRead() +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;\n Can
write: &quot; + f.canWrite() +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;\n getName:
&quot; + f.getName() +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;\n
getParent: &quot; + f.getParent() +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;\n getPath:
&quot; + f.getPath() +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;\n length:
&quot; + f.length() +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;\n
lastModified: &quot; + f.lastModified());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(f.isFile())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;it's a file&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else
if(f.isDirectory())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;it's a directory&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &lt;
1) usage();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(args[0].equals(&quot;-r&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(args.length !=
3) usage();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      File </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        old = new
File(args[1]),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        rname = new
File(args[2]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
old.renameTo(rname);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fileData(old);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fileData(rname);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return; // Exit
main</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int count = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    boolean del = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(args[0].equals(&quot;-d&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      count++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      del = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for( ; count &lt;
args.length; count++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      File f = new
File(args[count]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(f.exists()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(f + &quot; exists&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(del) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.out.println(&quot;deleting...&quot; + f);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          f.delete();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else { // Doesn't
exist</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(!del) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          f.mkdirs();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.out.println(&quot;created &quot; + f);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      fileData(f);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>fileData(&nbsp;)</b> you can see
various file investigation methods used to display information about the file
or directory path.</span></p>

<p class=MsoNormal><span lang=EN-US>The first method that’s exercised by <b>main(&nbsp;)</b>
is </span><span lang=EN-US><b>renameTo(&nbsp;)</b>, which allows you to rename
(or move) a file to an entirely new path represented by the argument, which is
another <b>File</b> object. This also works with directories of any length.</span></p>

<p class=MsoNormal><span lang=EN-US>If you experiment with the above program,
you’ll find that you can make a directory path of any complexity because </span><span lang=EN-US><b>mkdirs(&nbsp;)</b> will do all the work for you.</span></p>

<h2><a name="_Toc481064738"><span lang=EN-US>Input and output</span></a></h2>

<p class=MsoNormal><span lang=EN-US>I/O libraries often use the abstraction of
a <i>stream</i>, which represents any data source or sink as an object capable
of producing or receiving pieces of data. The stream hides the details of what
happens to the data inside the actual I/O device.</span></p>

<p class=MsoNormal><span lang=EN-US>The Java library classes for I/O are
divided by input and output, as you can see by looking at the online Java class
hierarchy with your Web browser. By inheritance, everything derived from the <b>InputStream</b>
or <b>Reader </b>classes have basic methods called <b>read(&nbsp;) </b>for
reading a single byte or array of bytes. Likewise, everything derived from <b>OutputStream
</b>or <b>Writer </b>classes have basic methods called <b>write(&nbsp;) </b>for
writing a single byte or array of bytes. However, you won’t generally use these
methods; they exist so that other classes can use them—these other classes
provide a more useful interface. Thus, you’ll rarely create your stream object
by using a single class, but instead will layer multiple objects together to
provide your desired functionality. The fact that you create more than one
object to create a single resulting stream is the primary reason that Java’s
stream library is confusing.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s helpful to categorize the classes by
their functionality. In Java 1.0, the library designers started by deciding
that all classes that had anything to do with input would be inherited from <b>InputStream</b>
and all classes that were associated with output would be inherited from <b>OutputStream</b>.
</span></p>

<h3><a name="_Toc481064739"></a><a name="_Toc375545383"><span lang=EN-US>Types
of <b>InputStream</b></span></a></h3>

<p class=MsoNormal><b><span lang=EN-US>InputStream</span></b><span lang=EN-US>’s
job is to represent classes that produce input from different sources. These
sources can be: </span></p>

<p class=Numbered><span lang=EN-US>An array of bytes.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>75.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>A <b>String</b> object.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>76.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>A file.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>77.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>A “pipe,” which works like a physical </span><span lang=EN-US>pipe: you put things in one end and they come out the other.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>78.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>A sequence of other streams, so you can collect them together into a
single stream.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>79.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Other sources, such as an Internet connection. (This will be discussed
in a later chapter.)</span></p>

<p class=MsoNormal><span lang=EN-US>Each of these has an associated subclass of
<b>InputStream</b>. In addition, the <b>FilterInputStream</b> is also a type of
<b>InputStream</b>, to provide a base class for &quot;decorator&quot; classes
that attach attributes or useful interfaces to input streams. This is discussed
later.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Table 11-1. Types of InputStream</span></b></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr style='page-break-inside:avoid;height:16.5pt'>
   <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:black 1.5pt;
   border-left:black 1.5pt;border-bottom:windowtext 1.5pt;border-right:black 1.0pt;
   border-style:solid;padding:0cm 0cm 0cm 0cm;height:16.5pt'>
   <p class=Table><span lang=EN-US>Class</span></p>
   </td>
   <td width=144 rowspan=2 valign=top style='width:108.0pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
   padding:0cm 0cm 0cm 0cm;height:16.5pt'>
   <p class=Table><span lang=EN-US>Function</span></p>
   </td>
   <td width=204 valign=top style='width:153.15pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm;height:16.5pt'>
   <p class=Table><span lang=EN-US>Constructor Arguments</span></p>
   </td>
  </tr>
  <tr style='page-break-inside:avoid;height:16.5pt'>
   <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
   none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm;height:16.5pt'>
   <p class=Table><span lang=EN-US>How to use it</span></p>
   </td>
  </tr>
 </thead>
 <tr style='page-break-inside:avoid;height:34.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US>ByteArray-InputStream</span></p>
  </td>
  <td width=144 rowspan=2 valign=top style='width:108.0pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Allows a buffer in
  memory to be used as an </span><span lang=EN-US>InputStream</span></p>
  </td>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>The buffer from
  which to extract the bytes.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:34.5pt'>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>As a source of
  data. Connect it to a </span><span lang=EN-US>FilterInputStream</span><span
  lang=EN-US style='font-weight:normal'> object to provide a useful interface.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:34.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US>StringBuffer-InputStream</span></p>
  </td>
  <td width=144 rowspan=2 valign=top style='width:108.0pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Converts a </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> into an </span><span
  lang=EN-US>InputStream</span></p>
  </td>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>A </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'>. The
  underlying implementation actually uses a </span><span lang=EN-US>StringBuffer</span><span
  lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:34.5pt'>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>As a source of
  data. Connect it to a </span><span lang=EN-US>FilterInputStream</span><span
  lang=EN-US style='font-weight:normal'> object to provide a useful interface.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:34.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US>File-InputStream</span></p>
  </td>
  <td width=144 rowspan=2 valign=top style='width:108.0pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>For reading information
  from a file</span></p>
  </td>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>A </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'>
  representing the file name, or a </span><span lang=EN-US>File</span><span
  lang=EN-US style='font-weight:normal'> or </span><span lang=EN-US>FileDescriptor</span><span
  lang=EN-US style='font-weight:normal'> object.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:34.5pt'>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>As a source of
  data. Connect it to a </span><span lang=EN-US>FilterInputStream</span><span
  lang=EN-US style='font-weight:normal'> object to provide a useful interface.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:40.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:40.5pt'>
  <p class=Table><span lang=EN-US>Piped-InputStream</span></p>
  </td>
  <td width=144 rowspan=2 valign=top style='width:108.0pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:40.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Produces the data
  that’s being written to the associated </span><span lang=EN-US>PipedOutput</span><span
  lang=EN-US style='font-weight:normal'>-</span><span lang=EN-US>Stream</span><span
  lang=EN-US style='font-weight:normal'>. Implements the “piping” concept.</span></p>
  </td>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:40.5pt'>
  <p class=Table><span lang=EN-US>PipedOutputStream</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:40.5pt'>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:40.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>As a source of
  data in multithreading. Connect it to a </span><span lang=EN-US>FilterInputStream</span><span
  lang=EN-US style='font-weight:normal'> object to provide a useful interface.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:34.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US>Sequence-InputStream</span></p>
  </td>
  <td width=144 rowspan=2 valign=top style='width:108.0pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Converts two or
  more </span><span lang=EN-US>InputStream</span><span lang=EN-US
  style='font-weight:normal'> objects into a single </span><span lang=EN-US>InputStream</span><span
  lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Two </span><span
  lang=EN-US>InputStream</span><span lang=EN-US style='font-weight:normal'> objects
  or an </span><span lang=EN-US>Enumeration</span><span lang=EN-US
  style='font-weight:normal'> for a container of </span><span lang=EN-US>InputStream</span><span
  lang=EN-US style='font-weight:normal'> objects.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:34.5pt'>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>As a source of
  data. Connect it to a </span><span lang=EN-US>FilterInputStream</span><span
  lang=EN-US style='font-weight:normal'> object to provide a useful interface.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:46.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US>Filter-InputStream</span></p>
  </td>
  <td width=144 rowspan=2 valign=top style='width:108.0pt;border-top:none;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Abstract class
  which is an interface for decorators that provide useful functionality to the
  other </span><span lang=EN-US>InputStream</span><span lang=EN-US
  style='font-weight:normal'> classes. See Table 11-3.</span></p>
  </td>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>See Table 11-3.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:46.5pt'>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>See Table 11-3.</span></p>
  </td>
 </tr>
</table>

</div>

<h3><a name="_Toc481064740"></a><a name="_Toc375545385"><span lang=EN-US>Types
of <b>OutputStream</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>This category includes the classes that
decide where your output will go: an array of bytes (no <b>String</b>, however;
presumably you can create one using the array of bytes), a file, or a “pipe.”</span></p>

<p class=MsoNormal><span lang=EN-US>In addition, the <b>FilterOutputStream</b>
provides a base class for &quot;decorator&quot; classes that attach attributes
or useful interfaces to output streams. This is discussed later.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Table 11-2. Types of OutputStream</span></b></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr style='page-break-inside:avoid;height:10.5pt'>
   <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:black 1.5pt;
   border-left:black 1.5pt;border-bottom:windowtext 1.5pt;border-right:black 1.0pt;
   border-style:solid;padding:0cm 0cm 0cm 0cm;height:10.5pt'>
   <p class=Table><span lang=EN-US>Class</span></p>
   </td>
   <td width=156 rowspan=2 valign=top style='width:117.0pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.0pt;
   padding:0cm 0cm 0cm 0cm;height:10.5pt'>
   <p class=Table><span lang=EN-US>Function</span></p>
   </td>
   <td width=204 valign=top style='width:153.15pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm;height:10.5pt'>
   <p class=Table><span lang=EN-US>Constructor Arguments</span></p>
   </td>
  </tr>
  <tr style='page-break-inside:avoid;height:10.5pt'>
   <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
   none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm;height:10.5pt'>
   <p class=Table><span lang=EN-US>How to use it</span></p>
   </td>
  </tr>
 </thead>
 <tr style='page-break-inside:avoid;height:46.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US>ByteArray-OutputStream</span></p>
  </td>
  <td width=156 rowspan=2 valign=top style='width:117.0pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Creates a buffer
  in memory. All the data that you send to the stream is placed in this buffer.</span></p>
  </td>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Optional initial
  size of the buffer.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:46.5pt'>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>To designate the
  destination of your data. Connect it to a </span><span lang=EN-US>FilterOutputStream</span><span
  lang=EN-US style='font-weight:normal'> object to provide a useful interface.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:46.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US>File-OutputStream</span></p>
  </td>
  <td width=156 rowspan=2 valign=top style='width:117.0pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>For sending information
  to a file.</span></p>
  </td>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>A String representing
  the file name, or a </span><span lang=EN-US>File</span><span lang=EN-US
  style='font-weight:normal'> or </span><span lang=EN-US>FileDescriptor</span><span
  lang=EN-US style='font-weight:normal'> object.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:46.5pt'>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>To designate the
  destination of your data. Connect it to a </span><span lang=EN-US>FilterOutputStream</span><span
  lang=EN-US style='font-weight:normal'> object to provide a useful interface.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:52.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:52.5pt'>
  <p class=Table><span lang=EN-US>Piped-OutputStream</span></p>
  </td>
  <td width=156 rowspan=2 valign=top style='width:117.0pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:52.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Any information
  you write to this automatically ends up as input for the associated </span><span
  lang=EN-US>PipedInput-Stream</span><span lang=EN-US style='font-weight:normal'>.
  Implements the “piping” concept.</span></p>
  </td>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:52.5pt'>
  <p class=Table><span lang=EN-US>PipedInputStream</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:52.5pt'>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:52.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>To designate the
  destination of your data for multithreading. Connect it to a </span><span
  lang=EN-US>FilterOutputStream</span><span lang=EN-US style='font-weight:normal'>
  object to provide a useful interface.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:34.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US>Filter-OutputStream</span></p>
  </td>
  <td width=156 rowspan=2 valign=top style='width:117.0pt;border-top:none;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Abstract class which
  is an interface for decorators that provide useful functionality to the other
  </span><span lang=EN-US>OutputStream</span><span lang=EN-US style='font-weight:
  normal'> classes. See Table 11-4.</span></p>
  </td>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>See Table 11-4.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:34.5pt'>
  <td width=204 valign=top style='width:153.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>See Table 11-4.</span></p>
  </td>
 </tr>
</table>

</div>

<h2><a name="_Toc481064741"></a><a name="_Toc375545386"><span lang=EN-US>Adding
attributes <br>
and useful interfaces</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The use of layered objects to dynamically
and transparently add responsibilities to individual objects is referred to as
the </span><span lang=EN-US><i>Decorator</i> pattern. (Patterns</span><a
href="#_ftn57" name="_ftnref57" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[57]</span></span></span></span></a><span
lang=EN-US> are the subject of <i>Thinking in Patterns with Java</i>,
downloadable at <i>www.BruceEckel.com</i>.) The decorator pattern specifies
that all objects that wrap around your initial object have the same interface.
This makes the basic use of the decorators transparent—you send the same
message to an object whether it’s been decorated or not. This is the reason for
the existence of the “filter” classes in the Java I/O library: the abstract
“filter” class is the base class for all the decorators. (A decorator must have
the same interface as the object it decorates, but the decorator can also
extend the interface, which occurs in several of the “filter” classes).</span></p>

<p class=MsoNormal><span lang=EN-US>Decorators are often used when simple
subclassing results in a large number of subclasses in order to satisfy every
possible combination that is needed—so many subclasses that it becomes impractical.
The Java I/O library requires many different combinations of features, which is
why the decorator pattern is used. There is a drawback to the decorator
pattern, however. Decorators give you much more flexibility while you’re
writing a program (since you can easily mix and match attributes), but they add
complexity to your code. The reason that the Java I/O library is awkward to use
is that you must create many classes—the “core” I/O type plus all the
decorators—in order to get the single I/O object that you want. </span></p>

<p class=MsoNormal><span lang=EN-US>The classes that provide the decorator
interface to control a particular <b>InputStream</b> or <b>OutputStream</b> are
the <b>FilterInputStream</b> and <b>FilterOutputStream</b>—which don’t have
very intuitive names. <b>FilterInputStream</b> and <b>FilterOutputStream</b>
are abstract classes that are derived from the base classes of the I/O library,
<b>InputStream</b> and <b>OutputStream</b>, which is the key requirement of the
decorator (so that it provides the common interface to all the objects that are
being decorated).</span></p>

<h3><a name="_Toc481064742"></a><a name="_Toc375545387"><span lang=EN-US>Reading
from an <b>InputStream <br>
</b>with<b> FilterInputStream</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>The <b>FilterInputStream</b> classes
accomplish two significantly different things. <b>DataInputStream</b> allows
you to read different types of primitive data as well as <b>String</b> objects.
(All the methods start with “read,” such as <b>readByte(&nbsp;)</b>, <b>readFloat(&nbsp;)</b>,
etc.) This, along with its companion <b>DataOutputStream</b>, allows you to
move primitive data from one place to another via a stream. These “places” are
determined by the classes in Table 11-1. </span></p>

<p class=MsoNormal><span lang=EN-US>The remaining classes modify the way an <b>InputStream</b>
behaves internally: whether it’s buffered or unbuffered, if it keeps track of
the lines it’s reading (allowing you to ask for line numbers or set the line
number), and whether you can push back a single character. The last two classes
look a lot like support for building a compiler (that is, they were added to
support the construction of the Java compiler), so you probably won’t use them
in general programming. </span></p>

<p class=MsoNormal><span lang=EN-US>You’ll probably need to buffer your input
almost every time, regardless of the I/O device you’re connecting to, so it
would have made more sense for the I/O library to make a special case (or
simply a method call) for unbuffered input rather than buffered input.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Table 11-3. Types of FilterInputStream</span></b></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=487
 style='border-collapse:collapse;border:none'>
 <tr style='page-break-inside:avoid;height:16.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.15pt;border:solid black 1.5pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:16.5pt'>
  <p class=Table><span lang=EN-US>Class</span></p>
  </td>
  <td width=180 colspan=2 rowspan=2 valign=top style='width:134.85pt;
  border-top:solid black 1.5pt;border-left:none;border-bottom:solid black 1.5pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:16.5pt'>
  <p class=Table><span lang=EN-US>Function</span></p>
  </td>
  <td width=174 valign=top style='width:130.65pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:16.5pt'>
  <p class=Table><span lang=EN-US>Constructor Arguments</span></p>
  </td>
  <td style='border:none;padding:0cm 0cm 0cm 0cm' width=1><p class='MsoNormal'>&nbsp;</td>
 </tr>
 <tr style='page-break-inside:avoid;height:16.5pt'>
  <td width=174 valign=top style='width:130.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:16.5pt'>
  <p class=Table><span lang=EN-US>How to use it</span></p>
  </td>
  <td style='border:none;padding:0cm 0cm 0cm 0cm' width=1><p class='MsoNormal'>&nbsp;</td>
 </tr>
 <tr style='page-break-inside:avoid;height:46.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.15pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US>Data-InputStream</span></p>
  </td>
  <td width=180 colspan=2 rowspan=2 valign=top style='width:134.85pt;
  border-top:none;border-left:none;border-bottom:solid black 1.0pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Used in concert
  with </span><span lang=EN-US>DataOutputStream</span><span lang=EN-US
  style='font-weight:normal'>, so you can read primitives (</span><span
  lang=EN-US>int</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>char</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>long</span><span lang=EN-US style='font-weight:normal'>, etc.)
  from a stream in a portable fashion.</span></p>
  </td>
  <td width=174 valign=top style='width:130.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US>InputStream</span></p>
  </td>
  <td style='border:none;padding:0cm 0cm 0cm 0cm' width=1><p class='MsoNormal'>&nbsp;</td>
 </tr>
 <tr style='page-break-inside:avoid;height:46.5pt'>
  <td width=174 valign=top style='width:130.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Contains a full
  interface to allow you to read primitive types.</span></p>
  </td>
  <td style='border:none;border-bottom:solid windowtext 1.0pt' width=1><p class='MsoNormal'>&nbsp;</td>
 </tr>
 <tr style='page-break-inside:avoid;height:34.5pt'>
  <td width=133 colspan=2 rowspan=2 valign=top style='width:99.65pt;border-top:
  none;border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US>Buffered-InputStream</span></p>
  </td>
  <td width=179 rowspan=2 valign=top style='width:134.35pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Use this to
  prevent a physical read every time you want more data. You’re saying “Use a
  buffer.”</span></p>
  </td>
  <td width=175 colspan=2 valign=top style='width:131.15pt;border-top:none;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US>InputStream</span><span lang=EN-US
  style='font-weight:normal'>, with optional buffer size.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:34.5pt'>
  <td width=175 colspan=2 valign=top style='width:131.15pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:34.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>This doesn’t
  provide an interface <i>per se</i>, just a requirement that a buffer be used.
  Attach an interface object.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:40.5pt'>
  <td width=133 colspan=2 rowspan=2 valign=top style='width:99.65pt;border-top:
  none;border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:40.5pt'>
  <p class=Table><span lang=EN-US>LineNumber-InputStream</span></p>
  </td>
  <td width=179 rowspan=2 valign=top style='width:134.35pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:40.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Keeps track of
  line numbers in the input stream; you can call </span><span lang=EN-US>getLineNumber(&nbsp;)</span><span
  lang=EN-US style='font-weight:normal'> and </span><span lang=EN-US>setLineNumber(<br>
  int)</span><span lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
  <td width=175 colspan=2 valign=top style='width:131.15pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:40.5pt'>
  <p class=Table><span lang=EN-US>InputStream</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:40.5pt'>
  <td width=175 colspan=2 valign=top style='width:131.15pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:40.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>This just adds
  line numbering, so you’ll probably attach an interface object.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:46.5pt'>
  <td width=133 colspan=2 rowspan=2 valign=top style='width:99.65pt;border-top:
  none;border-left:solid black 1.5pt;border-bottom:solid black 1.5pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US>Pushback-InputStream</span></p>
  </td>
  <td width=179 rowspan=2 valign=top style='width:134.35pt;border-top:none;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Has a one byte
  push-back buffer so that you can push back the last character read.</span></p>
  </td>
  <td width=175 colspan=2 valign=top style='width:131.15pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US>InputStream</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:46.5pt'>
  <td width=175 colspan=2 valign=top style='width:131.15pt;border-top:none;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:46.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Generally used in
  the scanner for a compiler and probably included because the Java compiler
  needed it. You probably won’t use this.</span></p>
  </td>
 </tr>
 <tr height=0>
  <td width=132 style='border:none'></td>
  <td width=1 style='border:none'></td>
  <td width=179 style='border:none'></td>
  <td width=174 style='border:none'></td>
  <td width=1 style='border:none'></td>
 </tr>
</table>

</div>

<h3 style='margin-top:12.0pt'><a name="_Toc481064743"></a><a
name="_Toc375545388"><span lang=EN-US>Writing to an <b>OutputStream<i> <br>
</i></b>with<b> FilterOutputStream</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>The complement to <b>DataInputStream</b> is
<b>DataOutputStream</b>, which formats each of the primitive types and <b>String</b>
objects onto a stream in such a way that any <b>DataInputStream</b>, on any
machine, can read them. All the methods start with “write,” such as <b>writeByte(&nbsp;)</b>,
<b>writeFloat(&nbsp;)</b>, etc.</span></p>

<p class=MsoNormal><span lang=EN-US>The original intent of <b>PrintStream</b>
was to print all of the primitive data types and <b>String</b> objects in a
viewable format. This is different from <b>DataOutputStream</b>, whose goal is
to put data elements on a stream in a way that <b>DataInputStream</b> can
portably reconstruct them. </span></p>

<p class=MsoNormal><span lang=EN-US>The two important methods in <b>PrintStream</b>
are <b>print(&nbsp;)</b> and <b>println(&nbsp;)</b>, which are overloaded to
print all the various types. The difference between <b>print(&nbsp;)</b> and <b>println(&nbsp;)</b>
is that the latter adds a newline when it’s done.</span></p>

<p class=MsoNormal><b><span lang=EN-US>PrintStream</span></b><span lang=EN-US>
can be problematic because it traps all <b>IOException</b>s (You must
explicitly test the error status with <b>checkError(&nbsp;)</b>, which returns <b>true</b>
if an error has occurred). Also, <b>PrintStream</b> doesn’t internationalize
properly and doesn’t handle line breaks in a platform independent way (these
problems are solved with <b>PrintWriter</b>).</span></p>

<p class=MsoNormal><b><span lang=EN-US>BufferedOutputStream</span></b><span
lang=EN-US> is a modifier and tells the stream to use buffering so you don’t
get a physical write every time you write to the stream. You’ll probably always
want to use this with files, and possibly console I/O.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Table 11-4. Types of FilterOutputStream</span></b></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr style='page-break-inside:avoid;height:16.5pt'>
   <td width=132 rowspan=2 valign=top style='width:99.0pt;border:solid black 1.5pt;
   border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:16.5pt'>
   <p class=Table><span lang=EN-US>Class</span></p>
   </td>
   <td width=174 rowspan=2 valign=top style='width:130.65pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
   padding:0cm 0cm 0cm 0cm;height:16.5pt'>
   <p class=Table><span lang=EN-US>Function</span></p>
   </td>
   <td width=162 valign=top style='width:121.5pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm;height:16.5pt'>
   <p class=Table><span lang=EN-US>Constructor Arguments </span></p>
   </td>
  </tr>
  <tr style='page-break-inside:avoid;height:16.5pt'>
   <td width=162 valign=top style='width:121.5pt;border-top:none;border-left:
   none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm;height:16.5pt'>
   <p class=Table><span lang=EN-US>How to use it</span></p>
   </td>
  </tr>
 </thead>
 <tr style='page-break-inside:avoid;height:40.5pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:40.5pt'>
  <p class=Table><span lang=EN-US>Data-OutputStream</span></p>
  </td>
  <td width=174 rowspan=2 valign=top style='width:130.65pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:40.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Used in concert
  with </span><span lang=EN-US>DataInputStream</span><span lang=EN-US
  style='font-weight:normal'> so you can write primitives (int, char, long,
  etc.) to a stream in a portable fashion.</span></p>
  </td>
  <td width=162 valign=top style='width:121.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:40.5pt'>
  <p class=Table><span lang=EN-US>OutputStream</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:40.5pt'>
  <td width=162 valign=top style='width:121.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:40.5pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Contains full interface
  to allow you to write primitive types.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:69.0pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:69.0pt'>
  <p class=Table><span lang=EN-US>PrintStream</span></p>
  </td>
  <td width=174 rowspan=2 valign=top style='width:130.65pt;border-top:none;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:69.0pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>For producing
  formatted output. While </span><span lang=EN-US>DataOutputStream</span><span
  lang=EN-US style='font-weight:normal'> handles the <i>storage</i> of data, </span><span
  lang=EN-US>PrintStream</span><span lang=EN-US style='font-weight:normal'>
  handles <i>display</i>.</span></p>
  </td>
  <td width=162 valign=top style='width:121.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:69.0pt'>
  <p class=Table><span lang=EN-US>OutputStream</span><span lang=EN-US
  style='font-weight:normal'>, with optional </span><span lang=EN-US>boolean</span><span
  lang=EN-US style='font-weight:normal'> indicating that the buffer is flushed
  with every newline.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:69.0pt'>
  <td width=162 valign=top style='width:121.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:69.0pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Should be the “final”
  wrapping for your </span><span lang=EN-US>OutputStream</span><span
  lang=EN-US style='font-weight:normal'> object. You’ll probably use this a
  lot.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:51.0pt'>
  <td width=132 rowspan=2 valign=top style='width:99.0pt;border-top:none;
  border-left:solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:
  solid black 1.0pt;padding:0cm 0cm 0cm 0cm;height:51.0pt'>
  <p class=Table><span lang=EN-US>Buffered-OutputStream</span></p>
  </td>
  <td width=174 rowspan=2 valign=top style='width:130.65pt;border-top:none;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm;height:51.0pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Use this to
  prevent a physical write every time you send a piece of data. You’re saying
  “Use a buffer.” You can call </span><span lang=EN-US>flush(&nbsp;)</span><span
  lang=EN-US style='font-weight:normal'> to flush the buffer.</span></p>
  </td>
  <td width=162 valign=top style='width:121.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:51.0pt'>
  <p class=Table><span lang=EN-US>OutputStream</span><span lang=EN-US
  style='font-weight:normal'>, with optional buffer size.</span></p>
  </td>
 </tr>
 <tr style='page-break-inside:avoid;height:51.0pt'>
  <td width=162 valign=top style='width:121.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm;height:51.0pt'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>This doesn’t provide
  an interface <i>per se</i>, just a requirement that a buffer is used. Attach
  an interface object.</span></p>
  </td>
 </tr>
</table>

</div>

<h2><a name="_Toc375545389"></a><a name="_Toc481064744"><b><span lang=EN-US>Reader</span></b><span
lang=EN-US>s &amp; <b>Writer</b>s</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Java 1.1 made some significant
modifications to the fundamental I/O stream library (Java 2, however, did not
make fundamental modifications). When you see the </span><span lang=EN-US><b>Reader</b> and </span><span
lang=EN-US><b>Writer</b> classes your first thought (like mine) might be that
these were meant to replace the <b>InputStream</b> and <b>OutputStream</b>
classes. But that’s not the case. Although some aspects of the original streams
library are deprecated (if you use them you will receive a warning from the
compiler), the <b>InputStream</b> and <b>OutputStream</b> classes still provide
valuable functionality in the form of <b>byte</b>-oriented I/O, while the <b>Reader
</b>and <b>Writer </b>classes provide Unicode-compliant, character-based I/O.
In addition: </span></p>

<p class=Numbered><span lang=EN-US>Java 1.1 added new classes into the <b>InputStream
</b>and <b>OutputStream </b>hierarchy, so it’s obvious those classes weren’t
being replaced.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>80.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>There are times when you must use classes from the “byte” hierarchy <i>in
combination</i> with classes in the “character” hierarchy. To accomplish this
there are “bridge” classes: <b>InputStreamReader</b> converts an <b>InputStream
</b>to a <b>Reader </b>and <b>OutputStreamWriter</b> converts an <b>OutputStream</b>
to a <b>Writer</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The most important reason for the <b>Reader</b>
and <b>Writer</b> hierarchies is for </span><span lang=EN-US>internationalization. The old I/O stream hierarchy supports only
8-bit byte streams and doesn’t handle the 16-bit Unicode characters well. Since
Unicode is used for internationalization (and Java’s native <b>char </b>is
16-bit </span><span lang=EN-US>Unicode), the <b>Reader</b> and <b>Writer</b>
hierarchies were added to support Unicode in all I/O operations. In addition,
the new libraries are designed for faster operations than the old.</span></p>

<p class=MsoNormal><span lang=EN-US>As is the practice in this book, I will
attempt to provide an overview of the classes, but assume that you will use
online documentation to determine all the details, such as the exhaustive list
of methods.</span></p>

<h3><a name="_Toc481064745"><span lang=EN-US>Sources and sinks of data</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Almost all of the original Java I/O stream
classes have corresponding <b>Reader</b> and <b>Writer</b> classes to provide
native Unicode manipulation. However, there are some places where the <b>byte</b>-oriented
<b>InputStream</b>s and <b>OutputStream</b>s are the correct solution;<b> </b>in
particular, the <b>java.util.zip</b> libraries are <b>byte</b>-oriented rather
than <b>char</b>-oriented. So the most sensible approach to take is to <i>try</i>
to use the <b>Reader</b> and <b>Writer</b> classes whenever you can, and you’ll
discover the situations when you have to use the <b>byte</b>-oriented libraries
because your code won’t compile.</span></p>

<p class=MsoNormal><span lang=EN-US>Here is a table that shows the
correspondence between the sources and sinks of information (that is, where the
data physically comes from or goes to) in the two hierarchies. </span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:1.5pt;border-left:
  1.5pt;border-bottom:1.0pt;border-right:1.0pt;border-color:black;border-style:
  solid;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Sources &amp; Sinks:<br>
  Java 1.0 class</span></p>
  </td>
  <td width=240 valign=top style='width:180.15pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Corresponding Java 1.1 class</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>InputStream</span></p>
  </td>
  <td width=240 valign=top style='width:180.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Reader <br>
  </span><span lang=EN-US style='font-weight:normal'>converter:</span><span
  lang=EN-US> InputStreamReader</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>OutputStream</span></p>
  </td>
  <td width=240 valign=top style='width:180.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Writer <br>
  </span><span lang=EN-US style='font-weight:normal'>converter:</span><span
  lang=EN-US> OutputStreamWriter</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>FileInputStream</span></p>
  </td>
  <td width=240 valign=top style='width:180.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>FileReader</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>FileOutputStream</span></p>
  </td>
  <td width=240 valign=top style='width:180.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>FileWriter</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>StringBufferInputStream</span></p>
  </td>
  <td width=240 valign=top style='width:180.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>StringReader</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>(no corresponding
  class)</span></p>
  </td>
  <td width=240 valign=top style='width:180.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>StringWriter</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>ByteArrayInputStream</span></p>
  </td>
  <td width=240 valign=top style='width:180.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>CharArrayReader</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>ByteArrayOutputStream</span></p>
  </td>
  <td width=240 valign=top style='width:180.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>CharArrayWriter</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>PipedInputStream</span></p>
  </td>
  <td width=240 valign=top style='width:180.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>PipedReader</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>PipedOutputStream</span></p>
  </td>
  <td width=240 valign=top style='width:180.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>PipedWriter</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>In general, you’ll find that the
interfaces for the two different hierarchies are similar if not identical.</span></p>

<h3><a name="_Toc481064746"><span lang=EN-US>Modifying stream behavior</span></a></h3>

<p class=MsoNormal><span lang=EN-US>For <b>InputStream</b>s and <b>OutputStream</b>s,
streams were adapted for particular needs using “decorator” subclasses of <b>FilterInputStream</b>
and <b>FilterOutputStream.</b> The <b>Reader</b> and <b>Writer</b> class
hierarchies continue the use of this idea—but not exactly.</span></p>

<p class=MsoNormal><span lang=EN-US>In the following table, the correspondence
is a rougher approximation than in the previous table. The difference is
because of the class organization: while <b>BufferedOutputStream</b> is a
subclass of <b>FilterOutputStream</b>, <b>BufferedWriter</b> is <i>not</i> a
subclass of <b>FilterWriter</b> (which, even though it is <b>abstract</b>, has
no subclasses and so appears to have been put in either as a placeholder or
simply so you wouldn’t wonder where it was). However, the interfaces to the
classes are quite a close match. </span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=468
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr>
   <td width=216 valign=top style='width:162.0pt;border-top:1.5pt;border-left:
   1.5pt;border-bottom:1.0pt;border-right:1.0pt;border-color:black;border-style:
   solid;padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Filters:<br>
   Java 1.0 class</span></p>
   </td>
   <td width=252 valign=top style='width:189.0pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Corresponding Java 1.1 class</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>FilterInputStream</span></p>
  </td>
  <td width=252 valign=top style='width:189.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>FilterReader</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>FilterOutputStream</span></p>
  </td>
  <td width=252 valign=top style='width:189.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>FilterWriter </span><span lang=EN-US
  style='font-weight:normal'>(abstract class with no subclasses)</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>BufferedInputStream</span></p>
  </td>
  <td width=252 valign=top style='width:189.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>BufferedReader<br>
  </span><span lang=EN-US style='font-weight:normal'>(also has</span><span
  lang=EN-US> readLine(&nbsp;)</span><span lang=EN-US style='font-weight:normal'>)</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>BufferedOutputStream</span></p>
  </td>
  <td width=252 valign=top style='width:189.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>BufferedWriter</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>DataInputStream</span></p>
  </td>
  <td width=252 valign=top style='width:189.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Use</span><span
  lang=EN-US> DataInputStream<br>
  </span><span lang=EN-US style='font-weight:normal'>(Except when you need to
  use</span><span lang=EN-US> readLine(&nbsp;)</span><span lang=EN-US
  style='font-weight:normal'>,</span><span lang=EN-US> </span><span lang=EN-US
  style='font-weight:normal'>when you should use a</span><span lang=EN-US>
  BufferedReader</span><span lang=EN-US style='font-weight:normal'>)</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>PrintStream</span></p>
  </td>
  <td width=252 valign=top style='width:189.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>PrintWriter</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>LineNumberInputStream</span></p>
  </td>
  <td width=252 valign=top style='width:189.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>LineNumberReader</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>StreamTokenizer</span></p>
  </td>
  <td width=252 valign=top style='width:189.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>StreamTokenizer<br>
  </span><span lang=EN-US style='font-weight:normal'>(use constructor that
  takes a </span><span lang=EN-US>Reader</span><span lang=EN-US
  style='font-weight:normal'> instead)</span></p>
  </td>
 </tr>
 <tr>
  <td width=216 valign=top style='width:162.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>PushBackInputStream</span></p>
  </td>
  <td width=252 valign=top style='width:189.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>PushBackReader</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>There’s one direction that’s quite
clear: Whenever you want to use <b>readLine(&nbsp;)</b>, you shouldn’t do it
with a <b>DataInputStream</b> any more (this is met with a deprecation message
at compile-time), but instead use a <b>BufferedReader</b>. Other than this, <b>DataInputStream</b>
is still a “preferred” member of the I/O library.</span></p>

<p class=MsoNormal><span lang=EN-US>To make the transition to using a <b>PrintWriter</b>
easier, it has constructors that take any <b>OutputStream</b> object, as well
as <b>Writer</b> objects. However, <b>PrintWriter</b> has no more support for
formatting than <b>PrintStream</b> does; the interfaces are virtually the same.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>PrintWriter</b> constructor also has
an option to perform automatic flushing, which happens after every <b>println(&nbsp;)</b>
if the constructor flag is set.</span></p>

<h3><a name="_Toc481064747"><span lang=EN-US>Unchanged Classes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Some classes were left unchanged between
Java 1.0 and Java 1.1: </span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr>
   <td width=222 valign=top style='width:166.5pt;border:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US style='font-weight:normal'>Java 1.0 classes
   without corresponding Java 1.1 classes</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td width=222 valign=top style='width:166.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>DataOutputStream</span></p>
  </td>
 </tr>
 <tr>
  <td width=222 valign=top style='width:166.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>File</span></p>
  </td>
 </tr>
 <tr>
  <td width=222 valign=top style='width:166.5pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>RandomAccessFile</span></p>
  </td>
 </tr>
 <tr>
  <td width=222 valign=top style='width:166.5pt;border:solid black 1.5pt;
  border-top:none;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>SequenceInputStream</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><b><span lang=EN-US>DataOutputStream</span></b><span
lang=EN-US>, in particular, is used without change, so for storing and
retrieving data in a transportable format you use the <b>InputStream</b> and <b>OutputStream</b>
hierarchies.</span></p>

<h2><a name="_Toc481064748"><span lang=EN-US>Off by itself: <br>
RandomAccessFile</span></a></h2>

<p class=MsoNormal><span lang=EN-US><b>RandomAccessFile</b> is used for files
containing records of known size so that you can move from one record to
another using </span><span lang=EN-US><b>seek(&nbsp;)</b>, then read or change
the records. The records don’t have to be the same size; you just have to be
able to determine how big they are and where they are placed in the file.</span></p>

<p class=MsoNormal><span lang=EN-US>At first it’s a little bit hard to believe
that <b>RandomAccessFile</b> is not part of the <b>InputStream</b> or <b>OutputStream</b>
hierarchy. However, it has no association with those hierarchies other than
that it happens to implement the </span><span lang=EN-US><b>DataInput</b> and </span><span lang=EN-US><b>DataOutput</b> interfaces (which are also implemented by <b>DataInputStream</b>
and <b>DataOutputStream</b>). It doesn’t even use any of the functionality of
the existing <b>InputStream</b> or <b>OutputStream</b> classes—it’s a
completely separate class, written from scratch, with all of its own (mostly
native) methods. The reason for this may be that <b>RandomAccessFile</b> has
essentially different behavior than the other I/O types, since you can move
forward and backward within a file. In any event, it stands alone, as a direct
descendant of <b>Object</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Essentially, a <b>RandomAccessFile</b>
works like a <b>DataInputStream</b> pasted together with a <b>DataOutputStream</b>,
along with the methods <b>getFilePointer(&nbsp;)</b> to find out where you are
in the file, <b>seek(&nbsp;)</b> to move to a new point in the file, and <b>length(&nbsp;)</b>
to determine the maximum size of the file. In addition, the constructors
require a second argument (identical to <b>fopen(&nbsp;) </b>in C) indicating
whether you are just randomly reading (<b>“r”</b>) or reading and writing (<b>“rw”</b>).
There’s no support for write-only files, which could suggest that <b>RandomAccessFile</b>
might have worked well if it were inherited from <b>DataInputStream</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The seeking methods are available only in <b>RandomAccessFile</b>,
which works for files only. <b>BufferedInputStream</b> does allow you to </span><span lang=EN-US><b>mark(&nbsp;)</b> a position (whose value is held in a single
internal variable) and </span><span
lang=EN-US><b>reset(&nbsp;)</b> to that position, but this is limited and not
very useful.</span></p>

<h2><a name="_Toc481064749"></a><a name="_Toc375545393"><span lang=EN-US>Typical
uses of I/O streams</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Although you can combine the I/O stream
classes in many different ways, you’ll probably just use a few combinations.
The following example can be used as a basic reference; it shows the creation
and use of </span><span
lang=EN-US>typical I/O configurations. Note that each configuration begins with
a commented number and title that corresponds to the heading for the
appropriate explanation that follows in the text.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c11:IOStreamDemo.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Typical I/O stream
configurations.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
IOStreamDemo {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Throw exceptions to
console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // 1. Reading input
by lines:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BufferedReader in =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileReader(&quot;IOStreamDemo.java&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s, s2 = new
String();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while((s =
in.readLine())!= null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s2 += s +
&quot;\n&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    in.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // 1b. Reading
standard input:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BufferedReader stdin
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
InputStreamReader(System.in));      </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.print(&quot;Enter a line:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(stdin.readLine());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // 2. Input from
memory</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    StringReader in2 =
new StringReader(s2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int c;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while((c =
in2.read()) != -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print((char)c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // 3. Formatted
memory input</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      DataInputStream
in3 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
DataInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
ByteArrayInputStream(s2.getBytes()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while(true)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.print((char)in3.readByte());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(EOFException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;End of stream&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // 4. File output</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      BufferedReader in4
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
StringReader(s2));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      PrintWriter out1 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new PrintWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
BufferedWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            new
FileWriter(&quot;IODemo.out&quot;)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int lineCount = 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while((s = in4.readLine())
!= null )</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
out1.println(lineCount++ + &quot;: &quot; + s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      out1.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(EOFException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;End of stream&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // 5. Storing &amp;
recovering data</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      DataOutputStream
out2 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
DataOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
BufferedOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            new
FileOutputStream(&quot;Data.txt&quot;)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
out2.writeDouble(3.14159);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
out2.writeChars(&quot;That was pi\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
out2.writeBytes(&quot;That was pi\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      out2.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      DataInputStream
in5 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
DataInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
BufferedInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            new
FileInputStream(&quot;Data.txt&quot;)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      BufferedReader
in5br =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
InputStreamReader(in5));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Must use
DataInputStream for data:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(in5.readDouble());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Can now use the
&quot;proper&quot; readLine():</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(in5br.readLine());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // But the line
comes out funny.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // The one created
with writeBytes is OK:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(in5br.readLine());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(EOFException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;End of stream&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // 6.
Reading/writing random access files</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    RandomAccessFile rf
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
RandomAccessFile(&quot;rtest.dat&quot;, &quot;rw&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      rf.writeDouble(i*1.414);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    rf.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    rf =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
RandomAccessFile(&quot;rtest.dat&quot;, &quot;rw&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    rf.seek(5*8);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
rf.writeDouble(47.0001);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    rf.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    rf =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
RandomAccessFile(&quot;rtest.dat&quot;, &quot;r&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Value
&quot; + i + &quot;: &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
rf.readDouble());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    rf.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Here are the descriptions for the numbered
sections of the program:</span></p>

<h3><a name="_Toc481064750"></a><a name="_Toc375545394"><span lang=EN-US>Input
streams</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Parts 1 through 4 demonstrate the creation
and use of input streams. Part 4 also shows the simple use of an output stream.</span></p>

<h4><span lang=EN-US>1. Buffered input file</span></h4>

<p class=MsoNormal><span lang=EN-US>To open a file for character input, you use
a </span><span lang=EN-US><b>FileInputReader</b> with a <b>String</b> or a <b>File</b>
object as the file name. For speed, you’ll want that file to be buffered so you
give the resulting reference to the constructor for a </span><span lang=EN-US><b>BufferedReader</b>. Since <b>BufferedReader</b> also provides the <b>readLine(&nbsp;)</b>
method, this is your final object and the interface you read from. When you
reach the end of the file, <b>readLine(&nbsp;)</b> returns <b>null</b> so that
is used to break out of the <b>while</b> loop.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>String s2</b> is used to accumulate
the entire contents of the file (including newlines that must be added since <b>readLine(&nbsp;)</b>
strips them off). <b>s2 </b>is then used in the later portions of this program.
Finally, <b>close(&nbsp;)</b> is called to close the file. Technically, <b>close(&nbsp;)</b>
will be called when <b>finalize(&nbsp;)</b> runs, and this is supposed to
happen (whether or not garbage collection occurs) as the program exits.
However, this has been inconsistently implemented, so the only safe approach is
to explicitly call </span><span lang=EN-US><b>close(&nbsp;)</b> for files.</span></p>

<p class=MsoNormal><span lang=EN-US>Section 1b shows how you can wrap </span><span lang=EN-US><b>System.in</b> for reading </span><span lang=EN-US>console input. <b>System.in</b> is a <b>DataInputStream</b> and <b>BufferedReader</b>
needs a <b>Reader</b> argument, so <b>InputStreamReader</b> is brought in to
perform the translation.</span></p>

<h4><span lang=EN-US>2. Input from memory</span></h4>

<p class=MsoNormal><span lang=EN-US>This section takes the <b>String s2</b>
that now contains the entire contents of the file and uses it to create a </span><span lang=EN-US><b>StringReader</b>. Then <b>read(&nbsp;)</b> is used to read each
character one at a time and send it out to the console. Note that <b>read(&nbsp;)</b>
returns the next byte as an <b>int</b> and thus it must be cast to a <b>char</b>
to print properly.</span></p>

<h4><span lang=EN-US>3. Formatted memory input</span></h4>

<p class=MsoNormal><span lang=EN-US>To read “formatted” data, you use a </span><span lang=EN-US><b>DataInputStream</b>, which is a <b>byte</b>-oriented I/O class
(rather than <b>char</b> oriented). Thus you must use all <b>InputStream</b>
classes rather than <b>Reader</b> classes. Of course, you can read anything
(such as a file) as bytes using <b>InputStream</b> classes, but here a <b>String</b>
is used. To convert the <b>String</b> to an array of bytes, which is what is
appropriate for a <b>ByteArrayInputStream</b>, <b>String</b> has a </span><span lang=EN-US><b>getBytes(&nbsp;)</b> method to do the job. At that point, you have
an appropriate <b>InputStream</b> to hand to <b>DataInputStream</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>If you read the characters from a <b>DataInputStream
</b>one byte at a time using <b>readByte(&nbsp;)</b>, any byte value is a
legitimate result so the return value cannot be used to detect the end of
input. Instead, you can use the </span><span lang=EN-US><b>available(&nbsp;) </b>method to find out how many more characters
are available. Here’s an example that shows how to read a file one byte at a
time:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:TestEOF.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Testing for the end
of file </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// while reading a byte
at a time.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class TestEOF {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Throw exceptions to
console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    DataInputStream in =
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
DataInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       new
BufferedInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileInputStream(&quot;TestEof.java&quot;)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(in.available()
!= 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.print((char)in.readByte());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that <b>available(&nbsp;)</b> works
differently depending on what sort of medium you’re reading from; it’s
literally “the number of bytes that can be read <i>without blocking</i>.”</span><span lang=EN-US> With a file this means the whole file, but with a different kind of
stream this might not be true, so use it thoughtfully.</span></p>

<p class=MsoNormal><span lang=EN-US>You could also detect the end of input in
cases like these by catching an exception. However, the use of exceptions for
control flow is considered a misuse of that feature.</span></p>

<h4><span lang=EN-US>4. File output</span></h4>

<p class=MsoNormal><span lang=EN-US>This example also shows how to write data
to a file. First, a </span><span lang=EN-US><b>FileWriter</b> is created to
connect to the file. You’ll virtually always want to buffer the output by
wrapping it in a </span><span lang=EN-US><b>BufferedWriter</b> (try removing
this wrapping to see the impact on the performance—buffering tends to
dramatically increase performance of I/O operations). Then for the formatting
it’s turned into a </span><span lang=EN-US><b>PrintWriter</b>. The data file
created this way is readable as an ordinary text file.</span></p>

<p class=MsoNormal><span lang=EN-US>As the lines are written to the file, line
numbers are added. Note that <b>LineNumberInputStream</b> is <i>not</i> used,
because it’s a silly class and you don’t need it. As shown here, it’s trivial
to keep track of your own line numbers.</span></p>

<p class=MsoNormal><span
lang=EN-US>When the input stream is exhausted, </span><span lang=EN-US><b>readLine(&nbsp;)</b> returns <b>null</b>. You’ll see an explicit <b>close(&nbsp;)</b>
for <b>out1</b>, because if you don’t call <b>close(&nbsp;)</b> for all your
output files, you might discover that the buffers don’t get flushed so they’re
incomplete.</span></p>

<h3><a name="_Toc481064751"></a><a name="_Toc375545395"><span lang=EN-US>Output
streams</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The two primary kinds of output streams are
separated by the way they write data: one writes it for human consumption, and
the other writes it to be reacquired by a </span><span lang=EN-US><b>DataInputStream</b>. The </span><span lang=EN-US><b>RandomAccessFile</b> stands alone, although its data format is
compatible with the <b>DataInputStream</b> and </span><span lang=EN-US><b>DataOutputStream</b>.</span></p>

<h4><span lang=EN-US>5. Storing and recovering data</span></h4>

<p class=MsoNormal><span lang=EN-US>A <b>PrintWriter</b> formats data so it’s
readable by a human. However, to output data so that it can be recovered by
another stream, you use a <b>DataOutputStream</b> to write the data and a <b>DataInputStream</b>
to recover the data. Of course, these streams could be anything, but here a
file is used, buffered for both reading and writing. <b>DataOutputStream</b>
and <b>DataInputStream</b> are <b>byte</b>-oriented and thus require the <b>InputStream</b>s
and <b>OutputStream</b>s.</span></p>

<p class=MsoNormal><span lang=EN-US>If you use a <b>DataOutputStream</b> to
write the data, then Java guarantees that you can accurately recover the data
using a <b>DataInputStream</b>—regardless of what different platforms write and
read the data. This is incredibly valuable, as anyone knows who has spent time
worrying about platform-specific data issues. That problem vanishes if you have
Java on both platforms</span><a href="#_ftn58" name="_ftnref58" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[58]</span></span></span></span></a><span lang=EN-US>.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that the character string is written
using both <b>writeChars(&nbsp;) </b>and <b>writeBytes(&nbsp;)</b>. When you
run the program, you’ll discover that <b>writeChars(&nbsp;)</b> outputs 16-bit
Unicode characters. When you read the line using <b>readLine(&nbsp;)</b>,
you’ll see that there is a space between each character, because of the extra
byte inserted by Unicode. Since there is no complementary “readChars” method in
<b>DataInputStream</b>, you’re stuck pulling these characters off one at a time
with </span><span lang=EN-US><b>readChar(&nbsp;)</b>. So for ASCII, it’s easier
to write the characters as bytes followed by a newline; then use </span><span lang=EN-US><b>readLine(&nbsp;)</b> to read back the bytes as a regular ASCII
line.</span></p>

<p class=MsoNormal><span lang=EN-US>The </span><span lang=EN-US><b>writeDouble(&nbsp;)</b> stores the <b>double</b> number to the
stream and the complementary </span><span lang=EN-US><b>readDouble(&nbsp;)</b> recovers it (there are similar methods for
reading and writing the other types). But for any of the reading methods to
work correctly, you must know the exact placement of the data item in the
stream, since it would be equally possible to read the stored <b>double</b> as
a simple sequence of bytes, or as a <b>char</b>, etc. So you must either have a
fixed format for the data in the file or extra information must be stored in
the file that you parse to determine where the data is located.</span></p>

<h4><span lang=EN-US>6. Reading and writing random access files</span></h4>

<p class=MsoNormal><span lang=EN-US>As previously noted, the <b>RandomAccessFile</b>
is almost totally isolated from the rest of the I/O hierarchy, save for the
fact that it implements the <b>DataInput</b> and <b>DataOutput</b> interfaces.
So you cannot combine it with any of the aspects of the <b>InputStream</b> and <b>OutputStream</b>
subclasses. Even though it might make sense to treat a <b>ByteArrayInputStream</b>
as a random access element, you can use <b>RandomAccessFile</b> to only open a
file. You must assume a <b>RandomAccessFile</b> is properly buffered since you
cannot add that.</span></p>

<p class=MsoNormal><span lang=EN-US>The one option you have is in the second
constructor argument: you can open a <b>RandomAccessFile</b> to read (<b>“r”</b>)
or read and write (<b>“rw”</b>).</span></p>

<p class=MsoNormal><span lang=EN-US>Using a <b>RandomAccessFile</b> is like
using a combined <b>DataInputStream</b> and <b>DataOutputStream</b> (because it
implements the equivalent interfaces). In addition, you can see that </span><span lang=EN-US><b>seek(&nbsp;)</b> is used to move about in the file and change one
of the values.</span></p>

<h3><a name="_Toc481064752"><span lang=EN-US>A bug?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>If you look at section 5, you’ll see that
the data is written <i>before</i> the text. That’s because a problem was
introduced in Java 1.1 (and persists in Java 2) that sure seems like a bug to
me, but I reported it and the bug people at JavaSoft said that this is the way
it is supposed to work (however, the problem did <i>not</i> occur in Java 1.0,
which makes me suspicious). The problem is shown in the following code:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:IOProblem.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Java 1.1 and higher
I/O Problem.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class IOProblem {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Throw exceptions to
console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    DataOutputStream out
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
DataOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
FileOutputStream(&quot;Data.txt&quot;)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.writeDouble(3.14159);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.writeBytes(&quot;That
was the value of pi\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.writeBytes(&quot;This is pi/2:\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.writeDouble(3.14159/2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    DataInputStream in =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
DataInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
FileInputStream(&quot;Data.txt&quot;)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BufferedReader inbr
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
InputStreamReader(in));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // The doubles
written BEFORE the line of text</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // read back
correctly:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(in.readDouble());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Read the lines of
text:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(inbr.readLine());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(inbr.readLine());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Trying to read
the doubles after the line</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // produces an
end-of-file exception:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(in.readDouble());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It appears that anything you write after a
call to <b>writeBytes(&nbsp;)</b> is not recoverable. The answer is apparently
the same as the answer to the old vaudeville joke: “Doc, it hurts when I do
this!” “Don’t do that!”</span></p>

<h3><a name="_Toc481064753"><span lang=EN-US>Piped streams</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The <b>PipedInputStream</b>, <b>PipedOutputStream</b>,
<b>PipedReader</b> and <b>PipedWriter</b> have been mentioned only briefly in
this chapter. This is not to suggest that they aren’t useful, but their value
is not apparent until you begin to understand multithreading, since the piped
streams are used to communicate between threads. This is covered along with an
example in Chapter 14.</span></p>

<h2><a name="_Toc481064754"><span lang=EN-US>Standard I/O</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The term <i>standard I/O</i> refers to the Unix concept (which is
reproduced in some form in Windows and many other operating systems) of a
single stream of information that is used by a program. All the program’s input
can come from <i>standard input</i>, all its output can go to <i>standard
output</i>, and all of its error messages can be sent to <i>standard error</i>.
The value of standard I/O is that programs can easily be chained together and one
program’s standard output can become the standard input for another program.
This is a powerful tool.</span></p>

<h3><a name="_Toc375545397"></a><a name="_Toc481064755"><span lang=EN-US>Reading
from standard input</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Following the standard I/O model, Java has <b>System.in</b>,
<b>System.out,</b> and <b>System.err</b>. Throughout this book you’ve seen how
to write to standard output using <b>System.out,</b> which is already
prewrapped as a <b>PrintStream</b> object. <b>System.err</b> is likewise a <b>PrintStream</b>,
but <b>System.in</b> is a raw <b>InputStream</b>, with no wrapping. This means
that while you can use <b>System.out</b> and <b>System.err</b> right away, <b>System.in</b>
must be wrapped before you can read from it.</span></p>

<p class=MsoNormal><span lang=EN-US>Typically, you’ll want to read input a line
at a time using <b>readLine(&nbsp;)</b>, so you’ll want to wrap <b>System.in</b>
in a <b>BufferedReader</b>. To do this, you must convert <b>System.in </b>to a <b>Reader</b>
using <b>InputStreamReader</b>. Here’s an example that simply echoes each line
that you type in:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:Echo.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// How to read from
standard input.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Echo {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BufferedReader in =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
InputStreamReader(System.in));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while((s =
in.readLine()).length() != 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // An empty line
terminates the program</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The reason for the exception specification
is that </span><span lang=EN-US><b>readLine(&nbsp;)</b> can throw an <b>IOException</b>.
Note that <b>System.in</b> should usually be buffered, as with most streams.</span></p>

<h3><a name="_Toc481064756"><span lang=EN-US>Changing <b>System.out</b> to a <b>PrintWriter</b></span></a></h3>

<p class=MsoNormal><b><span lang=EN-US>System.out</span></b><span lang=EN-US>
is a <b>PrintStream</b>, which is an <b>OutputStream</b>.<b> PrintWriter</b>
has a constructor that takes an <b>OutputStream</b> as an argument. Thus, if
you want you can convert <b>System.out</b> into a <b>PrintWriter</b> using that
constructor:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c11:ChangeSystemOut.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Turn System.out into
a PrintWriter.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ChangeSystemOut {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PrintWriter out = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
PrintWriter(System.out, true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;Hello, world&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It’s important to use the two-argument
version of the <b>PrintWriter</b> constructor and to set the second argument to
<b>true</b> in order to enable automatic flushing, otherwise you may not see
the output.</span></p>

<h3><a name="_Toc481064757"><span lang=EN-US>Redirecting standard I/O</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>The Java <b>System</b> class allows you to redirect the standard
input, output, and error I/O streams using simple static method calls:</span></p>

<p class=MsoNormal><span lang=EN-US><b>setIn(InputStream) <br>
</b></span><span lang=EN-US><b>setOut(PrintStream)<br>
</b></span><span lang=EN-US><b>setErr(PrintStream) </b></span></p>

<p class=MsoNormal><span lang=EN-US>Redirecting output is especially useful if
you suddenly start creating a large amount of output on your screen and it’s
scrolling past faster than you can read it.</span><a href="#_ftn59"
name="_ftnref59" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[59]</span></span></span></span></a><span
lang=EN-US> Redirecting input is valuable for a command-line program in which
you want to test a particular user-input sequence repeatedly. Here’s a simple
example that shows the use of these methods:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:Redirecting.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates standard
I/O redirection.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Redirecting {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Throw exceptions to
console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BufferedInputStream
in = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
BufferedInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
&quot;Redirecting.java&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PrintStream out =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new PrintStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
FileOutputStream(&quot;test.out&quot;)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.setIn(in);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.setOut(out);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.setErr(out);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BufferedReader br = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
InputStreamReader(System.in));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while((s =
br.readLine()) != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.close(); //
Remember this!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This program attaches standard input to a
file, and redirects standard output and standard error to another file.</span></p>

<p class=MsoNormal><span lang=EN-US>I/O redirection manipulates streams of
bytes, not streams of characters, thus <b>InputStream</b>s and <b>OutputStream</b>s
are used rather than <b>Reader</b>s and <b>Writer</b>s.</span></p>

<h2><a name="_Toc375545400"></a><a name="_Toc481064758"><span lang=EN-US>Compression</span></a></h2>

<p class=MsoNormal><span
lang=EN-US>The Java I/O library contains classes to support reading and writing
streams in a compressed format. These are wrapped around existing I/O classes
to provide compression functionality.</span></p>

<p class=MsoNormal><span lang=EN-US>These classes are not derived from the <b>Reader</b>
and <b>Writer</b> classes, but instead are part of the <b>InputStream</b> and <b>OutputStream</b>
hierarchies. This is because the compression library works with bytes, not
characters. However, you might sometimes be forced to mix the two types of
streams. (Remember that you can use <b>InputStreamReader</b> and <b>OutputStreamWriter</b>
to provide easy conversion between one type and another.) </span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr>
   <td width=198 valign=top style='width:148.65pt;border:solid black 1.5pt;
   border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Compression class</span></p>
   </td>
   <td width=282 valign=top style='width:211.5pt;border:solid black 1.5pt;
   border-left:none;padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Function</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td width=198 valign=top style='width:148.65pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>CheckedInputStream</span></p>
  </td>
  <td width=282 valign=top style='width:211.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>GetCheckSum(&nbsp;)</span><span lang=EN-US
  style='font-weight:normal'> produces checksum for any </span><span
  lang=EN-US>InputStream</span><span lang=EN-US style='font-weight:normal'>
  (not just decompression).</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.65pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>CheckedOutputStream</span></p>
  </td>
  <td width=282 valign=top style='width:211.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>GetCheckSum(&nbsp;)</span><span lang=EN-US
  style='font-weight:normal'> produces checksum for any </span><span
  lang=EN-US>OutputStream</span><span lang=EN-US style='font-weight:normal'>
  (not just compression).</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.65pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>DeflaterOutputStream</span></p>
  </td>
  <td width=282 valign=top style='width:211.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Base class for
  compression classes.</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.65pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>ZipOutputStream</span></p>
  </td>
  <td width=282 valign=top style='width:211.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>A </span><span
  lang=EN-US>DeflaterOutputStream</span><span lang=EN-US style='font-weight:
  normal'> that compresses data into the Zip file format.</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.65pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>GZIPOutputStream</span></p>
  </td>
  <td width=282 valign=top style='width:211.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>A </span><span
  lang=EN-US>DeflaterOutputStream</span><span lang=EN-US style='font-weight:
  normal'> that compresses data into the GZIP file format.</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.65pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>InflaterInputStream</span></p>
  </td>
  <td width=282 valign=top style='width:211.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Base class for
  decompression classes.</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.65pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>ZipInputStream</span></p>
  </td>
  <td width=282 valign=top style='width:211.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>An </span><span
  lang=EN-US>InflaterInputStream</span><span lang=EN-US style='font-weight:
  normal'> that decompresses data that has been stored in the Zip file format.</span></p>
  </td>
 </tr>
 <tr>
  <td width=198 valign=top style='width:148.65pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>GZIPInputStream</span></p>
  </td>
  <td width=282 valign=top style='width:211.5pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>An </span><span
  lang=EN-US>InflaterInputStream</span><span lang=EN-US style='font-weight:
  normal'> that decompresses data that has been stored in the GZIP file format.</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>Although there are many compression
algorithms, Zip and GZIP are possibly the most commonly used. Thus you can
easily manipulate your compressed data with the many tools available for
reading and writing these formats.</span></p>

<h3><a name="_Toc481064759"><span lang=EN-US>Simple compression with GZIP</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The GZIP interface is simple and thus is
probably more appropriate when you have a single stream of data that you want
to compress (rather than a container of dissimilar pieces of data). Here’s an
example that compresses a single file:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c11:GZIPcompress.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Uses GZIP compression
to compress a file </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// whose name is passed
on the command line.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.zip.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
GZIPcompress {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Throw exceptions to
console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BufferedReader in =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileReader(args[0]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BufferedOutputStream
out =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
BufferedOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
GZIPOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
FileOutputStream(&quot;test.gz&quot;)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Writing file&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int c;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while((c =
in.read()) != -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      out.write(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    in.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Reading file&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BufferedReader in2 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
InputStreamReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
GZIPInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            new FileInputStream(&quot;test.gz&quot;))));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while((s =
in2.readLine()) != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The use of the compression classes is
straightforward—you simply wrap your output stream in a <b>GZIPOutputStream</b>
or <b>ZipOutputStream</b> and your input stream in a <b>GZIPInputStream</b> or <b>ZipInputStream</b>.
All else is ordinary I/O reading and writing. This is an example of mixing the <b>char</b>-oriented
streams with the <b>byte</b>-oriented streams: <b>in</b> uses the <b>Reader</b>
classes, whereas <b>GZIPOutputStream</b>’s constructor can accept only an <b>OutputStream</b>
object, not a <b>Writer</b> object. When the file is opened, the <b>GZIPInputStream</b>
is converted to a <b>Reader</b>.</span></p>

<h3><a name="_Toc481064760"><span lang=EN-US>Multifile storage with Zip</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The library that supports the Zip format is
much more extensive. With it you can easily store multiple files, and there’s
even a separate class to make the process of reading a Zip file easy. The
library uses the standard Zip format so that it works seamlessly with all the
tools currently downloadable on the Internet. The following example has the same
form as the previous example, but it handles as many command-line arguments as
you want. In addition, it shows the use of the </span><span
lang=EN-US><b>Checksum</b> classes to calculate and verify the checksum for the
file. There are two <b>Checksum</b> types: </span><span
lang=EN-US><b>Adler32</b> (which is faster) and </span><span
lang=EN-US><b>CRC32</b> (which is slower but slightly more accurate).</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:ZipCompress.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Uses Zip compression
to compress any </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// number of files given
on the command line.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.zip.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ZipCompress
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Throw exceptions to
console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    FileOutputStream f =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
FileOutputStream(&quot;test.zip&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    CheckedOutputStream
csum =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new CheckedOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        f, new
Adler32());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ZipOutputStream out
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ZipOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedOutputStream(csum));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.setComment(&quot;A test of Java Zipping&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // No corresponding
getComment(), though.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; args.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Writing
file &quot; + args[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      BufferedReader in
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
FileReader(args[i]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
out.putNextEntry(new ZipEntry(args[i]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int c;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while((c =
in.read()) != -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        out.write(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      in.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Checksum valid
only after the file</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // has been closed!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Checksum: &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
csum.getChecksum().getValue());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Now extract the
files:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Reading
file&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    FileInputStream fi =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       new
FileInputStream(&quot;test.zip&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    CheckedInputStream
csumi =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
CheckedInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        fi, new
Adler32());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ZipInputStream in2 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ZipInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedInputStream(csumi));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ZipEntry ze;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while((ze =
in2.getNextEntry()) != null) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Reading file &quot; + ze);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while((x =
in2.read()) != -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.write(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Checksum: &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      csumi.getChecksum().getValue());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    in2.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Alternative way
to open and read</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // zip files:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ZipFile zf = new
ZipFile(&quot;test.zip&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Enumeration e =
zf.entries();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
while(e.hasMoreElements()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ZipEntry ze2 =
(ZipEntry)e.nextElement();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;File: &quot; + ze2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // ... and extract
the data as before</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>For each file to add to the archive, you
must call <b>putNextEntry(&nbsp;) </b>and pass it a </span><span lang=EN-US><b>ZipEntry </b>object. The <b>ZipEntry</b> object contains an
extensive interface that allows you to get and set all the data available on
that particular entry in your Zip file: name, compressed and uncompressed
sizes, date, CRC checksum, extra field data, comment, compression method, and whether
it’s a directory entry. However, even though the Zip format has a way to set a
password, this is not supported in Java’s Zip library. And although <b>CheckedInputStream</b>
and <b>CheckedOutputStream</b> support both <b>Adler32</b> and <b>CRC32</b>
checksums, the <b>ZipEntry</b> class supports only an interface for CRC. This
is a restriction of the underlying Zip format, but it might limit you from
using the faster <b>Adler32</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>To extract files, <b>ZipInputStream</b> has
a <b>getNextEntry(&nbsp;)</b> method that returns the next <b>ZipEntry</b> if
there is one. As a more succinct alternative, you can read the file using a <b>ZipFile</b>
object, which has a method <b>entries(&nbsp;) </b>to return an <b>Enumeration</b>
to the <b>ZipEntries</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>In order to read the checksum you must
somehow have access to the associated <b>Checksum</b> object. Here, a reference
to the <b>CheckedOutputStream</b> and <b>CheckedInputStream</b> objects is
retained, but you could also just hold onto a reference to the <b>Checksum</b>
object.</span></p>

<p class=MsoNormal><span lang=EN-US>A baffling method in Zip streams is <b>setComment(&nbsp;)</b>.
As shown above, you can set a comment when you’re writing a file, but there’s
no way to recover the comment in the <b>ZipInputStream</b>. Comments appear to
be supported fully on an entry-by-entry basis only via <b>ZipEntry</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, you are not limited to files
when using the <b>GZIP</b> or <b>Zip</b> libraries—you can compress anything,
including data to be sent through a network connection.</span></p>

<h3><a name="_Toc481064761"><span lang=EN-US>Java ARchives (JARs)</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The Zip format is also used in the </span><span lang=EN-US>JAR (Java ARchive) file format, which is a way to collect a group of
files into a single compressed file, just like Zip. However, like everything
else in Java, JAR files are cross-platform so you don’t need to worry about
platform issues. You can also include audio and image files as well as class
files. </span></p>

<p class=MsoNormal><span lang=EN-US>JAR files are particularly helpful when you
deal with the Internet. Before JAR files, your Web browser would have to make
repeated requests of a Web server in order to download all of the files that
make up an applet. In addition, each of these files was uncompressed. By
combining all of the files for a particular applet into a single JAR file, only
one server request is necessary and the transfer is faster because of
compression. And each entry in a JAR file can be digitally signed for security
(refer to the Java documentation for details).</span></p>

<p class=MsoNormal><span lang=EN-US>A JAR file consists of a single file
containing a collection of zipped files along with a “</span><span
lang=EN-US>manifest” that describes them. (You can create your own manifest
file; otherwise the <b>jar </b>program will do it for you.) You can find out
more about JAR manifests in the JDK HTML documentation.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>jar</b> utility that comes with
Sun’s JDK automatically compresses the files of your choice. You invoke it on
the command line:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>jar [options]
destination [manifest] inputfile(s)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The options are simply a collection of
letters (no hyphen or any other indicator is necessary). Unix/Linux users will
note the similarity to the <b>tar </b>options. These are:</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=456
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=67 valign=top style='width:50.15pt;border-top:1.5pt;border-left:
  1.5pt;border-bottom:1.0pt;border-right:1.0pt;border-color:windowtext;
  border-style:solid;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>c </span></p>
  </td>
  <td width=389 valign=top style='width:291.85pt;border-top:solid windowtext 1.5pt;
  border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Creates a new or
  empty archive. </span></p>
  </td>
 </tr>
 <tr>
  <td width=67 valign=top style='width:50.15pt;border-top:none;border-left:
  solid windowtext 1.5pt;border-bottom:solid windowtext 1.0pt;border-right:
  solid windowtext 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>t </span></p>
  </td>
  <td width=389 valign=top style='width:291.85pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Lists the table of
  contents. </span></p>
  </td>
 </tr>
 <tr>
  <td width=67 valign=top style='width:50.15pt;border-top:none;border-left:
  solid windowtext 1.5pt;border-bottom:solid windowtext 1.0pt;border-right:
  solid windowtext 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>x</span></p>
  </td>
  <td width=389 valign=top style='width:291.85pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Extracts all
  files.</span></p>
  </td>
 </tr>
 <tr>
  <td width=67 valign=top style='width:50.15pt;border-top:none;border-left:
  solid windowtext 1.5pt;border-bottom:solid windowtext 1.0pt;border-right:
  solid windowtext 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>x file</span></p>
  </td>
  <td width=389 valign=top style='width:291.85pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Extracts the named
  file.</span></p>
  </td>
 </tr>
 <tr>
  <td width=67 valign=top style='width:50.15pt;border-top:none;border-left:
  solid windowtext 1.5pt;border-bottom:solid windowtext 1.0pt;border-right:
  solid windowtext 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>f</span></p>
  </td>
  <td width=389 valign=top style='width:291.85pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Says: “I’m going
  to give you the name of the file.” If you don’t use this, jar assumes that
  its input will come from standard input, or, if it is creating a file, its
  output will go to standard output.</span></p>
  </td>
 </tr>
 <tr>
  <td width=67 valign=top style='width:50.15pt;border-top:none;border-left:
  solid windowtext 1.5pt;border-bottom:solid windowtext 1.0pt;border-right:
  solid windowtext 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>m</span></p>
  </td>
  <td width=389 valign=top style='width:291.85pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Says that the
  first argument will be the name of the user-created manifest file.</span></p>
  </td>
 </tr>
 <tr>
  <td width=67 valign=top style='width:50.15pt;border-top:none;border-left:
  solid windowtext 1.5pt;border-bottom:solid windowtext 1.0pt;border-right:
  solid windowtext 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>v</span></p>
  </td>
  <td width=389 valign=top style='width:291.85pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Generates verbose
  output describing what jar is doing.</span></p>
  </td>
 </tr>
 <tr>
  <td width=67 valign=top style='width:50.15pt;border-top:none;border-left:
  solid windowtext 1.5pt;border-bottom:solid windowtext 1.0pt;border-right:
  solid windowtext 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>0</span></p>
  </td>
  <td width=389 valign=top style='width:291.85pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Only store the
  files; doesn’t compress the files (use to create a JAR file that you can put
  in your classpath).</span></p>
  </td>
 </tr>
 <tr>
  <td width=67 valign=top style='width:50.15pt;border-top:none;border-left:
  solid windowtext 1.5pt;border-bottom:solid windowtext 1.5pt;border-right:
  solid windowtext 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>M</span></p>
  </td>
  <td width=389 valign=top style='width:291.85pt;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.5pt;border-right:solid windowtext 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Don’t
  automatically create a manifest file.</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>If a subdirectory is included in the
files to be put into the JAR file, that subdirectory is automatically added,
including all of its subdirectories, etc. Path information is also preserved.</span></p>

<p class=MsoNormal><span lang=EN-US>Here are some typical ways to invoke <b>jar</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>jar cf myJarFile.jar
*.class</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This creates a JAR file called <b>myJarFile.jar</b>
that contains all of the class files in the current directory, along with an
automatically generated manifest file.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>jar cmf
myJarFile.jar myManifestFile.mf *.class</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Like the previous example, but adding a
user-created manifest file called <b>myManifestFile.mf</b>.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>jar tf
myJarFile.jar</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Produces a table of contents of the files
in <b>myJarFile.jar</b>.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>jar tvf
myJarFile.jar</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Adds the “verbose” flag to give more
detailed information about the files in <b>myJarFile.jar</b>.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>jar cvf myApp.jar
audio classes image</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Assuming <b>audio</b>, <b>classes,</b> and <b>image</b>
are subdirectories, this combines all of the subdirectories into the file <b>myApp.jar</b>.
The “verbose” flag is also included to give extra feedback while the <b>jar</b>
program is working.</span></p>

<p class=MsoNormal><span lang=EN-US>If you create a JAR file using the <b>0</b>
option, that file can be placed in your CLASSPATH:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>CLASSPATH=&quot;lib1.jar;lib2.jar;&quot;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Then Java can search <b>lib1.jar</b> and <b>lib2.jar</b>
for class files.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>jar</b> tool isn’t as useful as a <b>zip</b>
utility. For example, you can’t add or update files to an existing JAR file;
you can create JAR files only from scratch. Also, you can’t move files into a
JAR file, erasing them as they are moved. However, a JAR file created on one
platform will be transparently readable by the <b>jar</b> tool on any other
platform (a problem that sometimes plagues <b>zip</b> utilities).</span></p>

<p class=MsoNormal><span lang=EN-US>As you will see in Chapter 13, JAR files
are also used to package JavaBeans.</span></p>

<h2><a name="_Toc481064762"><span lang=EN-US>Object serialization</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Java’s <i>object serialization</i> allows you to take any object that
implements the <b>Serializable</b> interface and turn it into a sequence of
bytes that can later be fully restored to regenerate the original object. This
is even true across a network, which means that the serialization mechanism
automatically compensates for differences in operating systems. That is, you
can create an object on a Windows machine, serialize it, and send it across the
network to a Unix machine where it will be correctly reconstructed. You don’t
have to worry about the data representations on the different machines, the
byte ordering, or any other details.</span></p>

<p class=MsoNormal><span lang=EN-US>By itself, object serialization is
interesting because it allows you to implement <i>lightweight persistence</i>.
Remember that persistence means an object’s lifetime is not determined by
whether a program is executing—the object lives <i>in</i> <i>between</i>
invocations of the program. By taking a serializable object and writing it to
disk, then restoring that object when the program is reinvoked, you’re able to
produce the effect of persistence. The reason it’s called “lightweight” is that
you can’t simply define an object using some kind of “persistent” keyword and
let the system take care of the details (although this might happen in the
future). Instead, you must explicitly serialize and deserialize the objects in
your program.</span></p>

<p class=MsoNormal><span lang=EN-US>Object serialization was added to the
language to support two major features. Java’s <i>remote method invocation</i>
(RMI) allows objects that live on other machines to behave as if they live on
your machine. When sending messages to remote objects, object serialization is
necessary to transport the arguments and return values. RMI is discussed in
Chapter 15.</span></p>

<p class=MsoNormal><span lang=EN-US>Object serialization is also necessary for
JavaBeans, described in Chapter 13. When a Bean is used, its state information
is generally configured at design-time. This state information must be stored
and later recovered when the program is started; object serialization performs
this task.</span></p>

<p class=MsoNormal><span lang=EN-US>Serializing an object is quite simple, as
long as the object implements the <b>Serializable</b> interface (this interface
is just a flag and has no methods). When serialization was added to the language,
many standard library classes were changed to make them serializable, including
all of the wrappers for the primitive types, all of the container classes, and
many others. Even <b>Class</b> objects can be serialized. (See Chapter 12 for
the implications of this.)</span></p>

<p class=MsoNormal><span lang=EN-US>To serialize an object, you create some
sort of <b>OutputStream</b> object and then wrap it inside an </span><span lang=EN-US><b>ObjectOutputStream</b> object. At this point you need only call </span><span lang=EN-US><b>writeObject(&nbsp;)</b> and your object is serialized and sent to
the <b>OutputStream</b>. To reverse the process, you wrap an <b>InputStream</b>
inside an <b>ObjectInputStream</b> and call </span><span lang=EN-US><b>readObject(&nbsp;)</b>. What comes back is, as usual, a reference
to an upcast <b>Object</b>, so you must downcast to set things straight.</span></p>

<p class=MsoNormal><span lang=EN-US>A particularly clever aspect of object
serialization is that it not only saves an image of your object but it also
follows all the references contained in your object and saves <i>those </i>objects,
and follows all the references in each of those objects, etc. This is sometimes
referred to as the “</span><span
lang=EN-US>web of objects” that a single object can be connected to, and it
includes arrays of references to objects as well as member objects. If you had
to maintain your own object serialization scheme, maintaining the code to
follow all these links would be a bit mind-boggling. However, Java object
serialization seems to pull it off flawlessly, no doubt using an optimized
algorithm that traverses the web of objects. The following example tests the
serialization mechanism by making a “worm” of linked objects, each of which has
a link to the next segment in the worm as well as an array of references to
objects of a different class, <b>Data</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:Worm.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates object
serialization.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Data implements
Serializable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Data(int x) { i = x; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
Integer.toString(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Worm
implements Serializable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Generate a random
int value:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static int r()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
(int)(Math.random() * 10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Data[] d = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new Data(r()), new
Data(r()), new Data(r())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Worm next;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private char c;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Value of i ==
number of segments</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Worm(int i, char x) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot; Worm constructor: &quot; + i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c = x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(--i &gt; 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      next = new Worm(i,
(char)(x + 1));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Worm() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Default constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s =
&quot;:&quot; + c + &quot;(&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; d.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s +=
d[i].toString();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s += &quot;)&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(next != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s +=
next.toString();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Throw exceptions to
console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws
ClassNotFoundException, IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Worm w = new Worm(6,
'a');</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;w = &quot; + w);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectOutputStream
out =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileOutputStream(&quot;worm.out&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.writeObject(&quot;Worm
storage&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.writeObject(w);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.close(); // Also
flushes output</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectInputStream in
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileInputStream(&quot;worm.out&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s =
(String)in.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Worm w2 = (Worm)in.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(s
+ &quot;, w2 = &quot; + w2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
ByteArrayOutputStream bout =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ByteArrayOutputStream();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectOutputStream
out2 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectOutputStream(bout);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out2.writeObject(&quot;Worm storage&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out2.writeObject(w);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out2.flush();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectInputStream
in2 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
ByteArrayInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
bout.toByteArray()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s =
(String)in2.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Worm w3 =
(Worm)in2.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(s
+ &quot;, w3 = &quot; + w3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>To make things interesting, the array of <b>Data</b>
objects inside <b>Worm</b> are initialized with random numbers. (This way you
don’t suspect the compiler of keeping some kind of meta-information.) Each <b>Worm</b>
segment is labeled with a <b>char</b> that’s automatically generated in the
process of recursively generating the linked list of <b>Worm</b>s. When you
create a <b>Worm</b>, you tell the constructor how long you want it to be. To
make the <b>next</b> reference it calls the <b>Worm</b> constructor with a
length of one less, etc. The final <b>next</b> reference is left as <b>null</b>,
indicating the end of the <b>Worm</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The point of all this was to make something
reasonably complex that couldn’t easily be serialized. The act of serializing,
however, is quite simple. Once the <b>ObjectOutputStream</b> is created from
some other stream, <b>writeObject(&nbsp;)</b> serializes the object. Notice the
call to <b>writeObject(&nbsp;)</b> for a <b>String</b>, as well. You can also
write all the primitive data types using the same methods as <b>DataOutputStream</b>
(they share the same interface).</span></p>

<p class=MsoNormal><span lang=EN-US>There are two separate code sections that
look similar. The first writes and reads a file and the second, for variety,
writes and reads a <b>ByteArray</b>. You can read and write an object using
serialization to any <b>DataInputStream</b> or <b>DataOutputStream</b>
including, as you will see in the Chapter 15, a network. The output from one
run was:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Worm constructor: 6</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Worm constructor: 5</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Worm constructor: 4</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Worm constructor: 3</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Worm constructor: 2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Worm constructor: 1</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>w =
:a(262):b(100):c(396):d(480):e(316):f(398)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Worm storage, w2 =
:a(262):b(100):c(396):d(480):e(316):f(398)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Worm storage, w3 =
:a(262):b(100):c(396):d(480):e(316):f(398)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the deserialized object
really does contain all of the links that were in the original object.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that no constructor, not even the
default constructor, is called in the process of deserializing a <b>Serializable</b>
object. The entire object is restored by recovering data from the <b>InputStream</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Object serialization is <b>byte</b>-oriented,
and thus uses the <b>InputStream</b> and <b>OutputStream</b> hierarchies.</span></p>

<h3><a name="_Toc481064763"><span lang=EN-US>Finding the class</span></a></h3>

<p class=MsoNormal><span lang=EN-US>You might wonder what’s necessary for an
object to be recovered from its serialized state. For example, suppose you
serialize an object and send it as a file or through a network to another
machine. Could a program on the other machine reconstruct the object using only
the contents of the file?</span></p>

<p class=MsoNormal><span lang=EN-US>The best way to answer this question is (as
usual) by performing an experiment. The following file goes in the subdirectory
for this chapter:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:Alien.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A serializable class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Alien
implements Serializable {</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The file that creates and serializes an <b>Alien
</b>object goes in the same directory:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:FreezeAlien.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Create a serialized
output file.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class FreezeAlien
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Throw exceptions to
console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectOutput out = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileOutputStream(&quot;X.file&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Alien zorcon = new
Alien();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.writeObject(zorcon); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Rather than catching and handling
exceptions, this program takes the quick and dirty approach of passing the
exceptions out of <b>main(&nbsp;)</b>, so they’ll be reported on the command
line.</span></p>

<p class=MsoNormal><span lang=EN-US>Once the program is compiled and run, copy
the resulting <b>X.file</b> to a subdirectory called <b>xfiles</b>, where the
following code goes:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c11:xfiles:ThawAlien.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Try to recover a
serialized file without the </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// class of object
that's stored in that file.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ThawAlien {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException,
ClassNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectInputStream in
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileInputStream(&quot;X.file&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object mystery =
in.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(mystery.getClass());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This program opens the file and reads in
the object <b>mystery</b> successfully. However, as soon as you try to find out
anything about the object—which requires the <b>Class</b> object for <b>Alien</b>—the
Java Virtual Machine (JVM) cannot find <b>Alien.class</b> (unless it happens to
be in the Classpath, which it shouldn’t be in this example). You’ll get a <b>ClassNotFoundException.</b>
(Once again, all evidence of alien life vanishes before proof of its existence
can be verified!)</span></p>

<p class=MsoNormal><span lang=EN-US>If you expect to do much after you’ve
recovered an object that has been serialized, you must make sure that the JVM
can find the associated <b>.class</b> file either in the local class path or
somewhere on the Internet.</span></p>

<h3><a name="_Toc481064764"><span lang=EN-US>Controlling serialization</span></a></h3>

<p class=MsoNormal><span lang=EN-US>As you can see, the default serialization mechanism is trivial to
use. But what if you have special needs? Perhaps you have special security
issues and you don’t want to serialize portions of your object, or perhaps it
just doesn’t make sense for one subobject to be serialized if that part needs
to be created anew when the object is recovered.</span></p>

<p class=MsoNormal><span lang=EN-US>You can control the process of
serialization by implementing the </span><span lang=EN-US><b>Externalizable</b> interface instead of the </span><span lang=EN-US><b>Serializable</b> interface. The <b>Externalizable</b> interface
extends the <b>Serializable</b> interface and adds two methods, </span><span lang=EN-US><b>writeExternal(&nbsp;)</b> and </span><span lang=EN-US><b>readExternal(&nbsp;),</b> that are automatically called for your
object during serialization and deserialization so that you can perform your
special operations.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example shows simple
implementations of the <b>Externalizable</b> interface methods. Note that <b>Blip1</b>
and <b>Blip2</b> are nearly identical except for a subtle difference (see if
you can discover it by looking at the code):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:Blips.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Simple use of
Externalizable &amp; a pitfall.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Blip1 implements
Externalizable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Blip1() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Blip1 Constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
writeExternal(ObjectOutput out)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws IOException
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Blip1.writeExternal&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
readExternal(ObjectInput in)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     throws IOException,
ClassNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Blip1.readExternal&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Blip2 implements
Externalizable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Blip2() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Blip2 Constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
writeExternal(ObjectOutput out)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws IOException
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Blip2.writeExternal&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
readExternal(ObjectInput in)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     throws IOException,
ClassNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Blip2.readExternal&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Blips {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Throw exceptions to
console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException,
ClassNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Constructing objects:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Blip1 b1 = new
Blip1();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Blip2 b2 = new
Blip2();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectOutputStream o
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileOutputStream(&quot;Blips.out&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Saving objects:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o.writeObject(b1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o.writeObject(b2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Now get them
back:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectInputStream in
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileInputStream(&quot;Blips.out&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Recovering b1:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b1 =
(Blip1)in.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // OOPS! Throws an
exception:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//!
System.out.println(&quot;Recovering b2:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//! b2 =
(Blip2)in.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output for this program is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Constructing objects:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Blip1 Constructor</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Blip2 Constructor</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Saving objects:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Blip1.writeExternal</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Blip2.writeExternal</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Recovering b1:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Blip1 Constructor</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Blip1.readExternal</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The reason that the <b>Blip2</b> object is
not recovered is that trying to do so causes an exception. Can you see the
difference between <b>Blip1</b> and <b>Blip2</b>? The constructor for <b>Blip1</b>
is <b>public</b>, while the constructor for <b>Blip2</b> is not, and that
causes the exception upon recovery. Try making <b>Blip2</b>’s constructor <b>public
</b>and removing the <b>//! </b>comments to see the correct results.</span></p>

<p class=MsoNormal><span lang=EN-US>When <b>b1</b> is recovered, the <b>Blip1</b>
default constructor is called. This is different from recovering a <b>Serializable</b>
object, in which the object is constructed entirely from its stored bits, with
no constructor calls. With an <b>Externalizable</b> object, all the normal
default construction behavior occurs (including the initializations at the
point of field definition), and <i>then</i> <b>readExternal(&nbsp;)</b> is
called. You need to be aware of this—in particular, the fact that all the
default construction always takes place—to produce the correct behavior in your
<b>Externalizable</b> objects.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example that shows what you must
do to fully store and retrieve an <b>Externalizable</b> object:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:Blip3.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Reconstructing an
externalizable object.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Blip3 implements
Externalizable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String s; // No
initialization</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Blip3() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Blip3 Constructor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // s, i not
initialized</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Blip3(String x,
int a) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Blip3(String x, int a)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s = x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i = a;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // s &amp; i
initialized only in nondefault</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // constructor.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { return s + i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
writeExternal(ObjectOutput out)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Blip3.writeExternal&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // You must do this:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.writeObject(s); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.writeInt(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
readExternal(ObjectInput in)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException,
ClassNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Blip3.readExternal&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // You must do this:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s =
(String)in.readObject(); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i =in.readInt();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException,
ClassNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Constructing objects:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Blip3 b3 = new
Blip3(&quot;A String &quot;, 47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(b3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectOutputStream o
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileOutputStream(&quot;Blip3.out&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Saving object:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o.writeObject(b3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Now get it back:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectInputStream in
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileInputStream(&quot;Blip3.out&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Recovering b3:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b3 =
(Blip3)in.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(b3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The fields <b>s</b> and <b>i </b>are
initialized only in the second constructor, but not in the default constructor.
This means that if you don’t initialize <b>s</b> and <b>i </b>in <b>readExternal(&nbsp;)</b>,
it will be <b>null</b> (since the storage for the object gets wiped to zero in
the first step of object creation). If you comment out the two lines of code
following the phrases “You must do this” and run the program, you’ll see that
when the object is recovered, <b>s</b> is <b>null</b> and <b>i</b> is zero.</span></p>

<p class=MsoNormal><span lang=EN-US>If you are inheriting from an <b>Externalizable</b>
object, you’ll typically call the base-class versions of <b>writeExternal(&nbsp;)
</b>and <b>readExternal(&nbsp;)</b> to provide proper storage and retrieval of
the base-class components.</span></p>

<p class=MsoNormal><span lang=EN-US>So to make things work correctly you must
not only write the important data from the object during the <b>writeExternal(&nbsp;)
</b>method (there is no default behavior that writes any of the member objects
for an <b>Externalizable</b> object), but you must also recover that data in
the <b>readExternal(&nbsp;)</b> method. This can be a bit confusing at first
because the default construction behavior for an <b>Externalizable</b> object
can make it seem like some kind of storage and retrieval takes place
automatically. It does not.</span></p>

<h4><span lang=EN-US>The transient keyword</span></h4>

<p class=MsoNormal><span lang=EN-US>When you’re controlling serialization,
there might be a particular subobject that you don’t want Java’s serialization
mechanism to automatically save and restore. This is commonly the case if that
subobject represents sensitive information that you don’t want to serialize,
such as a password. Even if that information is <b>private </b>in the object,
once it’s serialized it’s possible for someone to access it by reading a file
or intercepting a network transmission.</span></p>

<p class=MsoNormal><span lang=EN-US>One way to prevent sensitive parts of your
object from being serialized is to implement your class as <b>Externalizable</b>,
as shown previously. Then nothing is automatically serialized and you can
explicitly serialize only the necessary parts inside <b>writeExternal(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>If you’re working with a <b>Serializable </b>object,
however, all serialization happens automatically. To control this, you can turn
off serialization on a field-by-field basis using the </span><span lang=EN-US><b>transient</b> keyword, which says “Don’t bother saving or
restoring this—I’ll take care of it.”</span></p>

<p class=MsoNormal><span lang=EN-US>For example, consider a <b>Login </b>object
that keeps information about a particular login session. Suppose that, once you
verify the login, you want to store the data, but without the password. The
easiest way to do this is by implementing </span><span
lang=EN-US><b>Serializable</b> and marking the <b>password</b> field as <b>transient</b>.
Here’s what it looks like:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:Logon.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates the
&quot;transient&quot; keyword.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Logon implements
Serializable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Date date =
new Date();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private String
username;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private transient
String password;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Logon(String name,
String pwd) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    username = name;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    password = pwd;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String pwd =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (password == null)
? &quot;(n/a)&quot; : password;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return &quot;logon
info: \n   &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;username:
&quot; + username +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;\n   date:
&quot; + date +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;\n  
password: &quot; + pwd;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException,
ClassNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Logon a = new
Logon(&quot;Hulk&quot;, &quot;myLittlePony&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(
&quot;logon a = &quot; + a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ObjectOutputStream
o =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new ObjectOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
FileOutputStream(&quot;Logon.out&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o.writeObject(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Delay:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int seconds = 5;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long t =
System.currentTimeMillis()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           + seconds *
1000;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
while(System.currentTimeMillis() &lt; t)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Now get them
back:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectInputStream in
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
FileInputStream(&quot;Logon.out&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Recovering
object at &quot; + new Date());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a =
(Logon)in.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(
&quot;logon a = &quot; + a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the <b>date</b> and <b>username</b>
fields are ordinary (not <b>transient</b>), and thus are automatically
serialized. However, the <b>password</b> is <b>transient</b>, and so is not
stored to disk; also the serialization mechanism makes no attempt to recover
it. The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>logon a = logon info:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   username: Hulk</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   date: Sun Mar 23
18:25:53 PST 1997</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   password:
myLittlePony</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Recovering object at Sun
Mar 23 18:25:59 PST 1997</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>logon a = logon info:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   username: Hulk</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   date: Sun Mar 23
18:25:53 PST 1997</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>   password: (n/a)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When the object is recovered, the <b>password</b>
field is <b>null</b>. Note that <b>toString(&nbsp;)</b> must check for a <b>null</b>
value of <b>password </b>because if you try to assemble a <b>String</b> object
using the overloaded ‘<b>+</b>’ operator, and that operator encounters a <b>null
</b>reference, you’ll get a <b>NullPointerException.</b> (Newer versions of
Java might contain code to avoid this problem.)</span></p>

<p class=MsoNormal><span lang=EN-US>You can also see that the <b>date</b> field
is stored to and recovered from disk and not generated anew.</span></p>

<p class=MsoNormal><span lang=EN-US>Since <b>Externalizable</b> objects do not
store any of their fields by default, the <b>transient</b> keyword is for use
with <b>Serializable</b> objects only.</span></p>

<h4><span lang=EN-US>An alternative to <b>Externalizable</b></span></h4>

<p class=MsoNormal><span lang=EN-US>If you’re not keen on implementing the </span><span lang=EN-US><b>Externalizable </b>interface, there’s another approach. You can
implement the <b>Serializable</b> interface and <i>add </i>(notice I say “add”
and not “override” or “implement”) methods called </span><span lang=EN-US><b>writeObject(&nbsp;)</b> and </span><span lang=EN-US><b>readObject(&nbsp;)</b> that will automatically be called when the
object is serialized and deserialized, respectively. That is, if you provide
these two methods they will be used instead of the default serialization.</span></p>

<p class=MsoNormal><span lang=EN-US>The methods must have these exact
signatures:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>private void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
writeObject(ObjectOutputStream stream)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throws IOException;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>private void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
readObject(ObjectInputStream stream)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>    throws
IOException, ClassNotFoundException</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>From a design standpoint, things get really
weird here. First of all, you might think that because these methods are not
part of a base class or the <b>Serializable</b> interface, they ought to be
defined in their own interface(s). But notice that they are defined as <b>private</b>,
which means they are to be called only by other members of this class. However,
you don’t actually call them from other members of this class, but instead the <b>writeObject(&nbsp;)</b>
and <b>readObject(&nbsp;)</b> methods of the <b>ObjectOutputStream</b> and <b>ObjectInputStream</b>
objects call your object’s <b>writeObject(&nbsp;)</b> and <b>readObject(&nbsp;)</b>
methods. (Notice my tremendous restraint in not launching into a long diatribe
about using the same method names here. In a word: confusing.) You might wonder
how the <b>ObjectOutputStream</b> and <b>ObjectInputStream</b> objects have
access to <b>private</b> methods of your class. We can only assume that this is
part of the serialization magic.</span></p>

<p class=MsoNormal><span lang=EN-US>In any event, anything defined in an <b>interface</b>
is automatically <b>public</b> so if <b>writeObject(&nbsp;)</b> and <b>readObject(&nbsp;)</b>
must be <b>private</b>, then they can’t be part of an <b>interface</b>. Since
you must follow the signatures exactly, the effect is the same as if you’re
implementing an <b>interface</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>It would appear that when you call <b>ObjectOutputStream.writeObject(&nbsp;)</b>,
the <b>Serializable</b> object that you pass it to is interrogated (using
reflection, no doubt) to see if it implements its own <b>writeObject(&nbsp;)</b>.
If so, the normal serialization process is skipped and the <b>writeObject(&nbsp;)</b>
is called. The same sort of situation exists for <b>readObject(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>There’s one other twist. Inside your <b>writeObject(&nbsp;)</b>,
you can choose to perform the default <b>writeObject(&nbsp;)</b> action by
calling <b>defaultWriteObject(&nbsp;)</b>. Likewise, inside <b>readObject(&nbsp;)</b>
you can call <b>defaultReadObject(&nbsp;)</b>. Here is a simple example that
demonstrates how you can control the storage and retrieval of a <b>Serializable</b>
object:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:SerialCtl.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Controlling
serialization by adding your own</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// writeObject() and
readObject() methods.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class SerialCtl
implements Serializable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String a;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  transient String b;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
SerialCtl(String aa, String bb) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    a = &quot;Not
Transient: &quot; + aa;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b = &quot;Transient:
&quot; + bb;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return a +
&quot;\n&quot; + b;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
writeObject(ObjectOutputStream stream)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws IOException
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
stream.defaultWriteObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
stream.writeObject(b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
readObject(ObjectInputStream stream)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws
IOException, ClassNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
stream.defaultReadObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b =
(String)stream.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException,
ClassNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    SerialCtl sc = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
SerialCtl(&quot;Test1&quot;, &quot;Test2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Before:\n&quot; + sc);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
ByteArrayOutputStream buf = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ByteArrayOutputStream();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectOutputStream o
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectOutputStream(buf);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o.writeObject(sc);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Now get it back:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectInputStream in
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
ByteArrayInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
buf.toByteArray()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    SerialCtl sc2 =
(SerialCtl)in.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;After:\n&quot; + sc2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In this example, one <b>String</b> field is
ordinary and the other is <b>transient</b>, to prove that the non-<b>transient</b>
field is saved by the </span><span lang=EN-US><b>defaultWriteObject(&nbsp;)</b> method and the <b>transient</b>
field is saved and restored explicitly. The fields are initialized inside the
constructor rather than at the point of definition to prove that they are not
being initialized by some automatic mechanism during deserialization.</span></p>

<p class=MsoNormal><span lang=EN-US>If you are going to use the default
mechanism to write the non-<b>transient</b> parts of your object, you must call
<b>defaultWriteObject(&nbsp;)</b> as the first operation in <b>writeObject(&nbsp;)</b>
and </span><span
lang=EN-US><b>defaultReadObject(&nbsp;)</b> as the first operation in <b>readObject(&nbsp;)</b>.
These are strange method calls. It would appear, for example, that you are
calling <b>defaultWriteObject(&nbsp;)</b> for an <b>ObjectOutputStream</b> and
passing it no arguments, and yet it somehow turns around and knows the
reference to your object and how to write all the non-<b>transient</b> parts.
Spooky.</span></p>

<p class=MsoNormal><span lang=EN-US>The storage and retrieval of the <b>transient</b>
objects uses more familiar code. And yet, think about what happens here. In <b>main(&nbsp;)</b>,
a <b>SerialCtl</b> object is created, and then it’s serialized to an <b>ObjectOutputStream.</b>
(Notice in this case that a buffer is used instead of a file—it’s all the same
to the <b>ObjectOutputStream</b>.) The serialization occurs in the line:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>o.writeObject(sc);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>writeObject(&nbsp;)</b> method must
be examining <b>sc</b> to see if it has its own <b>writeObject(&nbsp;)</b>
method. (Not by checking the interface—there isn’t one—or the class type, but
by actually hunting for the method using reflection.) If it does, it uses that.
A similar approach holds true for <b>readObject(&nbsp;)</b>. Perhaps this was
the only practical way that they could solve the problem, but it’s certainly
strange.</span></p>

<h4><span lang=EN-US>Versioning</span></h4>

<p class=MsoNormal><span lang=EN-US>It’s possible that you might want to change
the version of a serializable class (objects of the original class might be
stored in a database, for example). This is supported but you’ll probably do it
only in special cases, and it requires an extra depth of understanding that we
will not attempt to achieve here. The JDK HTML documents downloadable from <i>java.sun.com</i>
cover this topic quite thoroughly.</span></p>

<p class=MsoNormal><span lang=EN-US>You will also notice in the JDK HTML
documentation many comments that begin with:</span></p>

<p class=MsoNormal style='margin-left:36.0pt'><strong><i><span lang=EN-US>Warning:</span></i></strong><i><span
lang=EN-US> Serialized objects of this class will not be compatible with future
Swing releases. The current serialization support is appropriate for short term
storage or RMI between applications. …</span></i></p>

<p class=MsoNormal><span lang=EN-US>This is because the versioning mechanism is
too simple to work reliably in all situations, especially with JavaBeans.
They’re working on a correction for the design, and that’s what the warning is
about.</span></p>

<h3><a name="_Toc481064765"><span lang=EN-US>Using persistence</span></a></h3>

<p class=MsoNormal><span lang=EN-US>It’s quite appealing to use </span><span lang=EN-US>serialization technology to store some of the state of your program
so that you can easily restore the program to the current state later. But
before you can do this, some questions must be answered. What happens if you
serialize two objects that both have a reference to a third object? When you
restore those two objects from their serialized state, do you get only one
occurrence of the third object? What if you serialize your two objects to
separate files and deserialize them in different parts of your code?</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example that shows the problem:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:MyWorld.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class House implements
Serializable {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Animal implements
Serializable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String name;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  House preferredHouse;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Animal(String nm,
House h) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    name = nm; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    preferredHouse = h;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return name +
&quot;[&quot; + super.toString() + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;], &quot; +
preferredHouse + &quot;\n&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class MyWorld {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException,
ClassNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    House house = new
House();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList  animals =
new ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    animals.add(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Animal(&quot;Bosco the dog&quot;, house));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    animals.add(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Animal(&quot;Ralph the hamster&quot;, house));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    animals.add(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Animal(&quot;Fronk the cat&quot;, house));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;animals: &quot; + animals);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ByteArrayOutputStream
buf1 = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ByteArrayOutputStream();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectOutputStream
o1 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectOutputStream(buf1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
o1.writeObject(animals);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
o1.writeObject(animals); // Write a 2nd set</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Write to a
different stream:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
ByteArrayOutputStream buf2 = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ByteArrayOutputStream();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectOutputStream
o2 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectOutputStream(buf2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
o2.writeObject(animals);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Now get them
back:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectInputStream
in1 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
ByteArrayInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          buf1.toByteArray()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectInputStream
in2 =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
ByteArrayInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
buf2.toByteArray()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList animals1 =
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
(ArrayList)in1.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList animals2 =
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (ArrayList)in1.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList animals3 =
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
(ArrayList)in2.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;animals1: &quot; + animals1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;animals2: &quot; + animals2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;animals3: &quot; + animals3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>One thing that’s interesting here is that
it’s possible to use object serialization to and from a byte array as a way of
doing a “deep copy” of any object that’s <b>Serializable.</b> (A deep copy
means that you’re duplicating the entire web of objects, rather than just the
basic object and its references.) Copying is covered in depth in Appendix A.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Animal</span></b><span lang=EN-US>
objects contain fields of type <b>House</b>. In <b>main(&nbsp;)</b>, an <b>ArrayList</b>
of these <b>Animal</b>s is created and it is serialized twice to one stream and
then again to a separate stream. When these are deserialized and printed, you
see the following results for one run (the objects will be in different memory
locations each run):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>animals: [Bosco the
dog[Animal@1cc76c], House@1cc769</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, Ralph the
hamster[Animal@1cc76d], House@1cc769</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, Fronk the cat[Animal@1cc76e],
House@1cc769</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>animals1: [Bosco the
dog[Animal@1cca0c], House@1cca16</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, Ralph the
hamster[Animal@1cca17], House@1cca16</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, Fronk the
cat[Animal@1cca1b], House@1cca16</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>animals2: [Bosco the
dog[Animal@1cca0c], House@1cca16</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, Ralph the hamster[Animal@1cca17],
House@1cca16</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, Fronk the
cat[Animal@1cca1b], House@1cca16</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>animals3: [Bosco the
dog[Animal@1cca52], House@1cca5c</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, Ralph the
hamster[Animal@1cca5d], House@1cca5c</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, Fronk the
cat[Animal@1cca61], House@1cca5c</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Of course you expect that the deserialized
objects have different addresses from their originals. But notice that in <b>animals1</b>
and <b>animals2</b> the same addresses appear, including the references to the <b>House
</b>object that both share. On the other hand, when <b>animals3 </b>is
recovered the system has no way of knowing that the objects in this other
stream are aliases of the objects in the first stream, so it makes a completely
different web of objects.</span></p>

<p class=MsoNormal><span lang=EN-US>As long as you’re serializing everything to
a single stream, you’ll be able to recover the same web of objects that you
wrote, with no accidental duplication of objects. Of course, you can change the
state of your objects in between the time you write the first and the last, but
that’s your responsibility—the objects will be written in whatever state they
are in (and with whatever connections they have to other objects) at the time
you serialize them.</span></p>

<p class=MsoNormal><span lang=EN-US>The safest thing to do if you want to save
the state of a system is to serialize as an “atomic” operation. If you
serialize some things, do some other work, and serialize some more, etc., then
you will not be storing the system safely. Instead, put all the objects that
comprise the state of your system in a single container and simply write that
container out in one operation. Then you can restore it with a single method
call as well.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example is an imaginary
computer-aided design (CAD) system that demonstrates the approach. In addition,
it throws in the issue of <b>static</b> fields—if you look at the documentation
you’ll see that <b>Class</b> is <b>Serializable</b>, so it should be easy to
store the <b>static</b> fields by simply serializing the </span><span lang=EN-US><b>Class</b> object. That seems like a sensible approach, anyway.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:CADState.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Saving and restoring
the state of a </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// pretend CAD system.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>abstract class Shape
implements Serializable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static final
int </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    RED = 1, BLUE = 2,
GREEN = 3;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int xPos,
yPos, dimension;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static Random
r = new Random();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static int
counter = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  abstract public void
setColor(int newColor);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  abstract public int
getColor();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Shape(int xVal,
int yVal, int dim) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    xPos = xVal;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    yPos = yVal;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    dimension = dim;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return getClass() + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;
color[&quot; + getColor() +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;]
xPos[&quot; + xPos +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;]
yPos[&quot; + yPos +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;] dim[&quot;
+ dimension + &quot;]\n&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static Shape
randomFactory() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int xVal =
r.nextInt() % 100;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int yVal =
r.nextInt() % 100;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int dim = r.nextInt()
% 100;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    switch(counter++ %
3) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      default: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 0: return new
Circle(xVal, yVal, dim);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 1: return new
Square(xVal, yVal, dim);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      case 2: return new
Line(xVal, yVal, dim);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Circle extends
Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static int
color = RED;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Circle(int
xVal, int yVal, int dim) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(xVal, yVal,
dim);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setColor(int newColor) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    color = newColor;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int getColor()
{ </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return color;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Square extends
Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static int
color;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Square(int
xVal, int yVal, int dim) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(xVal, yVal,
dim);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    color = RED;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setColor(int newColor) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    color = newColor;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int getColor()
{ </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return color;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Line extends Shape
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static int
color = RED;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
serializeStaticState(ObjectOutputStream os)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws IOException
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    os.writeInt(color);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
deserializeStaticState(ObjectInputStream os)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws IOException
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    color =
os.readInt();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Line(int xVal,
int yVal, int dim) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(xVal, yVal,
dim);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setColor(int newColor) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    color = newColor;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int getColor()
{ </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return color;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class CADState {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList
shapeTypes, shapes;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length == 0)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      shapeTypes = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      shapes = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Add references
to the class objects:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      shapeTypes.add(Circle.class);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
shapeTypes.add(Square.class);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
shapeTypes.add(Line.class);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Make some
shapes:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
shapes.add(Shape.randomFactory());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Set all the
static colors to GREEN:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Shape)shapes.get(i))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
.setColor(Shape.GREEN);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Save the state
vector:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ObjectOutputStream
out =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
ObjectOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
FileOutputStream(&quot;CADState.out&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
out.writeObject(shapeTypes);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Line.serializeStaticState(out);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
out.writeObject(shapes);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } else { // There's
a command-line argument</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ObjectInputStream
in =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
ObjectInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
FileInputStream(args[0]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Read in the
same order they were written:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      shapeTypes =
(ArrayList)in.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Line.deserializeStaticState(in);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      shapes =
(ArrayList)in.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Display the
shapes:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(shapes);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Shape</b> class <b>implements </b></span><span lang=EN-US><b>Serializable</b>, so anything that is inherited from <b>Shape</b>
is automatically <b>Serializable</b> as well. Each <b>Shape</b> contains data,
and each derived <b>Shape</b> class contains a <b>static</b> field that
determines the color of all of those types of <b>Shape</b>s. (Placing a <b>static</b>
field in the base class would result in only one field, since <b>static</b>
fields are not duplicated in derived classes.) Methods in the base class can be
overridden to set the color for the various types (<b>static</b> methods are
not dynamically bound, so these are normal methods). The <b>randomFactory(&nbsp;)</b>
method creates a different <b>Shape</b> each time you call it, using random
values for the <b>Shape</b> data.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Circle</span></b><span lang=EN-US> and <b>Square</b>
are straightforward extensions of <b>Shape</b>; the only difference is that <b>Circle</b>
initializes <b>color</b> at the point of definition and <b>Square</b> initializes
it in the constructor. We’ll leave the discussion of <b>Line</b> for later.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>main(&nbsp;)</b>, one <b>ArrayList</b>
is used to hold the <b>Class</b> objects and the other to hold the shapes. If
you don’t provide a command line argument the <b>shapeTypes</b> <b>ArrayList</b>
is created and the <b>Class</b> objects are added, and then the <b>shapes</b> <b>ArrayList</b>
is created and <b>Shape</b> objects are added. Next, all the <b>static</b> <b>color</b>
values are set to <b>GREEN</b>, and everything is serialized to the file <b>CADState.out</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>If you provide a command line argument
(presumably <b>CADState.out</b>), that file is opened and used to restore the
state of the program. In both situations, the resulting <b>ArrayList</b> of <b>Shape</b>s
is printed. The results from one run are:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&gt;java CADState</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>[class Circle color[3] xPos[-51]
yPos[-99] dim[38]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Square color[3]
xPos[2] yPos[61] dim[-46]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Line color[3]
xPos[51] yPos[73] dim[64]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Circle color[3]
xPos[-70] yPos[1] dim[16]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Square color[3]
xPos[3] yPos[94] dim[-36]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Line color[3]
xPos[-84] yPos[-21] dim[-35]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Circle color[3]
xPos[-75] yPos[-43] dim[22]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Square color[3]
xPos[81] yPos[30] dim[-45]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Line color[3]
xPos[-29] yPos[92] dim[17]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Circle color[3]
xPos[17] yPos[90] dim[-76]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&gt;java CADState
CADState.out</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>[class Circle color[1]
xPos[-51] yPos[-99] dim[38]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Square color[0]
xPos[2] yPos[61] dim[-46]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Line color[3]
xPos[51] yPos[73] dim[64]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Circle color[1]
xPos[-70] yPos[1] dim[16]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Square color[0]
xPos[3] yPos[94] dim[-36]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Line color[3]
xPos[-84] yPos[-21] dim[-35]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Circle color[1]
xPos[-75] yPos[-43] dim[22]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Square color[0]
xPos[81] yPos[30] dim[-45]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Line color[3]
xPos[-29] yPos[92] dim[17]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>, class Circle color[1]
xPos[17] yPos[90] dim[-76]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the values of <b>xPos</b>,
<b>yPos,</b> and <b>dim</b> were all stored and recovered successfully, but
there’s something wrong with the retrieval of the <b>static</b> information.
It’s all “3” going in, but it doesn’t come out that way. <b>Circle</b>s have a
value of 1 (<b>RED</b>, which is the definition), and <b>Square</b>s have a
value of 0 (remember, they are initialized in the constructor). It’s as if the <b>static</b>s
didn’t get serialized at all! That’s right—even though class <b>Class</b> is <b>Serializable</b>,
it doesn’t do what you expect. So if you want to serialize <b>statics</b>, you
must do it yourself.</span></p>

<p class=MsoNormal><span lang=EN-US>This is what the <b>serializeStaticState(&nbsp;)
</b>and <b>deserializeStaticState(&nbsp;)</b> <b>static </b>methods in <b>Line</b>
are for. You can see that they are explicitly called as part of the storage and
retrieval process. (Note that the order of writing to the serialize file and
reading back from it must be maintained.) Thus to make <b>CADState.java</b> run
correctly you must:</span></p>

<p class=Numbered><span lang=EN-US>Add a <b>serializeStaticState(&nbsp;)</b>
and <b>deserializeStaticState(&nbsp;)</b> to the shapes.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>81.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Remove the <b>ArrayList</b> <b>shapeTypes</b> and all code related
to it.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>82.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Add calls to the new serialize and deserialize static methods in the
shapes.</span></p>

<p class=MsoNormal><span lang=EN-US>Another issue you might have to think about
is security, since serialization also saves <b>private</b> data. If you have a
security issue, those fields should be marked as <b>transient</b>. But then you
have to design a secure way to store that information so that when you do a
restore you can reset those <b>private</b> variables. </span></p>

<h2><a name="_Toc481064766"><span lang=EN-US>Tokenizing input</span></a></h2>

<p class=MsoNormal><span lang=EN-US> <i>Tokenizing </i>is the process of
breaking a sequence of characters into a sequence of “tokens,” which are bits
of text delimited by whatever you choose. For example, your tokens could be
words, and then they would be delimited by white space and punctuation. There
are two classes provided in the standard Java library that can be used for
tokenization: <b>StreamTokenizer</b> and <b>StringTokenizer</b>.</span></p>

<h3><a name="_Toc481064767"></a><a name="_Toc375545398"><b><span lang=EN-US>StreamTokenizer</span></b></a></h3>

<p class=MsoNormal><span lang=EN-US>Although <b>StreamTokenizer</b> is not
derived from <b>InputStream</b> or <b>OutputStream</b>, it works only with <b>InputStream</b>
objects, so it rightfully belongs in the I/O portion of the library.</span></p>

<p class=MsoNormal><span lang=EN-US>Consider a program to count the occurrence
of words in a text file:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c11:WordCount.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Counts words from a
file, outputs</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// results in sorted
form.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Counter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i = 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int read() { return i;
}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void increment() {
i++; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class WordCount {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private FileReader
file;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private
StreamTokenizer st;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // A TreeMap keeps
keys in sorted order:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private TreeMap counts
= new TreeMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  WordCount(String
filename)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throws
FileNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      file = new
FileReader(filename);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      st = new
StreamTokenizer(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedReader(file));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
st.ordinaryChar('.');</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
st.ordinaryChar('-');</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(FileNotFoundException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Could not
open &quot; + filename);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void cleanup() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      file.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(IOException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
&quot;file.close() unsuccessful&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void countWords() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
while(st.nextToken() !=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
StreamTokenizer.TT_EOF) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        switch(st.ttype)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          case
StreamTokenizer.TT_EOL:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            s = new
String(&quot;EOL&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          case
StreamTokenizer.TT_NUMBER:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            s =
Double.toString(st.nval);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          case
StreamTokenizer.TT_WORD:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            s = st.sval;
// Already a String</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          default: //
single character in ttype</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            s =
String.valueOf((char)st.ttype);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
if(counts.containsKey(s))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
((Counter)counts.get(s)).increment();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          counts.put(s,
new Counter());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(IOException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;st.nextToken()
unsuccessful&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Collection values() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
counts.values();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Set keySet() { return
counts.keySet(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Counter
getCounter(String s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
(Counter)counts.get(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws
FileNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    WordCount wc =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
WordCount(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    wc.countWords();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator keys =
wc.keySet().iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
while(keys.hasNext()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String key =
(String)keys.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(key + &quot;: &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>               +
wc.getCounter(key).read());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    wc.cleanup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Presenting the words in sorted form is easy
to do by storing the data in a <b>TreeMap</b>, which automatically organizes<b>
</b>its keys in sorted order (see Chapter 9). When you get a set of keys using <b>keySet(&nbsp;)</b>,
they will also be in sorted order.</span></p>

<p class=MsoNormal><span lang=EN-US>To open the file, a <b>FileReader</b> is
used, and to turn the file into words a <b>StreamTokenizer</b> is created from
the <b>FileReader</b> wrapped in a <b>BufferedReader</b>. In <b>StreamTokenizer</b>,
there is a default list of separators, and you can add more with a set of
methods. Here, <b>ordinaryChar(&nbsp;)</b> is used to say “This character has
no significance that I’m interested in,” so the parser doesn’t include it as
part of any of the words that it creates. For example, saying <b>st.ordinaryChar('.')</b>
means that periods will not be included as parts of the words that are parsed.
You can find more information in the JDK HTML documentation from <i>java.sun.com</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>countWords(&nbsp;)</b>, the tokens
are pulled one at a time from the stream, and the <b>ttype</b> information is
used to determine what to do with each token, since a token can be an
end-of-line, a number, a string, or a single character.</span></p>

<p class=MsoNormal><span lang=EN-US>Once a token is found, the </span><b><span lang=EN-US>TreeMap</span></b><b><span lang=EN-US> counts</span></b><span
lang=EN-US> is queried to see if it already contains the token as a key. If it
does, the corresponding <b>Counter</b> object is incremented to indicate that
another instance of this word has been found. If not, a new <b>Counter</b> is
created—since the <b>Counter</b> constructor initializes its value to one, this
also acts to count the word.</span></p>

<p class=MsoNormal><b><span lang=EN-US>WordCount</span></b><span lang=EN-US> is
not a type of <b>TreeMap</b>, so it wasn’t inherited. It performs a specific
type of functionality, so even though the <b>keys(&nbsp;)</b> and <b>values(&nbsp;)</b>
methods must be reexposed, that still doesn’t mean that </span><span lang=EN-US>inheritance should be used since a number of <b>TreeMap</b> methods
are inappropriate here. In addition, other methods like <b>getCounter(&nbsp;)</b>,
which get the <b>Counter</b> for a particular <b>String</b>, and <b>sortedKeys(&nbsp;)</b>,
which produces an <b>Iterator</b>, finish the change in the shape of <b>WordCount</b>’s
interface.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>main(&nbsp;)</b> you can see the use
of a <b>WordCount</b> to open and count the words in a file—it just takes two
lines of code. Then an Iterator to a sorted list of keys (words) is extracted,
and this is used to pull out each key and associated <b>Count</b>. The call to <b>cleanup(&nbsp;)</b>
is necessary to ensure that the file is closed.</span></p>

<h3><a name="_Toc481064768"></a><a name="_Toc375545399"><b><span lang=EN-US>StringTokenizer</span></b></a></h3>

<p class=MsoNormal><span lang=EN-US>Although it isn’t part of the I/O library,
the <b>StringTokenizer</b> has sufficiently similar functionality to <b>StreamTokenizer</b>
that it will be described here.</span></p>

<p class=MsoNormal><span lang=EN-US>The </span><span
lang=EN-US><b>StringTokenizer</b> returns the tokens within a string one at a
time. These tokens are consecutive characters delimited by tabs, spaces, and
newlines. Thus, the tokens of the string “Where is my cat?” are “Where”, “is”,
“my”, and “cat?” Like the <b>StreamTokenizer</b>,<b> </b>you can tell the <b>StringTokenizer</b>
to break up the input in any way that you want, but with <b>StringTokenizer </b>you
do this by passing a second argument to the constructor, which is a <b>String </b>of
the delimiters you wish to use. In general, if you need more sophistication,
use a <b>StreamTokenizer</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>You ask a <b>StringTokenizer</b> object for
the next token in the string using the <b>nextToken(&nbsp;)</b> method, which
either returns the token or an empty string to indicate that no tokens remain. </span></p>

<p class=MsoNormal><span lang=EN-US>As an example, the following program
performs a limited analysis of a sentence, looking for key phrase sequences to
indicate whether happiness or sadness is implied. </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c11:AnalyzeSentence.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Look for particular
sequences in sentences.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
AnalyzeSentence {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    analyze(&quot;I am
happy about this&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    analyze(&quot;I am
not happy about this&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    analyze(&quot;I am
not! I am happy&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    analyze(&quot;I am
sad about this&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    analyze(&quot;I am
not sad about this&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    analyze(&quot;I am
not! I am sad&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    analyze(&quot;Are
you happy about this?&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    analyze(&quot;Are
you sad about this?&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    analyze(&quot;It's
you! I am happy&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    analyze(&quot;It's
you! I am sad&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static StringTokenizer
st;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void analyze(String
s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;\nnew
sentence &gt;&gt; &quot; + s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    boolean sad = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    st = new
StringTokenizer(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while
(st.hasMoreTokens()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String token =
next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Look until you
find one of the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // two starting
tokens:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(!token.equals(&quot;I&quot;)
&amp;&amp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        
!token.equals(&quot;Are&quot;))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        continue; // Top
of while loop</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(token.equals(&quot;I&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String tk2 =
next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
if(!tk2.equals(&quot;am&quot;)) // Must be after I</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          break; // Out
of while loop</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        else {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          String tk3 =
next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
if(tk3.equals(&quot;sad&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            sad = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            break; //
Out of while loop</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          if
(tk3.equals(&quot;not&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            String tk4 =
next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
if(tk4.equals(&quot;sad&quot;))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              break; //
Leave sad false</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
if(tk4.equals(&quot;happy&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              sad =
true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(token.equals(&quot;Are&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String tk2 =
next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
if(!tk2.equals(&quot;you&quot;))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          break; // Must
be after Are</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String tk3 =
next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
if(tk3.equals(&quot;sad&quot;))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          sad = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        break; // Out of
while loop</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(sad)
prt(&quot;Sad detected&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static String next() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(st.hasMoreTokens()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String s =
st.nextToken();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      prt(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
&quot;&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void prt(String
s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>For each string being analyzed, a <b>while</b>
loop is entered and tokens are pulled off the string. Notice the first <b>if</b>
statement, which says to <b>continue</b> (go back to the beginning of the loop
and start again) if the token is neither an “I” nor an “Are.” <span
style='display:none'> </span>This means that it will get tokens until an “I” or
an “Are” is found. You might think to use the <b>==</b> instead of the </span><span lang=EN-US><b>equals(&nbsp;)</b> method, but that won’t work correctly, since <b>==</b>
compares reference values while <b>equals(&nbsp;)</b> compares contents.</span></p>

<p class=MsoNormal><span lang=EN-US>The logic of the rest of the <b>analyze(&nbsp;)</b>
method is that the pattern that’s being searched for is “I am sad,” “I am not
happy,” or “Are you sad?” Without the <b>break</b> statement, the code for this
would be even messier than it is. You should be aware that a typical parser
(this is a primitive example of one) normally has a table of these tokens and a
piece of code that moves through the states in the table as new tokens are
read.</span></p>

<p class=MsoNormal><span lang=EN-US>You should think of the <b>StringTokenizer</b>
only as shorthand for a simple and specific kind of <b>StreamTokenizer</b>.
However, if you have a <b>String</b> that you want to tokenize and <b>StringTokenizer</b>
is too limited, all you have to do is turn it into a stream with <b>StringBufferInputStream</b>
and then use that to create a much more powerful <b>StreamTokenizer</b>.</span></p>

<h3><a name="_Toc481064769"></a><a name="_Toc375545504"><span lang=EN-US>Checking
capitalization style</span></a></h3>

<p class=MsoNormal><span lang=EN-US>In this section we’ll look at a more
complete example of the use of Java I/O, which also uses tokenization. </span><span
lang=EN-US>This project is directly useful because it performs a style check to
make sure that your capitalization conforms to the Java style as found at <i>java.sun.com/docs/codeconv/index.html</i>.
It opens each <b>.java</b> file in the current directory and extracts all the
class names and identifiers, then shows you if any of them don’t meet the Java
style.</span></p>

<p class=MsoNormal><span lang=EN-US>For the program to operate correctly, you
must first build a class name repository to hold all the class names in the
standard Java library. You do this by moving into all the source code
subdirectories for the standard Java library and running <b>ClassScanner</b> in
each subdirectory. Provide as arguments the name of the repository file (using
the same path and name each time) and the <b>-a</b> command-line option to
indicate that the class names should be added to the repository.</span></p>

<p class=MsoNormal><span lang=EN-US>To use the program to check your code, hand
it the path and name of the repository to use. It will check all the classes
and identifiers in the current directory and tell you which ones don’t follow
the typical Java capitalization style.</span></p>

<p class=MsoNormal><span lang=EN-US>You should be aware that the program isn’t
perfect; there are a few times when it will point out what it thinks is a
problem but on looking at the code you’ll see that nothing needs to be changed.
This is a little annoying, but it’s still much easier than trying to find all
these cases by staring at your code.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c11:ClassScanner.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Scans all files in
directory for classes</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// and identifiers, to
check capitalization.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Assumes properly
compiling code listings.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Doesn't do everything
right, but is a </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// useful aid.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MultiStringMap
extends HashMap {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void add(String
key, String value) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(!containsKey(key))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      put(key, new
ArrayList());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
((ArrayList)get(key)).add(value);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public ArrayList
getArrayList(String key) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(!containsKey(key)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;ERROR:
can't find key: &quot; + key);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.exit(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
(ArrayList)get(key);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
printValues(PrintStream p) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator k =
keySet().iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(k.hasNext()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String oneKey =
(String)k.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ArrayList val =
getArrayList(oneKey);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; val.size(); i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
p.println((String)val.get(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ClassScanner {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private File path;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private String[]
fileList;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Properties
classes = new Properties();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private MultiStringMap
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    classMap = new
MultiStringMap(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    identMap = new
MultiStringMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private
StreamTokenizer in;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public ClassScanner()
throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    path = new File(&quot;.&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fileList =
path.list(new JavaFilter());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; fileList.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(fileList[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
scanListing(fileList[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(FileNotFoundException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Could not open &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          fileList[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void
scanListing(String fname) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    in = new
StreamTokenizer(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
FileReader(fname)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Doesn't seem to
work:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // in.slashStarComments(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //
in.slashSlashComments(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
in.ordinaryChar('/');</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
in.ordinaryChar('.');</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    in.wordChars('_',
'_');</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
in.eolIsSignificant(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(in.nextToken()
!= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
StreamTokenizer.TT_EOF) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(in.ttype ==
'/')</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        eatComments();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else if(in.ttype
== </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>             
StreamTokenizer.TT_WORD) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
if(in.sval.equals(&quot;class&quot;) || </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          
in.sval.equals(&quot;interface&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // Get class
name:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            
while(in.nextToken() != </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>                   StreamTokenizer.TT_EOF</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>                  
&amp;&amp; in.ttype != </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>                  
StreamTokenizer.TT_WORD)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>               ;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            
classes.put(in.sval, in.sval);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            
classMap.add(fname, in.sval);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
if(in.sval.equals(&quot;import&quot;) ||</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           in.sval.equals(&quot;package&quot;))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          discardLine();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        else // It's an
identifier or keyword</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
identMap.add(fname, in.sval);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void discardLine()
throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(in.nextToken()
!= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          StreamTokenizer.TT_EOF</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &amp;&amp;
in.ttype != </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
StreamTokenizer.TT_EOL)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ; // Throw away
tokens to end of line</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // StreamTokenizer's
comment removal seemed</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // to be broken. This
extracts them:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void eatComments()
throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(in.nextToken() !=
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      
StreamTokenizer.TT_EOF) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(in.ttype ==
'/')</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        discardLine();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else if(in.ttype
!= '*')</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        in.pushBack();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
if(in.nextToken() == </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
StreamTokenizer.TT_EOF)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          if(in.ttype ==
'*')</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
if(in.nextToken() != </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>             
StreamTokenizer.TT_EOF</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              &amp;&amp;
in.ttype == '/')</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String[]
classNames() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] result =
new String[classes.size()];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator e =
classes.keySet().iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(e.hasNext())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      result[i++] =
(String)e.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return result;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
checkClassNames() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator files =
classMap.keySet().iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(files.hasNext())
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String file =
(String)files.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ArrayList cls =
classMap.getArrayList(file);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; cls.size(); i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String className
= (String)cls.get(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
if(Character.isLowerCase(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>             className.charAt(0)))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            &quot;class
capitalization error, file: &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            + file +
&quot;, class: &quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            +
className);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
checkIdentNames() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator files =
identMap.keySet().iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList reportSet
= new ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
while(files.hasNext()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String file =
(String)files.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ArrayList ids =
identMap.getArrayList(file);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; ids.size(); i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String id =
(String)ids.get(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
if(!classes.contains(id)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // Ignore
identifiers of length 3 or</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // longer that
are all uppercase</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // (probably
static final values):</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          if(id.length()
&gt;= 3 &amp;&amp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>             id.equals(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              
id.toUpperCase()))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            continue;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // Check to
see if first char is upper:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
if(Character.isUpperCase(id.charAt(0))){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
if(reportSet.indexOf(file + id)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>                == -1){
// Not reported yet</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>             
reportSet.add(file + id);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>             
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>               
&quot;Ident capitalization error in:&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>                + file +
&quot;, ident: &quot; + id);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static final String
usage =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Usage:
\n&quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;ClassScanner
classnames -a\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;\tAdds all the
class names in this \n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;\tdirectory to
the repository file \n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;\tcalled
'classnames'\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;ClassScanner
classnames\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;\tChecks all
the java files in this \n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;\tdirectory
for capitalization errors, \n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;\tusing the
repository file 'classnames'&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static void
usage() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.err.println(usage);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.exit(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &lt;
1 || args.length &gt; 2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      usage();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ClassScanner c = new
ClassScanner();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    File old = new
File(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(old.exists()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // Try to open
an existing </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // properties
file:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        InputStream
oldlist =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
BufferedInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            new
FileInputStream(old));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
c.classes.load(oldlist);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        oldlist.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(IOException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Could not open &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          + old + &quot;
for reading&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        System.exit(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length == 1)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
c.checkClassNames();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
c.checkIdentNames();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Write the class
names to a repository:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length == 2)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(!args[1].equals(&quot;-a&quot;))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        usage();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
BufferedOutputStream out =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
BufferedOutputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            new
FileOutputStream(args[0]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
c.classes.store(out,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot;Classes
found by ClassScanner.java&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        out.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(IOException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot;Could
not write &quot; + args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        System.exit(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class JavaFilter
implements FilenameFilter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean
accept(File dir, String name) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Strip path
information:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String f = new
File(name).getName();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
f.trim().endsWith(&quot;.java&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The class <b>MultiStringMap</b> is a tool that allows you to map a
group of strings onto each key entry. It uses a <b>HashMap</b> (this time with
inheritance) with the key as the single string that’s mapped onto the <b>ArrayList</b>
value. The <b>add(&nbsp;)</b> method simply checks to see if there’s a key already
in the <b>HashMap</b>, and if not it puts one there. The <b>getArrayList(&nbsp;)</b>
method produces an <b>ArrayList</b> for a particular key, and <b>printValues(&nbsp;)</b>,
which is primarily useful for debugging, prints out all the values <b>ArrayList</b>
by <b>ArrayList</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>To keep life simple, the class names from
the standard Java libraries are all put into a </span><span
lang=EN-US><b>Properties</b> object (from the standard Java library). Remember
that a <b>Properties</b> object is a <b>HashMap</b> that holds only<b> String</b>
objects for both the key and value entries. However, it can be saved to disk
and restored from disk in one method call, so it’s ideal for the repository of
names. Actually, we need only a list of names, and a <b>HashMap</b> can’t
accept <b>null</b> for either its key or its value entry. So the same object
will be used for both the key and the value.</span></p>

<p class=MsoNormal><span lang=EN-US>For the classes and identifiers that are
discovered for the files in a particular directory, two <b>MultiStringMap</b>s
are used: <b>classMap </b>and <b>identMap</b>. Also, when the program starts up
it loads the standard class name repository into the <b>Properties </b>object
called <b>classes</b>, and when a new class name is found in the local
directory that is also added to <b>classes </b>as well as to <b>classMap</b>.
This way, <b>classMap</b> can be used to step through all the classes in the
local directory, and <b>classes</b> can be used to see if the current token is
a class name (which indicates a definition of an object or method is beginning,
so grab the next tokens—until a semicolon—and put them into <b>identMap</b>).</span></p>

<p class=MsoNormal><span lang=EN-US>The default constructor for <b>ClassScanner</b>
creates a list of file names, using the <b>JavaFilter</b> implementation of </span><span lang=EN-US><b>FilenameFilter</b>, shown at the end of the file. Then it calls <b>scanListing(&nbsp;)</b>
for each file name.</span></p>

<p class=MsoNormal><span lang=EN-US>Inside <b>scanListing(&nbsp;)</b> the
source code file is opened and turned into a </span><span lang=EN-US><b>StreamTokenizer</b>. In the documentation, passing <b>true </b>to <b>slashStarComments(&nbsp;)</b>
and <b>slashSlashComments(&nbsp;)</b> is supposed to strip those comments out,
but this seems to be a bit flawed, as it doesn’t quite work. Instead, those
lines are commented out and the comments are extracted by another method. To do
this, the “<b>/</b>” must be captured as an ordinary character rather than
letting the <b>StreamTokenizer</b> absorb it as part of a comment, and the <b>ordinaryChar(&nbsp;)</b>
method tells the <b>StreamTokenizer </b>to<b> </b>do this. This is also true
for dots (“<b>.</b>”), since we want to have the method calls pulled apart into
individual identifiers. However, the underscore, which is ordinarily treated by
<b>StreamTokenizer</b> as an individual character, should be left as part of
identifiers since it appears in such <b>static</b> <b>final</b> values as <b>TT_EOF</b>,
etc., used in this very program. The <b>wordChars(&nbsp;) </b>method takes a
range of characters you want to add to those that are left inside a token that
is being parsed as a word. Finally, when parsing for one-line comments or
discarding a line we need to know when an end-of-line occurs, so by calling <b>eolIsSignificant(true)</b>
the EOL will show up rather than being absorbed by the <b>StreamTokenizer</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The rest of <b>scanListing(&nbsp;)</b>
reads and reacts to tokens until the end of the file, signified when <b>nextToken(&nbsp;)</b>
returns the <b>final static </b>value <b>StreamTokenizer.TT_EOF</b>. </span></p>

<p class=MsoNormal><span lang=EN-US>If the token is a “/” it is potentially a
comment, so <b>eatComments(&nbsp;)</b> is called to deal with it. The only
other situation we’re interested in here is if it’s a word, of which there are
some special cases.</span></p>

<p class=MsoNormal><span lang=EN-US>If the word is <b>class</b> or <b>interface</b>
then the next token represents a class or interface name, and it is put into <b>classes</b>
and <b>classMap</b>. If the word is <b>import</b> or <b>package</b>, then we
don’t want the rest of the line. Anything else must be an identifier (which
we’re interested in) or a keyword (which we’re not, but they’re all lowercase
anyway so it won’t spoil things to put those in). These are added to <b>identMap</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>discardLine(&nbsp;)</b> method is a
simple tool that looks for the end of a line. Note that any time you get a new
token, you must check for the end of the file.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>eatComments(&nbsp;)</b> method is
called whenever a forward slash is encountered in the main parsing loop.
However, that doesn’t necessarily mean a comment has been found, so the next
token must be extracted to see if it’s another forward slash (in which case the
line is discarded) or an asterisk. But if it’s neither of those, it means the
token you’ve just pulled out is needed back in the main parsing loop!
Fortunately, the </span><span lang=EN-US><b>pushBack(&nbsp;)</b> method allows
you to “push back” the current token onto the input stream so that when the
main parsing loop calls </span><span lang=EN-US><b>nextToken(&nbsp;)</b> it will get the one you just pushed back.</span></p>

<p class=MsoNormal><span lang=EN-US>For convenience, the <b>classNames(&nbsp;)</b>
method produces an array of all the names in the <b>classes</b> container. This
method is not used in the program but is helpful for debugging.</span></p>

<p class=MsoNormal><span lang=EN-US>The next two methods are the ones in which
the actual checking takes place. In <b>checkClassNames(&nbsp;)</b>, the class
names are extracted from the <b>classMap</b> (which, remember, contains only
the names in this directory, organized by file name so the file name can be
printed along with the errant class name). This is accomplished by pulling each
associated <b>ArrayList</b> and stepping through that, looking to see if the
first character is lowercase. If so, the appropriate error message is printed.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>checkIdentNames(&nbsp;)</b>, a
similar approach is taken: each identifier name is extracted from <b>identMap</b>.
If the name is not in the <b>classes</b> list, it’s assumed to be an identifier
or keyword. A special case is checked: if the identifier length is three or
more <i>and</i> all the characters are uppercase, this identifier is ignored because
it’s probably a <b>static</b> <b>final</b> value such as <b>TT_EOF</b>. Of
course, this is not a perfect algorithm, but it assumes that you’ll eventually
notice any all-uppercase identifiers that are out of place.</span></p>

<p class=MsoNormal><span lang=EN-US>Instead of reporting every identifier that
starts with an uppercase character, this method keeps track of which ones have
already been reported in an <b>ArrayList</b> called <b>reportSet(&nbsp;)</b>.
This treats the <b>ArrayList</b> as a “set” that tells you whether an item is
already in the set. The item is produced by concatenating the file name and
identifier. If the element isn’t in the set, it’s added and then the report is
made.</span></p>

<p class=MsoNormal><span lang=EN-US>The rest of the listing is comprised of <b>main(&nbsp;)</b>,
which busies itself by handling the command line arguments and figuring out
whether you’re building a repository of class names from the standard Java
library or checking the validity of code you’ve written. In both cases it makes
a <b>ClassScanner</b> object.</span></p>

<p class=MsoNormal><span lang=EN-US>Whether you’re building a repository or
using one, you must try to open the existing repository. By making a </span><span lang=EN-US><b>File</b> object and testing for existence, you can decide whether
to open the file and <b>load(&nbsp;)</b> the <b>Properties</b> list <b>classes</b>
inside <b>ClassScanner</b>. (The classes from the repository add to, rather
than overwrite, the classes found by the <b>ClassScanner</b> constructor.) If
you provide only one command-line argument it means that you want to perform a
check of the class names and identifier names, but if you provide two arguments
(the second being “<b>-a</b>”)<b> </b>you’re building a class name repository.
In this case, an output file is opened and the method <b>Properties.save(&nbsp;)</b>
is used to write the list into a file, along with a string that provides header
file information.</span></p>

<h2><a name="_Toc481064770"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The Java I/O stream library does satisfy
the basic requirements: you can perform reading and writing with the console, a
file, a block of memory, or even across the Internet (as you will see in
Chapter 15). With inheritance, you can create new types of input and output
objects. And you can even add a simple extensibility to the kinds of objects a
stream will accept by redefining the <b>toString(&nbsp;)</b> method that’s
automatically called when you pass an object to a method that’s expecting a <b>String</b>
(Java’s limited “automatic type conversion”). </span></p>

<p class=MsoNormal><span lang=EN-US>There are questions left unanswered by the
documentation and design of the I/O stream library. For example, it would have
been nice if you could say that you want an exception thrown if you try to
overwrite a file when opening it for output—some programming systems allow you
to specify that you want to open an output file, but only if it doesn’t already
exist. In Java, it appears that you are supposed to use a <b>File</b> object to
determine whether a file exists, because if you open it as a <b>FileOutputStream</b>
or <b>FileWriter </b>it will always get overwritten.</span></p>

<p class=MsoNormal><span lang=EN-US>The I/O stream library brings up mixed
feelings; it does much of the job and it’s portable. But if you don’t already
understand the decorator pattern, the design is nonintuitive, so there’s extra
overhead in learning and teaching it. It’s also incomplete: there’s no support
for the kind of output formatting that almost every other language’s I/O
package supports. </span></p>

<p class=MsoNormal><span lang=EN-US>However, once you <i>do</i> understand the
decorator pattern and begin using the library in situations that require its
flexibility, you can begin to benefit from this design, at which point its cost
in extra lines of code may not bother you as much.</span></p>

<p class=MsoNormal><span lang=EN-US>If you do not find what you’re looking for
in this chapter (which has only been an introduction, and is not meant to be
comprehensive), you can find in-depth coverage in <i>Java I/O</i>, by Elliotte
Rusty Harold (O’Reilly, 1999).</span></p>

<h2><a name="_Toc481064771"></a><a name="_Toc375545401"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Open a text file so that you can read the file
one line at a time. Read each line as a <b>String </b>and place that <b>String </b>object
into a <b>LinkedList</b>. Print all of the lines in the <b>LinkedList</b> in
reverse order.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>179. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 1 so that the name of the file
you read is provided as a command-line argument.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>180. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 2 to also open a text file so
you can write text into it. Write the lines in the <b>ArrayList</b>, along with
line numbers (do not attempt to use the “LineNumber” classes), out to the file.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>181. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 2 to force all the lines in the <b>ArrayList</b>
to upper case and send the results to <b>System.out</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>182. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 2 to take additional
command-line arguments of words to find in the file. Print any lines in which
the words match.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>183. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>DirList.java</b> so that the <b>FilenameFilter</b>
actually opens each file and accepts the file based on whether any of the
trailing arguments on the command line exist in that file.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>184. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class called <b>SortedDirList</b> with
a constructor that takes file path information and builds a sorted directory
list from the files at that path. Create two overloaded <b>list(&nbsp;) </b>methods
that will either produce the whole list or a subset of the list based on an
argument. Add a <b>size(&nbsp;)</b> method that takes a file name and produces
the size of that file.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>185. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>WordCount.java</b> so that it produces
an alphabetic sort instead, using the tool from Chapter 9.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>186. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>WordCount.java</b> so that it uses a
class containing a <b>String</b> and a count value to store each different
word, and a <b>Set</b> of these objects to maintain the list of words.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>187. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>IOStreamDemo.java</b> so that it uses <b>LineNumberInputStream</b>
to keep track of the line count. Note that it’s much easier to just keep track
programmatically.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>188. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Starting with section 4 of <b>IOStreamDemo.java</b>,
write a program that compares the performance of writing to a file when using
buffered and unbuffered I/O.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>189. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify section 5 of <b>IOStreamDemo.java</b> to
eliminate the spaces in the line produced by the first call to <b>in5br.readLine(&nbsp;)</b>.
Do this using a <b>while</b> loop and <b>readChar(&nbsp;)</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>190. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Repair the program <b>CADState.java</b> as
described in the text.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>191. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In <b>Blips.java</b>, copy the file and rename
it to <b>BlipCheck.java </b>and rename the class <b>Blip2</b> to <b>BlipCheck </b>(making
it <b>public</b> and removing the public scope from the class <b>Blips</b> in
the process). Remove the <b>//!</b> marks in the file and execute the program including
the offending lines. Next, comment out the default constructor for <b>BlipCheck</b>.
Run it and explain why it works. Note that after compiling, you must execute
the program with “<b>java Blips</b>” because the <b>main(&nbsp;)</b> method is
still in class <b>Blips</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>192. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In <b>Blip3.java</b>, comment out the two lines
after the phrases “You must do this:” and run the program. Explain the result
and why it differs from when the two lines are in the program.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>193. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>(Intermediate) In Chapter 8, locate the <b>GreenhouseControls.java</b>
example, which consists of three files. In <b>GreenhouseControls.java</b>, the <b>Restart(&nbsp;)</b>
inner class has a hard-coded set of events. Change the program so that it reads
the events and their relative times from a text file. (Challenging: Use a
design patterns <i>factory method </i>to build the events—see <i>Thinking in
Patterns with Java</i>, downloadable at <i>www.BruceEckel.com.</i>)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection18>

<h1><a name="_Toc481064772"></a><a name="_Toc477690732"></a><a
name="_Toc375545404"></a><a name="Chapter_11"></a><a name="Chapter_12"></a><span
lang=EN-US>12: Run-time Type Identification</span></h1>

<p class=Intro><span lang=EN-US>The idea of run-time type identification (RTTI)
seems fairly simple at first: it lets you find the exact type of an object when
you only have a reference to the base type. </span></p>

<p class=MsoNormal><span lang=EN-US>However, the <i>need</i> for RTTI uncovers
a whole plethora of interesting (and often perplexing) OO design issues, and
raises fundamental questions of how you should structure your programs. </span></p>

<p class=MsoNormal><span lang=EN-US>This chapter looks at the ways that Java
allows you to discover information about objects and classes at run-time. This
takes two forms: “traditional” RTTI, which assumes that you have all the types
available at compile-time and run-time, and the “reflection” mechanism, which
allows you to discover class information solely at run-time. The “traditional”
RTTI will be covered first, followed by a discussion of reflection.</span></p>

<h2><a name="_Toc481064773"></a><a name="_Toc375545405"><span lang=EN-US>The
need for RTTI</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Consider the now familiar example of a
class hierarchy that uses polymorphism. The generic type is the base class <b>Shape</b></span><span lang=EN-US>, and the specific derived types are <b>Circle</b>, <b>Square</b>,
and <b>Triangle</b>:</span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=286 height=143 src="TIJ2_files/image030.png"></span></p>

<p class=MsoNormal><span lang=EN-US>This is a typical class hierarchy diagram,
with the base class at the top and the derived classes growing downward. The
normal goal in object-oriented programming</span><span lang=EN-US> is for the bulk of your code to manipulate references to the base
type (<b>Shape</b>, in this case), so if you decide to extend the program by
adding a new class (<b>Rhomboid</b>, derived from <b>Shape</b>, for example),
the bulk of the code is not affected. In this example, the dynamically bound
method in the <b>Shape</b> interface is <b>draw(&nbsp;)</b>, so the intent is
for the client programmer to call <b>draw(&nbsp;)</b> through a generic <b>Shape</b>
reference. <b>draw(&nbsp;)</b> is overridden in all of the derived classes, and
because it is a dynamically bound method, the proper behavior will occur even
though it is called through a generic <b>Shape</b> reference. That’s </span><span lang=EN-US>polymorphism.</span></p>

<p class=MsoNormal><span lang=EN-US>Thus, you generally create a specific
object (<b>Circle</b>, <b>Square</b>, or <b>Triangle</b>), upcast it to a <b>Shape</b>
(forgetting the specific type of the object), and use that anonymous <b>Shape </b>reference
in the rest of the program.</span></p>

<p class=MsoNormal><span lang=EN-US>As a brief review of polymorphism and </span><span lang=EN-US>upcasting, you might code the above example as follows:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c12:Shapes.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void draw() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(this + &quot;.draw()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Circle extends
Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { return &quot;Circle&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Square extends
Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { return &quot;Square&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Triangle extends
Shape {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { return &quot;Triangle&quot;; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Shapes {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList s = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s.add(new Circle());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s.add(new Square());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s.add(new
Triangle());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator e =
s.iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(e.hasNext())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
((Shape)e.next()).draw();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The base class contains a <b>draw(&nbsp;)</b>
method that indirectly uses <b>toString(&nbsp;) </b>to print an identifier for
the class by passing <b>this</b> to <b>System.out.println(&nbsp;)</b>. If that
function sees an object, it automatically calls the <b>toString(&nbsp;)</b>
method to produce a <b>String</b> representation.</span></p>

<p class=MsoNormal><span lang=EN-US>Each of the derived classes overrides the <b>toString(&nbsp;)</b>
method (from <b>Object</b>) so that <b>draw(&nbsp;)</b> ends up printing
something different in each case. In <b>main(&nbsp;)</b>, specific types of <b>Shape</b>
are created and then added to an <b>ArrayList</b>. This is the point at which
the upcast occurs because the <b>ArrayList</b> holds only <b>Object</b>s. Since
everything in Java (with the exception of primitives) is an <b>Object</b>, an <b>ArrayList</b>
can also hold <b>Shape</b> objects. But during an upcast to <b>Object</b>,<b> </b>it
also loses any specific information, including the fact that the objects are <b>Shape</b>s.
To the <b>ArrayList</b>, they are just <b>Object</b>s.</span></p>

<p class=MsoNormal><span lang=EN-US>At the point you fetch an element out of
the <b>ArrayList</b> with <b>next(&nbsp;)</b>, things get a little busy. Since <b>ArrayList</b>
holds only <b>Object</b>s, <b>next(&nbsp;)</b> naturally produces an <b>Object
reference</b>. But we know it’s really a <b>Shape</b> reference, and we want to
send <b>Shape</b> messages to that object. So a </span><span lang=EN-US>cast to <b>Shape </b>is necessary using the traditional “<b>(Shape)</b>”
cast. This is the most basic form of RTTI, since in Java all casts are checked
at run-time for correctness. That’s exactly what RTTI means: at run-time, the
type of an object is identified.</span></p>

<p class=MsoNormal><span lang=EN-US>In this case, the RTTI cast is only
partial: the <b>Object</b> is cast to a <b>Shape</b>, and not all the way to a <b>Circle</b>,
<b>Square</b>, or <b>Triangle</b>. That’s because the only thing we <i>know</i>
at this point is that the <b>ArrayList</b> is full of <b>Shape</b>s. At
compile-time, this is enforced only by your own self-imposed rules, but at
run-time the cast ensures it.</span></p>

<p class=MsoNormal><span lang=EN-US>Now polymorphism takes over and the exact
method that’s called for the <b>Shape</b> is determined by whether the
reference is for a <b>Circle</b>, <b>Square</b>, or <b>Triangle</b>. And in
general, this is how it should be; you want the bulk of your code to know as
little as possible about <i>specific</i> types of objects, and to just deal
with the general representation of a family of objects (in this case, <b>Shape</b>).
As a result, your code will be easier to write, read, and maintain, and your
designs will be easier to implement, understand, and change. So polymorphism is
the general goal in object-oriented programming.</span></p>

<p class=MsoNormal><span lang=EN-US>But what if you have a special programming
problem that’s easiest to solve if you know the exact type of a generic
reference</span><span lang=EN-US>? For example, suppose you want to allow your users to highlight all
the shapes of any particular type by turning them purple. This way, they can
find all the triangles on the screen by highlighting them. This is what RTTI
accomplishes: you can ask a <b>Shape</b> reference the exact type that it’s
referring to.</span></p>

<h3><a name="_Toc312374135"></a><a name="_Toc481064774"></a><a
name="_Toc375545406"><span lang=EN-US>The <b>Class</b> object</span></a></h3>

<p class=MsoNormal><span lang=EN-US>To understand how RTTI works in Java, you
must first know how type information is represented at run-time. This is
accomplished through a special kind of object called the </span><span lang=EN-US><i>Class object,</i> which contains information about the class.
(This is sometimes called a </span><span
lang=EN-US><i>meta-class.</i>) In fact, the <b>Class</b> object is used to
create all of the “regular” objects of your class.</span></p>

<p class=MsoNormal><span lang=EN-US>There’s a <b>Class</b> object for each
class that is part of your program. That is, each time you write and compile a
new class, a single <b>Class</b> object is also created (and stored,
appropriately enough, in an identically named <b>.class </b>file). At run-time,
when you want to make an object of that class, the </span><span lang=EN-US>Java Virtual Machine (JVM) that’s executing your program first checks
to see if the <b>Class</b> object for that type is loaded. If not, the JVM
loads it by finding the <b>.class </b>file with that name. Thus, a Java program
isn’t completely loaded before it begins, which is different from many
traditional languages.</span></p>

<p class=MsoNormal><span lang=EN-US>Once the <b>Class</b> object for that type
is in memory, it is used to create all objects of that type.</span></p>

<p class=MsoNormal><span lang=EN-US>If this seems shadowy or if you don’t really
believe it, here’s a demonstration program to prove it:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c12:SweetShop.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Examination of the
way the class loader works.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Candy {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Loading Candy&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Gum {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Loading Gum&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Cookie {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Loading Cookie&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class SweetShop {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;inside main&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new Candy();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;After creating Candy&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Class.forName(&quot;Gum&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(ClassNotFoundException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;After
Class.forName(\&quot;Gum\&quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new Cookie();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;After creating Cookie&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Each of the classes <b>Candy</b>, <b>Gum</b>,
and <b>Cookie</b> have a </span><span
lang=EN-US><b>static</b> clause that is executed as the class is loaded for the
first time. Information will be printed to tell you when loading occurs for
that class. In <b>main(&nbsp;)</b>, the object creations are spread out between
print statements to help detect the time of loading.</span></p>

<p class=MsoNormal><span lang=EN-US>A particularly interesting line is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Class.forName(&quot;Gum&quot;);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This method is a <b>static</b> member of <b>Class</b>
(to which all <b>Class</b> objects belong). A <b>Class</b> object is like any
other object and so you can get and manipulate a reference to it. (That’s what
the loader does.) One of the ways to get a reference to the <b>Class</b> object
is </span><span lang=EN-US><b>forName(&nbsp;)</b>, which takes a <b>String</b>
containing the textual name (watch the spelling and capitalization!) of the
particular class you want a reference for. It returns a <b>Class</b> reference.</span></p>

<p class=MsoNormal><span lang=EN-US>The output of this program for one JVM is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>inside main</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Loading Candy</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>After creating Candy</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Loading Gum</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>After
Class.forName(&quot;Gum&quot;)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Loading Cookie</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>After creating
Cookie</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that each <b>Class</b> object
is loaded only when it’s needed, and the <b>static</b> initialization is
performed upon class loading.</span></p>

<h4><span lang=EN-US>Class literals</span></h4>

<p class=MsoNormal><span lang=EN-US>Java provides a second way to produce the
reference to the <b>Class</b> object, using a </span><span lang=EN-US><i>class literal</i>. In the above program this would look like:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Gum.class;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>which is not only simpler, but also safer
since it’s checked at compile-time. Because it eliminates the method call, it’s
also more efficient.</span></p>

<p class=MsoNormal><span lang=EN-US>Class literals work with regular classes as
well as interfaces, arrays, and primitive types. In addition, there’s a
standard field called </span><span
lang=EN-US><b>TYPE</b> that exists for each of the primitive wrapper classes.
The <b>TYPE</b> field produces a reference to the <b>Class</b> object for the
associated primitive type, such that:</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr style='page-break-inside:avoid'>
   <td width=312 colspan=2 valign=top style='width:234.0pt;border:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table align=center style='text-align:center'><span lang=EN-US>… is
   equivalent to …</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td width=150 valign=top style='width:112.3pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>boolean.class</span></b></p>
  </td>
  <td width=162 valign=top style='width:121.7pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>Boolean.TYPE</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=150 valign=top style='width:112.3pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>char.class</span></b></p>
  </td>
  <td width=162 valign=top style='width:121.7pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>Character.TYPE</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=150 valign=top style='width:112.3pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>byte.class</span></b></p>
  </td>
  <td width=162 valign=top style='width:121.7pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>Byte.TYPE</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=150 valign=top style='width:112.3pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>short.class</span></b></p>
  </td>
  <td width=162 valign=top style='width:121.7pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>Short.TYPE</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=150 valign=top style='width:112.3pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>int.class</span></b></p>
  </td>
  <td width=162 valign=top style='width:121.7pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>Integer.TYPE</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=150 valign=top style='width:112.3pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>long.class</span></b></p>
  </td>
  <td width=162 valign=top style='width:121.7pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>Long.TYPE</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=150 valign=top style='width:112.3pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>float.class</span></b></p>
  </td>
  <td width=162 valign=top style='width:121.7pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>Float.TYPE</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=150 valign=top style='width:112.3pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>double.class</span></b></p>
  </td>
  <td width=162 valign=top style='width:121.7pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>Double.TYPE</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=150 valign=top style='width:112.3pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>void.class</span></b></p>
  </td>
  <td width=162 valign=top style='width:121.7pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=MsoNormal align=center style='margin-left:0cm;text-align:center'><b><span
  lang=EN-US>Void.TYPE</span></b></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><a name="_Toc375545408"><span lang=EN-US>My preference
is to use the “<b>.class</b>” versions if you can, since they’re more
consistent with regular classes.</span></a></p>

<h3><a name="_Toc481064775"><span lang=EN-US>Checking before a cast</span></a></h3>

<p class=MsoNormal><span lang=EN-US>So far, you’ve seen RTTI forms including:</span></p>

<p class=Numbered><span lang=EN-US>The classic cast; e.g., “<b>(Shape),</b>”
which uses RTTI to make sure the cast is correct and throws a <b>ClassCastException</b>
if you’ve performed a bad cast.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>83.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>The <b>Class</b> object representing the type of your object. The <b>Class</b>
object can be queried for useful run-time information.</span></p>

<p class=MsoNormal><span lang=EN-US>In C++, the classic cast “<b>(Shape)</b>”
does <i>not </i>perform RTTI. It simply tells the compiler to treat the object
as the new type. In Java, which does perform the type check, this cast is often
called a “type safe downcast</span><span
lang=EN-US>.” The reason for the term “downcast” is the historical arrangement
of the class hierarchy diagram. If casting a <b>Circle</b> to a <b>Shape</b> is
an upcast, then casting a <b>Shape</b> to a <b>Circle</b> is a downcast.
However, you know a <b>Circle</b> is also a <b>Shape</b>, and the compiler
freely allows an upcast assignment, but you <i>don’t</i> know that a <b>Shape</b>
is necessarily a <b>Circle</b>, so the compiler doesn’t allow you to perform a </span><span lang=EN-US>downcast assignment without using an explicit cast. </span></p>

<p class=MsoNormal><span lang=EN-US>There’s a third form of RTTI in Java. This
is the </span><span lang=EN-US>keyword <b>instanceof</b> that tells you if an
object is an instance of a particular type. It returns a <b>boolean </b>so you
use it in the form of a question, like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>if(x instanceof Dog)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  ((Dog)x).bark();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The above <b>if</b> statement checks to see
if the object <b>x</b> belongs to the class <b>Dog</b> <i>before</i> casting <b>x</b>
to a <b>Dog</b>. It’s important to use <b>instanceof</b> before a downcast when
you don’t have other information that tells you the type of the object;
otherwise you’ll end up with a </span><span lang=EN-US><b>ClassCastException</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Ordinarily, you might be hunting for one
type (triangles to turn purple, for example), but you can easily tally <i>all</i>
of the objects using <b>instanceof</b>. Suppose you have a family of <b>Pet</b>
classes:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c12:Pets.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Pet {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Dog extends Pet {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Pug extends Dog {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Cat extends Pet {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Rodent extends Pet
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Gerbil extends
Rodent {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Hamster extends
Rodent {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>class Counter {
int i; } ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Counter</b> class is used to keep
track of the number of any particular type of <b>Pet</b>. You could think of it
as an <b>Integer</b> that can be modified.</span></p>

<p class=MsoNormal><span lang=EN-US>Using <b>instanceof</b>, all the pets can
be counted:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c12:PetCount.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using instanceof.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class PetCount {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static String[]
typenames = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Pet&quot;,
&quot;Dog&quot;, &quot;Pug&quot;, &quot;Cat&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Rodent&quot;,
&quot;Gerbil&quot;, &quot;Hamster&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Exceptions thrown
out to console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList pets = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Class[] petTypes =
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Class.forName(&quot;Dog&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Class.forName(&quot;Pug&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Class.forName(&quot;Cat&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Class.forName(&quot;Rodent&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Class.forName(&quot;Gerbil&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Class.forName(&quot;Hamster&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; 15; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        pets.add(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          petTypes[</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            (int)(Math.random()*petTypes.length)]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
.newInstance());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(InstantiationException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Cannot instantiate&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(IllegalAccessException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Cannot access&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(ClassNotFoundException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Cannot find class&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    HashMap h = new
HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; typenames.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
h.put(typenames[i], new Counter());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; pets.size(); i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Object o =
pets.get(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Pet)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;Pet&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Dog)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;Dog&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Pug)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;Pug&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Cat)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;Cat&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Rodent)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;Rodent&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Gerbil)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;Gerbil&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Hamster)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;Hamster&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; pets.size(); i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(pets.get(i).getClass());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; typenames.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        typenames[i] +
&quot; quantity: &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(typenames[i])).i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><a name="_Toc305628782"></a><a name="_Toc305593310"><span
lang=EN-US>There’s a rather narrow restriction on <b>instanceof</b>: you can compare
it to a named type only, and not to a <b>Class</b> object. In the example above
you might feel that it’s tedious to write out all of those <b>instanceof</b>
expressions, and you’re right. But there is no way to cleverly automate <b>instanceof
</b>by creating an <b>ArrayList</b> of <b>Class</b> objects and comparing it to
those instead (stay tuned—you’ll see an alternative). This isn’t as great a
restriction as you might think, because you’ll eventually understand that your
design is probably flawed if you end up writing a lot of <b>instanceof</b>
expressions.</span></a></p>

<p class=MsoNormal><span lang=EN-US>Of course this example is contrived—you’d
probably put a <b>static</b> data member in each type and increment it in the
constructor to keep track of the counts. You would do something like that <i>if</i>
you had control of the source code for the class and could change it. Since
this is not always the case, RTTI can come in handy.</span></p>

<h4><span lang=EN-US>Using class literals</span></h4>

<p class=MsoNormal><span lang=EN-US>It’s interesting to see how the <b>PetCount.java</b>
example can be rewritten using class literals</span><span lang=EN-US>. The result is cleaner in many ways:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c12:PetCount2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using class literals.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class PetCount2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList pets = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Class[] petTypes = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Class literals:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Pet.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Dog.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Pug.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Cat.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Rodent.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Gerbil.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Hamster.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; 15; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // Offset by one
to eliminate Pet.class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        int rnd = 1 +
(int)(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Math.random()
* (petTypes.length - 1));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        pets.add(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
petTypes[rnd].newInstance());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(InstantiationException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Cannot instantiate&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(IllegalAccessException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Cannot access&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    HashMap h = new
HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; petTypes.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
h.put(petTypes[i].toString(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new Counter());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; pets.size(); i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Object o =
pets.get(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Pet)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;class Pet&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Dog)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;class Dog&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Pug)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;class Pug&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Cat)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;class Cat&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Rodent)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;class Rodent&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof Gerbil)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;class Gerbil&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(o instanceof
Hamster)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((Counter)h.get(&quot;class Hamster&quot;)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; pets.size(); i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(pets.get(i).getClass());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator keys =
h.keySet().iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
while(keys.hasNext()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String nm =
(String)keys.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Counter cnt =
(Counter)h.get(nm);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
nm.substring(nm.lastIndexOf('.') + 1) + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot; quantity:
&quot; + cnt.i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Here, the <b>typenames</b> array has been
removed in favor of getting the type name strings from the <b>Class</b> object.
Notice that the system can distinguish between classes and interfaces.</span></p>

<p class=MsoNormal><span lang=EN-US>You can also see that the creation of <b>petTypes</b>
does not need to be surrounded by a <b>try</b> block since it’s evaluated at
compile-time and thus won’t throw any exceptions, unlike <b>Class.forName(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>When the <b>Pet</b> objects are dynamically
created, you can see that the random number is restricted so it is between one
and <b>petTypes.length</b> and does not include zero. That’s because zero
refers to <b>Pet.class</b>, and presumably a generic <b>Pet</b> object is not
interesting. However, since <b>Pet.class</b> is part of <b>petTypes</b> the
result is that all of the pets get counted.</span></p>

<h4><span lang=EN-US>A dynamic <b>instanceof</b></span></h4>

<p class=MsoNormal><span
lang=EN-US>The <b>Class</b> </span><span lang=EN-US><b>isInstance</b> method provides a way to dynamically call the <b>instanceof</b>
operator. Thus, all those tedious <b>instanceof</b> statements can be removed
in the <b>PetCount</b> example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c12:PetCount3.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using isInstance().</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class PetCount3 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList pets = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Class[] petTypes = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Pet.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Dog.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Pug.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Cat.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Rodent.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Gerbil.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Hamster.class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; 15; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // Offset by one
to eliminate Pet.class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        int rnd = 1 +
(int)(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Math.random()
* (petTypes.length - 1));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        pets.add(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
petTypes[rnd].newInstance());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(InstantiationException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Cannot instantiate&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(IllegalAccessException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Cannot access&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    HashMap h = new
HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; petTypes.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
h.put(petTypes[i].toString(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new Counter());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; pets.size(); i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Object o =
pets.get(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Using isInstance
to eliminate individual</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // instanceof
expressions:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for (int j = 0; j
&lt; petTypes.length; ++j)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if
(petTypes[j].isInstance(o)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          String key =
petTypes[j].toString();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
((Counter)h.get(key)).i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; pets.size(); i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(pets.get(i).getClass());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Iterator keys =
h.keySet().iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
while(keys.hasNext()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String nm =
(String)keys.next();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Counter cnt =
(Counter)h.get(nm);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
nm.substring(nm.lastIndexOf('.') + 1) + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot; quantity:
&quot; + cnt.i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the <b>isInstance(&nbsp;)</b>
method has eliminated the need for the <b>instanceof</b> expressions. In
addition, this means that you can add new types of pets simply by changing the <b>petTypes</b>
array; the rest of the program does not need modification (as it did when using
the <b>instanceof</b> expressions).</span></p>

<h4><b><span lang=EN-US>instanceof</span></b><span lang=EN-US> vs. <b>Class</b>
equivalence</span></h4>

<p class=MsoNormal><span
lang=EN-US>When querying for type information, there’s an important difference
between either form of <b>instanceof</b> (that is, <b>instanceof</b> or <b>isInstance(&nbsp;)</b>,
which produce equivalent results) and the direct comparison of the <b>Class</b>
objects. Here’s an example that demonstrates the difference:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c12:FamilyVsExactType.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The difference
between instanceof and class</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Base {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Derived extends
Base {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
FamilyVsExactType {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
test(Object x) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Testing x of type &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      x.getClass());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;x instanceof Base &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (x instanceof
Base));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;x instanceof Derived &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (x instanceof
Derived));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Base.isInstance(x) &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Base.class.isInstance(x));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Derived.isInstance(x)
&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Derived.class.isInstance(x));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;x.getClass()
== Base.class &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (x.getClass() ==
Base.class));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;x.getClass()
== Derived.class &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (x.getClass() ==
Derived.class));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;x.getClass().equals(Base.class)) &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
(x.getClass().equals(Base.class)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;x.getClass().equals(Derived.class)) &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
(x.getClass().equals(Derived.class)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new Base());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    test(new Derived());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>test(&nbsp;)</b> method performs
type checking with its argument using both forms of <b>instanceof</b>. It then
gets the <b>Class</b> reference and uses <b>==</b> and <b>equals(&nbsp;) </b>to
test for equality of the <b>Class</b> objects. Here is the output:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Testing x of type class
Base</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x instanceof Base true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x instanceof Derived
false</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Base.isInstance(x) true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Derived.isInstance(x)
false</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x.getClass() ==
Base.class true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x.getClass() ==
Derived.class false</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x.getClass().equals(Base.class))
true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x.getClass().equals(Derived.class))
false</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Testing x of type class
Derived</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x instanceof Base true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x instanceof Derived
true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Base.isInstance(x) true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Derived.isInstance(x)
true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x.getClass() ==
Base.class false</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x.getClass() == Derived.class
true</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x.getClass().equals(Base.class))
false</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>x.getClass().equals(Derived.class))
true</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Reassuringly, <b>instanceof </b>and <b>isInstance(&nbsp;)</b>
produce exactly the same results, as do <b>equals(&nbsp;)</b> and <b>==</b>.
But the tests themselves draw different conclusions. In keeping with the
concept of type, <b>instanceof</b> says “are you this class, or a class derived
from this class?” On the other hand, if you compare the actual <b>Class</b>
objects using <b>==</b>, there is no concern with inheritance—it’s either the
exact type or it isn’t.</span></p>

<h2><a name="_Toc375545409"></a><a name="_Toc312374146"></a><a
name="_Toc305628785"></a><a name="_Toc305593313"></a><a name="_Toc481064776"></a><a
name="_Toc375545407"><span lang=EN-US>RTTI syntax</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Java performs its </span><span lang=EN-US>RTTI using the <b>Class</b> object, even if you’re doing something
like a cast. The class <b>Class</b> also has a number of other ways you can use
RTTI.</span></p>

<p class=MsoNormal><span lang=EN-US>First, you must get a reference to the
appropriate <b>Class</b> object. One way to do this, as shown in the previous
example, is to use a string and the <b>Class.forName(&nbsp;)</b> method. This
is convenient because you don’t need an object of that type in order to get the
<b>Class</b> reference. However, if you do already have an object of the type
you’re interested in, you can fetch the <b>Class</b> reference by calling a
method that’s part of the <b>Object</b> root class:<b> </b></span><span lang=EN-US><b>getClass(&nbsp;)</b>. This returns the <b>Class</b> reference
representing the actual type of the object. <b>Class</b> has many interesting
methods, demonstrated in the following example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c12:ToyTest.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Testing class Class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface HasBatteries
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface Waterproof {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface ShootsThings
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Toy {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Comment out the
following default</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // constructor to see </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // NoSuchMethodError
from (*1*)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Toy() {} </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Toy(int i) {} </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class FancyToy extends
Toy </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    implements
HasBatteries, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Waterproof,
ShootsThings {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  FancyToy() { super(1);
}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ToyTest {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Class c = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      c =
Class.forName(&quot;FancyToy&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(ClassNotFoundException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Can't find FancyToy&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    printInfo(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Class[] faces =
c.getInterfaces();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; faces.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
printInfo(faces[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Class cy =
c.getSuperclass();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object o = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Requires
default constructor:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      o = cy.newInstance();
// (*1*)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(InstantiationException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Cannot instantiate&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(IllegalAccessException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Cannot access&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw e;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
printInfo(o.getClass());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
printInfo(Class cc) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Class name:
&quot; + cc.getName() +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot; is
interface? [&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cc.isInterface() +
&quot;]&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that <b>class FancyToy</b> is
quite complicated, since it inherits from <b>Toy</b> and <b>implements</b> the <b>interface</b>s
of <b>HasBatteries</b>, <b>Waterproof</b>, and <b>ShootsThings</b>. In <b>main(&nbsp;)</b>,
a <b>Class</b> reference is created and initialized to the <b>FancyToy</b> <b>Class</b>
using <b>forName(&nbsp;)</b> inside an appropriate <b>try</b> block.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Class.getInterfaces(&nbsp;)</b> </span><span lang=EN-US>method returns an array of <b>Class</b> objects representing the
interfaces that are contained in the <b>Class</b> object of interest.</span></p>

<p class=MsoNormal><span lang=EN-US>If you have a <b>Class</b> object you can
also ask it for its direct base class using </span><span lang=EN-US><b>getSuperclass(&nbsp;)</b>. This, of course, returns a <b>Class</b>
reference that you can further query. This means that, at run-time, you can
discover an object’s entire class hierarchy.</span></p>

<p class=MsoNormal><span lang=EN-US>The </span><span lang=EN-US><b>newInstance(&nbsp;)</b> method of <b>Class</b> can, at first, seem
like just another way to <b>clone(&nbsp;)</b> an object. However, you can
create a new object with <b>newInstance(&nbsp;)</b> <i>without</i> an existing
object, as seen here, because there is no <b>Toy</b> object—only <b>cy</b>, which
is a reference to <b>y</b>’s <b>Class</b> object. This is a way to implement a
“virtual constructor,” which allows you to say “I don’t know exactly what type
you are, but create yourself properly anyway.” In the example above, <b>cy</b>
is just a <b>Class</b> reference with no further type information known at
compile-time. And when you create a new instance, you get back an <b>Object
reference</b>. But that reference is pointing to a <b>Toy</b> object. Of
course, before you can send any messages other than those accepted by <b>Object</b>,
you have to investigate it a bit and do some casting. In addition, the class
that’s being created with <b>newInstance(&nbsp;)</b> must have a default
constructor. In the next section, you’ll see how<b> </b>to dynamically create
objects of classes using any constructor, with the Java <i>reflection</i> API.</span></p>

<p class=MsoNormal><span lang=EN-US>The final method in the listing is </span><span lang=EN-US><b>printInfo(&nbsp;),</b> which takes a <b>Class</b> reference and
gets its name with </span><span
lang=EN-US><b>getName(&nbsp;),</b> and finds out whether it’s an interface with
</span><span lang=EN-US><b>isInterface(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The output from this program is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Class name: FancyToy is
interface? [false]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Class name: HasBatteries
is interface? [true]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Class name: Waterproof
is interface? [true]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Class name: ShootsThings
is interface? [true]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Class name: Toy is
interface? [false]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Thus, with the <b>Class</b> object you can
find out just about everything you want to know about an object.</span></p>

<h2><a name="_Toc312374147"></a><a name="_Toc481064777"></a><a
name="_Toc375545410"><span lang=EN-US>Reflection: run-time <br>
class information</span></a></h2>

<p class=MsoNormal><span lang=EN-US>If you don’t know the precise type of an
object, RTTI will tell you. However, there’s a limitation: the type must be
known at compile-time in order for you to be able to detect it using RTTI and
do something useful with the information. Put another way, the compiler must
know about all the classes you’re working with for RTTI.</span></p>

<p class=MsoNormal><span lang=EN-US>This doesn’t seem like that much of a
limitation at first, but suppose you’re given a reference to an object that’s
not in your program space. In fact, the class of the object isn’t even
available to your program at compile-time. For example, suppose you get a bunch
of bytes from a disk file or from a network connection and you’re told that
those bytes represent a class. Since the compiler can’t know about the class
while it’s compiling the code, how can you possibly use such a class?</span></p>

<p class=MsoNormal><span lang=EN-US>In a traditional programming environment
this seems like a far-fetched scenario. But as we move into a larger
programming world there are important cases in which this happens. The first is
component-based programming, in which you build projects using </span><span lang=EN-US><i>Rapid Application Development</i> (RAD) in an application builder
tool. This is a visual approach to creating a program (which you see on the
screen as a “form”) by moving icons that represent components onto the form.
These components are then configured by setting some of their values at program
time. This design-time configuration requires that any component be
instantiable, that it exposes parts of itself, and that it allows its values to
be read and set. In addition, components that handle GUI events must expose
information about appropriate methods so that the RAD environment can assist
the programmer in overriding these event-handling methods. Reflection provides
the mechanism to detect the available methods and produce the method names. </span><span lang=EN-US>Java provides a structure for component-based programming through
JavaBeans (described in Chapter 13).</span></p>

<p class=MsoNormal><span lang=EN-US>Another compelling motivation for
discovering class information at run-time is to provide the ability to create
and execute objects on remote platforms across a network. This is called <i>Remote
Method Invocation</i> (RMI­) and it allows a Java program to have objects
distributed across many machines. This distribution can happen for a number of
reasons: for example, perhaps you’re doing a computation-intensive task and you
want to break it up and put pieces on machines that are idle in order to speed
things up. In some situations you might want to place code that handles
particular types of tasks (e.g., “Business Rules” in a multitier client/server
architecture) on a particular machine, so that machine becomes a common
repository describing those actions and it can be easily changed to affect
everyone in the system. (This is an interesting development, since the machine
exists solely to make software changes easy!) Along these lines, distributed
computing also supports specialized hardware that might be good at a particular
task—matrix inversions, for example—but inappropriate or too expensive for
general purpose programming.</span></p>

<p class=MsoNormal><span lang=EN-US>The class <b>Class</b> (described
previously in this chapter) supports the concept of <i>reflection</i>, and
there’s an additional library, <b>java.lang.reflect, </b>with classes </span><span lang=EN-US><b>Field</b>, </span><span lang=EN-US><b>Method</b>, and </span><span lang=EN-US><b>Constructor </b>(each of which implement the <b>Member interface</b>).
Objects of these types are created by the JVM at run-time to represent the
corresponding member in the unknown class. You can then use the <b>Constructor</b>s
to create new objects, the <b>get(&nbsp;)</b> and <b>set(&nbsp;)</b> methods to
read and modify the fields associated with <b>Field</b> objects, and the <b>invoke(&nbsp;)</b>
method to call a method associated with a <b>Method</b> object. In addition,
you can call the convenience methods <b>getFields(&nbsp;)</b>, <b>getMethods(&nbsp;)</b>,
<b>getConstructors(&nbsp;)</b>, etc., to return arrays of the objects representing
the fields, methods, and constructors. (You can find out more by looking up the
class <b>Class</b> in your online documentation.)<b> </b>Thus, the class information
for anonymous objects can be completely determined at run-time, and nothing
need be known at compile-time.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s important to realize that there’s
nothing magic about reflection. When you’re using reflection to interact with
an object of an unknown type, the JVM will simply look at the object and see
that it belongs to a particular class (just like ordinary RTTI) but then,
before it can do anything else, the <b>Class</b> object must be loaded. Thus,
the <b>.class</b> file for that particular type must still be available to the
JVM, either on the local machine or across the network. So the true </span><span lang=EN-US>difference between RTTI and reflection is that with RTTI, the
compiler opens and examines the <b>.class</b> file at compile-time. Put another
way, you can call all the methods of an object in the “normal” way. With
reflection, the <b>.class</b> file is unavailable at compile-time; it is opened
and examined by the run-time environment.</span></p>

<h3><a name="_Toc481064778"><span lang=EN-US>A class method extractor</span></a></h3>

<p class=MsoNormal><span lang=EN-US>You’ll rarely need to use the reflection
tools directly; they’re in the language to support other Java features, such as
object serialization (Chapter 11), JavaBeans (Chapter 13), and RMI (Chapter
15). However, there are times when it’s quite useful to be able to dynamically
extract information about a class. One extremely useful tool is a class method
extractor. As mentioned before, looking at a class definition source code or
online documentation shows only the methods that are defined or overridden <i>within
that class definition</i>. But there could be dozens more available to you that
have come from base classes. To locate these is both tedious and time consuming</span><a
href="#_ftn60" name="_ftnref60" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[60]</span></span></span></span></a><span
lang=EN-US>. Fortunately, reflection provides a way to write a simple tool that
will automatically show you the entire interface. Here’s the way it works:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c12:ShowMethods.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using reflection to
show all the methods of </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// a class, even if the
methods are defined in </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// the base class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
java.lang.reflect.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ShowMethods
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static final String
usage =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;usage:
\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;ShowMethods
qualified.class.name\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;To show all
methods in class or: \n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;ShowMethods
qualified.class.name word\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;To search for
methods involving 'word'&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &lt;
1) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(usage);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.exit(0);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Class c =
Class.forName(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Method[] m =
c.getMethods();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Constructor[] ctor
= c.getConstructors();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(args.length ==
1) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for (int i = 0;
i &lt; m.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.out.println(m[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for (int i = 0;
i &lt; ctor.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.out.println(ctor[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } else {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for (int i = 0;
i &lt; m.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
if(m[i].toString()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            
.indexOf(args[1])!= -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
System.out.println(m[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for (int i = 0;
i &lt; ctor.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
if(ctor[i].toString()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>             .indexOf(args[1])!=
-1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.out.println(ctor[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(ClassNotFoundException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;No such class: &quot; + e);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Class</b> methods </span><span lang=EN-US><b>getMethods(&nbsp;)</b> and </span><span lang=EN-US><b>getConstructors(&nbsp;)</b> return an array of <b>Method</b> and <b>Constructor</b>,
respectively. Each of these classes has further methods to dissect the names,
arguments, and return values of the methods they represent. But you can also
just use <b>toString(&nbsp;)</b>, as is done here, to produce a <b>String</b>
with the entire method signature. The rest of the code is just for extracting
command line information, determining if a particular signature matches with
your target string (using </span><span lang=EN-US><b>indexOf(&nbsp;)</b>), and printing the results.</span></p>

<p class=MsoNormal><span lang=EN-US>This shows reflection in action, since the
result produced by <b>Class.forName(&nbsp;)</b> cannot be known at
compile-time, and therefore all the method signature information is being
extracted at run-time. If you investigate your online documentation on
reflection, you’ll see that there is enough support to actually set up and make
a method call on an object that’s totally unknown at compile-time (there will be
examples of this later in this book). Again, this is something you may never
need to do yourself—the support is there for RMI and so a programming
environment can manipulate JavaBeans—but it’s interesting.</span></p>

<p class=MsoNormal><span lang=EN-US>An interesting experiment is to run </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>java ShowMethods
ShowMethods</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This produces a listing that includes a <b>public</b>
default constructor, even though you can see from the code that no constructor
was defined. The constructor you see is the one that’s automatically
synthesized by the compiler. If you then make <b>ShowMethods</b> a non-<b>public</b>
class (that is, friendly), the synthesized default constructor no longer shows
up in the output. The </span><span lang=EN-US>synthesized default constructor is automatically given the same
access as the class.</span></p>

<p class=MsoNormal><span lang=EN-US>The output for <b>ShowMethods</b> is still
a little tedious. For example, here’s a portion of the output produced by
invoking <b>java ShowMethods java.lang.String</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public boolean </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  java.lang.String.startsWith(java.lang.String,int)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public boolean </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
java.lang.String.startsWith(java.lang.String)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public boolean</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US> 
java.lang.String.endsWith(java.lang.String)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It would be even nicer if the qualifiers
like <b>java.lang</b> could be stripped off. The </span><span lang=EN-US><b>StreamTokenizer</b> class introduced in the previous chapter can
help create a tool to solve this problem:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:util:StripQualifiers.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.util;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
StripQualifiers {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private
StreamTokenizer st;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
StripQualifiers(String qualified) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    st = new
StreamTokenizer(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
StringReader(qualified));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    st.ordinaryChar('
'); // Keep the spaces</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
getNext() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int token =
st.nextToken();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(token !=
StreamTokenizer.TT_EOF) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        switch(st.ttype)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          case
StreamTokenizer.TT_EOL:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            s = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          case
StreamTokenizer.TT_NUMBER:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            s =
Double.toString(st.nval);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          case
StreamTokenizer.TT_WORD:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            s = new
String(st.sval);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          default: //
single character in ttype</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            s =
String.valueOf((char)st.ttype);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(IOException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Error fetching token&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static String
strip(String qualified) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    StripQualifiers sq =
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
StripQualifiers(qualified);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s =
&quot;&quot;, si;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while((si = sq.getNext())
!= null) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int lastDot =
si.lastIndexOf('.');</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(lastDot != -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        si =
si.substring(lastDot + 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s += si;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>To facilitate reuse, this class is placed
in <b>com.bruceeckel.util</b>. As you can see, this uses the <b>StreamTokenizer</b>
and <b>String</b> manipulation to do its work.</span></p>

<p class=MsoNormal><span lang=EN-US>The new version of the program uses the
above class to clean up the output:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c12:ShowMethodsClean.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// ShowMethods with the
qualifiers stripped</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// to make the results
easier to read.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
java.lang.reflect.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ShowMethodsClean {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static final String
usage =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;usage:
\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;ShowMethodsClean qualified.class.name\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;To show all
methods in class or: \n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;ShowMethodsClean
qualif.class.name word\n&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;To search for
methods involving 'word'&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &lt;
1) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(usage);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.exit(0);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Class c =
Class.forName(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Method[] m =
c.getMethods();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Constructor[] ctor
= c.getConstructors();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Convert to an
array of cleaned Strings:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String[] n = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
String[m.length + ctor.length];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; m.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String s =
m[i].toString();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        n[i] =
StripQualifiers.strip(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; ctor.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String s =
ctor[i].toString();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        n[i + m.length]
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
StripQualifiers.strip(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(args.length ==
1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for (int i = 0;
i &lt; n.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.out.println(n[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for (int i = 0;
i &lt; n.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
if(n[i].indexOf(args[1])!= -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
System.out.println(n[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(ClassNotFoundException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.err.println(&quot;No
such class: &quot; + e);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The class <b>ShowMethodsClean</b> is quite
similar to the previous <b>ShowMethods</b>, except that it takes the arrays of <b>Method</b>
and <b>Constructor</b> and converts them into a single array of <b>String</b>.
Each of these <b>String</b> objects is then passed through<b>
StripQualifiers.Strip(&nbsp;)</b> to remove all the method qualification.</span></p>

<p class=MsoNormal><span lang=EN-US>This tool can be a real time-saver while
you’re programming, when you can’t remember if a class has a particular method
and you don’t want to go walking through the class hierarchy in the online
documentation, or if you don’t know whether that class can do anything with,
for example, <b>Color</b> objects.</span></p>

<p class=MsoNormal><span lang=EN-US>Chapter 13 contains a GUI version of this
program (customized to extract information for Swing components) so you can
leave it running while you’re writing code, to allow quick lookups.</span></p>

<h2><a name="_Toc375545411"></a><a name="_Toc481064779"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span
lang=EN-US>RTTI allows you to discover type information from an anonymous
base-class reference. Thus, it’s ripe for misuse </span><span
lang=EN-US>by the novice since it might make sense before polymorphic method
calls do. For many people coming from a procedural background, it’s difficult
not to organize their programs into sets of <b>switch</b> statements. They
could accomplish this with RTTI and thus lose the important value of
polymorphism </span><span lang=EN-US>in code development and maintenance. The
intent of Java is that you use polymorphic method calls throughout your code,
and you use RTTI only when you must.</span></p>

<p class=MsoNormal><span lang=EN-US>However, using polymorphic method calls as
they are intended requires that you have control of the base-class definition
because at some point in the extension of your program you might discover that
the base class doesn’t include the method you need. If the base class comes
from a library or is otherwise controlled by someone else, a solution to the
problem is RTTI: You can inherit a new type and add your extra method.
Elsewhere in the code you can detect your particular type and call that special
method. This doesn’t destroy the polymorphism and extensibility of the program
because adding a new type will not require you to hunt for switch statements in
your program. However, when you add new code in your main body that requires
your new feature, you must use RTTI to detect your particular type.</span></p>

<p class=MsoNormal><span lang=EN-US>Putting a feature in a base class might
mean that, for the benefit of one particular class, all of the other classes
derived from that base require some meaningless stub of a method. This makes
the interface less clear and annoys those who must override abstract methods
when they derive from that base class. For example, consider a class hierarchy
representing musical instruments. Suppose you wanted to clear the spit valves
of all the appropriate instruments in your orchestra. One option is to put a <b>clearSpitValve(&nbsp;)
</b>method in the base class <b>Instrument</b>, but this is confusing because
it implies that <b>Percussion</b> and <b>Electronic</b> instruments also have
spit valves. RTTI provides a much more reasonable solution in this case because
you can place the method in the specific class (<b>Wind </b>in this case),
where it’s appropriate. However, a more appropriate solution is to put a <b>prepareInstrument(&nbsp;)</b>
method in the base class, but you might not see this when you’re first solving
the problem and could mistakenly assume that you must use RTTI.</span></p>

<p class=MsoNormal><span lang=EN-US>Finally, RTTI will sometimes solve
efficiency problems. If your code nicely uses polymorphism, but it turns out
that one of your objects reacts to this general purpose code in a horribly
inefficient way, you can pick out that type using RTTI and write case-specific
code to improve the efficiency. Be wary, however, of programming for efficiency
too soon. It’s a seductive trap. It’s best to get the program working <i>first</i>,
then decide if it’s running fast enough, and only then should you attack
efficiency issues—with a profiler.</span></p>

<h2><a name="_Toc481064780"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add <b>Rhomboid </b>to <b>Shapes.java</b>.
Create a <b>Rhomboid</b>, upcast it to a <b>Shape</b>, then downcast it back to
a <b>Rhomboid</b>. Try downcasting to a <b>Circle</b> and see what happens.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>194. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 1 so that it uses <b>instanceof</b>
to check the type before performing the downcast.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>195. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>Shapes.java</b> so that it can
“highlight” (set a flag) in all shapes of a particular type. The <b>toString(&nbsp;)</b>
method for each derived <b>Shape</b> should indicate whether that <b>Shape </b>is
“highlighted.”</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>196. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>SweetShop.java</b> so that each type
of object creation is controlled by a command-line argument. That is, if your
command line is “<b>java SweetShop Candy</b>,” then only the <b>Candy</b>
object is created. Notice how you can control which <b>Class</b> objects are
loaded via the command-line argument.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>197. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add a new type of <b>Pet</b> to <b>PetCount3.java</b>.
Verify that it is created and counted correctly in <b>main(&nbsp;)</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>198. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a method that takes an object and
recursively prints all the classes in that object’s hierarchy.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>199. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 6 so that it uses <b>Class.</b></span><a
href="../../../../My%20Documents/ProgToolsjdk1.3docsapijavalangClass.html#getDeclaredFields()"><b><span
lang=EN-US style='color:windowtext;text-decoration:none'>getDeclaredFields</span></b></a><b><span
lang=EN-US>(&nbsp;)</span></b><span lang=EN-US> to also display information
about the fields in a class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>200. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In <b>ToyTest.java</b>, comment out <b>Toy</b>’s
default constructor and explain what happens.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>201. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Incorporate a new kind of <b>interface</b> into <b>ToyTest.java</b>
and verify that it is detected and displayed properly.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>202. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a new type of container that uses a <b>private</b>
<b>ArrayList</b> to hold the objects.<b> </b>Capture the type of the first
object you put in it, and then allow the user to insert objects of only that
type from then on.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>203. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Write a program to determine whether an array of
<b>char</b> is a primitive type or a true object.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>204. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Implement <b>clearSpitValve(&nbsp;)</b> as
described in the summary.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>205. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Implement the <b>rotate(Shape)</b> method
described in this chapter, such that it checks to see if it is rotating a <b>Circle</b>
(and, if so, doesn’t perform the operation).</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>206. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 6 so that it uses reflection
instead of RTTI.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>207. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 7 so that it uses reflection
instead of RTTI.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>208. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In <b>ToyTest.java</b>, use reflection to create
a <b>Toy</b> object using the nondefault constructor.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>209. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Look up the interface for <b>java.lang.Class</b>
in the HTML Java documentation from <i>java.sun.com</i>. Write a program that
takes the name of a class as a command-line argument, then uses the <b>Class</b>
methods to dump all the information available for that class. Test your program
with a standard library class and  a class you create.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection19>

<h1><a name="Chapter_14"></a><a name="_Toc481064781"></a><a name="_Toc477690733"></a><a
name="_Toc375545444"></a><a name="Chapter_15"></a><span lang=EN-US>13: Creating
Windows <br>
&amp; Applets</span></h1>

<p class=Intro><span lang=EN-US>A fundamental design guideline is “make simple
things easy, and difficult things possible.”</span><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'> <a
href="#_ftn61" name="_ftnref61" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[61]</span></span></a></span></span></p>

<p class=MsoNormal><span lang=EN-US>The original design goal of the graphical
user interface (GUI) library in Java 1.0 was to allow the programmer to build a
GUI that looks good on all platforms. </span><span lang=EN-US>That goal was not achieved. Instead, the Java 1.0</span><span lang=EN-US> </span><span
lang=EN-US><i>Abstract Window Toolkit</i> (AWT) produces a GUI that looks
equally mediocre on all systems. In addition, it’s restrictive: you can use
only four fonts and you cannot access any of the more sophisticated GUI
elements that exist in your operating system. The Java 1.0 AWT programming
model is also awkward and non-object-oriented. A student in one of my seminars
(who had been at Sun during the creation of Java) explained why: the original
AWT had been conceptualized, designed, and implemented in a month. Certainly a
marvel of productivity, and also an object lesson in why design is important.</span></p>

<p class=MsoNormal><span lang=EN-US>The situation improved with the Java 1.1
AWT event model, which takes a much clearer, object-oriented approach, along
with the addition of JavaBeans, a component programming model that is oriented
toward the easy creation of visual programming environments. Java 2 finishes
the transformation away from the old Java 1.0 AWT by essentially replacing
everything with the </span><span lang=EN-US><i>Java Foundation Classes</i> (JFC), the GUI portion of which is
called “</span><span lang=EN-US>Swing.” These are a rich set of easy-to-use,
easy-to-understand JavaBeans that can be dragged and dropped (as well as hand
programmed) to create a GUI that you can (finally) be satisfied with. The
“revision 3” rule of the software industry (a product isn’t good until revision
3) seems to hold true with programming languages as well.</span></p>

<p class=MsoNormal><span lang=EN-US>This chapter does not cover anything but
the modern, Java 2 Swing library, and makes the reasonable assumption that
Swing is the final destination GUI library for Java. If for some reason you
need to use the original “old” AWT (because you’re supporting old code or you
have browser limitations), you can find that introduction in the first edition
of this book, downloadable at <i>www.BruceEckel.com</i> (also included on the
CD ROM bound with this book).</span></p>

<p class=MsoNormal><span lang=EN-US>Early in this chapter, you’ll see how things
are different when you want to create an applet vs. a regular application using
Swing, and how to create programs that are both applets and applications so
they can be run either inside a browser or from the command line. Almost all
the GUI examples in this book will be executable as either applets or
applications.</span></p>

<p class=MsoNormal><span lang=EN-US>Please be aware that this is not a
comprehensive glossary of either all the Swing components, or all the methods
for the described classes. What you see here is intended to be simple. The Swing
library is vast, and the goal of this chapter is only to get you started with
the essentials and comfortable with the concepts. If you need to do more, then
Swing can probably give you what you want if you’re willing to do the research.
</span></p>

<p class=MsoNormal><span lang=EN-US>I assume here that you have downloaded and
installed the (free) Java library documents in HTML format from <i>java.sun.com</i>
and will browse the <b>javax.swing</b> classes in that documentation to see the
full details and methods of the Swing library. Because of the simplicity of the
Swing design, this will often be enough information to solve your problem.
There are numerous (rather thick) books dedicated solely to Swing and you’ll
want to go to those if you need more depth, or if you want to modify the
default Swing behavior.</span></p>

<p class=MsoNormal><span lang=EN-US>As you learn about Swing you’ll discover: </span></p>

<p class=Numbered><span lang=EN-US>Swing is a much better programming model
than you’ve probably seen in other languages and development environments.
JavaBeans (which will be introduced toward the end of this chapter) is the
framework for that library.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>84.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>“GUI builders” (visual programming environments) are a <i>de rigueur</i>
aspect of a complete Java development environment. JavaBeans and Swing allow
the GUI builder to write code for you as you place components onto forms using
graphical tools. This not only rapidly speeds development during GUI building,
but it allows for greater experimentation and thus the ability to try out more
designs and presumably come up with a better one.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>85.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>The simplicity and well-designed nature of Swing means that even if
you do use a GUI builder rather than coding by hand, the resulting code will
still be comprehensible—this solves a big problem with GUI builders from the
past, which could easily generate unreadable code.</span></p>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>Swing contains all the
components that you expect to see in a modern UI, everything from buttons that
contain pictures to trees and tables. It’s a big library, but it’s designed to
have appropriate complexity for the task at hand—if something is simple, you don’t
have to write much code but as you try to do more complex things, your code
becomes proportionally more complex. This means an easy entry point, but you’ve
got the power if you need it.</span></p>

<p class=MsoNormal><span lang=EN-US>Much of what you’ll like about Swing could
be called “orthogonality of use.” That is, once you pick up the general ideas
about the library you can apply them everywhere. Primarily because of the
standard naming conventions, much of the time that I was writing these examples
I could guess at the method names and get it right the first time, without
looking anything up. This is certainly the hallmark of a good library design.
In addition, you can generally plug components into other components and things
will work correctly.</span></p>

<p class=MsoNormal><span lang=EN-US>For speed, all the </span><span
lang=EN-US>components are “lightweight,” and Swing is written entirely in Java
for portability.</span></p>

<p class=MsoNormal><span lang=EN-US>Keyboard navigation is automatic—you can run a Swing application
without using the mouse, and this doesn’t require any extra programming.
Scrolling support is effortless—you simply wrap your component in a <b>JScrollPane</b>
as you add it to your form. Features such as tool tips typically require a
single line of code to use.</span></p>

<p class=MsoNormal><span lang=EN-US>Swing also supports a rather radical
feature called “pluggable look and feel,” which means that the appearance of
the UI can be dynamically changed to suit the expectations of users working
under different platforms and operating systems. It’s even possible (albeit
difficult) to invent your own look and feel.</span></p>

<h2><a name="_Toc481064782"></a><a name="_Toc375545446"><span lang=EN-US>The
basic applet</span></a></h2>

<p class=MsoNormal><span lang=EN-US>One of Java’s design goals is to create <i>applets</i>,
which are little programs that run inside a Web browser. Because they must be
safe, applets are limited in what they can accomplish. However, applets are a
powerful tool that support client-side programming, a major issue for the Web.</span></p>

<h3><a name="_Toc481064783"></a><a name="_Toc375545464"><span lang=EN-US>Applet
restrictions</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Programming within an applet is so restrictive that it’s often
referred to as being “inside the sandbox,” since you always have someone—that
is, the Java run-time security system—watching over you. </span></p>

<p class=MsoNormal><span lang=EN-US>However, you can also step outside the
sandbox and write regular applications rather than applets, in which case you
can access the other features of your OS. We’ve been writing regular
applications all along in this book, but they’ve been <i>console applications</i>
without any graphical components. Swing can also be used to build GUI
interfaces for regular applications.</span></p>

<p class=MsoNormal><span lang=EN-US>You can generally answer the question of
what an applet is able to do by looking at what it is <i>supposed</i> to do:
extend the functionality of a Web page in a browser. Since, as a Net surfer,
you never really know if a Web page is from a friendly place or not, you want
any code that it runs to be safe. So the biggest restrictions you’ll notice are
probably: </span></p>

<p class=Numbered><i><span lang=EN-US>An applet can’t touch the local disk</span></i><span
lang=EN-US>. This means writing <i>or</i> reading, since you wouldn’t want an
applet to read and transmit private information over the Internet without your
permission. Writing is prevented, of course, since that would be an open
invitation to a virus. Java offers <i>digital signing</i> for applets. Many
applet restrictions are relaxed when you choose to allow <i>trusted applets</i>
(those signed by a trusted source) to have access to your machine.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>86.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
lang=EN-US>Applets can take longer to display, </span></i><span lang=EN-US>since
you must download the whole thing every time, including a separate server hit
for each different class. Your browser can cache the applet, but there are no
guarantees. Because of this, you should always package your applets in a JAR
(Java ARchive) file that combines all the applet components (including other <b>.class</b>
files as well as images and sounds) together into a single compressed file that
can be downloaded in a single server transaction. “Digital signing” is available
for each individual entry in the JAR file.</span></p>

<h3><a name="_Toc481064784"></a><a name="_Toc375545465"><span lang=EN-US>Applet
advantages</span></a></h3>

<p class=MsoNormal><span lang=EN-US>If you can live within the restrictions,
applets have definite advantages, especially when building </span><span lang=EN-US>client/server or other networked applications: </span></p>

<p class=Numbered><i><span lang=EN-US>There is no installation issue.</span></i><span
lang=EN-US> An applet has true platform independence (including the ability to
easily play audio files, etc.) so you don’t need to make any changes in your
code for different platforms nor does anyone have to perform any “tweaking” on
installation. In fact, installation is automatic every time the user loads the
Web page that contains applets, so updates happen silently and automatically.
In traditional client/server systems, building and installing a new version of
the client software is often a nightmare.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>87.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><i><span
lang=EN-US>You don’t have to worry about bad code causing damage to someone’s
system,</span></i><span lang=EN-US> because of the security built into the core
Java language and applet structure. This, along with the previous point, makes
Java popular for so-called <i>intranet</i> client/server applications that live
only within a company or restricted arena of operation where the user environment
(Web browser and add-ins) can be specified and/or controlled.</span></p>

<p class=MsoNormal><span lang=EN-US>Because applets are automatically
integrated with HTML, you have a built-in platform-independent documentation
system to support the applet. It’s an interesting twist, since we’re used to having
the documentation part of the program rather than vice versa.</span></p>

<h3><a name="_Toc481064785"><span lang=EN-US>Application frameworks</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Libraries are often grouped according to
their functionality. Some libraries, for example, are used as is, off the
shelf. The standard Java library <b>String</b> and <b>ArrayList</b> classes are
examples of these. Other libraries are designed specifically as building blocks
to create other classes. A certain category of library is the </span><span lang=EN-US><i>application framework</i>, whose goal is to help you build
applications by providing a class or set of classes that produces the basic
behavior that you need in every application of a particular type. Then, to
customize the behavior to your own needs, you inherit from the application
class and override the methods of interest. The application framework’s default
control mechanism will call your overridden methods at the appropriate time. An
application framework is a good example of “separating the things that change
from the things that stay the same,” since it attempts to localize all the
unique parts of a program in the overridden methods</span><a href="#_ftn62"
name="_ftnref62" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[62]</span></span></span></span></a><span
lang=EN-US>.</span></p>

<p class=MsoNormal><span lang=EN-US>Applets are built using an application
framework. You inherit from class <b>JApplet</b> and override the appropriate
methods. There are a few methods that control the creation and execution of an
applet on a Web page: </span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr>
   <td width=96 valign=top style='width:72.0pt;border-top:black 1.5pt;
   border-left:black 1.5pt;border-bottom:windowtext 1.5pt;border-right:black 1.0pt;
   border-style:solid;padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Method</span></p>
   </td>
   <td width=384 valign=top style='width:288.15pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid windowtext 1.5pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Operation</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>init(&nbsp;)</span></p>
  </td>
  <td width=384 valign=top style='width:288.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Automatically
  called to perform first-time initialization of the applet, including
  component layout. You’ll always override this method.</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>start(&nbsp;)</span></p>
  </td>
  <td width=384 valign=top style='width:288.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Called every time
  the applet moves into sight on the Web browser to allow the applet to start
  up its normal operations (especially those that are shut off by </span><span
  lang=EN-US>stop(&nbsp;)</span><span lang=EN-US style='font-weight:normal'>).
  Also called after </span><span lang=EN-US>init(&nbsp;)</span><span
  lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>stop(&nbsp;)</span></p>
  </td>
  <td width=384 valign=top style='width:288.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Called every time
  the applet moves out of sight on the Web browser to allow the applet to shut
  off expensive operations. Also called right before </span><span lang=EN-US>destroy(&nbsp;)</span><span
  lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=96 valign=top style='width:72.0pt;border-top:none;border-left:solid black 1.5pt;
  border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>destroy(&nbsp;)</span></p>
  </td>
  <td width=384 valign=top style='width:288.15pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Called when the
  applet is being unloaded from the page to perform final release of resources
  when the applet is no longer used</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>With this information you are ready to
create a simple applet:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Applet1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Very simple applet.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Applet1
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
getContentPane().add(new JLabel(&quot;Applet!&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that applets are not required to have
a <b>main(&nbsp;)</b>. That’s all wired into the application framework; you put
any startup code in <b>init(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>In this program, the only activity is
putting a text label on the applet, via the </span><span
lang=EN-US><b>JLabel</b> class (the old AWT appropriated the name <b>Label</b>
as well as other names of components, so you will often see a leading “<b>J</b>”
used with Swing components). The constructor for this class takes a <b>String</b>
and uses it to create the label. In the above program this label is placed on
the form.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>init(&nbsp;)</b> method is
responsible for putting all the components on the form using the <b>add(&nbsp;)</b>
method. You might think that you ought to be able to simply call <b>add(&nbsp;)</b>
by itself, and in fact that’s the way it used to be in the old AWT. However,
Swing requires you to add all components to the “content pane” of a form, and
so you must call <b>getContentPane(&nbsp;)</b> as part of the <b>add(&nbsp;)</b>
process.</span></p>

<h3><a name="_Toc481064786"><span lang=EN-US>Running applets inside a Web
browser</span></a></h3>

<p class=MsoNormal><span lang=EN-US>To run this program you must place it
inside a Web page and view that page inside your Java-enabled Web browser. To
place an </span><span lang=EN-US>applet inside a Web page you put a special tag inside the HTML source
for that Web page</span><a href="#_ftn63" name="_ftnref63" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[63]</span></span></span></span></a><span lang=EN-US> to
tell the page how to load and run the applet. </span></p>

<p class=MsoNormal><span lang=EN-US>This process used to be very simple, when
Java itself was simple and everyone was on the same bandwagon and incorporated
the same Java support inside their Web browsers. Then you might have been able
to get away with a very simple bit of HTML inside your Web page, like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;applet code=Applet1
width=100 height=50&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&lt;/applet&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Then along came the browser and language
wars, and we (programmers and end users alike) lost. After awhile, JavaSoft
realized that we could no longer expect browsers to support the correct flavor
of Java, and the only solution was to provide some kind of add-on that would
conform to a browser’s extension mechanism. By using the extension mechanism
(which a browser vendor cannot disable—in an attempt to gain competitive
advantage—without breaking all the third-party extensions), JavaSoft guarantees
that Java cannot be shut out of the Web browser by an antagonistic vendor.</span></p>

<p class=MsoNormal><span lang=EN-US>With Internet Explorer, the extension
mechanism is the ActiveX control, and with Netscape it is the plug-in. In your
HTML code, you must provide tags to support both. Here’s what the simplest
resulting HTML page looks like for <b>Applet1</b>:</span><a href="#_ftn64"
name="_ftnref64" title=""><span class=MsoFootnoteReference><b><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><b><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[64]</span></b></span></span></b></span></a></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:! c13:Applet1.html</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;html&gt;&lt;head&gt;&lt;title&gt;Applet1&lt;/title&gt;&lt;/head&gt;&lt;hr&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;OBJECT </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
classid=&quot;clsid:8AD9C840-044E-11D1-B3E9-00805F499D93&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  width=&quot;100&quot;
height=&quot;50&quot; align=&quot;baseline&quot; 
codebase=&quot;http://java.sun.com/products/plugin/1.2.2/jinstall-1_2_2-win.cab#Version=1,2,2,0&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;PARAM
NAME=&quot;code&quot; VALUE=&quot;Applet1.class&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;PARAM NAME=&quot;codebase&quot;
VALUE=&quot;.&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;PARAM
NAME=&quot;type&quot;
VALUE=&quot;application/x-java-applet;version=1.2.2&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;COMMENT&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  &lt;EMBED type=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;application/x-java-applet;version=1.2.2&quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
width=&quot;200&quot; height=&quot;200&quot; align=&quot;baseline&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
code=&quot;Applet1.class&quot; codebase=&quot;.&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>pluginspage=&quot;http://java.sun.com/products/plugin/1.2/plugin-install.html&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  &lt;NOEMBED&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/COMMENT&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   No Java 2 support for
APPLET!!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  &lt;/NOEMBED&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/EMBED&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/OBJECT&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;hr&gt;&lt;/body&gt;&lt;/html&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Some of these lines were too long and had
to be wrapped to fit on the page. The code in this book’s source code (on the
book’s CD ROM, and downloadable from <i>www.BruceEckel.com</i>) will work
without having to worry about correcting line wraps.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>code </b>value gives the name of the
<b>.class </b>file where the applet resides. The <b>width</b> and <b>height</b>
specify the initial size of the applet (in pixels, as before). There are other
items you can place within the applet tag: a place to find other <b>.class </b>files
on the Internet (</span><span lang=EN-US><b>codebase</b>), alignment
information (</span><span lang=EN-US><b>align</b>), a special identifier that
makes it possible for applets to communicate with each other (</span><span lang=EN-US><b>name</b>), and applet </span><span lang=EN-US>parameters to provide information that the applet can retrieve.
Parameters are in the form:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&lt;param
name=&quot;identifier&quot; value = &quot;information&quot;&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>and there can be as many as you want.</span></p>

<p class=MsoNormal><span lang=EN-US>The source code package for this book
provides an HTML page for each of the applets in this book, and thus many
examples of the applet tag. You can find a full and current description of the
details of placing applets in Web pages at <i>java.sun.com</i>.</span></p>

<h3><a name="_Toc481064787"><span lang=EN-US>Using <i>Appletviewer</i></span></a></h3>

<p class=MsoNormal><span lang=EN-US>Sun’s JDK (freely downloadable from <i>java.sun.com</i>)
contains a tool called the </span><span
lang=EN-US><i>Appletviewer</i> that picks the <b>&lt;applet&gt;</b> tags out of
the HTML file and runs the applets without displaying the surrounding HTML
text. Because the Appletviewer ignores everything but APPLET tags, you can put
those tags in the Java source file as comments:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=MyApplet width=200 height=100&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This way, you can run “<b>appletviewer
MyApplet.java</b>” and you don’t need to create tiny HTML files to run tests.
For example, you can add the commented HTML tags to <b>Applet1.java</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Applet1b.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Embedding the applet
tag for Appletviewer.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Applet1b width=100 height=50&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Applet1b
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
getContentPane().add(new JLabel(&quot;Applet!&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now you can invoke the applet with the
command</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>appletviewer
Applet1b.java</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In this book, this form will be used for
easy testing of applets. Shortly, you’ll see another coding approach which will
allow you to execute applets from the command line without the Appletviewer.</span></p>

<h3><a name="_Toc481064788"><span lang=EN-US>Testing applets</span></a></h3>

<p class=MsoNormal><span lang=EN-US>You can perform a simple test without any
network connection by starting up your Web browser and opening the HTML file
containing the applet tag. As the HTML file is loaded, the browser will
discover the applet tag and go hunt for the <b>.class</b> file specified by the
<b>code</b> value. Of course, it looks at the CLASSPATH to find out where to
hunt, and if your <b>.class</b> file isn’t in the CLASSPATH then it will give
an error message on the status line of the browser to the effect that it
couldn’t find that <b>.class</b> file.</span></p>

<p class=MsoNormal><span lang=EN-US>When you want to try this out on your Web
site things are a little more complicated. First of all, you must <i>have</i> a
Web site, which for most people means a third-party </span><span lang=EN-US>Internet Service Provider (ISP) at a remote location. Since the
applet is just a file or set of files, the ISP does not have to provide any
special support for Java. You must also have a way to move the HTML files and
the <b>.class</b> files from your site to the correct directory on the ISP
machine. This is typically done with a </span><span lang=EN-US>File Transfer Protocol (FTP) program, of which there are many
different types available for free or as shareware. So it would seem that all
you need to do is move the files to the ISP machine with FTP, then connect to
the site and HTML file using your browser; if the applet comes up and works,
then everything checks out, right?</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s where you can get fooled. If the
browser on the client machine cannot locate the <b>.class</b> file on the
server, it will hunt through the </span><span lang=EN-US>CLASSPATH on your <i>local</i> machine. Thus, the applet might not be
loading properly from the server, but to you it looks fine during your testing
process because the browser finds it on your machine. When someone else
connects, however, his or her browser can’t find it. So when you’re testing,
make sure you erase the relevant <b>.class</b> files (or <b>.jar </b>file) on
your local machine to verify that they exist in the proper location on the
server.</span></p>

<p class=MsoNormal><span lang=EN-US>One of the most insidious places where this
happened to me is when I innocently placed an applet inside a <b>package</b>.
After uploading the HTML file and applet, it turned out that the server path to
the applet was confused because of the package name. However, my browser found
it in the local CLASSPATH. So I was the only one who could properly load the
applet. It took some time to discover that the <b>package</b> statement was the
culprit. In general, you’ll want to leave the </span><span lang=EN-US><b>package</b> statement out of an applet.</span></p>

<h2><a name="_Toc481064789"><span lang=EN-US>Running applets from the command
line</span></a></h2>

<p class=MsoNormal><span
lang=EN-US>There are times when you’d like to make a windowed program do
something else other than sit on a Web page. Perhaps you’d also like it to do
some of the things a “regular” application can do but still have the vaunted instant
portability provided by Java. In previous chapters in this book we’ve made
command-line applications, but in some operating environments (the Macintosh,
for example) there isn’t a command line. So for any number of reasons you’d
like to build a windowed, non-applet program using Java. This is certainly a
reasonable desire.</span></p>

<p class=MsoNormal><span lang=EN-US>The Swing library allows you to make an
application that preserves the look and feel of the underlying operating
environment. If you want to build windowed applications, it makes sense to do
so</span><a href="#_ftn65" name="_ftnref65" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[65]</span></span></span></span></a><span lang=EN-US> only
if you can use the latest version of Java and associated tools so you can
deliver applications that won’t confound your users. If for some reason you’re
forced to use an older version of Java, think hard before committing to
building a significant windowed application.</span></p>

<p class=MsoNormal><span lang=EN-US>Often you’ll want to be able to create a class that can be invoked as
either a window or an applet. This is especially convenient when you’re testing
the applets, since it’s typically much faster and easier to run the resulting
applet-application from the command line than it is to start up a Web browser
or the Appletviewer.</span></p>

<p class=MsoNormal><span lang=EN-US>To create an applet that can be run from
the console command line, you simply add a <b>main(&nbsp;)</b> to your applet
that builds an instance of the applet inside a <b>J</b><b>Frame</b>.</span><a
href="#_ftn66" name="_ftnref66" title=""><span class=MsoFootnoteReference><b><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><b><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[66]</span></b></span></span></b></span></a><span
lang=EN-US> As a simple example, let’s look at <b>Applet1b</b><b>.java</b>
modified to work as both an application and an applet:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Applet1c.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// An application and an
applet.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Applet1c width=100 height=50&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Applet1c
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
getContentPane().add(new JLabel(&quot;Applet!&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // A main() for the
application:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JApplet applet = new
Applet1c();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JFrame frame = new
JFrame(&quot;Applet1c&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // To close the
application:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Console.setupClosing(frame);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    frame.getContentPane().add(applet);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
frame.setSize(100,50);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.init();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
frame.setVisible(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>main(&nbsp;)</span></b><span lang=EN-US>
is the only element added to the applet, and the rest of the applet is
untouched. The applet is created and added to a <b>JFrame</b> so that it can be
displayed. </span></p>

<p class=MsoNormal><span lang=EN-US>The line:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Console.setupClosing(frame);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Causes the window to be properly closed. <b>Console</b>
comes from <b>com.bruceeckel.swing</b> and will be explained a little later.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that in <b>main(&nbsp;)</b>,
the applet is explicitly initialized and started since in this case the browser
isn’t available to do it for you. Of course, this doesn’t provide the full
behavior of the browser, which also calls <b>stop(&nbsp;)</b> and <b>destroy(&nbsp;)</b>,
but for most situations it’s acceptable. If it’s a problem, you can force the
calls yourself.</span><a href="#_ftn67" name="_ftnref67" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[67]</span></span></span></span></a></p>

<p class=MsoNormal><span lang=EN-US>Notice the last line:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>frame.setVisible(true);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Without this, you won’t see anything on the
screen.</span></p>

<h3><a name="_Toc481064790"><span lang=EN-US>A display framework</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Although the code that turns programs into both applets and
applications produces valuable results, if used everywhere it becomes
distracting and wastes paper. Instead, the following display framework will be
used for the Swing examples in the rest of this book:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
com:bruceeckel:swing:Console.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Tool for running
Swing demos from the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// console, both applets
and JFrames.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package
com.bruceeckel.swing;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Console {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Create a title
string from the class name:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static String
title(Object o) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String t =
o.getClass().toString();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Remove the word
&quot;class&quot;:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(t.indexOf(&quot;class&quot;) != -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t =
t.substring(6);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return t;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
setupClosing(JFrame frame) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // The JDK 1.2
Solution as an </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // anonymous inner
class:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
frame.addWindowListener(new WindowAdapter() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
windowClosing(WindowEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        System.exit(0);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // The improved
solution in JDK 1.3:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // frame.setDefaultCloseOperation(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //    
EXIT_ON_CLOSE);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  run(JFrame frame, int
width, int height) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    setupClosing(frame);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    frame.setSize(width,
height);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
frame.setVisible(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  run(JApplet applet, int
width, int height) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JFrame frame = new
JFrame(title(applet));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    setupClosing(frame);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
frame.getContentPane().add(applet);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    frame.setSize(width,
height);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.init();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
frame.setVisible(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  run(JPanel panel, int
width, int height) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JFrame frame = new
JFrame(title(panel));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    setupClosing(frame);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
frame.getContentPane().add(panel);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    frame.setSize(width,
height);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
frame.setVisible(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This is a tool you may want to use
yourself, so it’s placed in the library </span><span
lang=EN-US><b>com.bruceeckel.swing</b>. The <b>Console</b> class consists
entirely of <b>static</b> methods. The first is used to extract the class name
(using RTTI) from any object and to remove the word “class,” which is typically
prepended by <b>getClass(&nbsp;)</b>. This uses the <b>String</b> methods <b>indexOf(&nbsp;)</b>
to determine whether the word “class” is there, and <b>substring(&nbsp;)</b> to
produce the new string without “class” or the trailing space. This name is used
to label the window that is displayed by the <b>run(&nbsp;)</b> methods.</span></p>

<p class=MsoNormal><b><span lang=EN-US>setupClosing(&nbsp;)</span></b><span
lang=EN-US> is used to hide the code that causes a <b>JFrame</b> to exit a
program when that <b>JFrame</b> is closed. The default behavior is to do
nothing, so if you don’t call <b>setupClosing(&nbsp;)</b> or write the
equivalent code for your </span><span lang=EN-US><b>JFrame</b>, the application
won’t close. The reason this code is hidden rather than placing it directly in
the subsequent <b>run(&nbsp;)</b> methods is partly because it allows you to
use the method by itself when what you want to do is more complicated than what
<b>run(&nbsp;)</b> provides. However, it also isolates a change factor: Java 2
has two ways of causing certain types of windows to close. In JDK 1.2, the
solution is to create a new </span><span
lang=EN-US><b>WindowAdapter</b> class and implement </span><span
lang=EN-US><b>windowClosing(&nbsp;)</b>, as seen above (the meaning of this
will be fully explained later in this chapter). However, during the creation of
JDK 1.3 the library designers observed that you typically need to close windows
whenever you’re creating a non-applet, and so they added the </span><span lang=EN-US><b>setDefaultCloseOperation(&nbsp;)</b> to <b>JFrame</b> and <b>JDialog</b>.
From the standpoint of writing code, the new method is much nicer to use but
this book was written while there was still no JDK 1.3 implemented on Linux and
other platforms, so in the interest of cross-version portability the change was
isolated inside <b>setupClosing(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>run(&nbsp;)</b> method is overloaded
to work with <b>JApplet</b>s, <b>JPanel</b>s, and <b>JFrame</b>s. Note that
only if it’s a <b>JApplet</b> are <b>init(&nbsp;)</b> and <b>start(&nbsp;)</b>
called.</span></p>

<p class=MsoNormal><span lang=EN-US>Now any applet can be run from the console
by creating a <b>main(&nbsp;)</b> containing a line like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Console.run(new
MyClass(), 500, 300);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>in which the last two arguments are the
display width and height. Here’s <b>Applet1c.java</b> modified to use <b>Console</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Applet1d.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Console runs applets
from the command line.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Applet1d width=100 height=50&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Applet1d
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
getContentPane().add(new JLabel(&quot;Applet!&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Applet1d(), 100, 50);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This allows the elimination of repeated
code while providing the greatest flexibility in running the examples.</span></p>

<h3><a name="_Toc481064791"><span lang=EN-US>Using the Windows Explorer</span></a></h3>

<p class=MsoNormal><span lang=EN-US>If you’re using Windows, you can simplify
the process of running a command-line Java program by configuring the </span><span lang=EN-US>Windows Explorer—the file browser in Windows, <i>not</i> the Internet
Explorer—so that you can simply double-click on a <b>.class</b> file to execute
it. There are several steps in this process.</span></p>

<p class=MsoNormal><span lang=EN-US>First, download and install the </span><span lang=EN-US>Perl programming language from <i>www.Perl.org</i>. You’ll find the
instructions and language documentation on that site.</span></p>

<p class=MsoNormal><span lang=EN-US>Next, create the following script without
the first and last lines (this script is part of this book’s source-code
package):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:! c13:RunJava.bat</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>@rem = '--*-Perl-*--</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>@echo off</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>perl -x -S
&quot;%0&quot; %1 %2 %3 %4 %5 %6 %7 %8 %9</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>goto endofperl</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>@rem ';</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>#!perl</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>$file = $ARGV[0];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>$file =~ s/(.*)\..*/\1/;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>$file =~
s/(.*\\)*(.*)/$+/;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>`java $file`;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>__END__</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>:endofperl</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now, open the Windows Explorer, select
“View,” “Folder Options,” then click on the “File Types” tab. Press the “New
Type” button. For “Description of Type” enter “Java class file.” For
“Associated Extension,” enter “class.” Under “Actions” press the “New” button.
For “Action” enter “Open,” and for “Application used to perform action” enter a
line like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&quot;c:\aaa\Perl\RunJava.bat&quot;
&quot;%L&quot;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You must customize the path before
“RunJava.bat” to conform to the location where you placed the batch file.</span></p>

<p class=MsoNormal><span lang=EN-US>Once you perform this installation, you may
run any Java program by simply double-clicking on the <b>.class</b> file
containing a <b>main(&nbsp;)</b>.</span></p>

<h2><a name="_Toc481064792"></a><a name="_Toc375545447"><span lang=EN-US>Making
a button</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Making a button is quite simple: you just
call the <b>J</b><b>Button</b> constructor with the label you want on the button.
You’ll see later that you can do fancier things, like putting graphic images on
buttons.</span></p>

<p class=MsoNormal><span lang=EN-US>Usually you’ll want to create a field for
the button inside your class so that you can refer to it later.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>J</b><b>Button</b> is a
component—its own little window—that will automatically get repainted as part
of an update. This means that you don’t explicitly paint a button or any other
kind of control; you simply place them on the form and let them automatically
take care of painting themselves. So to place a button on a form, you do it
inside <b>init(&nbsp;)</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Button1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Putting buttons on an
applet.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Button1 width=200 height=50&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Button1
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b1 = new
JButton(&quot;Button 1&quot;), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b2 = new
JButton(&quot;Button 2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Button1(), 200, 50);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Something new has been added here: before
any elements are placed on the content pane, it is given a new “layout
manager,” of type <b>FlowLayout</b>. The layout manager is the way that the
pane implicitly decides where to place the control on the form. The normal
behavior of an applet is to use the <b>BorderLayout</b>, but that won’t work
here because (as you will learn later in this chapter when controlling the
layout of a form is examined in more detail) it defaults to covering each
control entirely with every new one that is added. However, <b>FlowLayout</b>
causes the controls to flow evenly onto the form, left to right and top to
bottom.</span></p>

<h2><a name="_Toc481064793"></a><a name="_Toc375545448"><span lang=EN-US>Capturing
an event</span></a></h2>

<p class=MsoNormal><span
lang=EN-US>You’ll notice that if you compile and run the applet above, nothing
happens when you press the buttons. This is where you must step in and write
some code to determine what will happen. The basis of </span><span lang=EN-US>event-driven programming, which comprises a lot of what a GUI is
about, is tying events to code that responds to those events.</span></p>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>The way that this is
accomplished in Swing is by cleanly separating the interface (the graphical
components) and the implementation (the code that you want to run when an event
happens to a component). Each Swing component can report all the events that
might happen to it, and it can report each kind of event individually. So if
you’re not interested in, for example, whether the mouse is being moved over
your button, you don’t register your interest in that event. It’s a very
straightforward and elegant way to handle event-driven programming, and once
you understand the basic concepts you can easily use Swing components that you
haven’t seen before—in fact, this model extends to anything that can be
classified as a JavaBean (which you’ll learn about later in the chapter).</span></p>

<p class=MsoNormal><span lang=EN-US>At first, we will just focus on the main
event of interest for the components being used. In the case of a <b>JButton</b>,
this “event of interest” is that the button is pressed.<b> </b>To register your
interest in when a button is pressed, you call the <b>JButton</b>’s <b>addActionListener(&nbsp;)</b>
method. This method expects an argument that is an object that implements the <b>ActionListener</b>
interface, which contains a single method called <b>actionPerformed(&nbsp;)</b>.
So all you have to do to attach code to a <b>JButton</b> is to implement the <b>ActionListener</b>
interface in a class, and register an object of that class with the <b>JButton</b>
via <b>addActionListener(&nbsp;)</b>. The method will be called when the button
is pressed (this is normally referred to as a </span><span
lang=EN-US><i>callback</i>).</span></p>

<p class=MsoNormal><span lang=EN-US>But what should the result of pressing that
button be? We’d like to see something change on the screen, so a new Swing
component will be introduced: the </span><span
lang=EN-US><b>JTextField</b>. This is a place where text can be typed, or in
this case modified by the program. Although there are a number of ways to
create a <b>JTextField</b>, the simplest is just to tell the constructor how
wide you want that field to be. Once the <b>JTextField</b> is placed on the
form, you can modify its contents by using the <b>setText(&nbsp;)</b> method
(there are many other methods in <b>JTextField</b>, but you must look these up
in the HTML documentation for the JDK from <i>java.sun.com</i>). Here is what
it looks like:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Button2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Responding to button
presses.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Button2 width=200 height=75&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Button2
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b1 = new
JButton(&quot;Button 1&quot;), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b2 = new
JButton(&quot;Button 2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField txt = new
JTextField(10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class BL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String name = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((JButton)e.getSource()).getText();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      txt.setText(name);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  BL al = new BL();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b1.addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b2.addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(txt);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Button2(), 200, 75);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Creating a <b>JTextField</b> and placing it
on the canvas takes the same steps as for <b>JButton</b>s, or for any Swing
component. The difference in the above program is in the creation of the
aforementioned <b>ActionListener</b> class <b>BL</b>. The argument to <b>actionPerformed(&nbsp;)</b>
is of type <b>ActionEvent</b>, which contains all the information about the
event and where it came from. In this case, I wanted to describe the button
that was pressed: <b>getSource(&nbsp;)</b> produces the object where the event
originated, and I assumed that is a <b>JButton</b>. <b>getText(&nbsp;)</b>
returns the text that’s on the button, and this is placed in the <b>JTextField</b>
to prove that the code was actually called when the button was pressed.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>init(&nbsp;)</b>, <b>addActionListener(&nbsp;)</b>
is used to register the <b>BL</b> object with both the buttons.</span></p>

<p class=MsoNormal><span lang=EN-US>It is often more convenient to code the <b>ActionListener</b>
as an </span><span lang=EN-US>anonymous inner class, especially since you tend
to only use a single instance of each listener class. <b>Button2.java</b> can
be modified to use an anonymous inner class as follows:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Button2b.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using anonymous inner
classes.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code=Button2b
width=200 height=75&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Button2b
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b1 = new
JButton(&quot;Button 1&quot;), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b2 = new
JButton(&quot;Button 2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField txt = new
JTextField(10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  ActionListener al =
new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String name = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((JButton)e.getSource()).getText();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      txt.setText(name);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b1.addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b2.addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(txt);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Button2b(), 200, 75);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The approach of using an anonymous inner
class will be preferred (when possible) for the examples in this book.</span></p>

<h2><a name="_Toc481064794"></a><a name="_Toc375545450"><span lang=EN-US>Text
areas</span></a></h2>

<p class=MsoNormal><span lang=EN-US>A </span><span
lang=EN-US><b>J</b><b>TextArea</b> is like a <b>J</b><b>TextField</b> except
that it can have multiple lines and has more functionality. A particularly
useful method is <b>append(&nbsp;)</b>; with this you can easily pour output
into the <b>JTextArea</b>, thus making a Swing program an improvement (since
you can scroll backward) over what has been accomplished thus far using
command-line programs that print to standard output. As an example, the
following program fills a <b>JTextArea</b> with the output from the <b>geography</b>
generator in Chapter 9:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:TextArea.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using the JTextArea
control.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=TextArea width=475 height=425&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class TextArea
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b = new
JButton(&quot;Add Data&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c = new
JButton(&quot;Clear Data&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextArea t = new
JTextArea(20, 40);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Map m = new HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Use up all the
data:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Collections2.fill(m,
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Collections2.geography, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
CountryCapitals.pairs.length);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b.addActionListener(new
ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(Iterator it=
m.entrySet().iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
it.hasNext();){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Map.Entry me =
(Map.Entry)(it.next());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
t.append(me.getKey() + &quot;: &quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            + me.getValue()
+ &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
c.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t.setText(&quot;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JScrollPane(t));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
TextArea(), 475, 425);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>init(&nbsp;)</b>, the <b>Map</b> is
filled with all the countries and their capitals. Note that for both buttons
the </span><span lang=EN-US><b>ActionListener</b> is created and added without
defining an intermediate variable, since you never need to refer to that
listener again during the program. The “Add Data” button formats and appends
all the data, while the “Clear Data” button uses <b>setText(&nbsp;)</b> to
remove all the text from the <b>JTextArea</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>As the <b>JTextArea</b> is added to the
applet, it is wrapped in a </span><span
lang=EN-US><b>JScrollPane</b>, to control scrolling when too much text is
placed on the screen. That’s all you must do in order to produce full scrolling
capabilities. Having tried to figure out how to do the equivalent in some other
GUI programming environments, I am very impressed with the simplicity and good
design of components like <b>JScrollPane</b>.</span></p>

<h2><a name="_Toc481064795"><span lang=EN-US>Controlling layout</span></a></h2>

<p class=MsoNormal><span
lang=EN-US>The way that you place components on a form in Java is probably
different from any other GUI system you’ve used. First, it’s all code; there
are no “resources” that control placement of components. Second, the way components
are placed on a form is controlled not by absolute positioning but by a “layout
manager” that decides how the components lie based on the order that you <b>add(&nbsp;)</b>
them. The size, shape, and placement of components will be remarkably different
from one layout manager to another. In addition, the layout managers adapt to
the dimensions of your applet or application window, so if the window dimension
is changed, the size, shape, and placement of the components can change in
response.</span></p>

<p class=MsoNormal><span lang=EN-US><b>J</b><b>Applet</b>, <b>J</b><b>Frame
JWindow</b>, and <b>JDialog</b> can all produce a <b>Container </b>with <b>getContentPane(&nbsp;)
</b>that can contain and display <b>Component</b>s. In <b>Container,</b>
there’s a method called </span><span
lang=EN-US><b>setLayout(&nbsp;)</b> that allows you to choose a different
layout manager. Other classes, such as </span><span
lang=EN-US><b>JPanel</b>, contain and display components directly and so you
also set the layout manager directly, without using the content pane.</span></p>

<p class=MsoNormal><span lang=EN-US>In this section we’ll explore the various
layout managers by placing buttons in them (since that’s the simplest thing to
do). There won’t be any capturing of button events since these examples are
just intended to show how the buttons are laid out.</span></p>

<h3><a name="_Toc375545458"></a><a name="_Toc481064796"></a><a
name="_Toc375545459"><span lang=EN-US>BorderLayout</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The applet uses a default layout scheme:
the </span><span lang=EN-US><b>BorderLayout</b> (a number of the previous
example have changed the layout manager to <b>FlowLayout</b>). Without any
other instruction, this takes whatever you <b>add(&nbsp;) </b>to it and places
it in the center, stretching the object all the way out to the edges. </span></p>

<p class=MsoNormal><span lang=EN-US>However, there’s more to the <b>BorderLayout</b>.
This layout manager has the concept of four border regions and a center area.
When you add something to a panel that’s using a <b>BorderLayout</b> you can
use the overloaded <b>add(&nbsp;)</b> method that takes a constant value as its
first argument. This value can be any of the following:<b> </b></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><b><span lang=EN-US>BorderLayout.
NORTH </span></b><span lang=EN-US>(top)<br>
<b>BorderLayout. SOUTH</b> (bottom)<br>
<b>BorderLayout. EAST</b> (right)<br>
<b>BorderLayout. WEST</b> (left)<br>
<b>BorderLayout.CENTER</b> (fill the middle, up to the other components or to
the edges)</span></p>

<p class=MsoNormal><span lang=EN-US>If you don’t specify an area to place the
object, it defaults to <b>CENTER</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s a simple example. The default layout
is used, since <b>JApplet</b> defaults to <b>BorderLayout</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c13:BorderLayout1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates
BorderLayout.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=BorderLayout1 </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=300
height=250&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class BorderLayout1
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.NORTH, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
JButton(&quot;North&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.SOUTH, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
JButton(&quot;South&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.EAST, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
JButton(&quot;East&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.WEST, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
JButton(&quot;West&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.CENTER, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
JButton(&quot;Center&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
BorderLayout1(), 300, 250);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>For every placement but <b>CENTER</b>, the
element that you add is compressed to fit in the smallest amount of space along
one dimension while it is stretched to the maximum along the other dimension. <b>CENTER</b>,
however, spreads out in both dimensions to occupy the middle.</span></p>

<h3><a name="_Toc481064797"><span lang=EN-US>FlowLayout</span></a></h3>

<p class=MsoNormal><span lang=EN-US>This simply “flows” the components onto the
form, from left to right until the top space is full, then moves down a row and
continues flowing.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example that sets the layout
manager to <b>FlowLayout</b> and then places buttons on the form. You’ll notice
that with <b>FlowLayout</b> the components take on their “natural” size. A <b>J</b><b>Button</b>,
for example, will be the size of its string. </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:FlowLayout1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates
FlowLayout.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=FlowLayout1 </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=300
height=250&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class FlowLayout1
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 20; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cp.add(new
JButton(&quot;Button &quot; + i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
FlowLayout1(), 300, 250);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>All components will be compacted to their
smallest size in a <b>FlowLayout</b>, so you might get a little bit of
surprising behavior. For example, because a <b>JLabel</b> will be the size of
its string, attempting to right-justify its text yields an unchanged display
when using <b>FlowLayout</b>.</span></p>

<h3><a name="_Toc481064798"></a><a name="_Toc375545460"><span lang=EN-US>GridLayout</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A </span><span
lang=EN-US><b>GridLayout</b> allows you to build a table of components, and as
you add them they are placed left-to-right and top-to-bottom in the grid. In
the constructor you specify the number of rows and columns that you need and
these are laid out in equal proportions.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:GridLayout1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates
GridLayout.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code=GridLayout1
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=300
height=250&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class GridLayout1
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
GridLayout(7,3));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 20; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cp.add(new
JButton(&quot;Button &quot; + i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
GridLayout1(), 300, 250);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In this case there are 21 slots but only 20
buttons. The last slot is left empty because no “balancing” goes on with a <b>GridLayout</b>.</span></p>

<h3><a name="_Toc481064799"></a><a name="_Toc375545462"><span lang=EN-US>GridBagLayout</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The </span><span
lang=EN-US><b>GridBagLayout </b>provides you with tremendous control in
deciding exactly how the regions of your window will lay themselves out and
reformat themselves when the window is resized. However, it’s also the most
complicated layout manager, and quite difficult to understand. It is intended
primarily for automatic code generation by a GUI builder (good GUI builders
will use <b>GridBagLayout</b> instead of absolute placement). If your design is
so complicated that you feel you need to use <b>GridBagLayout</b>, then you
should be using a GUI builder tool to generate that design. If you feel you
must know the intricate details, I’ll refer you to <i>Core Java 2</i> by
Horstmann &amp; Cornell (Prentice-Hall, 1999), or a dedicated Swing book, as a
starting point.</span></p>

<h3><a name="_Toc481064800"><span lang=EN-US>Absolute positioning</span></a></h3>

<p class=MsoNormal><span lang=EN-US>It is also possible to set the </span><span
lang=EN-US>absolute position of the graphical components in this way:</span></p>

<p class=Numbered><span lang=EN-US>Set a <b>null</b> layout manager for your <b>Container</b>:
<b>setLayout(null)</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>88.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Call <b>setBounds(&nbsp;)</b> or <b>reshape(&nbsp;)</b> (depending
on the language version) for each component, passing a bounding rectangle in
pixel coordinates. You can do this in the constructor, or in <b>paint(&nbsp;)</b>,
depending on what you want to achieve.</span></p>

<p class=MsoNormal><span lang=EN-US>Some GUI builders use this approach
extensively, but this is usually not the best way to generate code. More useful
GUI builders will use <b>GridBagLayout</b> instead.</span></p>

<h3><a name="_Toc481064801"><span lang=EN-US>BoxLayout</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Because people had so much trouble understanding
and working with <b>GridBagLayout</b>, Swing also includes the <b>BoxLayout</b>,
which gives you many of the benefits of <b>GridBagLayout</b> without the
complexity, so you can often use it when you need to do hand-coded layouts
(again, if your design becomes too complex, use a GUI builder that generates <b>GridBagLayout</b>s
for you). <b>BoxLayout</b> allows you to control the placement of components
either vertically or horizontally, and to control the space between the
components using something called “</span><span
lang=EN-US>struts and </span><span
lang=EN-US>glue.” First, let’s see how to use the <b>BoxLayout</b> directly, in
the same way that the other layout managers have been demonstrated:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:BoxLayout1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Vertical and
horizontal BoxLayouts.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=BoxLayout1 </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=450
height=200&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class BoxLayout1
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel jpv = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jpv.setLayout(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new BoxLayout(jpv,
BoxLayout.Y_AXIS));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 5; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      jpv.add(new
JButton(&quot;&quot; + i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel jph = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jph.setLayout(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new BoxLayout(jph,
BoxLayout.X_AXIS));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 5; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      jph.add(new
JButton(&quot;&quot; + i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.EAST, jpv);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.SOUTH, jph);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
BoxLayout1(), 450, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The constructor for <b>BoxLayout</b> is a
bit different than the other layout managers—you provide the <b>Container</b>
that is to be controlled by the <b>BoxLayout</b> as the first argument, and the
direction of the layout as the second argument.</span></p>

<p class=MsoNormal><span lang=EN-US>To simplify matters, there’s a special
container called </span><span lang=EN-US><b>Box</b> that uses <b>BoxLayout</b>
as its native manager. The following example lays out components horizontally
and vertically using <b>Box</b>, which has two <b>static</b> methods to create
boxes with vertical and horizontal alignment:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Box1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Vertical and horizontal
BoxLayouts.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code=Box1 </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=450
height=200&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Box1
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Box bv =
Box.createVerticalBox();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 5; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      bv.add(new
JButton(&quot;&quot; + i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Box bh =
Box.createHorizontalBox();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 5; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      bh.add(new
JButton(&quot;&quot; + i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.EAST, bv);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(BorderLayout.SOUTH,
bh);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Box1(), 450, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Once you have a <b>Box</b>, you pass it as
a second argument when adding components to the content pane.</span></p>

<p class=MsoNormal><span lang=EN-US>Struts add space between components,
measured in pixels. To use a strut, you simply add it in between the addition
of the components that you want spaced apart:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Box2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Adding struts.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code=Box2 </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=450
height=300&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Box2
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Box bv =
Box.createVerticalBox();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 5; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      bv.add(new
JButton(&quot;&quot; + i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
bv.add(Box.createVerticalStrut(i*10));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Box bh = Box.createHorizontalBox();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 5; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      bh.add(new
JButton(&quot;&quot; + i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
bh.add(Box.createHorizontalStrut(i*10));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.EAST, bv);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.SOUTH, bh);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Box2(), 450, 300);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Struts separate components by a fixed
amount, but glue is the opposite: it separates components by as much as
possible. Thus it’s more of a “spring” than “glue” (and the design on which
this was based was called “springs and struts” so the choice of the term is a
bit mysterious).</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Box3.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using Glue.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code=Box3 </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=450
height=300&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Box3
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Box bv =
Box.createVerticalBox();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bv.add(new
JLabel(&quot;Hello&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
bv.add(Box.createVerticalGlue());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bv.add(new
JLabel(&quot;Applet&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
bv.add(Box.createVerticalGlue());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bv.add(new
JLabel(&quot;World&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Box bh =
Box.createHorizontalBox();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bh.add(new
JLabel(&quot;Hello&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
bh.add(Box.createHorizontalGlue());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bh.add(new
JLabel(&quot;Applet&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
bh.add(Box.createHorizontalGlue());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bh.add(new
JLabel(&quot;World&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
bv.add(Box.createVerticalGlue());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bv.add(bh);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
bv.add(Box.createVerticalGlue());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
getContentPane().add(bv);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Box3(), 450, 300);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>A strut works in one direction, but a rigid
area fixes the spacing between components in both directions:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Box4.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Rigid Areas are like
pairs of struts.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code=Box4 </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=450
height=300&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Box4
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Box bv =
Box.createVerticalBox();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bv.add(new
JButton(&quot;Top&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
bv.add(Box.createRigidArea(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Dimension(120,
90)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bv.add(new
JButton(&quot;Bottom&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Box bh = Box.createHorizontalBox();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bh.add(new
JButton(&quot;Left&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
bh.add(Box.createRigidArea(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Dimension(160,
80)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bh.add(new
JButton(&quot;Right&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bv.add(bh);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
getContentPane().add(bv);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Box4(), 450, 300);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You should be aware that rigid areas are a
bit controversial. Since they use absolute values, some people feel that they
cause more trouble than they are worth.</span></p>

<h3><a name="_Toc481064802"><span lang=EN-US>The best approach?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Swing is powerful; it can get a lot done
with a few lines of code. The examples shown in this book are reasonably
simple, and for learning purposes it makes sense to write them by hand. You can
actually accomplish quite a bit by combining simple layouts. At some point,
however, it stops making sense to hand-code GUI forms—it becomes too
complicated and is not a good use of your programming time. The Java and Swing
designers oriented the language and libraries to support GUI building tools,
which have been created for the express purpose of making your programming
experience easier. As long as you understand what’s going on with layouts and
how to deal with the events (described next), it’s not particularly important
that you actually know the details of how to lay out components by hand—let the
appropriate tool do that for you (Java is, after all, designed to increase
programmer productivity).</span></p>

<h2><a name="_Toc481064803"><span lang=EN-US>The Swing event model</span></a></h2>

<p class=MsoNormal><span
lang=EN-US>In the Swing event model a component can initiate (“fire”) an event.
Each type of event is represented by a distinct class. When an event is fired,
it is received by one or more “listeners,” which act on that event. Thus, the
source of an event and the place where the event is handled can be separate.
Since you typically use Swing components as they are, but need to write code
that is called when the components receive an event, this is an excellent
example of the separation of interface and implementation.</span></p>

<p class=MsoNormal><span lang=EN-US>Each event listener is an object of a class
that implements a particular type of listener <b>interface</b>. So as a
programmer, all you do is create a listener object and register it with the
component that’s firing the event. This registration is performed by calling an
<b>addXXXListener(&nbsp;)</b> method in the event-firing component, in which “<b>XXX</b>”
represents the type of event listened for. You can easily know what types of
events can be handled by noticing the names of the “addListener” methods, and
if you try to listen for the wrong events you’ll discover your mistake at
compile-time. You’ll see later in the chapter that JavaBeans also use the names
of the “addListener” methods to determine what events a Bean can handle.</span></p>

<p class=MsoNormal><span lang=EN-US>All of your event logic, then, will go
inside a listener class. When you create a listener class, the sole restriction
is that it must implement the appropriate interface. You can create a global
listener class, but this is a situation in which </span><span lang=EN-US>inner classes tend to be quite useful, not only because they provide
a logical grouping of your listener classes inside the UI or business logic
classes they are serving, but because (as you shall see later) the fact that an
inner class object keeps a reference to its parent object provides a nice way
to call across class and subsystem boundaries.</span></p>

<p class=MsoNormal><span lang=EN-US>All the examples so far in this chapter
have been using the Swing event model, but the remainder of this section will
fill out the details of that model.</span></p>

<h3><a name="_Toc481064804"><span lang=EN-US>Event and listener types</span></a></h3>

<p class=MsoNormal><span lang=EN-US>All Swing components include <b>addXXXListener(&nbsp;)</b>
and <b>removeXXXListener(&nbsp;)</b> methods so that the appropriate types of
listeners can be added and removed from each component. You’ll notice that the
“<b>XXX</b>” in each case also represents the argument for the method, for
example: <b>addMyListener(MyListener m)</b>. The following table includes the
basic associated events, listeners, and methods, along with the basic
components that support those particular events by providing the </span><span lang=EN-US><b>addXXXListener(&nbsp;)</b> and </span><span
lang=EN-US><b>removeXXXListener(&nbsp;)</b> methods. You should keep in mind
that the event model is designed to be extensible, so you may encounter other </span><span lang=EN-US>events and listener types that are not covered in this table.</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=486
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr>
   <td width=243 valign=top style='width:182.35pt;border:solid black 1.5pt;
   border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US style='font-size:10.0pt'>Event, listener
   interface and add- and remove-methods</span></p>
   </td>
   <td width=243 valign=top style='width:182.3pt;border:solid black 1.5pt;
   border-left:none;padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US style='font-size:10.0pt'>Components
   supporting this event</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td width=243 valign=top style='width:182.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>ActionEvent<br>
  ActionListener<br>
  addActionListener(&nbsp;)<br>
  removeActionListener(&nbsp;)</span></p>
  </td>
  <td width=243 valign=top style='width:182.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>JButton, JList,
  JTextField, JMenuItem </span><span lang=EN-US style='font-size:10.0pt;
  font-weight:normal'>and its derivatives</span><span lang=EN-US
  style='font-size:10.0pt'> </span><span lang=EN-US style='font-size:10.0pt;
  font-weight:normal'>including</span><span lang=EN-US style='font-size:10.0pt'>
  JCheckBoxMenuItem, JMenu, </span><span lang=EN-US style='font-size:10.0pt;
  font-weight:normal'>and</span><span lang=EN-US style='font-size:10.0pt'>
  JpopupMenu.</span></p>
  </td>
 </tr>
 <tr>
  <td width=243 valign=top style='width:182.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>AdjustmentEvent<br>
  AdjustmentListener<br>
  addAdjustmentListener(&nbsp;)<br>
  removeAdjustmentListener(&nbsp;)</span></p>
  </td>
  <td width=243 valign=top style='width:182.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>JScrollbar<br>
  </span><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>and
  anything you create that implements the</span><span lang=EN-US
  style='font-size:10.0pt'> Adjustable interface.</span></p>
  </td>
 </tr>
 <tr>
  <td width=243 valign=top style='width:182.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>ComponentEvent<br>
  ComponentListener<br>
  addComponentListener(&nbsp;)<br>
  removeComponentListener(&nbsp;)</span></p>
  </td>
  <td width=243 valign=top style='width:182.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>*Component </span><span
  lang=EN-US style='font-size:10.0pt;font-weight:normal'>and its derivatives,
  including </span><span lang=EN-US style='font-size:10.0pt'>JButton, JCanvas,
  JCheckBox, JComboBox, Container, JPanel, JApplet, JScrollPane, Window,
  JDialog, JFileDialog, JFrame, JLabel, JList, JScrollbar, JTextArea, </span><span
  lang=EN-US style='font-size:10.0pt;font-weight:normal'>and</span><span
  lang=EN-US style='font-size:10.0pt'> JTextField.</span></p>
  </td>
 </tr>
 <tr>
  <td width=243 valign=top style='width:182.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>ContainerEvent<br>
  ContainerListener<br>
  addContainerListener(&nbsp;)<br>
  removeContainerListener(&nbsp;)</span></p>
  </td>
  <td width=243 valign=top style='width:182.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>Container </span><span
  lang=EN-US style='font-size:10.0pt;font-weight:normal'>and its derivatives,
  including</span><span lang=EN-US style='font-size:10.0pt'> JPanel, JApplet,
  JScrollPane, Window, JDialog, JFileDialog, </span><span lang=EN-US
  style='font-size:10.0pt;font-weight:normal'>and</span><span lang=EN-US
  style='font-size:10.0pt'> JFrame.</span></p>
  </td>
 </tr>
 <tr>
  <td width=243 valign=top style='width:182.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>FocusEvent<br>
  FocusListener<br>
  addFocusListener(&nbsp;)<br>
  removeFocusListener(&nbsp;)</span></p>
  </td>
  <td width=243 valign=top style='width:182.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>Component </span><span
  lang=EN-US style='font-size:10.0pt;font-weight:normal'>and</span><span
  lang=EN-US style='font-size:10.0pt'> derivatives*.</span></p>
  </td>
 </tr>
 <tr>
  <td width=243 valign=top style='width:182.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>KeyEvent<br>
  KeyListener<br>
  addKeyListener(&nbsp;)<br>
  removeKeyListener(&nbsp;)</span></p>
  </td>
  <td width=243 valign=top style='width:182.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>Component </span><span
  lang=EN-US style='font-size:10.0pt;font-weight:normal'>and</span><span
  lang=EN-US style='font-size:10.0pt'> derivatives*.</span></p>
  </td>
 </tr>
 <tr>
  <td width=243 valign=top style='width:182.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>MouseEvent </span><span
  lang=EN-US style='font-size:10.0pt;font-weight:normal'>(for both clicks and
  motion)<br>
  </span><span lang=EN-US style='font-size:10.0pt'>MouseListener<br>
  addMouseListener(&nbsp;)<br>
  removeMouseListener(&nbsp;)</span></p>
  </td>
  <td width=243 valign=top style='width:182.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>Component </span><span
  lang=EN-US style='font-size:10.0pt;font-weight:normal'>and</span><span
  lang=EN-US style='font-size:10.0pt'> derivatives*. </span></p>
  </td>
 </tr>
 <tr>
  <td width=243 valign=top style='width:182.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>MouseEvent<a
  href="#_ftn68" name="_ftnref68" title=""><span class=MsoFootnoteReference><span
  class=MsoFootnoteReference><b><span lang=EN-US style='font-size:10.0pt;
  font-family:"Georgia","serif"'>[68]</span></b></span></span></a> </span><span
  lang=EN-US style='font-size:10.0pt;font-weight:normal'>(for both clicks and
  motion)<br>
  </span><span lang=EN-US style='font-size:10.0pt'>MouseMotionListener<br>
  addMouseMotionListener(&nbsp;)<br>
  removeMouseMotionListener(&nbsp;)</span></p>
  </td>
  <td width=243 valign=top style='width:182.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>Component </span><span
  lang=EN-US style='font-size:10.0pt;font-weight:normal'>and</span><span
  lang=EN-US style='font-size:10.0pt'> derivatives*.</span></p>
  </td>
 </tr>
 <tr>
  <td width=243 valign=top style='width:182.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>WindowEvent<br>
  WindowListener<br>
  addWindowListener(&nbsp;)<br>
  removeWindowListener(&nbsp;)</span></p>
  </td>
  <td width=243 valign=top style='width:182.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>Window </span><span
  lang=EN-US style='font-size:10.0pt;font-weight:normal'>and its derivatives,
  including</span><span lang=EN-US style='font-size:10.0pt'> JDialog,
  JFileDialog, and JFrame.</span></p>
  </td>
 </tr>
 <tr>
  <td width=243 valign=top style='width:182.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>ItemEvent<br>
  ItemListener<br>
  addItemListener(&nbsp;)<br>
  removeItemListener(&nbsp;)</span></p>
  </td>
  <td width=243 valign=top style='width:182.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>JCheckBox,
  JCheckBoxMenuItem, JComboBox, JList, </span><span lang=EN-US
  style='font-size:10.0pt;font-weight:normal'>and anything that implements the </span><span
  lang=EN-US style='font-size:10.0pt'>ItemSelectable interface.</span></p>
  </td>
 </tr>
 <tr>
  <td width=243 valign=top style='width:182.35pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt'>TextEvent<br>
  TextListener<br>
  addTextListener(&nbsp;)<br>
  removeTextListener(&nbsp;)</span></p>
  </td>
  <td width=243 valign=top style='width:182.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>Anything
  derived from</span><span lang=EN-US style='font-size:10.0pt'> JTextComponent,
  </span><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>including</span><span
  lang=EN-US style='font-size:10.0pt'> JTextArea </span><span lang=EN-US
  style='font-size:10.0pt;font-weight:normal'>and</span><span lang=EN-US
  style='font-size:10.0pt'> JTextField.</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>You can see that each type of component
supports only certain types of events. It turns out to be rather difficult to
look up all the events supported by each component. A simpler approach is to
modify the <b>ShowMethodsClean.java</b> program from Chapter 12 so that it
displays all the event listeners supported by any Swing component that you
enter.</span></p>

<p class=MsoNormal><span lang=EN-US>Chapter 12 introduced </span><span lang=EN-US><i>reflection</i> and used that feature to look up methods for a
particular class—either the entire list of methods or a subset of those whose
names match a keyword that you provide. The magic of this is that it can
automatically show you <i>all</i> the methods for a class without forcing you
to walk up the inheritance hierarchy examining the base classes at each level.
Thus, it provides a valuable timesaving tool for programming: because the names
of most Java methods are made nicely verbose and descriptive, you can search
for the method names that contain a particular word of interest. When you find
what you think you’re looking for, check the online documentation.</span></p>

<p class=MsoNormal><span lang=EN-US>However, by Chapter 12 you hadn’t seen
Swing, so the tool in that chapter was developed as a command-line application.
Here is the more useful GUI version, specialized to look for the “addListener”
methods in Swing components: </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c13:ShowAddListeners.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Display the
&quot;addXXXListener&quot; methods of any </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Swing class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code =
ShowAddListeners </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=500
height=400&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
java.lang.reflect.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ShowAddListeners extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Class cl;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Method[] m;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Constructor[] ctor;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String[] n = new String[0];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField name = new
JTextField(25);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextArea results =
new JTextArea(40, 65);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class NameL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String nm =
name.getText().trim();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(nm.length() ==
0) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
results.setText(&quot;No match&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        n = new
String[0];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        return;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        cl =
Class.forName(&quot;javax.swing.&quot; + nm);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(ClassNotFoundException ex) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
results.setText(&quot;No match&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        return;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      m =
cl.getMethods();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Convert to an
array of Strings:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      n = new
String[m.length];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; m.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        n[i] =
m[i].toString();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      reDisplay();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  } </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void reDisplay() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Create the result
set:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String[] rs = new
String[n.length];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int j = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for (int i = 0; i
&lt; n.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(n[i].indexOf(&quot;add&quot;) != -1 &amp;&amp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
n[i].indexOf(&quot;Listener&quot;) != -1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          rs[j++] = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
n[i].substring(n[i].indexOf(&quot;add&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
results.setText(&quot;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for (int i = 0; i
&lt; j; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      results.append(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
StripQualifiers.strip(rs[i]) + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
name.addActionListener(new NameL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel top = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    top.add(new JLabel(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Swing class
name (press ENTER):&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    top.add(name);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.NORTH, top);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JScrollPane(results));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
ShowAddListeners(), 500,400);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>StripQualifiers</b> class defined in
Chapter 12 is reused here by importing the <b>com.bruceeckel.util</b> library.</span></p>

<p class=MsoNormal><span lang=EN-US>The GUI contains a<b> JText</b><b>Field</b>
<b>name </b>in which you can enter the Swing class name you want to look up.
The results are displayed in a<b> JText</b><b>Area</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll notice that there are no buttons or
other components by which to indicate that you want the search to begin. That’s
because the<b> JText</b><b>Field</b> is monitored by an <b>ActionListener</b>.
Whenever you make a change and press ENTER, the list is immediately updated. If
the text isn’t empty, it is used inside </span><span lang=EN-US><b>Class.forName(&nbsp;)</b> to try to look up the class. If the name
is incorrect, <b>Class.forName(&nbsp;)</b> will fail, which means that it
throws an exception. This is trapped and the<b> JText</b><b>Area</b> is set to
“No match.” But if you type in a correct name (capitalization counts), <b>Class.forName(&nbsp;)</b>
is successful and <b>getMethods(&nbsp;)</b> will return an array of <b>Method</b>
objects. Each of the objects in the array is turned into a <b>String</b> via <b>toString(&nbsp;)</b>
(this produces the complete method signature) and added to <b>n</b>, a <b>String</b>
array. The array <b>n</b> is a member of <b>class ShowAddListeners</b> and is
used in updating the display whenever <b>reDisplay(&nbsp;)</b> is called.</span></p>

<p class=MsoNormal><b><span lang=EN-US>reDisplay(&nbsp;)</span></b><span
lang=EN-US> creates an array of <b>String</b> called <b>rs</b> (for “result
set”). The result set is conditionally copied from the <b>String</b>s in <b>n</b>
that contain “add” and “Listener.” <b>indexOf(&nbsp;) </b>and <b>substring(&nbsp;)
</b>are then used to remove the qualifiers like <b>public</b>, <b>static</b>,
etc. Finally, <b>StripQualifiers.strip(&nbsp;)</b> removes the extra name
qualifiers.</span></p>

<p class=MsoNormal><span lang=EN-US>This program is a convenient way to
investigate the capabilities of a Swing component. Once you know which events a
particular component supports, you don’t need to look anything up to react to
that event. You simply:</span></p>

<p class=Numbered><span lang=EN-US>Take the name of the event class and remove
the word “<b>Event</b>.” Add the word “<b>Listener</b>” to what remains. This
is the listener interface you must implement in your inner class. </span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>89.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Implement the interface above and write out the methods for the
events you want to capture. For example, you might be looking for mouse
movements, so you write code for the <b>mouseMoved(&nbsp;)</b> method of the <b>MouseMotionListener</b>
interface. (You must implement the other methods, of course, but there’s often
a shortcut for that which you’ll see soon.)</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>90.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Create an object of the listener class in Step 2. Register it with
your component with the method produced by prefixing “<b>add</b>” to your
listener name. For example, <b>addMouseMotionListener(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Here are some of the </span><span lang=EN-US>listener interfaces: </span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=510
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr>
   <td width=192 valign=top style='width:144.0pt;border-top:1.5pt;border-left:
   1.5pt;border-bottom:1.0pt;border-right:1.0pt;border-color:black;border-style:
   solid;padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Listener interface<br>
   w/ adapter</span></p>
   </td>
   <td width=318 valign=top style='width:238.65pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Methods in interface</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>ActionListener</span></p>
  </td>
  <td width=318 valign=top style='width:238.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>actionPerformed(ActionEvent)</span></p>
  </td>
 </tr>
 <tr>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>AdjustmentListener</span></p>
  </td>
  <td width=318 valign=top style='width:238.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>adjustmentValueChanged(<br>
    AdjustmentEvent)</span></p>
  </td>
 </tr>
 <tr>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>ComponentListener<br>
  ComponentAdapter</span></p>
  </td>
  <td width=318 valign=top style='width:238.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>componentHidden(ComponentEvent)<br>
  componentShown(ComponentEvent)<br>
  componentMoved(ComponentEvent)<br>
  componentResized(ComponentEvent)</span></p>
  </td>
 </tr>
 <tr>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>ContainerListener<br>
  ContainerAdapter</span></p>
  </td>
  <td width=318 valign=top style='width:238.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>componentAdded(ContainerEvent)<br>
  componentRemoved(ContainerEvent)</span></p>
  </td>
 </tr>
 <tr>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>FocusListener<br>
  FocusAdapter</span></p>
  </td>
  <td width=318 valign=top style='width:238.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>focusGained(FocusEvent)<br>
  focusLost(FocusEvent)</span></p>
  </td>
 </tr>
 <tr>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>KeyListener<br>
  KeyAdapter</span></p>
  </td>
  <td width=318 valign=top style='width:238.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>keyPressed(KeyEvent)<br>
  keyReleased(KeyEvent)<br>
  keyTyped(KeyEvent)</span></p>
  </td>
 </tr>
 <tr>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>MouseListener<br>
  MouseAdapter</span></p>
  </td>
  <td width=318 valign=top style='width:238.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>mouseClicked(MouseEvent)<br>
  mouseEntered(MouseEvent)<br>
  mouseExited(MouseEvent)<br>
  mousePressed(MouseEvent)<br>
  mouseReleased(MouseEvent)</span></p>
  </td>
 </tr>
 <tr>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>MouseMotionListener<br>
  MouseMotionAdapter</span></p>
  </td>
  <td width=318 valign=top style='width:238.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>mouseDragged(MouseEvent)<br>
  mouseMoved(MouseEvent)</span></p>
  </td>
 </tr>
 <tr>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>WindowListener<br>
  WindowAdapter</span></p>
  </td>
  <td width=318 valign=top style='width:238.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>windowOpened(WindowEvent)<br>
  windowClosing(WindowEvent) <br>
  windowClosed(WindowEvent) <br>
  windowActivated(WindowEvent) <br>
  windowDeactivated(WindowEvent) <br>
  windowIconified(WindowEvent) <br>
  windowDeiconified(WindowEvent)</span></p>
  </td>
 </tr>
 <tr>
  <td width=192 valign=top style='width:144.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>ItemListener</span></p>
  </td>
  <td width=318 valign=top style='width:238.65pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>itemStateChanged(ItemEvent)</span></p>
  </td>
 </tr>
</table>

</div>

<p class=AfterTable><span lang=EN-US>This is not an exhaustive listing, partly
because the event model allows you to create your own event types and
associated listeners. Thus, you’ll regularly come across libraries that have
invented their own events, and the knowledge gained in this chapter will allow
you to figure out how to use these events.</span></p>

<h4 style='margin-top:9.0pt'><span lang=EN-US>Using listener adapters for
simplicity</span></h4>

<p class=MsoNormal><span
lang=EN-US>In the table above, you can see that some listener interfaces have
only one method. These are trivial to implement since you’ll implement them
only when you want to write that particular method. However, the listener interfaces
that have multiple methods can be less pleasant to use. For example, something
you must always do when creating an application is provide a <b>WindowListener</b>
to the <b>JFrame</b> so that when you get the <b>windowClosing(&nbsp;)</b>
event you can call <b>System.exit(&nbsp;)</b> to exit the application. But
since <b>WindowListener</b> is an <b>interface</b>, you must implement all of
the other methods even if they don’t do anything. This can be annoying.</span></p>

<p class=MsoNormal><span lang=EN-US>To solve the problem, some (but not all) of
the listener interfaces that have more than one method are provided with <i>adapters</i>,
the names of which you can see in the table above. Each adapter provides
default empty methods for each of the interface methods. Then all you need to
do is inherit from the adapter and override only the methods you need to
change. For example, the typical <b>WindowListener</b> you’ll use looks like
this (remember that this has been wrapped inside the <b>Console</b> class in <b>com.bruceeckel.swing</b>):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MyWindowListener
extends WindowAdapter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
windowClosing(WindowEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.exit(0);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The whole point of the adapters is to make
the creation of listener classes easy.</span></p>

<p class=MsoNormal><span lang=EN-US>There is a downside to adapters, however,
in the form of a pitfall. Suppose you write a <b>WindowAdapter</b> like the one
above:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MyWindowListener
extends WindowAdapter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
WindowClosing(WindowEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.exit(0);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This doesn’t work, but it will drive you
crazy trying to figure out why, since everything will compile and run
fine—except that closing the window won’t exit the program. Can you see the
problem? It’s in the name of the method: <b>WindowClosing(&nbsp;)</b> instead
of <b>windowClosing(&nbsp;)</b>. A simple slip in capitalization results in the
addition of a completely new method. However, this is not the method that’s
called when the window is closing, so you don’t get the desired results.
Despite the inconvenience, an <b>interface</b> will guarantee that the methods
are properly implemented.</span></p>

<h3><a name="_Toc375545452"></a><a name="_Toc481064805"><span lang=EN-US>Tracking
multiple events</span></a></h3>

<p class=MsoNormal><span lang=EN-US>To prove to yourself that these events are
in fact being fired, and as an interesting experiment, it’s worth creating an
applet that tracks extra behavior in a <b>JButton </b>(other than just whether
it’s pressed or not). This example also shows you how to inherit your own
button object because that’s what is used as the target of all the events of
interest. To do so, you can just inherit from</span><span
lang=EN-US> <b>J</b><b>Button</b>.</span><a href="#_ftn69" name="_ftnref69"
title=""><span class=MsoFootnoteReference><b><span lang=EN-US style='font-size:
8.0pt'><span class=MsoFootnoteReference><b><span lang=EN-US style='font-size:
8.0pt;font-family:"Georgia","serif"'>[69]</span></b></span></span></b></span></a><span
lang=EN-US> </span></p>

<p class=MsoNormal><span lang=EN-US>The <b>MyButton</b> class is an inner class
of <b>TrackEvent</b>, so <b>MyButton</b> can reach into the parent window and
manipulate its text fields, which is what’s necessary to be able to write the
status information into the fields of the parent. Of course this is a limited
solution, since <b>myButton</b> can be used only in conjunction with <b>TrackEvent</b>.
This kind of code is sometimes called “highly coupled”: </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:TrackEvent.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Show events as they
happen.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=TrackEvent</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//  width=700
height=500&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class TrackEvent
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  HashMap h = new
HashMap();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String[] event = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;focusGained&quot;, &quot;focusLost&quot;, &quot;keyPressed&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;keyReleased&quot;, &quot;keyTyped&quot;, &quot;mouseClicked&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;mouseEntered&quot;, &quot;mouseExited&quot;,&quot;mousePressed&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;mouseReleased&quot;, &quot;mouseDragged&quot;, &quot;mouseMoved&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  MyButton</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b1 = new
MyButton(Color.blue, &quot;test1&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b2 = new
MyButton(Color.red, &quot;test2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class MyButton extends
JButton {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    void report(String
field, String msg) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
((JTextField)h.get(field)).setText(msg);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    FocusListener fl =
new FocusListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
focusGained(FocusEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
report(&quot;focusGained&quot;, e.paramString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
focusLost(FocusEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
report(&quot;focusLost&quot;, e.paramString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    KeyListener kl = new
KeyListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
keyPressed(KeyEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
report(&quot;keyPressed&quot;, e.paramString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
keyReleased(KeyEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
report(&quot;keyReleased&quot;, e.paramString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
keyTyped(KeyEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
report(&quot;keyTyped&quot;, e.paramString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MouseListener ml =
new MouseListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
mouseClicked(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
report(&quot;mouseClicked&quot;, e.paramString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
mouseEntered(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
report(&quot;mouseEntered&quot;, e.paramString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
mouseExited(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
report(&quot;mouseExited&quot;, e.paramString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
mousePressed(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
report(&quot;mousePressed&quot;, e.paramString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
mouseReleased(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
report(&quot;mouseReleased&quot;, e.paramString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MouseMotionListener
mml = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
MouseMotionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
mouseDragged(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
report(&quot;mouseDragged&quot;, e.paramString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
mouseMoved(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
report(&quot;mouseMoved&quot;, e.paramString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public
MyButton(Color color, String label) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      super(label);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
setBackground(color);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
addFocusListener(fl);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
addKeyListener(kl);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
addMouseListener(ml);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
addMouseMotionListener(mml);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container c =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.setLayout(new
GridLayout(event.length+1,2));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; event.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JTextField t = new
JTextField();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t.setEditable(false);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      c.add(new JLabel(event[i],
JLabel.RIGHT));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      c.add(t);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      h.put(event[i],
t);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.add(b1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.add(b2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
TrackEvent(), 700, 500);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In the <b>MyButton</b> constructor, the
button’s color is set with a call to <b>SetBackground(&nbsp;)</b>. The
listeners are all installed with simple method calls.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>TrackEvent</b> class contains a </span><span lang=EN-US><b>HashMap</b> to hold the strings representing the type of event and
<b>JText</b><b>Field</b>s where information about that event is held. Of
course, these could have been created statically rather than putting them in a <b>HashMap</b>,
but I think you’ll agree that it’s a lot easier to use and change. In
particular, if you need to add or remove a new type of event in <b>TrackEvent</b>,
you simply add or remove a string in the <b>event</b> array—everything else
happens automatically.</span></p>

<p class=MsoNormal><span lang=EN-US>When <b>report(&nbsp;)</b> is called it is
given the name of the event and the parameter string from the event. It uses
the <b>HashMap h </b>in the outer class to look up the actual <b>JTextField </b>associated
with that event name, and then places the parameter string into that field.</span></p>

<p class=MsoNormal><span lang=EN-US>This example is fun to play with since you
can really see what’s going on with the events in your program.</span></p>

<h2><a name="_Toc481064806"><span lang=EN-US>A catalog of Swing components</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Now that you understand layout managers and
the event model, you’re ready to see how Swing components can be used. This
section is a nonexhaustive tour of the Swing components and features that
you’ll probably use most of the time. Each example is intended to be reasonably
small so that you can easily lift the code and use it in your own programs.</span></p>

<p class=MsoNormal><span lang=EN-US>You can easily see what each of these
examples looks like while running by viewing the HTML pages in the downloadable
source code for this chapter.</span></p>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>Keep in mind: </span></p>

<p class=Numbered><span lang=EN-US>The HTML documentation from <i>java.sun.com</i>
contains all of the Swing classes and methods (only a few are shown here). </span></p>

<p class=Numbered><span lang=EN-US>Because of the naming convention used for
Swing events, it’s fairly easy to guess how to write and install a handler for
a particular type of event. Use the lookup program <b>ShowAddListeners.java</b>
from earlier in this chapter to aid in your investigation of a particular
component.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>91.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>When things start to get complicated you should graduate to a GUI
builder.</span></p>

<h3><a name="_Toc481064807"><span lang=EN-US>Buttons</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Swing includes a number of different types
of </span><span lang=EN-US>buttons. All buttons, check boxes, radio buttons,
and even menu items are inherited from </span><span
lang=EN-US><b>AbstractButton</b> (which, since menu items are included, would
probably have been better named “AbstractChooser” or something equally
general). You’ll see the use of menu items shortly, but the following example
shows the various types of buttons available:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Buttons.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Various Swing
buttons.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Buttons</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//  width=350
height=100&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.plaf.basic.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.border.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Buttons
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton jb = new
JButton(&quot;JButton&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  BasicArrowButton</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    up = new
BasicArrowButton(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
BasicArrowButton.NORTH),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    down = new
BasicArrowButton(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
BasicArrowButton.SOUTH),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    right = new
BasicArrowButton(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
BasicArrowButton.EAST),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    left = new
BasicArrowButton(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
BasicArrowButton.WEST);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(jb);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JToggleButton(&quot;JToggleButton&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JCheckBox(&quot;JCheckBox&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JRadioButton(&quot;JRadioButton&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel jp = new JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jp.setBorder(new
TitledBorder(&quot;Directions&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jp.add(up);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jp.add(down);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jp.add(left);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jp.add(right);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(jp);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Buttons(), 350, 100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This begins with the </span><span lang=EN-US><b>BasicArrowButton</b> from <b>javax.swing.plaf.basic</b>, then
continues with the various specific types of buttons. When you run the example,
you’ll see that the toggle button holds its last position, in or out. But the
check boxes and radio buttons behave identically to each other, just clicking
on or off (they are inherited from </span><span
lang=EN-US><b>JToggleButton</b>). </span></p>

<h4><span lang=EN-US>Button groups</span></h4>

<p class=MsoNormal><span lang=EN-US>If you want radio buttons to behave in an
“exclusive or” fashion, you must add them to a “button group.” But, as the
example below demonstrates, any <b>AbstractButton</b> can be added to a <b>ButtonGroup</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>To avoid repeating a lot of code, this
example uses </span><span lang=EN-US>reflection to generate the groups of
different types of buttons. This is seen in <b>makeBPanel(&nbsp;)</b>, which
creates a button group and a </span><span lang=EN-US><b>JPanel</b>. The second
argument to <b>makeBPanel(&nbsp;)</b> is an array of <b>String</b>. For each <b>String</b>,
a button of the class represented by the first argument is added to the <b>JPanel</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:ButtonGroups.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Uses reflection to
create groups </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// of different types of
AbstractButton.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=ButtonGroups</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//  width=500
height=300&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.border.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
java.lang.reflect.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ButtonGroups extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static String[] ids =
{ </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;June&quot;,
&quot;Ward&quot;, &quot;Beaver&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Wally&quot;,
&quot;Eddie&quot;, &quot;Lumpy&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static JPanel </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  makeBPanel(Class
bClass, String[] ids) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ButtonGroup bg = new
ButtonGroup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel jp = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String title =
bClass.getName();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    title =
title.substring(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
title.lastIndexOf('.') + 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jp.setBorder(new
TitledBorder(title));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; ids.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      AbstractButton ab
= new JButton(&quot;failed&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // Get the
dynamic constructor method</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // that takes a
String argument:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        Constructor ctor
= bClass.getConstructor(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new Class[] {
String.class });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // Create a new
object:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        ab =
(AbstractButton)ctor.newInstance(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
Object[]{ids[i]});</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } catch(Exception
ex) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;can't create &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          bClass);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      bg.add(ab);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      jp.add(ab);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return jp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(makeBPanel(JButton.class, ids));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(makeBPanel(JToggleButton.class, ids));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(makeBPanel(JCheckBox.class, ids));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(makeBPanel(JRadioButton.class,
ids));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
ButtonGroups(), 500, 300);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The title for the border is taken from the
name of the class, stripping off all the path information. The <b>AbstractButton</b>
is initialized to a <b>JButton</b> that has the label “Failed” so if you ignore
the exception message, you’ll still see the problem on screen. The </span><span lang=EN-US><b>getConstructor(&nbsp;)</b> method produces a <b>Constructor</b> object
that takes the array of arguments of the types in the </span><span lang=EN-US><b>Class </b>array passed to <b>getConstructor(&nbsp;)</b>. Then all
you do is call </span><span
lang=EN-US><b>newInstance(&nbsp;)</b>, passing it an array of <b>Object</b> containing
your actual arguments—in this case, just the <b>String</b> from the <b>ids</b>
array.</span></p>

<p class=MsoNormal><span lang=EN-US>This adds a little complexity to what is a
simple process. To get “exclusive or” behavior with buttons, you create a
button group and add each button for which you want that behavior to the group.
When you run the program, you’ll see that all the buttons except <b>JButton</b>
exhibit this “exclusive or” behavior.</span></p>

<h3><a name="_Toc481064808"><span lang=EN-US>Icons</span></a></h3>

<p class=MsoNormal><span lang=EN-US>You can use an </span><span
lang=EN-US><b>Icon</b> inside a <b>JLabel</b> or anything that inherits from <b>AbstractButton</b>
(including </span><span lang=EN-US><b>JButton</b>, </span><span
lang=EN-US><b>JCheckBox</b>, </span><span
lang=EN-US><b>JRadioButton,</b> and the different kinds of </span><span lang=EN-US><b>JMenuItem</b>). Using <b>Icon</b>s with <b>JLabel</b>s is quite
straightforward (you’ll see an example later). The following example explores
all the additional ways you can use <b>Icon</b>s with buttons and their
descendants.</span></p>

<p class=MsoNormal><span lang=EN-US>You can use any <b>gif</b> files you want,
but the ones used in this example are part of this book’s code distribution,
available at <i>www.BruceEckel.com</i>. To open a file and bring in the image, simply
create an </span><span lang=EN-US><b>ImageIcon</b> and hand it the file name.
From then on, you can use the resulting <b>Icon</b> in your program.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that path information is hard-coded
into this example; you will need to change the path to correspond to the
location of the image files.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Faces.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Icon behavior in
Jbuttons.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code=Faces</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//  width=250
height=100&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Faces
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // The following path
information is necessary</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // to run via an
applet directly from the disk:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static String path = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;C:/aaa-TIJ2-distribution/code/c13/&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Icon[] faces =
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new ImageIcon(path +
&quot;face0.gif&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new ImageIcon(path +
&quot;face1.gif&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new ImageIcon(path +
&quot;face2.gif&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new ImageIcon(path +
&quot;face3.gif&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new ImageIcon(path +
&quot;face4.gif&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jb = new
JButton(&quot;JButton&quot;, faces[3]),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jb2 = new
JButton(&quot;Disable&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean mad = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
jb.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(mad) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
jb.setIcon(faces[3]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          mad = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        } else {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
jb.setIcon(faces[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          mad = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
jb.setVerticalAlignment(JButton.TOP);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
jb.setHorizontalAlignment(JButton.LEFT);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
jb.setRolloverEnabled(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jb.setRolloverIcon(faces[1]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
jb.setPressedIcon(faces[2]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
jb.setDisabledIcon(faces[4]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
jb.setToolTipText(&quot;Yow!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(jb);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
jb2.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
if(jb.isEnabled()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          jb.setEnabled(false);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
jb2.setText(&quot;Enable&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        } else {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
jb.setEnabled(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
jb2.setText(&quot;Disable&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(jb2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new Faces(),
400, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>An <b>Icon</b> can be used in many
constructors, but you can also use </span><span
lang=EN-US><b>setIcon(&nbsp;)</b> to add or change an <b>Icon</b>. This example
also shows how a <b>JButton</b> (or any <b>AbstractButton</b>) can set the
various different sorts of icons that appear when things happen to that button:
when it’s pressed, disabled, or “rolled </span><span
lang=EN-US>over” (the mouse moves over it without clicking). You’ll see that
this gives the button a nice animated feel.</span></p>

<h3><a name="_Toc481064809"><span lang=EN-US>Tool tips</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The previous example added a “tool tip” to
the button. Almost all of the classes that you’ll be using to create your user
interfaces are derived from </span><span lang=EN-US><b>JComponent</b>, which
contains a method called </span><span
lang=EN-US><b>setToolTipText(String)</b>. So, for virtually anything you place
on your form, all you need to do is say (for an object <b>jc </b>of any <b>JComponent</b>-derived
class):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>jc.setToolTipText(&quot;My
tip&quot;);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>and when the mouse stays over that <b>JComponent</b>
for a predetermined period of time, a tiny box containing your text will pop up
next to the mouse.</span></p>

<h3><a name="_Toc481064810"><span lang=EN-US>Text fields</span></a></h3>

<p class=MsoNormal><span lang=EN-US>This example shows the extra behavior that <b>JTextField</b>s
are capable of:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:TextFields.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Text fields and Java
events.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=TextFields width=375</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//
height=125&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.text.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class TextFields
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b1 = new
JButton(&quot;Get Text&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b2 = new JButton(&quot;Set
Text&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t1 = new
JTextField(30),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t2 = new
JTextField(30),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t3 = new
JTextField(30);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String s = new
String();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  UpperCaseDocument</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ucd = new
UpperCaseDocument();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t1.setDocument(ucd);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ucd.addDocumentListener(new
T1());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b1.addActionListener(new B1());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b2.addActionListener(new B2());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    DocumentListener dl
= new T1();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
t1.addActionListener(new T1A());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class T1 implements
DocumentListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
changedUpdate(DocumentEvent e){}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
insertUpdate(DocumentEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t2.setText(t1.getText());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t3.setText(&quot;Text:
&quot;+ t1.getText());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
removeUpdate(DocumentEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t2.setText(t1.getText());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class T1A implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int count =
0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t3.setText(&quot;t1
Action Event &quot; + count++);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class B1 implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(t1.getSelectedText() == null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        s =
t1.getText();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        s =
t1.getSelectedText();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t1.setEditable(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class B2 implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
ucd.setUpperCase(false);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t1.setText(&quot;Inserted by Button 2: &quot; + s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
ucd.setUpperCase(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t1.setEditable(false);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
TextFields(), 375, 125);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class UpperCaseDocument
extends PlainDocument {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean upperCase =
true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setUpperCase(boolean flag) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    upperCase = flag;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
insertString(int offset, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String string,
AttributeSet attributeSet)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throws
BadLocationException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(upperCase)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        string =
string.toUpperCase();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
super.insertString(offset, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        string,
attributeSet);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>JTextField</b><b> t3</b> is included
as a place to report when the action listener for the<b> JText</b><b>Field</b> <b>t1</b>
is fired. You’ll see that the action listener for a<b> JText</b><b>Field</b> is
fired only when you press the “enter” key.</span></p>

<p class=MsoNormal><span lang=EN-US>The<b> JText</b><b>Field t1</b> has several
listeners attached to it. The <b>T1</b> listener is a <b>DocumentListener </b>that
responds to any change in the “document” (the contents of the <b>JTextField</b>,
in this case).<b> </b>It automatically copies all text from <b>t1</b> into <b>t2</b>.
In addition, <b>t1</b>’s document is set to a derived class of <b>PlainDocument</b>,
called <b>UpperCaseDocument</b>, which forces all characters to uppercase. It
automatically detects backspaces and performs the deletion, adjusting the caret
and handling everything as you would expect.</span></p>

<h3><a name="_Toc481064811"><span lang=EN-US>Borders</span></a></h3>

<p class=MsoNormal><b><span lang=EN-US>JComponent</span></b><span lang=EN-US>
contains a method called </span><span
lang=EN-US><b>setBorder(&nbsp;)</b>, which allows you to place various
interesting borders on any visible component. The following example
demonstrates a number of the different borders that are available, using a
method called <b>showBorder(&nbsp;)</b> that creates a <b>JPanel</b> and puts
on the border in each case. Also, it uses RTTI to find the name of the border
that you’re using (stripping off all the path information), then puts that name
in a </span><span lang=EN-US><b>JLabel</b> in the middle of the panel:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Borders.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Different Swing
borders.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Borders</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//  width=500
height=300&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.border.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Borders
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static JPanel
showBorder(Border b) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel jp = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jp.setLayout(new
BorderLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String nm =
b.getClass().toString();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    nm =
nm.substring(nm.lastIndexOf('.') + 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jp.add(new
JLabel(nm, JLabel.CENTER), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
BorderLayout.CENTER);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jp.setBorder(b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return jp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
GridLayout(2,4));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(showBorder(new TitledBorder(&quot;Title&quot;)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(showBorder(new EtchedBorder()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(showBorder(new
LineBorder(Color.blue)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(showBorder(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
MatteBorder(5,5,30,30,Color.green)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(showBorder(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
BevelBorder(BevelBorder.RAISED)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(showBorder(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
SoftBevelBorder(BevelBorder.LOWERED)));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(showBorder(new CompoundBorder(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
EtchedBorder(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
LineBorder(Color.red))));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Borders(), 500, 300);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can also create your own borders and
put them inside buttons, labels, etc.—anything derived from <b>JComponent</b>.</span></p>

<h3><a name="_Toc481064812"><span lang=EN-US>JScrollPanes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Most of the time you’ll just want to let a <b>JScrollPane</b>
do it’s job, but you can also control which scroll bars are allowed—vertical,
horizontal, both, or neither:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c13:JScrollPanes.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Controlling the
scrollbars in a JScrollPane.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=JScrollPanes width=300 height=725&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.border.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
JScrollPanes extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b1 = new
JButton(&quot;Text Area 1&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b2 = new
JButton(&quot;Text Area 2&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b3 = new
JButton(&quot;Replace Text&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b4 = new
JButton(&quot;Insert Text&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextArea </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t1 = new
JTextArea(&quot;t1&quot;, 1, 20),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t2 = new
JTextArea(&quot;t2&quot;, 4, 20),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t3 = new
JTextArea(&quot;t3&quot;, 1, 20),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t4 = new
JTextArea(&quot;t4&quot;, 10, 10),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t5 = new
JTextArea(&quot;t5&quot;, 4, 20),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t6 = new
JTextArea(&quot;t6&quot;, 10, 10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JScrollPane </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sp3 = new
JScrollPane(t3,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JScrollPane.VERTICAL_SCROLLBAR_NEVER,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
JScrollPane.HORIZONTAL_SCROLLBAR_NEVER),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sp4 = new
JScrollPane(t4,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
JScrollPane.VERTICAL_SCROLLBAR_ALWAYS,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
JScrollPane.HORIZONTAL_SCROLLBAR_NEVER),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sp5 = new
JScrollPane(t5,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JScrollPane.VERTICAL_SCROLLBAR_NEVER,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sp6 = new
JScrollPane(t6,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
JScrollPane.VERTICAL_SCROLLBAR_ALWAYS,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class B1L implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t5.append(t1.getText() + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class B2L implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t2.setText(&quot;Inserted by Button 2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t2.append(&quot;:
&quot; + t1.getText());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t5.append(t2.getText()
+ &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class B3L implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String s = &quot;
Replacement &quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t2.replaceRange(s,
3, 3 + s.length());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class B4L implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t2.insert(&quot;
Inserted &quot;, 10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Create Borders
for components:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Border brd =
BorderFactory.createMatteBorder(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      1, 1, 1, 1,
Color.black);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t1.setBorder(brd);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t2.setBorder(brd);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sp3.setBorder(brd);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sp4.setBorder(brd);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sp5.setBorder(brd);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sp6.setBorder(brd);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Initialize
listeners and add components:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b1.addActionListener(new
B1L());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b2.addActionListener(new B2L());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b3.addActionListener(new B3L());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b4.addActionListener(new B4L());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b4);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(sp3); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(sp4); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(sp5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(sp6);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
JScrollPanes(), 300, 725);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Using different arguments in the <b>JScrollPane</b>
constructor controls the scrollbars that are available. This example also
dresses things up a bit using borders.</span></p>

<h3><a name="_Toc481064813"><span lang=EN-US>A mini-editor</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>The </span><span lang=EN-US><b>JTextPane</b> control provides a
great deal of support for editing, without much effort. The following example
makes very simple use of this, ignoring the bulk of the functionality of the
class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:TextPane.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The JTextPane control
is a little editor.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=TextPane width=475 height=425&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class TextPane
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton b = new
JButton(&quot;Add Text&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextPane tp = new
JTextPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Generator sg = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
Arrays2.RandStringGenerator(7);  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 1; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
tp.setText(tp.getText() + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            sg.next() +
&quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JScrollPane(tp));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.SOUTH, b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
TextPane(), 475, 425);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The button just adds randomly generated
text. The intent of the <b>JTextPane</b> is to allow text to be edited in
place, so you will see that there is no <b>append(&nbsp;)</b> method. In this
case (admittedly, a poor use of the capabilities of <b>JTextPane</b>), the text
must be captured, modified, and placed back into the pane using <b>setText(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>As mentioned before, the default layout
behavior of an applet is to use the <b>BorderLayout</b>. If you add something
to the pane without specifying any details, it just fills the center of the
pane out to the edges. However, if you specify one of the surrounding regions
(NORTH, SOUTH, EAST, or WEST) as is done here, the component will fit itself
into that region—in this case, the button will nest down at the bottom of the
screen.</span></p>

<p class=MsoNormal><span lang=EN-US>Notice the built-in features of <b>JTextPane</b>,
such as automatic line wrapping. There are lots of other features that you can
look up using the JDK documentation.</span></p>

<h3><a name="_Toc481064814"><span lang=EN-US>Check boxes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A </span><span
lang=EN-US>check box provides a way to make a single on/off choice; it consists
of a tiny box and a label. The box typically holds a little “x” (or some other indication
that it is set) or is empty, depending on whether that item was selected.</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll normally create a </span><span lang=EN-US><b>JCheckBox</b> using a constructor that takes the label as an
argument. You can get and set the state, and also get and set the label if you
want to read or change it after the <b>JCheckBox</b> has been created.</span></p>

<p class=MsoNormal><span lang=EN-US>Whenever a <b>JCheckBox</b> is set or
cleared, an event occurs, which you can capture the same way you do a button,
by using an <b>ActionListener</b>. The following example uses a<b> JText</b><b>Area</b>
to enumerate all the check boxes that have been checked:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:CheckBoxes.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using JCheckBoxes.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=CheckBoxes width=200 height=200&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class CheckBoxes
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextArea t = new
JTextArea(6, 15);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JCheckBox </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cb1 = new
JCheckBox(&quot;Check Box 1&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cb2 = new
JCheckBox(&quot;Check Box 2&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cb3 = new
JCheckBox(&quot;Check Box 3&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cb1.addActionListener(new
ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
trace(&quot;1&quot;, cb1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cb2.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
trace(&quot;2&quot;, cb2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cb3.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
trace(&quot;3&quot;, cb3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JScrollPane(t));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(cb1); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(cb2); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(cb3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void trace(String b,
JCheckBox cb) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(cb.isSelected())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t.append(&quot;Box
&quot; + b + &quot; Set\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t.append(&quot;Box
&quot; + b + &quot; Cleared\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
CheckBoxes(), 200, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>trace(&nbsp;)</b> method sends the
name of the selected <b>JCheckBox</b> and its current state to the<b> JText</b><b>Area</b>
using <b>append(&nbsp;)</b>, so you’ll see a cumulative list of the checkboxes
that were selected and what their state is.</span></p>

<h3><a name="_Toc481064815"></a><a name="_Toc375545453"><span lang=EN-US>Radio
buttons</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The concept of a </span><span lang=EN-US>radio button in GUI programming comes from pre-electronic car radios
with mechanical buttons: when you push one in, any other button that was
pressed pops out. Thus, it allows you to force a single choice among many.</span></p>

<p class=MsoNormal><span lang=EN-US>All you need to do to set up an associated
group of </span><span lang=EN-US><b>JRadioButton</b>s is to add them to a </span><span lang=EN-US><b>ButtonGroup</b> (you can have any number of <b>ButtonGroup</b>s on
a form). One of the buttons can optionally have its starting state set to <b>true</b>
(using the second argument in the constructor). If you try to set more than one
radio button to <b>true</b> then only the final one set will be <b>true</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s a simple example of the use of radio
buttons. Note that you capture radio button events like all others:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c13:RadioButtons.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using JRadioButtons.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=RadioButtons </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=200
height=100&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
RadioButtons extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField t = new
JTextField(15);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  ButtonGroup g = new
ButtonGroup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JRadioButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    rb1 = new
JRadioButton(&quot;one&quot;, false),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    rb2 = new
JRadioButton(&quot;two&quot;, false),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    rb3 = new
JRadioButton(&quot;three&quot;, false);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  ActionListener al =
new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t.setText(&quot;Radio button &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((JRadioButton)e.getSource()).getText());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
rb1.addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
rb2.addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
rb3.addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g.add(rb1);
g.add(rb2); g.add(rb3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
t.setEditable(false);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(rb1); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(rb2); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(rb3); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
RadioButtons(), 200, 100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>To display the state, a text field is used.
This field is set to noneditable because it’s used only to display data, not to
collect it. Thus it is an alternative to using a <b>J</b><b>Label</b>.</span></p>

<h3><a name="_Toc481064816"></a><a name="_Toc375545454"></a><a
name=AAAIndexingCurrentPoint></a><span lang=EN-US>Combo boxes (drop-down lists</span><span
lang=EN-US>)</span></h3>

<p class=MsoNormal><span lang=EN-US>Like a group of radio buttons, a </span><span lang=EN-US>drop-down list is a way to force the user to select only one element
from a group of possibilities. However, it’s a more compact way to accomplish
this, and it’s easier to change the elements of the list without surprising the
user. (You can change radio buttons dynamically, but that tends to be visibly
jarring).</span></p>

<p class=MsoNormal><span lang=EN-US>Java’s <b>JComboBox</b> box is not like the
combo box in Windows, which lets you select from a list <i>or</i> type in your
own selection. With a <b>JComboBox</b> box you choose one and only one element
from the list. In the following example, the <b>JComboBox</b> box starts with a
certain number of entries and then new entries are added to the box when a
button is pressed.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:ComboBoxes.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using drop-down
lists.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=ComboBoxes</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=200
height=100&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ComboBoxes
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String[] description =
{ &quot;Ebullient&quot;, &quot;Obtuse&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;Recalcitrant&quot;, &quot;Brilliant&quot;, &quot;Somnescent&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;Timorous&quot;, &quot;Florid&quot;, &quot;Putrescent&quot; };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField t = new JTextField(15);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JComboBox c = new
JComboBox();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton b = new
JButton(&quot;Add items&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int count = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 4; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
c.addItem(description[count++]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
t.setEditable(false);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(count &lt;
description.length)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
c.addItem(description[count++]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
c.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t.setText(&quot;index: &quot;+ c.getSelectedIndex()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          + &quot;  
&quot; + ((JComboBox)e.getSource())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
.getSelectedItem());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
ComboBoxes(), 200, 100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The<b> JText</b><b>Field</b> displays the
“selected index,” which is the sequence number of the currently selected
element, as well as the label on the radio button.</span></p>

<h3><a name="_Toc481064817"></a><a name="_Toc375545455"><span lang=EN-US>List
boxes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>List boxes are significantly different from
<b>JComboBox</b> boxes, and not just in appearance. While a <b>JComboBox</b>
box drops down when you activate it, a </span><span
lang=EN-US><b>JList</b> occupies some fixed number of lines on a screen all the
time and doesn’t change. If you want to see the items in a list, you simply
call </span><span lang=EN-US><b>getSelectedValues(&nbsp;), </b>which produces
an array of <b>String</b> of the items that have been selected.</span></p>

<p class=MsoNormal><span lang=EN-US>A <b>JList</b> allows multiple selection:
if you control-click on more than one item (holding down the “control” key
while performing additional mouse clicks) the original item stays highlighted
and you can select as many as you want. If you select an item, then shift-click
on another item, all the items in the span between the two are selected. To
remove an item from a group you can control-click it.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:List.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code=List
width=250</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// height=375&gt;
&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.border.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class List
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String[] flavors = {
&quot;Chocolate&quot;, &quot;Strawberry&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Vanilla Fudge
Swirl&quot;, &quot;Mint Chip&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Mocha Almond
Fudge&quot;, &quot;Rum Raisin&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Praline
Cream&quot;, &quot;Mud Pie&quot; };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  DefaultListModel
lItems=new DefaultListModel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JList lst = new
JList(lItems);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextArea t = new
JTextArea(flavors.length,20);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton b = new
JButton(&quot;Add Item&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  ActionListener bl =
new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(count &lt;
flavors.length) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        lItems.add(0,
flavors[count++]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } else {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // Disable,
since there are no more</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // flavors left
to be added to the List</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
b.setEnabled(false);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  ListSelectionListener
ll =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
ListSelectionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
valueChanged(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
ListSelectionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
t.setText(&quot;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Object[]
items=lst.getSelectedValues();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          for(int i = 0;
i &lt; items.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
t.append(items[i] + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int count = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
t.setEditable(false);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Create Borders
for components:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Border brd = BorderFactory.createMatteBorder(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      1, 1, 2, 2,
Color.black);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    lst.setBorder(brd);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t.setBorder(brd);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Add the first
four items to the List</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 4; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
lItems.addElement(flavors[count++]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Add items to the
Content Pane for Display</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(lst);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Register event
listeners</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
lst.addListSelectionListener(ll);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b.addActionListener(bl);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
List(), 250, 375);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When you press the button it adds items to
the <i>top</i> of the list (because <b>addItem(&nbsp;)</b>’s<b> </b>second
argument is 0). </span></p>

<p class=MsoNormal><span lang=EN-US>You can see that borders have also been
added to the lists.</span></p>

<p class=MsoNormal><span lang=EN-US>If you just want to put an array of </span><b><span
lang=EN-US>String</span></b><span lang=EN-US>s into a </span><b><span
lang=EN-US>JList</span></b><span lang=EN-US>, there’s a much simpler solution:
you pass the array to the <b>JList </b>constructor, and it builds the list
automatically. The only reason for using the “list model” in the above example
is so that the list could be manipulated during the execution of the program.</span></p>

<p class=MsoNormal><b><span lang=EN-US>JList</span></b><span lang=EN-US>s do
not automatically provide direct support for scrolling. Of course, all you need
to do is wrap the <b>JList</b> in a </span><span
lang=EN-US><b>JScrollPane</b> and all the details are automatically managed for
you.</span></p>

<h3><a name="_Toc375545457"></a><a name="_Toc481064818"><span lang=EN-US>Tabbed
panes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The <b>JTabbedPane</b> allows you to create
a “tabbed dialog,” which has file-folder tabs running across one edge, and all
you have to do is press a tab to bring forward a different dialog.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:TabbedPane1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates the
Tabbed Pane.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=TabbedPane1 </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=350
height=200&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class TabbedPane1
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String[] flavors = {
&quot;Chocolate&quot;, &quot;Strawberry&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Vanilla Fudge
Swirl&quot;, &quot;Mint Chip&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Mocha Almond
Fudge&quot;, &quot;Rum Raisin&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Praline
Cream&quot;, &quot;Mud Pie&quot; };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTabbedPane tabs = new
JTabbedPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField txt = new
JTextField(20);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; flavors.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
tabs.addTab(flavors[i], </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
JButton(&quot;Tabbed pane &quot; + i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
tabs.addChangeListener(new ChangeListener(){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
stateChanged(ChangeEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
txt.setText(&quot;Tab selected: &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
tabs.getSelectedIndex());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.SOUTH, txt);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(tabs);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
TabbedPane1(), 350, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In Java, the use of some sort of “tabbed
panel” mechanism is quite important because in applet programming the use of
pop-up dialogs is discouraged by automatically adding a little warning to any
dialog that pops up out of an applet. </span></p>

<p class=MsoNormal><span lang=EN-US>When you run the program you’ll see that
the <b>JTabbedPane</b> automatically stacks the tabs if there are too many of
them to fit on one row. You can see this by resizing the window when you run
the program from the console command line.</span></p>

<h3><a name="_Toc481064819"><span lang=EN-US>Message boxes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Windowing environments commonly contain a
standard set of </span><span lang=EN-US>message boxes that allow you to quickly
post information to the user or to capture information from the user. In Swing,
these message boxes are contained in </span><span
lang=EN-US><b>JOptionPane</b>. You have many different possibilities (some
quite sophisticated), but the ones you’ll most commonly use are probably the
message dialog and confirmation dialog, invoked using the <b>static</b> <b>JOptionPane.showMessageDialog(&nbsp;)</b>
and <b>JOptionPane. showConfirmDialog(&nbsp;)</b>. The following example shows
a subset of the message boxes available with <b>JOptionPane</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c13:MessageBoxes.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates
JoptionPane.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=MessageBoxes </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=200
height=150&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
MessageBoxes extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton[] b = { new
JButton(&quot;Alert&quot;), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JButton(&quot;Yes/No&quot;), new JButton(&quot;Color&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JButton(&quot;Input&quot;), new JButton(&quot;3 Vals&quot;)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField txt = new
JTextField(15);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  ActionListener al =
new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String id = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((JButton)e.getSource()).getText();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(id.equals(&quot;Alert&quot;))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
JOptionPane.showMessageDialog(null, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot;There's
a bug on you!&quot;, &quot;Hey!&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          JOptionPane.ERROR_MESSAGE);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else
if(id.equals(&quot;Yes/No&quot;))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
JOptionPane.showConfirmDialog(null, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot;or
no&quot;, &quot;choose yes&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
JOptionPane.YES_NO_OPTION);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else
if(id.equals(&quot;Color&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        Object[] options
= { &quot;Red&quot;, &quot;Green&quot; };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        int sel =
JOptionPane.showOptionDialog(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          null,
&quot;Choose a Color!&quot;, &quot;Warning&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
JOptionPane.DEFAULT_OPTION, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
JOptionPane.WARNING_MESSAGE, null, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          options,
options[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          if(sel !=
JOptionPane.CLOSED_OPTION)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            txt.setText(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>             
&quot;Color Selected: &quot; + options[sel]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } else
if(id.equals(&quot;Input&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String val =
JOptionPane.showInputDialog(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            &quot;How
many fingers do you see?&quot;); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
txt.setText(val);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } else if(id.equals(&quot;3
Vals&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        Object[]
selections = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
&quot;First&quot;, &quot;Second&quot;, &quot;Third&quot; };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        Object val =
JOptionPane.showInputDialog(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          null,
&quot;Choose one&quot;, &quot;Input&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
JOptionPane.INFORMATION_MESSAGE, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          null,
selections, selections[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(val != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          txt.setText(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
val.toString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; b.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      b[i].addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cp.add(b[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(txt);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
MessageBoxes(), 200, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>To be able to write a single <b>ActionListener</b>,
I’ve used the somewhat risky approach of checking the <b>String</b> labels on
the buttons. The problem with this is that it’s easy to get the label a little
bit wrong, typically in capitalization, and this bug can be hard to spot.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that <b>showOptionDialog(&nbsp;)</b>
and <b>showInputDialog(&nbsp;)</b> provide return objects that contain the
value entered by the user.</span></p>

<h3><a name="_Toc481064820"><span lang=EN-US>Menus</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>Each component capable of holding a menu, including <b>JApplet</b>, <b>JFrame</b>,
<b>JDialog</b>, and their descendants, has a <b>setJMenuBar(&nbsp;) </b>method
that accepts a <b>J</b><b>MenuBar</b> (you can have only one <b>JMenuBar</b> on
a particular component). You add <b>JMenu</b>s to the <b>JMenuBar</b>, and <b>JMenuItem</b>s
to the <b>JMenu</b>s. Each <b>JMenuItem</b> can have an <b>ActionListener</b>
attached to it, to be fired when that menu item is selected.</span></p>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>Unlike a system that uses
resources, with Java and Swing you must hand assemble all the menus in source
code. Here is a very simple menu example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:SimpleMenus.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=SimpleMenus </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=200
height=75&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class SimpleMenus
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField t = new
JTextField(15);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  ActionListener al = new
ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t.setText(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
((JMenuItem)e.getSource()).getText());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JMenu[] menus = { new
JMenu(&quot;Winken&quot;), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JMenu(&quot;Blinken&quot;), new JMenu(&quot;Nod&quot;) };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JMenuItem[] items = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JMenuItem(&quot;Fee&quot;), new JMenuItem(&quot;Fi&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JMenuItem(&quot;Fo&quot;),  new JMenuItem(&quot;Zip&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JMenuItem(&quot;Zap&quot;), new JMenuItem(&quot;Zot&quot;), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JMenuItem(&quot;Olly&quot;), new JMenuItem(&quot;Oxen&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JMenuItem(&quot;Free&quot;) };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; items.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
items[i].addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
menus[i%3].add(items[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JMenuBar mb = new
JMenuBar();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; menus.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      mb.add(menus[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    setJMenuBar(mb);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp = getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
SimpleMenus(), 200, 75);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The use of the modulus operator in “<b>i%3</b>”
distributes the menu items among the three <b>JMenu</b>s. Each <b>JMenuItem</b>
must have an <b>ActionListener</b> attached to it; here, the same <b>ActionListener</b>
is used everywhere but you’ll usually need an individual one for each <b>JMenuItem</b>.</span></p>

<p class=MsoNormal><span lang=EN-US><b>JMenuItem </b>inherits <b>AbstractButton</b>,
so it has some buttonlike behaviors. By itself, it provides an item that can be
placed on a drop-down menu. There are also three types inherited from <b>JMenuItem</b>:
<b>J</b><b>Menu</b> to hold other <b>JMenuItem</b>s (so you can have cascading
menus),  <b>JCheckBox</b><b>MenuItem</b>, which produces a checkmark to
indicate whether that menu item is selected, and <b>JRadioButtonMenuItem</b>,
which contains a radio button.</span></p>

<p class=MsoNormal><span lang=EN-US>As a more sophisticated example, here are
the ice cream flavors again, used to create menus. This example also shows
cascading menus, keyboard mnemonics, &nbsp;<b>JCheckBox</b><b>MenuItem</b>s,
and the way you can dynamically change menus:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Menus.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Submenus, checkbox
menu items, swapping menus,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// mnemonics (shortcuts)
and action commands.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code=Menus
width=300</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// height=100&gt;
&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Menus
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String[] flavors = {
&quot;Chocolate&quot;, &quot;Strawberry&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Vanilla Fudge
Swirl&quot;, &quot;Mint Chip&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Mocha Almond
Fudge&quot;, &quot;Rum Raisin&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Praline
Cream&quot;, &quot;Mud Pie&quot; };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField t = new
JTextField(&quot;No flavor&quot;, 30);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JMenuBar mb1 = new
JMenuBar();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JMenu </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f = new
JMenu(&quot;File&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    m = new
JMenu(&quot;Flavors&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s = new
JMenu(&quot;Safety&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Alternative
approach:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JCheckBoxMenuItem[]
safety = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JCheckBoxMenuItem(&quot;Guard&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JCheckBoxMenuItem(&quot;Hide&quot;)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JMenuItem[] file = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JMenuItem(&quot;Open&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // A second menu bar
to swap to:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JMenuBar mb2 = new
JMenuBar();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JMenu fooBar = new
JMenu(&quot;fooBar&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JMenuItem[] other = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Adding a menu
shortcut (mnemonic) is very </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // simple, but only
JMenuItems can have them </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // in their
constructors:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JMenuItem(&quot;Foo&quot;, KeyEvent.VK_F),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JMenuItem(&quot;Bar&quot;, KeyEvent.VK_A),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // No shortcut:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new JMenuItem(&quot;Baz&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton b = new
JButton(&quot;Swap Menus&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class BL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JMenuBar m =
getJMenuBar();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      setJMenuBar(m ==
mb1 ? mb2 : mb1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      validate(); //
Refresh the frame</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class ML implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JMenuItem target =
(JMenuItem)e.getSource();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String
actionCommand = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
target.getActionCommand();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(actionCommand.equals(&quot;Open&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String s =
t.getText();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        boolean chosen =
false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; flavors.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
if(s.equals(flavors[i])) chosen = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(!chosen)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
t.setText(&quot;Choose a flavor first!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          t.setText(&quot;Opening
&quot;+ s +&quot;. Mmm, mm!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class FL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JMenuItem target =
(JMenuItem)e.getSource();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t.setText(target.getText());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Alternatively, you
can create a different</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // class for each
different MenuItem. Then you</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Don't have to
figure out which one it is:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class FooL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t.setText(&quot;Foo selected&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class BarL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t.setText(&quot;Bar selected&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class BazL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t.setText(&quot;Baz selected&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class CMIL implements
ItemListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
itemStateChanged(ItemEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JCheckBoxMenuItem
target = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
(JCheckBoxMenuItem)e.getSource();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String
actionCommand = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
target.getActionCommand();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(actionCommand.equals(&quot;Guard&quot;))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t.setText(&quot;Guard the Ice Cream! &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot;Guarding
is &quot; + target.getState());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else
if(actionCommand.equals(&quot;Hide&quot;))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t.setText(&quot;Hide the Ice Cream! &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot;Is it
cold? &quot; + target.getState());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ML ml = new ML();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    CMIL cmil = new
CMIL();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
safety[0].setActionCommand(&quot;Guard&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
safety[0].setMnemonic(KeyEvent.VK_G);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
safety[0].addItemListener(cmil);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
safety[1].setActionCommand(&quot;Hide&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    safety[0].setMnemonic(KeyEvent.VK_H);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
safety[1].addItemListener(cmil);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
other[0].addActionListener(new FooL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
other[1].addActionListener(new BarL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
other[2].addActionListener(new BazL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    FL fl = new FL();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; flavors.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JMenuItem mi = new
JMenuItem(flavors[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
mi.addActionListener(fl);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      m.add(mi);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Add separators
at intervals:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if((i+1) % 3 == 0)
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
m.addSeparator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; safety.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s.add(safety[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
s.setMnemonic(KeyEvent.VK_A);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f.add(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
f.setMnemonic(KeyEvent.VK_F);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; file.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
file[i].addActionListener(fl);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      f.add(file[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    mb1.add(f);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    mb1.add(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    setJMenuBar(mb1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
t.setEditable(false);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t,
BorderLayout.CENTER);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Set up the system
for swapping menus:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b.addActionListener(new BL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b.setMnemonic(KeyEvent.VK_S);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b,
BorderLayout.NORTH);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; other.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
fooBar.add(other[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
fooBar.setMnemonic(KeyEvent.VK_B);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    mb2.add(fooBar);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Menus(), 300, 100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In this program I placed the menu items
into arrays and then stepped through each array calling <b>add(&nbsp;)</b> for
each <b>JMenuItem</b>. This makes adding or subtracting a menu item somewhat
less tedious.</span></p>

<p class=MsoNormal><span lang=EN-US>This program creates not one but two<b>
JMenuBar</b>s to demonstrate that menu bars can be actively swapped while the
program is running. You can see how a<b> JMenuBar</b> is made up of <b>JMenus</b>,
and each <b>JMenu</b> is made up of <b>JMenuItems</b>,<b> JCheckBox</b><b>MenuItem</b>s,
or even other <b>JMenu</b>s (which produce submenus). When a<b> JMenuBar</b> is
assembled it can be installed into the current program with the <b>setJMenuBar(&nbsp;)</b>
method. Note that when the button is pressed, it checks to see which menu is
currently installed by calling <b>getJMenuBar(&nbsp;)</b>, then it puts the
other menu bar in its place.</span></p>

<p class=MsoNormal><span lang=EN-US>When testing for “Open,” notice that
spelling and capitalization are critical, but Java signals no error if there is
no match with “Open.” This kind of string comparison is a source of programming
errors.</span></p>

<p class=MsoNormal><span lang=EN-US>The checking and unchecking of the menu
items is taken care of automatically. The code handling the <b>JCheckBoxMenuItem</b>s
shows two different ways to determine what was checked: string matching (which,
as mentioned above, isn’t a very safe approach although you’ll see it used) and
matching on the event target object. As shown, the </span><span
lang=EN-US><b>getState(&nbsp;) </b>method can be used to reveal the state. You
can also change the state of a <b>JCheckBoxMenuItem</b> with <b>setState(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The events for menus are a bit inconsistent
and can lead to confusion: </span><span lang=EN-US><b>JMenuItem</b>s use <b>ActionListener</b>s,
but </span><span lang=EN-US><b>JCheckboxMenuItem</b>s use <b>ItemListener</b>s.
The </span><span lang=EN-US><b>JMenu</b> objects can also support <b>ActionListener</b>s,
but that’s not usually helpful. In general, you’ll attach listeners to each <b>JMenuItem</b>,
<b>JCheckBox</b><b>MenuItem</b>, or <b>JRadioButton</b><b>MenuItem</b>, but the
example shows <b>ItemListener</b>s and <b>ActionListener</b>s attached to the
various menu components.</span></p>

<p class=MsoNormal><span lang=EN-US>Swing supports mnemonics, or “keyboard shortcuts,” so you can select
anything derived from <b>AbstractButton</b> (button, menu item, etc.) using the
keyboard instead of the mouse. These are quite simple: for <b>JMenuItem</b> you
can use the overloaded constructor that takes as a second argument the
identifier for the key. However, most <b>AbstractButton</b>s do not have
constructors like this so the more general way to solve the problem is to use
the </span><span lang=EN-US><b>setMnemonic(&nbsp;) </b>method. The example
above adds mnemonics to the button and some of the menu items; shortcut
indicators automatically appear on the components.</span></p>

<p class=MsoNormal><span lang=EN-US>You can also see the use of <b>setActionCommand(&nbsp;)</b>.
This seems a bit strange because in each case the “action command” is exactly
the same as the label on the menu component. Why not just use the label instead
of this alternative string? The problem is internationalization. If you
retarget this program to another language, you want to change only the label in
the menu, and not change the code (which would no doubt introduce new errors).
So to make this easy for code that checks the text string associated with a
menu component, the “action command” can be immutable while the menu label can
change. All the code works with the “action command,” so it’s unaffected by
changes to the menu labels. Note that in this program, not all the menu
components are examined for their action commands, so those that aren’t don’t
have their action command set.</span></p>

<p class=MsoNormal><span lang=EN-US>The bulk of the work happens in the
listeners. <b>BL</b> performs the </span><span
lang=EN-US><b>JMenuBar</b> swapping. In <b>ML</b>, the “figure out who rang”
approach is taken by getting the source of the </span><span
lang=EN-US><b>ActionEvent</b> and casting it to a </span><span
lang=EN-US><b>JMenuItem</b>, then getting the action command string to pass it
through a cascaded <b>if</b> statement.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>FL</b> listener is simple even
though it’s handling all the different flavors in the flavor menu. This
approach is useful if you have enough simplicity in your logic, but in general,
you’ll want to take the approach used with <b>FooL</b>, <b>BarL,</b> and <b>BazL</b>,
in which they are each attached to only a single menu component so no extra
detection logic is necessary and you know exactly who called the listener. Even
with the profusion of classes generated this way, the code inside tends to be
smaller and the process is more foolproof.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that menu code quickly gets
long-winded and messy. This is another case where the use of a GUI builder is
the appropriate solution. A good tool will also handle the maintenance of the
menus.</span></p>

<h3><a name="_Toc481064821"><span lang=EN-US>Pop-up menus</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The most straightforward way to implement a
<b>JPopupMenu</b> is to create an inner class that extends <b>MouseAdapter</b>,
then add an object of that inner class to each component that you want to
produce pop-up behavior:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Popup.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creating popup menus
with Swing.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code=Popup</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//  width=300
height=200&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Popup
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JPopupMenu popup = new
JPopupMenu();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField t = new
JTextField(10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ActionListener al =
new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        t.setText(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          ((JMenuItem)e.getSource()).getText());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JMenuItem m = new
JMenuItem(&quot;Hither&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
m.addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    popup.add(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    m = new
JMenuItem(&quot;Yon&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
m.addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    popup.add(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    m = new
JMenuItem(&quot;Afar&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
m.addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    popup.add(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
popup.addSeparator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    m = new
JMenuItem(&quot;Stay Here&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
m.addActionListener(al);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    popup.add(m);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PopupListener pl =
new PopupListener();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
addMouseListener(pl);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
t.addMouseListener(pl);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class PopupListener
extends MouseAdapter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
mousePressed(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      maybeShowPopup(e);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
mouseReleased(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      maybeShowPopup(e);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private void
maybeShowPopup(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(e.isPopupTrigger())
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        popup.show(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
e.getComponent(), e.getX(), e.getY());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Popup(), 300, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The same <b>ActionListener</b> is added to
each <b>JMenuItem</b>, so that it fetches the text from the menu label and
inserts it into the <b>JTextField</b>.</span></p>

<h3><a name="_Toc481064822"><span lang=EN-US>Drawing</span></a></h3>

<p class=MsoNormal><span lang=EN-US>In a good GUI framework, drawing should be reasonably easy—and it is,
in the Swing library. The problem with any drawing example is that the
calculations that determine where things go are typically a lot more
complicated that the calls to the drawing routines, and these calculations are
often mixed together with the drawing calls so it can seem that the interface
is more complicated than it actually is.</span></p>

<p class=MsoNormal><span lang=EN-US>For simplicity, consider the problem of
representing data on the screen—here, the data will be provided by the built-in
<b>Math.sin(&nbsp;)</b> method which is a mathematical sine function. To make
things a little more interesting, and to further demonstrate how easy it is to
use Swing components, a slider will be placed at the bottom of the form to
dynamically control the number of sine wave cycles that are displayed. In
addition, if you resize the window, you’ll see that the sine wave refits itself
to the new window size. </span></p>

<p class=MsoNormal><span lang=EN-US>Although any </span><span
lang=EN-US><b>JComponent</b> may be painted and thus used as a canvas, if you
just want a straightforward drawing surface you will typically inherit from a </span><span lang=EN-US><b>JPanel</b>. The only method you need to override is </span><span lang=EN-US><b>paintComponent(&nbsp;)</b>, which is called whenever that
component must be repainted (you normally don’t need to worry about this, as
the decision is managed by Swing). When it is called, Swing passes a </span><span lang=EN-US><b>Graphics</b> object to the method, and you can then use this
object to draw or paint on the surface.</span></p>

<p class=MsoNormal><span lang=EN-US>In the following example, all the
intelligence concerning painting is in the <b>SineDraw</b> class; the <b>SineWave</b>
class simply configures the program and the slider control. Inside <b>SineDraw</b>,
the <b>setCycles(&nbsp;)</b> method provides a hook to allow another object—the
slider control, in this case—to control the number of cycles.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:SineWave.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Drawing with Swing,
using a JSlider.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=SineWave</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//  width=700
height=400&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class SineDraw extends
JPanel {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static final int
SCALEFACTOR = 200;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int cycles;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int points;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  double[] sines;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int[] pts;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  SineDraw() {
setCycles(5); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setCycles(int newCycles) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cycles = newCycles;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    points = SCALEFACTOR
* cycles * 2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sines = new
double[points];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pts = new
int[points];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; points; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      double radians =
(Math.PI/SCALEFACTOR) * i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      sines[i] =
Math.sin(radians);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    repaint();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
paintComponent(Graphics g) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
super.paintComponent(g);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int maxWidth =
getWidth();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    double hstep =
(double)maxWidth/(double)points;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int maxHeight =
getHeight();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; points; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      pts[i] =
(int)(sines[i] * maxHeight/2 * .95</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>                     +
maxHeight/2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
g.setColor(Color.red);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 1; i
&lt; points; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int x1 = (int)((i
- 1) * hstep);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int x2 = (int)(i *
hstep);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int y1 = pts[i-1];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int y2 = pts[i];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      g.drawLine(x1, y1,
x2, y2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class SineWave
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  SineDraw sines = new
SineDraw();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JSlider cycles = new
JSlider(1, 30, 5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(sines);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cycles.addChangeListener(new ChangeListener(){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
stateChanged(ChangeEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sines.setCycles(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          ((JSlider)e.getSource()).getValue());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.SOUTH, cycles);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
SineWave(), 700, 400);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>All of the data members and arrays are used
in the calculation of the sine wave points: <b>cycles</b> indicates the number
of complete sine waves desired, <b>points</b> contains the total number of
points that will be graphed, <b>sines</b> contains the sine function values,
and <b>pts</b> contains the y-coordinates of the points that will be drawn on
the <b>JPanel</b>. The <b>setCycles(&nbsp;)</b> method creates the arrays
according to the number of points needed and fills the <b>sines</b> array with
numbers. By calling <b>repaint(&nbsp;)</b> , <b>setCycles(&nbsp;)</b> forces <b>paintComponent(&nbsp;)</b>
to be called so the rest of the calculation and redraw will take place.</span></p>

<p class=MsoNormal><span lang=EN-US>The first thing you must do when you
override <b>paintComponent(&nbsp;)</b> is to call the base-class version of the
method. Then you are free to do whatever you like; normally, this means using
the <b>Graphics</b> methods that you can find in the documentation for <b>java.awt.Graphics</b>
(in the HTML documentation from <i>java.sun.com</i>) to draw and paint pixels
onto the <b>JPanel</b>. Here, you can see that almost all the code is involved
in performing the calculations; the only two method calls that actually
manipulate the screen are <b>setColor(&nbsp;)</b> and <b>drawLine(&nbsp;)</b>.
You will probably have a similar experience when creating your own program that
displays graphical data—you’ll spend most of your time figuring out what it is
you want to draw, but the actual drawing process will be quite simple.</span></p>

<p class=MsoNormal><span lang=EN-US>When I created this program, the bulk of my
time was spent in getting the sine wave to display. Once I did that, I thought
it would be nice to be able to dynamically change the number of cycles. My
programming experiences when trying to do such things in other languages made
me a bit reluctant to try this, but it turned out to be the easiest part of the
project. I created a <b>JSlider</b> (the arguments are the left-most value of
the <b>JSlider</b>, the right-most value, and the starting value, respectively,
but there are other constructors as well) and dropped it into the <b>JApplet</b>.
Then I looked at the HTML documentation and noticed that the only listener was
the </span><span lang=EN-US><b>addChangeListener</b>, which was triggered
whenever the slider was changed enough for it to produce a different value. The
only method for this was the obviously named </span><span
lang=EN-US><b>stateChanged(&nbsp;)</b>, which provided a <b>ChangeEvent</b>
object so that I could look backward to the source of the change and find the
new value. By calling the <b>sines</b> object’s <b>setCycles(&nbsp;)</b>, the
new value was incorporated and the <b>JPanel</b> redrawn.</span></p>

<p class=MsoNormal><span lang=EN-US>In general, you will find that most of your
Swing problems can be solved by following a similar process, and you’ll find
that it’s generally quite simple, even if you haven’t used a particular
component before.</span></p>

<p class=MsoNormal><span lang=EN-US>If your problem is more complex, there are
other more sophisticated alternatives for drawing, including third-party
JavaBeans components and the Java 2D API. These solutions are beyond the scope
of this book, but you should look them up if your drawing code becomes too
onerous.</span></p>

<h3><a name="_Toc481064823"><span lang=EN-US>Dialog Boxes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A dialog box is a window that pops up out
of another window. Its purpose is to deal with some specific issue without
cluttering the original window with those details. Dialog boxes are heavily
used in windowed programming environments, but less frequently used in applets.</span></p>

<p class=MsoNormal><span lang=EN-US>To create a dialog box, you inherit from <b>J</b><b>Dialog</b>,
which is just another kind of <b>Window</b>, like a <b>J</b><b>Frame</b>. A <b>JDialog</b>
has a layout manager (which defaults to <b>BorderLayout</b>) and you add event
listeners to deal with events. One significant difference when </span><span lang=EN-US><b>windowClosing(&nbsp;)</b> is called is that you don’t want to shut
down the application. Instead, you release the resources used by the dialog’s
window by calling </span><span lang=EN-US><b>dispose(&nbsp;)</b>. Here’s a very
simple example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Dialogs.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creating and using
Dialog Boxes.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Dialogs width=125 height=75&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MyDialog extends
JDialog {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public MyDialog(JFrame
parent) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(parent,
&quot;My dialog&quot;, true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JLabel(&quot;Here is my dialog&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JButton ok = new
JButton(&quot;OK&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
ok.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        dispose(); //
Closes the dialog</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(ok);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    setSize(150,125);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Dialogs
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton b1 = new
JButton(&quot;Dialog Box&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  MyDialog dlg = new
MyDialog(null);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b1.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        dlg.show();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
getContentPane().add(b1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Dialogs(), 125, 75);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Once the <b>JDialog</b> is created, the </span><span lang=EN-US><b>show(&nbsp;)</b> method must be called to display and activate it.
For the dialog to close, it must call <b>dispose(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll see that anything that pops up out
of an applet, including dialog boxes, is “untrusted.” That is, you get a
warning in the window that’s been popped up. This is because, in theory, it
would be possible to fool the user into thinking that they’re dealing with a
regular native application and to get them to type in their credit card number,
which then goes across the Web. An applet is always attached to a Web page and
visible within your Web browser, while a dialog box is detached—so in theory,
it could be possible. As a result it is not so common to see an applet that
uses a dialog box.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example is more complex; the
dialog box is made up of a grid (using <b>GridLayout</b>) of a special kind of
button that is defined here as class <b>ToeButton</b>. This button draws a
frame around itself and, depending on its state, a blank, an “x,” or an “o” in
the middle. It starts out blank, and then depending on whose turn it is,
changes to an “x” or an “o.” However, it will also flip back and forth between
“x” and “o” when you click on the button. (This makes the tic-tac-toe concept
only slightly more annoying than it already is.) In addition, the dialog box
can be set up for any number of rows and columns by changing numbers in the
main application window.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:TicTacToe.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstration of
dialog boxes</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// and creating your own
components.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=TicTacToe</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//  width=200
height=100&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class TicTacToe
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    rows = new
JTextField(&quot;3&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cols = new
JTextField(&quot;3&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static final int BLANK
= 0, XX = 1, OO = 2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class ToeDialog
extends JDialog {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int turn = XX; //
Start with x's turn</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // w = number of
cells wide</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // h = number of
cells high</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public ToeDialog(int
w, int h) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      setTitle(&quot;The
game itself&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cp.setLayout(new
GridLayout(w, h));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; w * h; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        cp.add(new
ToeButton());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      setSize(w * 50, h
* 50);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // JDK 1.3 close
dialog:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
//#setDefaultCloseOperation(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      //# 
DISPOSE_ON_CLOSE);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // JDK 1.2 close
dialog:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      addWindowListener(new
WindowAdapter() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        public void
windowClosing(WindowEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          dispose();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      });    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    class ToeButton
extends JPanel {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int state = BLANK;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public ToeButton()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
addMouseListener(new ML());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
paintComponent(Graphics g) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
super.paintComponent(g);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        int x1 = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        int y1 = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        int x2 =
getSize().width - 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        int y2 =
getSize().height - 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        g.drawRect(x1,
y1, x2, y2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        x1 = x2/4;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        y1 = y2/4;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        int wide = x2/2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        int high = y2/2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(state == XX)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          g.drawLine(x1,
y1, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            x1 + wide,
y1 + high);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          g.drawLine(x1,
y1 + high, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            x1 + wide,
y1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(state == OO)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          g.drawOval(x1,
y1, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            x1 + wide/2,
y1 + high/2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      class ML extends
MouseAdapter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        public void
mousePressed(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          if(state ==
BLANK) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            state =
turn;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            turn = (turn
== XX ? OO : XX);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          } </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            state =
(state == XX ? OO : XX);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          repaint();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class BL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JDialog d = new
ToeDialog(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Integer.parseInt(rows.getText()),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Integer.parseInt(cols.getText()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
d.setVisible(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel p = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.setLayout(new
GridLayout(2,2));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(new
JLabel(&quot;Rows&quot;, JLabel.CENTER));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(rows);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(new
JLabel(&quot;Columns&quot;, JLabel.CENTER));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(cols);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(p,
BorderLayout.NORTH);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JButton b = new
JButton(&quot;go&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b.addActionListener(new BL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b, BorderLayout.SOUTH);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
TicTacToe(), 200, 100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Because <b>static</b>s can only be at the
outer level of the class, inner classes cannot have <b>static</b> data or <b>static</b>
inner classes.</span></p>

<p class=MsoNormal><span lang=EN-US>The  <b>paintComponent</b><b>(&nbsp;)</b>
method draws the square around the panel, and the “x” or the “o.” This is full
of tedious calculations, but it’s straightforward. </span></p>

<p class=MsoNormal><span lang=EN-US>A mouse click is captured by the <b>MouseListener</b>,
which first checks to see if the panel has anything written on it. If not, the
parent window is queried to find out whose turn it is and that is used to
establish the state of the <b>ToeButton</b>. Via the inner class mechanism, the
<b>ToeButton</b> then reaches back into the parent and changes the turn. If the
button is already displaying an “x” or an “o” then that is flopped. You can see
in these calculations the convenient use of the ternary if-else described in
Chapter 3. After a state change, the <b>ToeButton</b> is repainted.</span></p>

<p class=MsoNormal><span lang=EN-US>The constructor for <b>ToeDialog</b> is
quite simple: it adds into a <b>GridLayout</b> as many buttons as you request,
then resizes it for 50 pixels on a side for each button.</span></p>

<p class=MsoNormal><b><span lang=EN-US>TicTacToe</span></b><span lang=EN-US>
sets up the whole application by creating the<b> JText</b><b>Field</b>s (for
inputting the rows and columns of the button grid) and the “go” button with its
<b>ActionListener</b>. When the button is pressed, the data in the<b> JText</b><b>Field</b>s
must be fetched, and, since they are in <b>String</b> form, turned into <b>int</b>s
using the <b>static</b> </span><span lang=EN-US><b>Integer.parseInt(&nbsp;)</b> method. </span></p>

<h3><a name="_Toc481064824"><span lang=EN-US>File dialogs</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Some operating systems have a number of
special built-in dialog boxes to handle the selection of things such as fonts,
colors, printers, and the like. Virtually all graphical operating systems
support the opening and saving of files, however, and so Java’s </span><span lang=EN-US><b>JFileChooser</b> encapsulates these for easy use.</span></p>

<p class=MsoNormal><span lang=EN-US>The following application exercises two
forms of <b>JFileChooser</b> dialogs, one for opening and one for saving. Most
of the code should by now be familiar, and all the interesting activities
happen in the action listeners for the two different button clicks:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c13:FileChooserTest.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstration of File
dialog boxes.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
FileChooserTest extends JFrame {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    filename = new
JTextField(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    dir = new
JTextField();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    open = new
JButton(&quot;Open&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    save = new
JButton(&quot;Save&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
FileChooserTest() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel p = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
open.addActionListener(new OpenL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(open);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
save.addActionListener(new SaveL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(save);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(p,
BorderLayout.SOUTH);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    dir.setEditable(false);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
filename.setEditable(false);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p = new JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.setLayout(new
GridLayout(2,1));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(filename);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(dir);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(p,
BorderLayout.NORTH);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class OpenL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JFileChooser c =
new JFileChooser();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Demonstrate
&quot;Open&quot; dialog:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int rVal = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
c.showOpenDialog(FileChooserTest.this);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(rVal ==
JFileChooser.APPROVE_OPTION) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
filename.setText(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          c.getSelectedFile().getName());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          dir.setText(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
c.getCurrentDirectory().toString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(rVal ==
JFileChooser.CANCEL_OPTION) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
filename.setText(&quot;You pressed cancel&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
dir.setText(&quot;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class SaveL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JFileChooser c =
new JFileChooser();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Demonstrate
&quot;Save&quot; dialog:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int rVal = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
c.showSaveDialog(FileChooserTest.this);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(rVal ==
JFileChooser.APPROVE_OPTION) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
filename.setText(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
c.getSelectedFile().getName());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          dir.setText(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
c.getCurrentDirectory().toString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(rVal ==
JFileChooser.CANCEL_OPTION) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
filename.setText(&quot;You pressed cancel&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        dir.setText(&quot;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
FileChooserTest(), 250, 110);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that there are many variations you can
apply to <b>JFileChooser</b>, including filters to narrow the file names that
you will allow.</span></p>

<p class=MsoNormal><span lang=EN-US>For an “open file” dialog, you call <b>showOpenDialog(&nbsp;)</b>,
and for a “save file” dialog you call <b>showSaveDialog(&nbsp;)</b>. These
commands don’t return until the dialog is closed. The <b>JFileChooser</b>
object still exists, so you can read data from it. The methods <b>getSelectedFile(&nbsp;)</b>
and <b>getCurrentDirectory(&nbsp;)</b> are two ways you can interrogate the
results of the operation. If these return <b>null</b> it means the user
canceled out of the dialog.</span></p>

<h3><a name="_Toc481064825"><span lang=EN-US>HTML on Swing components</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>Any component that can take text can also take HTML text, which it
will reformat according to HTML rules. This means you can very easily add fancy
text to a Swing component. For example,</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:HTMLButton.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Putting HTML text on
Swing components.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=HTMLButton width=200 height=500&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class HTMLButton
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton b = new JButton(&quot;&lt;html&gt;&lt;b&gt;&lt;font
size=+2&gt;&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;&lt;center&gt;Hello!&lt;br&gt;&lt;i&gt;Press me now!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
getContentPane().add(new JLabel(&quot;&lt;html&gt;&quot;+</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot;&lt;i&gt;&lt;font
size=+4&gt;Kapow!&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // Force a
re-layout to</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // include the
new label:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        validate();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
HTMLButton(), 200, 500);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You must start the text with
“&lt;html&gt;,” and then you can use normal HTML tags. Note that you are not
forced to include the normal closing tags.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>ActionListener</b> adds a new <b>JLabel</b>
to the form, which also contains HTML text. However, this label is not added
during <b>init(&nbsp;)</b> so you must call the container’s <b>validate(&nbsp;)</b>
method in order to force a re-layout of the components (and thus the display of
the new label).</span></p>

<p class=MsoNormal><span lang=EN-US>You can also use HTML text for <b>JTabbedPane</b>,
<b>JMenuItem</b>, <b>JToolTip</b>, <b>JRadioButton</b> and <b>JCheckBox</b>.</span></p>

<h3><a name="_Toc481064826"><span lang=EN-US>Sliders and progress bars</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A </span><span
lang=EN-US>slider (which has already been used in the sine wave example) allows
the user to input data by moving a point back and forth, which is intuitive in
some situations (volume controls, for example). A </span><span
lang=EN-US>progress bar displays data in a relative fashion from “full” to
“empty” so the user gets a perspective. My favorite example for these is to
simply hook the slider to the progress bar so when you move the slider the
progress bar changes accordingly:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Progress.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using progress bars
and sliders.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Progress</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//  width=300
height=200&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.border.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Progress
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JProgressBar pb = new
JProgressBar();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JSlider sb = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JSlider(JSlider.HORIZONTAL, 0, 100, 60);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
GridLayout(2,1));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(pb);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sb.setValue(0);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
sb.setPaintTicks(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
sb.setMajorTickSpacing(20);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
sb.setMinorTickSpacing(5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sb.setBorder(new
TitledBorder(&quot;Slide Me&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pb.setModel(sb.getModel());
// Share model</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(sb);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Progress(), 300, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The key to hooking the two components
together is in sharing their model, in the line:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>pb.setModel(sb.getModel());</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>Of course, you could also
control the two using a listener, but this is more straightforward for simple
situations.</span></p>

<p class=MsoNormal><span lang=EN-US>The </span><span
lang=EN-US><b>JProgressBar </b>is fairly straightforward, but the </span><span lang=EN-US><b>JSlider</b> has a lot of options, such as the orientation and
major and minor tick marks. Notice how straightforward it is to add a titled
border.</span></p>

<h3><a name="_Toc481064827"><span lang=EN-US>Trees</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Using a </span><span
lang=EN-US><b>JTree </b>can be as simple as saying:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>add(new JTree(</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  new Object[]
{&quot;this&quot;, &quot;that&quot;, &quot;other&quot;}));</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This displays a primitive </span><span lang=EN-US>tree. The API for trees is vast, however—certainly one of the largest
in Swing. It appears that you can do just about anything with trees, but more
sophisticated tasks might require quite a bit of research and experimentation. </span></p>

<p class=MsoNormal><span lang=EN-US>Fortunately, there is a middle ground
provided in the library: the “default” tree components, which generally do what
you need. So most of the time you can use these components, and only in special
cases will you need to delve in and understand trees more deeply.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example uses the “default”
tree components to display a tree in an applet. When you press the button, a
new subtree is added under the currently selected node (if no node is selected,
the root node is used):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Trees.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Simple Swing tree
example. Trees can </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// be made vastly more
complex than this.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code=Trees</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//  width=250
height=250&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.tree.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Takes an array of
Strings and makes the first</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// element a node and
the rest leaves:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Branch {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  DefaultMutableTreeNode
r;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Branch(String[]
data) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    r = new
DefaultMutableTreeNode(data[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 1; i
&lt; data.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      r.add(new
DefaultMutableTreeNode(data[i]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
DefaultMutableTreeNode node() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return r; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Trees
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String[][] data = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;Colors&quot;, &quot;Red&quot;, &quot;Blue&quot;, &quot;Green&quot; },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;Flavors&quot;, &quot;Tart&quot;, &quot;Sweet&quot;, &quot;Bland&quot; },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;Length&quot;, &quot;Short&quot;, &quot;Medium&quot;, &quot;Long&quot; },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;Volume&quot;, &quot;High&quot;, &quot;Medium&quot;, &quot;Low&quot; },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;Temperature&quot;, &quot;High&quot;, &quot;Medium&quot;, &quot;Low&quot;
},</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;Intensity&quot;, &quot;High&quot;, &quot;Medium&quot;, &quot;Low&quot; },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  DefaultMutableTreeNode
root, child, chosen;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTree tree;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  DefaultTreeModel
model;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    root = new
DefaultMutableTreeNode(&quot;root&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    tree = new
JTree(root);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Add it and make
it take care of scrolling:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JScrollPane(tree), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      BorderLayout.CENTER);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Capture the
tree's model:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    model
=(DefaultTreeModel)tree.getModel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JButton test = new
JButton(&quot;Press me&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
test.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if(i &lt; data.length)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          child = new
Branch(data[i++]).node();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // What's the
last one you clicked?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          chosen =
(DefaultMutableTreeNode)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
tree.getLastSelectedPathComponent();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          if(chosen ==
null) chosen = root;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // The model
will create the </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // appropriate
event. In response, the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // tree will
update itself:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
model.insertNodeInto(child, chosen, 0);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // This puts
the new node on the </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // currently
chosen node.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Change the
button's colors:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
test.setBackground(Color.blue);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
test.setForeground(Color.white);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel p = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(test);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(p,
BorderLayout.SOUTH);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Trees(), 250, 250);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The first class, <b>Branch</b>, is a tool
to take an array of <b>String</b> and build a </span><span
lang=EN-US><b>DefaultMutableTreeNode</b> with the first <b>String</b> as the
root and the rest of the <b>String</b>s in the array as leaves. Then <b>node(&nbsp;)</b>
can be called to produce the root of this “branch.”</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Trees</b> class contains a
two-dimensional array of <b>String</b>s from which <b>Branch</b>es can be made
and a <b>static int i</b> to count through this array. The <b>DefaultMutableTreeNode</b>
objects hold the nodes, but the physical representation on screen is controlled
by the <b>JTree</b> and its associated model, the </span><span
lang=EN-US><b>DefaultTreeModel</b>. Note that when the <b>JTree</b> is added to
the applet, it is wrapped in a </span><span
lang=EN-US><b>JScrollPane</b>—this is all it takes to provide automatic
scrolling.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>JTree</b> is controlled through its <i>model</i>.
When you make a change to the model, the model generates an event that causes
the <b>JTree</b> to perform any necessary updates to the visible representation
of the tree. In <b>init(&nbsp;)</b>, the model is captured by calling </span><span lang=EN-US><b>getModel(&nbsp;)</b>. When the button is pressed, a new “branch”
is created. Then the currently selected component is found (or the root is used
if nothing is selected) and the model’s </span><span
lang=EN-US><b>insertNodeInto(&nbsp;)</b> method does all the work of changing
the tree and causing it to be updated.</span></p>

<p class=MsoNormal><span lang=EN-US>An example like the one above may give you
what you need in a tree. However, trees have the power to do just about
anything you can imagine—everywhere you see the word “default” in the example
above, you can substitute your own class to get different behavior. But beware:
almost all of these classes have a large interface, so you could spend a lot of
time struggling to understand the intricacies of trees. Despite this, it’s a
good design and the alternatives are usually much worse.</span></p>

<h3><a name="_Toc481064828"><span lang=EN-US>Tables</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Like trees, </span><span
lang=EN-US>tables in Swing are vast and powerful. They are primarily intended
to be the popular “grid” interface to databases via Java Database Connectivity
(JDBC, discussed in Chapter 15) and thus they have a tremendous amount of
flexibility, which you pay for in complexity. There’s easily enough here to be
the basis of a full-blown spreadsheet and could probably justify an entire
book. However, it is also possible to create a relatively simple </span><span lang=EN-US><b>JTable</b> if you understand the basics.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>JTable</b> controls how the data is
displayed, but the <b>TableModel</b> controls the data itself. So to create a <b>JTable</b>
you’ll typically create a <b>TableModel</b> first. You can fully implement the <b>TableModel</b>
interface, but it’s usually simpler to inherit from the helper class <b>AbstractTableModel</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Table.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Simple demonstration
of JTable.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet code=Table</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//  width=350
height=200&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.table.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Table
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextArea txt = new
JTextArea(4, 20);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // The TableModel
controls all the data:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class DataModel
extends AbstractTableModel {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object[][] data = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      {&quot;one&quot;,
&quot;two&quot;, &quot;three&quot;, &quot;four&quot;},</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      {&quot;five&quot;,
&quot;six&quot;, &quot;seven&quot;, &quot;eight&quot;},</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      {&quot;nine&quot;,
&quot;ten&quot;, &quot;eleven&quot;, &quot;twelve&quot;},</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Prints data when
table changes:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    class TML implements
TableModelListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
tableChanged(TableModelEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
txt.setText(&quot;&quot;); // Clear it</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; data.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          for(int j = 0;
j &lt; data[0].length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
txt.append(data[i][j] + &quot; &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          txt.append(&quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public DataModel() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
addTableModelListener(new TML());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public int
getColumnCount() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
data[0].length; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public int
getRowCount() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
data.length;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Object
getValueAt(int row, int col) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
data[row][col]; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    setValueAt(Object
val, int row, int col) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      data[row][col] =
val;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Indicate the
change has happened:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
fireTableDataChanged();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public boolean </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    isCellEditable(int
row, int col) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return true; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JTable table = new
JTable(new DataModel());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JScrollPane(table));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.SOUTH, txt);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Table(), 350, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>DataModel</span></b><span lang=EN-US>
contains an array of data, but you could also get the data from some other
source such as a database. The constructor adds a <b>TableModelListener</b>
that prints the array every time the table is changed. The rest of the methods
follow the Beans naming convention, and are used by <b>JTable</b> when it wants
to present the information in <b>DataModel</b>. <b>AbstractTableModel</b>
provides default methods for <b>setValueAt(&nbsp;)</b> and <b>isCellEditable(&nbsp;)</b>
that prevent changes to the data, so if you want to be able to edit the data,
you must override these methods.</span></p>

<p class=MsoNormal><span lang=EN-US>Once you have a <b>TableModel</b>, you only
need to hand it to the <b>JTable</b> constructor. All the details of
displaying, editing, and updating will be taken care of for you. This example
also puts the <b>JTable</b> in a <b>JScrollPane</b>.</span></p>

<h3><a name="_Toc481064829"><span lang=EN-US>Selecting Look &amp; Feel</span></a></h3>

<p class=MsoNormal><span lang=EN-US>One of the very interesting aspects of
Swing is the “</span><span lang=EN-US>Pluggable Look &amp; Feel.” This allows your program to emulate the
look and feel of various operating environments. You can even do all sorts of
fancy things like dynamically changing the look and feel while the program is
executing. However, you generally just want to do one of two things, either
select the “cross platform” look and feel (which is Swing’s “metal”), or select
the look and feel for the system you are currently on, so your Java program
looks like it was created specifically for that system. The code to select
either of these behaviors is quite simple—but you must execute it <i>before</i>
you create any visual components, because the components will be made based on
the current look and feel and will not be changed just because you happen to
change the look and feel midway during the program (that process is more
complicated and uncommon, and is relegated to Swing-specific books).</span></p>

<p class=MsoNormal><span lang=EN-US>Actually, if you want to use the
cross-platform (“metal”) look and feel that is characteristic of Swing
programs, you don’t have to do anything—it’s the default. But if you want
instead to use the current operating environment’s look and feel, you just
insert the following code, typically at the beginning of your <b>main(&nbsp;)</b>
but somehow before any components are added:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
UIManager.setLookAndFeel(UIManager.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
getSystemLookAndFeelClassName());</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} catch(Exception
e) {}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You don’t need anything in the <b>catch</b>
clause because the <b>UIManager</b> will default to the cross-platform look and
feel if your attempts to set up any of the alternatives fail. However, during
debugging the exception can be quite useful so you may at least want to put a
print statement in the catch clause.</span></p>

<p class=MsoNormal><span lang=EN-US>Here is a program that takes a command-line
argument to select a look and feel, and shows how several different components
look under the chosen look and feel:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:LookAndFeel.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Selecting different
looks &amp; feels.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class LookAndFeel
extends JFrame {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String[] choices = { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;eeny&quot;,
&quot;meeny&quot;, &quot;minie&quot;, &quot;moe&quot;, &quot;toe&quot;,
&quot;you&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Component[] samples =
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JButton(&quot;JButton&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JTextField(&quot;JTextField&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JLabel(&quot;JLabel&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JCheckBox(&quot;JCheckBox&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JRadioButton(&quot;Radio&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new JComboBox(choices),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new JList(choices),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public LookAndFeel() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(&quot;Look And
Feel&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; samples.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
cp.add(samples[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static void
usageError() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;Usage:LookAndFeel [cross|system|motif]&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.exit(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length == 0)
usageError();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(args[0].equals(&quot;cross&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        UIManager.setLookAndFeel(UIManager.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
getCrossPlatformLookAndFeelClassName());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } catch(Exception
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } else
if(args[0].equals(&quot;system&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
UIManager.setLookAndFeel(UIManager.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
getSystemLookAndFeelClassName());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } catch(Exception
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } else
if(args[0].equals(&quot;motif&quot;)) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
UIManager.setLookAndFeel(&quot;com.sun.java.&quot;+</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
&quot;swing.plaf.motif.MotifLookAndFeel&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } catch(Exception
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } else usageError();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Note the look
&amp; feel must be set before</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // any components
are created.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
LookAndFeel(), 300, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that one option is to
explicitly specify a string for a look and feel, as seen with <b>MotifLookAndFeel</b>.
However, that one and the default “metal” look and feel are the only ones that
can legally be used on any platform; even though there are strings for Windows
and Macintosh look and feels, those can only be used on their respective
platforms (these are produced when you call <b>getSystemLookAndFeelClassName(&nbsp;)</b>
and you’re on that particular platform).</span></p>

<p class=MsoNormal><span lang=EN-US>It is also possible to create a custom look
and feel package, for example, if you are building a framework for a company
that wants a distinctive appearance. This is a big job and is far beyond the
scope of this book (in fact, you’ll discover it is beyond the scope of many
dedicated Swing books!).</span></p>

<h3><a name="_Toc481064830"><span lang=EN-US>The clipboard</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The JFC supports limited operations with
the </span><span lang=EN-US>system clipboard (in the <b>java.awt.datatransfer </b>package).
You can copy <b>String</b> objects to the clipboard as text, and you can paste
text from the clipboard into <b>String</b> objects. Of course, the clipboard is
designed to hold any type of data, but how this data is represented on the
clipboard is up to the program doing the cutting and pasting. The Java
clipboard API provides for extensibility through the concept of a “flavor.”
When data comes off the clipboard, it has an associated set of </span><span lang=EN-US>flavors that it can be converted to (for example, a graph might be
represented as a string of numbers or as an image) and you can see if that particular
clipboard data supports the flavor you’re interested in.</span></p>

<p class=MsoNormal><span lang=EN-US>The following program is a simple
demonstration of cut, copy, and paste with <b>String</b> data in a </span><span lang=EN-US><b>JTextArea</b>. One thing you’ll notice is that the keyboard sequences
you normally use for cutting, copying, and pasting also work. But if you look
at any<b> JText</b><b>Field</b> or<b> JText</b><b>Area</b> in any other program
you’ll find that they also automatically support the clipboard key sequences.
This example simply adds programmatic control of the clipboard, and you could
use these techniques if you want to capture clipboard text into something other
than a <b>JTextComponent</b>.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:CutAndPaste.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using the clipboard.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
java.awt.datatransfer.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class CutAndPaste
extends JFrame  {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JMenuBar mb = new
JMenuBar();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JMenu edit = new
JMenu(&quot;Edit&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JMenuItem</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cut = new
JMenuItem(&quot;Cut&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    copy = new
JMenuItem(&quot;Copy&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    paste = new
JMenuItem(&quot;Paste&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextArea text = new
JTextArea(20, 20);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Clipboard clipbd = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
getToolkit().getSystemClipboard();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public CutAndPaste() 
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cut.addActionListener(new CutL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
copy.addActionListener(new CopyL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    paste.addActionListener(new
PasteL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    edit.add(cut);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    edit.add(copy);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    edit.add(paste);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    mb.add(edit);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    setJMenuBar(mb);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
getContentPane().add(text);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class CopyL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String selection =
text.getSelectedText();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if (selection ==
null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        return;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      StringSelection
clipString =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
StringSelection(selection);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
clipbd.setContents(clipString,clipString);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class CutL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String selection =
text.getSelectedText();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if (selection ==
null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        return;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      StringSelection
clipString =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
StringSelection(selection);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
clipbd.setContents(clipString, clipString);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
text.replaceRange(&quot;&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
text.getSelectionStart(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
text.getSelectionEnd());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class PasteL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Transferable
clipData =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        clipbd.getContents(CutAndPaste.this);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String
clipString =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
(String)clipData.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
getTransferData(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>             
DataFlavor.stringFlavor);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
text.replaceRange(clipString,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
text.getSelectionStart(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          text.getSelectionEnd());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } catch(Exception
ex) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Not String flavor&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
CutAndPaste(), 300, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The creation and addition of the menu and<b>
JText</b><b>Area</b> should by now seem a pedestrian activity. What’s different
is the creation of the <b>Clipboard</b> field <b>clipbd</b>, which is done
through the <b>Toolkit</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>All the action takes place in the
listeners. The <b>CopyL</b> and <b>CutL</b> listeners are the same except for
the last line of <b>CutL</b>, which erases the line that’s been copied. The
special two lines are the creation of a </span><span
lang=EN-US><b>StringSelection</b> object from the <b>String</b> and the call to
</span><span lang=EN-US><b>setContents(&nbsp;)</b> with this <b>StringSelection</b>.
That’s all there is to putting a <b>String</b> on the clipboard.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>PasteL,</b> data is pulled off the
clipboard using </span><span lang=EN-US><b>getContents(&nbsp;)</b>. What comes
back is a fairly anonymous </span><span
lang=EN-US><b>Transferable</b> object, and you don’t really know what it
contains. One way to find out is to call </span><span
lang=EN-US><b>getTransferDataFlavors(&nbsp;)</b>, which returns an array of </span><span lang=EN-US><b>DataFlavor</b> objects indicating which flavors are supported by
this particular object. You can also ask it directly with </span><span lang=EN-US><b>isDataFlavorSupported(&nbsp;)</b>, passing in the flavor you’re
interested in. Here, however, the bold approach is taken: </span><span lang=EN-US><b>getTransferData(&nbsp;)</b> is called assuming that the contents
supports the <b>String</b> flavor, and if it doesn’t the problem is sorted out
in the exception handler.</span></p>

<p class=MsoNormal><span lang=EN-US>In the future you can expect more data
flavors to be supported.</span></p>

<h2><a name="_Toc375545469"></a><a name="_Toc481064831"><span lang=EN-US>Packaging
an applet into a JAR file</span></a></h2>

<p class=MsoNormal><span lang=EN-US>An important use of the JAR utility is to optimize applet loading. In
Java 1.0, people tended to try to cram all their code into a single applet
class so the client would need only a single server hit to download the applet
code. Not only did this result in messy, hard to read (and maintain) programs,
but the <b>.class</b> file was still uncompressed so downloading wasn’t as fast
as it could have been.</span></p>

<p class=MsoNormal><span lang=EN-US>JAR files solve the problem by compressing
all of your <b>.class</b> files into a single file that is downloaded by the
browser. Now you can create the right design without worrying about how many <b>.class
</b>files it will generate, and the user will get a much faster download time.</span></p>

<p class=MsoNormal><span lang=EN-US>Consider <b>TicTacToe.java</b>. It looks
like a single class, but in fact it contains five inner classes, so that’s six
in all. Once you’ve compiled the program, you package it into a JAR file with
the line:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>jar cf
TicTacToe.jar *.class</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This assumes that the only <b>.class</b>
files in the current directory are the ones from <b>TicTacToe.</b><b>java</b>
(otherwise you’ll get extra baggage).</span></p>

<p class=MsoNormal><span lang=EN-US>Now you can create an HTML page with the
new </span><span lang=EN-US><b>archive</b> tag to indicate the name of the JAR file. Here is the
tag using the old form of the HTML tag, as an illustration:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;head&gt;&lt;title&gt;<b>TicTacToe</b>
Example Applet</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/title&gt;&lt;/head&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;body&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;applet code=<b>TicTacToe</b>.class</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        archive=<b>TicTacToe</b>.jar</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        width=200
height=100&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/applet&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&lt;/body&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>You’ll need to put it into the
new (messy, complicated) form shown earlier in the chapter in order to get it
to work.</span></p>

<h2><a name="_Toc481064832"><span lang=EN-US>Programming techniques</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Because GUI programming in Java has been an
evolving technology with some very significant changes between Java 1.0/1.1 and
the Swing library in Java 2, there have been some old programming idioms that
have seeped through to examples that you might see given for Swing. In
addition, Swing allows you to program in more and better ways than were allowed
by the old models. In this section, some of these issues will be demonstrated
by introducing and examining some programming idioms.</span></p>

<h3><a name="_Toc481064833"><span lang=EN-US>Binding events dynamically</span></a></h3>

<p class=MsoNormal><span lang=EN-US>One of the benefits of the </span><span lang=EN-US>Swing event model is flexibility. You can add and remove event
behavior with single method calls. The following example demonstrates this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c13:DynamicEvents.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// You can change event
behavior dynamically.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Also shows multiple
actions for an event.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=DynamicEvents</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//  width=250
height=400&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
DynamicEvents extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  ArrayList v = new ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b1 = new
JButton(&quot;Button1&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b2 = new
JButton(&quot;Button2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextArea txt = new
JTextArea();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class B implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      txt.append(&quot;A
button was pressed\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class CountListener
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int index;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public
CountListener(int i) { index = i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
txt.append(&quot;Counted Listener &quot;+index+&quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class B1 implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
txt.append(&quot;Button 1 pressed\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ActionListener a =
new CountListener(i++);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v.add(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
b2.addActionListener(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class B2 implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
txt.append(&quot;Button2 pressed\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int end = v.size()
- 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(end &gt;= 0) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
b2.removeActionListener(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
(ActionListener)v.get(end));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        v.remove(end);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b1.addActionListener(new B());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b1.addActionListener(new B1());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b2.addActionListener(new B());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b2.addActionListener(new B2());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel p = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(b1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(b2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.NORTH, p);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JScrollPane(txt));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
DynamicEvents(), 250, 400);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The new twists in this example are: </span></p>

<p class=Numbered><span lang=EN-US>There is more than one listener attached to
each <b>Button</b>. Usually, components handle events as <i>multicast</i>,
meaning that you can register many listeners for a single event. In the special
components in which an event is handled as <i>unicast</i>, you’ll get a <b>TooManyListenersException</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>92.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>During the execution of the program, listeners are dynamically added
and removed from the <b>Button b2</b>. Adding is accomplished in the way you’ve
seen before, but each component also has a <b>removeXXXListener(&nbsp;)</b>
method to remove each type of listener.</span></p>

<p class=MsoNormal><span lang=EN-US>This kind of flexibility provides much
greater power in your programming.</span></p>

<p class=MsoNormal><span lang=EN-US>You should notice that </span><span lang=EN-US>event listeners are not guaranteed to be called in the order they are
added (although most implementations do in fact work that way).</span></p>

<h3><a name="_Toc481064834"><span lang=EN-US>Separating business logic <br>
from UI logic</span></a></h3>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>In general you’ll want to design
your classes so that each one does “only one thing.” This is particularly
important when user-interface code is concerned, since it’s easy to tie up
“what you’re doing” with “how you’re displaying it.” This kind of coupling
prevents code reuse. It’s much more desirable to separate your “business logic”
from the GUI. This way, you can not only reuse the business logic more easily,
it’s also easier to reuse the GUI.</span></p>

<p class=MsoNormal><span lang=EN-US>Another issue is </span><span
lang=EN-US><i>multitiered</i> systems, where the “</span><span lang=EN-US>business objects” reside on a completely separate machine. This
central location of the business rules allows changes to be instantly effective
for all new transactions, and is thus a compelling way to set up a system.
However, these business objects can be used in many different applications and
so should not be tied to any particular mode of display. They should just
perform the business operations and nothing more.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example shows how easy it is
to separate the business logic from the GUI code:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:Separation.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Separating GUI logic
and business objects.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Separation</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=250
height=150&gt; &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.applet.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class BusinessLogic {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int modifier;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
BusinessLogic(int mod) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    modifier = mod;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setModifier(int mod) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    modifier = mod;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int
getModifier() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return modifier;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Some business
operations:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int
calculation1(int arg) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return arg *
modifier;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int
calculation2(int arg) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return arg +
modifier;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Separation
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t = new
JTextField(15),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    mod = new
JTextField(15);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  BusinessLogic bl = new
BusinessLogic(2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    calc1 = new
JButton(&quot;Calculation 1&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    calc2 = new
JButton(&quot;Calculation 2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static int
getValue(JTextField tf) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
Integer.parseInt(tf.getText());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(NumberFormatException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Calc1L
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t.setText(Integer.toString(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        bl.calculation1(getValue(t))));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Calc2L
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t.setText(Integer.toString(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
bl.calculation2(getValue(t))));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // If you want
something to happen whenever</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // a JTextField
changes, add this listener:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class ModL implements
DocumentListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
changedUpdate(DocumentEvent e) {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
insertUpdate(DocumentEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
bl.setModifier(getValue(mod));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void removeUpdate(DocumentEvent
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
bl.setModifier(getValue(mod));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
calc1.addActionListener(new Calc1L());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
calc2.addActionListener(new Calc2L());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel p1 = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p1.add(calc1); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p1.add(calc2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(p1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    mod.getDocument().</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
addDocumentListener(new ModL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel p2 = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p2.add(new
JLabel(&quot;Modifier:&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p2.add(mod);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(p2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Separation(), 250, 100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that <b>BusinessLogic</b> is a
straightforward class that performs its operations without even a hint that it
might be used in a GUI environment. It just does its job.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Separation</span></b><span lang=EN-US>
keeps track of all the UI details, and it talks to <b>BusinessLogic</b> only
through its <b>public</b> interface. All the operations are centered around
getting information back and forth through the UI and the <b>BusinessLogic</b>
object. So <b>Separation</b>, in turn, just does its job. Since <b>Separation</b>
knows only that it’s talking to a <b>BusinessLogic</b> object (that is, it
isn’t highly coupled), it could be massaged into talking to other types of
objects without much trouble.</span></p>

<p class=MsoNormal><span lang=EN-US>Thinking in terms of separating UI from
business logic also makes life easier when you’re adapting legacy code to work
with Java.</span></p>

<h3><a name="_Toc481064835"><span lang=EN-US>A canonical form</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Inner classes, the Swing event model, and
the fact that the old event model is still supported along with new library
features that rely on old-style programming has added a new element of
confusion to the code design process. Now there are even more different ways
for people to write unpleasant code. </span></p>

<p class=MsoNormal><span lang=EN-US>Except in extenuating circumstances you can
always use the simplest and clearest approach: </span><span
lang=EN-US>listener classes (typically written as </span><span lang=EN-US>inner classes) to solve your event-handling needs. This is the form
used in most of the examples in this chapter.</span></p>

<p class=MsoNormal><span lang=EN-US>By following this model you should be able
to reduce the statements in your programs that say: “I wonder what caused this
event.” Each piece of code is concerned with <i>doing</i>, not type-checking.
This is the best way to write your code; not only is it easier to
conceptualize, but much easier to read and maintain.</span></p>

<h2><a name="_Toc481064836"><span lang=EN-US>Visual programming <br>
and Beans</span></a></h2>

<p class=MsoNormal><span lang=EN-US>So far in this book you’ve seen how
valuable Java is for creating reusable pieces of code. The “most reusable” unit
of code has been the class, since it comprises a cohesive unit of
characteristics (fields) and behaviors (methods) that can be reused either
directly via composition or through inheritance.</span></p>

<p class=MsoNormal><span lang=EN-US>Inheritance and polymorphism are essential
parts of object-oriented programming, but in the majority of cases when you’re
putting together an application, what you really want is components that do
exactly what you need. You’d like to drop these parts into your design like the
electronic engineer puts together chips on a circuit board. It seems, too, that
there should be some way to accelerate this “modular assembly” style of
programming.</span></p>

<p class=MsoNormal><span lang=EN-US>“Visual programming” first became successful—<i>very</i>
successful—with Microsoft’s Visual Basic (VB), followed by a second-generation
design in Borland’s Delphi (the primary inspiration for the JavaBeans design).
With these programming tools the components are represented visually, which
makes sense since they usually display some kind of visual component such as a
button or a text field. The visual representation, in fact, is often exactly
the way the component will look in the running program. So part of the process
of visual programming involves dragging a component from a palette and dropping
it onto your form. The </span><span lang=EN-US>application builder tool writes code as you do this, and that code
will cause the component to be created in the running program.</span></p>

<p class=MsoNormal><span lang=EN-US>Simply dropping the component onto a form
is usually not enough to complete the program. Often, you must change the
characteristics of a component, such as what color it is, what text is on it,
what database it’s connected to, etc. Characteristics that can be modified at
design time are referred to as </span><span lang=EN-US><i>properties</i>. You can manipulate the properties of your
component inside the application builder tool, and when you create the program
this configuration data is saved so that it can be rejuvenated when the program
is started.</span></p>

<p class=MsoNormal><span lang=EN-US>By now you’re probably used to the idea
that an object is more than characteristics; it’s also a set of behaviors. At
design-time, the behaviors of a visual component are partially represented by </span><span lang=EN-US><i>events</i>, meaning “Here’s something that can happen to the
component.” Ordinarily, you decide what you want to happen when an event occurs
by tying code to that event.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s the critical part: the application
builder tool uses reflection to dynamically interrogate the component and find
out which properties and events the component supports. Once it knows what they
are, it can display the properties and allow you to change those (saving the
state when you build the program), and also display the events. In general, you
do something like double-clicking on an event and the application builder tool
creates a code body and ties it to that particular event. All you have to do at
that point is write the code that executes when the event occurs.</span></p>

<p class=MsoNormal><span lang=EN-US>All this adds up to a lot of work that’s
done for you by the application builder tool. As a result you can focus on what
the program looks like and what it is supposed to do, and rely on the
application builder tool to manage the connection details for you. The reason
that visual programming tools have been so successful is that they dramatically
speed up the process of building an application—certainly the user interface,
but often other portions of the application as well.</span></p>

<h3><a name="_Toc481064837"><span lang=EN-US>What is a Bean?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>After the dust settles, then, a component
is really just a block of code, typically embodied in a class. The key issue is
the ability for the application builder tool to discover the properties and
events for that component. To create a VB component, the programmer had to
write a fairly complicated piece of code following certain conventions to
expose the properties and events. Delphi was a second-generation visual
programming tool and the language was actively designed around visual
programming so it is much easier to create a visual component. However, Java
has brought the creation of visual components to its most advanced state with
JavaBeans, because a Bean is just a class. You don’t have to write any extra
code or use special language extensions in order to make something a Bean. The
only thing you need to do, in fact, is slightly modify the way that you name
your methods. It is the method name that tells the application builder tool
whether this is a property, an event, or just an ordinary method.</span></p>

<p class=MsoNormal><span lang=EN-US>In the Java documentation, this naming
convention is mistakenly termed a “design pattern.” This is unfortunate, since
design patterns (see <i>Thinking in Patterns with Java</i>, downloadable at <i>www.BruceEckel.com</i>)
are challenging enough without this sort of confusion. It’s not a design pattern,
it’s just a naming convention and it’s fairly simple:</span></p>

<p class=Numbered><span lang=EN-US>For a property named <b>xxx</b>, you
typically create two methods: <b>getXxx(&nbsp;)</b> and <b>setXxx(&nbsp;)</b>.
Note that the first letter after “get” or “set” is automatically lowercased to
produce the property name. The type produced by the “get” method is the same as
the type of the argument to the “set” method. The name of the property and the
type for the “get” and “set” are not related.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>93.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>For a <b>boolean</b> property, you can use the “get” and “set” approach
above, but you can also use “is” instead of “get.”</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>94.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Ordinary methods of the Bean don’t conform to the above naming
convention, but they’re <b>public</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>95.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>For events, you use the Swing “listener” approach. It’s exactly the
same as you’ve been seeing: <b>addFooBarListener(FooBarListener)</b> and <b>removeFooBarListener(FooBarListener)</b>
to handle a <b>FooBarEvent</b>. Most of the time the built-in events and
listeners will satisfy your needs, but you can also create your own events and
listener interfaces.</span></p>

<p class=MsoNormal><span lang=EN-US>Point 1 above answers a question about
something you might have noticed when looking at older code vs. newer code: a
number of method names have had small, apparently meaningless name changes. Now
you can see that most of those changes had to do with adapting to the “get” and
“set” naming conventions in order to make that particular component into a
Bean.</span></p>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>We can use these guidelines to
create a simple Bean:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: frogbean:Frog.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A trivial JavaBean.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package frogbean;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Spots {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Frog {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int jumps;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Color color;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Spots spots;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean jmpr;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int getJumps()
{ return jumps; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setJumps(int newJumps) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    jumps = newJumps;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Color
getColor() { return color; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setColor(Color newColor) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    color = newColor; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Spots
getSpots() { return spots; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setSpots(Spots newSpots) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    spots = newSpots; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean
isJumper() { return jmpr; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setJumper(boolean j) { jmpr = j; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
addActionListener(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ActionListener l)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
removeActionListener(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ActionListener l)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
addKeyListener(KeyListener l) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
removeKeyListener(KeyListener l) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // An
&quot;ordinary&quot; public method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void croak() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Ribbet!&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>First, you can see that it’s just a class.
Usually, all your fields will be <b>private</b>, and accessible only through
methods. Following the naming convention, the properties are <b>jumps</b>, <b>color</b>,
<b>spots</b>, and <b>jumper</b> (notice the case change of the first letter in
the property name). Although the name of the internal identifier is the same as
the name of the property in the first three cases, in <b>jumper</b> you can see
that the property name does not force you to use any particular identifier for
internal variables (or, indeed, to even <i>have</i> any internal variables for
that property).</span></p>

<p class=MsoNormal><span lang=EN-US>The events this Bean handles are <b>ActionEvent</b>
and <b>KeyEvent</b>, based on the naming of the “add” and “remove” methods for
the associated listener. Finally, you can see that the ordinary method <b>croak(&nbsp;)</b>
is still part of the Bean simply because it’s a <b>public</b> method, not
because it conforms to any naming scheme.</span></p>

<h3><a name="_Toc481064838"><span lang=EN-US>Extracting <b>BeanInfo</b> <br>
with the <b>Introspector</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>One of the most critical parts of the Bean
scheme occurs when you drag a Bean off a palette and plop it onto a form. The
application builder tool must be able to create the Bean (which it can do if
there’s a default constructor) and then, without access to the Bean’s source
code, extract all the necessary information to create the property sheet and
event handlers.</span></p>

<p class=MsoNormal><span lang=EN-US>Part of the solution is already evident
from the end of Chapter 12: Java </span><span lang=EN-US><i>reflection</i> allows all the methods of an anonymous class to be
discovered. This is perfect for solving the Bean problem without requiring you
to use any extra language keywords like those required in other visual
programming languages. In fact, one of the prime reasons that reflection was
added to Java was to support Beans (although reflection also supports object
serialization and remote method invocation). So you might expect that the
creator of the application builder tool would have to reflect each Bean and
hunt through its methods to find the properties and events for that Bean.</span></p>

<p class=MsoNormal><span lang=EN-US>This is certainly possible, but the Java
designers wanted to provide a standard tool, not only to make Beans simpler to
use but also to provide a standard gateway to the creation of more complex
Beans. This tool is the </span><span
lang=EN-US><b>Introspector</b> class, and the most important method in this
class is the <b>static </b></span><span lang=EN-US><b>getBeanInfo(&nbsp;)</b>. You pass a <b>Class</b> reference to this
method and it fully interrogates that class and returns a <b>BeanInfo</b>
object that you can then dissect to find properties, methods, and events.</span></p>

<p class=MsoNormal><span lang=EN-US>Usually you won’t care about any of
this—you’ll probably get most of your Beans off the shelf from vendors, and you
don’t need to know all the magic that’s going on underneath. You’ll simply drag
your Beans onto your form, then configure their properties and write handlers
for the events you’re interested in. However, it’s an interesting and
educational exercise to use the <b>Introspector</b> to display information
about a Bean, so here’s a tool that does it:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c13:BeanDumper.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Introspecting a Bean.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=BeanDumper width=600 height=500&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.beans.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
java.lang.reflect.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class BeanDumper
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField query = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new JTextField(20);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextArea results =
new JTextArea();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void prt(String
s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    results.append(s +
&quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void dump(Class
bean){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
results.setText(&quot;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BeanInfo bi = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      bi =
Introspector.getBeanInfo(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        bean,
java.lang.Object.class);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(IntrospectionException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      prt(&quot;Couldn't
introspect &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        bean.getName());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PropertyDescriptor[]
properties = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      bi.getPropertyDescriptors();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; properties.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Class p =
properties[i].getPropertyType();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      prt(&quot;Property
type:\n  &quot; + p.getName() +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Property
name:\n  &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
properties[i].getName());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Method readMethod
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        properties[i].getReadMethod();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(readMethod !=
null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        prt(&quot;Read
method:\n  &quot; + readMethod);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Method writeMethod
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
properties[i].getWriteMethod();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(writeMethod !=
null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        prt(&quot;Write
method:\n  &quot; + writeMethod);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
prt(&quot;====================&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;Public
methods:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MethodDescriptor[]
methods =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
bi.getMethodDescriptors();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; methods.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
prt(methods[i].getMethod().toString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
prt(&quot;======================&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    prt(&quot;Event
support:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    EventSetDescriptor[]
events = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
bi.getEventSetDescriptors();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; events.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      prt(&quot;Listener
type:\n  &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
events[i].getListenerType().getName());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Method[] lm = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        events[i].getListenerMethods();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int j = 0; j
&lt; lm.length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
prt(&quot;Listener method:\n  &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
lm[j].getName());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      MethodDescriptor[]
lmd = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
events[i].getListenerMethodDescriptors();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int j = 0; j
&lt; lmd.length; j++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        prt(&quot;Method
descriptor:\n  &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
lmd[j].getMethod());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Method addListener
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
events[i].getAddListenerMethod();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      prt(&quot;Add
Listener Method:\n  &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          addListener);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Method
removeListener =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        events[i].getRemoveListenerMethod();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      prt(&quot;Remove
Listener Method:\n  &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        removeListener);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
prt(&quot;====================&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Dumper
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String name = query.getText();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Class c = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        c =
Class.forName(name);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(ClassNotFoundException ex) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
results.setText(&quot;Couldn't find &quot; + name);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        return;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      dump(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }      </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel p = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(new
JLabel(&quot;Qualified bean name:&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(query);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.NORTH, p);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JScrollPane(results));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Dumper dmpr = new
Dumper();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
query.addActionListener(dmpr);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
query.setText(&quot;frogbean.Frog&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Force evaluation</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
dmpr.actionPerformed(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ActionEvent(dmpr, 0, &quot;&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
BeanDumper(), 600, 500);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>BeanDumper.dump(&nbsp;)</span></b><span
lang=EN-US> is the method that does all the work. First it tries to create a <b>BeanInfo</b>
object, and if successful calls the methods of <b>BeanInfo</b> that produce
information about properties, methods, and events. In <b>Introspector.getBeanInfo(&nbsp;)</b>,
you’ll see there is a second argument. This tells the <b>Introspector</b> where
to stop in the inheritance hierarchy. Here, it stops before it parses all the
methods from <b>Object</b>, since we’re not interested in seeing those.</span></p>

<p class=MsoNormal><span lang=EN-US>For properties, </span><span lang=EN-US><b>getPropertyDescriptors(&nbsp;)</b> returns an array of </span><span lang=EN-US><b>PropertyDescriptor</b>s. For each <b>PropertyDescriptor</b> you
can call </span><span
lang=EN-US><b>getPropertyType(&nbsp;)</b> to find the class of object that is
passed in and out via the property methods. Then, for each property you can get
its pseudonym (extracted from the method names) with </span><span lang=EN-US><b>getName(&nbsp;)</b>, the method for reading with </span><span lang=EN-US><b>getReadMethod(&nbsp;)</b>, and the method for writing with </span><span lang=EN-US><b>getWriteMethod(&nbsp;)</b>. These last two methods return a <b>Method</b>
object that can actually be used to invoke the corresponding method on the
object (this is part of reflection).</span></p>

<p class=MsoNormal><span lang=EN-US>For the <b>public</b> methods (including
the property methods), </span><span lang=EN-US><b>getMethodDescriptors(&nbsp;)</b> returns an array of </span><span lang=EN-US><b>MethodDescriptor</b>s. For each one you can get the associated </span><span lang=EN-US><b>Method</b> object and print its name.</span></p>

<p class=MsoNormal><span lang=EN-US>For the events, </span><span lang=EN-US><b>getEventSetDescriptors(&nbsp;)</b> returns an array of (what
else?) </span><span lang=EN-US><b>EventSetDescriptor</b>s. Each of these can be
queried to find out the class of the listener, the methods of that listener
class, and the add- and remove-listener methods. The <b>BeanDumper </b>program
prints out all of this information.</span></p>

<p class=MsoNormal><span lang=EN-US>Upon startup, the program forces the
evaluation of <b>frogbean.Frog</b>. The output, after removing extra details
that are unnecessary here, is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class name: Frog</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Property type:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Color</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Property name:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  color</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Read method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Color
getColor()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Write method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setColor(Color)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>====================</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Property type:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Spots</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Property name:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  spots</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Read method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Spots
getSpots()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Write method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setSpots(Spots)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>====================</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Property type:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  boolean</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Property name:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  jumper</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Read method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean
isJumper()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Write method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setJumper(boolean)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>====================</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Property type:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Property name:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  jumps</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Read method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int getJumps()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Write method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setJumps(int)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>====================</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Public methods:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public void
setJumps(int)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public void croak()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public void
removeActionListener(ActionListener)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public void
addActionListener(ActionListener)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public int getJumps()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public void
setColor(Color)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public void
setSpots(Spots)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public void
setJumper(boolean)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public boolean
isJumper()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public void
addKeyListener(KeyListener)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public Color getColor()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public void
removeKeyListener(KeyListener)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public Spots getSpots()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>======================</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Event support:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Listener type:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  KeyListener</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Listener method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  keyTyped</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Listener method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  keyPressed</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Listener method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  keyReleased</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Method descriptor:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void keyTyped(KeyEvent)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Method descriptor:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
keyPressed(KeyEvent)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Method descriptor:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
keyReleased(KeyEvent)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Add Listener Method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
addKeyListener(KeyListener)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Remove Listener Method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
removeKeyListener(KeyListener)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>====================</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Listener type:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  ActionListener</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Listener method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  actionPerformed</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Method descriptor:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
actionPerformed(ActionEvent)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Add Listener Method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
addActionListener(ActionListener)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Remove Listener Method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
removeActionListener(ActionListener)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>====================</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This reveals most of what the <b>Introspector</b>
sees as it produces a <b>BeanInfo</b> object from your Bean. You can see that
the type of the property and its name are independent. Notice the lowercasing
of the property name. (The only time this doesn’t occur is when the property
name begins with more than one capital letter in a row.) And remember that the
method names you’re seeing here (such as the read and write methods) are
actually produced from a <b>Method</b> object that can be used to invoke the
associated method on the object.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>public</b> method list includes the
methods that are not associated with a property or event, such as <b>croak(&nbsp;)</b>,
as well as those that are. These are all the methods that you can call programmatically
for a Bean, and the application builder tool can choose to list all of these
while you’re making method calls, to ease your task.</span></p>

<p class=MsoNormal><span lang=EN-US>Finally, you can see that the events are
fully parsed out into the listener, its methods, and the add- and remove-listener
methods. Basically, once you have the <b>BeanInfo</b>, you can find out
everything of importance for the Bean. You can also call the methods for that
Bean, even though you don’t have any other information except the object
(again, a feature of reflection).</span></p>

<h3><a name="_Toc481064839"><span lang=EN-US>A more sophisticated Bean</span></a></h3>

<p class=MsoNormal><span lang=EN-US>This next example is slightly more
sophisticated, albeit frivolous. It’s a <b>JPanel</b> that draws a little
circle around the mouse whenever the mouse is moved. When you press the mouse,
the word “Bang!” appears in the middle of the screen, and an action listener is
fired.</span></p>

<p class=MsoNormal><span lang=EN-US>The properties you can change are the size
of the circle as well as the color, size, and text of the word that is
displayed when you press the mouse. A <b>BangBean</b> also has its own </span><span lang=EN-US><b>addActionListener(&nbsp;)</b> and </span><span lang=EN-US><b>removeActionListener(&nbsp;)</b> so you can attach your own
listener that will be fired when the user clicks on the <b>BangBean</b>. You
should be able to recognize the property and event support:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: bangbean:BangBean.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A graphical Bean.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package bangbean;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class BangBean
extends JPanel</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     implements
Serializable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected int xm, ym;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected int cSize =
20; // Circle size</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected String text
= &quot;Bang!&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected int fontSize
= 48;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected Color tColor
= Color.red;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected
ActionListener actionListener;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public BangBean() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    addMouseListener(new
ML());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
addMouseMotionListener(new MML());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int
getCircleSize() { return cSize; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setCircleSize(int newSize) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cSize = newSize;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
getBangText() { return text; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setBangText(String newText) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    text = newText;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int
getFontSize() { return fontSize; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setFontSize(int newSize) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fontSize = newSize;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Color
getTextColor() { return tColor; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
setTextColor(Color newColor) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    tColor = newColor;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
paintComponent(Graphics g) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
super.paintComponent(g);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
g.setColor(Color.black);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g.drawOval(xm -
cSize/2, ym - cSize/2, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cSize, cSize);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // This is a unicast
listener, which is</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // the simplest form
of listener management:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
addActionListener (</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ActionListener l) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        throws
TooManyListenersException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(actionListener !=
null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw new
TooManyListenersException();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    actionListener = l;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
removeActionListener(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ActionListener l)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    actionListener =
null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class ML extends
MouseAdapter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
mousePressed(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Graphics g =
getGraphics();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
g.setColor(tColor);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      g.setFont(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new Font(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
&quot;TimesRoman&quot;, Font.BOLD, fontSize));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int width = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
g.getFontMetrics().stringWidth(text);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      g.drawString(text,
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        (getSize().width
- width) /2,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
getSize().height/2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      g.dispose();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Call the
listener's method:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(actionListener
!= null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
actionListener.actionPerformed(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
ActionEvent(BangBean.this,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
ActionEvent.ACTION_PERFORMED, null));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class MML extends
MouseMotionAdapter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
mouseMoved(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      xm = e.getX();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ym = e.getY();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      repaint();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Dimension
getPreferredSize() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Dimension(200, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The first thing you’ll notice is that <b>BangBean</b>
implements the </span><span lang=EN-US><b>Serializable</b> interface. This
means that the application builder tool can “pickle” all the information for
the <b>BangBean</b> using serialization after the program designer has adjusted
the values of the properties. When the Bean is created as part of the running
application, these “pickled” properties are restored so that you get exactly
what you designed.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that all the fields are <b>private</b>,
which is what you’ll usually do with a Bean—allow access only through methods,
usually using the “property” scheme.</span></p>

<p class=MsoNormal><span lang=EN-US>When you look at the signature for <b>addActionListener(&nbsp;)</b>,
you’ll see that it can throw a </span><span
lang=EN-US><b>TooManyListenersException</b>. This indicates that it is </span><span lang=EN-US><i>unicast</i>, which means it notifies only one listener when the
event occurs. Ordinarily, you’ll use </span><span
lang=EN-US><i>multicast</i> events so that many listeners can be notified of an
event. However, that runs into issues that you won’t be ready for until the
next chapter, so it will be revisited there (under the heading “JavaBeans
revisited”). A unicast event sidesteps the problem.</span></p>

<p class=MsoNormal><span lang=EN-US>When you click the mouse, the text is put
in the middle of the <b>BangBean</b>, and if the <b>actionListener</b> field is
not <b>null</b>, its <b>actionPerformed(&nbsp;)</b> is called, creating a new </span><span lang=EN-US><b>ActionEvent </b>object in the process. Whenever the mouse is
moved, its new coordinates are captured and the canvas is repainted (erasing
any text that’s on the canvas, as you’ll see).</span></p>

<p class=MsoNormal><span lang=EN-US>Here is the <b>BangBeanTest</b> class to
allow you to test the bean as either an applet or an application:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c13:BangBeanTest.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=BangBeanTest </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=400
height=500&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import bangbean.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class BangBeanTest
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField txt = new
JTextField(20);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // During testing,
report actions:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class BBL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int count = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
txt.setText(&quot;BangBean action &quot;+ count++);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BangBean bb = new
BangBean();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
bb.addActionListener(new BBL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(TooManyListenersException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
txt.setText(&quot;Too many listeners&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(bb);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
cp.add(BorderLayout.SOUTH, txt);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
BangBeanTest(), 400, 500);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When a Bean is in a development
environment, this class will not be used, but it’s helpful to provide a rapid
testing method for each of your Beans. <b>BangBeanTest</b> places a <b>BangBean</b>
within the applet, attaching a simple <b>ActionListener</b> to the <b>BangBean</b>
to print an event count to the <b>JTextField </b>whenever an <b>ActionEvent</b>
occurs. Usually, of course, the application builder tool would create most of
the code that uses the Bean.</span></p>

<p class=MsoNormal><span lang=EN-US>When you run the <b>BangBean</b> through <b>BeanDumper</b>
or put the <b>BangBean</b> inside a Bean-enabled development environment,
you’ll notice that there are many more properties and actions than are evident
from the above code. That’s because <b>BangBean</b> is inherited from <b>JPanel</b>,
and <b>JPanel </b>is also Bean, so you’re seeing its properties and events as
well.</span></p>

<h3><a name="_Toc481064840"><span lang=EN-US>Packaging a Bean</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Before you can bring a Bean into a Bean-enabled visual builder tool,
it must be put into the standard Bean container, which is a JAR file that
includes all the Bean classes as well as a “manifest” file that says “This is a
Bean.” A manifest file is simply a text file that follows a particular form.
For the <b>BangBean</b>, the manifest file looks like this (without the first
and last lines):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:! :BangBean.mf</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Manifest-Version: 1.0</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Name:
bangbean/BangBean.class</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Java-Bean: True</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The first line indicates the version of the
manifest scheme, which until further notice from Sun is 1.0. The second line
(empty lines are ignored) names the <b>BangBean.class</b> file, and the third
says, “It’s a Bean.” Without the third line, the program builder tool will not
recognize the class as a Bean.</span></p>

<p class=MsoNormal><span lang=EN-US>The only tricky part is that you must make
sure that you get the proper path in the “Name:” field. If you look back at <b>BangBean.java</b>,
you’ll see it’s in <b>package bangbean </b>(and thus in a subdirectory called
“bangbean” that’s off of the classpath), and the name in the manifest file must
include this package information. In addition, you must place the manifest file
in the directory <i>above</i> the root of your package path, which in this case
means placing the file in the directory above the “bangbean” subdirectory. Then
you must invoke <b>jar</b> from the same directory as the manifest file, as
follows:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>jar cfm
BangBean.jar BangBean.mf bangbean</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This assumes that you want the resulting
JAR file to be named <b>BangBean.jar</b> and that you’ve put the manifest in a
file called <b>BangBean.mf</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>You might wonder “What about all the other
classes that were generated when I compiled <b>BangBean.java</b>?” Well, they
all ended up inside the <b>bangbean</b> subdirectory, and you’ll see that the
last argument for the above <b>jar</b> command line is the <b>bangbean</b>
subdirectory. When you give <b>jar</b> the name of a subdirectory, it packages
that entire subdirectory into the jar file (including, in this case, the
original <b>BangBean.java</b> source-code file—you might not choose to include
the source with your own Beans). In addition, if you turn around and unpack the
JAR file you’ve just created, you’ll discover that your manifest file isn’t
inside, but that <b>jar</b> has created its own manifest file (based partly on
yours) called <b>MANIFEST.MF </b>and placed it inside the subdirectory <b>META-INF</b>
(for “meta-information”). If you open this manifest file you’ll also notice
that digital signature information has been added by <b>jar </b>for each file,
of the form:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Digest-Algorithms: SHA
MD5 </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>SHA-Digest:
pDpEAG9NaeCx8aFtqPI4udSX/O0=</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>MD5-Digest:
O4NcS1hE3Smnzlp2hj6qeg==</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In general, you don’t need to worry about
any of this, and if you make changes you can just modify your original manifest
file and reinvoke <b>jar</b> to create a new JAR file for your Bean. You can
also add other Beans to the JAR file simply by adding their information to your
manifest.</span></p>

<p class=MsoNormal><span lang=EN-US>One thing to notice is that you’ll probably
want to put each Bean in its own subdirectory, since when you create a JAR file
you hand the <b>jar</b> utility the name of a subdirectory and it puts
everything in that subdirectory into the JAR file. You can see that both <b>Frog</b>
and <b>BangBean</b> are in their own subdirectories.</span></p>

<p class=MsoNormal><span lang=EN-US>Once you have your Bean properly inside a
JAR file you can bring it into a Beans-enabled program-builder environment. The
way you do this varies from one tool to the next, but Sun provides a freely
available test bed for JavaBeans in their “Beans Development Kit” (BDK) called
the “</span><span lang=EN-US>beanbox.” (Download the BDK from <i>java.sun.com/beans</i>.)
To place your Bean in the beanbox, copy the JAR file into the BDK’s “jars”
subdirectory before you start up the beanbox.</span></p>

<h3><a name="_Toc481064841"><span lang=EN-US>More complex Bean support</span></a></h3>

<p class=MsoNormal><span lang=EN-US>You can see how remarkably simple it is to
make a Bean. But you aren’t limited to what you’ve seen here. The JavaBeans
architecture provides a simple point of entry but can also scale to more
complex situations. These situations are beyond the scope of this book, but
they will be briefly introduced here. You can find more details at <i>java.sun.com/beans</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>One place where you can add sophistication
is with properties. The examples above have shown only single properties, but
it’s also possible to represent multiple properties in an array. This is called
an </span><span lang=EN-US><i>indexed property</i>. You simply provide the
appropriate methods (again following a naming convention for the method names)
and the <b>Introspector</b> recognizes an indexed property so your application
builder tool can respond appropriately.</span></p>

<p class=MsoNormal><span lang=EN-US>Properties can be </span><span lang=EN-US><i>bound</i>, which means that they will notify other objects via a <b>PropertyChangeEvent</b>.
The other objects can then choose to change themselves based on the change to
the Bean.</span></p>

<p class=MsoNormal><span lang=EN-US>Properties can be </span><span lang=EN-US><i>constrained</i>, which means that other objects can veto a change
to that property if it is unacceptable. The other objects are notified using a </span><span lang=EN-US><b>PropertyChangeEvent</b>, and they can throw a </span><span lang=EN-US><b>PropertyVetoException</b> to prevent the change from happening and
to restore the old values.</span></p>

<p class=MsoNormal><span lang=EN-US>You can also change the way your Bean is represented at design time:</span></p>

<p class=Numbered><span lang=EN-US>You can provide a custom property sheet for
your particular Bean. The ordinary property sheet will be used for all other
Beans, but yours is automatically invoked when your Bean is selected.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>96.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>You can create a custom editor for a particular property, so the
ordinary property sheet is used, but when your special property is being
edited, your editor will automatically be invoked.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>97.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>You can provide a custom <b>BeanInfo</b> class for your Bean that
produces information that’s different from the default created by the <b>Introspector</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>98.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>It’s also possible to turn “expert” mode on and off in all <b>FeatureDescriptor</b>s
to distinguish between basic features and more complicated ones.</span></p>

<h3><a name="_Toc481064842"><span lang=EN-US>More to Beans</span></a></h3>

<p class=MsoNormal><span lang=EN-US>There’s another issue that couldn’t be
addressed here. Whenever you create a Bean, you should expect that it will be
run in a multithreaded environment. This means that you must understand the
issues of threading, which will be introduced in Chapter 14. You’ll find a
section there called “JavaBeans revisited” that will look at the problem and
its solution.</span></p>

<p class=MsoNormal><span lang=EN-US>There are a number of books about
JavaBeans; for example, <i>JavaBeans</i> by Elliotte Rusty Harold (IDG, 1998).</span></p>

<h2><a name="_Toc481064843"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Of all the libraries in Java, the GUI
library has seen the most dramatic changes from Java 1.0 to Java 2. The Java
1.0 AWT was roundly criticized as being one of the worst designs seen, and
while it would allow you to create portable programs, the resulting GUI was
“equally mediocre on all platforms.” It was also limiting, awkward, and
unpleasant to use compared with the native application development tools
available on a particular platform.</span></p>

<p class=MsoNormal><span lang=EN-US>When Java 1.1 introduced the new event
model and JavaBeans, the stage was set—now it was possible to create GUI
components that could be easily dragged and dropped inside visual application
builder tools. In addition, the design of the event model and Beans clearly
shows strong consideration for ease of programming and maintainable code
(something that was not evident in the 1.0 AWT). But it wasn’t until the
JFC/Swing classes appeared that the job was finished. With the Swing components,
cross-platform GUI programming can be a civilized experience.</span></p>

<p class=MsoNormal><span lang=EN-US>Actually, the only thing that’s missing is
the application builder tool, and this is where the real revolution lies. </span><span lang=EN-US>Microsoft’s Visual Basic and Visual C++ require Microsoft’s
application builder tools, as does </span><span
lang=EN-US>Borland’s Delphi and C++ Builder. If you want the application
builder tool to get better, you have to cross your fingers and hope the vendor
will give you what you want. But Java is an open environment, and so not only
does it allow for competing application builder environments, it encourages
them. And for these tools to be taken seriously, they must support JavaBeans.
This means a leveled playing field: if a better application builder tool comes
along, you’re not tied to the one you’ve been using—you can pick up and move to
the new one and increase your productivity. This kind of competitive
environment for GUI application builder tools has not been seen before, and the
resulting marketplace can generate only positive results for the productivity
of the programmer.</span></p>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>This chapter was meant only to
give you an introduction to the power of Swing and to get you started so you
could see how relatively simple it is to feel your way through the libraries.
What you’ve seen so far will probably suffice for a good portion of your UI
design needs. However, there’s a lot more to Swing—it’s intended to be a fully
powered UI design tool kit. There’s probably a way to accomplish just about
everything you can imagine.</span></p>

<p class=MsoNormal><span lang=EN-US>If you don’t see what you need here, delve
into the online documentation from Sun and search the Web, and if that’s not
enough then find a dedicated Swing book—a good place to start is <i>The JFC
Swing Tutorial</i>, by Walrath &amp; Campione (Addison Wesley, 1999). </span></p>

<h2><a name="_Toc481064844"></a><a name="_Toc375545470"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an applet/application using the <b>Console</b>
class as shown in this chapter. Include a text field and three buttons. When
you press each button, make some different text appear in the text field.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>210. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add a check box to the applet created in
Exercise 1, capture the event, and insert different text into the text field.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>211. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an applet/application using <b>Console</b>.
In the HTML documentation from <i>java.sun.com</i>, find the <b>JPasswordField</b>
and add this to the program. If the user types in the correct password, use <b>Joptionpane</b>
to provide a success message to the user.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>212. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an applet/application using <b>Console</b>,
and add all the components that have an <b>addActionListener(&nbsp;)</b>
method. (Look these up in the HTML documentation from <i>java.sun.com</i>.
Hint: use the index.) Capture their events and display an appropriate message
for each inside a text field.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>213. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an applet/application using <b>Console</b>,
with a <b>JButton</b> and a<b> JText</b><b>Field</b>. Write and attach the
appropriate listener so that if the button has the focus, characters typed into
it will appear in the<b> JText</b><b>Field</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>214. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an applet/application using <b>Console</b>.
Add to the main frame all the components described in this chapter, including
menus and a dialog box.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>215. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>TextFields.java</b> so that the
characters in <b>t2</b> retain the original case that they were typed in,
instead of automatically being forced to upper case.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>216. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Locate and download one or more of the free GUI
builder development environments available on the Internet, or buy a commercial
product. Discover what is necessary to add <b>BangBean</b> to this environment
and to use it.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>217. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Add <b>Frog.class</b> to the manifest file as
shown in this chapter and run <b>jar</b> to create a JAR file containing both <b>Frog</b>
and <b>BangBean</b>. Now either download and install the BDK from Sun or use
your own Beans-enabled program builder tool and add the JAR file to your
environment so you can test the two Beans.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>218. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create your own JavaBean called <b>Valve </b>that
contains two properties: a <b>boolean</b> called “on” and an <b>int</b> called
“level.” Create a manifest file, use <b>jar</b> to package your Bean, then load
it into the beanbox or into a Beans-enabled program builder tool so that you
can test it.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>219. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>MessageBoxes.java</b> so that it has
an individual <b>ActionListener</b> for each button (instead of matching the
button text).</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>220. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Monitor a new type of event in <b>TrackEvent.java</b>
by adding the new event handling code. You’ll need to discover on your own the
type of event that you want to monitor.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>221. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Inherit a new type of button from <b>JButton</b>.
Each time you press this button, it should change its color to a
randomly-selected value. See <b>ColorBoxes.java</b> in Chapter 14 for an
example of how to generate a random color value.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>222. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>TextPane.java</b> to use a <b>JTextArea</b>
instead of a <b>JTextPane</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>223. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>Menus.java</b> to use radio buttons
instead of check boxes on the menus.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>224. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Simplify <b>List.java</b> by passing the array
to the constructor and eliminating the dynamic addition of elements to the
list.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>225. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>SineWave.java </b>to turn <b>SineDraw</b>
into a JavaBean by adding “getter” and “setter” methods.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>226. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Remember the “sketching box” toy with two knobs,
one that controls the vertical movement of the drawing point, and one that
controls the horizontal movement? Create one of those, using <b>SineWave.java </b>to
get you started. Instead of knobs, use sliders. Add a button that will erase
the entire sketch.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>227. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an “asymptotic progress indicator” that
gets slower and slower as it approaches the finish point. Add random erratic
behavior so it will periodically look like it’s starting to speed up.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>228. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>Progress.java</b> so that it does not
share models, but instead uses a listener to connect the slider and progress
bar.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>229. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Follow the instructions in the section titled
“Packaging an applet into a JAR file” to place <b>TicTacToe.java</b> into a JAR
file. Create an HTML page with the (messy, complicated) version of the applet
tag, and modify it to use the archive tag so as to use the JAR file. (Hint:
start with the HTML page for <b>TicTacToe.java </b>that comes with this book’s
source-code distribution.)</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>230. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create an applet/application using <b>Console</b>.
This should have three sliders, one each for the red, green, and blue values in
<b>java.awt.Color</b>. The rest of the form should be a <b>JPanel</b> that
displays the color determined by the three sliders. Also include non-editable
text fields that show the current RGB values.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>231. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In the HTML documentation for <b>javax.swing</b>,
look up the <b>JColorChooser</b>. Write a program with a button that brings up
the color chooser as a dialog.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>232. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Almost every Swing component is derived from <b>Component</b>,
which has a <b>setCursor(&nbsp;)</b> method. Look this up in the Java HTML
documentation. Create an applet and change the cursor to one of the stock
cursors in the <b>Cursor</b> class.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>233. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Starting with <b>ShowAddListeners.java</b>,
create a program with the full functionality of <b>ShowMethodsClean.java</b>
from Chapter 12.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection20>

<h1><a name="_Toc481064845"></a><a name="_Toc477690734"></a><a
name="_Toc375545471"></a><a name="Chapter_16"></a><span lang=EN-US>14: Multiple
Threads</span></h1>

<p class=Intro><span lang=EN-US>Objects provide a way to divide a program into
independent sections. Often, you also need to turn a program into separate,
independently running subtasks.</span></p>

<p class=MsoNormal><span lang=EN-US>Each of these independent subtasks is
called a </span><span lang=EN-US><i>thread</i>, and you program as if each
thread runs by itself and has the CPU to itself. Some underlying mechanism is
actually dividing up the CPU time for you, but in general, you don’t have to
think about it, which makes programming with multiple threads a much easier
task.</span></p>

<p class=MsoNormal><span lang=EN-US>A </span><span
lang=EN-US><i>process</i> is a self-contained running program with its own
address space. A </span><span lang=EN-US><i>multitasking</i> operating system is
capable of running more than one process (program) at a time, while making it
look like each one is chugging along on its own, by periodically providing CPU
cycles to each process. A thread is a single sequential flow of control within
a process. A single process can thus have multiple concurrently executing
threads.</span></p>

<p class=MsoNormal><span lang=EN-US>There are many possible uses for
multithreading, but in general, you’ll have some part of your program tied to a
particular event or resource, and you don’t want to hang up the rest of your program
because of that. So you create a thread associated with that event or resource
and let it run independently of the main program. A good example is a “quit”
button—you don’t want to be forced to poll the quit button in every piece of
code you write in your program and yet you want the quit button to be
responsive, as if you <i>were</i> checking it regularly. In fact, one of the
most immediately compelling reasons for multithreading is to produce a
responsive user interface.</span></p>

<h2><a name="_Toc481064846"></a><a name="_Toc375545472"><span lang=EN-US>Responsive
user interfaces</span></a></h2>

<p class=MsoNormal><span
lang=EN-US>As a starting point, consider a program that performs some
CPU-intensive operation and thus ends up ignoring user input and being
unresponsive. This one, a combined applet/application, will simply display the
result of a running counter:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:Counter1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A non-responsive user
interface.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Counter1 width=300 height=100&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Counter1
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int count = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JButton</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start = new
JButton(&quot;Start&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    onOff = new
JButton(&quot;Toggle&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JTextField t =
new JTextField(10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean
runFlag = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
start.addActionListener(new StartL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(start);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
onOff.addActionListener(new OnOffL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(onOff);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void go() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while (true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        Thread.sleep(100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if (runFlag)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t.setText(Integer.toString(count++));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class StartL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void actionPerformed(ActionEvent
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      go();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class OnOffL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      runFlag =
!runFlag;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Counter1(), 300, 100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>At this point, the Swing and applet code
should be reasonably familiar from Chapter 13. The <b>go(&nbsp;)</b> method is
where the program stays busy: it puts the current value of <b>count</b> into
the<b> JText</b><b>Field t</b>, then increments <b>count</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Part of the infinite loop inside <b>go(&nbsp;)</b>
is to call <b>sleep(&nbsp;)</b>. </span><span
lang=EN-US><b>sleep(&nbsp;)</b> must be associated with a </span><span lang=EN-US><b>Thread</b> object, and it turns out that every application has <i>some</i>
thread associated with it. (Indeed, Java is based on threads and there are always
some running along with your application.) So regardless of whether you’re
explicitly using threads, you can produce the current thread used by your
program with <b>Thread </b>and the static <b>sleep(&nbsp;)</b> method.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that <b>sleep(&nbsp;)</b> can throw an
</span><span lang=EN-US><b>InterruptedException</b>, although throwing such an
exception is considered a hostile way to break from a thread and should be
discouraged. (Once again, exceptions are for exceptional conditions, not normal
flow of control.) Interrupting a sleeping thread is included to support a
future language feature.</span></p>

<p class=MsoNormal><span lang=EN-US>When the <b>start</b> button is pressed, <b>go(&nbsp;)</b>
is invoked. On examining <b>go(&nbsp;)</b>, you might naively think (as I did)
that it should allow multithreading because it goes to sleep. That is, while
the method is asleep, it seems like the CPU could be busy monitoring other
button presses. But it turns out that the real problem is that <b>go(&nbsp;)</b>
never returns, since it’s in an infinite loop, and this means that <b>actionPerformed(&nbsp;)</b>
never returns. Since you’re stuck inside <b>actionPerformed(&nbsp;)</b> for the
first keypress, the program can’t handle any other events. (To get out, you
must somehow kill the process; the easiest way to do this is to press Control-C
in the console window, if you started it from the console. If you start it via
the browser, you have to kill the browser window.)</span></p>

<p class=MsoNormal><span lang=EN-US>The basic problem here is that <b>go(&nbsp;)</b>
needs to continue performing its operations, and at the same time it needs to
return so that <b>actionPerformed(&nbsp;)</b> can complete and the user
interface can continue responding to the user. But in a conventional method
like <b>go(&nbsp;)</b> it cannot continue <i>and</i> at the same time return
control to the rest of the program. This sounds like an impossible thing to
accomplish, as if the CPU must be in two places at once, but this is precisely
the illusion that threading provides. </span></p>

<p class=MsoNormal><span lang=EN-US>The thread model (and its programming
support in Java) is a programming convenience to simplify juggling several
operations at the same time within a single program. With threads, the CPU will
pop around and give each thread some of its time. Each thread has the
consciousness of constantly having the CPU to itself, but the CPU’s time is
actually sliced between all the threads. The exception to this is if your
program is running on multiple CPUs. But one of the great things about
threading is that you are abstracted away from this layer, so your code does
not need to know whether it is actually running on a single CPU or many. Thus,
threads are a way to create transparently scalable programs.</span></p>

<p class=MsoNormal><span lang=EN-US>Threading reduces computing efficiency somewhat, but the net
improvement in program design, resource balancing, and user convenience is
often quite valuable. Of course, if you have more than one CPU, then the operating
system can dedicate each CPU to a set of threads or even a single thread and
the whole program can run much faster. Multitasking and multithreading tend to
be the most reasonable ways to utilize multiprocessor systems.</span></p>

<h3><a name="_Toc481064847"></a><a name="_Toc375545473"><span lang=EN-US>Inheriting
from <b>Thread</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>The simplest way to create a thread is to
inherit from class <b>Thread</b>, which has all the wiring necessary to create
and run threads. The most important method for <b>Thread</b> is <b>run(&nbsp;)</b>,
which you must override to make the thread do your bidding. Thus, <b>run(&nbsp;)</b>
is the code that will be executed “simultaneously” with the other threads in a
program.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example creates any number of
threads that it keeps track of by assigning each thread a unique number,
generated with a <b>static</b> variable. The </span><span
lang=EN-US><b>Thread</b>’s <b>run(&nbsp;)</b> method is overridden to count
down each time it passes through its loop and to finish when the count is zero
(at the point when <b>run(&nbsp;)</b> returns, the thread is terminated).</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c14:SimpleThread.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Very simple Threading
example.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
SimpleThread extends Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int countDown
= 5;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static int
threadCount = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int
threadNumber = ++threadCount;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public SimpleThread()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Making &quot; + threadNumber);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Thread &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        threadNumber +
&quot;(&quot; + countDown + &quot;)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(--countDown ==
0) return;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 5; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
SimpleThread().start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;All
Threads Started&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>A <b>run(&nbsp;)</b> method virtually
always has some kind of loop that continues until the thread is no longer
necessary, so you must establish the condition on which to break out of this
loop (or, in the case above, simply <b>return</b> from <b>run(&nbsp;)</b>).
Often, <b>run(&nbsp;)</b> is cast in the form of an infinite loop, which means
that, barring some external factor that causes <b>run(&nbsp;)</b> to terminate,
it will continue forever.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>main(&nbsp;) </b>you can see a number
of threads being created and run. The <b>start(&nbsp;) </b>method in the </span><span lang=EN-US><b>Thread</b> class performs special initialization for the thread
and then calls <b>run(&nbsp;)</b>. So the steps are: the constructor is called
to build the object, then <b>start(&nbsp;)</b> configures the thread and calls <b>run(&nbsp;)</b>.
If you don’t call <b>start(&nbsp;)</b> (which you can do in the constructor, if
that’s appropriate) the thread will never be started.</span></p>

<p class=MsoNormal><span lang=EN-US>The output for one run of this program (it
will be different from one run to another) is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Making 1</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Making 2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Making 3</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Making 4</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Making 5</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 1(5)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 1(4)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 1(3)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 1(2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 2(5)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 2(4)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 2(3)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 2(2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 2(1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 1(1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>All Threads Started</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 3(5)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 4(5)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 4(4)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 4(3)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 4(2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 4(1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 5(5)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 5(4)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 5(3)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 5(2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 5(1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 3(4)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 3(3)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Thread 3(2)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Thread 3(1)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll notice that nowhere in this example
is <b>sleep(&nbsp;)</b> called, and yet the output indicates that each thread
gets a portion of the CPU’s time in which to execute. This shows that <b>sleep(&nbsp;)</b>,
while it relies on the existence of a thread in order to execute, is not
involved with either enabling or disabling threading. It’s simply another
method.</span></p>

<p class=MsoNormal><span lang=EN-US>You can also see that the </span><span lang=EN-US>threads are not run in the order that they’re created. In fact, the
order that the CPU attends to an existing set of threads is indeterminate,
unless you go in and adjust the priorities using <b>Thread</b>’s <b>setPriority(&nbsp;)</b>
method.</span></p>

<p class=MsoNormal><span lang=EN-US>When <b>main(&nbsp;)</b> creates the <b>Thread</b>
objects it isn’t capturing the references for any of them. An ordinary object
would be fair game for garbage collection, but not a <b>Thread</b>. Each <b>Thread</b>
“registers” itself so there is actually a reference to it someplace and the
garbage collector can’t clean it up.</span></p>

<h3><a name="_Toc481064848"></a><a name="_Toc375545474"><span lang=EN-US>Threading
for a responsive interface</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>Now it’s possible to solve the problem in <b>Counter1.java </b>with
a thread. The trick is to place the subtask—that is, the loop that’s inside <b>go(&nbsp;)</b>—inside
the <b>run(&nbsp;)</b> method of a thread. When the user presses the <b>start</b>
button, the thread is started, but then the <i>creation</i> of the thread
completes, so even though the thread is running, the main job of the program
(watching for and responding to user-interface events) can continue. Here’s the
solution:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:Counter2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A responsive user
interface with threads.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Counter2 width=300 height=100&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Counter2
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private class
SeparateSubTask extends Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int count =
0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private boolean
runFlag = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    SeparateSubTask() {
start(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    void invertFlag() {
runFlag = !runFlag; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while (true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sleep(100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       if(runFlag) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        
t.setText(Integer.toString(count++));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  } </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private
SeparateSubTask sp = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JTextField t =
new JTextField(10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start = new
JButton(&quot;Start&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    onOff = new
JButton(&quot;Toggle&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class StartL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(sp == null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sp = new SeparateSubTask();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class OnOffL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(sp != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sp.invertFlag();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
start.addActionListener(new StartL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(start);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
onOff.addActionListener(new OnOffL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(onOff);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Counter2 (), 300, 100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>Counter2</span></b><span lang=EN-US> is
a straightforward program, whose only job is to set up and maintain the user
interface. But now, when the user presses the <b>start</b> button, the
event-handling code does not call a method. Instead a thread of class <b>SeparateSubTask</b>
is created, and then the <b>Counter2</b> event loop continues. </span></p>

<p class=MsoNormal><span lang=EN-US>The class <b>SeparateSubTask</b> is a
simple extension of <b>Thread</b> with a constructor that runs the thread by
calling <b>start(&nbsp;)</b>, and a <b>run(&nbsp;)</b> that essentially
contains the “<b>go(&nbsp;)</b>” code from <b>Counter1.java</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Because <b>SeparateSubTask</b> is an inner
class, it can directly access the <b>JTextField t </b>in <b>Counter2</b>; you
can see this happening inside <b>run(&nbsp;)</b>. The <b>t</b> field in the
outer class is <b>private</b> since <b>SeparateSubTask</b> can access it
without getting any special permission—and it’s always good to make fields “as <b>private</b>
as possible” so they cannot be accidentally changed by forces outside your
class.</span></p>

<p class=MsoNormal><span lang=EN-US>When you press the <b>onOff</b> button it
toggles the <b>runFlag</b> inside the <b>SeparateSubTask</b> object. That
thread (when it looks at the flag) can then start and stop itself. Pressing the
<b>onOff</b> button produces an apparently instant response. Of course, the
response isn’t really instant, not like that of a system that’s driven by
interrupts. The counter stops only when the thread has the CPU and notices that
the flag has changed.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the </span><span lang=EN-US>inner class <b>SeparateSubTask</b> is <b>private</b>, which means
that its fields and methods can be given default access (except for <b>run(&nbsp;)</b>,
which must be <b>public</b> since it is <b>public</b> in the base class). The <b>private
</b>inner class is not accessible to anyone but <b>Counter2</b>, and the two
classes are tightly coupled. Anytime you notice classes that appear to have
high coupling with each other, consider the coding and maintenance improvements
you might get by using inner classes.</span></p>

<h3><a name="_Toc481064849"></a><a name="_Toc375545475"><span lang=EN-US>Combining
the thread <br>
with the main class</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>In the example above you can see that the thread class is separate
from the program’s main class. This makes a lot of sense and is relatively easy
to understand. There is, however, an alternate form that you will often see
used that is not so clear but is usually more concise (which probably accounts
for its popularity). This form combines the main program class with the thread
class by making the main program class a thread. Since for a GUI program the
main program class must be inherited from either <b>Frame</b> or <b>Applet</b>,
an interface must be used to paste on the additional functionality. This
interface is called <b>Runnable</b>, and it contains the same basic method that
<b>Thread</b> does. In fact, <b>Thread</b> also implements <b>Runnable</b>,
which specifies only that there be a <b>run(&nbsp;)</b> method.</span></p>

<p class=MsoNormal><span lang=EN-US>The <i>use</i> of the combined
program/thread is not quite so obvious. When you start the program, you create
an object that’s <b>Runnable</b>, but you don’t start the thread. This must be
done explicitly. You can see this in the following program, which reproduces
the functionality of <b>Counter2</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:Counter3.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using the Runnable
interface to turn the </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// main class into a
thread.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Counter3 width=300 height=100&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Counter3 </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    extends JApplet
implements Runnable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int count = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean
runFlag = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Thread
selfThread = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start = new
JButton(&quot;Start&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    onOff = new
JButton(&quot;Toggle&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JTextField t =
new JTextField(10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while (true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        selfThread.sleep(100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(runFlag) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t.setText(Integer.toString(count++));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class StartL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void actionPerformed(ActionEvent
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(selfThread ==
null) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        selfThread = new
Thread(Counter3.this);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
selfThread.start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class OnOffL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      runFlag =
!runFlag;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
start.addActionListener(new StartL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(start);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
onOff.addActionListener(new OnOffL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(onOff);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Counter3(), 300, 100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Now the <b>run(&nbsp;)</b> is inside the
class, but it’s still dormant after <b>init(&nbsp;)</b> completes. When you
press the <b>start</b> button, the thread is created (if it doesn’t already
exist) in the somewhat obscure expression:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>new
Thread(Counter3.this);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When something has a </span><span lang=EN-US><b>Runnable</b> interface, it simply means that it has a <b>run(&nbsp;)</b>
method, but there’s nothing special about that—it doesn’t produce any innate
threading abilities, like those of a class inherited from <b>Thread</b>. So to
produce a thread from a <b>Runnable</b> object, you must create a separate <b>Thread</b>
object as shown above, handing the <b>Runnable</b> object to the special <b>Thread
</b>constructor. You can then call <b>start(&nbsp;)</b> for that thread:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>selfThread.start();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This performs the usual initialization and
then calls <b>run(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The convenient aspect about the <b>Runnable
interface</b> is that everything belongs to the same class. If you need to
access something, you simply do it without going through a separate object.
However, as you saw in the previous example, this access is just as easy using
an inner class</span><a href="#_ftn70" name="_ftnref70" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[70]</span></span></span></span></a><span lang=EN-US>.</span></p>

<h3><a name="_Toc481064850"></a><a name="_Toc375545476"><span lang=EN-US>Making
many threads</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Consider the creation of many different
threads. You can’t do this with the previous example, so you must go back to
having separate classes inherited from <b>Thread</b> to encapsulate the <b>run(&nbsp;)</b>.
But this is a more general solution and easier to understand, so while the
previous example shows a coding style you’ll often see, I can’t recommend it
for most cases because it’s just a little bit more confusing and less flexible.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example repeats the form of
the examples above with counters and toggle buttons. But now all the
information for a particular counter, including the button and text field, is
inside its own object that is inherited from <b>Thread</b>. All the fields in <b>Ticker</b>
are <b>private</b>, which means that the <b>Ticker</b> implementation can be
changed at will, including the quantity and type of data components to acquire
and display information. When a <b>Ticker</b> object is created, the
constructor adds its visual components to the content pane of the outer object:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:Counter4.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// By keeping your
thread as a distinct class,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// you can have as many
threads as you want. </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Counter4 width=200 height=600&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;param name=size
value=&quot;12&quot;&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Counter4
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JButton start
= new JButton(&quot;Start&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean
started = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Ticker[] s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean
isApplet = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int size = 12;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Ticker extends
Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private JButton b =
new JButton(&quot;Toggle&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private JTextField t
= new JTextField(10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int count =
0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private boolean
runFlag = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Ticker() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
b.addActionListener(new ToggleL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JPanel p = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      p.add(t);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      p.add(b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Calls
JApplet.getContentPane().add():</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
getContentPane().add(p); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    class ToggleL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        runFlag =
!runFlag;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while (true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if (runFlag)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
t.setText(Integer.toString(count++));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          sleep(100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class StartL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(!started) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        started = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for (int i = 0;
i &lt; s.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          s[i].start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Get parameter
&quot;size&quot; from Web page:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if (isApplet) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String sz =
getParameter(&quot;size&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(sz != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        size =
Integer.parseInt(sz);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s = new
Ticker[size];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for (int i = 0; i
&lt; s.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s[i] = new
Ticker();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
start.addActionListener(new StartL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(start);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Counter4 applet =
new Counter4();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // This isn't an
applet, so set the flag and</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // produce the
parameter values from args:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.isApplet =
false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length != 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      applet.size =
Integer.parseInt(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(applet,
200, applet.size * 50);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>Ticker</span></b><span lang=EN-US>
contains not only its threading equipment but also the way to control and
display the thread. You can create as many threads as you want without
explicitly creating the windowing components.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>Counter4</b> there’s an array of <b>Ticker</b>
objects called <b>s</b>. For maximum flexibility, the size of this array is
initialized by reaching out into the Web page using applet parameters. Here’s
what the size parameter looks like on the page, embedded inside the applet tag:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&lt;param
name=size value=&quot;20&quot;&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The </span><span lang=EN-US><b>param</b>, </span><span
lang=EN-US><b>name</b>, and </span><span lang=EN-US><b>value</b> are all HTML keywords. <b>name</b> is what you’ll be
referring to in your program, and <b>value</b> can be any string, not just
something that resolves to a number.</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll notice that the determination of the
size of the array <b>s</b> is done inside <b>init(&nbsp;)</b>, and not as part
of an inline definition of <b>s</b>. That is, you <i>cannot</i> say as part of
the class definition (outside of any methods):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>int size =
Integer.parseInt(getParameter(&quot;size&quot;));</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Ticker[] s = new
Ticker[size];</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can compile this, but you’ll get a
strange “null-pointer exception” at run-time. It works fine if you move the <b>getParameter(&nbsp;)
</b>initialization inside of <b>init(&nbsp;)</b>. The </span><span
lang=EN-US>applet framework performs the necessary startup to grab the
parameters before entering <b>init(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>In addition, this code is set up to be
either an </span><span
lang=EN-US>applet or an </span><span
lang=EN-US>application. When it’s an application the <b>size</b> argument is
extracted from the command line (or a default value is provided).</span></p>

<p class=MsoNormal><span lang=EN-US>Once the size of the array is established,
new <b>Ticker</b> objects are created; as part of the <b>Ticker</b> constructor
the button and text field for each <b>Ticker </b>is added to the applet.</span></p>

<p class=MsoNormal><span lang=EN-US>Pressing the <b>start</b> button means
looping through the entire array of <b>Ticker</b>s and calling <b>start(&nbsp;)</b>
for each one. Remember, <b>start(&nbsp;)</b> performs necessary thread
initialization and then calls <b>run(&nbsp;)</b> for that thread.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>ToggleL </b>listener simply inverts
the flag in <b>Ticker</b> and when the associated thread next takes note it can
react accordingly.</span></p>

<p class=MsoNormal><span lang=EN-US>One value of this example is that it allows
you to easily create large sets of independent subtasks and to monitor their
behavior. In this case, you’ll see that as the number of subtasks gets larger,
your machine will probably show more divergence in the displayed numbers
because of the way that the threads are served.</span></p>

<p class=MsoNormal><span lang=EN-US>You can also experiment to discover how
important the <b>sleep(100)</b> is inside <b>Ticker.run(&nbsp;)</b>. If you
remove the <b>sleep(&nbsp;)</b>, things will work fine until you press a toggle
button. Then that particular thread has a false <b>runFlag</b> and the <b>run(&nbsp;)</b>
is just tied up in a tight infinite loop, which appears difficult to break
during multithreading, so the responsiveness and speed of the program really
bogs down.</span></p>

<h3><a name="_Toc481064851"></a><a name="_Toc375545477"><span lang=EN-US>Daemon
threads</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A “daemon” thread is one that is supposed
to provide a general service in the background as long as the program is
running, but is not part of the essence of the program. Thus, when all of the
non-daemon threads complete, the program is terminated. Conversely, if there
are any non-daemon threads still running, the program doesn’t terminate. (There
is, for instance, a thread that runs <b>main(&nbsp;)</b>.)</span></p>

<p class=MsoNormal><span lang=EN-US>You can find out if a thread is a daemon by
calling </span><span lang=EN-US><b>isDaemon(&nbsp;)</b>, and you can turn the
“daemonhood” of a thread on and off with </span><span lang=EN-US><b>setDaemon(&nbsp;)</b>. If a thread is a daemon, then any threads
it creates will automatically be daemons.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example demonstrates daemon
threads:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:Daemons.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Daemonic behavior.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Daemon extends
Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static final
int SIZE = 10;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Thread[] t =
new Thread[SIZE];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Daemon() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    setDaemon(true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; SIZE; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t[i] = new
DaemonSpawn(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; SIZE; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;t[&quot; +
i + &quot;].isDaemon() = &quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        + t[i].isDaemon());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      yield();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class DaemonSpawn
extends Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public DaemonSpawn(int
i) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;DaemonSpawn
&quot; + i + &quot; started&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      yield();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Daemons {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thread d = new
Daemon();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;d.isDaemon()
= &quot; + d.isDaemon());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Allow the daemon
threads to</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // finish their
startup processes:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Press any key&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.in.read();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Daemon</b> thread sets its daemon
flag to “true” and then spawns a bunch of other threads to show that they are
also daemons. Then it goes into an infinite loop that calls <b>yield(&nbsp;)</b>
to give up control to the other processes. In an earlier version of this
program, the infinite loops would increment <b>int </b>counters, but this
seemed to bring the whole program to a stop. Using <b>yield(&nbsp;)</b> makes
the program quite peppy.</span></p>

<p class=MsoNormal><span lang=EN-US>There’s nothing to keep the program from
terminating once <b>main(&nbsp;)</b> finishes its job, since there are nothing
but daemon threads running. So that you can see the results of starting all the
daemon threads, <b>System.in</b> is set up to read so the program waits for a
keypress before terminating. Without this you see only some of the results from
the creation of the daemon threads. (Try replacing the <b>read(&nbsp;)</b> code
with <b>sleep(&nbsp;)</b> calls of various lengths to see this behavior.)</span></p>

<h2><a name="_Toc481064852"></a><a name="_Toc375545478"><span lang=EN-US>Sharing
limited resources</span></a></h2>

<p class=MsoNormal><span
lang=EN-US>You can think of a single-threaded program as one lonely entity
moving around through your problem space and doing one thing at a time. Because
there’s only one entity, you never have to think about the problem of two
entities trying to use the same resource at the same time, like two people
trying to park in the same space, walk through a door at the same time, or even
talk at the same time.</span></p>

<p class=MsoNormal><span lang=EN-US>With multithreading, things aren’t lonely
anymore, but you now have the possibility of two or more threads trying to use
the same limited resource at once. Colliding over a resource must be prevented
or else you’ll have two threads trying to access the same bank account at the
same time, print to the same printer, or adjust the same valve, etc.</span></p>

<h3><a name="_Toc481064853"></a><a name="_Toc375545479"><span lang=EN-US>Improperly
accessing resources</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Consider a variation on the counters that
have been used so far in this chapter. In the following example, each thread
contains two counters that are incremented and displayed inside <b>run(&nbsp;)</b>.
In addition, there’s another thread of class <b>Watcher</b> that is watching
the counters to see if they’re always equivalent. This seems like a needless
activity, since looking at the code it appears obvious that the counters will
always be the same. But that’s where the surprise comes in. Here’s the first
version of the program:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:Sharing1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Problems with
resource sharing while threading.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Sharing1 width=350 height=500&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;param name=size
value=&quot;12&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;param
name=watchers value=&quot;15&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Sharing1
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static int
accessCount = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static
JTextField aCount = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JTextField(&quot;0&quot;, 7);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
incrementAccess() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    accessCount++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
aCount.setText(Integer.toString(accessCount));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start = new
JButton(&quot;Start&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    watcher = new
JButton(&quot;Watch&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean
isApplet = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int
numCounters = 12;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int
numWatchers = 15;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private TwoCounter[]
s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class TwoCounter
extends Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private boolean
started = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private JTextField </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t1 = new
JTextField(5),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t2 = new
JTextField(5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private JLabel l = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
JLabel(&quot;count1 == count2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int count1 =
0, count2 = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Add the display
components as a panel:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public TwoCounter()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JPanel p = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      p.add(t1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      p.add(t2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      p.add(l);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
getContentPane().add(p);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void start()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(!started) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        started = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        super.start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while (true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t1.setText(Integer.toString(count1++));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t2.setText(Integer.toString(count2++));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          sleep(500);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        } catch(InterruptedException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
synchTest() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Sharing1.incrementAccess();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(count1 !=
count2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
l.setText(&quot;Unsynched&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Watcher extends
Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Watcher() {
start(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; s.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
s[i].synchTest();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          sleep(500);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class StartL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; s.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        s[i].start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class WatcherL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; numWatchers; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new Watcher();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(isApplet) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String counters =
getParameter(&quot;size&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(counters !=
null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        numCounters =
Integer.parseInt(counters);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String watchers =
getParameter(&quot;watchers&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(watchers !=
null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        numWatchers =
Integer.parseInt(watchers);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s = new
TwoCounter[numCounters];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; s.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s[i] = new
TwoCounter();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel p = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
start.addActionListener(new StartL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(start);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
watcher.addActionListener(new WatcherL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(watcher);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(new
JLabel(&quot;Access Count&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(aCount);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(p);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Sharing1 applet =
new Sharing1();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // This isn't an
applet, so set the flag and</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // produce the
parameter values from args:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.isApplet =
false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.numCounters =
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (args.length == 0
? 12 :</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Integer.parseInt(args[0]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.numWatchers =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (args.length &lt;
2 ? 15 :</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Integer.parseInt(args[1]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(applet,
350, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      applet.numCounters
* 50);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>As before, each counter contains its own
display components: two text fields and a label that initially indicates that
the counts are equivalent. These components are added to the content pane of
the outer class object in the <b>TwoCounter</b> constructor. </span></p>

<p class=MsoNormal><span lang=EN-US>Because a <b>TwoCounter </b>thread is
started via a keypress by the user, it’s possible that <b>start(&nbsp;)</b>
could be called more than once. It’s illegal for <b>Thread.start(&nbsp;)</b> to
be called more than once for a thread (an exception is thrown). You can see the
machinery to prevent this in the <b>started </b>flag and the overridden <b>start(&nbsp;)</b>
method.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>run(&nbsp;)</b>, <b>count1</b> and <b>count2</b>
are incremented and displayed in a manner that would seem to keep them
identical. Then </span><span lang=EN-US><b>sleep(&nbsp;)</b> is called; without
this call the program balks because it becomes hard for the CPU to swap tasks.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>synchTest(&nbsp;)</b> method
performs the apparently useless activity of checking to see if <b>count1</b> is
equivalent to <b>count2</b>; if they are not equivalent it sets the label to
“Unsynched” to indicate this. But first, it calls a static member of the class <b>Sharing1</b>
that increments and displays an access counter to show how many times this
check has occurred successfully. (The reason for this will become apparent in
later variations of this example.)</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Watcher</b> class is a thread whose
job is to call <b>synchTest(&nbsp;)</b> for all of the <b>TwoCounter</b>
objects that are active. It does this by stepping through the array that’s kept
in the <b>Sharing1</b> object. You can think of the <b>Watcher</b> as constantly
peeking over the shoulders of the <b>TwoCounter</b> objects.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Sharing1</span></b><span lang=EN-US>
contains an array of <b>TwoCounter</b> objects that it initializes in <b>init(&nbsp;)</b>
and starts as threads when you press the “start” button. Later, when you press
the “Watch” button, one or more watchers are created and freed upon the
unsuspecting <b>TwoCounter </b>threads.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that to run this as an applet in a
browser, your applet tag will need to contain the lines:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;param name=size
value=&quot;20&quot;&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&lt;param
name=watchers value=&quot;1&quot;&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can experiment by changing the width,
height, and parameters to suit your tastes. By changing the <b>size</b> and <b>watchers</b>
you’ll change the behavior of the program. This program is set up to run as a
stand-alone application by pulling the arguments from the command line (or
providing defaults).</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s the surprising part. In <b>TwoCounter.run(&nbsp;)</b>,
the infinite loop is just repeatedly passing over the adjacent lines:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>t1.setText(Integer.toString(count1++));</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>t2.setText(Integer.toString(count2++));</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>(as well as sleeping, but that’s not important
here). When you run the program, however, you’ll discover that <b>count1</b>
and <b>count2</b> will be observed (by the <b>Watcher</b>s) to be unequal at
times! This is because of the nature of threads—they can be </span><span lang=EN-US>suspended at any time. So at times, the suspension occurs <i>between</i>
the execution of the above two lines, and the <b>Watcher</b> thread happens to
come along and perform the comparison at just this moment, thus finding the two
counters to be different.</span></p>

<p class=MsoNormal><span lang=EN-US>This example shows a fundamental problem
with using threads. You never know when a thread might be run. Imagine sitting
at a table with a fork, about to spear the last piece of food on your plate and
as your fork reaches for it, the food suddenly vanishes (because your thread was
suspended and another thread came in and stole the food). That’s the problem
that you’re dealing with.</span></p>

<p class=MsoNormal><span lang=EN-US>Sometimes you don’t care if a resource is
being accessed at the same time you’re trying to use it (the food is on some
other plate). But for multithreading to work, you need some way to prevent two
threads from accessing the same resource, at least during critical periods.</span></p>

<p class=MsoNormal><span lang=EN-US>Preventing this kind of collision is simply
a matter of putting a lock on a resource when one thread is using it. The first
thread that accesses a resource locks it, and then the other threads cannot
access that resource until it is unlocked, at which time another thread locks
and uses it, etc. If the front seat of the car is the limited resource, the
child who shouts “Dibs!” asserts the lock.</span></p>

<h3><a name="_Toc481064854"></a><a name="_Toc375545480"><span lang=EN-US>How
Java shares resources</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Java has built-in support to prevent
collisions over one kind of resource: the memory in an object. Since you
typically make the data elements of a class </span><span
lang=EN-US><b>private</b> and access that memory only through methods, you can
prevent collisions by making a particular method </span><span
lang=EN-US><b>synchronized</b>. Only one thread at a time can call a <b>synchronized</b>
method for a particular object (although that thread can call more than one of
the object’s synchronized methods). Here are simple <b>synchronized</b>
methods:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>synchronized void f() {
/* ... */ }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>synchronized void
g(){ /* ... */ }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Each object contains a single </span><span lang=EN-US>lock (also called a </span><span
lang=EN-US><i>monitor</i>) that is automatically part of the object (you don’t
have to write any special code). When you call any <b>synchronized</b> method,
that object is locked and no other <b>synchronized</b> method of that object
can be called until the first one finishes and releases the lock. In the
example above, if <b>f(&nbsp;)</b> is called for an object, <b>g(&nbsp;)</b>
cannot be called for the same object until <b>f(&nbsp;)</b> is completed and
releases the lock. Thus, there’s a single lock that’s shared by all the <b>synchronized</b>
methods of a particular object, and this lock prevents common memory from being
written by more than one method at a time (i.e., more than one thread at a
time).</span></p>

<p class=MsoNormal><span lang=EN-US>There’s also a single lock per class (as
part of the </span><span lang=EN-US><b>Class</b> object for the class), so that
</span><span lang=EN-US><b>synchronized</b> <b>static</b> methods can lock each
other out from simultaneous access of <b>static </b>data on a class-wide basis.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that if you want to guard some other
resource from simultaneous access by multiple threads, you can do so by forcing
access to that resource through <b>synchronized</b> methods.</span></p>

<h4><span lang=EN-US>Synchronizing the counters</span></h4>

<p class=MsoNormal><span lang=EN-US>Armed with this new keyword it appears that
the solution is at hand: we’ll simply use the <b>synchronized</b> keyword for
the methods in <b>TwoCounter</b>. The following example is the same as the
previous one, with the addition of the new keyword:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:Sharing2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using the
synchronized keyword to prevent</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// multiple access to a
particular resource.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Sharing2 width=350 height=500&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;param name=size
value=&quot;12&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;param
name=watchers value=&quot;15&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Sharing2
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  TwoCounter[] s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static int
accessCount = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static
JTextField aCount = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JTextField(&quot;0&quot;, 7);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
incrementAccess() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    accessCount++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
aCount.setText(Integer.toString(accessCount));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start = new
JButton(&quot;Start&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    watcher = new
JButton(&quot;Watch&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean
isApplet = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int
numCounters = 12;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int
numWatchers = 15;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class TwoCounter
extends Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private boolean
started = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private JTextField </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t1 = new
JTextField(5),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      t2 = new
JTextField(5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private JLabel l = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
JLabel(&quot;count1 == count2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int count1 =
0, count2 = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public TwoCounter()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      JPanel p = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      p.add(t1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      p.add(t2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      p.add(l);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
getContentPane().add(p);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void start()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(!started) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        started = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        super.start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public synchronized
void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while (true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        t1.setText(Integer.toString(count1++));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t2.setText(Integer.toString(count2++));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          sleep(500);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public synchronized
void synchTest() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Sharing2.incrementAccess();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(count1 !=
count2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
l.setText(&quot;Unsynched&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Watcher extends
Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Watcher() {
start(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; s.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
s[i].synchTest();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          sleep(500);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class StartL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void actionPerformed(ActionEvent
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; s.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        s[i].start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class WatcherL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; numWatchers; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new Watcher();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(isApplet) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String counters =
getParameter(&quot;size&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(counters !=
null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        numCounters =
Integer.parseInt(counters);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String watchers =
getParameter(&quot;watchers&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(watchers !=
null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        numWatchers =
Integer.parseInt(watchers);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s = new
TwoCounter[numCounters];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; s.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s[i] = new
TwoCounter();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel p = new JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
start.addActionListener(new StartL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(start);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
watcher.addActionListener(new WatcherL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(watcher);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(new
Label(&quot;Access Count&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(aCount);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(p);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Sharing2 applet =
new Sharing2();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // This isn't an
applet, so set the flag and</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // produce the
parameter values from args:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.isApplet =
false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.numCounters =
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (args.length == 0
? 12 :</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Integer.parseInt(args[0]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.numWatchers =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (args.length &lt;
2 ? 15 :</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Integer.parseInt(args[1]));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(applet,
350, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      applet.numCounters
* 50);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll notice that <i>both</i> <b>run(&nbsp;)</b>
and <b>synchTest(&nbsp;)</b> are <b>synchronized</b>. If you synchronize only
one of the methods, then the other is free to ignore the object lock and can be
called with impunity. This is an important point: Every method that accesses a
critical shared resource must be <b>synchronized</b> or it won’t work right.</span></p>

<p class=MsoNormal><span lang=EN-US>Now a new issue arises. The <b>Watcher</b>
can never get a peek at what’s going on because the entire <b>run(&nbsp;)</b>
method has been <b>synchronized</b>, and since <b>run(&nbsp;)</b> is always
running for each object the lock is always tied up and <b>synchTest(&nbsp;)</b>
can never be called. You can see this because the <b>accessCount</b> never
changes.</span></p>

<p class=MsoNormal><span lang=EN-US>What we’d like for this example is a way to
isolate only <i>part</i> of the code inside <b>run(&nbsp;)</b>. The section of
code you want to isolate this way is called a </span><span lang=EN-US><i>critical section</i> and you use the <b>synchronized</b> keyword
in a different way to set up a critical section. Java supports critical
sections with the </span><span
lang=EN-US><i>synchronized block;</i> this time <b>synchronized </b>is used to
specify the object whose lock is being used to synchronize the enclosed code:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>synchronized(syncObject)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // This code can be
accessed </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // by only one thread
at a time</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Before the synchronized block can be
entered, the lock must be acquired on <b>syncObject</b>. If some other thread
already has this lock, then the block cannot be entered until the lock is given
up.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Sharing2</b> example can be modified
by removing the <b>synchronized</b> keyword from the entire <b>run(&nbsp;)</b>
method and instead putting a <b>synchronized</b> block around the two critical
lines. But what object should be used as the lock? The one that is already
respected by <b>synchTest(&nbsp;)</b>, which is the current object (<b>this</b>)!
So the modified <b>run(&nbsp;)</b> looks like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while (true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      synchronized(this)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t1.setText(Integer.toString(count1++));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t2.setText(Integer.toString(count2++));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sleep(500);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This is the only change that must be made
to <b>Sharing2.java</b>, and you’ll see that while the two counters are never
out of synch (according to when the <b>Watcher</b> is allowed to look at them),
there is still adequate access provided to the <b>Watcher</b> during the execution
of <b>run(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, all synchronization depends on
programmer diligence: every piece of code that can access a shared resource
must be wrapped in an appropriate synchronized block. </span></p>

<h4><span lang=EN-US>Synchronized efficiency</span></h4>

<p class=MsoNormal><span
lang=EN-US>Since having two methods write to the same piece of data <i>never </i>sounds
like a particularly good idea, it might seem to make sense for all methods to
be automatically <b>synchronized</b> and eliminate the <b>synchronized</b> keyword
altogether. (Of course, the example with a <b>synchronized run(&nbsp;)</b>
shows that this wouldn’t work either.) But it turns out that acquiring a lock
is not a cheap operation—it multiplies the cost of a method call (that is,
entering and exiting from the method, not executing the body of the method) by
a minimum of four times, and could be much more depending on your
implementation. So if you know that a particular method will not cause
contention problems it is expedient to leave off the <b>synchronized</b> keyword.
On the other hand, leaving off the <b>synchronized</b> keyword because you
think it is a performance bottleneck, and hoping that there aren’t any
collisions is an invitation to disaster.</span></p>

<h3><a name="_Toc481064855"><span lang=EN-US>JavaBeans revisited</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Now that you understand synchronization,
you can take another look at </span><span lang=EN-US>JavaBeans. Whenever you create a Bean, you must assume that it will
run in a multithreaded environment. This means that: </span></p>

<p class=Numbered><span lang=EN-US>Whenever possible, all the <b>public</b>
methods of a Bean should be <b>synchronized</b>. Of course, this incurs the <b>synchronized</b>
run-time overhead. If that’s a problem, methods that will not cause problems in
critical sections can be left un-<b>synchronized</b>, but keep in mind that
this is not always obvious. Methods that qualify tend to be small (such as <b>getCircleSize(&nbsp;)</b>
in the following example) and/or “atomic,” that is, the method call executes in
such a short amount of code that the object cannot be changed during execution.
Making such methods un-<b>synchronized </b>might not have a significant effect
on the execution speed of your program. You might as well make all <b>public</b>
methods of a Bean <b>synchronized</b> and remove the <b>synchronized</b>
keyword only when you know for sure that it’s necessary and that it makes a
difference.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>99.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>When firing a multicast event to a bunch of listeners interested in
that event, you must assume that listeners might be added or removed while moving
through the list.</span></p>

<p class=MsoNormal><span lang=EN-US>The first point is fairly easy to deal
with, but the second point requires a little more thought. Consider the <b>BangBean.java</b>
example presented in the last chapter. That ducked out of the multithreading
question by ignoring the <b>synchronized</b> keyword (which hadn’t been
introduced yet) and making the event unicast. Here’s that example modified to
work in a multithreaded environment and to use multicasting for events:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:BangBean2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// You should write your
Beans this way so they </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// can run in a
multithreaded environment.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class BangBean2
extends JPanel </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    implements
Serializable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int xm, ym;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int cSize =
20; // Circle size</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private String text =
&quot;Bang!&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int fontSize =
48;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Color tColor =
Color.red;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private ArrayList
actionListeners = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public BangBean2() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    addMouseListener(new
ML());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
addMouseMotionListener(new MM());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
int getCircleSize() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return cSize; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  setCircleSize(int
newSize) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cSize = newSize;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
String getBangText() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return text; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  setBangText(String
newText) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    text = newText;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
int getFontSize() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return fontSize; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  setFontSize(int
newSize) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fontSize = newSize;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
Color getTextColor() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return tColor; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  setTextColor(Color
newColor) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    tColor = newColor;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
paintComponent(Graphics g) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
super.paintComponent(g);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
g.setColor(Color.black);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g.drawOval(xm -
cSize/2, ym - cSize/2, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cSize, cSize);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // This is a multicast
listener, which is</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // more typically used
than the unicast</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // approach taken in
BangBean.java:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
addActionListener(ActionListener l) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
actionListeners.add(l);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
removeActionListener(ActionListener l) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
actionListeners.remove(l);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Notice this isn't
synchronized:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
notifyListeners() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ActionEvent a =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new ActionEvent(BangBean2.this,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
ActionEvent.ACTION_PERFORMED, null);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList lv = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Make a shallow
copy of the List in case </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // someone adds a
listener while we're </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // calling
listeners:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    synchronized(this) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      lv = (ArrayList)actionListeners.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Call all the
listener methods:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; lv.size(); i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
((ActionListener)lv.get(i))</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
.actionPerformed(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class ML extends
MouseAdapter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
mousePressed(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Graphics g =
getGraphics();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
g.setColor(tColor);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      g.setFont(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new Font(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
&quot;TimesRoman&quot;, Font.BOLD, fontSize));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int width = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
g.getFontMetrics().stringWidth(text);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      g.drawString(text,
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        (getSize().width
- width) /2,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
getSize().height/2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      g.dispose();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      notifyListeners();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class MM extends
MouseMotionAdapter {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
mouseMoved(MouseEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      xm = e.getX();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ym = e.getY();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      repaint();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    BangBean2 bb = new
BangBean2();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
bb.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(&quot;ActionEvent&quot; + e);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    bb.addActionListener(new
ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(&quot;BangBean2 action&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
bb.addActionListener(new ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      public void
actionPerformed(ActionEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        System.out.println(&quot;More
action&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(bb, 300,
300);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Adding <b>synchronized</b> to the methods
is an easy change. However, notice in </span><span
lang=EN-US><b>addActionListener(&nbsp;)</b> and </span><span
lang=EN-US><b>removeActionListener(&nbsp;)</b> that the <b>ActionListener</b>s
are now added to and removed from an <b>ArrayList</b>, so you can have as many
as you want.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the method </span><span lang=EN-US><b>notifyListeners(&nbsp;)</b> is <i>not</i> <b>synchronized</b>. It
can be called from more than one thread at a time. It’s also possible for <b>addActionListener(&nbsp;)</b>
or <b>removeActionListener(&nbsp;)</b> to be called in the middle of a call to <b>notifyListeners(&nbsp;)</b>,
which is a problem since it traverses the <b>ArrayList actionListeners</b>. To
alleviate the problem, the <b>ArrayList</b> is cloned inside a <b>synchronized</b>
clause and the clone is traversed (see Appendix A for details of cloning). This
way the original <b>ArrayList</b> can be manipulated without impact on <b>notifyListeners(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>paintComponent</b><b>(&nbsp;)</b>
method is also not </span><span lang=EN-US><b>synchronized</b>. Deciding whether to synchronize overridden
methods is not as clear as when you’re just adding your own methods. In this
example it turns out that <b>paint(&nbsp;)</b> seems to work OK whether it’s <b>synchronized</b>
or not. But the issues you must consider are: </span></p>

<p class=Numbered><span lang=EN-US>Does the method modify the state of
“critical” variables within the object? To discover whether the variables are
“critical” you must determine whether they will be read or set by other threads
in the program. (In this case, the reading or setting is virtually always
accomplished via <b>synchronized</b> methods, so you can just examine those.)
In the case of <b>paint(&nbsp;)</b>, no modification takes place.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>100.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Does the method depend on the state of these “critical” variables?
If a <b>synchronized</b> method modifies a variable that your method uses, then
you might very well want to make your method <b>synchronized</b> as well. Based
on this, you might observe that <b>cSize</b> is changed by <b>synchronized</b>
methods and therefore <b>paint(&nbsp;)</b> should be <b>synchronized</b>. Here,
however, you can ask “What’s the worst thing that will happen if <b>cSize</b>
is changed during a <b>paint(&nbsp;)</b>?” When you see that it’s nothing too
bad, and a transient effect at that, you can decide to leave <b>paint(&nbsp;)</b>
un-<b>synchronized</b> to prevent the extra overhead from the <b>synchronized</b>
method call.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>101.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>A third clue is to notice whether the base-class version of <b>paint(&nbsp;)</b>
is <b>synchronized</b>, which it isn’t. This isn’t an airtight argument, just a
clue. In this case, for example, a field that <i>is</i> changed via <b>synchronized</b>
methods (that is <b>cSize</b>) has been mixed into the <b>paint(&nbsp;)</b> formula
and might have changed the situation. Notice, however, that <b>synchronized</b>
doesn’t inherit—that is, if a method is <b>synchronized</b> in the base class
then it <i>is not</i> automatically <b>synchronized</b> in the derived class
overridden version.</span></p>

<p class=MsoNormal><span lang=EN-US>The test code in <b>TestBangBean2</b> has
been modified from that in the previous chapter to demonstrate the multicast
ability of <b>BangBean2</b> by adding extra listeners.</span></p>

<h2><a name="_Toc481064856"></a><a name="_Toc375545481"><span lang=EN-US>Blocking</span></a><span
lang=EN-US> </span></h2>

<p class=MsoNormal><span lang=EN-US>A thread can be in any one of four states: </span></p>

<p class=Numbered><i><span lang=EN-US>New</span></i><span lang=EN-US>: The
thread object has been created but it hasn’t been started yet so it cannot run.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>102.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><i><span
lang=EN-US>Runnable</span></i><span lang=EN-US>: This means that a thread <i>can</i>
be run when the time-slicing mechanism has CPU cycles available for the thread.
Thus, the thread might or might not be running, but there’s nothing to prevent
it from being run if the scheduler can arrange it; it’s not dead or blocked.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>103.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><i><span
lang=EN-US>Dead</span></i><span lang=EN-US>: The normal way for a thread to die
is by returning from its <b>run(&nbsp;) </b>method. You can also call <b>stop(&nbsp;)</b>,
but this throws an exception that’s a subclass of <b>Error</b> (which means you
aren’t forced to put the call in a <b>try</b> block). Remember that throwing an
exception should be a special event and not part of normal program execution;
thus the use of <b>stop(&nbsp;)</b> is deprecated in Java 2. There’s also a <b>destroy(&nbsp;)</b>
method (which has never been implemented) that you should never call if you can
avoid it since it’s drastic and doesn’t release object locks.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>104.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><i><span
lang=EN-US>Blocked</span></i><span lang=EN-US>: The thread could be run but
there’s something that prevents it. While a thread is in the blocked state the
scheduler will simply skip over it and not give it any CPU time. Until a thread
reenters the runnable state it won’t perform any operations.</span></p>

<h3><a name="_Toc481064857"></a><a name="_Toc375545482"><span lang=EN-US>Becoming
blocked</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The blocked state is the most interesting
one, and is worth further examination. A thread can become blocked for five
reasons: </span></p>

<p class=Numbered><span lang=EN-US>You’ve put the thread to sleep by calling <b>sleep(milliseconds),</b>
in which case it will not be run for the specified time.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>105.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>You’ve suspended the execution of the thread with <b>suspend(&nbsp;)</b>.
It will not become runnable again until the thread gets the <b>resume(&nbsp;)</b>
message (these are deprecated in Java 2, and will be examined further).</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>106.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>You’ve suspended the execution of the thread with <b>wait(&nbsp;)</b>.
It will not become runnable again until the thread gets the <b>notify(&nbsp;)</b>
or <b>notifyAll(&nbsp;)</b> message. (Yes, this looks just like number 2, but
there’s a distinct difference that will be revealed.)</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>107.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>The thread is waiting for some I/O to complete.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>108.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>The thread is trying to call a <b>synchronized </b>method on another
object, and that object’s lock is not available.</span></p>

<p class=MsoNormal><span lang=EN-US>You can also call </span><span lang=EN-US><b>yield(&nbsp;)</b> (a method of the <b>Thread </b>class) to
voluntarily give up the CPU so that other threads can run. However, the same
thing happens if the scheduler decides that your thread has had enough time and
jumps to another thread. That is, nothing prevents the scheduler from moving
your thread and giving time to some other thread. When a thread is blocked,
there’s some reason that it cannot continue running.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example shows all five ways
of becoming blocked. It all exists in a single file called <b>Blocking.java,</b>
but it will be examined here in discrete pieces. (You’ll notice the “Continued”
and “Continuing” tags that allow the code extraction tool to piece everything
together.) </span></p>

<p class=MsoNormal><span lang=EN-US>Because this example demonstrates some
deprecated methods, you <i>will </i>get deprecation messages when it is
compiled.</span></p>

<p class=MsoNormal><span lang=EN-US>First, the basic framework:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:Blocking.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrates the
various ways a thread</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// can be blocked.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Blocking width=350 height=550&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//////////// The basic
framework ///////////</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Blockable extends
Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Peeker peeker;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected JTextField
state = new JTextField(30);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
Blockable(Container c) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.add(state);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    peeker = new
Peeker(this, c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
int read() { return i; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected synchronized
void update() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
state.setText(getClass().getName()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      + &quot; state: i
= &quot; + i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
stopPeeker() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // peeker.stop();
Deprecated in Java 1.2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    peeker.terminate();
// The preferred approach</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Peeker extends
Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Blockable b;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int session;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JTextField
status = new JTextField(30);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean stop =
false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
Peeker(Blockable b, Container c) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.add(status);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this.b = b;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
terminate() { stop = true; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while (!stop) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
status.setText(b.getClass().getName()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        + &quot; Peeker
&quot; + (++session)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        + &quot;; value
= &quot; + b.read());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sleep(100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:Continued</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Blockable </b>class is meant to be a
base class for all the classes in this example that demonstrate blocking. A <b>Blockable</b>
object contains a<b> JText</b><b>Field</b> called <b>state</b> that is used to
display information about the object. The method that displays this information
is <b>update(&nbsp;)</b>. You can see it uses <b>getClass(&nbsp;).getName(&nbsp;)</b>
to produce the name of the class instead of just printing it out; this is
because <b>update(&nbsp;)</b> cannot know the exact name of the class it is
called for, since it will be a class derived from <b>Blockable</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The indicator of change in <b>Blockable</b>
is an <b>int i,</b> which will be incremented by the <b>run(&nbsp;)</b> method
of the derived class.</span></p>

<p class=MsoNormal><span lang=EN-US>There’s a thread of class <b>Peeker</b>
that is started for each <b>Blockable</b> object, and the <b>Peeker</b>’s job
is to watch its associated <b>Blockable</b> object to see changes in <b>i </b>by
calling <b>read(&nbsp;)</b> and reporting them in its <b>status JTextField</b>.
This is important: Note that <b>read(&nbsp;)</b> and <b>update(&nbsp;)</b> are
both <b>synchronized</b>, which means they require that the object lock be
free.</span></p>

<h4><span lang=EN-US>Sleeping</span></h4>

<p class=MsoNormal><span lang=EN-US>The first test in this program is with </span><span lang=EN-US><b>sleep(&nbsp;):</b></span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>///:Continuing</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>///////////// Blocking
via sleep() ///////////</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Sleeper1 extends
Blockable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
Sleeper1(Container c) { super(c); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      update();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sleep(1000);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Sleeper2 extends
Blockable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
Sleeper2(Container c) { super(c); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      change();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sleep(1000);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void change() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      update();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:Continued</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>Sleeper1</b> the entire <b>run(&nbsp;)</b>
method is <b>synchronized</b>. You’ll see that the <b>Peeker</b> associated
with this object will run along merrily <i>until</i> you start the thread, and
then the <b>Peeker</b> stops cold. This is one form of blocking: since <b>Sleeper1.run(&nbsp;)</b>
is <b>synchronized</b>, and once the thread starts it’s always inside <b>run(&nbsp;)</b>,
the method never gives up the object lock and the <b>Peeker</b> is blocked.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Sleeper2</span></b><span lang=EN-US>
provides a solution by making <b>run(&nbsp;)</b> un-<b>synchronized</b>. Only
the <b>change(&nbsp;)</b> method is <b>synchronized</b>, which means that while
<b>run(&nbsp;)</b> is in <b>sleep(&nbsp;)</b>, the <b>Peeker</b> can access the
<b>synchronized</b> method it needs, namely <b>read(&nbsp;)</b>. Here you’ll
see that the <b>Peeker</b> continues running when you start the <b>Sleeper2</b>
thread.</span></p>

<h4><span lang=EN-US>Suspending and resuming</span></h4>

<p class=MsoNormal><span lang=EN-US>The next part of the example introduces the
concept of suspension. The <b>Thread</b> class has a method </span><span lang=EN-US><b>suspend(&nbsp;)</b> to temporarily stop the thread and </span><span lang=EN-US><b>resume(&nbsp;)</b> that restarts it at the point it was halted. <b>resume(&nbsp;)</b>
must be called by some thread outside the suspended one, and in this case
there’s a separate class called <b>Resumer</b> that does just that. Each of the
classes demonstrating suspend/resume has an associated resumer:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>///:Continuing</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>/////////// Blocking via
suspend() ///////////</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class SuspendResume
extends Blockable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
SuspendResume(Container c) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(c);    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new Resumer(this); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class SuspendResume1
extends SuspendResume {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
SuspendResume1(Container c) { super(c);}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      update();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      suspend(); //
Deprecated in Java 1.2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class SuspendResume2
extends SuspendResume {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
SuspendResume2(Container c) { super(c);}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      change();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      suspend(); //
Deprecated in Java 1.2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void change() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      update();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Resumer extends
Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private SuspendResume
sr;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
Resumer(SuspendResume sr) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this.sr = sr;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sleep(1000);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } catch(InterruptedException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      sr.resume(); //
Deprecated in Java 1.2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:Continued</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>SuspendResume1</span></b><span
lang=EN-US> also has a <b>synchronized run(&nbsp;)</b> method. Again, when you
start this thread you’ll see that its associated <b>Peeker</b> gets blocked
waiting for the lock to become available, which never happens. This is fixed as
before in <b>SuspendResume2</b>, which does not <b>synchronize</b> the entire <b>run(&nbsp;)</b>
method but instead uses a separate <b>synchronized</b> <b>change(&nbsp;)</b>
method.</span></p>

<p class=MsoNormal><span lang=EN-US>You should be aware that Java 2 deprecates
the use of <b>suspend(&nbsp;)</b> and <b>resume(&nbsp;)</b>, because <b>suspend(&nbsp;)</b>
holds the object’s lock and is thus </span><span lang=EN-US>deadlock-prone. That is, you can easily get a number of locked
objects waiting on each other, and this will cause your program to freeze.
Although you might see them used in older programs you should not use <b>suspend(&nbsp;)</b>
and <b>resume(&nbsp;)</b>. The proper solution is described later in this
chapter.</span></p>

<h4><span lang=EN-US>Wait and notify</span></h4>

<p class=MsoNormal><span lang=EN-US>In the first two examples, it’s important
to understand that both <b>sleep(&nbsp;)</b> and <b>suspend(&nbsp;)</b> <i>do
not </i>release the lock as they are called. You must be aware of this when working
with locks. On the other hand, the method </span><span lang=EN-US><b>wait(&nbsp;)</b> <i>does</i> release the lock when it is called,
which means that other </span><span
lang=EN-US><b>synchronized</b> methods in the thread object could be called
during a <b>wait(&nbsp;)</b>. In the following two classes, you’ll see that the
<b>run(&nbsp;)</b> method is fully <b>synchronized</b> in both cases, however,
the <b>Peeker</b> still has full access to the <b>synchronized</b> methods
during a <b>wait(&nbsp;)</b>. This is because <b>wait(&nbsp;)</b> releases the
lock on the object as it suspends the method it’s called within.</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll also see that there are two forms of
<b>wait(&nbsp;)</b>. The first takes an argument in milliseconds that has the
same meaning as in <b>sleep(&nbsp;)</b>: pause for this period of time. The
difference is that in <b>wait(&nbsp;)</b>, the object lock is released <i>and</i>
you can come out of the <b>wait(&nbsp;)</b> because of a <b>notify(&nbsp;)</b>
as well as having the clock run out.</span></p>

<p class=MsoNormal><span lang=EN-US>The second form takes no arguments, and
means that the <b>wait(&nbsp;)</b> will continue until a <b>notify(&nbsp;)</b>
comes along and will not automatically terminate after a time.</span></p>

<p class=MsoNormal><span
lang=EN-US>One fairly unique aspect of <b>wait(&nbsp;)</b> and <b>notify(&nbsp;)</b>
is that both methods are part of the base class <b>Object</b> and not part of <b>Thread</b>
as are <b>sleep(&nbsp;)</b>, <b>suspend(&nbsp;)</b>, and <b>resume(&nbsp;)</b>.
Although this seems a bit strange at first—to have something that’s exclusively
for threading as part of the universal base class—it’s essential because they
manipulate the lock that’s also part of every object. As a result, you can put
a <b>wait(&nbsp;)</b> inside any <b>synchronized</b> method, regardless of
whether there’s any threading going on inside that particular class. In fact,
the <i>only</i> place you can call <b>wait(&nbsp;)</b> is within a <b>synchronized</b>
method or block. If you call <b>wait(&nbsp;)</b> or <b>notify(&nbsp;)</b>
within a method that’s not <b>synchronized,</b> the program will compile, but
when you run it you’ll get an </span><span
lang=EN-US><b>IllegalMonitorStateException</b> with the somewhat nonintuitive
message “current thread not owner.” Note that <b>sleep(&nbsp;)</b>, <b>suspend(&nbsp;),</b>
and <b>resume(&nbsp;)</b> can all be called within non-<b>synchronized</b>
methods since they don’t manipulate the lock.</span></p>

<p class=MsoNormal><span lang=EN-US>You can call <b>wait(&nbsp;)</b> or <b>notify(&nbsp;)</b>
only for your own lock. Again, you can compile code that tries to use the wrong
lock, but it will produce the same <b>IllegalMonitorStateException</b> message
as before. You can’t fool with someone else’s lock, but you can ask another
object to perform an operation that manipulates its own lock. So one approach
is to create a <b>synchronized</b> method that calls <b>notify(&nbsp;)</b> for
its own object. However, in <b>Notifier</b> you’ll see the <b>notify(&nbsp;)</b>
call inside a <b>synchronized</b> block:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>synchronized(wn2) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  wn2.notify();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>where <b>wn2</b> is the object of type <b>WaitNotify2</b>.
This method, which is not part of <b>WaitNotify2</b>, acquires the lock on the <b>wn2</b>
object, at which point it’s legal for it to call <b>notify(&nbsp;)</b> for <b>wn2</b>
and you won’t get the <b>IllegalMonitorStateException</b>.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>///:Continuing</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>/////////// Blocking via
wait() ///////////</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class WaitNotify1
extends Blockable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
WaitNotify1(Container c) { super(c); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      update();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        wait(1000);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } catch(InterruptedException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class WaitNotify2
extends Blockable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
WaitNotify2(Container c) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new Notifier(this); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      update();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        wait();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Notifier extends
Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private WaitNotify2
wn2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
Notifier(WaitNotify2 wn2) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this.wn2 = wn2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sleep(2000);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      synchronized(wn2)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        wn2.notify();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}  ///:Continued</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>wait(&nbsp;)</span></b><span lang=EN-US>
is typically used when you’ve gotten to the point where you’re waiting for some
other condition, under the control of forces outside your thread, to change and
you don’t want to idly wait by inside the thread. So <b>wait(&nbsp;)</b> allows
you to put the thread to sleep while waiting for the world to change, and only
when a <b>notify(&nbsp;)</b> or <b>notifyAll(&nbsp;) </b>occurs does the thread
wake up and check for changes. Thus, it provides a way to synchronize between
threads.</span></p>

<h4><a name="_Ref368085592"><span lang=EN-US>Blocking on I/O</span></a></h4>

<p class=MsoNormal><span lang=EN-US>If a stream is waiting for some I/O
activity, it will automatically block. In the following portion of the example,
the two classes work with generic </span><span
lang=EN-US><b>Reader</b> and </span><span lang=EN-US><b>Writer</b> objects, but
in the test framework a </span><span
lang=EN-US>piped stream will be set up to allow the two threads to safely pass
data to each other (which is the purpose of piped streams).</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Sender</b> puts data into the <b>Writer</b>
and sleeps for a random amount of time. However, <b>Receiver</b> has no <b>sleep(&nbsp;)</b>,
<b>suspend(&nbsp;)</b>, or <b>wait(&nbsp;)</b>. But when it does a <b>read(&nbsp;)</b>
it automatically blocks when there is no more data.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>///:Continuing</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Sender extends
Blockable { // send</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Writer out;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Sender(Container
c, Writer out) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this.out = out; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(char c = 'A';
c &lt;= 'z'; c++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          out.write(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
state.setText(&quot;Sender sent: &quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            + (char)c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
sleep((int)(3000 * Math.random()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }
catch(IOException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.err.println(&quot;IO problem&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Receiver extends
Blockable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Reader in;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
Receiver(Container c, Reader in) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this.in = in; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        i++; // Show
peeker it's alive</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // Blocks until
characters are there:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
state.setText(&quot;Receiver read: &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          +
(char)in.read());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(IOException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;IO problem&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:Continued</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Both classes also put information into
their <b>state</b> fields and change <b>i </b>so the <b>Peeker</b> can see that
the thread is running.</span></p>

<h4><span lang=EN-US>Testing</span></h4>

<p class=MsoNormal><span lang=EN-US>The main applet class is surprisingly
simple because most of the work has been put into the <b>Blockable</b>
framework. Basically, an array of <b>Blockable</b> objects is created, and
since each one is a thread, they perform their own activities when you press
the “start” button. There’s also a button and <b>actionPerformed(&nbsp;)</b>
clause to stop all of the <b>Peeker</b> objects, which provides a demonstration
of the alternative to the deprecated (in Java 2) <b>stop(&nbsp;)</b> method of <b>Thread</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>To set up a connection between the <b>Sender</b>
and <b>Receiver</b> objects, a <b>PipedWriter</b> and <b>PipedReader</b> are
created. Note that the <b>PipedReader</b> <b>in </b>must be connected to the <b>PipedWriter</b>
<b>out </b>via a constructor argument. After that, anything that’s placed in <b>out</b>
can later be extracted from <b>in</b>, as if it passed through a pipe (hence
the name). The <b>in</b> and <b>out</b> objects are then passed to the <b>Receiver</b>
and <b>Sender</b> constructors, respectively, which treat them as <b>Reader</b>
and <b>Writer </b>objects of any type (that is, they are upcast).</span></p>

<p class=MsoNormal><span lang=EN-US>The array of <b>Blockable</b> references <b>b</b>
is not initialized at its point of definition because the piped streams cannot
be set up before that definition takes place (the need for the <b>try</b> block
prevents this). </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>///:Continuing</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>/////////// Testing
Everything ///////////</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Blocking
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start = new
JButton(&quot;Start&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    stopPeekers = new
JButton(&quot;Stop Peekers&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean
started = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Blockable[] b;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private PipedWriter
out;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private PipedReader in;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class StartL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(!started) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        started = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; b.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          b[i].start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class StopPeekersL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Demonstration
of the preferred </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // alternative to
Thread.stop():</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; b.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
b[i].stopPeeker();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     out = new
PipedWriter();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      in = new
PipedReader(out);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(IOException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;PipedReader problem&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b = new Blockable[]
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Sleeper1(cp),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Sleeper2(cp),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
SuspendResume1(cp),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
SuspendResume2(cp),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
WaitNotify1(cp),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
WaitNotify2(cp),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Sender(cp,
out),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Receiver(cp,
in)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
start.addActionListener(new StartL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(start);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
stopPeekers.addActionListener(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
StopPeekersL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(stopPeekers);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Blocking(), 350, 550);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>init(&nbsp;)</b>, notice the loop
that moves through the entire array and adds the <b>state</b> and <b>peeker.status</b>
text fields to the page.</span></p>

<p class=MsoNormal><span lang=EN-US>When the <b>Blockable </b>threads are
initially created, each one automatically creates and starts its own <b>Peeker</b>.
So you’ll see the <b>Peeker</b>s running before the <b>Blockable</b> threads
are started. This is important, as some of the <b>Peeker</b>s will get blocked
and stop when the <b>Blockable</b> threads start, and it’s essential to see
this to understand that particular aspect of blocking.</span></p>

<h3><a name="_Toc481064858"></a><a name="_Toc375545483"><span lang=EN-US>Deadlock</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Because threads can become blocked <i>and</i>
because objects can have <b>synchronized</b> methods that prevent threads from
accessing that object until the synchronization lock is released, it’s possible
for one thread to get stuck waiting for another thread, which in turn waits for
another thread, etc., until the chain leads back to a thread waiting on the
first one. You get a continuous loop of threads waiting on each other and no
one can move. This is called <i>deadlock</i>. The claim is that it doesn’t
happen that often, but when it happens to you it’s frustrating to debug. </span></p>

<p class=MsoNormal><span lang=EN-US>There is no language support to help
prevent deadlock; it’s up to you to avoid it by careful design. These are not
comforting words to the person who’s trying to debug a deadlocking program.</span></p>

<h4><span lang=EN-US>The deprecation of <b>stop(&nbsp;)</b>, <b>suspend(&nbsp;)</b>,
<br>
<b>resume(&nbsp;),</b> and <b>destroy(&nbsp;)</b> in Java 2</span></h4>

<p class=MsoNormal><span lang=EN-US>One change that has been made in Java 2 to reduce the possibility of
deadlock is the deprecation of <b>Thread</b>’s <b>stop(&nbsp;)</b>, <b>suspend(&nbsp;)</b>,
<b>resume(&nbsp;)</b>, and <b>destroy(&nbsp;)</b> methods. </span></p>

<p class=MsoNormal><span lang=EN-US>The reason that the <b>stop(&nbsp;)</b> method is deprecated is
because it doesn’t release the locks that the thread has acquired, and if the
objects are in an inconsistent state (“damaged”) other threads can view and
modify them in that state. The resulting problems can be subtle and difficult
to detect. Instead of using <b>stop(&nbsp;)</b>, you should follow the example
in <b>Blocking.java</b> and use a flag to tell the thread when to terminate
itself by exiting its <b>run(&nbsp;)</b> method.</span></p>

<p class=MsoNormal><span lang=EN-US>There are times when a thread blocks—such
as when it is waiting for input—and it cannot poll a flag as it does in <b>Blocking.java</b>.
In these cases, you still shouldn’t use <b>stop(&nbsp;)</b>, but instead you
can use the </span><span lang=EN-US><b>interrupt(&nbsp;)</b> method in </span><span lang=EN-US><b>Thread</b> to break out of the blocked code:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:Interrupt.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The alternative
approach to using </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// stop() when a thread
is blocked.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Interrupt width=200 height=100&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Blocked extends
Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public synchronized
void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      wait(); // Blocks</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;Exiting
run()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Interrupt
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    interrupt = new
JButton(&quot;Interrupt&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Blocked
blocked = new Blocked();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(interrupt);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
interrupt.addActionListener(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        public </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.out.println(&quot;Button pressed&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          if(blocked ==
null) return;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Thread remove
= blocked;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          blocked =
null; // to release it</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
remove.interrupt();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    blocked.start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Interrupt(), 200, 100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>wait(&nbsp;)</b> inside <b>Blocked.run(&nbsp;)</b>
produces the blocked thread. When you press the button, the <b>blocked</b>
reference is set to <b>null</b> so the garbage collector will clean it up, and
then the object’s <b>interrupt(&nbsp;)</b> method is called. The first time you
press the button you’ll see that the thread quits, but after that there’s no
thread to kill so you just see that the button has been pressed.</span></p>

<p class=MsoNormal><span
lang=EN-US>The <b>suspend(&nbsp;)</b> and <b>resume(&nbsp;)</b> methods turn
out to be inherently deadlock-prone. When you call <b>suspend(&nbsp;)</b>, the
target thread stops but it still holds any locks that it has acquired up to
that point. So no other thread can access the locked resources until the thread
is resumed. Any thread that wants to resume the target thread and also tries to
use any of the locked resources produces deadlock. You should not use <b>suspend(&nbsp;)</b>
and <b>resume(&nbsp;)</b>, but instead put a flag in your <b>Thread</b> class
to indicate whether the thread should be active or suspended. If the flag
indicates that the thread is suspended,</span><span lang=EN-US> the thread goes into a wait using <b>wait(&nbsp;)</b>. When the flag
indicates that the thread should be resumed the thread is restarted with <b>notify(&nbsp;)</b>.
An example can be produced by modifying <b>Counter2.java</b>. Although the
effect is similar, you’ll notice that the code organization is quite different—</span><span lang=EN-US>anonymous inner classes are used for all of the listeners and the <b>Thread</b>
is an inner class, which makes programming slightly more convenient since it
eliminates some of the extra bookkeeping necessary in <b>Counter2.java</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:Suspend.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The alternative
approach to using suspend()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// and resume(), which
are deprecated in Java 2.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Suspend width=300 height=100&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Suspend
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JTextField t =
new JTextField(10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JButton </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    suspend = new
JButton(&quot;Suspend&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    resume = new
JButton(&quot;Resume&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Suspendable ss
= new Suspendable();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Suspendable
extends Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private int count =
0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    private boolean
suspended = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public Suspendable()
{ start(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
fauxSuspend() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      suspended = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public synchronized
void fauxResume() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      suspended = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      notify();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while (true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          sleep(100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
synchronized(this) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
while(suspended)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              wait();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        } catch(InterruptedException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t.setText(Integer.toString(count++));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  } </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(t);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    suspend.addActionListener(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        public </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
ss.fauxSuspend();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(suspend);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
resume.addActionListener(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ActionListener() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        public </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
ss.fauxResume();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      });</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(resume);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Suspend(), 300, 100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The flag <b>suspended</b> inside <b>Suspendable</b>
is used to turn suspension on and off. To suspend, the flag is set to <b>true</b>
by calling <b>fauxSuspend(&nbsp;) </b>and this is detected inside <b>run(&nbsp;)</b>.
The <b>wait(&nbsp;)</b>, as described earlier in this chapter, must be <b>synchronized</b>
so that it has the object lock. In <b>fauxResume(&nbsp;)</b>, the <b>suspended</b>
flag is set to <b>false</b> and <b>notify(&nbsp;)</b> is called—since this
wakes up <b>wait(&nbsp;)</b> inside a <b>synchronized</b> clause the <b>fauxResume(&nbsp;)</b>
method must also be <b>synchronized</b> so that it acquires the lock before
calling <b>notify(&nbsp;)</b> (thus the lock is available for the <b>wait(&nbsp;)</b>
to wake up with). If you follow the style shown in this program you can avoid
using <b>suspend(&nbsp;)</b> and <b>resume(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The </span><span lang=EN-US><b>destroy(&nbsp;)</b> method of <b>Thread </b>has never been
implemented; it’s like a <b>suspend(&nbsp;)</b> that cannot resume, so it has
the same deadlock issues as <b>suspend(&nbsp;)</b>. However, this is not a
deprecated method and it might be implemented in a future version of Java
(after 2) for special situations in which the risk of a deadlock is acceptable.</span></p>

<p class=MsoNormal><span lang=EN-US>You might wonder why these methods, now
deprecated, were included in Java in the first place. It seems an admission of
a rather significant mistake to simply remove them outright (and pokes yet
another hole in the arguments for Java’s exceptional design and infallibility
touted by Sun marketing people). The heartening part about the change is that
it clearly indicates that the technical people and not the marketing people are
running the show—they discovered a problem and they are fixing it. I find this
much more promising and hopeful than leaving the problem in because “fixing it
would admit an error.” It means that Java will continue to improve, even if it
means a little discomfort on the part of Java programmers. I’d rather deal with
the discomfort than watch the language stagnate.</span></p>

<h2><a name="_Toc481064859"></a><a name="_Toc375545484"><span lang=EN-US>Priorities</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The </span><span lang=EN-US><i>priority</i> of a thread tells the scheduler how important this
thread is. If there are a number of threads blocked and waiting to be run, the
scheduler will run the one with the highest priority first. However, this
doesn’t mean that threads with lower priority don’t get run (that is, you can’t
get deadlocked because of priorities). Lower priority threads just tend to run
less often.</span></p>

<p class=MsoNormal><span lang=EN-US>Although priorities are interesting to know
about and to play with, in practice you almost never need to set priorities
yourself. So feel free to skip the rest of this section if priorities aren’t
interesting to you.</span></p>

<h3><a name="_Toc481064860"><span lang=EN-US>Reading and setting priorities</span></a></h3>

<p class=MsoNormal><span lang=EN-US>You can read the priority of a thread with </span><span lang=EN-US><b>getPriority(&nbsp;) </b>and change it with </span><span lang=EN-US><b>setPriority(&nbsp;)</b>. The form of the prior “counter” examples
can be used to show the effect of changing the priorities. In this applet
you’ll see that the counters slow down as the associated threads have their
priorities lowered:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:Counter5.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Adjusting the
priorities of threads.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Counter5 width=450 height=600&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Ticker2 extends
Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JButton</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    b = new
JButton(&quot;Toggle&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    incPriority = new
JButton(&quot;up&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    decPriority = new
JButton(&quot;down&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JTextField</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t = new
JTextField(10),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pr = new
JTextField(3); // Display priority</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int count = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean
runFlag = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
Ticker2(Container c) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
b.addActionListener(new ToggleL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
incPriority.addActionListener(new UpL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    decPriority.addActionListener(new
DownL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel p = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(t);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(pr);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(incPriority);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(decPriority);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.add(p);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class ToggleL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      runFlag =
!runFlag;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class UpL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int newPriority =
getPriority() + 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(newPriority
&gt; Thread.MAX_PRIORITY)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        newPriority =
Thread.MAX_PRIORITY;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
setPriority(newPriority);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class DownL implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int newPriority =
getPriority() - 1;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(newPriority
&lt; Thread.MIN_PRIORITY)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        newPriority =
Thread.MIN_PRIORITY;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
setPriority(newPriority);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while (true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(runFlag) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t.setText(Integer.toString(count++));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        pr.setText(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
Integer.toString(getPriority()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      yield();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Counter5
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private JButton</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start = new
JButton(&quot;Start&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    upMax = new
JButton(&quot;Inc Max Priority&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    downMax = new
JButton(&quot;Dec Max Priority&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean
started = false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static final
int SIZE = 10;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Ticker2[] s =
new Ticker2[SIZE];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private<b> </b>JTextField
mp = new<b> </b>JTextField(3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; s.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s[i] = new
Ticker2(cp);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new JLabel(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;MAX_PRIORITY
= &quot; + Thread.MAX_PRIORITY));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JLabel(&quot;MIN_PRIORITY = &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
Thread.MIN_PRIORITY));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JLabel(&quot;Group Max Priority = &quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(mp);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(start);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(upMax);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(downMax);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
start.addActionListener(new StartL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
upMax.addActionListener(new UpMaxL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
downMax.addActionListener(new DownMaxL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    showMaxPriority();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Recursively
display parent thread groups:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ThreadGroup parent =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s[0].getThreadGroup().getParent();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(parent !=
null) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cp.add(new Label(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Parent
threadgroup max priority = &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        +
parent.getMaxPriority()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      parent =
parent.getParent();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
showMaxPriority() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    mp.setText(Integer.toString(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
s[0].getThreadGroup().getMaxPriority()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class StartL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(!started) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        started = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        for(int i = 0; i
&lt; s.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          s[i].start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class UpMaxL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int maxp =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
s[0].getThreadGroup().getMaxPriority();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(++maxp &gt;
Thread.MAX_PRIORITY)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        maxp = Thread.MAX_PRIORITY;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
s[0].getThreadGroup().setMaxPriority(maxp);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      showMaxPriority();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class DownMaxL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int maxp =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
s[0].getThreadGroup().getMaxPriority();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(--maxp &lt;
Thread.MIN_PRIORITY)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        maxp =
Thread.MIN_PRIORITY;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
s[0].getThreadGroup().setMaxPriority(maxp);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      showMaxPriority();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Counter5(), 450, 600);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>Ticker2</span></b><span lang=EN-US>
follows the form established earlier in this chapter, but there’s an extra<b>
JText</b><b>Field</b> for displaying the priority of the thread and two more
buttons for incrementing and decrementing the priority.</span></p>

<p class=MsoNormal><span lang=EN-US>Also notice the use of <b>yield(&nbsp;)</b>,
which voluntarily hands control back to the scheduler. Without this the
multithreading mechanism still works, but you’ll notice it runs slowly (try
removing the call to <b>yield(&nbsp;) </b>to see this). You could also call <b>sleep(&nbsp;)</b>,
but then the rate of counting would be controlled by the <b>sleep(&nbsp;)</b>
duration instead of the priority.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>init(&nbsp;)</b> in <b>Counter5</b>
creates an array of ten <b>Ticker2</b>s; their buttons and fields are placed on
the form by the <b>Ticker2</b> constructor. <b>Counter5 </b>adds buttons to
start everything up as well as increment and decrement the maximum priority of
the thread group. In addition, there are labels that display the maximum and
minimum priorities possible for a thread and a<b> JText</b><b>Field</b> to show
the thread group’s maximum priority. (The next section will describe thread groups.)
Finally, the priorities of the parent thread groups are also displayed as
labels.</span></p>

<p class=MsoNormal><span lang=EN-US>When you press an “up” or “down” button,
that <b>Ticker2</b>’s priority is fetched and incremented or decremented
accordingly. </span></p>

<p class=MsoNormal><span lang=EN-US>When you run this program, you’ll notice
several things. First of all, the thread group’s </span><span lang=EN-US>default priority is five. Even if you decrement the maximum priority
below five before starting the threads (or before creating the threads, which
requires a code change), each thread will have a default priority of five.</span></p>

<p class=MsoNormal><span lang=EN-US>The simple test is to take one counter and
decrement its priority to one, and observe that it counts much slower. But now
try to increment it again. You can get it back up to the thread group’s
priority, but no higher. Now decrement the thread group’s priority a couple of
times. The thread priorities are unchanged, but if you try to modify them
either up or down you’ll see that they’ll automatically pop to the priority of
the thread group. Also, new threads will still be given a default priority,
even if that’s higher than the group priority. (Thus the group priority is not
a way to prevent new threads from having higher priorities than existing ones.)</span></p>

<p class=MsoNormal><span lang=EN-US>Finally, try to increment the group maximum
priority. It can’t be done. You can only reduce thread group maximum
priorities, not increase them.</span></p>

<h3><a name="_Toc481064861"></a><a name="_Toc375545485"><span lang=EN-US>Thread
groups</span></a></h3>

<p class=MsoNormal><span lang=EN-US>All threads belong to a </span><span lang=EN-US>thread group. This can be either the default thread group or a group
you explicitly specify when you create the thread. At creation, the thread is
bound to a group and cannot change to a different group. Each application has
at least one thread that belongs to the system thread group. If you create more
threads without specifying a group, they will also belong to the system thread
group. </span></p>

<p class=MsoNormal><span lang=EN-US>Thread groups must also belong to other
thread groups. The thread group that a new one belongs to must be specified in
the constructor. If you create a thread group without specifying a thread group
for it to belong to, it will be placed under the system thread group. Thus, all
thread groups in your application will ultimately have the system thread group
as the parent.</span></p>

<p class=MsoNormal><span lang=EN-US>The reason for the existence of thread
groups is hard to determine from the literature, which tends to be confusing on
this subject. It’s often cited as “security reasons.” According to Arnold &amp;
Gosling,</span><a href="#_ftn71" name="_ftnref71" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[71]</span></span></span></span></a><span lang=EN-US>
“Threads within a thread group can modify the other threads in the group,
including any farther down the hierarchy. A thread cannot modify threads
outside of its own group or contained groups.” It’s hard to know what “modify”
is supposed to mean here. The following example shows a thread in a “leaf”
subgroup modifying the priorities of all the threads in its tree of thread
groups as well as calling a method for all the threads in its tree.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:TestAccess.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// How threads can
access other threads</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// in a parent thread
group.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class TestAccess
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ThreadGroup </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      x = new
ThreadGroup(&quot;x&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      y = new
ThreadGroup(x, &quot;y&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      z = new
ThreadGroup(y, &quot;z&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thread</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      one = new
TestThread1(x, &quot;one&quot;),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      two = new
TestThread2(z, &quot;two&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class TestThread1
extends Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
TestThread1(ThreadGroup g, String name) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(g, name);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void f() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    i++; // modify this
thread</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(getName() + &quot; f()&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class TestThread2
extends TestThread1 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
TestThread2(ThreadGroup g, String name) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(g, name);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ThreadGroup g =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
getThreadGroup().getParent().getParent();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g.list();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thread[] gAll = new
Thread[g.activeCount()];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g.enumerate(gAll);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; gAll.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
gAll[i].setPriority(Thread.MIN_PRIORITY);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
((TestThread1)gAll[i]).f();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g.list();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>main(&nbsp;)</b>, several <b>ThreadGroup</b>s
are created, leafing off from each other: <b>x</b> has no argument but its name
(a <b>String</b>), so it is automatically placed in the “system” thread group,
while <b>y</b> is under <b>x</b> and <b>z</b> is under <b>y</b>. Note that
initialization happens in textual order so this code is legal.</span></p>

<p class=MsoNormal><span lang=EN-US>Two threads are created and placed in
different thread groups. <b>TestThread1</b> doesn’t have a <b>run(&nbsp;)</b>
method but it does have an <b>f(&nbsp;)</b> that modifies the thread and prints
something so you can see it was called. <b>TestThread2</b> is a subclass of <b>TestThread1</b>
and its <b>run(&nbsp;)</b> is fairly elaborate. It first gets the thread group
of the current thread, then moves up the heritage tree by two levels using <b>getParent(&nbsp;)</b>.
(This is contrived since I purposely place the <b>TestThread2</b> object two
levels down in the hierarchy.) At this point, an array of references to <b>Thread</b>s
is created using the method <b>activeCount(&nbsp;)</b> to ask how many threads are
in this thread group and all the child thread groups. The <b>enumerate(&nbsp;)</b>
method places references to all of these threads in the array <b>gAll</b>, then
I simply move through the entire array calling the <b>f(&nbsp;)</b> method for
each thread, as well as modifying the priority. Thus, a thread in a “leaf”
thread group modifies threads in parent thread groups.</span></p>

<p class=MsoNormal><span lang=EN-US>The debugging method <b>list(&nbsp;)</b>
prints all the information about a thread group to standard output and is
helpful when investigating thread group behavior. Here’s the output of the
program:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>java.lang.ThreadGroup[name=x,maxpri=10]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thread[one,5,x]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
java.lang.ThreadGroup[name=y,maxpri=10]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
java.lang.ThreadGroup[name=z,maxpri=10]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
Thread[two,5,z]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>one f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>two f()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>java.lang.ThreadGroup[name=x,maxpri=10]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thread[one,1,x]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
java.lang.ThreadGroup[name=y,maxpri=10]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
java.lang.ThreadGroup[name=z,maxpri=10]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>           
Thread[two,1,z]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Not only does <b>list(&nbsp;)</b> print the
class name of <b>ThreadGroup</b> or <b>Thread</b>, but it also prints the
thread group name and its maximum priority. For threads, the thread name is
printed, followed by the thread priority and the group that it belongs to. Note
that <b>list(&nbsp;)</b> indents the threads and thread groups to indicate that
they are children of the unindented thread group.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that <b>f(&nbsp;)</b> is called
by the <b>TestThread2</b> <b>run(&nbsp;)</b> method, so it’s obvious that all
threads in a group are vulnerable. However, you can access only the threads
that branch off from your own <b>system</b> thread group tree, and perhaps this
is what is meant by “safety.” You cannot access anyone else’s system thread
group tree.</span></p>

<h4><span lang=EN-US>Controlling thread groups</span></h4>

<p class=MsoNormal><span lang=EN-US>Putting aside the safety issue, one thing
thread groups seem to be useful for is control: you can perform certain
operations on an entire thread group with a single command. The following
example demonstrates this, and the restrictions on priorities within thread
groups. The commented numbers in parentheses provide a reference to compare to
the output.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c14:ThreadGroup1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// How thread groups
control priorities</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// of the threads inside
them.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ThreadGroup1 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Get the system
thread &amp; print its Info:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ThreadGroup sys = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Thread.currentThread().getThreadGroup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sys.list(); // (1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Reduce the system
thread group priority:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
sys.setMaxPriority(Thread.MAX_PRIORITY - 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Increase the main
thread priority:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thread curr =
Thread.currentThread();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
curr.setPriority(curr.getPriority() + 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sys.list(); // (2)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Attempt to set a
new group to the max:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ThreadGroup g1 = new
ThreadGroup(&quot;g1&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
g1.setMaxPriority(Thread.MAX_PRIORITY);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Attempt to set a
new thread to the max:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thread t = new
Thread(g1, &quot;A&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
t.setPriority(Thread.MAX_PRIORITY);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g1.list(); // (3)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Reduce g1's max
priority, then attempt</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // to increase it:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
g1.setMaxPriority(Thread.MAX_PRIORITY - 2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
g1.setMaxPriority(Thread.MAX_PRIORITY);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g1.list(); // (4)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Attempt to set a
new thread to the max:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t = new Thread(g1,
&quot;B&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
t.setPriority(Thread.MAX_PRIORITY);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g1.list(); // (5)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Lower the max
priority below the default</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // thread priority:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
g1.setMaxPriority(Thread.MIN_PRIORITY + 2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Look at a new
thread's priority before</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // and after changing
it:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t = new Thread(g1,
&quot;C&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g1.list(); // (6)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
t.setPriority(t.getPriority() -1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g1.list(); // (7)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Make g2 a child
Threadgroup of g1 and</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // try to increase
its priority:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ThreadGroup g2 = new
ThreadGroup(g1, &quot;g2&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g2.list(); // (8)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
g2.setMaxPriority(Thread.MAX_PRIORITY);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g2.list(); // (9)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Add a bunch of
new threads to g2:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for (int i = 0; i
&lt; 5; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Thread(g2,
Integer.toString(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Show information
about all threadgroups</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // and threads:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sys.list(); // (10)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Starting all threads:&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thread[] all = new
Thread[sys.activeCount()];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sys.enumerate(all);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; all.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(!all[i].isAlive())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        all[i].start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Suspends &amp;
Stops all threads in </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // this group and
its subgroups:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;All threads started&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sys.suspend(); //
Deprecated in Java 2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Never gets
here...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;All threads suspended&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sys.stop(); // Deprecated
in Java 2</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;All threads stopped&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output that follows has been edited to
allow it to fit on the page (the <b>java.lang.</b> has been removed) and to add
numbers to correspond to the commented numbers in the listing above.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(1)
ThreadGroup[name=system,maxpri=10]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Thread[main,5,system]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(2)
ThreadGroup[name=system,maxpri=9]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Thread[main,6,system]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(3)
ThreadGroup[name=g1,maxpri=9]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[A,9,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(4)
ThreadGroup[name=g1,maxpri=8]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[A,9,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(5)
ThreadGroup[name=g1,maxpri=8]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[A,9,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[B,8,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(6)
ThreadGroup[name=g1,maxpri=3]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[A,9,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[B,8,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[C,6,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(7)
ThreadGroup[name=g1,maxpri=3]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[A,9,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[B,8,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[C,3,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(8)
ThreadGroup[name=g2,maxpri=3]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(9)
ThreadGroup[name=g2,maxpri=3]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(10)ThreadGroup[name=system,maxpri=9]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Thread[main,6,system]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
ThreadGroup[name=g1,maxpri=3]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        Thread[A,9,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        Thread[B,8,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        Thread[C,3,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        ThreadGroup[name=g2,maxpri=3]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Thread[0,6,g2]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Thread[1,6,g2]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Thread[2,6,g2]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Thread[3,6,g2]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Thread[4,6,g2]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Starting all threads:</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>All threads
started</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>All programs have at least one thread
running, and the first action in <b>main(&nbsp;)</b> is to call the <b>static</b>
method of <b>Thread</b> called <b>currentThread(&nbsp;)</b>. From this thread,
the thread group is produced and <b>list(&nbsp;)</b> is called for the result.
The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(1)
ThreadGroup[name=system,maxpri=10]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>     
Thread[main,5,system]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the name of the main
thread group is <b>system</b>, and the name of the main thread is <b>main</b>,
and it belongs to the <b>system</b> thread group.</span></p>

<p class=MsoNormal><span lang=EN-US>The second exercise shows that the <b>system</b>
group’s maximum priority can be reduced and the <b>main</b> thread can have its
priority increased:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(2)
ThreadGroup[name=system,maxpri=9]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>     
Thread[main,6,system]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The third exercise creates a new thread
group, <b>g1</b>, which automatically belongs to the <b>system</b> thread group
since it isn’t otherwise specified. A new thread <b>A </b>is placed in <b>g1</b>.
After attempting to set this group’s maximum priority to the highest level and <b>A</b>’s
priority to the highest level, the result is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(3)
ThreadGroup[name=g1,maxpri=9]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>     
Thread[A,9,g1]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Thus, it’s not possible to change the
thread group’s maximum priority to be higher than its parent thread group.</span></p>

<p class=MsoNormal><span lang=EN-US>The fourth exercise reduces <b>g1</b>’s
maximum priority by two and then tries to increase it up to <b>Thread.MAX_PRIORITY</b>.
The result is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(4)
ThreadGroup[name=g1,maxpri=8]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>     
Thread[A,9,g1]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the increase in maximum
priority didn’t work. You can only decrease a thread group’s maximum priority,
not increase it. Also, notice that thread <b>A</b>’s priority didn’t change,
and now it is higher than the thread group’s maximum priority. Changing a
thread group’s maximum priority doesn’t affect existing threads.</span></p>

<p class=MsoNormal><span lang=EN-US>The fifth exercise attempts to set a new
thread to maximum priority:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(5)
ThreadGroup[name=g1,maxpri=8]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[A,9,g1]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>     
Thread[B,8,g1]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The new thread cannot be changed to
anything higher than the maximum thread group priority.</span></p>

<p class=MsoNormal><span lang=EN-US>The default thread priority for this
program is six; that’s the priority a new thread will be created at and where
it will stay if you don’t manipulate the priority. Exercise 6 lowers the
maximum thread group priority below the default thread priority to see what
happens when you create a new thread under this condition:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(6)
ThreadGroup[name=g1,maxpri=3]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[A,9,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[B,8,g1]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>     
Thread[C,6,g1]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Even though the maximum priority of the
thread group is three, the new thread is still created using the default
priority of six. Thus, maximum thread group priority does not affect default
priority. (In fact, there appears to be no way to set the default priority for
new threads.)</span></p>

<p class=MsoNormal><span lang=EN-US>After changing the priority, attempting to
decrement it by one, the result is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(7)
ThreadGroup[name=g1,maxpri=3]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[A,9,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[B,8,g1]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>     
Thread[C,3,g1]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Only when you attempt to change the
priority is the thread group’s maximum priority enforced.</span></p>

<p class=MsoNormal><span lang=EN-US>A similar experiment is performed in (8)
and (9), in which a new thread group <b>g2 </b>is created as a child of <b>g1</b>
and its maximum priority is changed. You can see that it’s impossible for <b>g2</b>’s
maximum to go higher than <b>g1</b>’s:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(8)
ThreadGroup[name=g2,maxpri=3]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>(9) ThreadGroup[name=g2,maxpri=3]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Also notice that <b>g2</b> is automatically
set to the thread group maximum priority of <b>g1</b> as <b>g2</b> is created.</span></p>

<p class=MsoNormal><span lang=EN-US>After all of these experiments, the entire
system of thread groups and threads is printed:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(10)ThreadGroup[name=system,maxpri=9]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread[main,6,system]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
ThreadGroup[name=g1,maxpri=3]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        Thread[A,9,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        Thread[B,8,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        Thread[C,3,g1]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
ThreadGroup[name=g2,maxpri=3]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Thread[0,6,g2]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Thread[1,6,g2]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Thread[2,6,g2]</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          Thread[3,6,g2]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>         
Thread[4,6,g2]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>So because of the rules of thread groups, a
child group must always have a maximum priority that’s less than or equal to
its parent’s maximum priority.</span></p>

<p class=MsoNormal><span lang=EN-US>The last part of this program demonstrates
methods for an entire group of threads. First the program moves through the
entire tree of threads and starts each one that hasn’t been started. For drama,
the <b>system</b> group is then suspended and finally stopped. (Although it’s
interesting to see that <b>suspend(&nbsp;)</b> and <b>stop(&nbsp;)</b> work on entire
thread groups, you should keep in mind that these methods are deprecated in
Java 2.) But when you suspend the <b>system</b> group you also suspend the <b>main</b>
thread and the whole program shuts down, so it never gets to the point where
the threads are stopped. Actually, if you do stop the <b>main</b> thread it
throws a <b>ThreadDeath</b> exception, so this is not a typical thing to do.
Since <b>ThreadGroup</b> is inherited from <b>Object,</b> which contains the <b>wait(&nbsp;)</b>
method, you can also choose to suspend the program for any number of seconds by
calling <b>wait(seconds * 1000)</b>. This must acquire the lock inside a
synchronized block, of course.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>ThreadGroup</b> class also has <b>suspend(&nbsp;)</b>
and <b>resume(&nbsp;)</b> methods so you can stop and start an entire thread
group and all of its threads and subgroups with a single command. (Again, <b>suspend(&nbsp;)</b>
and <b>resume(&nbsp;)</b> are deprecated in Java 2.)</span></p>

<p class=MsoNormal><span lang=EN-US>Thread groups can seem a bit mysterious at
first, but keep in mind that you probably won’t be using them directly very
often.</span></p>

<h2><a name="_Toc481064862"></a><a name="_Toc375545486"><b><span lang=EN-US>Runnable</span></b><span
lang=EN-US> revisited</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Earlier in this chapter, I suggested that
you think carefully before making an applet or main <b>Frame</b> as an
implementation of </span><span lang=EN-US><b>Runnable</b>. Of course, if you must inherit from a class <i>and</i>
you want to add threading behavior to the class, <b>Runnable</b> is the correct
solution. The final example in this chapter exploits this by making a <b>Runnable</b>
<b>JPanel</b> class that paints different colors on itself. This application is
set up to take values from the command line to determine how big the grid of
colors is and how long to <b>sleep(&nbsp;)</b> between color changes. By
playing with these values you’ll discover some interesting and possibly
inexplicable features of threads:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:ColorBoxes.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using the Runnable
interface.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=ColorBoxes width=500 height=400&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;param name=grid
value=&quot;12&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;param name=pause
value=&quot;50&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class CBox extends
JPanel implements Runnable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Thread t;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int pause;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static final
Color[] colors = { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Color.black,
Color.blue, Color.cyan, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Color.darkGray,
Color.gray, Color.green,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Color.lightGray,
Color.magenta, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Color.orange,
Color.pink, Color.red, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Color.white,
Color.yellow </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Color cColor =
newColor();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static final
Color newColor() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return colors[</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
(int)(Math.random() * colors.length)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
paintComponent(Graphics  g) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super.paintComponent(g);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g.setColor(cColor);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Dimension s =
getSize();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g.fillRect(0, 0,
s.width, s.height);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public CBox(int pause)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this.pause = pause;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t = new
Thread(this);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t.start(); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cColor =
newColor();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      repaint();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        t.sleep(pause);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ColorBoxes
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean
isApplet = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int grid = 12;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int pause =
50;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Get parameters
from Web page:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if (isApplet) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String gsize =
getParameter(&quot;grid&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(gsize != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        grid =
Integer.parseInt(gsize);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String pse = getParameter(&quot;pause&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(pse != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        pause =
Integer.parseInt(pse);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
GridLayout(grid, grid));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for (int i = 0; i
&lt; grid * grid; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cp.add(new
CBox(pause));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ColorBoxes applet =
new ColorBoxes();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.isApplet =
false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &gt;
0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      applet.grid =
Integer.parseInt(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &gt;
1) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      applet.pause =
Integer.parseInt(args[1]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(applet,
500, 400);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>ColorBoxes</span></b><span lang=EN-US>
is the usual applet/application with an <b>init(&nbsp;) </b>that sets up the
GUI. This sets up the </span><span lang=EN-US><b>GridLayout</b> so that it has <b>grid</b>
cells in each dimension. Then it adds the appropriate number of <b>CBox</b>
objects to fill the grid, passing the <b>pause</b> value to each one. In <b>main(&nbsp;)</b>
you can see how <b>pause</b> and <b>grid</b> have default values that can be
changed if you pass in command-line arguments, or by using applet parameters.</span></p>

<p class=MsoNormal><b><span lang=EN-US>CBox </span></b><span lang=EN-US>is
where all the work takes place. This is inherited from </span><span
lang=EN-US><b>JPanel</b> and it implements the <b>Runnable</b> interface so
each <b>JPanel</b> can also be a <b>Thread</b>. Remember that when you
implement <b>Runnable</b>, you don’t make a <b>Thread</b> object, just a class
that has a <b>run(&nbsp;)</b> method. Thus, you must explicitly create a <b>Thread</b>
object and hand the <b>Runnable</b> object to the constructor, then call <b>start(&nbsp;)</b>
(this happens in the constructor). In <b>CBox</b> this thread is called <b>t</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Notice the array <b>colors</b>, which is an
enumeration of all the colors in class <b>Color</b>. This is used in <b>newColor(&nbsp;)</b>
to produce a randomly selected color. The current cell color is <b>cColor</b>.</span></p>

<p class=MsoNormal><b><span lang=EN-US>paintComponent</span></b><b><span
lang=EN-US>(&nbsp;)</span></b><span lang=EN-US> is quite simple—it just sets
the color to <b>cColor</b> and fills the entire <b>JPanel</b> with that color.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>run(&nbsp;)</b>, you see the infinite
loop that sets the <b>cColor</b> to a new random color and then calls <b>repaint(&nbsp;)</b>
to show it. Then the thread goes to <b>sleep(&nbsp;)</b> for the amount of time
specified on the command line.</span></p>

<p class=MsoNormal><span lang=EN-US>Precisely because this design is flexible
and threading is tied to each <b>JPanel</b> element, you can experiment by
making as many threads as you want. (In reality, there is a restriction imposed
by the number of threads your JVM can comfortably handle.)</span></p>

<p class=MsoNormal><span lang=EN-US>This program also makes an interesting
benchmark, since it can show dramatic performance differences between one JVM
threading implementation and another.</span></p>

<h3><a name="_Toc481064863"></a><a name="_Toc375545487"><span lang=EN-US>Too
many threads</span></a></h3>

<p class=MsoNormal><span lang=EN-US>At some point, you’ll find that <b>ColorBoxes</b>
bogs down. On my machine, this occurred somewhere after a 10 x 10 grid. Why
does this happen? You’re naturally suspicious that Swing might have something
to do with it, so here’s an example that tests that premise by making fewer
threads. The following code is reorganized so that an <b>ArrayList</b> <b>implements
Runnable</b> and that <b>ArrayList</b> holds a number of color blocks and
randomly chooses ones to update. Then a number of these <b>ArrayList</b>
objects are created, depending roughly on the grid dimension you choose. As a
result, you have far fewer threads than color blocks, so if there’s a speedup
we’ll know it was because there were too many threads in the previous example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c14:ColorBoxes2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Balancing thread use.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=ColorBoxes2 width=600 height=500&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;param name=grid
value=&quot;12&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;param name=pause
value=&quot;50&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class CBox2 extends
JPanel {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static final
Color[] colors = { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Color.black,
Color.blue, Color.cyan, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Color.darkGray,
Color.gray, Color.green,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Color.lightGray,
Color.magenta, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Color.orange,
Color.pink, Color.red, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Color.white,
Color.yellow </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Color cColor =
newColor();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static final
Color newColor() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return colors[</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
(int)(Math.random() * colors.length)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void nextColor() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cColor = newColor();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    repaint();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
paintComponent(Graphics g) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
super.paintComponent(g);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g.setColor(cColor);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Dimension s =
getSize();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g.fillRect(0, 0,
s.width, s.height);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class CBoxList </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  extends ArrayList
implements Runnable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Thread t;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int pause;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public CBoxList(int
pause) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this.pause = pause;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t = new
Thread(this);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void go() {
t.start(); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      int i =
(int)(Math.random() * size());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ((CBox2)get(i)).nextColor();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        t.sleep(pause);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object last() {
return get(size() - 1);}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ColorBoxes2
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private boolean
isApplet = true;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int grid = 12;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Shorter default
pause than ColorBoxes:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int pause =
50;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private CBoxList[] v;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Get parameters
from Web page:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if (isApplet) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String gsize =
getParameter(&quot;grid&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(gsize != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        grid =
Integer.parseInt(gsize);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String pse =
getParameter(&quot;pause&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(pse != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        pause =
Integer.parseInt(pse);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new GridLayout(grid,
grid));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    v = new
CBoxList[grid];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; grid; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v[i] = new
CBoxList(pause);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for (int i = 0; i
&lt; grid * grid; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v[i %
grid].add(new CBox2());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      cp.add((CBox2)v[i
% grid].last());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; grid; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v[i].go();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }   </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ColorBoxes2 applet =
new ColorBoxes2();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    applet.isApplet =
false;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &gt;
0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      applet.grid =
Integer.parseInt(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length &gt;
1) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      applet.pause =
Integer.parseInt(args[1]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(applet,
500, 400);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>ColorBoxes2</b> an array of <b>CBoxList</b>
is created and initialized to hold <b>grid</b> <b>CBoxList</b>s, each of which
knows how long to sleep. An equal number of <b>CBox2</b> objects is then added
to each <b>CBoxList</b>, and each list is told to <b>go(&nbsp;)</b>, which
starts its thread.</span></p>

<p class=MsoNormal><b><span lang=EN-US>CBox2</span></b><span lang=EN-US> is
similar to <b>CBox</b>: it paints itself with a randomly chosen color. But
that’s <i>all</i> a <b>CBox2</b> does. All of the threading has been moved into
<b>CBoxList</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>CBoxList</b> could also have
inherited <b>Thread</b> and had a member object of type <b>ArrayList</b>. That
design has the advantage that the <b>add(&nbsp;)</b> and <b>get(&nbsp;)</b>
methods could then be given specific argument and return value types instead of
generic <b>Object</b>s. (Their names could also be changed to something
shorter.) However, the design used here seemed at first glance to require less
code. In addition, it automatically retains all the other behaviors of an <b>ArrayList</b>.
With all the casting and parentheses necessary for <b>get(&nbsp;)</b>, this might
not be the case as your body of code grows.</span></p>

<p class=MsoNormal><span lang=EN-US>As before, when you implement <b>Runnable</b>
you don’t get all of the equipment that comes with <b>Thread</b>, so you have
to create a new <b>Thread</b> and hand yourself to its constructor in order to
have something to <b>start(&nbsp;)</b>, as you can see in the <b>CBoxList</b>
constructor and in <b>go(&nbsp;)</b>. The <b>run(&nbsp;)</b> method simply
chooses a random element number within the list and calls <b>nextColor(&nbsp;)</b>
for that element to cause it to choose a new randomly selected color.</span></p>

<p class=MsoNormal><span lang=EN-US>Upon running this program, you see that it
does indeed run faster and respond more quickly (for instance, when you
interrupt it, it stops more quickly), and it doesn’t seem to bog down as much
at higher grid sizes. Thus, a new factor is added into the threading equation:
you must watch to see that you don’t have “too many threads” (whatever that
turns out to mean for your particular program and platform—here, the slowdown
in <b>ColorBoxes</b> appears to be caused by the fact that there’s only one
thread that is responsible for all painting, and it gets bogged down by too
many requests). If you have too many threads, you must try to use techniques
like the one above to “balance” the number of threads in your program. If you
see performance problems in a multithreaded program you now have a number of
issues to examine:</span></p>

<p class=Numbered><span lang=EN-US>Do you have enough calls to <b>sleep(&nbsp;)</b>,
<b>yield(&nbsp;),</b> and/or <b>wait(&nbsp;)</b>?</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>109.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Are calls to <b>sleep(&nbsp;)</b> long enough?</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>110.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Are you running too many threads?</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>111.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Have you tried different platforms and JVMs?</span></p>

<p class=MsoNormal><span lang=EN-US>Issues like this are one reason that
multithreaded programming is often considered an art.</span></p>

<h2><a name="_Toc481064864"></a><a name="_Toc375545489"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>It is vital to learn when to use </span><span lang=EN-US>multithreading and when to avoid it. The main reason to use it is to
manage a number of tasks whose intermingling will make more efficient use of
the computer (including the ability to transparently distribute the tasks
across multiple CPUs) or be more convenient for the user. The classic example
of resource balancing is using the CPU during I/O waits. The classic example of
user convenience is monitoring a “stop” button during long downloads.</span></p>

<p class=MsoNormal><span lang=EN-US>The main drawbacks to multithreading are: </span></p>

<p class=Numbered><span lang=EN-US>Slowdown while waiting for shared resources</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>112.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Additional CPU overhead required to manage threads</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>113.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Unrewarded complexity, such as the silly idea of having a separate
thread to update each element of an array</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>114.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Pathologies including starving, racing, and deadlock</span></p>

<p class=MsoNormal><span lang=EN-US>An additional advantage to threads is that
they substitute “light” execution context switches (of the order of 100
instructions) for “heavy” process context switches (of the order of 1000s of
instructions). Since all threads in a given process share the same memory
space, a light context switch changes only program execution and local
variables. On the other hand, a process change—the heavy context switch—must
exchange the full memory space.</span></p>

<p class=MsoNormal><span lang=EN-US>Threading is like stepping into an entirely
new world and learning a whole new programming language, or at least a new set
of language concepts. With the appearance of thread support in most
microcomputer operating systems, extensions for threads have also been
appearing in programming languages or libraries. In all cases, thread
programming (1) seems mysterious and requires a shift in the way you think
about programming; and (2) looks similar to thread support in other languages,
so when you understand threads, you understand a common tongue. And although
support for threads can make Java seem like a more complicated language, don’t
blame Java. Threads are tricky.</span></p>

<p class=MsoNormal><span lang=EN-US>One of the biggest difficulties with
threads occurs because more than one thread might be sharing a resource—such as
the memory in an object—and you must make sure that multiple threads don’t try
to read and change that resource at the same time. This requires judicious use
of the <b>synchronized</b> keyword, which is a helpful tool but must be
understood thoroughly because it can quietly introduce deadlock situations.</span></p>

<p class=MsoNormal><span lang=EN-US>In addition, there’s a certain art to the
application of threads. Java is designed to allow you to create as many objects
as you need to solve your problem—at least in theory. (Creating millions of
objects for an engineering finite-element analysis, for example, might not be
practical in Java.) However, it seems that there is an upper bound to the
number of threads you’ll want to create, because at some point a large number
of threads seems to become unwieldy. This critical point is not in the many
thousands as it might be with objects, but rather in the low hundreds, sometimes
less than 100. As you often create only a handful of threads to solve a
problem, this is typically not much of a limit, yet in a more general design it
becomes a constraint.</span></p>

<p class=MsoNormal><span lang=EN-US>A significant nonintuitive issue in
threading is that, because of thread scheduling, you can typically make your
applications run <i>faster</i> by inserting calls to <b>sleep(&nbsp;)</b>
inside <b>run(&nbsp;)</b>’s main loop. This definitely makes it feel like an
art, in particular when the longer delays seem to speed up performance. Of
course, the reason this happens is that shorter delays can cause the end-of-<b>sleep(&nbsp;)</b>
scheduler interrupt to happen before the running thread is ready to go to
sleep, forcing the scheduler to stop it and restart it later so it can finish
what it was doing and then go to sleep. It takes extra thought to realize how
messy things can get.</span></p>

<p class=MsoNormal><span lang=EN-US>One thing you might notice missing in this
chapter is an animation example, which is one of the most popular things to do
with applets. However, a complete solution (with sound) to this problem comes
with the Java JDK (available at <i>java.sun.com</i>) in the demo section. In
addition, we can expect better animation support to become part of future
versions of Java, while completely different non-Java, non-programming
solutions to animation for the Web are appearing that will probably be superior
to traditional approaches. For explanations about how Java animation works, see
<i>Core Java 2</i> by Horstmann &amp; Cornell, Prentice-Hall, 1997. For more
advanced discussions of threading, see <i>Concurrent Programming in Java</i> by
Doug Lea, Addison-Wesley, 1997, or <i>Java Threads</i> by Oaks &amp; Wong,
O’Reilly, 1997.</span></p>

<h2><a name="_Toc481064865"></a><a name="_Toc375545490"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Inherit a class from <b>Thread</b> and override
the <b>run(&nbsp;)</b> method. Inside <b>run(&nbsp;)</b>, print a message, and
then call <b>sleep(&nbsp;)</b>. Repeat this three times, then return from <b>run(&nbsp;)</b>.
Put a start-up message in the constructor and override <b>finalize(&nbsp;)</b>
to print a shut-down message. Make a separate thread class that calls <b>System.gc(&nbsp;)</b>
and <b>System.runFinalization(&nbsp;) </b>inside <b>run(&nbsp;)</b>, printing a
message as it does so. Make several thread objects of both types and run them
to see what happens.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>234. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>Sharing2.java</b> to add a <b>synchronized</b>
block inside the <b>run(&nbsp;)</b> method of <b>TwoCounter</b> instead of
synchronizing the entire <b>run(&nbsp;)</b> method.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>235. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create two <b>Thread</b> subclasses, one with a <b>run(&nbsp;)</b>
that starts up, captures the reference of the second <b>Thread</b> object and
then calls <b>wait(&nbsp;)</b>. The other class’ <b>run(&nbsp;)</b> should call
<b>notifyAll(&nbsp;)</b> for the first thread after some number of seconds have
passed, so the first thread can print a message.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>236. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In <b>Counter5.java</b> inside <b>Ticker2</b>,
remove the <b>yield(&nbsp;)</b> and explain the results. Replace the <b>yield(&nbsp;)</b>
with a <b>sleep(&nbsp;)</b> and explain the results.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>237. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In <b>ThreadGroup1.java</b>, replace the call to
<b>sys.suspend(&nbsp;)</b> with a call to <b>wait(&nbsp;)</b> for the thread
group, causing it to wait for two seconds. For this to work correctly you must
acquire the lock for <b>sys </b>inside a <b>synchronized</b> block.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>238. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Change <b>Daemons.java</b> so that <b>main(&nbsp;)</b>
has a <b>sleep(&nbsp;)</b> instead of a <b>readLine(&nbsp;)</b>. Experiment
with different sleep times to see what happens.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>239. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>In Chapter 8, locate the <b>GreenhouseControls.java</b>
example, which consists of three files. In <b>Event.java</b>, the class <b>Event</b>
is based on watching the time. Change <b>Event</b> so that it is a <b>Thread</b>,
and change the rest of the design so that it works with this new <b>Thread</b>-based
<b>Event</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>240. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 7 so that the <b>java.util.Timer</b>
class found in JDK 1.3 is used to run the system.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>241. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Starting with <b>SineWave.java</b> from Chapter
13, create a program (an applet/application using the <b>Console </b>class)
that draws an animated sine wave that appears to scrolls past the viewing
window like an oscilloscope, driving the animation with a <b>Thread</b>. The
speed of the animation should be controlled with a <b>java.swing.JSlider</b>
control.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>242. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 9 so that multiple sine wave
panels are created within the application. The number of sine wave panels
should be controlled by HTML tags or command-line parameters.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>243. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify Exercise 9 so that the <b>java.swing.Timer</b>
class is used to drive the animation. Note the difference between this and <b>java.util.Timer</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection21>

<h1><a name="_Toc481064866"></a><a name="_Toc477690735"></a><a
name="_Toc375545491"></a><a name="Chapter_17"></a><span lang=EN-US>15:
Distributed </span><span lang=EN-US>Computing</span></h1>

<p class=Intro><span lang=EN-US>Historically, programming across multiple
machines has been error-prone, difficult, and complex.</span></p>

<p class=MsoNormal><span lang=EN-US>The programmer had to know many details
about the network and sometimes even the hardware. You usually needed to
understand the various “layers” of the networking protocol, and there were a
lot of different functions in each different networking library concerned with
connecting, packing, and unpacking blocks of information; shipping those blocks
back and forth; and handshaking. It was a daunting task.</span></p>

<p class=MsoNormal><span lang=EN-US>However, the basic idea of distributed
computing is not so difficult, and is abstracted very nicely in the Java
libraries. You want to:</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Get some information from that machine over
there and move it to this machine here, or vice versa. This is accomplished
with basic network programming.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Connect to a database, which may live across a
network. This is accomplished with <i>Java DataBase Connectivity</i> (JDBC),
which is an abstraction away from the messy, platform-specific details of SQL
(the <i>structured query language</i> used for most database transactions).</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Provide services via a Web server. This is
accomplished with Java’s <i>servlets</i> and <i>Java Server Pages</i></span><span
lang=EN-US> (JSPs).</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Execute methods on Java objects that live on
remote machines transparently, as if those objects were resident on local
machines. This is accomplished with Java’s <i>Remote Method Invocation</i></span><span
lang=EN-US> (RMI).</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Use code written in other languages, running on
other architectures. This is accomplished using the <i>Common Object Request
Broker Architecture</i></span><span lang=EN-US> (CORBA), which is directly
supported by Java.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Isolate business logic from connectivity issues,
especially connections with databases including transaction management and
security. This is accomplished using <i>Enterprise JavaBeans </i></span><span
lang=EN-US>(</span><span lang=EN-US>EJBs). EJBs are not actually a distributed
architecture, but the resulting applications are usually used in a networked
client-server system.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Easily, dynamically, add and remove devices from
a network representing a local system. This is accomplished with Java’s Jini.</span></p>

<p class=MsoNormal><span lang=EN-US>Each topic will be given a light
introduction in this chapter. Please note that each subject is voluminous and
by itself the subject of entire books, so this chapter is only meant to
familiarize you with the topics, not make you an expert (however, you can go a
long way with the information presented here on network programming, servlets
and JSPs). </span></p>

<h2><a name="_Toc481064867"><span lang=EN-US>Network programming</span></a></h2>

<p class=MsoNormal><a name="_Toc375545492"></a><span
lang=EN-US>One of Java’s great strengths is painless networking. The Java
network library designers have made it quite similar to reading and writing
files, except that the “file” exists on a remote machine and the remote machine
can decide exactly what it wants to do about the information you’re requesting
or sending. As much as possible, the underlying details of networking have been
abstracted away and taken care of within the JVM and local machine installation
of Java. The programming model you use is that of a file; in fact, you actually
wrap the network connection (a “socket”) with stream objects, so you end up
using the same method calls as you do with all other streams. In addition,
Java’s built-in multithreading is exceptionally handy when dealing with another
networking issue: handling multiple connections at once.</span></p>

<p class=MsoNormal><span lang=EN-US>This section introduces Java’s networking
support using easy-to-understand examples.</span></p>

<h3><a name="_Toc481064868"><span lang=EN-US>Identifying a machine</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Of course, in order to tell one machine
from another and to make sure that you are connected with a particular machine,
there must be some way of uniquely </span><span
lang=EN-US>identifying machines on a network. Early networks were satisfied to
provide unique names for machines within the local network. However, Java works
within the Internet, which requires a way to uniquely identify a machine from
all the others <i>in the world</i>. This is accomplished with the </span><span lang=EN-US>IP (Internet Protocol) address which can exist in two forms:</span></p>

<p class=Numbered><span lang=EN-US>The familiar </span><span lang=EN-US>DNS (<i>Domain Name System</i>) form. My domain name is <b>bruceeckel.com</b>,
and if I have a computer called <b>Opus</b> in my domain, its domain name would
be <b>Opus.bruceeckel.com</b>. This is exactly the kind of name that you use
when you send email to people, and is often incorporated into a World Wide Web
address.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>115.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Alternatively, you can use the “</span><span lang=EN-US>dotted quad” form, which is four numbers separated by dots, such as <b>123.255.28.120</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>In both cases, the IP address is
represented internally as a 32-bit number</span><a href="#_ftn72"
name="_ftnref72" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[72]</span></span></span></span></a><span
lang=EN-US> (so each of the quad numbers cannot exceed 255), and you can get a
special Java object to represent this number from either of the forms above by
using the <b>static</b> <b>InetAddress.getByName(&nbsp;)</b> method that’s in <b>java.net</b>.
The result is an object of type <b>InetAddress</b> that you can use to build a
“socket,” as you will see later.</span></p>

<p class=MsoNormal><span lang=EN-US>As a simple example of using <b>InetAddress.getByName(&nbsp;)</b>,
consider what happens if you have a dial-up Internet service provider (ISP).
Each time you dial up, you are assigned a temporary IP address. But while
you’re connected, your IP address has the same validity as any other IP address
on the Internet. If someone connects to your machine using your IP address then
they can connect to a Web server or FTP server that you have running on your machine.
Of course, they need to know your IP address, and since a new one is assigned
each time you dial up, how can you find out what it is?</span></p>

<p class=MsoNormal><span lang=EN-US>The following program uses <b>InetAddress.getByName(&nbsp;)</b>
to produce your IP address. To use it, you must know the name of your computer.
On Windows 95/98, go to “Settings,” “Control Panel,” “Network,” and then select
the “Identification” tab. “Computer name” is the name to put on the command
line.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c15:WhoAmI.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Finds out your
network address when</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// you're connected to
the Internet.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.net.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class WhoAmI {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(args.length != 1)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;Usage:
WhoAmI MachineName&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.exit(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    InetAddress a = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
InetAddress.getByName(args[0]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In this case, the machine is called
“peppy.” So, once I’ve connected to my ISP I run the program:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>java WhoAmI peppy</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>I get back a message like this (of course,
the address is different each time):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>peppy/199.190.87.75</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If I tell my friend this address and I have
a Web server running on my computer, he can connect to it by going to the URL <i>http://199.190.87.75</i>
(only as long as I continue to stay connected during that session). This can
sometimes be a handy way to distribute information to someone else, or to test
out a Web site configuration before posting it to a “real” server.</span></p>

<h4><a name="_Toc375545493"><span lang=EN-US>Servers and clients</span></a></h4>

<p class=MsoNormal><span lang=EN-US>The whole point of a network is to allow
two machines to connect and talk to each other. Once the two machines have
found each other they can have a nice, two-way conversation. But how do they
find each other? It’s like getting lost in an amusement park: one machine has
to stay in one place and listen while the other machine says, “Hey, where are
you?”</span></p>

<p class=MsoNormal><span lang=EN-US>The machine that “stays in one place” is
called the </span><span lang=EN-US><i>server</i>, and the one that seeks is
called the </span><span lang=EN-US><i>client</i>. This distinction is important
only while the client is trying to connect to the server. Once they’ve
connected, it becomes a two-way communication process and it doesn’t matter
anymore that one happened to take the role of server and the other happened to
take the role of the client.</span></p>

<p class=MsoNormal><span lang=EN-US>So the job of the server is to listen for a
connection, and that’s performed by the special server object that you create.
The job of the client is to try to make a connection to a server, and this is
performed by the special client object you create. Once the connection is made,
you’ll see that at both server and client ends, the connection is magically
turned into an I/O stream object, and from then on you can treat the connection
as if you were reading from and writing to a file. Thus, after the connection
is made you will just use the familiar I/O commands from Chapter 11. This is
one of the nice features of Java networking.</span></p>

<h4><span lang=EN-US>Testing programs without a network</span></h4>

<p class=MsoNormal><span
lang=EN-US>For many reasons, you might not have a client machine, a server
machine, and a network available to test your programs. You might be performing
exercises in a classroom situation, or you could be writing programs that
aren’t yet stable enough to put onto the network. The creators of the Internet
Protocol were aware of this issue, and they created a special address called </span><span lang=EN-US><b>localhost</b> to be the </span><span lang=EN-US>“local loopback” IP address for testing without a network. The
generic way to produce this address in Java is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>InetAddress addr =
InetAddress.getByName(null);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you hand <b>getByName(&nbsp;)</b> a <b>null</b>,
it defaults to using the <b>localhost</b>. The <b>InetAddress</b> is what you
use to refer to the particular machine, and you must produce this before you
can go any further. You can’t manipulate the contents of an <b>InetAddress </b>(but
you can print them out, as you’ll see in the next example). The only way you
can create an <b>InetAddress</b> is through one of that class’s overloaded <b>static</b>
member methods <b>getByName(&nbsp;)</b> (which is what you’ll usually use), <b>getAllByName(&nbsp;)</b>,
or <b>getLocalHost(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>You can also produce the local loopback
address by handing it the string <b>localhost</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>InetAddress.getByName(&quot;localhost&quot;);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>(assuming “localhost” is configured in your
machine’s “hosts” table), or by using its dotted quad form to name the reserved
IP number for the loopback:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>InetAddress.getByName(&quot;127.0.0.1&quot;);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>All three forms produce the same result.</span></p>

<h4><a name="_Toc375545494"><span lang=EN-US>Port: a unique place <br>
within the machine</span></a></h4>

<p class=MsoNormal><span lang=EN-US>An IP address isn’t enough to identify a
unique server, since many servers can exist on one machine. Each IP machine
also contains <i>ports</i>, and when you’re setting up a client or a server you
must choose a </span><span
lang=EN-US>port where both client and server agree to connect; if you’re
meeting someone, the IP address is the neighborhood and the port is the bar.</span></p>

<p class=MsoNormal><span lang=EN-US>The port is not a physical location in a
machine, but a software abstraction (mainly for bookkeeping purposes). The
client program knows how to connect to the machine via its IP address, but how
does it connect to a desired service (potentially one of many on that machine)?
That’s where the port numbers come in as a second level of addressing. The idea
is that if you ask for a particular port, you’re requesting the service that’s
associated with the port number. The time of day is a simple example of a
service. Typically, each service is associated with a unique port number on a
given server machine. It’s up to the client to know ahead of time which port number
the desired service is running on. </span></p>

<p class=MsoNormal><span lang=EN-US>The system services reserve the use of
ports 1 through 1024, so you shouldn’t use those or any other port that you
know to be in use. The first choice for examples in this book will be port 8080
(in memory of the venerable old 8-bit Intel 8080 chip in my first computer, a
CP/M machine).</span></p>

<h3><a name="_Toc481064869"></a><a name="_Toc375545495"><span lang=EN-US>Sockets</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The <i>socket</i> is the software
abstraction used to represent the “terminals” of a connection between two
machines. For a given connection, there’s a socket on each machine, and you can
imagine a hypothetical “cable” running between the two machines with each end
of the “cable” plugged into a socket. Of course, the physical hardware and
cabling between machines is completely unknown. The whole point of the
abstraction is that we don’t have to know more than is necessary.</span></p>

<p class=MsoNormal><span lang=EN-US>In Java, you create a socket to make the
connection to the other machine, then you get an <b>InputStream</b> and <b>OutputStream</b>
(or, with the appropriate converters, <b>Reader</b> and <b>Writer</b>)<b> </b>from
the socket in order to be able to treat the connection as an I/O stream object.
There are two stream-based socket classes: a <b>ServerSocket</b> that a server
uses to “listen” for incoming connections and a <b>Socket</b> that a client
uses in order to initiate a connection. Once a client makes a socket
connection, the <b>ServerSocket</b> returns (via the <b>accept(&nbsp;)</b> </span><span lang=EN-US>method) a corresponding <b>Socket</b> through which communications
will take place on the server side. From then on, you have a true <b>Socket</b>
to <b>Socket</b> connection and you treat both ends the same way because they <i>are</i>
the same. At this point, you use the methods </span><span lang=EN-US><b>getInputStream(&nbsp;)</b> and </span><span lang=EN-US><b>getOutputStream(&nbsp;)</b> to produce the corresponding <b>InputStream</b>
and <b>OutputStream</b> objects from each <b>Socket</b>. These must be wrapped
inside buffers and formatting classes just like any other stream object
described in Chapter 11.</span></p>

<p class=MsoNormal><span lang=EN-US>The use of the term <b>ServerSocket</b>
would seem to be another example of a confusing naming scheme in the Java
libraries. You might think <b>ServerSocket</b> would be better named
“ServerConnector” or something without the word “Socket” in it. You might also
think that <b>ServerSocket</b> and <b>Socket</b> should both be inherited from
some common base class. Indeed, the two classes do have several methods in
common, but not enough to give them a common base class. Instead, <b>ServerSocket</b>’s
job is to wait until some other machine connects to it, then to return an
actual <b>Socket</b>. This is why <b>ServerSocket</b> seems to be a bit
misnamed, since its job isn’t really to be a socket but instead to make a <b>Socket</b>
object when someone else connects to it.</span></p>

<p class=MsoNormal><span lang=EN-US>However, the <b>ServerSocket</b> does
create a physical “server” or listening socket on the host machine. This socket
listens for incoming connections and then returns an “established” socket (with
the local and remote endpoints defined) via the <b>accept(&nbsp;)</b> method.
The confusing part is that both of these sockets (listening and established)
are associated with the same server socket. The listening socket can accept
only new connection requests and not data packets. So while <b>ServerSocket</b>
doesn’t make much sense programmatically, it does “physically.”</span></p>

<p class=MsoNormal><span lang=EN-US>When you create a <b>ServerSocket</b>, you
give it only a port number. You don’t have to give it an IP address because
it’s already on the machine it represents. When you create a <b>Socket</b>,
however, you must give both the IP address and the port number where you’re
trying to connect. (However, the <b>Socket</b> that comes back from <b>ServerSocket.accept(&nbsp;)</b>
already contains all this information.)</span></p>

<h4><a name="_Toc375545496"><span lang=EN-US>A simple server and client</span></a></h4>

<p class=MsoNormal><span lang=EN-US>This example makes the simplest use of
servers and clients using sockets. All the server does is wait for a connection,
then uses the <b>Socket</b> produced by that connection to create an <b>InputStream</b>
and <b>OutputStream</b>. These are converted to a <b>Reader</b> and a <b>Writer</b>,
then wrapped in a <b>BufferedReader</b> and a <b>PrintWriter</b>.<b> </b>After
that, everything it reads from the <b>BufferedReader</b> it echoes to the <b>PrintWriter</b>
until it receives the line “END,” at which time it closes the connection.</span></p>

<p class=MsoNormal><span lang=EN-US>The client makes the connection to the
server, then creates an <b>OutputStream </b>and performs the same wrapping as
in the server. Lines of text are sent through the resulting <b>PrintWriter</b>.
The client also creates an <b>InputStream</b> (again, with appropriate
conversions and wrapping) to hear what the server is saying (which, in this
case, is just the words echoed back).</span></p>

<p class=MsoNormal><span lang=EN-US>Both the server and client use the same
port number and the client uses the local loopback address to connect to the
server on the same machine so you don’t have to test it over a network. (For
some configurations, you might need to be <i>connected</i> to a network for the
programs to work, even if you aren’t <i>communicating</i> over that network.)</span></p>

<p class=MsoNormal><span lang=EN-US>Here is the server:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:JabberServer.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Very simple server
that just</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// echoes whatever the
client sends.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.net.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
JabberServer {  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Choose a port
outside of the range 1-1024:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static final
int PORT = 8080;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws IOException
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ServerSocket s = new
ServerSocket(PORT);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Started: &quot; + s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Blocks until a
connection occurs:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Socket socket =
s.accept();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
&quot;Connection accepted: &quot;+ socket);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        BufferedReader
in = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            new
InputStreamReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>             
socket.getInputStream()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // Output is
automatically flushed</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // by
PrintWriter:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        PrintWriter out
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
PrintWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            new
BufferedWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              new
OutputStreamWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>               
socket.getOutputStream())),true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        while (true) {  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          String str =
in.readLine();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          if
(str.equals(&quot;END&quot;)) break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
System.out.println(&quot;Echoing: &quot; + str);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
out.println(str);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Always close
the two sockets...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        System.out.println(&quot;closing...&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        socket.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  } </span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the <b>ServerSocket</b>
just needs a port number, not an IP address (since it’s running on <i>this</i>
machine!). When you call <b>accept(&nbsp;)</b>, the method <i>blocks</i> until
some client tries to connect to it. That is, it’s there waiting for a
connection, but other processes can run (see Chapter 14). When a connection is
made, <b>accept(&nbsp;)</b> returns with a <b>Socket</b> object representing
that connection. </span></p>

<p class=MsoNormal><span lang=EN-US>The responsibility for cleaning up the
sockets is crafted carefully here. If the <b>ServerSocket</b> constructor
fails, the program just quits (notice we must assume that the constructor for <b>ServerSocket</b>
doesn’t leave any open network sockets lying around if it fails). For this case,
<b>main(&nbsp;)</b> <b>throws</b> <b>IOException</b> so a <b>try</b> block is
not necessary. If the <b>ServerSocket</b> constructor is successful then all
other method calls must be guarded in a <b>try-finally</b> block to ensure
that, no matter how the block is left, the <b>ServerSocket</b> is properly
closed.</span></p>

<p class=MsoNormal><span lang=EN-US>The same logic is used for the <b>Socket</b>
returned by <b>accept(&nbsp;)</b>. If <b>accept(&nbsp;)</b> fails, then we must
assume that the <b>Socket</b> doesn’t exist or hold any resources, so it
doesn’t need to be cleaned up. If it’s successful, however, the following statements
must be in a <b>try-finally</b> block so that if they fail the <b>Socket</b>
will still be cleaned up. Care is required here because sockets use important
nonmemory resources, so you must be diligent in order to clean them up (since
there is no destructor in Java to do it for you).</span></p>

<p class=MsoNormal><span lang=EN-US>Both the <b>ServerSocket</b> and the <b>Socket</b>
produced by <b>accept(&nbsp;)</b> are printed to <b>System.out</b>. This means
that their <b>toString(&nbsp;)</b> methods are automatically called. These
produce:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>ServerSocket[addr=0.0.0.0,PORT=0,localport=8080]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Socket[addr=127.0.0.1,PORT=1077,localport=8080]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Shortly, you’ll see how these fit together
with what the client is doing.</span></p>

<p class=MsoNormal><span lang=EN-US>The next part of the program looks just
like opening files for reading and writing except that the <b>InputStream</b>
and <b>OutputStream</b> are created from the <b>Socket</b> object. Both the <b>InputStream</b>
and <b>OutputStream </b>objects are converted to </span><span lang=EN-US><b>Reader </b>and </span><span
lang=EN-US><b>Writer</b> objects using the “converter” classes </span><span lang=EN-US><b>InputStreamReader</b> and </span><span lang=EN-US><b>OutputStreamWriter</b>, respectively. You could also have used the
Java 1.0 </span><span lang=EN-US><b>InputStream</b> and </span><span lang=EN-US><b>OutputStream</b> classes directly, but with output there’s a
distinct advantage to using the <b>Writer</b> approach. This appears with </span><span lang=EN-US><b>PrintWriter</b>, which has an overloaded constructor that takes a
second argument, a <b>boolean </b>flag that indicates whether to automatically
flush the output at the end of each <b>println(&nbsp;)</b> (but <i>not </i><b>print(&nbsp;)</b>)
statement. Every time you write to <b>out</b>, its buffer must be flushed so
the information goes out over the network. Flushing is important for this particular
example because the client and server each wait for a line from the other party
before proceeding. If flushing doesn’t occur, the information will not be put
onto the network until the buffer is full, which causes lots of problems in
this example.</span></p>

<p class=MsoNormal><span lang=EN-US>When writing network programs you need to
be careful about using automatic flushing. Every time you flush the buffer a
packet must be created and sent. In this case, that’s exactly what we want,
since if the packet containing the line isn’t sent then the handshaking back
and forth between server and client will stop. Put another way, the end of a
line is the end of a message. But in many cases, messages aren’t delimited by
lines so it’s much more efficient to not use auto flushing and instead let the
built-in buffering decide when to build and send a packet. This way, larger
packets can be sent and the process will be faster.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that, like virtually all streams you
open, these are buffered. There’s an exercise at the end of this chapter to
show you what happens if you don’t buffer the streams (things get slow).</span></p>

<p class=MsoNormal><span lang=EN-US>The infinite <b>while</b> loop reads lines
from the<b> BufferedReader in </b>and writes information to <b>System.out</b>
and to the <b>PrintWriter</b> <b>out</b>. Note that <b>in</b> and <b>out</b>
could be any streams, they just happen to be connected to the network. </span></p>

<p class=MsoNormal><span lang=EN-US>When the client sends the line consisting
of “END,” the program breaks out of the loop and closes the <b>Socket</b>. </span></p>

<p class=MsoNormal><span lang=EN-US>Here’s the client:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:JabberClient.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Very simple client
that just sends</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// lines to the server
and reads lines</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// that the server
sends.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.net.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
JabberClient {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws IOException
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Passing null to
getByName() produces the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // special
&quot;Local Loopback&quot; IP address, for</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // testing on one
machine w/o a network:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    InetAddress addr = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
InetAddress.getByName(null);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Alternatively,
you can use </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // the address or
name:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // InetAddress addr
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //   
InetAddress.getByName(&quot;127.0.0.1&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // InetAddress addr
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //   
InetAddress.getByName(&quot;localhost&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;addr = &quot; + addr);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Socket socket = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Socket(addr,
JabberServer.PORT);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Guard everything
in a try-finally to make</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // sure that the
socket is closed:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;socket = &quot; + socket);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      BufferedReader in
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
InputStreamReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
socket.getInputStream()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Output is
automatically flushed</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // by PrintWriter:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      PrintWriter out =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new PrintWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
BufferedWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            new
OutputStreamWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>             
socket.getOutputStream())),true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; 10; i ++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
out.println(&quot;howdy &quot; + i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String str =
in.readLine();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(str);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
out.println(&quot;END&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;closing...&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      socket.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>main(&nbsp;)</b> you can see all
three ways to produce the <b>InetAddress</b> of the local loopback IP address:
using <b>null</b>, <b>localhost</b>, or the explicit reserved address <b>127.0.0.1</b>.
Of course, if you want to connect to a machine across a network you substitute
that machine’s IP address. When the <b>InetAddress addr</b> is printed (via the
automatic call to its <b>toString(&nbsp;)</b> method) the result is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>localhost/127.0.0.1</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>By handing <b>getByName(&nbsp;)</b> a <b>null</b>,
it defaulted to finding the <b>localhost</b>, and that produced the special
address <b>127.0.0.1</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Note that the </span><span lang=EN-US><b>Socket</b> called <b>socket</b> is created with both the <b>InetAddress</b>
and the port number. To understand what it means when you print one of these <b>Socket
</b>objects, remember that an Internet connection is determined uniquely by
these four pieces of data: <b>clientHost</b>, <b>clientPortNumber</b>, <b>serverHost</b>,
and <b>serverPortNumber</b>. When the server comes up, it takes up its assigned
port (8080) on the localhost (127.0.0.1). When the client comes up, it is
allocated to the next available port on its machine, 1077 in this case, which
also happens to be on the same machine (127.0.0.1) as the server. Now, in order
for data to move between the client and server, each side has to know where to
send it. Therefore, during the process of connecting to the “known” server, the
client sends a “return address” so the server knows where to send its data.
This is what you see in the example output for the server side:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US style='font-size:
10.0pt'>Socket[addr=127.0.0.1,port=1077,localport=8080]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This means that the server just accepted a
connection from 127.0.0.1 on port 1077 while listening on its local port
(8080). On the client side:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US style='font-size:
10.0pt'>Socket[addr=localhost/127.0.0.1,PORT=8080,localport=1077]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>which means that the client made a
connection to 127.0.0.1 on port 8080 using the local port 1077.</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll notice that every time you start up
the client anew, the local port number is incremented. It starts at 1025 (one
past the reserved block of ports) and keeps going up until you reboot the
machine, at which point it starts at 1025 again. (On UNIX machines, once the
upper limit of the socket range is reached, the numbers will wrap around to the
lowest available number again.)</span></p>

<p class=MsoNormal><span lang=EN-US>Once the <b>Socket</b> object has been
created, the process of turning it into a <b>BufferedReader</b> and <b>PrintWriter</b>
is the same as in the server (again, in both cases you start with a <b>Socket</b>).
Here, the client initiates the conversation by sending the string “howdy”
followed by a number. Note that the buffer must again be flushed (which happens
automatically via the second argument to the <b>PrintWriter </b>constructor).
If the buffer isn’t flushed, the whole conversation will hang because the
initial “howdy” will never get sent (the buffer isn’t full enough to cause the
send to happen automatically). Each line that is sent back from the server is
written to <b>System.out</b> to verify that everything is working correctly. To
terminate the conversation, the agreed-upon “END” is sent. If the client simply
hangs up, then the server throws an exception.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that the same care is taken
here to ensure that the network resources represented by the <b>Socket</b> are
properly cleaned up, using a <b>try-finally</b> block.</span></p>

<p class=MsoNormal><span lang=EN-US>Sockets produce a </span><span
lang=EN-US>“dedicated” connection that persists until it is explicitly
disconnected. (The dedicated connection can still be disconnected unexplicitly
if one side, or an intermediary link, of the connection crashes.) This means
the two parties are locked in communication and the connection is constantly
open. This seems like a logical approach to networking, but it puts an extra
load on the network. Later in this chapter you’ll see a different approach to
networking, in which the connections are only temporary.</span></p>

<h3><a name="_Toc481064870"></a><a name="_Toc375545497"><span lang=EN-US>Serving
multiple clients</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>The <b>JabberServer</b> works, but it can handle only one client at
a time. In a typical server, you’ll want to be able to deal with many clients
at once. The answer is </span><span
lang=EN-US>multithreading, and in languages that don’t directly support multithreading
this means all sorts of complications. In Chapter 14 you saw that
multithreading in Java is about as simple as possible, considering that multithreading
is a rather complex topic. Because threading in Java is reasonably
straightforward, making a server that handles multiple clients is relatively
easy.</span></p>

<p class=MsoNormal><span lang=EN-US>The basic scheme is to make a single <b>ServerSocket</b>
in the server and call <b>accept(&nbsp;)</b> to wait for a new connection. When
<b>accept(&nbsp;)</b> returns, you take the resulting <b>Socket</b> and use it
to create a new thread whose job is to serve that particular client. Then you
call <b>accept(&nbsp;)</b> again to wait for a new client.</span></p>

<p class=MsoNormal><span lang=EN-US>In the following server code, you can see
that it looks similar to the <b>JabberServer.java</b> example except that all
of the operations to serve a particular client have been moved inside a separate
thread class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:MultiJabberServer.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A server that uses
multithreading </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// to handle any number
of clients.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.net.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class ServeOneJabber
extends Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Socket socket;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private BufferedReader
in;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private PrintWriter
out;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
ServeOneJabber(Socket s) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws IOException
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    socket = s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    in = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
InputStreamReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
socket.getInputStream()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Enable
auto-flush:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new PrintWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
OutputStreamWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
socket.getOutputStream())), true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // If any of the
above calls throw an </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // exception, the
caller is responsible for</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // closing the
socket. Otherwise the thread</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // will close it.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    start(); // Calls
run()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while (true) {  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String str =
in.readLine();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        if
(str.equals(&quot;END&quot;)) break;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(&quot;Echoing: &quot; + str);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        out.println(str);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;closing...&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(IOException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;IO Exception&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        socket.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(IOException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Socket not closed&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
MultiJabberServer {  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static final int PORT
= 8080;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws IOException
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ServerSocket s = new
ServerSocket(PORT);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Server Started&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // Blocks until
a connection occurs:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        Socket socket =
s.accept();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
ServeOneJabber(socket);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }
catch(IOException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // If it
fails, close the socket,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          // otherwise
the thread will close it:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
socket.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  } </span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>ServeOneJabber </b>thread takes the <b>Socket</b>
object that’s produced by <b>accept(&nbsp;)</b> in <b>main(&nbsp;)</b> every
time a new client makes a connection. Then, as before, it creates a <b>BufferedReader</b>
and auto-flushed <b>PrintWriter</b> object using the <b>Socket</b>. Finally, it
calls the special <b>Thread</b> method <b>start(&nbsp;)</b>, which performs
thread initialization and then calls <b>run(&nbsp;)</b>. This performs the same
kind of action as in the previous example: reading something from the socket
and then echoing it back until it reads the special “END” signal.</span></p>

<p class=MsoNormal><span lang=EN-US>The responsibility for cleaning up the
socket must again be carefully designed. In this case, the socket is created
outside of the <b>ServeOneJabber</b> so the responsibility can be shared. If
the <b>ServeOneJabber</b> constructor fails, it will just throw the exception
to the caller, who will then clean up the thread. But if the constructor
succeeds, then the <b>ServeOneJabber</b> object takes over responsibility for
cleaning up the thread, in its <b>run(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Notice the simplicity of the <b>MultiJabberServer</b>.
As before, a <b>ServerSocket</b> is created and <b>accept(&nbsp;)</b> is called
to allow a new connection. But this time, the return value of <b>accept(&nbsp;)</b>
(a <b>Socket</b>) is passed to the constructor for <b>ServeOneJabber,</b> which
creates a new thread to handle that connection. When the connection is
terminated, the thread simply goes away.</span></p>

<p class=MsoNormal><span lang=EN-US>If the creation of the <b>ServerSocket</b>
fails, the exception is again thrown through <b>main(&nbsp;)</b>. But if the
creation succeeds, the outer <b>try-finally</b> guarantees its cleanup. The
inner <b>try-catch</b> guards only against the failure of the <b>ServeOneJabber</b>
constructor; if the constructor succeeds, then the <b>ServeOneJabber</b> thread
will close the associated socket.</span></p>

<p class=MsoNormal><span lang=EN-US>To test that the server really does handle
multiple clients, the following program creates many clients (using threads)
that connect to the same server. The maximum number of threads allowed is
determined by the <b>final int MAX_THREADS</b>. </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:MultiJabberClient.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Client that tests the
MultiJabberServer</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// by starting up
multiple clients.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.net.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class JabberClientThread
extends Thread {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Socket socket;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private BufferedReader
in;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private PrintWriter
out;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static int
counter = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int id =
counter++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private static int
threadcount = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static int
threadCount() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return threadcount; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
JabberClientThread(InetAddress addr) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Making client &quot; + id);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    threadcount++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      socket = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new Socket(addr,
MultiJabberServer.PORT);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(IOException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Socket failed&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // If the creation
of the socket fails, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // nothing needs
to be cleaned up.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      in = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
InputStreamReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>           
socket.getInputStream()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Enable
auto-flush:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      out = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new PrintWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
BufferedWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>            new
OutputStreamWriter(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>              socket.getOutputStream())),
true);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      start();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(IOException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // The socket
should be closed on any </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // failures other
than the socket </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // constructor:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        socket.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } catch(IOException
e2) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Socket not closed&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Otherwise the
socket will be closed by</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // the run() method
of the thread.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void run() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; 25; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
out.println(&quot;Client &quot; + id + &quot;: &quot; + i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String str =
in.readLine();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(str);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
out.println(&quot;END&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(IOException
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;IO Exception&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Always close
it:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        socket.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(IOException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Socket not closed&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      threadcount--; //
Ending this thread</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
MultiJabberClient {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static final int
MAX_THREADS = 40;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws
IOException, InterruptedException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    InetAddress addr = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
InetAddress.getByName(null);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(true) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
if(JabberClientThread.threadCount() </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         &lt;
MAX_THREADS)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
JabberClientThread(addr);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Thread.currentThread().sleep(100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>JabberClientThread</b> constructor
takes an <b>InetAddress</b> and uses it to open a <b>Socket</b>. You’re
probably starting to see the pattern: the <b>Socket</b> is always used to
create some kind of <b>Reader </b>and/or <b>Writer </b>(or <b>InputStream</b>
and/or <b>OutputStream</b>) object, which is the only way that the <b>Socket</b>
can be used. (You can, of course, write a class or two to automate this process
instead of doing all the typing if it becomes painful.) Again, <b>start(&nbsp;)</b>
performs thread initialization and calls <b>run(&nbsp;)</b>. Here, messages are
sent to the server and information from the server is echoed to the screen.
However, the thread has a limited lifetime and eventually completes. Note that
the socket is cleaned up if the constructor fails after the socket is created
but before the constructor completes. Otherwise the responsibility for calling <b>close(&nbsp;)</b>
for the socket is relegated to the <b>run(&nbsp;)</b> method.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>threadcount</b> keeps track of how
many <b>JabberClientThread</b> objects currently exist. It is incremented as
part of the constructor and decremented as <b>run(&nbsp;)</b> exits (which
means the thread is terminating). In <b>MultiJabberClient.main(&nbsp;),</b> you
can see that the number of threads is tested, and if there are too many, no
more are created. Then the method sleeps. This way, some threads will
eventually terminate and more can be created. You can experiment with <b>MAX_THREADS</b>
to see where your particular system begins to have trouble with too many
connections.</span></p>

<h3><a name="_Toc375545498"></a><a name="_Toc481064871"><span lang=EN-US>Datagrams</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>The examples you’ve seen so far use the </span><span
lang=EN-US><i>Transmission Control Protocol</i> (TCP, also known as </span><span lang=EN-US><i>stream-based sockets</i>), which is designed for ultimate
reliability and guarantees that the data will get there. It allows
retransmission of lost data, it provides multiple paths through different
routers in case one goes down, and bytes are delivered in the order they are
sent. All this control and reliability comes at a cost: TCP has a high
overhead.</span></p>

<p class=MsoNormal><span lang=EN-US>There’s a second protocol, called </span><span lang=EN-US><i>User Datagram Protocol</i> (UDP), which doesn’t guarantee that the
packets will be delivered and doesn’t guarantee that they will arrive in the
order they were sent. It’s called an “</span><span lang=EN-US>unreliable protocol” (TCP is a </span><span lang=EN-US>“reliable protocol”), which sounds bad, but because it’s much faster
it can be useful. There are some applications, such as an audio signal, in
which it isn’t so critical if a few packets are dropped here or there but speed
is vital. Or consider a time-of-day server, where it really doesn’t matter if
one of the messages is lost. Also, some applications might be able to fire off
a UDP message to a server and can then assume, if there is no response in a
reasonable period of time, that the message was lost.</span></p>

<p class=MsoNormal><span lang=EN-US>Typically, you’ll do most of your direct
network programming with TCP, and only occasionally will you use UDP. There’s a
more complete treatment of UDP, including an example, in the first edition of
this book (available on the CD ROM bound into this book, or as a free download
from <i>www.BruceEckel.com</i>).</span></p>

<h3><a name="_Toc481064872"><span lang=EN-US>Using URLs from within an applet</span></a></h3>

<p class=MsoNormal><span
lang=EN-US>It’s possible for an applet to cause the display of any URL through
the Web browser the applet is running within. You can do this with the
following line:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>getAppletContext().showDocument(u);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span
lang=EN-US>in which <b>u</b> is the <b>URL</b> object. Here’s a simple example
that redirects you to another Web page. Although you’re just redirected to an
HTML page, you could also redirect to the output of a CGI program. </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c15:ShowHTML.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=ShowHTML width=100 height=50&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.net.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ShowHTML
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton send = new
JButton(&quot;Go&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JLabel l = new
JLabel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
send.addActionListener(new Al());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(send);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(l);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class Al implements
ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent ae) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // This could be
a CGI program instead of</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // an HTML page.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        URL u = new
URL(getDocumentBase(), </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
&quot;FetcherFrame.html&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // Display the
output of the URL using</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        // the Web
browser, as an ordinary page:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
getAppletContext().showDocument(u);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } catch(Exception
e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
l.setText(e.toString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
ShowHTML(), 100, 50);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The beauty of the </span><span lang=EN-US><b>URL</b> class is how much it shields you from. You can connect to
Web servers without knowing much at all about what’s going on under the covers.</span></p>

<h4><span lang=EN-US>Reading a file from the server</span></h4>

<p class=MsoNormal><span lang=EN-US>A variation on the above program reads a
file located on the server. In this case, the file is specified by the client:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c15:Fetcher.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=Fetcher width=500 height=300&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.net.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Fetcher
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JButton fetchIt= new
JButton(&quot;Fetch the Data&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField f = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JTextField(&quot;Fetcher.java&quot;, 20);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextArea t = new
JTextArea(10,40);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.setLayout(new
FlowLayout());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
fetchIt.addActionListener(new FetchL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(new
JScrollPane(t));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(f);
cp.add(fetchIt);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public class FetchL
implements ActionListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
actionPerformed(ActionEvent e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        URL url = new
URL(getDocumentBase(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          f.getText());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        t.setText(url +
&quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        InputStream is =
url.openStream();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        BufferedReader
in = new BufferedReader(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          new
InputStreamReader(is));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String line;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        while ((line =
in.readLine()) != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          t.append(line
+ &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } catch(Exception
ex) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t.append(ex.toString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
Fetcher(), 500, 300);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The creation of the <b>URL</b> object is
similar to the previous example—<b>getDocumentBase(&nbsp;)</b> is the starting
point as before, but this time the name of the file is read from the <b>JTextField</b>.
Once the <b>URL</b> object is created, its <b>String</b> version is placed in
the <b>JTextArea</b> so we can see what it looks like. Then an <b>InputStream</b>
is procured from the <b>URL</b>, which in this case will simply produce a
stream of the characters in the file. After converting to a <b>Reader</b> and buffering,
each line is read and appended to the <b>JTextArea</b>. Note that the <b>JTextArea</b>
has been placed inside a <b>JScrollPane</b> so that scrolling is handled
automatically.</span></p>

<h3><a name="_Toc481064873"><span lang=EN-US>More to networking</span></a></h3>

<p class=MsoNormal><span lang=EN-US>There’s actually a lot more to networking
than can be covered in this introductory treatment. Java networking also
provides fairly extensive support for URLs, including protocol handlers for
different types of content that can be discovered at an Internet site. You can
find other Java networking features fully and carefully described in <i>Java
Network Programming</i> by Elliotte Rusty Harold (O’Reilly, 1997).</span></p>

<h2><a name="_Toc481064874"><span lang=EN-US>Java Database Connectivity (JDBC)</span></a></h2>

<p class=MsoNormal><span lang=EN-US>It has been estimated that half of all
software development involves client/server operations. A great promise of Java
has been the ability to build platform-independent client/server database
applications. This has come to fruition with </span><span
lang=EN-US>Java DataBase Connectivity (JDBC).</span></p>

<p class=MsoNormal><span lang=EN-US>One of the major problems with databases
has been the feature wars between the database companies. There is a “standard”
database language, </span><span lang=EN-US>Structured Query Language (SQL-92), but you must usually know which
database vendor you’re working with despite the standard. JDBC is designed to
be platform-independent, so you don’t need to worry about the database you’re
using while you’re programming. However, it’s still possible to make
vendor-specific calls from JDBC so you aren’t restricted from doing what you
must.</span></p>

<p class=MsoNormal><span lang=EN-US>One place where programmers may need to use
SQL type names is in the SQL </span><span lang=EN-US style='font-family:"Courier New"'>TABLE
CREATE</span><span lang=EN-US> statement when they are creating a new database
table and defining the SQL type for each column. Unfortunately there are
significant variations between SQL types supported by different database
products. Different databases that support SQL types with the same semantics
and structure may give those types different names. Most major databases
support an SQL data type for large binary values: in Oracle this type is called
a </span><span lang=EN-US style='font-family:"Courier New"'>LONG RAW</span><span
lang=EN-US>, Sybase calls it </span><span lang=EN-US style='font-family:"Courier New"'>IMAGE</span><span
lang=EN-US>, Informix calls it </span><span lang=EN-US style='font-family:"Courier New"'>BYTE</span><span
lang=EN-US>, and DB2 calls it </span><span lang=EN-US style='font-family:"Courier New"'>LONG
VARCHAR FOR BIT DATA</span><span lang=EN-US>. Therefore, if database
portability is a goal you should try to use only generic SQL type identifiers.</span></p>

<p class=MsoNormal><span lang=EN-US>Portability is an issue when writing for a
book where readers may be testing the examples with all kinds of unknown data
stores. I have tried to write these examples to be as portable as possible. You
should also notice that the database-specific code has been isolated in order
to centralize any changes that you may need to perform to get the examples
operational in your environment.</span></p>

<p class=MsoNormal><span lang=EN-US>JDBC, like many of the APIs in Java, is
designed for simplicity. The method calls you make correspond to the logical
operations you’d think of doing when gathering data from a database: connect to
the database, create a statement and execute the query, and look at the result
set.</span></p>

<p class=MsoNormal><span lang=EN-US>To allow this platform independence, JDBC
provides a <i>driver manager</i> that dynamically maintains all the driver
objects that your database queries will need. So if you have three different
kinds of vendor databases to connect to, you’ll need three different driver
objects. The driver objects register themselves with the driver manager at the
time of loading, and you can force the loading using <b>Class.forName(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>To open a database, you must create a “</span><span lang=EN-US>database URL” that specifies: </span></p>

<p class=Numbered><span lang=EN-US>That you’re using JDBC with “jdbc.”</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>116.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>The “subprotocol”: the name of the driver or the name of a database
connectivity mechanism. Since the design of JDBC was inspired by ODBC, the
first subprotocol available is the “jdbc-odbc bridge,” specified by “odbc.”</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>117.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>The database identifier. This varies with the database driver used,
but it generally provides a logical name that is mapped by the database
administration software to a physical directory where the database tables are
located. For your database identifier to have any meaning, you must register
the name using your database administration software. (The process of
registration varies from platform to platform.)</span></p>

<p class=MsoNormal><span lang=EN-US>All this information is combined into one
string, the “database URL.” For example, to connect through the ODBC
subprotocol to a database identified as “people,” the database URL could be:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>String dbUrl =
&quot;jdbc:odbc:people&quot;;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you’re connecting across a network, the
database URL will contain the connection information identifying the remote
machine and can become a bit intimidating. Here is an example of a CloudScape
database being called from a remote client utilizing RMI:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>jdbc:rmi://192.168.170.27:1099/jdbc:cloudscape:db</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This database URL is really two jdbc calls
in one. The first part “</span><span lang=EN-US style='font-family:"Courier New"'>jdbc:rmi://192.168.170.27:1099/</span><span
lang=EN-US>” uses RMI to make the connection to the remote database engine
listening on port 1099 at IP Address 192.168.170.27. The second part of the
URL, “</span><span lang=EN-US style='font-family:"Courier New"'>jdbc:cloudscape:db</span><span
lang=EN-US>” conveys the more typical settings using the subprotocol and
database name but this will only happen after the first section has made the
connection via RMI to the remote machine.</span></p>

<p class=MsoNormal><span lang=EN-US>When you’re ready to connect to the
database, call the <b>static</b> method <b>DriverManager.getConnection(&nbsp;)</b>
and pass it the database URL, the user name, and a password to get into the
database. You get back a <b>Connection</b> object that you can then use to
query and manipulate the database.</span></p>

<p class=MsoNormal><span lang=EN-US>The following example opens a database of
contact information and looks for a person’s last name as given on the command
line. It selects only the names of people that have email addresses, then
prints out all the ones that match the given last name:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c15:jdbc:Lookup.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Looks up email
addresses in a </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// local database using
JDBC.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.sql.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Lookup {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws SQLException,
ClassNotFoundException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String dbUrl =
&quot;jdbc:odbc:people&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String user =
&quot;&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String password =
&quot;&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Load the driver
(registers itself)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Class.forName(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;sun.jdbc.odbc.JdbcOdbcDriver&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Connection c =
DriverManager.getConnection(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      dbUrl, user,
password);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Statement s =
c.createStatement();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // SQL code:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ResultSet r = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s.executeQuery(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;SELECT
FIRST, LAST, EMAIL &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;FROM
people.csv people &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;WHERE
&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
&quot;(LAST='&quot; + args[0] + &quot;') &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot; AND
(EMAIL Is Not Null) &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;ORDER BY
FIRST&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(r.next()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Capitalization
doesn't matter:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
r.getString(&quot;Last&quot;) + &quot;, &quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        +
r.getString(&quot;fIRST&quot;)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        + &quot;: &quot;
+ r.getString(&quot;EMAIL&quot;) );</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s.close(); // Also
closes ResultSet</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see the creation of the database
URL as previously described. In this example, there is no password protection
on the database so the user name and password are empty strings.</span></p>

<p class=MsoNormal><span lang=EN-US>Once the connection is made with <b>DriverManager.getConnection(&nbsp;)</b>,
you can use the resulting <b>Connection</b> object to<b> </b>create a <b>Statement</b>
object using the </span><span lang=EN-US><b>createStatement(&nbsp;)</b> method. With the resulting </span><span lang=EN-US><b>Statement</b>, you can call </span><span lang=EN-US><b>executeQuery(&nbsp;)</b>, passing in a string containing an SQL-92
standard SQL statement. (You’ll see shortly how you can generate this statement
automatically, so you don’t have to know much about SQL.) </span></p>

<p class=MsoNormal><span lang=EN-US>The <b>executeQuery(&nbsp;) </b>method
returns a </span><span lang=EN-US><b>ResultSet</b> object, which is an
iterator: the <b>next(&nbsp;)</b> method moves the iterator to the next record
in the statement, or returns <b>false</b> if the end of the result set has been
reached. You’ll always get a <b>ResultSet</b> object back from <b>executeQuery(&nbsp;)</b>
even if a query results in an empty set (that is, an exception is not thrown).
Note that you must call <b>next(&nbsp;)</b> once before trying to read any
record data. If the result set is empty, this first call to <b>next(&nbsp;)</b>
will return <b>false</b>. For each record in the result set, you can select the
fields using (among other approaches) the field name as a string. Also note
that the capitalization of the field name is ignored—it doesn’t matter with an
SQL database. You determine the type you’ll get back by calling </span><span lang=EN-US><b>getInt(&nbsp;)</b>, </span><span lang=EN-US><b>getString(&nbsp;)</b>, </span><span lang=EN-US><b>getFloat(&nbsp;)</b>, etc. At this point, you’ve got your database
data in Java native format and can do whatever you want with it using ordinary
Java code.</span></p>

<h3><a name="_Toc481064875"><span lang=EN-US>Getting the example to work</span></a></h3>

<p class=MsoNormal><span lang=EN-US>With JDBC, understanding the code is
relatively simple. The confusing part is making it work on your particular
system. The reason this is confusing is that it requires you to figure out how
to get your JDBC driver to load properly, and how to set up a database using
your database administration software.</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, this process can vary radically
from machine to machine, but the process I used to make it work under 32-bit
Windows might give you clues to help you attack your own situation.</span></p>

<h4><span lang=EN-US>Step 1: Find the JDBC Driver</span></h4>

<p class=MsoNormal><span lang=EN-US>The program above contains the statement:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Class.forName(&quot;sun.jdbc.odbc.JdbcOdbcDriver&quot;);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This implies a directory structure, which
is deceiving. With this particular installation of JDK 1.1, there was no file
called <b>JdbcOdbcDriver.class</b>, so if you looked at this example and went
searching for it you’d be frustrated. Other published examples use a pseudo
name, such as “myDriver.ClassName,” which is less than helpful. In fact, the
load statement above for the jdbc-odbc driver (the only one that actually comes
with the JDK) appears in only a few places in the online documentation (in
particular, a page labeled “JDBC-ODBC Bridge Driver”). If the load statement
above doesn’t work, then the name might have been changed as part of a Java
version change, so you should hunt through the documentation again.</span></p>

<p class=MsoNormal><span lang=EN-US>If the load statement is wrong, you’ll get
an exception at this point. To test whether your driver load statement is
working correctly, comment out the code after the statement and up to the <b>catch</b>
clause; if the program throws no exceptions it means that the driver is loading
properly.</span></p>

<h4><span lang=EN-US>Step 2: Configure the database</span></h4>

<p class=MsoNormal><span lang=EN-US>Again, this is specific to 32-bit Windows;
you might need to do some research to figure it out for your own platform.</span></p>

<p class=MsoNormal><span lang=EN-US>First, open the control panel. You might
find two icons that say “ODBC.” You must use the one that says “32bit ODBC,”
since the other one is for backward compatibility with 16-bit ODBC software and
will produce no results for JDBC. When you open the “32bit ODBC” icon, you’ll see
a tabbed dialog with a number of tabs, including “User DSN,” “System DSN,”
“File DSN,” etc., in which “DSN” means “Data Source Name.” It turns out that
for the JDBC-ODBC bridge, the only place where it’s important to set up your database
is “System DSN,” but you’ll also want to test your configuration and create
queries, and for that you’ll also need to set up your database in “File DSN.”
This will allow the Microsoft Query tool (that comes with Microsoft Office) to
find the database. Note that other query tools are also available from other
vendors.</span></p>

<p class=MsoNormal><span lang=EN-US>The most interesting database is one that
you’re already using. Standard ODBC supports a number of different file formats
including such venerable workhorses as DBase. However, it also includes the
simple “comma-separated ASCII” format, which virtually every data tool has the
ability to write. In my case, I just took my “people” database that I’ve been
maintaining for years using various contact-management tools and exported it as
a comma-separated ASCII file (these typically have an extension of <b>.csv</b>).
In the “System DSN” section I chose “Add,” chose the text driver to handle my
comma-separated ASCII file, and then un-checked “use current directory” to
allow me to specify the directory where I exported the data file.</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll notice when you do this that you
don’t actually specify a file, only a directory. That’s because a database is
typically represented as a collection of files under a single directory
(although it could be represented in other forms as well). Each file usually
contains a single table, and the SQL statements can produce results that are
culled from multiple tables in the database (this is called a </span><span lang=EN-US><i>join</i>). A database that contains only a single table (like my
“people” database) is usually called a </span><span lang=EN-US><i>flat-file database</i>. Most problems that go beyond the simple
storage and retrieval of data generally require multiple tables that must be
related by joins to produce the desired results, and these are called </span><span lang=EN-US><i>relational</i> databases.</span></p>

<h4><span lang=EN-US>Step 3: Test the configuration</span></h4>

<p class=MsoNormal><span lang=EN-US>To test the configuration you’ll need a way
to discover whether the database is visible from a program that queries it. Of
course, you can simply run the JDBC program example above, up to and including
the statement:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Connection c =
DriverManager.getConnection(</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>  dbUrl, user, password);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If an exception is thrown, your
configuration was incorrect.</span></p>

<p class=MsoNormal><span lang=EN-US>However, it’s useful to get a
query-generation tool involved at this point. I used Microsoft Query that came
with Microsoft Office, but you might prefer something else. The query tool must
know where the database is, and Microsoft Query required that I go to the ODBC
Administrator’s “File DSN” tab and add a new entry there, again specifying the
text driver and the directory where my database lives. You can name the entry
anything you want, but it’s helpful to use the same name you used in “System
DSN.”</span></p>

<p class=MsoNormal><span lang=EN-US>Once you’ve done this, you will see that
your database is available when you create a new query using your query tool.</span></p>

<h4><span lang=EN-US>Step 4: Generate your SQL query</span></h4>

<p class=MsoNormal><span lang=EN-US>The query that I created using Microsoft
Query not only showed me that my database was there and in good order, but it
also automatically created the SQL code that I needed to insert into my Java
program. I wanted a query that would search for records that had the last name
that was typed on the command line when starting the Java program. So as a
starting point, I searched for a specific last name, “Eckel.” I also wanted to
display only those names that had email addresses associated with them. The
steps I took to create this query were:</span></p>

<p class=Numbered><span lang=EN-US>Start a new query and use the Query Wizard.
Select the “people” database. (This is the equivalent of opening the database
connection using the appropriate database URL.)</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>118.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Select the “people” table within the database. From within the
table, choose the columns FIRST, LAST, and EMAIL.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>119.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Under “Filter Data,” choose LAST and select “equals” with an
argument of “Eckel.” Click the “And” radio button.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>120.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Choose EMAIL and select “Is not Null.”</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>121.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Under “Sort By,” choose FIRST.</span></p>

<p class=MsoNormal><span lang=EN-US>The result of this query will show you
whether you’re getting what you want.</span></p>

<p class=MsoNormal><span lang=EN-US>Now you can press the SQL button and
without any research on your part, up will pop the correct SQL code, ready for
you to cut and paste. For this query, it looked like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>SELECT people.FIRST,
people.LAST, people.EMAIL</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>FROM people.csv people</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>WHERE
(people.LAST='Eckel') AND </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(people.EMAIL Is Not
Null)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>ORDER BY
people.FIRST</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Especially with more complicated queries
it’s easy to get things wrong, but by using a query tool you can interactively
test your queries and automatically generate the correct code. It’s hard to
argue the case for doing this by hand.</span></p>

<h4><span lang=EN-US>Step 5: Modify and paste in your query</span></h4>

<p class=MsoNormal><span lang=EN-US>You’ll notice that the code above looks
different from what’s used in the program. That’s because the query tool uses
full qualification for all of the names, even when there’s only one table
involved. (When more than one table is involved, the qualification prevents
collisions between columns from different tables that have the same names.)
Since this query involves only one table, you can optionally remove the
“people” qualifier from most of the names, like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>SELECT FIRST, LAST,
EMAIL</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>FROM people.csv people</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>WHERE (LAST='Eckel') AND
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>(EMAIL Is Not Null)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>ORDER BY FIRST</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In addition, you don’t want this program to
be hard coded to look for only one name. Instead, it should hunt for the name
given as the command-line argument. Making these changes and turning the SQL
statement into a dynamically-created <b>String</b> produces:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&quot;SELECT FIRST,
LAST, EMAIL &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&quot;FROM people.csv
people &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&quot;WHERE &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&quot;(LAST='&quot; +
args[0] + &quot;') &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&quot; AND (EMAIL Is Not
Null) &quot; +</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&quot;ORDER BY
FIRST&quot;);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>SQL has another way to insert names into a
query called </span><span
lang=EN-US><i>stored procedures</i>, which is used for speed. But for much of
your database experimentation and for your first cut, building your own query
strings in Java is fine.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see from this example that by using
the tools currently available—in particular the query-building tool—database
programming with SQL and JDBC can be quite straightforward.</span></p>

<h3><a name="_Toc481064876"><span lang=EN-US>A GUI version of the lookup
program</span></a></h3>

<p class=MsoNormal><span lang=EN-US>It’s more useful to leave the lookup
program running all the time and simply switch to it and type in a name
whenever you want to look someone up. The following program creates the lookup
program as an application/applet, and it also adds name completion so the data
will show up without forcing you to type the entire last name:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:jdbc:VLookup.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// GUI version of
Lookup.java.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// &lt;applet
code=VLookup</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// width=500
height=200&gt;&lt;/applet&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.swing.*; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.awt.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.swing.event.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.sql.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
com.bruceeckel.swing.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class VLookup
extends JApplet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String dbUrl =
&quot;jdbc:odbc:people&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String user =
&quot;&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  String password =
&quot;&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Statement s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextField searchFor =
new JTextField(20);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JLabel completion = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
JLabel(&quot;                        &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  JTextArea results =
new JTextArea(40, 20);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void init() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    searchFor.getDocument().addDocumentListener(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new SearchL());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    JPanel p = new
JPanel();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(new
Label(&quot;Last name to search for:&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(searchFor);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    p.add(completion);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Container cp =
getContentPane();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(p,
BorderLayout.NORTH);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cp.add(results,
BorderLayout.CENTER);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Load the driver
(registers itself)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Class.forName(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
&quot;sun.jdbc.odbc.JdbcOdbcDriver&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Connection c =
DriverManager.getConnection(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        dbUrl, user,
password);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s = c.createStatement();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Exception e)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
results.setText(e.toString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  class SearchL
implements DocumentListener {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
changedUpdate(DocumentEvent e){}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
insertUpdate(DocumentEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
textValueChanged();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    public void
removeUpdate(DocumentEvent e){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
textValueChanged();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
textValueChanged() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ResultSet r;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(searchFor.getText().length() == 0) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
completion.setText(&quot;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
results.setText(&quot;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Name
completion:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      r =
s.executeQuery(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;SELECT
LAST FROM people.csv people &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;WHERE
(LAST Like '&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
searchFor.getText()  + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;%') ORDER
BY LAST&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(r.next()) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
completion.setText(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          r.getString(&quot;last&quot;));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      r =
s.executeQuery(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;SELECT
FIRST, LAST, EMAIL &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;FROM
people.csv people &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;WHERE
(LAST='&quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
completion.getText() +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;') AND
(EMAIL Is Not Null) &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;ORDER BY
FIRST&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Exception e)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      results.setText(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
searchFor.getText() + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
results.append(e.toString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
results.setText(&quot;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while(r.next()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        results.append(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
r.getString(&quot;Last&quot;) + &quot;, &quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          +
r.getString(&quot;fIRST&quot;) + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot;: &quot;
+ r.getString(&quot;EMAIL&quot;) + &quot;\n&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(Exception e)
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
results.setText(e.toString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Console.run(new
VLookup(), 500, 200);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Much of the database logic is the same, but
you can see that a <b>DocumentListener</b> is added to listen to the<b> JText</b><b>Field</b>
(see the <b>javax.swing.JTextField</b> entry in the Java HTML documentation
from <i>java.sun.com</i> for details), so that whenever you type a new
character it first tries to do a name completion by looking up the last name in
the database and using the first one that shows up. (It places it in the <b>completion</b>
<b>JLabel</b>, and uses that as the lookup text.) This way, as soon as you’ve
typed enough characters for the program to uniquely find the name you’re
looking for, you can stop.</span></p>

<h3><a name="_Toc481064877"><span lang=EN-US>Why the JDBC API <br>
seems so complex</span></a></h3>

<p class=MsoNormal><span lang=EN-US>When you browse the online documentation
for JDBC it can seem daunting. In particular, in the </span><span lang=EN-US><b>DatabaseMetaData</b> interface—which is just huge, contrary to
most of the interfaces you see in Java—there are methods such as <b>dataDefinitionCausesTransactionCommit(&nbsp;)</b>,
<b>getMaxColumnNameLength(&nbsp;)</b>, <b>getMaxStatementLength(&nbsp;)</b>, <b>storesMixedCaseQuotedIdentifiers(&nbsp;)</b>,
<b>supportsANSI92IntermediateSQL(&nbsp;)</b>, <b>supportsLimitedOuterJoins(&nbsp;)</b>,
and so on. What’s this all about?</span></p>

<p class=MsoNormal><span lang=EN-US>As mentioned earlier, databases have seemed
from their inception to be in a constant state of turmoil, primarily because
the demand for database applications, and thus database tools, is so great.
Only recently has there been any convergence on the common language of SQL (and
there are plenty of other database languages in common use). But even with an
SQL “standard” there are so many variations on that theme that JDBC must
provide the large <b>DatabaseMetaData</b> interface so that your code can
discover the capabilities of the particular “standard” SQL database that it’s
currently connected to. In short, you can write simple, transportable SQL, but
if you want to optimize speed your coding will multiply tremendously as you
investigate the capabilities of a particular vendor’s database.</span></p>

<p class=MsoNormal><span lang=EN-US>This, of course, is not Java’s fault. The
discrepancies between database products are just something that JDBC tries to help
compensate for. But bear in mind that your life will be easier if you can
either write generic queries and not worry quite as much about performance, or,
if you must tune for performance, know the platform you’re writing for so you
don’t need to write all that investigation code.</span></p>

<h3><a name="_Toc463665181"></a><a name="_Toc481064878"><span lang=EN-US>A more
sophisticated example</span></a></h3>

<p class=MsoNormal><span lang=EN-US>A more interesting example</span><a
href="#_ftn73" name="_ftnref73" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[73]</span></span></span></span></a><span
lang=EN-US> involves a multitable database that resides on a server. Here, the
database is meant to provide a repository for community activities and to allow
people to sign up for these events, so it is called the <i>Community Interests
Database </i>(CID). This example will only provide an overview of the database
and its implementation, and is not intended to be an in-depth tutorial on
database development. There are numerous books, seminars, and software packages
that will help you in the design and development of a database.</span></p>

<p class=MsoNormal><span lang=EN-US>In addition, this example presumes the
prior installation of an SQL database on a server (although it could also be
run on a local machine), and the interrogation and discovery of an appropriate
JDBC driver for that database. Several free SQL databases are available, and
some are even automatically installed with various flavors of Linux. You are
responsible for making the choice of database and locating the JDBC driver; the
example here is based on an SQL database system called “Cloudscape.”</span></p>

<p class=MsoNormal><span lang=EN-US>To keep changes in the connection
information simple, the database driver, database URL, user name, and password
are placed in a separate class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:jdbc:CIDConnect.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Database connection
information for</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// the community
interests database (CID).</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class CIDConnect
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // All the information
specific to CloudScape:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static String
dbDriver = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;COM.cloudscape.core.JDBCDriver&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static String
dbURL =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
&quot;jdbc:cloudscape:d:/docs/_work/JSapienDB&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static String
user = &quot;&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static String
password = &quot;&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In this example, there is no password
protection on the database so the user name and password are empty strings. </span></p>

<p class=MsoNormal><span lang=EN-US>The database consists of a set of tables
that have a structure as shown here: </span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=289 height=308 src="TIJ2_files/image031.png"></span></p>

<p class=MsoNormal><span lang=EN-US>“Members” contains community member
information, “Events” and “Locations” contain information about the activities
and where they take place, and “Evtmems” connects events and members that would
like to attend that event. You can see that a data member in one table produces
a key in another table.</span></p>

<p class=MsoNormal><span lang=EN-US>The following class contains the SQL
strings that will create these database tables (refer to an SQL guide for an
explanation of the SQL code):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c15:jdbc:CIDSQL.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// SQL strings to create
the tables for the CID.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class CIDSQL {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static String[]
sql = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Create the
MEMBERS table:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;drop table
MEMBERS&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;create table
MEMBERS &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;(MEM_ID
INTEGER primary key, &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;MEM_UNAME
VARCHAR(12) not null unique, &quot;+</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;MEM_LNAME
VARCHAR(40), &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;MEM_FNAME
VARCHAR(20), &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;ADDRESS
VARCHAR(40), &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;CITY
VARCHAR(20), &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;STATE CHAR(4),
&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;ZIP CHAR(5),
&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;PHONE CHAR(12),
&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;EMAIL
VARCHAR(30))&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;create unique
index &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;LNAME_IDX on
MEMBERS(MEM_LNAME)&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Create the EVENTS
table</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;drop table
EVENTS&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;create table
EVENTS &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;(EVT_ID
INTEGER primary key, &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;EVT_TITLE
VARCHAR(30) not null, &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;EVT_TYPE
VARCHAR(20), &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;LOC_ID
INTEGER, &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;PRICE DECIMAL,
&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;DATETIME
TIMESTAMP)&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;create unique
index &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;TITLE_IDX on
EVENTS(EVT_TITLE)&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Create the
EVTMEMS table</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;drop table
EVTMEMS&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;create table
EVTMEMS &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;(MEM_ID
INTEGER not null, &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;EVT_ID INTEGER
not null, &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;MEM_ORD
INTEGER)&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;create unique
index &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;EVTMEM_IDX on
EVTMEMS(MEM_ID, EVT_ID)&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Create the
LOCATIONS table</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;drop table
LOCATIONS&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;create table
LOCATIONS &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;(LOC_ID
INTEGER primary key, &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;LOC_NAME
VARCHAR(30) not null, &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;CONTACT
VARCHAR(50), &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;ADDRESS
VARCHAR(40), &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;CITY
VARCHAR(20), &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;STATE
VARCHAR(4), &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;ZIP
VARCHAR(5), &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;PHONE CHAR(12),
&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;DIRECTIONS
VARCHAR(4096))&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;create unique
index &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;NAME_IDX on
LOCATIONS(LOC_NAME)&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The following program uses the <b>CIDConnect
</b> and <b>CIDSQL</b> information to load the JDBC driver, make a connection
to the database, and then create the table structure diagrammed above. To
connect with the database, you call the <b>static</b> method <b>DriverManager.getConnection(&nbsp;)</b>,
passing it the database URL, the user name, and a password to get into the
database. You get back a <b>Connection</b> object that you can use to query and
manipulate the database. Once the connection is made you can simply push the
SQL to the database, in this case by marching through the <b>CIDSQL</b> array.
However, the first time this program is run, the “drop table” command will fail,
causing an exception, which is caught, reported, and then ignored. The reason
for the “drop table” command is to allow easy experimentation: you can modify
the SQL that defines the tables and then rerun the program, causing the old
tables to be replaced by the new.</span></p>

<p class=MsoNormal><span lang=EN-US>In this example, it makes sense to let the
exceptions be thrown out to the console:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:jdbc:CIDCreateTables.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creates database
tables for the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// community interests
database.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.sql.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
CIDCreateTables {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws SQLException,
ClassNotFoundException,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  IllegalAccessException
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Load the driver
(registers itself)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
Class.forName(CIDConnect.dbDriver);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Connection c =
DriverManager.getConnection(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      CIDConnect.dbURL,
CIDConnect.user, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
CIDConnect.password);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Statement s =
c.createStatement();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; CIDSQL.sql.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(CIDSQL.sql[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
s.executeUpdate(CIDSQL.sql[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      } catch(SQLException
sqlEx) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot;Probably
a 'drop table' failed&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that all changes in the database can
be controlled by changing <b>String</b>s in the <b>CIDSQL</b> table, without
modifying <b>CIDCreateTables</b>.</span></p>

<p class=MsoNormal><b><span lang=EN-US>executeUpdate(&nbsp;)</span></b><span
lang=EN-US> will usually return the number of rows that were affected by the
SQL statement. <b>executeUpdate(&nbsp;)</b> is more commonly used to execute </span><span
lang=EN-US style='font-family:"Courier New"'>INSERT</span><span lang=EN-US>, </span><span
lang=EN-US style='font-family:"Courier New"'>UPDATE</span><span lang=EN-US>, or
</span><span lang=EN-US style='font-family:"Courier New"'>DELETE</span><span
lang=EN-US> statements that modify one or more rows. For statements such as </span><span
lang=EN-US style='font-family:"Courier New"'>CREATE TABLE</span><span
lang=EN-US>, </span><span lang=EN-US style='font-family:"Courier New"'>DROP
TABLE</span><span lang=EN-US>, and </span><span lang=EN-US style='font-family:
"Courier New"'>CREATE INDEX</span><span lang=EN-US>, <b>executeUpdate(&nbsp;)</b>
always returns zero.</span></p>

<p class=MsoNormal><span lang=EN-US>To test the database, it is loaded with
some sample data. This requires a series of </span><span lang=EN-US
style='font-family:"Courier New"'>INSERT</span><span lang=EN-US>s followed by a
</span><span lang=EN-US style='font-family:"Courier New"'>SELECT</span><span
lang=EN-US> to produce result set. To make additions and changes to the test
data easy, the test data is set up as a two-dimensional array of <b>Object</b>s,
and the <b>executeInsert(&nbsp;)</b> method can then use the information in one
row of the table to create the appropriate SQL command.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c15:jdbc:LoadDB.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Loads and tests the
database.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.sql.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class TestSet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Object[][] data = {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;MEMBERS&quot;, new Integer(1),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;dbartlett&quot;, &quot;Bartlett&quot;, &quot;David&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;123
Mockingbird Lane&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;Gettysburg&quot;, &quot;PA&quot;, &quot;19312&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;123.456.7890&quot;,  &quot;bart@you.net&quot; },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    { &quot;MEMBERS&quot;,
new Integer(2),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;beckel&quot;, &quot;Eckel&quot;, &quot;Bruce&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;123 Over
Rainbow Lane&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Crested
Butte&quot;, &quot;CO&quot;, &quot;81224&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;123.456.7890&quot;, &quot;beckel@you.net&quot; },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;MEMBERS&quot;, new Integer(3),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;rcastaneda&quot;, &quot;Castaneda&quot;, &quot;Robert&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;123 Downunder
Lane&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;Sydney&quot;, &quot;NSW&quot;, &quot;12345&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;123.456.7890&quot;, &quot;rcastaneda@you.net&quot; },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;LOCATIONS&quot;, new Integer(1),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Center for
Arts&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Betty
Wright&quot;, &quot;123 Elk Ave.&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Crested
Butte&quot;, &quot;CO&quot;, &quot;81224&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;123.456.7890&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Go this way
then that.&quot; },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;LOCATIONS&quot;, new Integer(2),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Witts End
Conference Center&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;John
Wittig&quot;, &quot;123 Music Drive&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;Zoneville&quot;, &quot;PA&quot;, &quot;19123&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;123.456.7890&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Go that way
then this.&quot; },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;EVENTS&quot;, new Integer(1),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Project
Management Myths&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Software
Development&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(1),
new Float(2.50),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;2000-07-17
19:30:00&quot; },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;EVENTS&quot;, new Integer(2),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Life of the
Crested Dog&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;Archeology&quot;,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(2),
new Float(0.00),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;2000-07-19
19:00:00&quot; },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Match some people
with events</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    { 
&quot;EVTMEMS&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(1), 
// Dave is going to</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(1), 
// the Software event.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(0) },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;EVTMEMS&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(2), 
// Bruce is going to</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(2), 
// the Archeology event.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(0) },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;EVTMEMS&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(3), 
// Robert is going to</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(1), 
// the Software event.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(1) },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    {
&quot;EVTMEMS&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(3), //
... and </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(2), //
the Archeology event.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new Integer(1) },</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Use the default
data set:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public TestSet() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Use a different
data set:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
TestSet(Object[][] dat) { data = dat; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class LoadDB {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Statement statement;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Connection connection;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  TestSet tset;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public LoadDB(TestSet
t) throws SQLException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    tset = t;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Load the driver
(registers itself)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
Class.forName(CIDConnect.dbDriver);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(java.lang.ClassNotFoundException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    connection =
DriverManager.getConnection(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      CIDConnect.dbURL,
CIDConnect.user, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
CIDConnect.password);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    statement =
connection.createStatement();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void cleanup()
throws SQLException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    statement.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    connection.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
executeInsert(Object[] data) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String sql =
&quot;insert into &quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      + data[0] + &quot;
values(&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 1; i
&lt; data.length; i++) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(data[i]
instanceof String)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sql +=
&quot;'&quot; + data[i] + &quot;'&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      else</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sql += data[i];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      if(i &lt;
data.length - 1)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sql += &quot;,
&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sql += ')';</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(sql);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
statement.executeUpdate(sql);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } catch(SQLException
sqlEx) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      System.err.println(&quot;Insert
failed.&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while (sqlEx !=
null) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(sqlEx.toString());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        sqlEx =
sqlEx.getNextException();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void load() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i&lt;
tset.data.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      executeInsert(tset.data[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Throw exceptions
out to console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws SQLException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    LoadDB db = new
LoadDB(new TestSet());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    db.load();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // Get a ResultSet
from the loaded database:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ResultSet rs =
db.statement.executeQuery(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;select
&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
&quot;e.EVT_TITLE, m.MEM_LNAME, m.MEM_FNAME &quot;+</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;from
EVENTS e, MEMBERS m, EVTMEMS em &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;where
em.EVT_ID = 2 &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;and
e.EVT_ID = em.EVT_ID &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;and
m.MEM_ID = em.MEM_ID&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      while (rs.next())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
rs.getString(1) + &quot;  &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
rs.getString(2) + &quot;, &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
rs.getString(3));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } finally {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      db.cleanup();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>TestSet</b> class contains a default
set of data that is produced if you use the default constructor; however, you
can also create a <b>TestSet</b> object using an alternate data set with the
second constructor. The set of data is held in a two-dimensional array of <b>Object</b>
because it can be any type, including <b>String</b> or numerical types. The <b>executeInsert(&nbsp;)</b>
method uses RTTI to distinguish between <b>String</b> data (which must be
quoted) and non-<b>String</b> data as it builds the SQL command from the data.
After printing this command to the console, <b>executeUpdate(&nbsp;)</b> is used
to send it to the database.</span></p>

<p class=MsoNormal><span lang=EN-US>The constructor for <b>LoadDB</b> makes the
connection, and <b>load(&nbsp;)</b> steps through the data and calls <b>executeInsert(&nbsp;)</b>
for each record. <b>cleanup(&nbsp;)</b>  closes the statement and the
connection; to guarantee that this is called, it is placed inside a finally
clause.</span></p>

<p class=MsoNormal><span lang=EN-US>Once the database is loaded, an <b>executeQuery(&nbsp;)</b>
statement produces a sample result set. Since the query combines several
tables, it is an example of a join.</span></p>

<p class=MsoNormal><span lang=EN-US>There is more JDBC information available in
the electronic documents that come as part of the Java distribution from Sun.
In addition, you can find more in the book <i>JDBC Database Access with Java </i>(Hamilton,
Cattel, and Fisher, Addison-Wesley, 1997). Other JDBC books appear regularly.</span></p>

<h2><a name="_Toc481064879"><span lang=EN-US>Servlets</span></a></h2>

<p class=MsoNormal><a name="_Toc463665192"></a><span
lang=EN-US>Client access from the Internet or corporate intranets is a sure way
to allow many users to access data and resources easily</span><a href="#_ftn74"
name="_ftnref74" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[74]</span></span></span></span></a><span
lang=EN-US>. This type of access is based on clients using the World Wide Web
standards of Hypertext Markup Language (HTML) and Hypertext Transfer Protocol
(HTTP). The Servlet API set abstracts a common solution framework for
responding to HTTP requests. </span></p>

<p class=MsoNormal><span lang=EN-US>Traditionally, the way to handle a problem
such as allowing an Internet client to update a database is to create an </span><span lang=EN-US>HTML page with text fields and a “submit” button. The user types the
appropriate information into the text fields and presses the “submit” button.
The data is submitted along with a URL that tells the server what to do with
the data by specifying the location of a </span><span lang=EN-US>Common Gateway Interface (CGI) program that the server runs,
providing the program with the data as it is invoked. The CGI program is typically
written in Perl, Python, C, C++, or any language that can read from standard
input and write to standard output. That’s all that is provided by the Web
server: the CGI program is invoked, and standard streams (or, optionally for
input, an environment variable) are used for input and output. The CGI program
is responsible for everything else. First it looks at the data and decides
whether the format is correct. If not, the CGI program must produce HTML to
describe the problem; this page is handed to the Web server (via standard
output from the CGI program), which sends it back to the user. The user must
usually back up a page and try again. If the data is correct, the CGI program
processes the data in an appropriate way, perhaps adding it to a database. It
must then produce an appropriate HTML page for the Web server to return to the
user.</span></p>

<p class=MsoNormal><span lang=EN-US>It would be ideal to go to a completely
Java-based solution to this problem—an applet on the client side to validate
and send the data, and a servlet on the server side to receive and process the
data. Unfortunately, although applets are a proven technology with plenty of
support, they have been problematic to use on the Web because you cannot rely
on a particular version of Java being available on a client’s Web browser; in
fact, you can’t rely on a Web browser supporting Java at all! In an intranet,
you can require that certain support be available, which allows a lot more
flexibility in what you can do, but on the Web the safest approach is to handle
all the processing on the server side and deliver plain HTML to the client.
That way, no client will be denied the use of your site because they do not
have the proper software installed.</span></p>

<p class=MsoNormal><span lang=EN-US>Because servlets provide an excellent
solution for server-side programming support, they are one of the most popular
reasons for moving to Java. Not only do they provide a framework that replaces
CGI programming (and eliminates a number of thorny CGI problems), but all your
code has the platform portability gained from using Java, and you have access
to all the Java APIs (except, of course, the ones that produce GUIs, like
Swing).</span></p>

<h3><a name="_Toc481064880"><span lang=EN-US>The basic servlet</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The architecture of the servlet API is that
of a classic service provider with a <b>service(&nbsp;)</b> method through which
all client requests will be sent by the servlet container software, and life
cycle methods <b>init(&nbsp;) </b>and <b>destroy(&nbsp;)</b>, which are called
only when the servlet is loaded and unloaded (this happens rarely).</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface Servlet
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
init(ServletConfig config)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throws
ServletException;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public ServletConfig
getServletConfig();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
service(ServletRequest req,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ServletResponse res)
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throws
ServletException, IOException;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
getServletInfo();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void destroy();</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>getServletConfig(&nbsp;)</span></b><span
lang=EN-US>’s sole purpose is to return a <b>ServletConfig</b> object that
contains initialization and startup parameters for this servlet. <b>getServletInfo(&nbsp;)</b>
returns a string containing information about the servlet, such as author,
version, and copyright.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>GenericServlet</b> class is a shell
implementation of this interface and is typically not used. The <b>HttpServlet</b>
class is an extension of <b>GenericServlet</b> and is designed specifically to
handle the HTTP protocol—<b> HttpServlet</b> is the one that you’ll use most of
the time.</span></p>

<p class=MsoNormal><span lang=EN-US>The most convenient attribute of the
servlet API is the auxiliary objects that come along with the HttpServlet class
to support it. If you look at the <b>service(&nbsp;) </b>method in the <b>Servlet</b>
interface, you’ll see it has two parameters: <b>ServletRequest</b> and <b>ServletResponse</b>.
With the <b>HttpServlet</b> class these two object are extended for HTTP: <b>HttpServletRequest</b>
and <b>HttpServletResponse</b>. Here’s a simple example that shows the use of <b>HttpServletResponse</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:servlets:ServletsRule.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.servlet.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.servlet.http.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ServletsRule extends HttpServlet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i = 0; // Servlet
&quot;persistence&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
service(HttpServletRequest req, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  HttpServletResponse
res) throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    res.setContentType(&quot;text/html&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PrintWriter out =
res.getWriter();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.print(&quot;&lt;HEAD&gt;&lt;TITLE&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.print(&quot;A
server-side strategy&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.print(&quot;&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.print(&quot;&lt;h1&gt;Servlets Rule! &quot; + i++);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.print(&quot;&lt;/h1&gt;&lt;/BODY&gt;&quot;);  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.close();    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>ServletsRule</span></b><span lang=EN-US>
is about as simple as a servlet can get. The servlet is initialized only once
by calling its <b>init(&nbsp;) </b>method, on loading the servlet after the
servlet container is first booted up. When a client makes a request to a URL that
happens to represent a servlet, the servlet container intercepts this request
and makes a call to the <b>service(&nbsp;)</b> method, after setting up the <b>HttpServletRequest</b>
and <b>HttpServletResponse</b> objects. </span></p>

<p class=MsoNormal><span lang=EN-US>The main responsibility of the <b>service(&nbsp;)</b>
method is to interact with the HTTP request that the client has sent, and to
build an HTTP response based on the attributes contained within the request. <b>ServletsRule</b>
only manipulates the response object without looking at what the client may
have sent. </span></p>

<p class=MsoNormal><span lang=EN-US>After setting the content type of the
response (which must always be done before the <b>Writer </b>or <b>OutputStream
</b>is procured), the <b>getWriter(&nbsp;)</b> method of the response object
produces a <b>PrintWriter</b> object, which is used for writing character-based
response data (alternatively, <b>getOutputStream(&nbsp;)</b> produces an <b>OutputStream</b>,
used for binary response, which is only utilized in more specialized
solutions).</span></p>

<p class=MsoNormal><span lang=EN-US>The rest of the program simply sends HTML
back to the client (it’s assumed you understand HTML, so that part is not
explained) as a sequence of <b>String</b>s. However, notice the inclusion of
the “hit counter” represented by the variable <b>i</b>. This is automatically
converted to a <b>String</b> in the <b>print(&nbsp;)</b> statement.</span></p>

<p class=MsoNormal><span lang=EN-US>When you run the program, you’ll notice
that the value of <b>i</b> is retained between requests to the servlet. This is
an essential property of servlets: since only one servlet of a particular class
is loaded into the container, and it is never unloaded (unless the servlet
container is terminated, which is something that only normally happens if you
reboot the server computer), any fields of that servlet class effectively
become persistent objects! This means that you can effortlessly maintain values
between servlet requests, whereas with CGI you had to write values to disk in
order to preserve them, which required a fair amount of fooling around to get
it right, and resulted in a non-cross-platform solution.</span></p>

<p class=MsoNormal><span lang=EN-US>Of course, sometimes the Web server, and
thus the servlet container, must be rebooted as part of maintenance or during a
power failure. To avoid losing any persistent information, the servlet’s <b>init(&nbsp;)</b>
and <b>destroy(&nbsp;)</b> methods are automatically called whenever the
servlet is loaded or unloaded, giving you the opportunity to save data during
shutdown, and restore it after rebooting. The servlet container calls the <b>destroy(&nbsp;)</b>
method as it is terminating itself, so you always get an opportunity to save
valuable data as long as the server machine is configured in an intelligent
way.</span></p>

<p class=MsoNormal><span lang=EN-US>There’s one other issue when using <b>HttpServlet</b>.
This class provides <b>doGet(&nbsp;)</b> and <b>doPost(&nbsp;)</b> methods that
differentiate between a CGI “GET” submission from the client, and a CGI “POST.”
GET and POST vary only in the details of the way that they submit the data,
which is something that I personally would prefer to ignore. However, most
published information that I’ve seen seems to favor the creation of separate <b>doGet(&nbsp;)</b>
and <b>doPost(&nbsp;)</b> methods instead of a single generic <b>service(&nbsp;)</b>
method, which handles both cases. This favoritism seems quite common, but I’ve
never seen it explained in a fashion that leads me to believe that it’s
anything more than inertia from CGI programmers who are used to paying
attention to whether a GET or POST is being used. So in the spirit of “doing
the simplest thing that could possibly work,”</span><a href="#_ftn75"
name="_ftnref75" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[75]</span></span></span></span></a><span
lang=EN-US> I will just use the <b>service(&nbsp;)</b> method in these
examples, and let it care about GETs vs. POSTs. However, keep in mind that I
might have missed something and so there may in fact be a good reason to use <b>doGet(&nbsp;)</b>
and <b>doPost(&nbsp;)</b> instead.</span></p>

<p class=MsoNormal><span lang=EN-US>Whenever a form is submitted to a servlet,
the <b>HttpServletRequest</b> comes preloaded with all the form data, stored as
key-value pairs. If you know the names of the fields, you can just use them
directly with the <b>getParameter(&nbsp;)</b> method to look up the values. You
can also get an <b>Enumeration</b> (the old form of the <b>Iterator</b>) to the
field names, as is shown in the following example. This example also
demonstrates how a single servlet can be used to produce the page that contains
the form, and to respond to the page (a better solution will be seen later,
with JSPs). If the <b>Enumeration</b> is empty, there are no fields; this means
no form was submitted. In this case, the form is produced, and the submit
button will re-call the same servlet. If fields do exist, however, they are
displayed.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: c15:servlets:EchoForm.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Dumps the name-value
pairs of any HTML form</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.servlet.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.servlet.http.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class EchoForm
extends HttpServlet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
service(HttpServletRequest req, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    HttpServletResponse
res) throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
res.setContentType(&quot;text/html&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PrintWriter out =
res.getWriter();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Enumeration flds =
req.getParameterNames();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
if(!flds.hasMoreElements()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // No form
submitted -- create one:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      out.print(&quot;&lt;html&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
out.print(&quot;&lt;form method=\&quot;POST\&quot;&quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        &quot;
action=\&quot;EchoForm\&quot;&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
out.print(&quot;&lt;b&gt;Field&quot; + i + &quot;&lt;/b&gt; &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
&quot;&lt;input type=\&quot;text\&quot;&quot;+</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot;
size=\&quot;20\&quot; name=\&quot;Field&quot; + i + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          &quot;\&quot;
value=\&quot;Value&quot; + i + &quot;\&quot;&gt;&lt;br&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
out.print(&quot;&lt;INPUT TYPE=submit name=submit&quot;+</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;
Value=\&quot;Submit\&quot;&gt;&lt;/form&gt;&lt;/html&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    } else {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
out.print(&quot;&lt;h1&gt;Your form contained:&lt;/h1&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
while(flds.hasMoreElements()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String field=
(String)flds.nextElement();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        String value=
req.getParameter(field);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        out.print(field
+ &quot; = &quot; + value+ &quot;&lt;br&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.close();    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>One drawback you’ll notice here is that
Java does not seem to be designed with string processing in mind—the formatting
of the return page is painful because of line breaks, escaping quote marks, and
the “+” signs necessary to build <b>String</b> objects. With a larger HTML page
it becomes unreasonable to code it directly into Java. One solution is to keep
the page as a separate text file, then open it and hand it to the Web server.
If you have to perform any kind of substitution to the contents of the page,
it’s not much better since Java has treated string processing so poorly. In
these cases you’re probably better off using a more appropriate solution
(Python would be my choice; there’s a version that embeds itself in Java called
JPython) to generate the response page.</span></p>

<h3><a name="_Toc481064881"><span lang=EN-US>Servlets and multithreading</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The servlet container has a pool of threads
that it will dispatch to handle client requests. It is quite likely that two
clients arriving at the same time could be processing through your <b>service(&nbsp;)</b>
at the same time. Therefore the <b>service(&nbsp;)</b> method must written in a
thread-safe manner. Any access to common resources (files, databases) will need
to be guarded by using the <b>synchronized</b> keyword.</span></p>

<p class=MsoNormal><span lang=EN-US>The following simple example puts a <b>synchronized
</b>clause around the thread’s <b>sleep(&nbsp;)</b> method. This will block all
other threads until the allotted time (five seconds) is all used up. When
testing this you should start several browser instances and hit this servlet as
quickly as possible in each one—you’ll see that each one has to wait until its
turn comes up. </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:servlets:ThreadServlet.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.servlet.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.servlet.http.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ThreadServlet extends HttpServlet {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
service(HttpServletRequest req, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    HttpServletResponse
res) throws IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
res.setContentType(&quot;text/html&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PrintWriter out =
res.getWriter();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    synchronized(this) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
Thread.currentThread().sleep(5000);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(InterruptedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Interrupted&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.print(&quot;&lt;h1&gt;Finished &quot; + i++ + &quot;&lt;/h1&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.close();    </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It is also possible to synchronize the
entire servlet by putting the <b>synchronized</b> keyword in front of the <b>service(&nbsp;)</b>
method. In fact, the only reason to use the <b>synchronized</b> clause instead
is if the critical section is in an execution path that might not get executed.
In that case, you might as well avoid the overhead of synchronizing every time
by using a <b>synchronized</b> clause. Otherwise, all the threads will have to
wait anyway so you might as well <b>synchronize</b> the whole method.</span></p>

<h3><a name="_Toc481064882"><span lang=EN-US>Handling sessions with servlets</span></a></h3>

<p class=MsoNormal><span lang=EN-US>HTTP is a “sessionless” protocol, so you cannot tell from one server
hit to another if you’ve got the same person repeatedly querying your site, or
if it is a completely different person.  A great deal of effort has gone into
mechanisms that will allow Web developers to track sessions. Companies could
not do e-commerce without keeping track of a client and the items they have put
into their shopping cart, for example.</span></p>

<p class=MsoNormal><span lang=EN-US>There are several methods of session
tracking, but the most common method is with persistent “cookies,” which are an
integral part of the Internet standards. The HTTP Working Group of the Internet
Engineering Task Force has written </span><span
lang=EN-US>cookies into the official standard in RFC 2109 (<i>ds.internic.net/rfc/rfc2109.txt</i>
or check <i>www.cookiecentral.com</i>).</span></p>

<p class=MsoNormal><span lang=EN-US>A cookie is nothing more than a small piece
of information sent by a Web server to a browser. The browser stores the cookie
on the local disk, and whenever another call is made to the URL that the cookie
is associated with, the cookie is quietly sent along with the call, thus
providing the desired information back to that server (generally, providing
some way that the server can be told that it’s you calling). Clients can,
however, turn off the browser’s ability to accept cookies. If your site must
track a client who has turned off cookies, then another method of session
tracking (URL rewriting or hidden form fields) must be incorporated by hand,
since the session tracking capabilities built into the servlet API are designed
around cookies.</span></p>

<h4><span lang=EN-US>The <b>Cookie</b> class</span></h4>

<p class=MsoNormal><span lang=EN-US>The servlet API (version 2.0 and up)
provides the <b>Cookie</b> class. This class incorporates all the HTTP header
details and allows the setting of various cookie attributes. Using the cookie
is simply a matter of adding it to the response object. The constructor takes a
cookie name as the first argument and a value as the second. Cookies are added
to the response object before you send any content.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Cookie oreo = new
Cookie(&quot;TIJava&quot;, &quot;2000&quot;);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>res.addCookie(cookie);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Cookies are recovered by calling the <b>getCookies(&nbsp;)</b>
method of the <b>HttpServletRequest</b> object, which returns an array of
cookie objects.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Cookie[] cookies =
req.getCookies();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can then call <b>getValue(&nbsp;)</b>
for each cookie, to produce a <b>String</b> containing the cookie contents. In
the above example, <b>getValue(&quot;TIJava&quot;) </b>will produce a <b>String</b>
containing “2000.”</span></p>

<h4><span lang=EN-US>The <b>Session</b> class</span></h4>

<p class=MsoNormal><span lang=EN-US>A session is one or more page requests by a
client to a Web site during a defined period of time. If you buy groceries
online, for example, you want a session to be confined to the period from when
you first add an item to “my shopping cart” to the point where you check out.
Each item you add to the shopping cart will result in a new HTTP connection,
which has no knowledge of previous connections or items in the shopping cart.
To compensate for this lack of information, the mechanics supplied by the
cookie specification allow your servlet to perform session tracking. </span></p>

<p class=MsoNormal><span lang=EN-US>A servlet <b>Session</b> object lives on
the server side of the communication channel; its goal is to capture useful
data about this client as the client moves through and interacts with your Web
site. This data may be pertinent for the present session, such as items in the
shopping cart, or it may be data such as authentication information that was
entered when the client first entered your Web site, and which should not have
to be reentered during a particular set of transactions.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Session</b> class of the servlet API
uses the <b>Cookie</b> class to do its work. However, all the <b>Session</b>
object needs is some kind of unique identifier stored on the client and passed
to the server. Web sites may also use the other types of session tracking but
these mechanisms will be more difficult to implement as they are not
encapsulated into the servlet API (that is, you must write them by hand to deal
with the situation when the client has disabled cookies).</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example that  implements session
tracking with the servlet API:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:servlets:SessionPeek.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Using the HttpSession
class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.servlet.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
javax.servlet.http.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class SessionPeek
extends HttpServlet { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
service(HttpServletRequest req, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  HttpServletResponse
res)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws
ServletException, IOException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Retrieve Session
Object before any</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // output is sent to
the client.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    HttpSession session
= req.getSession();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
res.setContentType(&quot;text/html&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PrintWriter out =
res.getWriter();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;&lt;HEAD&gt;&lt;TITLE&gt; SessionPeek &quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.println(&quot;
&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;&lt;h1&gt; SessionPeek &lt;/h1&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // A simple hit
counter for this session.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer ival =
(Integer) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
session.getAttribute(&quot;sesspeek.cntr&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(ival==null) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ival = new
Integer(1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ival = new
Integer(ival.intValue() + 1);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
session.setAttribute(&quot;sesspeek.cntr&quot;, ival);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;You have hit this page &lt;b&gt;&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      + ival +
&quot;&lt;/b&gt; times.&lt;p&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;&lt;h2&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;Saved Session Data &lt;/h2&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Loop through all
data in the session:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Enumeration sesNames
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
session.getAttributeNames();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(sesNames.hasMoreElements())
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String name = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
sesNames.nextElement().toString();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Object value =
session.getAttribute(name);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      out.println(name +
&quot; = &quot; + value + &quot;&lt;br&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;&lt;h3&gt; Session Statistics &lt;/h3&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.println(&quot;Session
ID: &quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      + session.getId()
+ &quot;&lt;br&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;New Session: &quot; + session.isNew()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
&quot;&lt;br&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;Creation Time: &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
session.getCreationTime());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;&lt;I&gt;(&quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Date(session.getCreationTime())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
&quot;)&lt;/I&gt;&lt;br&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;Last Accessed Time: &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
session.getLastAccessedTime());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;&lt;I&gt;(&quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
Date(session.getLastAccessedTime())</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
&quot;)&lt;/I&gt;&lt;br&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;Session Inactive Interval: &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      + session.getMaxInactiveInterval());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;Session ID in Request: &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
req.getRequestedSessionId() + &quot;&lt;br&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.println(&quot;Is
session id from Cookie: &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
req.isRequestedSessionIdFromCookie()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
&quot;&lt;br&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.println(&quot;Is
session id from URL: &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
req.isRequestedSessionIdFromURL()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
&quot;&lt;br&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.println(&quot;Is
session id valid: &quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
req.isRequestedSessionIdValid()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      +
&quot;&lt;br&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
out.println(&quot;&lt;/BODY&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    out.close();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
getServletInfo() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return &quot;A
session tracking servlet&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Inside the <b>service(&nbsp;)</b> method, <b>getSession(&nbsp;)</b>
is called for the request object, which returns the <b>Session</b> object
associated with this request. The <b>Session</b> object does not travel across
the network, but instead it lives on the server and is associated with a client
and its requests.</span></p>

<p class=MsoNormal><b><span lang=EN-US>getSession(&nbsp;)</span></b><span
lang=EN-US> comes in two versions: no parameter, as used here, and <b>getSession(boolean)</b>.
<b>getSession(true)</b> is equivalent to <b>getSession(&nbsp;)</b>. The only
reason for the <b>boolean</b> is to state whether you want the session object
created if it is not found. <b>getSession(true)</b> is the most likely call,
hence <b>getSession(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Session</b> object, if it is not
new, will give us details about the client from previous visits. If the <b>Session</b>
object is new then the program will start to gather information about this
client’s activities on this visit. Capturing this client information is done
through the <b>setAttribute(&nbsp;)</b> and <b>getAttribute(&nbsp;)</b> methods
of the session object.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>java.lang.Object
getAttribute(java.lang.String)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>void
setAttribute(java.lang.String name,</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>                 
java.lang.Object value)</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Session</b> object uses a simple
name-value pairing for loading information. The name is a <b>String</b>, and
the value can be any object derived from <b>java.lang.Object</b>. <b>SessionPeek</b>
keeps track of how many times the client has been back during this session.
This is done with an <b>Integer</b> object named <b>sesspeek.cntr</b>. If the
name is not found an <b>Integer</b> is created with value of one, otherwise an <b>Integer</b>
is created with the incremented value of the previously held <b>Integer</b>.
The new <b>Integer</b> is placed into the <b>Session</b> object. If you use
same key in a <b>setAttribute(&nbsp;)</b> call, then the new object overwrites
the old one. The incremented counter is used to display the number of times
that the client has visited during this session. </span></p>

<p class=MsoNormal><b><span lang=EN-US>getAttributeNames(&nbsp;) </span></b><span
lang=EN-US>is related to <b>getAttribute(&nbsp;)</b> and <b>setAttribute(&nbsp;)</b>;
it returns an enumeration of the names of the objects that are bound to the <b>Session</b>
object. A <b>while</b> loop in <b>SessionPeek</b> shows this method in action.</span></p>

<p class=MsoNormal><span lang=EN-US>You may wonder how long a <b>Session</b>
object hangs around. The answer depends on the servlet container you are using;
they usually default to 30 minutes (1800 seconds), which is what you should see
from the <b>ServletPeek</b> call to <b>getMaxInactiveInterval(&nbsp;)</b>. Tests
seem to produce mixed results between servlet containers. Sometimes the <b>Session</b>
object can hang around overnight, but I have never seen a case where the <b>Session</b>
object disappears in less than the time specified by the inactive interval. You
can try this by setting the inactive interval with <b>setMaxInactiveInterval(&nbsp;)</b>
to 5 seconds and see if your <b>Session</b> object hangs around or if it is
cleaned up at the appropriate time. This may be an attribute you will want to
investigate while choosing a servlet container.</span></p>

<h3><a name="_Toc481064883"><span lang=EN-US>Running the servlet examples</span></a></h3>

<p class=MsoNormal><span lang=EN-US>If you are not already working with an
application server that handles Sun’s servlet and JSP technologies for you, you
may download the </span><span lang=EN-US>Tomcat implementation of Java servlets and JSPs, which is a free,
open-source implementation of servlets, and is the official reference
implementation sanctioned by Sun. It can be found at <i>jakarta.apache.org</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>Follow the instructions for installing the
Tomcat implementation, then edit the <b>server.xml </b>file to point to the
location in your directory tree where your servlets will be placed. Once you
start up the Tomcat program you can test your servlet programs.</span></p>

<p class=MsoNormal><span lang=EN-US>This has only been a brief introduction to
servlets; there are entire books on the subject. However, this introduction
should give you enough ideas to get you started. In addition, many of the ideas
in the next section are backward compatible with servlets.</span></p>

<h2><a name="_Toc481064884"></a><a name="_Toc463665186"><span lang=EN-US>Java
Server Pages</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Java Server Pages (JSP) is a standard Java
extension that is defined on top of the servlet Extensions. The goal of JSPs is
the simplified creation and management of dynamic Web pages.</span></p>

<p class=MsoNormal><span lang=EN-US>The previously mentioned, freely available
Tomcat reference implementation from <i>jakarta.apache.org</i> automatically
supports JSPs.</span></p>

<p class=MsoNormal><span lang=EN-US>JSPs allow you to combine the HTML of a Web
page with pieces of Java code in the same document. The Java code is surrounded
by special tags that tell the JSP container that it should use the code to
generate a servlet, or part of one. The benefit of JSPs is that you can
maintain a single document that represents both the page and the Java code that
enables it. The downside is that the maintainer of the JSP page must be skilled
in both HTML and Java (however, GUI builder environments for JSPs should be
forthcoming).</span></p>

<p class=MsoNormal><span lang=EN-US>The first time a JSP is loaded by the JSP
container (which is typically associated with, or even part of, a Web server),
the servlet code necessary to fulfill the JSP tags is automatically generated,
compiled, and loaded into the servlet container. The static portions of the
HTML page are produced by sending static <b>String </b>objects to <b>write(&nbsp;)</b>.
The dynamic portions are included directly into the servlet.</span></p>

<p class=MsoNormal><span lang=EN-US>From then on, as long as the JSP source for
the page is not modified, it behaves as if it were a static HTML page with
associated servlets (all the HTML code is actually generated by the servlet,
however). If you modify the source code for the JSP, it is automatically
recompiled and reloaded the next time that page is requested. Of course,
because of all this dynamism you’ll see a slow response for the first-time
access to a JSP. However, since a JSP is usually used much more than it is
changed, you will normally not be affected by this delay.</span></p>

<p class=MsoNormal><span lang=EN-US>The structure of a JSP page is a cross
between a servlet and an HTML page. The JSP tags begin and end with angle
brackets, just like HTML tags, but the tags also include percent signs, so all
JSP tags are denoted by</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&lt;% JSP code
here %&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>The leading percent sign may
be followed by other characters that determine the precise type of JSP code in
the tag.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an extremely simple JSP example that
uses a standard Java library call to get the current time in milliseconds,
which is then divided by 1000 to produce the time in seconds. Since a <i>JSP
expression</i> (the <b>&lt;%=</b> ) is used, the result of the calculation is
coerced into a <b>String</b> and placed on the generated Web page:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:!
c15:jsp:ShowSeconds.jsp</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;html&gt;&lt;body&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H1&gt;The time in
seconds is: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%= System.currentTimeMillis()/1000
%&gt;&lt;/H1&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/body&gt;&lt;/html&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In the JSP examples in this book, the first
and last lines are not included in the actual code file that is extracted and
placed in the book’s source-code tree.</span></p>

<p class=MsoNormal><span lang=EN-US>When the client creates a request for the
JSP page, the Web server must have been configured to relay the request to the
JSP container, which then invokes the page. As mentioned above, the first time
the page is invoked, the components specified by the page are generated and
compiled by the JSP container as one or more servlets. In the above example,
the servlet will contain code to configure the <b>HttpServletResponse</b>
object, produce a <b>PrintWriter</b> object (which is always named <b>out</b>),
and then turn the time calculation into a <b>String</b> which is sent to <b>out</b>.
As you can see, all this is accomplished with a very succinct statement, but
the average HTML programmer/Web designer will not have the skills to write such
code.</span></p>

<h3><a name="_Toc481064885"><span lang=EN-US>Implicit objects</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Servlets include classes that provide
convenient utilities, such as <b>HttpServletRequest</b>, <b>HttpServletResponse</b>,
<b>Session</b>, etc. Objects of these classes are built into the JSP
specification and automatically available for use in your JSP without writing
any extra lines of code. The implicit objects in a JSP are detailed in the table
below. </span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=496
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=104 valign=top style='width:77.95pt;border:solid black 1.5pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>Implicit
  variable</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>Of Type
  (javax.servlet)</span></p>
  </td>
  <td width=156 valign=top style='width:117.0pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>Description</span></p>
  </td>
  <td width=68 valign=top style='width:50.9pt;border:solid black 1.5pt;
  border-left:none;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>Scope</span></p>
  </td>
 </tr>
 <tr>
  <td width=104 valign=top style='width:77.95pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>request</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>protocol
  dependent subtype of  </span><span lang=EN-US style='font-size:10.0pt'>HttpServletRequest</span></p>
  </td>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>The
  request that triggers the service invocation.</span></p>
  </td>
  <td width=68 valign=top style='width:50.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>request</span></p>
  </td>
 </tr>
 <tr>
  <td width=104 valign=top style='width:77.95pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>response</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>protocol
  dependent subtype of </span><span lang=EN-US style='font-size:10.0pt'>HttpServletResponse</span></p>
  </td>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>The
  response to the request.</span></p>
  </td>
  <td width=68 valign=top style='width:50.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>page</span></p>
  </td>
 </tr>
 <tr>
  <td width=104 valign=top style='width:77.95pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>pageContext</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>jsp.PageContext</span></p>
  </td>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>The
  page context encapsulates implementation-dependent features and provides
  convenience methods and namespace access for this JSP.</span></p>
  </td>
  <td width=68 valign=top style='width:50.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>page</span></p>
  </td>
 </tr>
 <tr>
  <td width=104 valign=top style='width:77.95pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>session</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>Protocol
  dependent subtype of </span><span lang=EN-US style='font-size:10.0pt'>http.HttpSession</span></p>
  </td>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>The
  session object created for the requesting client. See servlet Session object.</span></p>
  </td>
  <td width=68 valign=top style='width:50.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>session</span></p>
  </td>
 </tr>
 <tr>
  <td width=104 valign=top style='width:77.95pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>application</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>ServletContext</span></p>
  </td>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>The
  servlet context obtained from the servlet configuration object (e.g., </span><span
  lang=EN-US style='font-size:10.0pt'>getServletConfig()</span><span
  lang=EN-US style='font-weight:normal'>,</span><span lang=EN-US
  style='font-size:10.0pt;font-weight:normal'> </span><span lang=EN-US
  style='font-size:10.0pt'>getContext(&nbsp;)</span><span lang=EN-US
  style='font-weight:normal'>.</span></p>
  </td>
  <td width=68 valign=top style='width:50.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>app</span></p>
  </td>
 </tr>
 <tr>
  <td width=104 valign=top style='width:77.95pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>out</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>jsp.JspWriter</span></p>
  </td>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>The
  object that writes into the output stream.</span></p>
  </td>
  <td width=68 valign=top style='width:50.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>page</span></p>
  </td>
 </tr>
 <tr>
  <td width=104 valign=top style='width:77.95pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>config</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>ServletConfig</span></p>
  </td>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>The
  </span><span lang=EN-US style='font-size:10.0pt'>ServletConfig</span><span
  lang=EN-US style='font-size:10.0pt;font-weight:normal'> for this JSP.</span></p>
  </td>
  <td width=68 valign=top style='width:50.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>page</span></p>
  </td>
 </tr>
 <tr>
  <td width=104 valign=top style='width:77.95pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>page</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt'>java.lang.Object</span></p>
  </td>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>The
  instance of this page’s implementation class processing the current request.</span></p>
  </td>
  <td width=68 valign=top style='width:50.9pt;border-top:none;border-left:none;
  border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table style='margin-top:2.0pt;margin-right:3.6pt;margin-bottom:2.0pt;
  margin-left:3.6pt'><span lang=EN-US style='font-size:10.0pt;font-weight:normal'>page</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>The scope of each object can vary
significantly. For example, the <b>session</b> object has a scope which exceeds
that of a page, as it many span several client requests and pages. The <b>application</b>
object can provide services to a group of JSP pages that together represent a
Web application.</span></p>

<h3><a name="_Toc481064886"><span lang=EN-US>JSP directives</span></a><span
lang=EN-US> </span></h3>

<p class=MsoNormal><span lang=EN-US>Directives are messages to the JSP
container and are denoted by the “<b>@</b></span><span lang=EN-US>”</span><span
lang=EN-US>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&lt;%@ directive
{attr=&quot;value&quot;}* %&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Directives do not send anything to the <b>out</b>
stream, but they are important in setting up your JSP page’s attributes and
dependencies with the JSP container. For example, the line:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&lt;%@ page
language=&quot;java&quot; %&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>says that the scripting language being used
within the JSP page is Java. In fact, the JSP specification <i>only</i>
describes the semantics of scripts for the language attribute equal to “Java.”
The intent of this directive is to build flexibility into the JSP technology.
In the future, if you were to choose another language, say Python (a good
scripting choice), then that language would have to support the Java Run-time
Environment by exposing the Java technology object model to the scripting
environment, especially the implicit variables defined above, JavaBeans
properties, and public methods.</span></p>

<p class=MsoNormal><span lang=EN-US>The most important directive is the page
directive. It defines a number of page dependent attributes and communicates
these attributes to the JSP container. These attributes include: <b>language</b>,
<b>extends</b>, <b>import</b>, <b>session</b>, <b>buffer</b>, <b>autoFlush</b>,
<b>isThreadSafe</b>, <b>info</b> and <b>errorPage</b>. For example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&lt;%@ page
session=”true” import=”java.util.*” %&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This line first indicates that the page
requires participation in an HTTP session.  Since we have not set the language
directive the JSP container defaults to using Java and the implicit script
language variable named <b>session</b> is of type <b>javax.servlet.http.HttpSession</b>.
If the directive had been false then the implicit variable <b>session</b> would
be unavailable. If the <b>session</b></span><span lang=EN-US> variable is not
specified, then it defaults to “true.”</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>import</b> attribute describes the
types that are available to the scripting environment. This attribute is used
just as it would be in the Java programming language, i.e., a comma-separated
list of ordinary <b>import</b></span><span lang=EN-US> expressions</span><span
lang=EN-US>. This list is imported by the translated JSP page implementation
and is available to the scripting environment. Again, this is currently only
defined when the value of the language directive is “java.”</span></p>

<h3><a name="_Toc481064887"><span lang=EN-US>JSP scripting elements</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Once the directives have been used to set
up the scripting environment you can utilize the scripting language elements.
JSP 1.1 has three scripting language elements—<i>declarations</i>, <i>scriptlets</i>,
and <i>expressions</i>. A declaration will declare elements, a scriptlet is a
statement fragment, and an expression is a complete language expression. In JSP
each scripting element begins with a “<b>&lt;%</b>”. The syntax for each is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%! declaration %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%  scriptlet   %&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&lt;%= expression 
%&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>White space is optional after “&lt;%!”,
“&lt;%”, “&lt;%=”, and before “%&gt;.”</span></p>

<p class=MsoNormal><span lang=EN-US>All these tags are based upon XML; you
could even say that a JSP page can be mapped to a XML document. The XML
equivalent syntax for the scripting elements above would be:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;jsp:declaration&gt;
declaration &lt;/jsp:declaration&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;jsp:scriptlet&gt;  
scriptlet   &lt;/jsp:scriptlet&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&lt;jsp:expression&gt; 
expression  &lt;/jsp:expression&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In addition, there are two types of
comments:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%-- jsp comment
--%&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>&lt;!-- html
comment --&gt;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The first form allows you to add comments
to JSP source pages that will not appear in any form in the HTML that is sent
to the client. Of course, the second form of comment is not specific to
JSPs—it’s just an ordinary HTML comment. What’s interesting is that you can
insert JSP code inside an HTML comment and the comment will be produced in the
resulting page, including the result from the JSP code.</span></p>

<p class=MsoNormal><span lang=EN-US>Declarations are used to declare variables
and methods in the scripting language (currently Java only) used in a JSP page.
The declaration must be a complete Java statement and cannot produce any output
in the <b>out</b> stream. In the <b>Hello.jsp </b>example below, the
declarations for the variables <b>loadTime</b>, <b>loadDate</b> and <b>hitCount</b>
are all complete Java statements that declare and initialize new variables.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:! c15:jsp:Hello.jsp</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%-- This JSP comment
will not appear in the</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>generated html --%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%-- This is a JSP
directive: --%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%@ page
import=&quot;java.util.*&quot; %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%-- These are
declarations: --%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long loadTime=
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Date loadDate = new
Date();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    int hitCount = 0;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;html&gt;&lt;body&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%-- The next several
lines are the result of a </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>JSP expression inserted
in the generated html;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>the '=' indicates a JSP
expression --%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H1&gt;This page was
loaded at &lt;%= loadDate %&gt; &lt;/H1&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H1&gt;Hello, world!
It's &lt;%= new Date() %&gt;&lt;/H1&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H2&gt;Here's an
object: &lt;%= new Object() %&gt;&lt;/H2&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H2&gt;This page has
been up </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%=
(System.currentTimeMillis()-loadTime)/1000 %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>seconds&lt;/H2&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H3&gt;Page has been
accessed &lt;%= ++hitCount %&gt; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>times since &lt;%= loadDate
%&gt;&lt;/H3&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%-- A
&quot;scriptlet&quot; that writes to the server</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>console and to the
client page. </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Note that the ';' is
required: --%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
System.out.println(&quot;Goodbye&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  
out.println(&quot;Cheerio&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/body&gt;&lt;/html&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When you run this program you’ll see that
the variables <b>loadTime</b>, <b>loadDate</b> and <b>hitCount</b> hold their
values between hits to the page, so they are clearly fields and not local
variables.</span></p>

<p class=MsoNormal><span lang=EN-US>At the end of the example is a scriptlet
that writes “Goodbye” to the Web server console and “Cheerio” to the implicit <b>JspWriter
</b>object<b> out</b>. Scriptlets can contain any code fragments that are valid
Java statements. Scriptlets are executed at request-processing time. When all
the scriptlet fragments in a given JSP are combined in the order they appear in
the JSP page, they should yield a valid statement as defined by the Java
programming language. Whether or not they produce any output into the <b>out</b>
stream depends upon the code in the scriptlet. You should be aware that
scriptlets can produce side effects by modifying the objects that are visible
to them.</span></p>

<p class=MsoNormal><span lang=EN-US>JSP expressions can found intermingled with
the HTML in the middle section of <b>Hello.jsp</b>. Expressions must be
complete Java statements, which are evaluated, coerced to a <b>String</b>, and
sent to <b>out</b>. If the result of the expression cannot be coerced to a <b>String</b>
then a <b>ClassCastException</b> is thrown.</span></p>

<h3><a name="_Toc481064888"><span lang=EN-US>Extracting fields and values</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The following example is similar to one
shown earlier in the servlet section. The first time you hit the page it
detects that you have no fields and returns a page containing a form, using the
same code as in the servlet example, but in JSP format. When you submit the
form with the filled-in fields to the same JSP URL, it detects the fields and
displays them. This is a nice technique because it allows you to have both the
page containing the form for the user to fill out and the response code for
that page in a single file, thus making it easier to create and maintain.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:!
c15:jsp:DisplayFormData.jsp</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%-- Fetching the
data from an HTML form. --%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%-- This JSP also
generates the form. --%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%@ page
import=&quot;java.util.*&quot; %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;html&gt;&lt;body&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H1&gt;DisplayFormData&lt;/H1&gt;&lt;H3&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Enumeration flds =
request.getParameterNames();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
if(!flds.hasMoreElements()) { // No fields %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &lt;form
method=&quot;POST&quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    action=&quot;DisplayFormData.jsp&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%  for(int i = 0; i
&lt; 10; i++) {  %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      Field&lt;%=i%&gt;:
&lt;input type=&quot;text&quot; size=&quot;20&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
name=&quot;Field&lt;%=i%&gt;&quot;
value=&quot;Value&lt;%=i%&gt;&quot;&gt;&lt;br&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%  } %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &lt;INPUT
TYPE=submit name=submit </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
value=&quot;Submit&quot;&gt;&lt;/form&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%} else { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    while(flds.hasMoreElements())
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String field =
(String)flds.nextElement();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      String value =
request.getParameter(field);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &lt;li&gt;&lt;%=
field %&gt; = &lt;%= value %&gt;&lt;/li&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  } %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/H3&gt;&lt;/body&gt;&lt;/html&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The most interesting feature of this
example is that it demonstrates how scriptlet code can be intermixed with HTML
code, even to the point of generating HTML within a Java <b>for</b> loop. This
is especially convenient for building any kind of form where repetitive HTML
code would otherwise be required.</span></p>

<h3><a name="_Toc481064889"><span lang=EN-US>JSP page attributes and scope</span></a></h3>

<p class=MsoNormal><a name=AAA></a><span lang=EN-US>By poking around in the
HTML documentation for servlets and JSPs, you will find features that report
information about the servlet or JSP that is currently running. The following
example displays a few of these pieces of data.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:! c15:jsp:PageContext.jsp</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%--Viewing the
attributes in the pageContext--%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%-- Note that you
can include any amount of code</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>inside the scriptlet
tags --%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%@ page
import=&quot;java.util.*&quot; %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;html&gt;&lt;body&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Servlet Name: &lt;%=
config.getServletName() %&gt;&lt;br&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Servlet container
supports servlet version:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%
out.print(application.getMajorVersion() + &quot;.&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>+
application.getMinorVersion()); %&gt;&lt;br&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
session.setAttribute(&quot;My dog&quot;, &quot;Ralph&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  for(int scope = 1;
scope &lt;= 4; scope++) {  %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &lt;H3&gt;Scope:
&lt;%= scope %&gt; &lt;/H3&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%  Enumeration e =</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
pageContext.getAttributeNamesInScope(scope);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
while(e.hasMoreElements()) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
out.println(&quot;\t&lt;li&gt;&quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        e.nextElement()
+ &quot;&lt;/li&gt;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/body&gt;&lt;/html&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This example also shows the use of both
embedded HTML and writing to <b>out</b> in order to output to the resulting
HTML page.</span></p>

<p class=MsoNormal><span lang=EN-US>The first piece of information produced is
the name of the servlet, which will probably just be “JSP” but it depends on
your implementation. You can also discover the current version of the servlet
container by using the application object. Finally, after setting a session
attribute, the “attribute names” in a particular scope are displayed. You don’t
use the scopes very much in most JSP programming; they were just shown here to
add interest to the example. There are four attribute scopes, as follows: The <i>page
scope</i> (scope 1), the <i>request scope</i> (scope 2), the <i>session scope</i>
(scope 3—here, the only element available in session scope is “My dog,” added
right before the <b>for</b> loop), and the <i>application scope</i> (scope 4),
based upon the <b>ServletContext</b> object. There is one <b>ServletContext</b>
per “Web application” per Java Virtual Machine. (A “Web application” is a
collection of servlets and content installed under a specific subset of the
server’s URL namespace such as /catalog.  This is generally set up using a
configuration file.) At the application scope you will see objects that
represent paths for the working directory and temporary directory.</span></p>

<h3><a name="_Toc481064890"><span lang=EN-US>Manipulating sessions in JSP</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Sessions were introduced in the prior
section on servlets, and are also available within JSPs. The following example
exercises the <b>session</b> object and allows you to manipulate the amount of
time before the session becomes invalid. </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:!
c15:jsp:SessionObject.jsp</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%--Getting and
setting session object values--%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;html&gt;&lt;body&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H1&gt;Session id:
&lt;%= session.getId() %&gt;&lt;/H1&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H3&gt;&lt;li&gt;This
session was created at </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%=
session.getCreationTime() %&gt;&lt;/li&gt;&lt;/H1&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H3&gt;&lt;li&gt;Old
MaxInactiveInterval = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  &lt;%=
session.getMaxInactiveInterval() %&gt;&lt;/li&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%
session.setMaxInactiveInterval(5); %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;li&gt;New
MaxInactiveInterval= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  &lt;%=
session.getMaxInactiveInterval() %&gt;&lt;/li&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/H3&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H2&gt;If the session
object &quot;My dog&quot; is </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>still around, this value
will be non-null:&lt;H2&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H3&gt;&lt;li&gt;Session
value for &quot;My dog&quot; =  </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%=
session.getAttribute(&quot;My dog&quot;) %&gt;&lt;/li&gt;&lt;/H3&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%-- Now add the
session object &quot;My dog&quot; --%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%
session.setAttribute(&quot;My dog&quot;, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>                    new
String(&quot;Ralph&quot;)); %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H1&gt;My dog's name
is </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%=
session.getAttribute(&quot;My dog&quot;) %&gt;&lt;/H1&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%-- See if &quot;My
dog&quot; wanders to another form --%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;FORM TYPE=POST
ACTION=SessionObject2.jsp&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;INPUT TYPE=submit
name=submit </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Value=&quot;Invalidate&quot;&gt;&lt;/FORM&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;FORM TYPE=POST
ACTION=SessionObject3.jsp&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;INPUT TYPE=submit
name=submit </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Value=&quot;Keep
Around&quot;&gt;&lt;/FORM&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/body&gt;&lt;/html&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>session </b>object is provided by
default so it is available without any extra coding. The calls to <b>getID(&nbsp;)</b>,
<b>getCreationTime(&nbsp;)</b> and <b>getMaxInactiveInterval(&nbsp;)</b> are
used to display information about this session object. </span></p>

<p class=MsoNormal><span lang=EN-US>When you first bring up this session you
will see a <b>MaxInactiveInterval</b> of, for example, 1800 seconds (30
minutes). This will depend on the way your JSP/servlet container is configured.
The <b>MaxInactiveInterval</b> is shortened to 5 seconds to make things
interesting. If you refresh the page before the 5 second interval expires, then
you’ll see:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Session value for
&quot;My dog&quot; = Ralph</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>But if you wait longer than that, “Ralph”
will become <b>null</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>To see how the session information can be
carried through to other pages, and also to see the effect of invalidating a
session object versus just letting it expire, two other JSPs are created. The
first one (reached by pressing the “invalidate” button in <b>SessionObject.jsp</b>)
reads the session information and then explicitly invalidates that session:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:! c15:jsp:SessionObject2.jsp</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%--The session
object carries through--%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;html&gt;&lt;body&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H1&gt;Session id:
&lt;%= session.getId() %&gt;&lt;/H1&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H1&gt;Session value
for &quot;My dog&quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%=
session.getValue(&quot;My dog&quot;) %&gt;&lt;/H1&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%
session.invalidate(); %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/body&gt;&lt;/html&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>To experiment with this, refresh <b>SessionObject.jsp</b>,
then immediately click the “invalidate” button to bring you to <b>SessionObject2.jsp</b>.
At this point you will still see “Ralph,” and right away (before the 5-second
interval has expired), refresh <b>SessionObject2.jsp</b> to see that the
session has been forcefully invalidated and “Ralph” has disappeared.</span></p>

<p class=MsoNormal><span lang=EN-US>If you go back to <b>SessionObject.jsp</b>,
refresh the page so you have a new 5-second interval, then press the “Keep
Around” button, it will take you to the following page, <b>SessionObject3.jsp</b>,
which does NOT invalidate the session: </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:!
c15:jsp:SessionObject3.jsp</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%--The session
object carries through--%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;html&gt;&lt;body&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H1&gt;Session id:
&lt;%= session.getId() %&gt;&lt;/H1&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H1&gt;Session value
for &quot;My dog&quot; </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%=
session.getValue(&quot;My dog&quot;) %&gt;&lt;/H1&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;FORM TYPE=POST
ACTION=SessionObject.jsp&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;INPUT TYPE=submit
name=submit Value=&quot;Return&quot;&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/FORM&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/body&gt;&lt;/html&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Because this page doesn’t invalidate the
session, “Ralph” will hang around as long as you keep refreshing the page
before the 5 second time interval expires. This is not unlike a “Tomagotchi”
pet—as long as you play with “Ralph” he will stick around, otherwise he
expires.</span></p>

<h3><a name="_Toc481064891"><span lang=EN-US>Creating and modifying cookies</span></a></h3>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>Cookies were introduced in the
prior section on servlets. Once again, the brevity of JSPs makes playing with
cookies much simpler here than when using servlets. The following example shows
this by fetching the cookies that come with the request, reading and modifying
their maximum ages (expiration dates) and attaching a new cookie to the
outgoing response:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:! c15:jsp:Cookies.jsp</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%--This program has
different behaviors under</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> different browsers!
--%&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;html&gt;&lt;body&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;H1&gt;Session id:
&lt;%= session.getId() %&gt;&lt;/H1&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Cookie[] cookies =
request.getCookies();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>for(int i = 0; i &lt;
cookies.length; i++) { %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Cookie name: &lt;%=
cookies[i].getName() %&gt; &lt;br&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  value: &lt;%=
cookies[i].getValue() %&gt;&lt;br&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Old max age in
seconds: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  &lt;%=
cookies[i].getMaxAge() %&gt;&lt;br&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  &lt;%
cookies[i].setMaxAge(5); %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  New max age in
seconds: </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  &lt;%= cookies[i].getMaxAge()
%&gt;&lt;br&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;% } %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%! int count = 0;
int dcount = 0; %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;%
response.addCookie(new Cookie(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Bob&quot; +
count++, &quot;Dog&quot; + dcount++)); %&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/body&gt;&lt;/html&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Since each browser stores cookies in its
own way, you may see different behaviors with different browsers (not
reassuring, but it might be some kind of bug that could be fixed by the time
you read this). Also, you may experience different results if you shut down the
browser and restart it, rather than just visiting a different page and then returning
to <b>Cookies.jsp</b>. Note that using session objects seems to be more robust
than directly using cookies.</span></p>

<p class=MsoNormal><span lang=EN-US>After displaying the session identifier,
each cookie in the array of cookies that comes in with the <b>request </b>object
is displayed, along with its maximum age. The maximum age is changed and
displayed again to verify the new value, then a new cookie is added to the
response. However, your browser may seem to ignore the maximum age; it’s worth
playing with this program and modifying the maximum age value to see the
behavior under different browsers.</span></p>

<h3><a name="_Toc481064892"><span lang=EN-US>JSP summary</span></a></h3>

<p class=MsoNormal><span lang=EN-US>This section has only been a brief coverage
of JSPs, and yet even with what was covered here (along with the Java you’ve
learned in the rest of the book, and your own knowledge of HTML) you can begin
to write sophisticated web pages via JSPs. The JSP syntax isn’t meant to be
particularly deep or complicated, so if you understand what was presented in
this section you’re ready to be productive with JSPs. You can find further
information in most current books on servlets, or at <i>java.sun.com</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s especially nice to have JSPs
available, even if your goal is only to produce servlets. You’ll discover that
if you have a question about the behavior of a servlet feature, it’s much
easier and faster to write a JSP test program to answer that question than it
is to write a servlet. Part of the benefit comes from having to write less code
and being able to mix the display HTML in with the Java code, but the leverage
becomes especially obvious when you see that the JSP Container handles all the
recompilation and reloading of the JSP for you whenever the source is changed.</span></p>

<p class=MsoNormal><span lang=EN-US>As terrific as JSPs are, however, it’s
worth keeping in mind that JSP creation requires a higher level of skill than
just programming in Java or just creating Web pages. In addition, debugging a
broken JSP page is not as easy as debugging a Java program, as (currently) the
error messages are more obscure. This should change as development systems
improve, but we may also see other technologies built on top of Java and the
Web that are better adapted to the skills of the web site designer.</span></p>

<h2><a name="_Toc481064893"><span lang=EN-US>RMI (Remote Method Invocation)</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Traditional approaches to executing code on
other machines across a network have been confusing as well as tedious and
error-prone to implement. The nicest way to think about this problem is that
some object happens to live on another machine, and that you can send a message
to the remote object and get a result as if the object lived on your local
machine. This simplification is exactly what Java </span><span lang=EN-US><i>Remote Method Invocation</i> (RMI) allows you to do. This section
walks you through the steps necessary to create your own RMI objects.</span></p>

<h3><a name="_Toc481064894"><span lang=EN-US>Remote interfaces</span></a></h3>

<p class=MsoNormal><span lang=EN-US>RMI makes heavy use of interfaces. When you
want to create a remote object, you mask the underlying implementation by
passing around an interface. Thus, when the client gets a reference to a remote
object, what they really get is an interface reference, which <i>happens</i> to
connect to some local stub code that talks across the network. But you don’t
think about this, you just send messages via your interface reference.</span></p>

<p class=MsoNormal><span lang=EN-US>When you create a </span><span
lang=EN-US>remote interface, you must follow these guidelines:</span></p>

<p class=Numbered><span lang=EN-US>The remote interface must be <b>public</b>
(it cannot have “package access,” that is, it cannot be “friendly”). Otherwise,
a client will get an error when attempting to load a remote object that implements
the remote interface. </span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>122.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>The remote interface must extend the interface </span><span lang=EN-US><b>java.rmi.Remote</b>. </span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>123.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Each method in the remote interface must declare </span><span lang=EN-US><b>java.rmi.RemoteException</b> in its <b>throws</b> clause in
addition to any application-specific exceptions. </span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>124.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>A remote object passed as an argument or return value (either
directly or embedded within a local object) must be declared as the remote
interface, not the implementation class.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s a simple remote interface that
represents an accurate time service:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:rmi:PerfectTimeI.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The PerfectTime
remote interface.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package c15.rmi;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.rmi.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>interface PerfectTimeI
extends Remote {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  long getPerfectTime()
throws RemoteException;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It looks like any other interface except
that it extends <b>Remote</b> and all of its methods throw <b>RemoteException</b>.
Remember that an <b>interface</b> and all of its methods are automatically <b>public</b>.</span></p>

<h3><a name="_Toc481064895"><span lang=EN-US>Implementing the remote interface</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The server must contain a class that
extends </span><span lang=EN-US><b>UnicastRemoteObject</b> and implements the
remote interface. This class can also have additional methods, but only the
methods in the remote interface are available to the client, of course, since
the client will get only a reference to the interface, not the class that
implements it.</span></p>

<p class=MsoNormal><span lang=EN-US>You must explicitly define the constructor
for the remote object even if you’re only defining a default constructor that
calls the base-class constructor. You must write it out since it must throw <b>RemoteException</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s the implementation of the remote interface
<b>PerfectTimeI</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:rmi:PerfectTime.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The implementation of
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// the PerfectTime
remote object.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package c15.rmi;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.rmi.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
java.rmi.server.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
java.rmi.registry.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.net.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class PerfectTime
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    extends
UnicastRemoteObject</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    implements
PerfectTimeI {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Implementation of
the interface:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public long
getPerfectTime() </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws
RemoteException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Must implement
constructor </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // to throw RemoteException:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public PerfectTime()
throws RemoteException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // super(); //
Called automatically</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Registration for
RMI serving. Throw </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // exceptions out to
the console.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.setSecurityManager(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
RMISecurityManager());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PerfectTime pt = new
PerfectTime();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Naming.bind(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&quot;//peppy:2005/PerfectTime&quot;, pt);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Ready to do time&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Here, <b>main(&nbsp;)</b> handles all the
details of setting up the server. When you’re serving RMI objects, at some
point in your program you must:</span></p>

<p class=Numbered><span lang=EN-US>Create and install a security manager that
supports RMI. The only one available for RMI as part of the Java distribution
is </span><span lang=EN-US><b>RMISecurityManager</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>125.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Create one or more instances of a remote object. Here, you can see
the creation of the <b>PerfectTime</b> object.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>126.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Register at least one of the remote objects with the RMI </span><span lang=EN-US>remote object registry for bootstrapping purposes. One remote object
can have methods that produce references to other remote objects. This allows
you to set it up so the client must go to the registry only once, to get the
first remote object.</span></p>

<h4><span lang=EN-US>Setting up the registry</span></h4>

<p class=MsoNormal><span lang=EN-US>Here, you see a call to the <b>static</b>
method </span><span lang=EN-US><b>Naming.bind(&nbsp;)</b>. However, this call
requires that the registry be running as a separate process on the computer.
The name of the registry server is </span><span lang=EN-US><b>rmiregistry</b>, and under 32-bit Windows you say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>start rmiregistry</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>to start it in the background. On Unix, the
command is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>rmiregistry &amp;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Like many network programs, the <b>rmiregistry</b>
is located at the IP address of whatever machine started it up, but it must
also be listening at a port. If you invoke the <b>rmiregistry</b> as above,
with no argument, the registry’s port will default to 1099. If you want it to
be at some other port, you add an argument on the command line to specify the
port. For this example, the port is located at 2005, so the <b>rmiregistry</b>
should be started like this under 32-bit Windows:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>start rmiregistry
2005</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>or for Unix:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>rmiregistry 2005
&amp;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The information about the port must also be
given to the <b>bind(&nbsp;)</b> command, as well as the IP address of the
machine where the registry is located. But this brings up what can be a
frustrating problem if you’re expecting to test RMI programs locally the way
the network programs have been tested so far in this chapter. In the JDK 1.1.1
release, there are a couple of problems:</span><a href="#_ftn76"
name="_ftnref76" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[76]</span></span></span></span></a></p>

<p class=Numbered><span lang=EN-US><b>localhost </b>does not work with RMI.
Thus, to experiment with RMI on a single machine, you must provide the name of
the machine. To find out the name of your machine under 32-bit Windows, go to
the control panel and select “Network.” Select the “Identification” tab, and
you’ll see your computer name. In my case, I called my computer “Peppy.” It
appears that capitalization is ignored.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>127.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>RMI will not work unless your computer has an active </span><span lang=EN-US>TCP/IP connection, even if all your components are just talking to
each other on the local machine. This means that you must connect to your
Internet service provider before trying to run the program or you’ll get some
obscure exception messages.</span></p>

<p class=MsoNormal><span lang=EN-US>With all this in mind, the <b>bind(&nbsp;)</b>
command becomes:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Naming.bind(&quot;//peppy:2005/PerfectTime&quot;,
pt);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>If you are using the default port 1099, you
don’t need to specify a port, so you could say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Naming.bind(&quot;//peppy/PerfectTime&quot;,
pt);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You should be able to perform local testing
by leaving off the IP address and using only the identifier:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Naming.bind(&quot;PerfectTime&quot;,
pt);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The name for the service is arbitrary; it
happens to be PerfectTime here, just like the name of the class, but you could
call it anything you want. The important thing is that it’s a unique name in
the registry that the client knows to look for to procure the remote object. If
the name is already in the registry, you’ll get an </span><span lang=EN-US><b>AlreadyBoundException</b>. To prevent this, you can always use </span><span lang=EN-US><b>rebind(&nbsp;)</b> instead of <b>bind(&nbsp;)</b>, since <b>rebind(&nbsp;)</b>
either adds a new entry or replaces the one that’s already there.</span></p>

<p class=MsoNormal><span lang=EN-US>Even though <b>main(&nbsp;)</b> exits, your
object has been created and registered so it’s kept alive by the registry,
waiting for a client to come along and request it. As long as the <b>rmiregistry</b>
is running and you don’t call <b>Naming.unbind(&nbsp;)</b> </span><span lang=EN-US>on your name, the object will be there. For this reason, when you’re
developing your code you need to shut down the <b>rmiregistry</b> and restart
it when you compile a new version of your remote object.</span></p>

<p class=MsoNormal><span lang=EN-US>You aren’t forced to start up <b>rmiregistry</b>
as an external process. If you know that your application is the only one
that’s going to use the registry, you can start it up inside your program with
the line:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>LocateRegistry.createRegistry(2005);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Like before, 2005 is the port number we
happen to be using in this example. This is the equivalent of running <b>rmiregistry
2005</b> from a command line, but it can often be more convenient when you’re
developing RMI code since it eliminates the extra steps of starting and
stopping the registry. Once you’ve executed this code, you can <b>bind(&nbsp;)</b>
using <b>Naming</b> as before.</span></p>

<h3><a name="_Toc481064896"><span lang=EN-US>Creating stubs and skeletons</span></a></h3>

<p class=MsoNormal><span lang=EN-US>If you compile and run <b>PerfectTime.java</b>,
it won’t work even if you have the <b>rmiregistry</b> running correctly. That’s
because the framework for RMI isn’t all there yet. You must first create the </span><span lang=EN-US>stubs and </span><span lang=EN-US>skeletons that provide the network
connection operations and allow you to pretend that the remote object is just
another local object on your machine.</span></p>

<p class=MsoNormal><span lang=EN-US>What’s going on behind the scenes is
complex. Any objects that you pass into or return from a remote object must <b>implement
</b></span><span lang=EN-US><b>Serializable</b> (if you want to pass remote
references instead of the entire objects, the object arguments can <b>implement
Remote</b>), so you can imagine that the stubs and skeletons are automatically
performing serialization and deserialization as they “marshal” all of the
arguments across the network and return the result. Fortunately, you don’t have
to know any of this, but you <i>do</i> have to create the stubs and skeletons.
This is a simple process: you invoke the </span><span lang=EN-US><b>rmic</b> tool on your compiled code, and it creates the necessary
files. So the only requirement is that another step be added to your
compilation process.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>rmic</b> tool is particular about
packages and </span><span lang=EN-US>classpaths, however. <b>PerfectTime.java</b>
is in the <b>package c15.rmi</b>, and even if you invoke <b>rmic</b> in the
same directory in which <b>PerfectTime.class</b> is located, <b>rmic</b> won’t
find the file, since it searches the classpath. So you must specify the location
off the class path, like so:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>rmic
c15.rmi.PerfectTime</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You don’t have to be in the directory
containing <b>PerfectTime.class</b> when you execute this command, but the
results will be placed in the current directory.</span></p>

<p class=MsoNormal><span lang=EN-US>When <b>rmic</b> runs successfully, you’ll
have two new classes in the directory:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>PerfectTime_Stub.class</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>PerfectTime_Skel.class</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>corresponding to the stub and skeleton. Now
you’re ready to get the server and client to talk to each other.</span></p>

<h3><a name="_Toc481064897"><span lang=EN-US>Using the remote object</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The whole point of RMI is to make the use of
remote objects simple. The only extra thing that you must do in your client
program is to look up and fetch the remote interface from the server. From then
on, it’s just regular Java programming: sending messages to objects. Here’s the
program that uses <b>PerfectTime</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:rmi:DisplayPerfectTime.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Uses remote object
PerfectTime.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>package c15.rmi;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.rmi.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
java.rmi.registry.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
DisplayPerfectTime {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.setSecurityManager(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
RMISecurityManager());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PerfectTimeI t = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
(PerfectTimeI)Naming.lookup(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
&quot;//peppy:2005/PerfectTime&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;Perfect time = &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
t.getPerfectTime());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The ID string is the same as the one used
to register the object with <b>Naming</b>, and the first part represents the
URL and port number. Since you’re using a URL, you can also specify a machine
on the Internet.</span></p>

<p class=MsoNormal><span lang=EN-US>What comes back from <b>Naming.lookup(&nbsp;)</b>
must be cast to the remote interface, <i>not</i> to the class. If you use the
class instead, you’ll get an exception.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see in the method call</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>t.getPerfectTime()</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>that once you have a reference to the
remote object, programming with it is indistinguishable from programming with a
local object (with one difference: remote methods throw </span><span lang=EN-US><b>RemoteException</b>).</span></p>

<h2><a name="_Toc375545499"></a><a name="_Toc481064898"><span lang=EN-US>CORBA</span></a></h2>

<p class=MsoNormal><span lang=EN-US>In large, distributed applications, your
needs might not be satisfied by the preceding approaches. For example, you
might want to interface with legacy data stores, or you might need services
from a server object regardless of its physical location. These situations
require some form of Remote Procedure Call (RPC), and possibly language independence.
This is where CORBA can help.</span></p>

<p class=MsoNormal><span lang=EN-US>CORBA is not a language feature; it’s an
integration technology. It’s a specification that vendors can follow to
implement CORBA-compliant integration products. CORBA is part of the OMG’s
effort to define a standard framework for distributed, language-independent
object interoperability.</span></p>

<p class=MsoNormal><span lang=EN-US>CORBA supplies the ability to make remote
procedure calls into Java objects and non-Java objects, and to interface with
legacy systems in a location-transparent way. Java adds networking support and
a nice object-oriented language for building graphical and non-graphical
applications. The Java and </span><span lang=EN-US>OMG object model map nicely
to each other; for example, both Java and CORBA implement the interface concept
and a reference object model.</span></p>

<h3><a name="_Toc481064899"><span lang=EN-US>CORBA fundamentals</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The object interoperability specification
developed by the OMG is commonly referred to as the Object Management
Architecture (OMA). The OMA defines two components: the Core Object Model and
the OMA Reference Architecture. The Core Object Model states the basic concepts
of object, interface, operation, and so on. (CORBA is a refinement of the Core
Object Model.) The OMA Reference Architecture defines an underlying
infrastructure of services and mechanisms that allow objects to interoperate.
The OMA Reference Architecture includes the Object Request Broker (ORB), Object
Services (also known as CORBA services), and common facilities.</span></p>

<p class=MsoNormal><span lang=EN-US>The ORB is the communication bus by which
objects can request services from other objects, regardless of their physical
location. This means that what looks like a method call in the client code is
actually a complex operation. First, a connection with the server object must
exist, and to create a connection the ORB must know where the server implementation
code resides. Once the connection is established, the method arguments must be
marshaled, i.e. converted in a binary stream to be sent across a network. Other
information that must be sent are the server machine name, the server process,
and the identity of the server object inside that process. Finally, this
information is sent through a low-level wire protocol, the information is
decoded on the server side, and the call is executed. The ORB hides all of this
complexity from the programmer and makes the operation almost as simple as
calling a method on local object.</span></p>

<p class=MsoNormal><span lang=EN-US>There is no specification for how an ORB
Core should be implemented, but to provide a basic compatibility among
different vendors’ ORBs, the OMG defines a set of services that are accessible
through standard interfaces.</span></p>

<h4><span lang=IT>CORBA Interface Definition Language (IDL)</span></h4>

<p class=MsoNormal><span lang=EN-US>CORBA is designed for language transparency: a client object can call
methods on a server object of different class, regardless of the language they
are implemented with. Of course, the client object must know the names and
signatures of methods that the server object exposes. This is where IDL comes
in. The CORBA IDL is a language-neutral way to specify data types, attributes,
operations, interfaces, and more. The IDL syntax is similar to the C++ or Java
syntax. The following table shows the correspondence between some of the
concepts common to three languages that can be specified through CORBA IDL:</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=110 valign=top style='width:82.6pt;border:solid black 1.5pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>CORBA IDL</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;border-top:solid black 1.5pt;
  border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Java</span></p>
  </td>
  <td width=144 valign=top style='width:108.0pt;border:solid black 1.5pt;
  border-left:none;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>C++</span></p>
  </td>
 </tr>
 <tr>
  <td width=110 valign=top style='width:82.6pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Module</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Package</span></p>
  </td>
  <td width=144 valign=top style='width:108.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Namespace</span></p>
  </td>
 </tr>
 <tr>
  <td width=110 valign=top style='width:82.6pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Interface</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Interface</span></p>
  </td>
  <td width=144 valign=top style='width:108.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Pure abstract
  class</span></p>
  </td>
 </tr>
 <tr>
  <td width=110 valign=top style='width:82.6pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Method</span></p>
  </td>
  <td width=84 valign=top style='width:63.0pt;border-top:none;border-left:none;
  border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Method</span></p>
  </td>
  <td width=144 valign=top style='width:108.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Member function</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>The inheritance concept is supported as
well, using the colon operator as in C++. The programmer writes an IDL
description of the attributes, methods, and interfaces that are implemented and
used by the server and clients. The IDL is then compiled by a vendor-provided
IDL/Java compiler, which reads the IDL source and generates Java code.</span></p>

<p class=MsoNormal><span lang=EN-US>The IDL compiler is an extremely useful
tool: it doesn’t just generate a Java source equivalent of the IDL, it also
generates the code that will be used to marshal method arguments and to make
remote calls. This code, called the stub and skeleton code, is organized in
multiple Java source files and is usually part of the same Java package. </span></p>

<h4><span lang=EN-US>The naming service</span></h4>

<p class=MsoNormal><span lang=EN-US>The naming service is one of the
fundamental CORBA services. A CORBA object is accessed through a reference, a
piece of information that’s not meaningful for the human reader. But references
can be assigned programmer-defined, string names. This operation is known as <i>stringifying
the reference</i>, and one of the OMA components, the Naming Service, is
devoted to performing string-to-object and object-to-string conversion and
mapping. Since the Naming Service acts as a telephone directory that both
servers and clients can consult and manipulate, it runs as a separate process.
Creating an object-to-string mapping is called <i>binding an object</i>, and
removing the mapping is called <i>unbinding</i>. Getting an object reference
passing a string is called <i>resolving the name</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>For example, on startup, a server
application could create a server object, bind the object into the name
service, and then wait for clients to make requests. A client first obtains a
server object reference, resolving the string name, and then can make calls
into the server using the reference.</span></p>

<p class=MsoNormal><span lang=EN-US>Again, the Naming Service specification is
part of CORBA, but the application that implements it is provided by the ORB
vendor. The way you get access to the Naming Service functionality can vary
from vendor to vendor. </span></p>

<h3><a name="_Toc481064900"><span lang=EN-US>An example</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The code shown here will not be elaborate
because different ORBs have different ways to access CORBA services, so
examples are vendor specific. (The example below uses JavaIDL, a free product
from Sun that comes with a light-weight ORB, a naming service, and an
IDL-to-Java compiler.) In addition, since Java is young and still evolving, not
all CORBA features are present in the various Java/CORBA products.</span></p>

<p class=MsoNormal><span lang=EN-US>We want to implement a server, running on
some machine, that can be queried for the exact time. We also want to implement
a client that asks for the exact time. In this case we’ll be implementing both
programs in Java, but we could also use two different languages (which often
happens in real situations).</span></p>

<h4><span lang=EN-US>Writing the IDL source</span></h4>

<p class=MsoNormal><span lang=EN-US>The first step is to write an IDL
description of the services provided. This is usually done by the server
programmer, who is then free to implement the server in any language in which a
CORBA IDL compiler exists. The IDL file is distributed to the client side
programmer and becomes the bridge between languages.</span></p>

<p class=MsoNormal><span lang=EN-US>The example below shows the IDL description
of our <b>ExactTime</b> server:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:corba:ExactTime.idl</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# You must install
idltojava.exe from </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# java.sun.com and
adjust the settings to use</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# your local C
preprocessor in order to compile</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# This file. See docs
at java.sun.com.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>module remotetime {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   interface ExactTime {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      string getTime();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   };</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}; ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This is a declaration of the <b>ExactTime</b>
interface inside the <b>remotetime</b> namespace. The interface is made up of
one single method that gives back the current time in <b>string</b> format.</span></p>

<h4><span lang=EN-US>Creating stubs and skeletons</span></h4>

<p class=MsoNormal><span lang=EN-US>The second step is to compile the IDL to
create the Java stub and skeleton code that we’ll use for implementing the
client and the server. The tool that comes with the JavaIDL product is </span><span lang=EN-US><b>idltojava</b>: </span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>idltojava
remotetime.idl</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This will automatically generate code for
both the stub and the skeleton. <b>Idltojava</b> generates a Java <b>package</b>
named after the IDL module, <b>remotetime</b>, and the generated Java files are
put in the <b>remotetime</b> subdirectory. <b>_ExactTimeImplBase.java </b>is
the skeleton that we’ll use to implement the server object, and <b>_ExactTimeStub.java</b>
will be used for the client. There are Java representations of the IDL interface
in <b>ExactTime.java</b> and a couple of other support files used, for example,
to facilitate access to the naming service operations.</span></p>

<h4><span lang=EN-US>Implementing the server and the client</span></h4>

<p class=MsoNormal><span lang=EN-US>Below you can see the code for the server
side. The server object implementation is in the <b>ExactTimeServer</b> class.
The <b>RemoteTimeServer</b> is the application that creates a server object,
registers it with the ORB, gives a name to the object reference, and then sits
quietly waiting for client requests.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:corba:RemoteTimeServer.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import remotetime.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
org.omg.CosNaming.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
org.omg.CosNaming.NamingContextPackage.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import org.omg.CORBA.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.text.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Server object
implementation</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class ExactTimeServer
extends _ExactTimeImplBase {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
getTime(){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return DateFormat.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
getTimeInstance(DateFormat.FULL).</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>          format(new
Date(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>             
System.currentTimeMillis()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Remote application
implementation</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
RemoteTimeServer {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Throw exceptions to
console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ORB creation and
initialization:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ORB orb =
ORB.init(args, null);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Create the server
object and register it:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ExactTimeServer
timeServerObjRef = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new ExactTimeServer();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
orb.connect(timeServerObjRef);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Get the root
naming context:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    org.omg.CORBA.Object
objRef = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
orb.resolve_initial_references(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
&quot;NameService&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    NamingContext ncRef
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
NamingContextHelper.narrow(objRef);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Assign a string
name to the </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // object reference
(binding):</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    NameComponent nc = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
NameComponent(&quot;ExactTime&quot;, &quot;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    NameComponent[] path
= { nc };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ncRef.rebind(path,
timeServerObjRef);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Wait for client
requests:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    java.lang.Object sync
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
java.lang.Object();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    synchronized(sync){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      sync.wait();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>As you can see, implementing the server
object is simple; it’s a regular Java class that inherits from the skeleton
code generated by the IDL compiler. Things get a bit more complicated when it
comes to interacting with the ORB and other CORBA services.</span></p>

<h4><span lang=EN-US>Some CORBA services</span></h4>

<p class=MsoNormal><span lang=EN-US>This is a short description of what the
JavaIDL-related code is doing (primarily ignoring the part of the CORBA code
that is vendor dependent). The first line in <b>main(&nbsp;)</b> starts up the
ORB, and of course, this is because our server object will need to interact
with it. Right after the ORB initialization, a server object is created.
Actually, the right term would be a <i>transient servant object</i>: an object
that receives requests from clients, and whose lifetime is the same as the
process that creates it. Once the transient servant object is created, it is
registered with the ORB, which means that the ORB knows of its existence and
can now forward requests to it.</span></p>

<p class=MsoNormal><span lang=EN-US>Up to this point, all we have is <b>timeServerObjRef</b>,
an object reference that is known only inside the current server process. The
next step will be to assign a stringified name to this servant object; clients
will use that name to locate the servant object. We accomplish this operation
using the Naming Service. First, we need an object reference to the Naming
Service; the call to <b>resolve_initial_references(&nbsp;)</b> takes the
stringified object reference of the Naming Service that is “NameService,” in
JavaIDL, and returns an object reference. This is cast to a specific <b>NamingContext</b>
reference using the <b>narrow(&nbsp;)</b> method. We can use now the naming
services.</span></p>

<p class=MsoNormal><span lang=EN-US>To bind the servant object with a
stringified object reference, we first create a <b>NameComponent</b> object,
initialized with “ExactTime,” the name string we want to bind to the servant
object. Then, using the <b>rebind(&nbsp;)</b> method, the stringified reference
is bound to the object reference. We use <b>rebind(&nbsp;)</b> to assign a
reference, even if it already exists, whereas <b>bind(&nbsp;)</b> raises an
exception if the reference already exists. A name is made up in CORBA by a
sequence of NameContexts—that’s why we use an array to bind the name to the
object reference.</span></p>

<p class=MsoNormal><span lang=EN-US>The servant object is finally ready for use
by clients. At this point, the server process enters a wait state. Again, this
is because it is a transient servant, so its lifetime is confined to the server
process. JavaIDL does not currently support persistent objects—objects that
survive the execution of the process that creates them.</span></p>

<p class=MsoNormal><span lang=EN-US>Now that we have an idea of what the server
code is doing, let’s look at the client code:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:corba:RemoteTimeClient.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import remotetime.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import
org.omg.CosNaming.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import org.omg.CORBA.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
RemoteTimeClient {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Throw exceptions to
console:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ORB creation and
initialization:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ORB orb =
ORB.init(args, null);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Get the root
naming context:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    org.omg.CORBA.Object
objRef = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      orb.resolve_initial_references(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
&quot;NameService&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    NamingContext ncRef
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
NamingContextHelper.narrow(objRef);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Get (resolve) the
stringified object </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // reference for the
time server:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    NameComponent nc = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
NameComponent(&quot;ExactTime&quot;, &quot;&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    NameComponent[] path
= { nc };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ExactTime timeObjRef
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
ExactTimeHelper.narrow(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
ncRef.resolve(path));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Make requests to
the server object:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String exactTime =
timeObjRef.getTime();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(exactTime);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The first few lines do the same as they do
in the server process: the ORB is initialized and a reference to the naming
service server is resolved. Next, we need an object reference for the servant
object, so we pass the stringified object reference to the <b>resolve(&nbsp;)</b>
method, and we cast the result into an <b>ExactTime</b> interface reference
using the <b>narrow(&nbsp;)</b> method. Finally, we call <b>getTime(&nbsp;)</b>.
</span></p>

<h4><span lang=EN-US>Activating the name service process</span></h4>

<p class=MsoNormal><span lang=EN-US>Finally we have a server and a client
application ready to interoperate. You’ve seen that both need the naming
service to bind and resolve stringified object references. You must start the
naming service process before running either the server or the client. In
JavaIDL, the naming service is a Java application that comes with the product
package, but it can be different with other products. The JavaIDL naming
service runs inside an instance of the JVM and listens by default to network
port 900.</span></p>

<h4><span lang=EN-US>Activating the server and the client</span></h4>

<p class=MsoNormal><span lang=EN-US>Now you are ready to start your server and
client application (in this order, since our server is transient). If
everything is set up correctly, what you’ll get is a single output line on the
client console window, giving you the current time. Of course, this might be
not very exciting by itself, but you should take one thing into account: even
if they are on the same physical machine, the client and the server application
are running inside different virtual machines and they can communicate via an
underlying integration layer, the ORB and the Naming Service.</span></p>

<p class=MsoNormal><span lang=EN-US>This is a simple example, designed to work
without a network, but an ORB is usually configured for location transparency.
When the server and the client are on different machines, the ORB can resolve
remote stringified references using a component known as the <i>Implementation
Repository</i>. Although the Implementation Repository is part of CORBA, there
is almost no specification, so it differs from vendor to vendor.</span></p>

<p class=MsoNormal><span lang=EN-US>As you can see, there is much more to CORBA
than what has been covered here, but you should get the basic idea. If you want
more information about CORBA, the place to start is the OMG Web site, at <i>www.omg.org</i>.
There you’ll find documentation, white papers, proceedings, and references to
other CORBA sources and products.</span></p>

<h3><a name="_Toc481064901"><span lang=EN-US>Java Applets and CORBA</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Java applets can act as CORBA clients. This
way, an applet can access remote information and services exposed as CORBA
objects. But an applet can connect only with the server from which it was
downloaded, so all the CORBA objects the applet interacts with must be on that
server. This is the opposite of what CORBA tries to do: give you complete
location transparency.</span></p>

<p class=MsoNormal><span lang=EN-US>This is an issue of network security. If
you’re on an intranet, one solution is to loosen the security restrictions on
the browser. Or, set up a firewall policy for connecting with external servers.</span></p>

<p class=MsoNormal><span lang=EN-US>Some Java ORB products offer proprietary
solutions to this problem. For example, some implement what is called HTTP
Tunneling, while others have their special firewall features.</span></p>

<p class=MsoNormal><span lang=EN-US>This is too complex a topic to be covered
in an appendix, but it is definitely something you should be aware of.</span></p>

<h3><a name="_Toc481064902"><span lang=IT>CORBA vs. RMI</span></a></h3>

<p class=MsoNormal><span lang=EN-US>You saw that one of the main CORBA features
is RPC support, which allows your local objects to call methods in remote
objects. Of course, there already is a native Java feature that does exactly
the same thing: RMI (see Chapter 15). While RMI makes RPC possible between Java
objects, CORBA makes RPC possible between objects implemented in any language.
It’s a big difference.</span></p>

<p class=MsoNormal><span lang=EN-US>However, </span><span
lang=EN-US>RMI can be used to call services on remote, non-Java code. All you
need is some kind of wrapper Java object around the non-Java code on the server
side. The wrapper object connects externally to Java clients via RMI, and
internally connects to the non-Java code using one of the techniques shown
above, such as JNI or J/Direct.</span></p>

<p class=MsoNormal><span lang=EN-US>This approach requires you to write a kind
of integration layer, which is exactly what CORBA does for you, but then you
don’t need a third-party ORB.</span></p>

<h2><a name="_Toc481064903"><span lang=EN-US>Enterprise JavaBeans</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Suppose</span><a href="#_ftn77"
name="_ftnref77" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[77]</span></span></span></span></a><span
lang=EN-US> you need to develop a multi-tiered application to view and update
records in a database through a Web interface. You can write a database
application using JDBC, a Web interface using JSP/servlets, and a distributed
system using CORBA/RMI. But what extra considerations must you make when
developing a distributed object system rather than just knowing API’s? Here are
the issues:</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Performance:</span></i></b><span
lang=EN-US> The distributed objects you create must perform well, as they could
potentially service many clients at a time. You’ll need to use optimization
techniques such as caching as well as pooling resources like database
connections. You’ll also have to manage the lifecycle of your distributed
objects.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Scalability</span></i></b><span
lang=EN-US>: The distributed objects must also be scalable. Scalability in a
distributed application means that the number of instances of your distributed
objects can be increased and moved onto additional machines without modifying
any code.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Security:</span></i></b><span
lang=EN-US> A distributed object must often manage the authorization of the
clients that access it. Ideally, you can add new users and roles to it without
recompilation.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Distributed Transactions:</span></i></b><span
lang=EN-US> A distributed object should be able to reference distributed
transactions transparently. For example, if you are working with two separated
databases, you should be able to update them simultaneously within the same
transaction and roll them both back if a certain criteria is not met.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Reusability:</span></i></b><span
lang=EN-US> The ideal distributed object can be effortlessly moved onto another
vendors’ application server. It would be nice if you could resell a distributed
object component without making special modifications, or buy someone else’s
component and use it without having to recompile or rewrite it.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Availability:</span></i></b><span
lang=EN-US> If one of the machines in the system goes down, clients should
automatically fail-over to backup copies of the objects running on other
machines.</span></p>

<p class=MsoNormal><span lang=EN-US>These considerations, in addition the
business problem that you set out to solve, can make for a daunting development
project. However, all the issues <i>except</i> for your business problem are
redundant—solutions must be reinvented for every distributed business
application.</span></p>

<p class=MsoNormal><span lang=EN-US>Sun, along with other leading distributed
object vendors, realized that sooner or later every development team would be
reinventing these particular solutions, so they created the Enterprise
JavaBeans specification (EJB). EJB describes a server-side component model that
tackles all of the considerations mentioned above using a standard approach
that allows developers to create business components called EJBs that are
isolated from low-level “plumbing” code and that focus solely on providing
business logic. Because EJB’s are defined in a standard way, they can vendor
independent.</span></p>

<h3><a name="_Toc481064904"></a><a name="_Toc466527406"><span lang=EN-US>JavaBeans</span></a><span
lang=EN-US> vs. EJBs</span></h3>

<p class=MsoNormal><span lang=EN-US>Because of the similarity in names, there
is much confusion about the relationship between the JavaBeans component model
and the Enterprise JavaBeans specification. While both the JavaBeans and
Enterprise JavaBeans specifications share the same objectives in promoting
reuse and portability of Java code between development and deployment tools
with the use of standard design patterns, the motives behind each specification
are geared to solve different problems.</span></p>

<p class=MsoNormal><span lang=EN-US>The standards defined in the JavaBeans
component model are designed for creating reusable components that are
typically used in IDE development tools and are commonly, although not
exclusively, visual components.</span></p>

<p class=MsoNormal><span lang=EN-US>The Enterprise JavaBeans specification
defines a component model for developing server side java code. Because EJBs
can potentially run on many different server-side platforms—including
mainframes that do not have visual displays—An EJB cannot make use of graphical
libraries such as AWT or Swing.</span></p>

<h3><a name="_Toc481064905"></a><a name="_Toc466527392"><span lang=EN-US>The
EJB specification</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The Enterprise JavaBeans specification
describes a server-side component model. It defines six roles that are used to
perform the tasks in development and deployment as well as defining the
components of the system. These roles are used in the development, deployment
and running of a distributed system. Vendors, administrators and developers
play the various roles, to allow the partitioning of technical and domain
knowledge. The vendor provides a technically sound framework and the developers
create domain-specific components; for example, an “accounting” component. The
same party can perform one or many roles. The roles defined in the EJB
specification are summarized in the following table:</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=480
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=144 valign=top style='width:108.0pt;border:solid black 1.5pt;
  border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Role</span></p>
  </td>
  <td width=336 valign=top style='width:252.0pt;border:solid black 1.5pt;
  border-left:none;padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Responsibility</span></p>
  </td>
 </tr>
 <tr>
  <td width=144 valign=top style='width:108.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Enterprise Bean
  Provider</span></p>
  </td>
  <td width=336 valign=top style='width:252.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>The developer
  responsible for creating reusable EJB components. These components are
  packaged into a special jar file (ejb-jar file).</span></p>
  </td>
 </tr>
 <tr>
  <td width=144 valign=top style='width:108.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Application
  Assembler</span></p>
  </td>
  <td width=336 valign=top style='width:252.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Creates and
  assembles applications from a collection of ejb-jar files. This includes
  writing applications that utilize the collection of EJBs (e.g., servlets,
  JSP, Swing etc. etc.).</span></p>
  </td>
 </tr>
 <tr>
  <td width=144 valign=top style='width:108.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Deployer</span></p>
  </td>
  <td width=336 valign=top style='width:252.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Takes the
  collection of ejb-jar files from the Assembler and/or Bean Provider and
  deploys them into a run-time environment: one or more EJB Containers. </span></p>
  </td>
 </tr>
 <tr>
  <td width=144 valign=top style='width:108.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>EJB
  Container/Server Provider </span></p>
  </td>
  <td width=336 valign=top style='width:252.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Provides a
  run-time environment and tools that are used to deploy, administer, and run
  EJB components.</span></p>
  </td>
 </tr>
 <tr>
  <td width=144 valign=top style='width:108.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>System
  Administrator</span></p>
  </td>
  <td width=336 valign=top style='width:252.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Manages the
  different components and services so that they are configured and they
  interact correctly, as well as ensuring that the system is up and running.</span></p>
  </td>
 </tr>
</table>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<h3><a name="_Toc481064906"></a><a name="_Toc466527394"><span lang=EN-US>EJB
components</span></a></h3>

<p class=MsoNormal><span lang=EN-US>EJB components are elements of reusable
business logic that adhere to strict standards and design patterns as defined
in the EJB specification. This allows the components to be portable. It also
allows other services—such as security, caching and distributed transactions—to
be performed on behalf of the components. An Enterprise Bean Provider is
responsible for developing EJB components.</span></p>

<h4><span lang=EN-US>EJB Container &amp; Server</span></h4>

<p class=MsoNormal><span lang=EN-US>The <i>EJB Container</i> is a run-time
environment that contains and runs EJB components and provides a set of
standard services to those components. The EJB Container’s responsibilities are
tightly defined by the specification to allow for vendor neutrality. The EJB
container provides the low-level “plumbing” of EJB, including distributed
transactions, security, lifecycle management of beans, caching, threading and
session management. The EJB Container Provider is responsible for providing an
EJB Container.</span></p>

<p class=MsoNormal><span lang=EN-US>An <i>EJB Server</i> is defined as an
Application Server that contains and runs one or more EJB Containers. The EJB
Server Provider is responsible for providing an EJB Server. You can generally
assume that the EJB Container and EJB Server are the same. </span></p>

<h4><span lang=EN-US>Java Naming and Directory Interface (JNDI)</span></h4>

<p class=MsoNormal><span lang=EN-US>Java Naming and Directory Interface (JNDI)
is used in Enterprise JavaBeans as the naming service for EJB Components on the
network and other container services such as transactions. JNDI maps very
closely to other naming and directory standards such as CORBA CosNaming and can
actually be implemeted as a wrapper on top of it. </span></p>

<h4><span lang=EN-US>Java Transaction API/Java Transaction Service (JTA/JTS)</span></h4>

<p class=MsoNormal><span lang=EN-US>JTA/JTS is used in Enterprise JavaBeans as
the transactional API. An Enterprise Bean Provider can use the JTS to create
transaction code, although the EJB Container commonly implements transactions in
EJB on the EJB components’ behalf. The deployer can define the transactional
attributes of an EJB component at deployment time. The EJB Container is
responsible for handling the transaction whether it is local or distributed.
The JTS specification is the Java mapping to the CORBA OTS (Object Transaction
Service)</span></p>

<h4><span lang=EN-US>CORBA and RMI/IIOP</span></h4>

<p class=MsoNormal><span lang=EN-US>The EJB specification defines
interoperability with CORBA through compatibility with CORBA protocols. This is
achieved by mapping EJB services such as JTS and JNDI to corresponding CORBA
services and the implementation of RMI on top of the CORBA protocol IIOP. </span></p>

<p class=MsoNormal><span lang=EN-US>Use of CORBA and RMI/IIOP in Enterprise
JavaBeans is implemented in the EJB Container and is the responsibility of the
EJB Container provider. Use of CORBA and RMI/IIOP in the EJB Container is
hidden from the EJB Component itself. This means that the Enterprise Bean
Provider can write their EJB Component and deploy it into any EJB Container
without any regard of which communication protocol is being used.</span></p>

<h3><a name="_Toc481064907"></a><a name="_Toc466527395"><span lang=EN-US>The
pieces of an EJB component</span></a></h3>

<p class=MsoNormal><span lang=EN-US>An EJB consists of a number of pieces,
including the Bean itself, the implementation of some interfaces, and an
information file. Everything is packaged together into a special jar file.</span></p>

<h4><a name="_Toc466527396"><span lang=EN-US>Enterprise Bean</span></a><span
lang=EN-US> </span></h4>

<p class=MsoNormal><span lang=EN-US>The Enterprise Bean is a Java class that
the Enterprise Bean Provider develops. It implements an Enterprise Bean
interface and provides the implementation of the business methods that the
component is to perform. The class does not implement any authorization,
authentication, multithreading, or transactional code.</span></p>

<h4><a name="_Toc466527397"><span lang=EN-US>Home interface</span></a></h4>

<p class=MsoNormal><span lang=EN-US>Every Enterprise Bean that is created must
have an associated Home interface. The Home interface is used as a factory for
your EJB. Clients use the Home interface to find an instance of your EJB or
create a new instance of your EJB.</span></p>

<h4><a name="_Toc466527398"><span lang=EN-US>Remote interface</span></a></h4>

<p class=MsoNormal><span lang=EN-US>The Remote interface is a Java Interface
that reflects the methods of your Enterprise Bean that you wish to expose to
the outside world. The Remote interface plays a similar role to a CORBA IDL
interface. </span></p>

<h4><a name="_Toc466527399"><span lang=EN-US>Deployment descriptor</span></a></h4>

<p class=MsoNormal><span lang=EN-US>The deployment descriptor is an XML file
that contains information about your EJB. Using XML allows the deployer to
easily change attributes about your EJB. The configurable attributes defined in
the deployment descriptor include: </span></p>

<p class=MsoNormal style='text-indent:0cm'><span lang=EN-US>The Home and Remote
interface names that are required by your EJB</span></p>

<p class=MsoNormal style='text-indent:0cm'><span lang=EN-US>The name to publish
into JNDI for your EJBs Home interface</span></p>

<p class=MsoNormal style='text-indent:0cm'><span lang=EN-US>Transactional
attributes for each method of your EJB</span></p>

<p class=MsoNormal style='text-indent:0cm'><span lang=EN-US>Access Control
Lists for authentication</span></p>

<h4><a name="_Toc466527400"><span lang=EN-US>EJB-Jar file</span></a></h4>

<p class=MsoNormal><span lang=EN-US>The EJB-Jar file is a normal java jar file
that contains your EJB, Home and Remote interfaces, as well as the deployment
descriptor.</span></p>

<h3><a name="_Toc481064908"></a><a name="_Toc466527401"><span lang=EN-US>EJB </span></a><span
lang=EN-US>operation</span></h3>

<p class=MsoNormal><span lang=EN-US>Once you have an EJB-Jar file containing
the Bean, the Home and Remote interfaces, and the deployment descriptor, you
can fit all of the pieces together and in the process understand why the Home
and Remote interfaces are needed and how the EJB Container uses them.</span></p>

<p class=MsoNormal><span lang=EN-US>The EJB Container implements the Home and
Remote interfaces that are in the EJB-Jar file. As mentioned earlier, the Home
interface provides methods to create and find your EJB. This means that the EJB
Container is responsible for the lifecycle management of your EJB. This level
of indirection allows for optimizations to occur. For example, 5 clients might
simultaneously request the creation of an EJB through a Home Interface, and the
EJB Container would respond by creating only one EJB and sharing it between all
5 clients. This is achieved through the Remote Interface, which is also
implemented by the EJB Container. The implemented Remote object plays the role
of a proxy object to the EJB.</span></p>

<p class=MsoNormal><span lang=EN-US>All calls to the EJB are ‘proxied’ through
the EJB Container via the Home and Remote interfaces. This indirection is the
reason why the EJB container can control security and transactional behavior.</span></p>

<h3><a name="_Toc481064909"></a><a name="_Toc466527403"><span lang=EN-US>Types
of EJBs</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The Enterprise JavaBeans specification
defines different types of EJBs that have different characteristics and
behaviors. Two categories of EJBs have been defined in the specification: <i>Session
Beans</i> and <i>Entity Beans</i>, and each categoriy has variations.</span></p>

<h4><a name="_Toc466527404"><span lang=EN-US>Session Beans</span></a></h4>

<p class=MsoNormal><span lang=EN-US>Session Beans are used to represent
Use-Cases or Workflow on behalf of a client. They represent operations on
persistent data, but not the persistent data itself. There are two types of
Session Beans, <i>Stateless</i> and <i>Stateful</i>. All Session Beans must
implement the <b>javax.ejb.SessionBean</b> interface. The EJB Container governs
the life of a Session Bean.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Stateless Session Beans </span></b><span
lang=EN-US>are the simplest type of EJB component to implement. They do not
maintain any conversational state with clients between method invocations so
they are easily reusable on the server side and because they can be cached,
they scale well on demand. When using Stateless Session Beans, all state must
be stored outside of the EJB.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Stateful Session Beans </span></b><span
lang=EN-US>maintain state between invocations. They have a one-to-one logical
mapping to a client and can maintain state within themselves. The EJB Container
is responsible for pooling and caching of Stateful Session Beans, which is
achieved through <i>Passivation</i> and <i>Activation</i>. If the EJB Container
crashes, data for all Stateful Session Beans could be lost. Some high-end EJB
Containers provide recovery for Stateful Session Beans.</span></p>

<h4><a name="_Toc466527405"><span lang=EN-US>Entity Beans</span></a></h4>

<p class=MsoNormal><span lang=EN-US>Entity Beans are components that represent
persistent data and behavior of this data. Entity Beans can be shared among
multiple clients, the same way that data in a database can be shared. The EJB
Container is responsible for caching Entity Beans and for maintaining the
integrity of the Entity Beans. The life of an Entity Bean outlives the EJB
Container, so if an EJB Container crashes, the Entity Bean is still expected to
be available when the EJB Container again becomes available.</span></p>

<p class=MsoNormal><span lang=EN-US>There are two types of Entity Beans: those
with Container Managed persistence and those with Bean-Managed persistence.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Container Managed Persistence (CMP)</span></b><span
lang=EN-US>. A CMP Entity Bean has its persistence implemented on its behalf by
the EJB Container. Through attributes specified in the deployment descriptor,
the EJB Container will map the Entity Bean’s attributes to some persistent
store (usually—but not always—a database). CMP reduces the development time for
the EJB, as well as dramatically reducing the amount of code required.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Bean Managed Persistence (BMP)</span></b><span
lang=EN-US>. A BMP Entity Bean has its persistence implemented by the
Enterprise Bean Provider. The Enterprise Bean Provider is responsible for
implementing the logic required to create a new EJB, update some attributes of
the EJBS, delete an EJB and find an EJB from persistent store. This usually
involves writing JDBC code to interact with a database or other persistent
store. With BMP, the developer is in full control of how the Entity Bean
persistence is managed.</span></p>

<p class=MsoNormal><span lang=EN-US>BMP also gives flexibility where a CMP
implementation may not be available. For example, if you wanted to create an
EJB that wrapped some code on an existing mainframe system, you could write
your persistence using CORBA.</span></p>

<h3><a name="_Toc481064910"></a><a name="_Toc476631340"><span lang=EN-US>Developing
an </span></a><span lang=EN-US>EJB</span></h3>

<p class=MsoNormal><span lang=EN-US>As an example, the “Perfect Time” example
from the previous RMI section will be implemented as an EJB component. The
example will be a simple Stateless Session Bean. </span></p>

<p class=MsoNormal><span lang=EN-US>As mentioned earlier, EJB components
consist of at least one class (the EJB) and two interfaces: the Remote and Home
interfaces. When you create a Remote interface for an EJB , you must follow
these guidelines:</span></p>

<p class=Numbered><span lang=EN-US>The remote interface must be <b>public</b>. </span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>128.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>The remote interface must extend the interface <b>javax.ejb.EJBObject</b>.
</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>129.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Each method in the remote interface must declare <b>java.rmi.RemoteException</b>
in its <b>throws</b> clause in addition to any application-specific exceptions.
</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>130.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Any object passed as an argument or return value (either directly or
embedded within a local object) must be a valid RMI-IIOP data type (this
includes other EJB objects).</span></p>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>Here is the simple remote
interface for the PerfectTime EJB:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:ejb:PerfectTime.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# You must install the
J2EE Java Enterprise </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# Edition from
java.sun.com and add j2ee.jar</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# to your CLASSPATH in
order to compile</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# this file. See
details at java.sun.com.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Remote Interface of
PerfectTimeBean</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.rmi.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.ejb.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
PerfectTime extends EJBObject {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public long
getPerfectTime() </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throws
RemoteException;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The Home interface is the factory where the
component will be created. It can define <i>create</i> methods, to create
instances of EJBs, or <i>finder</i> methods, which locate existing EJBs and are
used for Entity Beans only. When you create a Home interface for an EJB , you
must follow these guidelines:</span></p>

<p class=Numbered><span lang=EN-US>The Home interface must be <b>public</b>. </span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>131.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>The Home interface must extend the interface <b>javax.ejb.EJBHome</b>.
</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>132.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Each <i>create</i> method in the Home interface must declare <b>java.rmi.RemoteException</b>
in its <b>throws</b> clause as well as a <b>javax.ejb.CreateException</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>133.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>The return value of a <i>create</i> method must be a Remote
Interface.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>134.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>The return value of a <i>finder</i> method (Entity Beans only) must
be a Remote Interface or <b>java.util.Enumeration</b> or <b>java.util.Collection</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>135.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Any object passed as an argument (either directly or embedded within
a local object) must be a valid RMI-IIOP data type (this includes other EJB
objects)</span></p>

<p class=MsoNormal><span lang=EN-US>The standard naming convention for Home
interfaces is to take the Remote interface name and append “Home” to the end.
Here is the Home interface for the PerfectTime EJB:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:ejb:PerfectTimeHome.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Home Interface of
PerfectTimeBean.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.rmi.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.ejb.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public interface
PerfectTimeHome extends EJBHome {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public PerfectTime
create() </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throws
CreateException, RemoteException;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can now implement the business logic.
When you create your EJB implementation class, you must follow these
guidelines, (note that you should consult the EJB specification for a complete
list of guidelines when developing Enterprise JavaBeans):</span></p>

<p class=Numbered><span lang=EN-US>The class must be <b>public</b>. </span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>136.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>The class must implement an EJB interface (either <b>javax.ejb.SessionBean
</b>or<b> javax.ejb.EntityBean</b>). </span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>137.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>The class should define methods that map directly to the methods in
the Remote interface. Note that the class does not implement the Remote
interface; it mirrors the methods in the Remote interface but does <i>not</i>
throw <b>java.rmi.RemoteException</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>138.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Define one or more <b>ejbCreate(&nbsp;)</b> methods to initialize
your EJB.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>139.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>The return value and arguments of all methods must be valid RMI-IIOP
data types.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:ejb:PerfectTimeBean.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Simple Stateless
Session Bean </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// that returns current
system time.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.rmi.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import javax.ejb.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
PerfectTimeBean </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  implements SessionBean
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private SessionContext
sessionContext;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  //return current time</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public long
getPerfectTime() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     return
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // EJB methods</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
ejbCreate() </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws CreateException
{}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
ejbRemove() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
ejbActivate() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
ejbPassivate() {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
setSessionContext(SessionContext ctx) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sessionContext =
ctx;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>}///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Because this is a simple example, the EJB
methods (<b>ejbCreate(&nbsp;)</b>, <b>ejbRemove(&nbsp;)</b>, <b>ejbActivate(&nbsp;)</b>,
<b>ejbPassivate(&nbsp;)</b> ) are all empty. These methods are invoked by the
EJB Container and are used to control the state of the component. The <b>setSessionContext(&nbsp;)</b>
method passes a <b>javax.ejb.SessionContext</b> object which contains information
about the component’s context, such as the current transaction and security
information.</span></p>

<p class=MsoNormal><span lang=EN-US>After we have created the Enterprise
JavaBean, we then need to create a deployment descriptor. The deployment
descriptor is an XML file that describes the EJB component. The deployment
descriptor should be stored in a file called <b>ejb-jar.xml</b>.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:! c15:ejb:ejb-jar.xml</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;?xml
version=&quot;1.0&quot; encoding=&quot;Cp1252&quot;?&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;!DOCTYPE ejb-jar
PUBLIC '-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 1.1//EN'
'http://java.sun.com/j2ee/dtds/ejb-jar_1_1.dtd'&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;ejb-jar&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
&lt;description&gt;Example for Chapter 15&lt;/description&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
&lt;display-name&gt;&lt;/display-name&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
&lt;small-icon&gt;&lt;/small-icon&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
&lt;large-icon&gt;&lt;/large-icon&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
&lt;enterprise-beans&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &lt;session&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&lt;ejb-name&gt;PerfectTime&lt;/ejb-name&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &lt;home&gt;PerfectTimeHome&lt;/home&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&lt;remote&gt;PerfectTime&lt;/remote&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&lt;ejb-class&gt;PerfectTimeBean&lt;/ejb-class&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&lt;session-type&gt;Stateless&lt;/session-type&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
&lt;transaction-type&gt;Container&lt;/transaction-type&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &lt;/session&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
&lt;/enterprise-beans&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  &lt;ejb-client-jar&gt;&lt;/ejb-client-jar&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&lt;/ejb-jar&gt;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see the Component, the Remote
interface and the Home interface defined inside the <b>&lt;session&gt; </b>tag
of this deployment descriptor. Deployment descriptors may be automatically
generated using EJB development tools.</span></p>

<p class=MsoNormal><span lang=EN-US>Along with the standard <b>ejb-jar.xml </b>deployment
descriptor, the EJB specification states that any vendor specific tags should
be stored in a separate file. This is to achieve high portability between
components and different brands of EJB containers.</span></p>

<p class=MsoNormal><span lang=EN-US>The files must be archived inside a
standard Java Archive (JAR) file. The deployment descriptors should be placed
inside the <b>/META-INF </b>sub-directory of the Jar file.</span></p>

<p class=MsoNormal><span lang=EN-US>Once the EJB component is defined in the
deployment descriptor, the deployer should then deploy the EJB component into
the EJB Container. At the time of this writing, the deployment process was
quite “GUI intensive” and specific to each individual EJB Container, so this
overview does not document that process. Every EJB Container, however will have
a documented process for deploying an EJB.</span></p>

<p class=MsoNormal><span lang=EN-US>Because an EJB component is a distributed
object, the deployment process should also create some client stubs for calling
the EJB component. These classes should be placed on the classpath of the
client application. Because EJB components can be implemented on top of
RMI-IIOP (CORBA) or RMI-JRMP, the stubs generated could vary between EJB
Containers; nevertheless they are generated classes.</span></p>

<p class=MsoNormal><span lang=EN-US>When a client program wishes to invoke an
EJB, it must look up the EJB component inside JNDI and obtain a reference to
the home interface of the EJB component. The Home interface is used to create
an instance of the EJB. </span></p>

<p class=MsoNormal><span lang=EN-US>In this example the client program is a
simple Java program, but you should remember that it could just as easily be a
servlet, a JSP or even a CORBA or RMI distributed object.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
c15:ejb:PerfectTimeClient.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Client program for
PerfectTimeBean</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
PerfectTimeClient {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Get a JNDI context
using </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // the JNDI Naming
service:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  javax.naming.Context
context = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    new
javax.naming.InitialContext();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Look up the home
interface in the </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // JNDI Naming
service:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Object ref =
context.lookup(&quot;perfectTime&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Cast the remote
object to the home interface:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  PerfectTimeHome home =
(PerfectTimeHome)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
javax.rmi.PortableRemoteObject.narrow(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      ref,
PerfectTimeHome.class);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Create a remote
object from the home interface:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  PerfectTime pt =
home.create();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Invoke  getPerfectTime()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    &quot;Perfect Time
EJB invoked, time is: &quot; + </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    pt.getPerfectTime()
);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The sequence of the example is explained in
the comments. Note the use of the <b>narrow(&nbsp;)</b> method to perform a
kind of casting of the object before a Java cast is performed. This is very
similar to what happens in CORBA. Also note that the Home object becomes a
factory for <b>PerfectTime</b> objects.</span></p>

<h3><a name="_Toc481064911"><span lang=EN-US>EJB summary</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The Enterprise JavaBeans specification is a
dramatic step forward in the standardization and simplification of distributed
object computing. It is a major piece of the Java 2 Enterprise Edition (J2EE)
platform and is receiving much support from the distributed object community.
Many tools are currently available or will be available in the near future to
help accelerate the development of EJB components.</span></p>

<p class=MsoNormal><span lang=EN-US>This overview was only a brief tour of
EJBs. For more information about the EJB specification you should see the
official Enterprise JavaBeans home page at <i>java.sun.com/products/ejb/,</i>
where you can download the latest specification and the J2EE reference
implementation. These can be used to develop and deploy your own EJB
components.</span></p>

<h2><a name="_Toc481064912"><span lang=EN-US>Jini: distributed services</span></a></h2>

<p class=MsoNormal><span lang=EN-US>This section</span><a href="#_ftn78"
name="_ftnref78" title=""><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt'><span class=MsoFootnoteReference><span lang=EN-US
style='font-size:8.0pt;font-family:"Georgia","serif"'>[78]</span></span></span></span></a><span
lang=EN-US> gives an overview of Sun Microsystems’s Jini technology. It describes
some Jini nuts and bolts and shows how Jini’s architecture helps to raise the
level of abstraction in distributed systems programming, effectively turning
network programming into object-oriented programming. </span></p>

<h3><a name="_Toc481064913"><span lang=EN-US>Jini in context</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Traditionally, operating systems have been
designed with the assumption that a computer will have a processor, some
memory, and a disk. When you boot a computer, the first thing it does is look
for a disk. If it doesn’t find a disk, it can’t function as a computer.
Increasingly, however, computers are appearing in a different guise: as
embedded devices that have a processor, some memory, and a network
connection—but no disk. The first thing a cell phone does when you boot it up,
for example, is look for the telephone network. If it doesn’t find the network,
it can’t function as a cell phone. This trend in the hardware environment, from
disk-centric to network-centric, will affect how we organize the software—and
that’s where Jini comes in. </span></p>

<p class=MsoNormal><span lang=EN-US>Jini is an attempt to rethink computer architecture,
given the rising importance of the network and the proliferation of processors
in devices that have no disk drive. These devices, which will come from many
different vendors, will need to interact over a network. The network itself
will be very dynamic—devices and services will be added and removed regularly.
Jini provides mechanisms to enable smooth adding, removal, and finding of
devices and services on the network. In addition, Jini provides a programming
model that makes it easier for programmers to get their devices talking to each
other. </span></p>

<p class=MsoNormal><span lang=EN-US>Building on top of Java, object
serialization, and RMI (which together enable objects to move around the
network from virtual machine to virtual machine) Jini attempts to extend the
benefits of object-oriented programming to the network. Instead of requiring
device vendors to agree on the network protocols through which their devices
can interact, Jini enables the devices to talk to each other through interfaces
to objects.</span></p>

<h3><a name="_Toc481064914"><span lang=EN-US>What is Jini?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Jini is a set of APIs and network protocols
that can help you build and deploy distributed systems that are organized as <i>federations
of services</i>. A <i>service</i> can be anything that sits on the network and
is ready to perform a useful function. Hardware devices, software, communications
channels—even human users themselves—can be services. A Jini-enabled disk
drive, for example, could offer a “storage” service. A Jini-enabled printer
could offer a “printing” service. A federation of services, then, is a set of
services, currently available on the network, that a client (meaning a program,
service, or user) can bring together to help it accomplish some goal. </span></p>

<p class=MsoNormal><span lang=EN-US>To perform a task, a client enlists the
help of services. For example, a client program might upload pictures from the
image storage service in a digital camera, download the pictures to a
persistent storage service offered by a disk drive, and send a page of
thumbnail-sized versions of the images to the printing service of a color
printer. In this example, the client program builds a distributed system
consisting of itself, the image storage service, the persistent storage
service, and the color-printing service. The client and services of this
distributed system work together to perform the task: to offload and store
images from a digital camera and print a page of thumbnails. </span></p>

<p class=MsoNormal><span lang=EN-US>The idea behind the word <i>federation </i>is
that the Jini view of the network doesn’t involve a central controlling
authority. Because no one service is in charge, the set of all services
available on the network form a federation—a group composed of equal peers.
Instead of a central authority, Jini’s run-time infrastructure merely provides
a way for clients and services to find each other (via a lookup service, which
stores a directory of currently available services). After services locate each
other, they are on their own. The client and its enlisted services perform
their task independently of the Jini run-time infrastructure. If the Jini
lookup service crashes, any distributed systems brought together via the lookup
service before it crashed can continue their work. Jini even includes a network
protocol that clients can use to find services in the absence of a lookup
service. </span></p>

<h3><a name="_Toc481064915"><span lang=EN-US>How Jini works</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Jini defines a <i>run-time infrastructure </i>that
resides on the network and provides mechanisms that enable you to add, remove,
locate, and access services. The run-time infrastructure resides in three
places: in lookup services that sit on the network, in the service providers
(such as Jini-enabled devices), and in clients. <i>Lookup services </i>are the
central organizing mechanism for Jini-based systems. When new services become
available on the network, they register themselves with a lookup service. When
clients wish to locate a service to assist with some task, they consult a lookup
service. </span></p>

<p class=MsoNormal><span lang=EN-US>The run-time infrastructure uses one
network-level protocol, called <i>discovery</i>, and two object-level
protocols, called <i>join </i>and <i>lookup</i>. Discovery enables clients and
services to locate lookup services. Join enables a service to register itself
in a lookup service. Lookup enables a client to query for services that can
help accomplish its goals. </span></p>

<h3><a name="_Toc481064916"><span lang=EN-US>The discovery process</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Discovery works like this: Imagine you have
a Jini-enabled disk drive that offers a persistent storage service. As soon as
you connect the drive to the network, it broadcasts a <i>presence announcement </i>by
dropping a multicast packet onto a well-known port. Included in the presence
announcement is an IP address and port number where the disk drive can be
contacted by a lookup service. </span></p>

<p class=MsoNormal><span lang=EN-US>Lookup services monitor the well-known port
for presence announcement packets. When a lookup service receives a presence
announcement, it opens and inspects the packet. The packet contains information
that enables the lookup service to determine whether or not it should contact
the sender of the packet. If so, it contacts the sender directly by making a
TCP connection to the IP address and port number extracted from the packet.
Using RMI, the lookup service sends an object, called a <i>service registrar</i>,
across the network to the originator of the packet. The purpose of the service
registrar object is to facilitate further communication with the lookup
service. By invoking methods on this object, the sender of the announcement
packet can perform join and lookup on the lookup service. In the case of the
disk drive, the lookup service would make a TCP connection to the disk drive
and would send it a service registrar object, through which the disk drive
would then register its persistent storage service via the join process.</span></p>

<h3><a name="_Toc481064917"><span lang=EN-US>The join process</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Once a service provider has a service
registrar object, the end product of discovery, it is ready to do a join—to
become part of the federation of services that are registered in the lookup
service. To do a join, the service provider invokes the <b>register(&nbsp;) </b>method
on the service registrar object, passing as a parameter an object called a
service item, a bundle of objects that describe the service. The <b>register(&nbsp;)</b>
method sends a copy of the service item up to the lookup service, where the
service item is stored. Once this has completed, the service provider has
finished the join process: its service has become registered in the lookup
service. </span></p>

<p class=MsoNormal><span lang=EN-US>The service item is a container for several
objects, including an object called a <i>service object</i>, which clients can
use to interact with the service. The service item can also include any number
of <i>attributes</i>, which can be any object. Some potential attributes are
icons, classes that provide GUIs for the service, and objects that give more information
about the service. </span></p>

<p class=MsoNormal><span lang=EN-US>Service objects usually implement one or
more interfaces through which clients interact with the service. For example, a
lookup service is a Jini service, and its service object is the service
registrar. The <b>register(&nbsp;)</b> method invoked by service providers
during join is declared in the <b>ServiceRegistrar</b> interface (a member of
the <b>net.jini.core.lookup</b> package), which all service registrar objects
implement. Clients and service providers talk to the lookup service through the
service registrar object by invoking methods declared in the <b>ServiceRegistrar</b>
interface. Likewise, a disk drive would provide a service object that
implemented some well-known storage service interface. Clients would look up
and interact with the disk drive by this storage service interface. </span></p>

<h3><a name="_Toc481064918"><span lang=EN-US>The lookup process</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Once a service has registered with a lookup
service via the join process, that service is available for use by clients who
query that lookup service. To build a distributed system of services that will work
together to perform some task, a client must locate and enlist the help of the
individual services. To find a service, clients query lookup services via a
process called <i>lookup</i>. </span></p>

<p class=MsoNormal><span lang=EN-US>To perform a lookup, a client invokes the <b>lookup</b>(&nbsp;)
method on a service registrar object. (A client, like a service provider, gets
a service registrar through the previously-described process of discovery.) The
client passes as an argument to <b>lookup(&nbsp;)</b> a <i>service template</i>,
an object that serves as search criteria for the query. The service template
can include a reference to an array of <b>Class</b> objects. These <b>Class</b>
objects indicate to the lookup service the Java type (or types) of the service
object desired by the client. The service template can also include a <i>service
ID</i>, which uniquely identifies a service, and attributes, which must exactly
match the attributes uploaded by the service provider in the service item. The
service template can also contain wildcards for any of these fields. A wildcard
in the service ID field, for example, will match any service ID. The <b>lookup(&nbsp;)
</b>method sends the service template to the lookup service, which performs the
query and sends back zero to any matching service objects. The client gets a
reference to the matching service objects as the return value of the <b>lookup(&nbsp;)</b>
method. </span></p>

<p class=MsoNormal><span lang=EN-US>In the general case, a client looks up a
service by Java type, usually an interface. For example, if a client needed to
use a printer, it would compose a service template that included a <b>Class </b>object
for a well-known interface to printer services. All printer services would
implement this well-known interface. The lookup service would return a service
object (or objects) that implemented this interface. Attributes can be included
in the service template to narrow the number of matches for such a type-based
search. The client would use the printer service by invoking methods from the
well-known printer service interface on the service object. </span></p>

<h3><a name="_Toc481064919"><span lang=EN-US>Separation of interface and
implementation</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Jini’s architecture brings object-oriented
programming to the network by enabling network services to take advantage of
one of the fundamentals of objects: the separation of interface and
implementation. For example, a service object can grant clients access to the
service in many ways. The object can actually represent the entire service,
which is downloaded to the client during lookup and then executed locally.
Alternatively, the service object can serve merely as a proxy to a remote
server. Then when the client invokes methods on the service object, it sends
the requests across the network to the server, which does the real work. A
third option is for the local service object and a remote server to each do
part of the work. </span></p>

<p class=MsoNormal><span lang=EN-US>One important consequence of Jini’s
architecture is that the network protocol used to communicate between a proxy
service object and a remote server does not need to be known to the client. As
illustrated in the figure below, the network protocol is part of the service’s
implementation. This protocol is a private matter decided upon by the developer
of the service. The client can communicate with the service via this private
protocol because the service injects some of its own code (the service object)
into the client’s address space. The injected service object could communicate
with the service via RMI, CORBA, DCOM, some home-brewed protocol built on top
of sockets and streams, or anything else. The client simply doesn’t need to
care about network protocols, because it can talk to the well-known interface
that the service object implements. The service object takes care of any
necessary communication on the network. </span></p>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US><img
border=0 width=471 height=165 src="TIJ2_files/image032.png"></span></p>

<p class=MsoNormal align=center style='text-align:center'><b><span lang=EN-US>The
client talks to the service through a well-known interface</span></b></p>

<p class=MsoNormal><span lang=EN-US>Different implementations of the same
service interface can use completely different approaches and network
protocols. A service can use specialized hardware to fulfill client requests,
or it can do all its work in software. In fact, the implementation approach
taken by a single service can evolve over time. The client can be sure it has a
service object that understands the current implementation of the service,
because the client receives the service object (by way of the lookup service)
from the service provider itself. To the client, a service looks like the
well-known interface, regardless of how the service is implemented. </span></p>

<h3><a name="_Toc481064920"><span lang=EN-US>Abstracting distributed systems</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Jini attempts to raise the level of
abstraction for distributed systems programming, from the network protocol
level to the object interface level. In the emerging proliferation of embedded
devices connected to networks, many pieces of a distributed system may come
from different vendors. Jini makes it unnecessary for vendors of devices to
agree on network level protocols that allow their devices to interact. Instead,
vendors must agree on Java interfaces through which their devices can interact.
The processes of discovery, join, and lookup, provided by the Jini run-time
infrastructure, enable devices to locate each other on the network. Once they
locate each other, devices can communicate with each other through Java
interfaces.</span></p>

<h2><a name="_Toc481064921"><span lang=EN-US>Summary</span></a></h2>

<p class=Code style='margin-bottom:9.0pt;line-height:14.0pt;border:none'><span
lang=EN-US style='font-family:"Georgia","serif"'>Along with Jini for local
device networks, this chapter has introduced some, but not all, of the
components that Sun refers to as J2EE: the <i>Java 2 Enterprise Edition</i>.
The goal of J2EE is to build a set of tools that allows the Java developer to
build server-based applications much more quickly, and in a
platform-independent way. It’s not only difficult and time-consuming to build
such applications, but it’s especially hard to build them so that they can be
easily ported to other platforms, and also to keep the business logic separated
from the underlying details of the implementation. J2EE provides a framework to
assist in creating server-based applications; these applications are in demand
now, and that demand appears to be increasing.</span></p>

<h2><a name="_Toc481064922"></a><a name="_Toc375545500"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Compile and run the <b>JabberServer</b> and <b>JabberClient</b>
programs in this chapter. Now edit the files to remove all of the buffering for
the input and output, then compile and run them again to observe the results.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>244. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a server that asks for a password, then
opens a file and sends the file over the network connection. Create a client
that connects to this server, gives the appropriate password, then captures and
saves the file. Test the pair of programs on your machine using the <b>localhost</b>
(the local loopback IP address <b>127.0.0.1</b> produced by calling <b>InetAddress.getByName(null)</b>).</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>245. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify the server in Exercise 2 so that it uses
multithreading to handle multiple clients.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>246. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>JabberClient.java</b> so that output
flushing doesn’t occur and observe the effect. </span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>247. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>MultiJabberServer</b> so that it uses <i>thread
pooling</i>. Instead of throwing away a thread each time a client disconnects,
the thread should put itself into an “available pool” of threads. When a new
client wants to connect, the server will look in the available pool for a
thread to handle the request, and if one isn’t available, make a new one. This
way the number of threads necessary will naturally grow to the required
quantity. The value of thread pooling is that it doesn’t require the overhead
of creating and destroying a new thread for each new client.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>248. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Starting with <b>ShowHTML.java</b>, create an
applet that is a password-protected gateway to a particular portion of your Web
site.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>249. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>CIDCreateTables.java</b> so that it
reads the SQL strings from a text file instead of <b>CIDSQL</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>250. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Configure your system so that you can
successfully execute <b>CIDCreateTables.java</b> and <b>LoadDB.java</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>251. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>ServletsRule.java</b> by overriding
the <b>destroy(&nbsp;)</b> method to save the value of <b>i</b> to a file, and
and the <b>init(&nbsp;)</b> method to restore the value. Demonstrate that it
works by rebooting the servlet container. If you do not have an existing
servlet container, you will need to download, install, and run Tomcat from <a
name=BBB></a><i>jakarta.apache.org</i> in order to run servlets.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>252. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a servlet that adds a cookie to the
response object, thereby storing it on the client’s site. Add code to the
servlet that retrieves and displays the cookie. If you do not have an existing
servlet container, you will need to download, install, and run Tomcat from <i>jakarta.apache.org</i>
in order to run servlets.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>253. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a servlet that uses a <b>Session</b>
object to store session information of your choosing. In the same servlet,
retrieve and display that session information. If you do not have an existing
servlet container, you will need to download, install, and run Tomcat from <i>jakarta.apache.org</i>
in order to run servlets.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>254. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a servlet that changes the inactive
interval of a session to 5 seconds by calling <b>getMaxInactiveInterval(&nbsp;)</b>.
Test to see that the session does indeed expire after 5 seconds. If you do not
have an existing servlet container, you will need to download, install, and run
Tomcat from <i>jakarta.apache.org</i> in order to run servlets.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>255. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a JSP page that prints a line of text
using the &lt;H1&gt; tag. Set the color of this text randomly, using Java code
embedded in the JSP page. If you do not have an existing JSP container, you
will need to download, install, and run Tomcat from <i>jakarta.apache.org</i>
in order to run JSPs.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>256. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify the maximum age value in <b>Cookies.jsp</b>
and observe the behavior under two different browsers. Also note the difference
between just re-visiting the page, and shutting down and restarting the
browser. If you do not have an existing JSP container, you will need to
download, install, and run Tomcat from <i>jakarta.apache.org</i> in order to
run JSPs.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>257. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a JSP with a field that allows the user
to enter the session expiration time and and a second field that holds data
that is stored in the session. The submit button refreshes the page and fetches
the current expiration time and session data and puts them in as default values
of the aforementioned fields. If you do not have an existing JSP container, you
will need to download, install, and run Tomcat from <i>jakarta.apache.org</i>
in order to run JSPs.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>258. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>(More challenging) Take the <b>VLookup.java</b>
program and modify it so that when you click on the resulting name it
automatically takes that name and copies it to the clipboard (so you can simply
paste it into your email). You’ll need to look back at Chapter 13 to remember
how to use the clipboard in JFC.<a name="Chapter_13"></a></span></p>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection22>

<h1><a name="_Toc375545505"></a><a name="_Toc481064923"></a><a
name="_Toc477690736"></a><a name="_Toc375545421"></a><a name="Appendix_A"></a><span
lang=EN-US>A: Passing &amp; Returning Objects</span></h1>

<p class=Intro><span lang=EN-US>By now you should be reasonably comfortable
with the idea that when you’re “passing” an object, you’re actually passing a
reference.</span></p>

<p class=MsoNormal><span lang=EN-US>In many programming languages you can use
that language’s “regular” way to pass objects around, and most of the time everything
works fine. But it always seems that there comes a point at which you must do
something irregular and suddenly things get a bit more complicated (or in the
case of C++, quite complicated). Java is no exception, and it’s important that
you understand exactly what’s happening as you pass objects around and
manipulate them. This appendix will provide that insight.</span></p>

<p class=MsoNormal><span lang=EN-US>Another way to pose the question of this
appendix, if you’re coming from a programming language so equipped, is “Does </span><span lang=EN-US>Java have pointers?” Some have claimed that pointers are hard and
dangerous and therefore bad, and since Java is all goodness and light and will
lift your earthly programming burdens, it cannot possibly contain such things.
However, it’s more accurate to say that Java has pointers; indeed, every object
identifier in Java (except for primitives) is one of these pointers, but their
use is restricted and guarded not only by the compiler but by the run-time
system. Or to put it another way, Java has pointers, but no pointer arithmetic.
These are what I’ve been calling “references,” and you can think of them as
“safety pointers,” not unlike the safety scissors of elementary school—they
aren’t sharp, so you cannot hurt yourself without great effort, but they can
sometimes be slow and tedious.</span></p>

<h2><a name="_Toc481064924"></a><a name="_Toc375545422"><span lang=EN-US>Passing
references around</span></a></h2>

<p class=MsoNormal><span lang=EN-US>When you pass a </span><span lang=EN-US>reference into a method, you’re still pointing to the same object. A
simple experiment demonstrates this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:PassReferences.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Passing references
around.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
PassReferences {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
f(PassReferences h) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;h
inside f(): &quot; + h);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    PassReferences p =
new PassReferences();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;p inside main(): &quot; + p);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(p);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The method <b>toString(&nbsp;)</b> is
automatically invoked in the print statements, and <b>PassReferences</b>
inherits directly from <b>Object</b> with no redefinition of <b>toString(&nbsp;)</b>.
Thus, <b>Object</b>’s version of <b>toString(&nbsp;) </b>is used, which prints
out the class of the object followed by the address where that object is
located (not the reference, but the actual object storage). The output looks
like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>p inside main():
PassReferences@1653748</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>h inside f():
PassReferences@1653748</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You can see that both <b>p</b> and <b>h</b>
refer to the same object. This is far more efficient than duplicating a new <b>PassReferences</b>
object just so that you can send an argument to a method. But it brings up an
important issue.</span></p>

<h3><a name="_Toc481064925"></a><a name="_Toc375545423"><span lang=EN-US>Aliasing</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Aliasing means that more than one reference is tied to the same object,
as in the above example. The problem with aliasing occurs when someone <i>writes</i>
to that object. If the owners of the other references aren’t expecting that
object to change, they’ll be surprised. This can be demonstrated with a simple
example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: appendixa:Alias1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Aliasing two
references to one object.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Alias1 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Alias1(int ii) { i =
ii; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Alias1 x = new
Alias1(7);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Alias1 y = x; //
Assign the reference</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;x:
&quot; + x.i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;y: &quot; + y.i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Incrementing x&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x.i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;x: &quot; + x.i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;y: &quot; + y.i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In the line:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Alias1 y = x; //
Assign the reference</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>a new <b>Alias1</b> reference is created,
but instead of being assigned to a fresh object created with <b>new</b>, it’s
assigned to an existing reference. So the contents of reference <b>x</b>, which
is the address of the object <b>x</b> is pointing to, is assigned to <b>y</b>,
and thus both <b>x</b> and <b>y</b> are attached to the same object. So when <b>x</b>’s
<b>i</b> is incremented in the statement:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>x.i++;</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>y</span></b><span lang=EN-US>’s <b>i </b>will
be affected as well. This can be seen in the output:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x: 7</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>y: 7</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Incrementing x</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x: 8</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>y: 8</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>One good solution in this case is to simply
not do it: don’t consciously alias more than one reference to an object at the
same scope. Your code will be much easier to understand and debug. However,
when you’re passing a reference in as an argument—which is the way Java is
supposed to work—you automatically alias because the local reference that’s
created can modify the “outside object” (the object that was created outside
the scope of the method). Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:Alias2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Method calls
implicitly alias their</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// arguments.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Alias2 {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Alias2(int ii) { i =
ii; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void f(Alias2
reference) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    reference.i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Alias2 x = new
Alias2(7);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;x: &quot; + x.i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Calling f(x)&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;x:
&quot; + x.i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>x: 7</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Calling f(x)</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>x: 8</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The method is changing its argument, the
outside object. When this kind of situation arises, you must decide whether it
makes sense, whether the user expects it, and whether it’s going to cause
problems.</span></p>

<p class=MsoNormal><span lang=EN-US>In general, you call a method in order to
produce a return value and/or a change of state in the object <i>that the
method is called for</i>. (A method is how you “send a message” to that
object.) It’s much less common to call a method in order to manipulate its
arguments; this is referred to as “calling a method for its </span><span lang=EN-US><i>side effects</i>.” Thus, when you create a method that modifies
its arguments the user must be clearly instructed and warned about the use of
that method and its potential surprises. Because of the confusion and pitfalls,
it’s much better to avoid changing the argument.</span></p>

<p class=MsoNormal><span lang=EN-US>If you need to modify an argument during a
method call and you don’t intend to modify the outside argument, then you
should protect that argument by making a copy inside your method. That’s the
subject of much of this appendix.</span></p>

<h2><a name="_Toc481064926"><span lang=EN-US>Making local copies</span></a></h2>

<p class=MsoNormal><span lang=EN-US>To review: All argument passing in Java is
performed by passing references. That is, when you pass “an object,” you’re
really passing only a reference to an object that lives outside the method, so
if you perform any modifications with that reference, you modify the outside
object. In addition:</span></p>

<p class=BulletTIJ><span lang=EN-US style='font-family:Symbol'>¨<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Aliasing happens automatically during argument passing.</span></p>

<p class=BulletTIJ><span lang=EN-US style='font-family:Symbol'>¨<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>There are no local objects, only local references.</span></p>

<p class=BulletTIJ><span lang=EN-US style='font-family:Symbol'>¨<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>References have scopes, objects do not.</span></p>

<p class=BulletTIJ><span lang=EN-US style='font-family:Symbol'>¨<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>Object lifetime is never an issue in Java.</span></p>

<p class=BulletTIJ><span lang=EN-US style='font-family:Symbol'>¨<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-US>There is no language support (e.g., “const”) to prevent objects from
being modified (that is, to prevent the negative effects of aliasing).</span></p>

<p class=MsoNormal><span lang=EN-US>If you’re only reading information from an
object and not modifying it, passing a reference is the most efficient form of
argument passing. This is nice; the default way of doing things is also the
most efficient. However, sometimes it’s necessary to be able to treat the
object as if it were “local” so that changes you make affect only a local copy
and do not modify the outside object. Many programming languages support the
ability to automatically make a local copy of the outside object, inside the
method</span><a href="#_ftn79" name="_ftnref79" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[79]</span></span></span></span></a><span lang=EN-US>. Java
does not, but it allows you to produce this effect.</span></p>

<h3><a name="_Toc481064927"><span lang=EN-US>Pass by value</span></a></h3>

<p class=MsoNormal><span lang=EN-US>This brings up the terminology issue, which
always seems good for an argument. The term is “</span><span
lang=EN-US>pass by value,” and the meaning depends on how you perceive the
operation of the program. The general meaning is that you get a local copy of
whatever you’re passing, but the real question is how you think about what
you’re passing. When it comes to the meaning of “pass by value,” there are two
fairly distinct camps:</span></p>

<p class=Numbered><span lang=EN-US>Java passes everything by value. When you’re
passing primitives into a method, you get a distinct copy of the primitive.
When you’re passing a reference into a method, you get a copy of the reference.
Ergo, everything is pass-by-value. Of course, the assumption is that you’re
always thinking (and caring) that references are being passed, but it seems
like the Java design has gone a long way toward allowing you to ignore (most of
the time) that you’re working with a reference. That is, it seems to allow you
to think of the reference as “the object,” since it implicitly dereferences it
whenever you make a method call.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>140.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Java passes primitives by value (no argument there), but objects are
passed by reference. This is the world view that the reference is an alias for
the object, so you <i>don’t</i> think about passing references, but instead say
“I’m passing the object.” Since you don’t get a local copy of the object when
you pass it into a method, objects are clearly not passed by value. There
appears to be some support for this view within Sun, since one of the “reserved
but not implemented” keywords was <b>byvalue</b>. (There’s no knowing, however,
whether that keyword will ever see the light of day.)</span></p>

<p class=MsoNormal><span lang=EN-US>Having given both camps a good airing, and
after saying “It depends on how you think of a reference,” I will attempt to
sidestep the issue. In the end, it isn’t <i>that</i> important—what is
important is that you understand that passing a reference allows the caller’s
object to be changed unexpectedly.</span></p>

<h3><a name="_Toc481064928"></a><a name="_Toc375545425"><span lang=EN-US>Cloning
objects</span></a></h3>

<p class=MsoNormal><span lang=EN-US>The most likely reason for making a local
copy of an object is if you’re going to modify that object and you don’t want
to modify the caller’s object. If you decide that you want to make a local
copy, you simply use the <b>clone(&nbsp;)</b> method to perform the operation.
This is a method that’s defined as <b>protected </b>in the base class <b>Object</b>,
and which you must override as <b>public </b>in any derived classes that you
want to clone. For example, the standard library class <b>ArrayList</b>
overrides <b>clone(&nbsp;)</b>, so we can call <b>clone(&nbsp;)</b> for <b>ArrayList</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:Cloning.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The clone() operation
works for only a few</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// items in the standard
Java library.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Int {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Int(int ii) { i
= ii; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
increment() { i++; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
Integer.toString(i); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Cloning {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList v = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++ )</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v.add(new Int(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;v: &quot; + v);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList v2 =
(ArrayList)v.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Increment all
v2's elements:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(Iterator e =
v2.iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        e.hasNext(); )</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
((Int)e.next()).increment();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // See if it changed
v's elements:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;v: &quot; + v);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>clone(&nbsp;)</b> method produces an
<b>Object</b>, which must then be recast to the proper type. This example shows
how <b>ArrayList</b>’s<b> clone(&nbsp;)</b> method <i>does not</i>
automatically try to clone each of the objects that the <b>ArrayList</b>
contains—the old <b>ArrayList</b> and the cloned <b>ArrayList</b> are aliased
to the same objects. This is often called a </span><span lang=EN-US><i>shallow copy,</i> since it’s copying only the “surface” portion of
an object. The actual object consists of this “surface,” plus all the objects
that the references are pointing to, plus all the objects <i>those </i>objects
are pointing to, etc. This is often referred to as the “</span><span lang=EN-US>web of objects.” Copying the entire mess is called a </span><span lang=EN-US><i>deep copy.</i></span></p>

<p class=MsoNormal><span lang=EN-US>You can see the effect of the shallow copy
in the output, where the actions performed on <b>v2 </b>affect <b>v</b>:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>v: [0, 1, 2, 3, 4, 5, 6,
7, 8, 9]</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>v: [1, 2, 3, 4, 5,
6, 7, 8, 9, 10]</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Not trying to <b>clone(&nbsp;) </b>the
objects contained in the <b>ArrayList </b>is probably a fair assumption because
there’s no guarantee that those objects <i>are</i> cloneable</span><a
href="#_ftn80" name="_ftnref80" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[80]</span></span></span></span></a><span
lang=EN-US>.</span></p>

<h3><a name="_Toc481064929"></a><a name="_Toc375545426"><span lang=EN-US>Adding
cloneability to a class</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Even though the clone method is defined in
the base-of-all-classes <b>Object</b>, cloning is <i>not </i>automatically
available in every class</span><a href="#_ftn81" name="_ftnref81" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[81]</span></span></span></span></a><span lang=EN-US>. This
would seem to be counterintuitive to the idea that base-class methods are
always available in derived classes. Cloning in Java goes against this idea; if
you want it to exist for a class, you must specifically add code to make
cloning work.</span></p>

<h4><span lang=EN-US>Using a trick with <b>protected</b></span></h4>

<p class=MsoNormal><span lang=EN-US>To prevent default cloneability in every
class you create, the </span><span
lang=EN-US><b>clone(&nbsp;)</b> method is <b>protected</b> in the base class <b>Object</b>.
Not only does this mean that it’s not available by default to the client
programmer who is simply using the class (not subclassing it), but it also
means that you cannot call <b>clone(&nbsp;)</b> via a reference to the base
class. (Although that might seem to be useful in some situations, such as to
polymorphically clone a bunch of <b>Object</b>s.) It is in effect a way to give
you, at compile-time, the information that your object is not cloneable—and
oddly enough most classes in the standard Java library are not cloneable. Thus,
if you say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Integer x = new
Integer(1);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>    x = x.clone();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You will get, at compile-time, an error
message that says <b>clone(&nbsp;) </b>is not accessible (since <b>Integer</b>
doesn’t override it and it defaults to the <b>protected</b> version). </span></p>

<p class=MsoNormal><span lang=EN-US>If, however, you’re in a class derived from
<b>Object </b>(as all classes are), then you have permission to call <b>Object.clone(&nbsp;)
</b>because it’s </span><span
lang=EN-US><b>protected </b>and you’re an inheritor. The base class <b>clone(&nbsp;)
</b>has useful functionality—it performs the actual bitwise duplication <i>of
the derived-class object</i>, thus acting as the common cloning operation.
However, you then need to make <i>your</i> clone operation <b>public</b> for it
to be accessible. </span><span lang=EN-US>So, two key issues when you clone
are: </span></p>

<p class=MsoNormal style='text-indent:0cm'><span lang=EN-US>Virtually always
call <b>super.clone(&nbsp;) </b></span></p>

<p class=MsoNormal style='text-indent:0cm'><span lang=EN-US>Make your clone <b>public</b></span></p>

<p class=MsoNormal><span lang=EN-US>You’ll probably want to override <b>clone(&nbsp;)
</b>in any further derived classes, otherwise your (now <b>public</b>) <b>clone(&nbsp;)</b>
will be used, and that might not do the right thing (although, since <b>Object.clone(&nbsp;)</b>
makes a copy of the actual object, it might). The <b>protected</b> trick works
only once—the first time you inherit from a class that has no cloneability and
you want to make a class that’s cloneable. In any classes inherited from your
class the <b>clone(&nbsp;) </b>method is available since it’s not possible in
Java to reduce the access of a method during derivation. That is, once a class
is cloneable, everything derived from it is cloneable unless you use provided
mechanisms (described later) to “turn off” cloning.</span></p>

<h4><span lang=EN-US>Implementing the <b>Cloneable</b> interface</span></h4>

<p class=MsoNormal><span lang=EN-US>There’s one more thing you need to do to
complete the cloneability of an object: implement the </span><span
lang=EN-US><b>Cloneable</b> <b>interface</b>. This </span><span
lang=EN-US><b>interface</b> is a bit strange, because it’s empty!</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>interface
Cloneable {}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The reason for implementing this empty <b>interface</b>
is obviously not because you are going to upcast to <b>Cloneable</b> and call
one of its methods. The use of <b>interface</b> here is considered by some to
be a “hack” because it’s using a feature for something other than its original
intent. Implementing the <b>Cloneable</b> <b>interface</b> acts as a kind of a
flag, wired into the type of the class. </span></p>

<p class=MsoNormal><span lang=EN-US>There are two reasons for the existence of
the <b>Cloneable</b> <b>interface</b>. First, you might have an upcast
reference to a base type and not know whether it’s possible to clone that
object. In this case, you can use the <b>instanceof</b> keyword (described in
Chapter 12) to find out whether the reference is connected to an object that
can be cloned:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>if(myReference
instanceof Cloneable) // ...</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The second reason is that mixed into this
design for cloneability was the thought that maybe you didn’t want all types of
objects to be cloneable. So <b>Object.clone(&nbsp;)</b> verifies that a class
implements the <b>Cloneable</b> interface. If not, it throws a <b>CloneNotSupportedException</b>
exception. So in general, you’re forced to <b>implement Cloneable</b> as part
of support for cloning.</span></p>

<h3><a name="_Toc481064930"></a><a name="_Toc375545427"><span lang=EN-US>Successful
</span></a><span lang=EN-US>cloning</span></h3>

<p class=MsoNormal><span lang=EN-US>Once you understand the details of
implementing the <b>clone(&nbsp;)</b> method, you’re able to create classes
that can be easily duplicated to provide a local copy:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:LocalCopy.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Creating local copies
with clone().</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MyObject
implements Cloneable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  MyObject(int ii) { i =
ii; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object o = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      o = super.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(CloneNotSupportedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;MyObject can't clone&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return o;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
Integer.toString(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class LocalCopy {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static MyObject
g(MyObject v) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Passing a
reference, modifies outside object:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    v.i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return v;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static MyObject
f(MyObject v) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    v =
(MyObject)v.clone(); // Local copy</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    v.i++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return v;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MyObject a = new
MyObject(11);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MyObject b = g(a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Testing reference
equivalence,</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // not object
equivalence:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(a == b) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;a == b&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;a != b&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;a = &quot; + a);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;b = &quot; + b);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MyObject c = new
MyObject(47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MyObject d = f(c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(c == d) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;c == d&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    else </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.out.println(&quot;c != d&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;c = &quot; + c);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;d = &quot; + d);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>First of all, <b>clone(&nbsp;)</b> must be
accessible so you must make it <b>public</b>. Second, for the initial part of
your <b>clone(&nbsp;)</b> operation you should call the base-class version of <b>clone(&nbsp;)</b>.
The <b>clone(&nbsp;)</b> that’s being called here is the one that’s predefined
inside <b>Object</b>, and you can call it because it’s <b>protected</b> and
thereby accessible in derived classes.</span></p>

<p class=MsoNormal><b><span lang=EN-US>Object.clone(&nbsp;)</span></b><span
lang=EN-US> figures out how big the object is, creates enough memory for a new
one, and copies all the bits from the old to the new. This is called a </span><span lang=EN-US><i>bitwise copy,</i> and is typically what you’d expect a <b>clone(&nbsp;)</b>
method to do. But before <b>Object.clone(&nbsp;)</b> performs its operations,
it first checks to see if a class is <b>Cloneable</b>—that is, whether it
implements the <b>Cloneable</b> interface. If it doesn’t, <b>Object.clone(&nbsp;)</b>
throws a </span><span lang=EN-US><b>CloneNotSupportedException</b> to indicate
that you can’t clone it. Thus, you’ve got to surround your call to <b>super.clone(&nbsp;)</b>
with a try-catch block, to catch an exception that should never happen (because
you’ve implemented the <b>Cloneable</b> interface).</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>LocalCopy</b>, the two methods <b>g(&nbsp;)</b>
and <b>f(&nbsp;)</b> demonstrate the difference between the two approaches for
argument passing. <b>g(&nbsp;)</b> shows passing by reference in which it
modifies the outside object and returns a reference to that outside object,
while <b>f(&nbsp;)</b> clones the argument, thereby decoupling it and leaving
the original object alone. It can then proceed to do whatever it wants, and
even to return a reference to this new object without any ill effects to the
original. Notice the somewhat curious-looking statement:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>v =
(MyObject)v.clone();</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This is where the local copy is created. To
prevent confusion by such a statement, remember that this rather strange coding
idiom is perfectly feasible in Java because every object identifier is actually
a reference. So the reference <b>v</b> is used to <b>clone(&nbsp;)</b> a copy
of what it refers to, and this returns a reference to the base type <b>Object</b>
(because it’s defined that way in <b>Object.clone(&nbsp;)</b>) that must then
be cast to the proper type.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>main(&nbsp;)</b>, the difference
between the effects of the two different argument-passing approaches in the two
different methods is tested. The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>a == b</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>a = 12</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>b = 12</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>c != d</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>c = 47</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>d = 48</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>It’s important to notice that the
equivalence tests in Java do not look inside the objects being compared to see
if their values are the same. The </span><span lang=EN-US><b>==</b> and <b>!=</b> operators are simply comparing the <i>references</i>.
If the addresses inside the </span><span
lang=EN-US>references are the same, the references are pointing to the same
object and are therefore “equal.” So what the operators are really testing is
whether the references are aliased to the same object!</span></p>

<h3><a name="_Toc481064931"></a><a name="_Toc375545428"><span lang=EN-US>The
effect of <b>Object.clone(&nbsp;)</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>What actually happens when </span><span lang=EN-US><b>Object.clone(&nbsp;)</b> is called that makes it so essential to
call </span><span lang=EN-US><b>super.clone(&nbsp;)</b> when you override <b>clone(&nbsp;)</b>
in your class? The <b>clone(&nbsp;)</b> method in the root class is responsible
for creating the correct amount of storage and making the bitwise copy of the
bits from the original object into the new object’s storage. That is, it
doesn’t just make storage and copy an <b>Object</b>—it actually figures out the
size of the precise object that’s being copied and duplicates that. Since all
this is happening from the code in the <b>clone(&nbsp;)</b> method defined in
the root class (that has no idea what’s being inherited from it), you can guess
that the process involves </span><span
lang=EN-US>RTTI to determine the actual object that’s being cloned. This way,
the <b>clone(&nbsp;)</b> method can create the proper amount of storage and do
the correct bitcopy for that type.</span></p>

<p class=MsoNormal><span lang=EN-US>Whatever you do, the first part of the
cloning process should normally be a call to <b>super.clone(&nbsp;)</b>. This
establishes the groundwork for the cloning operation by making an exact
duplicate. At this point you can perform other operations necessary to complete
the cloning.</span></p>

<p class=MsoNormal><span lang=EN-US>To know for sure what those other operations
are, you need to understand exactly what <b>Object.clone(&nbsp;)</b> buys you.
In particular, does it automatically clone the destination of all the
references? The following example tests this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: appendixa:Snake.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Tests cloning to see
if destination</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// of references are
also cloned.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Snake
implements Cloneable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Snake next;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private char c;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Value of i ==
number of segments</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Snake(int i, char x) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c = x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(--i &gt; 0)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      next = new
Snake(i, (char)(x + 1));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void increment() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    c++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(next != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      next.increment();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s =
&quot;:&quot; + c;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(next != null)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s +=
next.toString();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object o = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      o = super.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(CloneNotSupportedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Snake can't clone&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return o;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Snake s = new
Snake(5, 'a');</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;s = &quot; + s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Snake s2 =
(Snake)s.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;s2 = &quot; + s2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s.increment();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;after
s.increment, s2 = &quot; + s2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>A <b>Snake</b> is made up of a bunch of
segments, each of type <b>Snake</b>. Thus, it’s a singly linked list. The
segments are created recursively, decrementing the first constructor argument
for each segment until zero is reached. To give each segment a unique tag, the
second argument, a <b>char</b>, is incremented for each recursive constructor
call.</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>increment(&nbsp;)</b> method
recursively increments each tag so you can see the change, and the <b>toString(&nbsp;)</b>
recursively prints each tag. The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>s = :a:b:c:d:e</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>s2 = :a:b:c:d:e</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>after s.increment,
s2 = :a:c:d:e:f</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This means that only the first segment is
duplicated by <b>Object.clone(&nbsp;)</b>, therefore it does a </span><span lang=EN-US>shallow copy. If you want the whole snake to be duplicated—a </span><span lang=EN-US>deep copy—you must perform the additional operations inside your
overridden <b>clone(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll typically call <b>super.clone(&nbsp;)</b>
in any class derived from a cloneable class to make sure that all of the
base-class operations (including <b>Object.clone(&nbsp;)</b>) take place. This
is followed by an explicit call to <b>clone(&nbsp;) </b>for every reference in
your object; otherwise those references will be aliased to those of the
original object. It’s analogous to the way constructors are called—base-class
constructor first, then the next-derived constructor, and so on to the
most-derived constructor. The difference is that <b>clone(&nbsp;)</b> is not a
constructor, so there’s nothing to make it happen automatically. You must make
sure to do it yourself.</span></p>

<h3><a name="_Toc481064932"><span lang=EN-US>Cloning a composed object</span></a></h3>

<p class=MsoNormal><span lang=EN-US>There’s a problem you’ll encounter when
trying to deep copy a composed object. You must assume that the <b>clone(&nbsp;)</b>
method in the member objects will in turn perform a deep copy on <i>their</i>
references, and so on. This is quite a commitment. It effectively means that
for a deep copy to work you must either control all of the code in all of the
classes, or at least have enough knowledge about all of the classes involved in
the deep copy to know that they are performing their own deep copy correctly.</span></p>

<p class=MsoNormal><span lang=EN-US>This example shows what you must do to
accomplish a deep copy when dealing with a composed object:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:DeepCopy.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Cloning a composed
object.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class DepthReading
implements Cloneable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private double depth;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
DepthReading(double depth) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this.depth = depth;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object o = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      o = super.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(CloneNotSupportedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return o;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class TemperatureReading
implements Cloneable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private long time;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private double
temperature;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public TemperatureReading(double
temperature) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    time =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    this.temperature =
temperature;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object o = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      o = super.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(CloneNotSupportedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return o;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class OceanReading
implements Cloneable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private DepthReading
depth;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private
TemperatureReading temperature;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public
OceanReading(double tdata, double ddata){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    temperature = new
TemperatureReading(tdata);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    depth = new
DepthReading(ddata);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    OceanReading o =
null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      o =
(OceanReading)super.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(CloneNotSupportedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
e.printStackTrace(System.err);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Must clone
references:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o.depth =
(DepthReading)o.depth.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o.temperature = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
(TemperatureReading)o.temperature.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return o; // Upcasts
back to Object</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class DeepCopy {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    OceanReading reading
= </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
OceanReading(33.9, 100.5);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Now clone it:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    OceanReading r = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
(OceanReading)reading.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>DepthReading</span></b><span lang=EN-US>
and <b>TemperatureReading</b> are quite similar; they both contain only
primitives. Therefore, the <b>clone(&nbsp;)</b> method can be quite simple: it
calls <b>super.clone(&nbsp;)</b> and returns the result. Note that the <b>clone(&nbsp;)</b>
code for both classes is identical.</span></p>

<p class=MsoNormal><b><span lang=EN-US>OceanReading</span></b><span lang=EN-US>
is composed of <b>DepthReading</b> and <b>TemperatureReading</b> objects and
so, to produce a deep copy, its <b>clone(&nbsp;)</b> must clone the references
inside <b>OceanReading</b>. To accomplish this, the result of <b>super.clone(&nbsp;)</b>
must be cast to an <b>OceanReading</b> object (so you can access the <b>depth</b>
and <b>temperature</b> references).</span></p>

<h3><a name="_Toc481064933"><span lang=EN-US>A deep copy with <b>ArrayList</b></span></a></h3>

<p class=MsoNormal><span lang=EN-US>Let’s revisit the </span><span lang=EN-US><b>ArrayList</b> example from earlier in this appendix. This time the
<b>Int2</b> class is cloneable, so the <b>ArrayList</b> can be deep copied:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:AddingClone.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// You must go through a
few gyrations</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// to add cloning to your
own class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Int2 implements
Cloneable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int i;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Int2(int ii) {
i = ii; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void
increment() { i++; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
Integer.toString(i);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object o = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      o = super.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(CloneNotSupportedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Int2 can't clone&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return o;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Once it's cloneable,
inheritance</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// doesn't remove
cloneability:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Int3 extends Int2
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int j; //
Automatically duplicated</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Int3(int i) {
super(i); }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class AddingClone
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Int2 x = new
Int2(10);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Int2 x2 =
(Int2)x.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x2.increment();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;x = &quot; +
x + &quot;, x2 = &quot; + x2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Anything
inherited is also cloneable:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Int3 x3 = new
Int3(7);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    x3 =
(Int3)x3.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList v = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++ )</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v.add(new
Int2(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;v: &quot; + v);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList v2 =
(ArrayList)v.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Now clone each
element:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; v.size(); i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v2.set(i,
((Int2)v2.get(i)).clone());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Increment all
v2's elements:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(Iterator e =
v2.iterator();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        e.hasNext(); )</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
((Int2)e.next()).increment();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // See if it changed
v's elements:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;v: &quot; + v);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;v2: &quot; + v2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>Int3</span></b><span lang=EN-US> is
inherited from <b>Int2</b> and a new primitive member <b>int j </b>is added.
You might think that you’d need to override <b>clone(&nbsp;)</b> again to make
sure <b>j</b> is copied, but that’s not the case. When <b>Int2</b>’s <b>clone(&nbsp;)</b>
is called as <b>Int3</b>’s <b>clone(&nbsp;)</b>, it calls <b>Object.clone(&nbsp;),</b>
which determines that it’s working with an <b>Int3</b> and duplicates all the
bits in the <b>Int3</b>. As long as you don’t add references that need to be
cloned, the one call to <b>Object.clone(&nbsp;)</b> performs all of the
necessary duplication, regardless of how far down in the hierarchy <b>clone(&nbsp;)</b>
is defined.</span></p>

<p class=MsoNormal><span lang=EN-US>You can see what’s necessary in order to do
a deep copy of an <b>ArrayList</b>: after the <b>ArrayList</b> is cloned, you
have to step through and clone each one of the objects pointed to by the <b>ArrayList</b>.
You’d have to do something similar to this to do a deep copy of a <b>HashMap</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The remainder of the example shows that the
cloning did happen by showing that, once an object is cloned, you can change it
and the original object is left untouched.</span></p>

<h3><a name="_Toc375545429"></a><a name="_Toc481064934"><span lang=EN-US>Deep
copy via serialization</span></a></h3>

<p class=MsoNormal><span lang=EN-US>When you consider Java’s object
serialization (introduced in Chapter 11), you might observe that an object that’s
serialized and then deserialized is, in effect, cloned.</span></p>

<p class=MsoNormal><span lang=EN-US>So why not use </span><span
lang=EN-US>serialization to perform deep copying? Here’s an example that
compares the two approaches by timing them:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:Compete.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.io.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Thing1 implements
Serializable {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Thing2 implements
Serializable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Thing1 o1 = new
Thing1();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Thing3 implements
Cloneable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Object o = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      o = super.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(CloneNotSupportedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Thing3 can't clone&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return o;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Thing4 implements
Cloneable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Thing3 o3 = new
Thing3();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thing4 o = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      o =
(Thing4)super.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(CloneNotSupportedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
System.err.println(&quot;Thing4 can't clone&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Clone the field,
too:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    o.o3 =
(Thing3)o3.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return o;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Compete {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static final int SIZE
= 5000;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  throws Exception {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thing2[] a = new
Thing2[SIZE];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      a[i] = new
Thing2();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thing4[] b = new
Thing4[SIZE];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; b.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      b[i] = new
Thing4();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long t1 =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
ByteArrayOutputStream buf = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ByteArrayOutputStream();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectOutputStream o
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectOutputStream(buf);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; a.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
o.writeObject(a[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Now get copies:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ObjectInputStream in
=</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ObjectInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        new
ByteArrayInputStream(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>         
buf.toByteArray()));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thing2[] c = new
Thing2[SIZE];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; c.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      c[i] =
(Thing2)in.readObject();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    long t2 =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Duplication
via serialization: &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (t2 - t1) + &quot;
Milliseconds&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Now try cloning:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t1 =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Thing4[] d = new
Thing4[SIZE];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; d.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      d[i] =
(Thing4)b[i].clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t2 =
System.currentTimeMillis();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;Duplication
via cloning: &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      (t2 - t1) + &quot;
Milliseconds&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>Thing2</span></b><span lang=EN-US> and <b>Thing4</b>
contain member objects so that there’s some deep copying going on. It’s
interesting to notice that while <b>Serializable</b> classes are easy to set
up, there’s much more work going on to duplicate them. Cloning involves a lot
of work to set up the class, but the actual duplication of objects is
relatively simple. The results really tell the tale. Here is the output from
three different runs:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Duplication via
serialization: 940 Milliseconds</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Duplication via cloning:
50 Milliseconds</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Duplication via
serialization: 710 Milliseconds</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Duplication via cloning:
60 Milliseconds</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Duplication via
serialization: 770 Milliseconds</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Duplication via
cloning: 50 Milliseconds</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Despite the significant time difference
between serialization and cloning, you’ll also notice that the serialization
technique seems to vary more in its duration, while cloning tends to be more
stable.</span></p>

<h3><a name="_Toc481064935"><span lang=EN-US>Adding cloneability <br>
further down a hierarchy</span></a></h3>

<p class=MsoNormal><span lang=EN-US>If you create a new class, its base class
defaults to <b>Object</b>, which defaults to noncloneability (as you’ll see in
the next section). As long as you don’t explicitly add cloneability, you won’t
get it. </span><span lang=EN-US>But you can add it in at any layer and it will
then be cloneable from that layer downward, like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:HorrorFlick.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// You can insert
Cloneability </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// at any level of
inheritance.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Person {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Hero extends
Person {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Scientist extends
Person </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    implements Cloneable
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      return
super.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }
catch(CloneNotSupportedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // this should
never happen:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      // It's Cloneable
already!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throw new
InternalError();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MadScientist
extends Scientist {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class HorrorFlick
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Person p = new
Person();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Hero h = new Hero();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Scientist s = new
Scientist();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MadScientist m = new
MadScientist();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // p =
(Person)p.clone(); // Compile error</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // h =
(Hero)h.clone(); // Compile error</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s =
(Scientist)s.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    m =
(MadScientist)m.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Before cloneability was added, the compiler
stopped you from trying to clone things. When cloneability is added in <b>Scientist</b>,
then <b>Scientist</b> and all its descendants are cloneable.</span></p>

<h3><a name="_Toc481064936"></a><a name="_Toc375545430"><span lang=EN-US>Why
this strange design?</span></a></h3>

<p class=MsoNormal><span lang=EN-US>If all this seems to be a strange scheme,
that’s because it is. You might wonder why it worked out this way. What is the
meaning behind this design?</span></p>

<p class=MsoNormal><span lang=EN-US>Originally, Java was designed as a language
to control hardware boxes, and definitely not with the Internet in mind. In a
general-purpose language like this, it makes sense that the programmer be able
to clone any object. Thus, <b>clone(&nbsp;)</b> was placed in the root class <b>Object</b>,
<i>but</i> it was a <b>public</b> method so you could always clone any object.
This seemed to be the most flexible approach, and after all, what could it
hurt?</span></p>

<p class=MsoNormal><span lang=EN-US>Well, when Java was seen as the ultimate
Internet programming language, things changed. Suddenly, there are security
issues, and of course, these issues are dealt with using objects, and you don’t
necessarily want anyone to be able to clone your security objects. So what
you’re seeing is a lot of patches applied on the original simple and
straightforward scheme: <b>clone(&nbsp;)</b> is now <b>protected</b> in <b>Object</b>.
You must override it <i>and</i> <b>implement Cloneable</b> <i>and</i> deal with
the exceptions.</span></p>

<p class=MsoNormal><span lang=EN-US>It’s worth noting that you must use the <b>Cloneable</b>
interface <i>only </i>if you’re going to call <b>Object</b>’s <b>clone(&nbsp;)</b>,
method, since that method checks at run-time to make sure that your class
implements <b>Cloneable</b>. But for consistency (and since <b>Cloneable</b> is
empty anyway) you should implement it.</span></p>

<h2><a name="_Toc481064937"></a><a name="_Toc375545431"><span lang=EN-US>Controlling
cloneability</span></a></h2>

<p class=MsoNormal><span lang=EN-US>You might suggest that, to remove </span><span lang=EN-US>cloneability, the <b>clone(&nbsp;)</b> method simply be made <b>private</b>,
but this won’t work since you cannot take a base-class method and make it less
accessible in a derived class. So it’s not that simple. And yet, it’s necessary
to be able to control whether an object can be cloned. There are actually a
number of attitudes you can take to this in a class that you design:</span></p>

<p class=Numbered><span lang=EN-US>Indifference. You don’t do anything about
cloning, which means that your class can’t be cloned but a class that inherits
from you can add cloning if it wants. This works only if the default <b>Object.clone(&nbsp;)</b>
will do something reasonable with all the fields in your class.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>141.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Support <b>clone(&nbsp;)</b>. Follow the standard practice of implementing
<b>Cloneable</b> and overriding <b>clone(&nbsp;)</b>. In the overridden <b>clone(&nbsp;)</b>,
you call <b>super.clone(&nbsp;) </b>and catch all exceptions (so your
overridden <b>clone(&nbsp;)</b> doesn’t throw any exceptions).</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>142.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Support cloning conditionally. If your class holds references to
other objects that might or might not be cloneable (a container class, for
example), your <b>clone(&nbsp;)</b> can try to clone all of the objects for
which you have references, and if they throw exceptions just pass those
exceptions out to the programmer. For example, consider a special sort of <b>ArrayList</b>
that tries to clone all the objects it holds. When you write such an <b>ArrayList</b>,
you don’t know what sort of objects the client programmer might put into your <b>ArrayList</b>,
so you don’t know whether they can be cloned.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>143.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Don’t implement <b>Cloneable</b> but override <b>clone(&nbsp;)</b>
as <b>protected</b>, producing the correct copying behavior for any fields.
This way, anyone inheriting from this class can override <b>clone(&nbsp;)</b>
and call <b>super.clone(&nbsp;)</b> to produce the correct copying behavior.
Note that your implementation can and should invoke <b>super.clone(&nbsp;)</b>
even though that method expects a <b>Cloneable</b> object (it will throw an
exception otherwise), because no one will directly invoke it on an object of
your type. It will get invoked only through a derived class, which, if it is to
work successfully, implements <b>Cloneable</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>144.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Try to prevent cloning by not implementing <b>Cloneable</b> and
overriding <b>clone(&nbsp;)</b> to throw an exception. This is successful only
if any class derived from this calls <b>super.clone(&nbsp;)</b> in its
redefinition of <b>clone(&nbsp;)</b>. Otherwise, a programmer may be able to
get around it.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>145.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Prevent cloning by making your class <b>final</b>. If <b>clone(&nbsp;)</b>
has not been overridden by any of your ancestor classes, then it can’t be. If
it has, then override it again and throw <b>CloneNotSupportedException</b>.
Making the class <b>final </b>is the only way to guarantee that cloning is
prevented. In addition, when dealing with security objects or other situations
in which you want to control the number of objects created you should make all
constructors <b>private</b> and provide one or more special methods for
creating objects. That way, these methods can restrict the number of objects
created and the conditions in which they’re created. (A particular case of this
is the <i>singleton</i> pattern shown in <i>Thinking in Patterns with Java</i>,
downloadable at <i>www.BruceEckel.com</i>.)</span></p>

<p class=MsoNormal><span lang=EN-US>Here’s an example that shows the various
ways cloning can be implemented and then, later in the hierarchy, “turned off”:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:CheckCloneable.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Checking to see if a
reference can be cloned.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Can't clone this
because it doesn't</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// override clone():</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Ordinary {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Overrides clone, but
doesn't implement</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Cloneable:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class WrongClone extends
Ordinary {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone()</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws
CloneNotSupportedException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
super.clone(); // Throws exception</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Does all the right
things for cloning:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class IsCloneable
extends Ordinary </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    implements Cloneable
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone() </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws
CloneNotSupportedException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
super.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Turn off cloning by
throwing the exception:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class NoMore extends
IsCloneable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone() </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws
CloneNotSupportedException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    throw new
CloneNotSupportedException();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class TryMore extends
NoMore {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone() </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      throws
CloneNotSupportedException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Calls
NoMore.clone(), throws exception:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return super.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class BackOn extends
NoMore {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private BackOn
duplicate(BackOn b) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Somehow make a
copy of b</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // and return that
copy. This is a dummy</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // copy, just to
make the point:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new BackOn();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Object clone()
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Doesn't call
NoMore.clone():</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
duplicate(this);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Can't inherit from
this, so can't override</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// the clone method like
in BackOn:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>final class ReallyNoMore
extends NoMore {}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
CheckCloneable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static Ordinary
tryToClone(Ordinary ord) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String id =
ord.getClass().getName();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Ordinary x = null;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    if(ord instanceof
Cloneable) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      try {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(&quot;Attempting &quot; + id);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>        x =
(Ordinary)((IsCloneable)ord).clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.out.println(&quot;Cloned &quot; + id);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }
catch(CloneNotSupportedException e) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>       
System.err.println(&quot;Could not clone &quot;+id);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Upcasting:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Ordinary[] ord = { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new IsCloneable(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new WrongClone(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new NoMore(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new TryMore(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new BackOn(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
ReallyNoMore(),</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    };</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Ordinary x = new
Ordinary();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // This won't
compile, since clone() is</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // protected in
Object:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    //! x =
(Ordinary)x.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // tryToClone()
checks first to see if</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // a class
implements Cloneable:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; ord.length; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
tryToClone(ord[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The first class, <b>Ordinary</b>,
represents the kinds of classes we’ve seen throughout this book: no support for
cloning, but as it turns out, no prevention of cloning either. But if you have
a reference to an <b>Ordinary</b> object that might have been upcast from a
more derived class, you can’t tell if it can be cloned or not.</span></p>

<p class=MsoNormal><span lang=EN-US>The class <b>WrongClone</b> shows an
incorrect way to implement cloning. It does override <b>Object.clone(&nbsp;)</b>
and makes that method <b>public</b>, but it doesn’t implement <b>Cloneable</b>,
so when <b>super.clone(&nbsp;)</b> is called (which results in a call to <b>Object.clone(&nbsp;)</b>),
<b>CloneNotSupportedException</b> is thrown so the cloning doesn’t work.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>IsCloneable</b> you can see all the
right actions performed for cloning: <b>clone(&nbsp;)</b> is overridden and <b>Cloneable</b>
is implemented. However, this <b>clone(&nbsp;)</b> method and several others
that follow in this example <i>do not</i> catch <b>CloneNotSupportedException,</b>
but instead pass it through to the caller, who must then put a try-catch block
around it. In your own <b>clone(&nbsp;)</b> methods you will typically catch <b>CloneNotSupportedException</b>
<i>inside</i> <b>clone(&nbsp;)</b> rather than passing it through. As you’ll
see, in this example it’s more informative to pass the exceptions through.</span></p>

<p class=MsoNormal><span lang=EN-US>Class <b>NoMore</b> attempts to “turn off”
cloning in the way that the Java designers intended: in the derived class <b>clone(&nbsp;)</b>,
you throw <b>CloneNotSupportedException</b>. The <b>clone(&nbsp;) </b>method in
class <b>TryMore</b> properly calls <b>super.clone(&nbsp;)</b>, and this
resolves to <b>NoMore.clone(&nbsp;),</b> which throws an exception and prevents
cloning.</span></p>

<p class=MsoNormal><span lang=EN-US>But what if the programmer doesn’t follow
the “proper” path of calling </span><span lang=EN-US><b>super.clone(&nbsp;)</b> inside the overridden <b>clone(&nbsp;)</b>
method? In <b>BackOn</b>, you can see how this can happen. This class uses a
separate method <b>duplicate(&nbsp;) </b>to make a copy of the current object
and calls this method inside <b>clone(&nbsp;)</b> <i>instead</i> of calling <b>super.clone(&nbsp;)</b>.
The exception is never thrown and the new class is cloneable. You can’t rely on
throwing an exception to prevent making a cloneable class. The only sure-fire
solution is shown in <b>ReallyNoMore</b>, which is <b>final</b> and thus cannot
be inherited. That means if <b>clone(&nbsp;)</b> throws an exception in the <b>final</b>
class, it cannot be modified with inheritance and the prevention of cloning is
assured. (You cannot explicitly call <b>Object.clone(&nbsp;) </b>from a class
that has an arbitrary level of inheritance; you are limited to calling <b>super.clone(&nbsp;),</b>
which has access to only the direct base class.) Thus, if you make any objects
that involve security issues, you’ll want to make those classes <b>final</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>The first method you see in class <b>CheckCloneable</b>
is <b>tryToClone(&nbsp;)</b>, which takes any <b>Ordinary</b> object and checks
to see whether it’s cloneable with <b>instanceof</b>. If so, it casts the
object to an <b>IsCloneable</b>, calls <b>clone(&nbsp;)</b> and casts the
result back to <b>Ordinary</b>, catching any exceptions that are thrown. Notice
the use of run-time type identification (see Chapter 12) to print the class
name so you can see what’s happening.</span></p>

<p class=MsoNormal><span lang=EN-US>In <b>main(&nbsp;)</b>, different types of <b>Ordinary</b>
objects are created and upcast to <b>Ordinary</b> in the array definition. The
first two lines of code after that create a plain <b>Ordinary</b> object and
try to clone it. However, this code will not compile because <b>clone(&nbsp;)</b>
is a <b>protected</b> method in <b>Object</b>. The remainder of the code steps
through the array and tries to clone each object, reporting the success or
failure of each. The output is:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Attempting IsCloneable</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Cloned IsCloneable</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Attempting NoMore</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Could not clone NoMore</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Attempting TryMore</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Could not clone TryMore</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Attempting BackOn</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Cloned BackOn</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Attempting ReallyNoMore</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>Could not clone
ReallyNoMore</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>So to summarize, if you want a class to be
cloneable:</span></p>

<p class=Numbered><span lang=EN-US>Implement the <b>Cloneable</b> interface.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>146.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Override <b>clone(&nbsp;)</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>147.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Call <b>super.clone(&nbsp;)</b> inside your <b>clone(&nbsp;)</b>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>148.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Capture exceptions inside your <b>clone(&nbsp;)</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>This will produce the most convenient
effects.</span></p>

<h3><a name="_Toc481064938"></a><a name="_Toc375545432"><span lang=EN-US>The
copy constructor</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Cloning can seem to be a complicated
process to set up. It might seem like there should be an alternative. One
approach that might occur to you (especially if you’re a C++ programmer) is to
make a special constructor whose job it is to duplicate an object. In C++, this
is called the </span><span
lang=EN-US><i>copy constructor</i>. At first, this seems like the obvious
solution, but in fact it doesn’t work. Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:CopyConstructor.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A constructor for
copying an object of the same</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// type, as an attempt
to create a local copy.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class FruitQualities {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int weight;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int color;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int firmness;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int ripeness;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int smell;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // etc.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  FruitQualities() { //
Default constructor</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // do something
meaningful...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Other constructors:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Copy constructor:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
FruitQualities(FruitQualities f) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    weight = f.weight;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    color = f.color;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    firmness =
f.firmness;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ripeness =
f.ripeness;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    smell = f.smell;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // etc.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Seed {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Members...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Seed() { /* Default
constructor */ }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Seed(Seed s) { /* Copy
constructor */ }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Fruit {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private FruitQualities
fq;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int seeds;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private Seed[] s;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Fruit(FruitQualities
q, int seedCount) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fq = q;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    seeds = seedCount;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    s = new Seed[seeds];</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; seeds; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s[i] = new Seed();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Other constructors:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // Copy constructor:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Fruit(Fruit f) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fq = new
FruitQualities(f.fq);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    seeds = f.seeds;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Call all Seed
copy-constructors:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; seeds; i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      s[i] = new
Seed(f.s[i]);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Other
copy-construction activities...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // To allow derived
constructors (or other </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // methods) to put in
different qualities:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected void
addQualities(FruitQualities q) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    fq = q;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  protected
FruitQualities getQualities() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return fq;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Tomato extends
Fruit {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Tomato() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(new
FruitQualities(), 100);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  Tomato(Tomato t) { //
Copy-constructor</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(t); // Upcast
for base copy-constructor</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Other copy-construction
activities...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class ZebraQualities
extends FruitQualities {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int
stripedness;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  ZebraQualities() { //
Default constructor</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // do something
meaningful...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
ZebraQualities(ZebraQualities z) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(z);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    stripedness =
z.stripedness;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class GreenZebra extends
Tomato {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  GreenZebra() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    addQualities(new
ZebraQualities());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  GreenZebra(GreenZebra
g) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    super(g); // Calls
Tomato(Tomato)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Restore the right
qualities:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    addQualities(new
ZebraQualities());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  void evaluate() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ZebraQualities zq = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
(ZebraQualities)getQualities();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Do something with
the qualities</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // ...</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
CopyConstructor {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
ripen(Tomato t) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Use the
&quot;copy constructor&quot;:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    t = new Tomato(t); </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;In ripen, t is a &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
t.getClass().getName());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
slice(Fruit f) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f = new Fruit(f); //
Hmmm... will this work?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;In slice, f is a &quot; +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      f.getClass().getName());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Tomato tomato = new
Tomato();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ripen(tomato); // OK</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    slice(tomato); //
OOPS!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    GreenZebra g = new
GreenZebra();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ripen(g); // OOPS!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    slice(g); // OOPS!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    g.evaluate();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This seems a bit strange at first. Sure,
fruit has qualities, but why not just put data members representing those
qualities directly into the <b>Fruit</b> class? There are two potential
reasons. The first is that you might want to easily insert or change the qualities.
Note that <b>Fruit</b> has a <b>protected</b> <b>addQualities(&nbsp;)</b>
method to allow derived classes to do this. (You might think the logical thing
to do is to have a <b>protected</b> constructor in <b>Fruit</b> that takes a <b>FruitQualities</b>
argument, but constructors don’t inherit so it wouldn’t be available in second
or greater level classes.) By making the fruit qualities into a separate class,
you have greater flexibility, including the ability to change the qualities
midway through the lifetime of a particular <b>Fruit</b> object.</span></p>

<p class=MsoNormal><span lang=EN-US>The second reason for making <b>FruitQualities</b>
a separate object is in case you want to add new qualities or to change the
behavior via inheritance and polymorphism. Note that for <b>GreenZebra</b>
(which <i>really is</i> a type of tomato—I’ve grown them and they’re fabulous),
the constructor calls <b>addQualities(&nbsp;)</b> and passes it a <b>ZebraQualities</b>
object, which is derived from <b>FruitQualities</b> so it can be attached to
the <b>FruitQualities</b> reference in the base class. Of course, when <b>GreenZebra</b>
uses the <b>FruitQualities</b> it must downcast it to the correct type (as seen
in <b>evaluate(&nbsp;)</b>), but it always knows that type is <b>ZebraQualities</b>.</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll also see that there’s a <b>Seed</b>
class, and that <b>Fruit</b> (which by definition carries its own seeds)</span><a
href="#_ftn82" name="_ftnref82" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[82]</span></span></span></span></a><span
lang=EN-US> contains an array of <b>Seed</b>s.</span></p>

<p class=MsoNormal><span lang=EN-US>Finally, notice that each class has a copy
constructor, and that each copy constructor must take care to call the copy
constructors for the base class and member objects to produce a deep copy. The
copy constructor is tested inside the class <b>CopyConstructor</b>. The method <b>ripen(&nbsp;)</b>
takes a <b>Tomato </b>argument and performs copy-construction on it in order to
duplicate the object:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>t = new Tomato(t);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>while <b>slice(&nbsp;)</b> takes a more
generic <b>Fruit</b> object and also duplicates it:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>f = new Fruit(f);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>These are tested with different kinds of <b>Fruit</b>
in <b>main(&nbsp;)</b>. Here’s the output:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>In ripen, t is a Tomato</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>In slice, f is a Fruit</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>In ripen, t is a Tomato</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>In slice, f is a
Fruit</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>This is where the problem shows up. After
the copy-construction that happens to the <b>Tomato</b> inside <b>slice(&nbsp;)</b>,
the result is no longer a <b>Tomato</b> object, but just a <b>Fruit</b>. It has
lost all of its tomato-ness. Further, when you take a <b>GreenZebra</b>, both <b>ripen(&nbsp;)</b>
and <b>slice(&nbsp;)</b> turn it into a <b>Tomato</b> and a <b>Fruit</b>, respectively.
Thus, unfortunately, the copy constructor scheme is no good to us in Java when
attempting to make a local copy of an object.</span></p>

<h4><span lang=EN-US>Why does it work in C++ and not Java?</span></h4>

<p class=MsoNormal><span lang=EN-US>The copy constructor is a fundamental part
of C++, since it automatically makes a local copy of an object. Yet the example
above proves that it does not work for Java. Why? In Java everything that we manipulate
is a reference, while in C++ you can have reference-like entities and you can <i>also</i>
pass around the objects directly. That’s what the C++ copy constructor is for:
when you want to take an object and pass it in by value, thus duplicating the
object. So it works fine in C++, but you should keep in mind that this scheme
fails in Java, so don’t use it.</span></p>

<h2><a name="_Toc481064939"></a><a name="_Toc375545433"><span lang=EN-US>Read-only
classes</span></a></h2>

<p class=MsoNormal><span lang=EN-US>While the local copy produced by <b>clone(&nbsp;)
</b>gives the desired results in the appropriate cases, it is an example of
forcing the programmer (the author of the method) to be responsible for
preventing the ill effects of aliasing. What if you’re making a library that’s
so general purpose and commonly used that you cannot make the assumption that
it will always be cloned in the proper places? Or more likely, what if you <i>want</i>
to allow aliasing for efficiency—to prevent the needless duplication of
objects—but you don’t want the negative side effects of aliasing?</span></p>

<p class=MsoNormal><span lang=EN-US>One solution is to create </span><span lang=EN-US><i>immutable objects</i> which belong to read-only classes. You can
define a class such that no methods in the class cause changes to the internal
state of the object. In such a class, aliasing has no impact since you can read
only the internal state, so if many pieces of code are reading the same object
there’s no problem.</span></p>

<p class=MsoNormal><span lang=EN-US>As a simple example of immutable objects,
Java’s standard library contains </span><span
lang=EN-US>“wrapper” classes for all the primitive types. You might have
already discovered that, if you want to store an <b>int</b> inside a container
such as an <b>ArrayList</b> (which takes only <b>Object reference</b>s), you
can wrap your <b>int</b> inside the standard library <b>Integer</b> class:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:ImmutableInteger.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// The Integer class
cannot be changed.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ImmutableInteger {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void main(String[]
args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList v = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v.add(new
Integer(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // But how do you
change the int</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // inside the
Integer?</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The <b>Integer</b> class (as well as all
the primitive “wrapper” classes) implements immutability in a simple fashion:
they have no methods that allow you to change the object.</span></p>

<p class=MsoNormal><span lang=EN-US>If you do need an object that holds a
primitive type that can be modified, you must create it yourself. Fortunately,
this is trivial:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//: appendixa:MutableInteger.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A changeable wrapper
class.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>import java.util.*;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class IntValue { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int n;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  IntValue(int x) { n =
x; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public String
toString() { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
Integer.toString(n);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
MutableInteger {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ArrayList v = new
ArrayList();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; 10; i++) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      v.add(new
IntValue(i));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(v);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    for(int i = 0; i
&lt; v.size(); i++)</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>     
((IntValue)v.get(i)).n++;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(v);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Note that <b>n</b> is friendly to simplify
coding.</span></p>

<p class=MsoNormal><b><span lang=EN-US>IntValue</span></b><span lang=EN-US> can
be even simpler if the default initialization to zero is adequate (then you
don’t need the constructor) and you don’t care about printing it out (then you
don’t need the <b>toString(&nbsp;)</b>):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>class IntValue {
int n; }</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Fetching the element out and casting it is
a bit awkward, but that’s a feature of <b>ArrayList,</b> not of <b>IntValue</b>.</span></p>

<h3><a name="_Toc481064940"><span lang=EN-US>Creating read-only classes</span></a></h3>

<p class=MsoNormal><span lang=EN-US>It’s possible to create your own read-only
class. Here’s an example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:Immutable1.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Objects that cannot
be modified</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// are immune to
aliasing.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Immutable1
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int data;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Immutable1(int
initVal) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    data = initVal;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int read() {
return data; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean
nonzero() { return data != 0; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Immutable1
quadruple() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Immutable1(data * 4);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static void
f(Immutable1 i1) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Immutable1 quad =
i1.quadruple();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;i1 = &quot; + i1.read());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;quad = &quot; + quad.read());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Immutable1 x = new
Immutable1(47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;x = &quot; + x.read());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    f(x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;x = &quot; + x.read());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>All data is <b>private</b>, and you’ll see
that none of the <b>public</b> methods modify that data. Indeed, the method
that does appear to modify an object is <b>quadruple(&nbsp;)</b>, but this
creates a new <b>Immutable1</b> object and leaves the original one untouched.</span></p>

<p class=MsoNormal><span lang=EN-US>The method <b>f(&nbsp;)</b> takes an <b>Immutable1</b>
object and performs various operations on it, and the output of <b>main(&nbsp;)</b>
demonstrates that there is no change to <b>x</b>. Thus, <b>x</b>’s object could
be aliased many times without harm because the <b>Immutable1</b> class is
designed to guarantee that objects cannot be changed.</span></p>

<h3><a name="_Toc481064941"><span lang=EN-US>The drawback to immutability</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Creating an immutable class seems at first to
provide an elegant solution. However, whenever you do need a modified object of
that new type you must suffer the overhead of a new object creation, as well as
potentially causing more frequent garbage collections. For some classes this is
not a problem, but for others (such as the <b>String</b> class) it is
prohibitively expensive.</span></p>

<p class=MsoNormal><span lang=EN-US>The solution is to create a companion class
that <i>can</i> be modified. Then, when you’re doing a lot of modifications,
you can switch to using the modifiable companion class and switch back to the
immutable class when you’re done.</span></p>

<p class=MsoNormal><span lang=EN-US>The example above can be modified to show
this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:Immutable2.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// A companion class for
making </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// changes to immutable
objects.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class Mutable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int data;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Mutable(int
initVal) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    data = initVal;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Mutable add(int
x) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    data += x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return this;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Mutable
multiply(int x) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    data *= x;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return this;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Immutable2
makeImmutable2() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Immutable2(data);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Immutable2
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private int data;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Immutable2(int
initVal) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    data = initVal;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int read() {
return data; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public boolean
nonzero() { return data != 0; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Immutable2
add(int x) { </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Immutable2(data + x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Immutable2
multiply(int x) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Immutable2(data * x);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public Mutable
makeMutable() {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return new
Mutable(data);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static
Immutable2 modify1(Immutable2 y){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Immutable2 val =
y.add(12);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    val =
val.multiply(3);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    val = val.add(11);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    val =
val.multiply(2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return val;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  // This produces the
same result:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static
Immutable2 modify2(Immutable2 y){</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Mutable m =
y.makeMutable();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
m.add(12).multiply(3).add(11).multiply(2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return m.makeImmutable2();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Immutable2 i2 = new
Immutable2(47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Immutable2 r1 =
modify1(i2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    Immutable2 r2 =
modify2(i2);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;i2 = &quot; + i2.read());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;r1 = &quot; + r1.read());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(&quot;r2
= &quot; + r2.read());</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>Immutable2 </span></b><span lang=EN-US>contains
methods that, as before, preserve the immutability of the objects by producing
new objects whenever a modification is desired. These are the <b>add(&nbsp;)</b>
and <b>multiply(&nbsp;) </b>methods. The companion class is called <b>Mutable</b>,
and it also has <b>add(&nbsp;)</b> and <b>multiply(&nbsp;)</b> methods, but
these modify the <b>Mutable</b> object rather than making a new one. In
addition, <b>Mutable</b> has a method to use its data to produce an <b>Immutable2</b>
object and vice versa. </span></p>

<p class=MsoNormal><span lang=EN-US>The two static methods <b>modify1(&nbsp;)</b>
and <b>modify2(&nbsp;)</b> show two different approaches to producing the same
result. In <b>modify1(&nbsp;)</b>, everything is done within the <b>Immutable2</b>
class and you can see that four new <b>Immutable2</b> objects are created in
the process. (And each time <b>val</b> is reassigned, the previous object
becomes garbage.)</span></p>

<p class=MsoNormal><span lang=EN-US>In the method <b>modify2(&nbsp;)</b>, you
can see that the first action is to take the <b>Immutable2 y</b> and produce a <b>Mutable</b>
from it. (This is just like calling <b>clone(&nbsp;)</b> as you saw earlier,
but this time a different type of object is created.) Then the <b>Mutable</b>
object is used to perform a lot of change operations <i>without</i> requiring
the creation of many new objects. Finally, it’s turned back into an <b>Immutable2</b>.
Here, two new objects are created (the <b>Mutable</b> and the result <b>Immutable2</b>)
instead of four.</span></p>

<p class=MsoNormal><span lang=EN-US>This approach makes sense, then, when:</span></p>

<p class=Numbered><span lang=EN-US>You need immutable objects and</span></p>

<p class=Numbered><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>149.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></b><span lang=EN-US>You
often need to make a lot of modifications or</span></p>

<p class=Numbered><b><span lang=EN-US style='font-family:"Verdana","sans-serif"'>150.<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></b><span lang=EN-US>It’s
expensive to create new immutable objects.</span></p>

<h3><a name="_Toc481064942"><span lang=EN-US>Immutable <b>String</b>s</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Consider the following code:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:Stringer.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class Stringer {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static String
upcase(String s) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    return
s.toUpperCase();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String q = new
String(&quot;howdy&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.out.println(q);
// howdy</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String qq =
upcase(q);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(qq); // HOWDY</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(q); // howdy</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>When <b>q</b> is passed in to <b>upcase(&nbsp;)</b>
it’s actually a copy of the reference to <b>q</b>. The object this reference is
connected to stays put in a single physical location. The references are copied
as they are passed around.</span></p>

<p class=MsoNormal><span lang=EN-US>Looking at the definition for <b>upcase(&nbsp;)</b>,
you can see that the reference that’s passed in has the name <b>s</b>, and it
exists for only as long as the body of <b>upcase(&nbsp;)</b> is being executed.
When <b>upcase(&nbsp;)</b> completes, the local reference <b>s</b> vanishes. <b>upcase(&nbsp;)</b>
returns the result, which is the original string with all the characters set to
uppercase. Of course, it actually returns a reference to the result. But it
turns out that the reference that it returns is for a new object, and the
original <b>q</b> is left alone. How does this happen?</span></p>

<h4><span lang=EN-US>Implicit constants</span></h4>

<p class=MsoNormal><span
lang=EN-US>If you say:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>String s =
&quot;asdf&quot;;</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>String x =
Stringer.upcase(s);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>do you really want the <b>upcase(&nbsp;)</b>
method to <i>change</i> the argument? In general, you don’t, because an
argument usually looks to the reader of the code as a piece of information
provided to the method, not something to be modified. This is an important
guarantee, since it makes code easier to write and understand.</span></p>

<p class=MsoNormal><span lang=EN-US>In C++, the availability of this guarantee
was important enough to put in a special keyword, </span><span
lang=EN-US><b>const</b>, to allow the programmer to ensure that a reference
(pointer or reference in C++) could not be used to modify the original object.
But then the C++ programmer was required to be diligent and remember to use <b>const</b>
everywhere. It can be confusing and easy to forget.</span></p>

<h4><a name="_Toc375545435"><span lang=EN-US>Overloading ‘+’ and the <b>StringBuffer</b></span></a></h4>

<p class=MsoNormal><span lang=EN-US>Objects of the <b>String</b> class are
designed to be immutable, using the technique shown previously. If you examine
the online documentation<b> </b>for the <b>String</b> class (which is
summarized a little later in this appendix), you’ll see that every method in
the class that appears to modify a <b>String</b> really creates and returns a
brand new <b>String</b> object containing the modification. The original <b>String</b>
is left untouched. Thus, there’s no feature in Java like C++’s <b>const</b> to
make the compiler support the immutability of your objects. If you want it, you
have to wire it in yourself, like <b>String</b> does.</span></p>

<p class=MsoNormal><span lang=EN-US>Since <b>String </b>objects are immutable,
you can </span><span lang=EN-US>alias to a particular <b>String </b>as many
times as you want. Because it’s read-only there’s no possibility that one
reference will change something that will affect the other references. So a
read-only object solves the aliasing problem nicely.</span></p>

<p class=MsoNormal><span lang=EN-US>It also seems possible to handle all the cases in which you need a
modified object by creating a brand new version of the object with the
modifications, as <b>String</b> does. However, for some operations this isn’t
efficient. A case in point is the operator <b>‘+</b>’ that has been overloaded
for <b>String</b> objects. Overloading means that it has been given an extra
meaning when used with a particular class. (The ‘<b>+</b>’ and ‘<b>+=</b>’ for <b>String</b>
are the only operators that are overloaded in Java, and Java does not allow the
programmer to overload any others)</span><a href="#_ftn83" name="_ftnref83"
title=""><span class=MsoFootnoteReference><span lang=EN-US style='font-size:
8.0pt'><span class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;
font-family:"Georgia","serif"'>[83]</span></span></span></span></a><span
lang=EN-US>.</span></p>

<p class=MsoNormal><span lang=EN-US>When used with <b>String</b> objects, the ‘<b>+</b>’
allows you to concatenate <b>String</b>s together:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>String s =
&quot;abc&quot; + foo + &quot;def&quot; + Integer.toString(47);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You could imagine how this <i>might</i>
work: the <b>String</b> “abc” could have a method <b>append(&nbsp;)</b> that
creates a new <b>String</b> object containing “abc” concatenated with the
contents of <b>foo</b>. The new <b>String</b> object would then create another
new <b>String</b> that added “def,” and so on.</span></p>

<p class=MsoNormal><span lang=EN-US>This would certainly work, but it requires
the creation of a lot of <b>String</b> objects just to put together this new <b>String</b>,
and then you have a bunch of the intermediate <b>String</b> objects that need
to be garbage-collected. I suspect that the Java designers tried this approach
first (which is a lesson in software design—you don’t really know anything about
a system until you try it out in code and get something working). I also
suspect they discovered that it delivered unacceptable performance.</span></p>

<p class=MsoNormal><span lang=EN-US>The solution is a mutable companion class
similar to the one shown previously. For <b>String</b>, this companion class is
called <b>StringBuffer</b>, and the compiler automatically creates a <b>StringBuffer</b>
to evaluate certain expressions, in particular when the overloaded operators <b>+</b>
and <b>+=</b> are used with <b>String</b> objects. This example shows what
happens:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixa:ImmutableStrings.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>// Demonstrating
StringBuffer.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class
ImmutableStrings {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String foo =
&quot;foo&quot;;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    String s =
&quot;abc&quot; + foo +</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      &quot;def&quot; +
Integer.toString(47);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(s);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // The
&quot;equivalent&quot; using StringBuffer:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    StringBuffer sb = </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>      new
StringBuffer(&quot;abc&quot;); // Creates String!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    sb.append(foo);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
sb.append(&quot;def&quot;); // Creates String!</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
sb.append(Integer.toString(47));</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(sb);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>In the creation of <b>String s</b>, the
compiler is doing the rough equivalent of the subsequent code that uses <b>sb</b>:
a <b>StringBuffer</b> is created and <b>append(&nbsp;)</b> is used to add new
characters directly into the <b>StringBuffer</b> object (rather than making new
copies each time). While this is more efficient, it’s worth noting that each
time you create a quoted character string such as <b>“abc”</b> and <b>“def”</b>,
the compiler turns those into <b>String</b> objects. So there can be more
objects created than you expect, despite the efficiency afforded through <b>StringBuffer</b>.</span></p>

<h3><a name="_Toc375545434"></a><a name="_Toc375545436"></a><a
name="_Toc481064943"></a><a name="_Toc375545438"><span lang=EN-US>The <b>String</b>
and <br>
<b>StringBuffer </b>class</span></a><span lang=EN-US>es</span></h3>

<p class=MsoNormal><span lang=EN-US>Here is an overview of the methods
available for both </span><span lang=EN-US><b>String</b> and <b>StringBuffer</b>
so you can get a feel for the way they interact. These tables don’t contain
every single method, but rather the ones that are important to this discussion.
Methods that are overloaded are summarized in a single row.</span></p>

<p class=MsoNormal><span lang=EN-US>First, the <b>String</b> class:</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=502
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr>
   <td width=156 valign=top style='width:117.0pt;border:solid black 1.5pt;
   border-right:solid black 1.0pt;padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Method</span></p>
   </td>
   <td width=168 valign=top style='width:126.0pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Arguments, Overloading</span></p>
   </td>
   <td width=178 valign=top style='width:133.3pt;border:solid black 1.5pt;
   border-left:none;padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Use</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Constructor</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Overloaded:
  Default, </span><span lang=EN-US>String</span><span lang=EN-US
  style='font-weight:normal'>, </span><span lang=EN-US>StringBuffer</span><span
  lang=EN-US style='font-weight:normal'>, </span><span lang=EN-US>char</span><span
  lang=EN-US style='font-weight:normal'> arrays, </span><span lang=EN-US>byte</span><span
  lang=EN-US style='font-weight:normal'> arrays.</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Creating </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> objects.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>length(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>&nbsp;</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Number of
  characters in the </span><span lang=EN-US>String</span><span lang=EN-US
  style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>charAt()</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>int</span><span lang=EN-US style='font-weight:
  normal'> Index</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>The char at a
  location in the </span><span lang=EN-US>String</span><span lang=EN-US
  style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>getChars(&nbsp;), getBytes(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>The beginning and
  end from which to copy, the array to copy into, an index into the destination
  array.</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Copy </span><span
  lang=EN-US>char</span><span lang=EN-US style='font-weight:normal'>s or </span><span
  lang=EN-US>byte</span><span lang=EN-US style='font-weight:normal'>s into an
  external array.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>toCharArray(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>&nbsp;</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Produces a </span><span
  lang=EN-US>char[]</span><span lang=EN-US style='font-weight:normal'>
  containing the characters in the </span><span lang=EN-US>String</span><span
  lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>equals(&nbsp;), equals-IgnoreCase(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>A </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> to
  compare with.</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>An equality check
  on the contents of the two </span><span lang=EN-US>Strings</span><span
  lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>compareTo(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>A </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> to compare
  with.</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Result is
  negative, zero, or positive depending on the lexicographical ordering of the </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> and the
  argument. Uppercase and lowercase are not equal!</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>regionMatches(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Offset into this </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'>, the
  other </span><span lang=EN-US>String</span><span lang=EN-US style='font-weight:
  normal'> and its offset and length to compare. Overload adds “ignore case.”</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean</span><span lang=EN-US
  style='font-weight:normal'> result indicates whether the region matches.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>startsWith(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>String</span><span lang=EN-US
  style='font-weight:normal'> that it might start with. Overload adds offset
  into argument.</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean</span><span lang=EN-US
  style='font-weight:normal'> result indicates whether the </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> starts
  with the argument.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>endsWith(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>String</span><span lang=EN-US
  style='font-weight:normal'> that might be a suffix of this </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>boolean</span><span lang=EN-US
  style='font-weight:normal'> result indicates whether the argument is a
  suffix.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>indexOf(&nbsp;), lastIndexOf(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Overloaded: </span><span
  lang=EN-US>char</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>char</span><span lang=EN-US style='font-weight:normal'> and
  starting index, </span><span lang=EN-US>String</span><span lang=EN-US
  style='font-weight:normal'>, </span><span lang=EN-US>String</span><span
  lang=EN-US style='font-weight:normal'>, and starting index.</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns -1 if the
  argument is not found within this </span><span lang=EN-US>String</span><span
  lang=EN-US style='font-weight:normal'>, otherwise returns the index where the
  argument starts. </span><span lang=EN-US>lastIndexOf(&nbsp;) </span><span
  lang=EN-US style='font-weight:normal'>searches backward from end.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>substring(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Overloaded:
  Starting index, starting index, and ending index.</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns a new </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> object
  containing the specified character set.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>concat(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>The </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> to
  concatenate</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns a new </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> object
  containing the original </span><span lang=EN-US>String</span><span
  lang=EN-US style='font-weight:normal'>’s characters followed by the
  characters in the argument.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>replace(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>The old character
  to search for, the new character to replace it with.</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns a new </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> object
  with the replacements made. Uses the old </span><span lang=EN-US>String</span><span
  lang=EN-US style='font-weight:normal'> if no match is found.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>toLowerCase(&nbsp;) toUpperCase(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>&nbsp;</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns a new </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> object
  with the case of all letters changed. Uses the old </span><span lang=EN-US>String</span><span
  lang=EN-US style='font-weight:normal'> if no changes need to be made.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>trim(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>&nbsp;</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns a new </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> object
  with the white space removed from each end. Uses the old </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> if no
  changes need to be made.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>valueOf(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Overloaded: </span><span
  lang=EN-US>Object</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>char[]</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>char[]</span><span lang=EN-US style='font-weight:normal'> and
  offset and count, </span><span lang=EN-US>boolean</span><span lang=EN-US
  style='font-weight:normal'>, </span><span lang=EN-US>char</span><span
  lang=EN-US style='font-weight:normal'>, </span><span lang=EN-US>int</span><span
  lang=EN-US style='font-weight:normal'>, </span><span lang=EN-US>long</span><span
  lang=EN-US style='font-weight:normal'>, </span><span lang=EN-US>float</span><span
  lang=EN-US style='font-weight:normal'>, </span><span lang=EN-US>double</span><span
  lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns a </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'>
  containing a character representation of the argument.</span></p>
  </td>
 </tr>
 <tr>
  <td width=156 valign=top style='width:117.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>intern(&nbsp;)</span></p>
  </td>
  <td width=168 valign=top style='width:126.0pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>&nbsp;</span></p>
  </td>
  <td width=178 valign=top style='width:133.3pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Produces one and
  only one </span><span lang=EN-US>String</span><span lang=EN-US
  style='font-weight:normal'> ref per unique character sequence.</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><a name="_Toc375545437"><span lang=EN-US>You can see
that every <b>String</b> method carefully returns a new <b>String</b> object
when it’s necessary to change the contents. Also notice that if the contents
don’t need changing the method will just return a reference to the original <b>String</b>.
This saves storage and overhead.</span></a></p>

<p class=MsoNormal><span lang=EN-US>Here’s the </span><span
lang=EN-US><b>StringBuffer</b> class:</span></p>

<div align=center>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=491
 style='border-collapse:collapse;border:none'>
 <thead>
  <tr>
   <td width=120 valign=top style='width:90.0pt;border-top:1.5pt;border-left:
   1.5pt;border-bottom:1.0pt;border-right:1.0pt;border-color:black;border-style:
   solid;padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Method</span></p>
   </td>
   <td width=204 valign=top style='width:152.85pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Arguments, overloading</span></p>
   </td>
   <td width=168 valign=top style='width:125.75pt;border-top:solid black 1.5pt;
   border-left:none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
   padding:0cm 0cm 0cm 0cm'>
   <p class=Table><span lang=EN-US>Use</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td width=120 valign=top style='width:90.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>Constructor</span></p>
  </td>
  <td width=204 valign=top style='width:152.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Overloaded:
  default, length of buffer to create, </span><span lang=EN-US>String</span><span
  lang=EN-US style='font-weight:normal'> to create from.</span></p>
  </td>
  <td width=168 valign=top style='width:125.75pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Create a new </span><span
  lang=EN-US>StringBuffer</span><span lang=EN-US style='font-weight:normal'>
  object.</span></p>
  </td>
 </tr>
 <tr>
  <td width=120 valign=top style='width:90.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>toString(&nbsp;)</span></p>
  </td>
  <td width=204 valign=top style='width:152.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=AfterTable><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=168 valign=top style='width:125.75pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Creates a </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'> from
  this </span><span lang=EN-US>StringBuffer</span><span lang=EN-US
  style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=120 valign=top style='width:90.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>length(&nbsp;)</span></p>
  </td>
  <td width=204 valign=top style='width:152.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=AfterTable><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=168 valign=top style='width:125.75pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Number of
  characters in the </span><span lang=EN-US>StringBuffer</span><span
  lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=120 valign=top style='width:90.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>capacity(&nbsp;)</span></p>
  </td>
  <td width=204 valign=top style='width:152.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=AfterTable><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=168 valign=top style='width:125.75pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns current
  number of spaces allocated.</span></p>
  </td>
 </tr>
 <tr>
  <td width=120 valign=top style='width:90.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>ensure-<br>
  Capacity(&nbsp;)</span></p>
  </td>
  <td width=204 valign=top style='width:152.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Integer indicating
  desired capacity.</span></p>
  </td>
  <td width=168 valign=top style='width:125.75pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Makes the </span><span
  lang=EN-US>StringBuffer</span><span lang=EN-US style='font-weight:normal'>
  hold at least the desired number of spaces.</span></p>
  </td>
 </tr>
 <tr>
  <td width=120 valign=top style='width:90.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>setLength(&nbsp;)</span></p>
  </td>
  <td width=204 valign=top style='width:152.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Integer indicating
  new length of character string in buffer.</span></p>
  </td>
  <td width=168 valign=top style='width:125.75pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Truncates or
  expands the previous character string. If expanding, pads with nulls.</span></p>
  </td>
 </tr>
 <tr>
  <td width=120 valign=top style='width:90.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>charAt(&nbsp;)</span></p>
  </td>
  <td width=204 valign=top style='width:152.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Integer indicating
  the location of the desired element.</span></p>
  </td>
  <td width=168 valign=top style='width:125.75pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Returns the </span><span
  lang=EN-US>char</span><span lang=EN-US style='font-weight:normal'> at that
  location in the buffer.</span></p>
  </td>
 </tr>
 <tr>
  <td width=120 valign=top style='width:90.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>setCharAt(&nbsp;)</span></p>
  </td>
  <td width=204 valign=top style='width:152.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Integer indicating
  the location of the desired element and the new </span><span lang=EN-US>char</span><span
  lang=EN-US style='font-weight:normal'> value for the element.</span></p>
  </td>
  <td width=168 valign=top style='width:125.75pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Modifies the value
  at that location.</span></p>
  </td>
 </tr>
 <tr>
  <td width=120 valign=top style='width:90.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>getChars(&nbsp;)</span></p>
  </td>
  <td width=204 valign=top style='width:152.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>The beginning and
  end from which to copy, the array to copy into, an index into the destination
  array.</span></p>
  </td>
  <td width=168 valign=top style='width:125.75pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Copy </span><span
  lang=EN-US>char</span><span lang=EN-US style='font-weight:normal'>s into an
  external array. There is no </span><span lang=EN-US>getBytes(&nbsp;)</span><span
  lang=EN-US style='font-weight:normal'> as in </span><span lang=EN-US>String</span><span
  lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
 </tr>
 <tr>
  <td width=120 valign=top style='width:90.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>append(&nbsp;)</span></p>
  </td>
  <td width=204 valign=top style='width:152.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Overloaded: </span><span
  lang=EN-US>Object</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>char[]</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>char[]</span><span lang=EN-US style='font-weight:normal'> with
  offset and length, </span><span lang=EN-US>boolean</span><span lang=EN-US
  style='font-weight:normal'>, </span><span lang=EN-US>char</span><span
  lang=EN-US style='font-weight:normal'>, </span><span lang=EN-US>int</span><span
  lang=EN-US style='font-weight:normal'>, </span><span lang=EN-US>long</span><span
  lang=EN-US style='font-weight:normal'>, </span><span lang=EN-US>float</span><span
  lang=EN-US style='font-weight:normal'>, </span><span lang=EN-US>double</span><span
  lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
  <td width=168 valign=top style='width:125.75pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>The argument is
  converted to a string and appended to the end of the current buffer,
  increasing the buffer if necessary.</span></p>
  </td>
 </tr>
 <tr>
  <td width=120 valign=top style='width:90.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>insert(&nbsp;)</span></p>
  </td>
  <td width=204 valign=top style='width:152.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>Overloaded, each
  with a first argument of the offset at which to start inserting: </span><span
  lang=EN-US>Object</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>String</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>char[]</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>boolean</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>char</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>int</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>long</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>float</span><span lang=EN-US style='font-weight:normal'>, </span><span
  lang=EN-US>double</span><span lang=EN-US style='font-weight:normal'>.</span></p>
  </td>
  <td width=168 valign=top style='width:125.75pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>The second
  argument is converted to a string and inserted into the current buffer
  beginning at the offset. The buffer is increased if necessary.</span></p>
  </td>
 </tr>
 <tr>
  <td width=120 valign=top style='width:90.0pt;border-top:none;border-left:
  solid black 1.5pt;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US>reverse(&nbsp;)</span></p>
  </td>
  <td width=204 valign=top style='width:152.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.0pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=AfterTable><span lang=EN-US>&nbsp;</span></p>
  </td>
  <td width=168 valign=top style='width:125.75pt;border-top:none;border-left:
  none;border-bottom:solid black 1.5pt;border-right:solid black 1.5pt;
  padding:0cm 0cm 0cm 0cm'>
  <p class=Table><span lang=EN-US style='font-weight:normal'>The order of the
  characters in the buffer is reversed.</span></p>
  </td>
 </tr>
</table>

</div>

<p class=TableFollower><span lang=EN-US>The most commonly used method is <b>append(&nbsp;)</b>,
which is used by the compiler when evaluating <b>String</b> expressions that
contain the ‘<b>+</b>’ and ‘<b>+=</b>’ operators. The <b>insert(&nbsp;)</b>
method has a similar form, and both methods perform significant manipulations
to the buffer instead of creating new objects.</span></p>

<h3><a name="_Toc481064944"><b><span lang=EN-US>String</span></b><span
lang=EN-US>s are special</span></a></h3>

<p class=MsoNormal><span lang=EN-US>By now you’ve seen that the <b>String</b>
class is not just another class in Java. There are a lot of special cases in <b>String</b>,
not the least of which is that it’s a built-in class and fundamental to Java.
Then there’s the fact that a quoted character string is converted to a <b>String</b>
by the compiler and the special overloaded operators <b>+</b> and <b>+=</b>. In
this appendix you’ve seen the remaining special case: the carefully built
immutability using the companion <b>StringBuffer</b> and some extra magic in
the compiler.</span></p>

<h2><a name="_Toc481064945"></a><a name="_Toc375545442"><span lang=EN-US>Summary</span></a></h2>

<p class=MsoNormal><span lang=EN-US>Because everything is a reference in Java,
and because every object is created on the heap and garbage-collected only when
it is no longer used, the flavor of object manipulation changes, especially
when passing and returning objects. For example, in C or C++, if you wanted to
initialize some piece of storage in a method, you’d probably request that the
user pass the address of that piece of storage into the method. Otherwise you’d
have to worry about who was responsible for destroying that storage. Thus, the
interface and understanding of such methods is more complicated. But in Java,
you never have to worry about responsibility or whether an object will still
exist when it is needed, since that is always taken care of for you. Your can
create an object at the point that it is needed, and no sooner, and never worry
about the mechanics of passing around responsibility for that object: you
simply pass the reference. Sometimes the simplification that this provides is
unnoticed, other times it is staggering.</span></p>

<p class=MsoNormal><span lang=EN-US>The downside to all this underlying magic
is twofold:</span></p>

<p class=Numbered><span lang=EN-US>You always take the efficiency hit for the
extra memory management (although this can be quite small), and there’s always
a slight amount of uncertainty about the time something can take to run (since
the garbage collector can be forced into action whenever you get low on
memory). For most applications, the benefits outweigh the drawbacks, and
particularly time-critical sections can be written using <b>native</b> methods
(see Appendix B). </span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>151.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><span
lang=EN-US>Aliasing: sometimes you can accidentally end up with two references
to the same object, which is a problem only if both references are assumed to
point to a <i>distinct</i> object. This is where you need to pay a little
closer attention and, when necessary, <b>clone(&nbsp;)</b> an object to prevent
the other reference from being surprised by an unexpected change.
Alternatively, you can support aliasing for efficiency by creating immutable
objects whose operations can return a new object of the same type or some
different type, but never change the original object so that anyone aliased to
that object sees no change.</span></p>

<p class=MsoNormal><span lang=EN-US>Some people say that cloning in Java is a
botched design, and to heck with it, so they implement their own version of
cloning</span><a href="#_ftn84" name="_ftnref84" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[84]</span></span></span></span></a><span lang=EN-US> and
never call the <b>Object.clone(&nbsp;)</b> method, thus eliminating the need to
implement <b>Cloneable</b> and catch the <b>CloneNotSupportedException</b>.
This is certainly a reasonable approach and since <b>clone(&nbsp;)</b> is
supported so rarely within the standard Java library, it is apparently a safe
one as well. But as long as you don’t call <b>Object.clone(&nbsp;)</b> you
don’t need to implement <b>Cloneable</b> or catch the exception, so that would
seem acceptable as well.</span></p>

<h2><a name="_Toc481064946"></a><a name="_Toc375545443"><span lang=EN-US>Exercises</span></a></h2>

<p class=MsoNormal style='line-height:normal'><span lang=EN-US
style='font-size:8.0pt'>Solutions to selected exercises can be found in the
electronic document <i>The Thinking in Java Annotated Solution Guide</i>,
available for a small fee from <i>www.BruceEckel.com</i>.</span></p>

<p class=Exercises><span lang=EN-US><span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Demonstrate a second level of aliasing. Create a
method that takes a reference to an object but doesn’t modify that reference’s
object. However, the method calls a second method, passing it the reference,
and this second method does modify the object.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>259. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class <b>myString</b> containing a <b>String</b>
object that you initialize in the constructor using the constructor’s argument.
Add a <b>toString(&nbsp;)</b> method and a method <b>concatenate(&nbsp;)</b>
that appends a <b>String</b> object to your internal string. Implement <b>clone(&nbsp;)</b>
in <b>myString</b>. Create two <b>static</b> methods that each take a <b>myString
x</b> reference as an argument and call <b>x.concatenate(&quot;test&quot;)</b>,
but in the second method call <b>clone(&nbsp;)</b> first. Test the two methods
and show the different effects.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>260. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Create a class called <b>Battery</b> containing
an <b>int</b> that is a battery number (as a unique identifier). Make it
cloneable and give it a <b>toString(&nbsp;)</b> method. Now create a class
called <b>Toy</b> that contains an array of <b>Battery</b> and a <b>toString(&nbsp;)</b>
that prints out all the batteries. Write a <b>clone(&nbsp;)</b> for <b>Toy</b>
that automatically clones all of its <b>Battery</b> objects. Test this by
cloning <b>Toy</b> and printing the result.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>261. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Change <b>CheckCloneable.java</b> so that all of
the <b>clone(&nbsp;)</b> methods catch the <b>CloneNotSupportedException</b>
rather than passing it to the caller.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>262. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Using the mutable-companion-class technique,
make an immutable class containing an <b>int</b>, a <b>double</b> and an array
of <b>char</b>.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>263. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Modify <b>Compete.java</b> to add more member
objects to classes <b>Thing2</b> and <b>Thing4</b> and see if you can determine
how the timings vary with complexity—whether it’s a simple linear relationship
or if it seems more complicated.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>264. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Starting with <b>Snake.java</b>, create a
deep-copy version of the snake.</span></p>

<p class=Exercises style='text-indent:-54.0pt'><span lang=EN-US
style='font-size:12.0pt;font-family:"Verdana","sans-serif"'><span
style='font:7.0pt "Times New Roman"'>&nbsp; </span>265. <span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US>Inherit an <b>ArrayList</b> and make its <b>clone(&nbsp;)</b>
perform a deep copy.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection23>

<h1><a name="_Toc481064947"></a><a name="_Toc477690737"><span lang=EN-US>B: </span></a><span
lang=EN-US>The Java Native Interface (JNI)</span></h1>

<p class=Intro><i><span lang=EN-US style='font-size:11.0pt'>The material in
this appendix was contributed by and used with the permission of Andrea
Provaglio (www.AndreaProvaglio.com).</span></i></p>

<p class=Intro><span lang=EN-US>The Java language and its standard API are rich
enough to write full-fledged applications. But in some cases you must call </span><span lang=EN-US>non-Java code; for example, if you want to access
operating-system-specific features, </span><span
lang=EN-US>interface with special </span><span
lang=EN-US>hardware devices, reuse a preexisting, non-Java code base, or
implement </span><span lang=EN-US>time-critical sections of code.</span></p>

<p class=MsoNormal><span lang=EN-US>Interfacing with non-Java code requires
dedicated support in the compiler and in the Virtual Machine, and additional
tools to map the Java code to the non-Java code. The standard solution for
calling non-Java code that is provided by JavaSoft is called the <i>Java Native
Interface</i>, which will be introduced in this appendix. This is not an
in-depth treatment, and in some cases you’re assumed to have partial knowledge
of the related concepts and techniques.</span></p>

<p class=MsoNormal><span lang=EN-US>JNI is a fairly rich programming interface
that allows you to call native methods from a Java application. It was added in
Java 1.1, maintaining a certain degree of compatibility with its Java 1.0
equivalent: the </span><span lang=EN-US>native method interface (NMI). NMI has design characteristics that
make it unsuitable for adoption across all virtual machines. For this reason,
future versions of the language might no longer support NMI, and it will not be
covered here.</span></p>

<p class=MsoNormal><span lang=EN-AU style='layout-grid-mode:line'>Currently,
JNI is designed to interface with native methods written only in </span><span
lang=EN-AU style='layout-grid-mode:line'>C or C++. Using JNI, your native
methods can:</span></p>

<p class=BulletTIJ><span lang=EN-AU style='font-family:Symbol;layout-grid-mode:
line'>¨<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-AU style='layout-grid-mode:line'>Create, inspect,
and update Java objects (including arrays and <b>String</b>s)</span></p>

<p class=BulletTIJ><span lang=EN-AU style='font-family:Symbol;layout-grid-mode:
line'>¨<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-AU style='layout-grid-mode:line'>Call Java methods</span></p>

<p class=BulletTIJ><span lang=EN-AU style='font-family:Symbol;layout-grid-mode:
line'>¨<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-AU style='layout-grid-mode:line'>Catch and throw
exceptions</span></p>

<p class=BulletTIJ><span lang=EN-AU style='font-family:Symbol;layout-grid-mode:
line'>¨<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-AU style='layout-grid-mode:line'>Load classes and
obtain class information</span></p>

<p class=BulletTIJ><span lang=EN-US style='font-family:Symbol'>¨<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span
lang=EN-AU style='layout-grid-mode:line'>Perform run-time type checking</span></p>

<p class=MsoNormal><span lang=EN-US>Thus, virtually everything you can do with
classes and objects in ordinary Java you can also do in native methods. </span></p>

<h2><a name="_Toc481064948"><span lang=EN-US>Calling a native method</span></a></h2>

<p class=MsoNormal><span lang=EN-US>We’ll start with a simple example: a Java
program that calls a native method, which in turn calls the standard C library
function <b>printf(&nbsp;)</b>. </span></p>

<p class=MsoNormal><span lang=EN-US>The first step is to write the Java code
declaring a native method and its arguments:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixb:ShowMessage.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class ShowMessage
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private native void
ShowMessage(String msg);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.loadLibrary(&quot;MsgImpl&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Linux hack, if
you can't get your library</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // path set in your
environment:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // System.load(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // 
&quot;/home/bruce/tij2/appendixb/MsgImpl.so&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    ShowMessage app =
new ShowMessage();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
app.ShowMessage(&quot;Generated with JNI&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The native method declaration is followed
by a <b>static</b> block that calls <b>System.loadLibrary(&nbsp;)</b> (which
you could call at any time, but this style is more appropriate). <b>System.loadLibrary(&nbsp;)</b>
loads a DLL in memory and links to it. The DLL must be in your system library
path. The file name extension is automatically added by the JVM depending on
the platform.</span></p>

<p class=MsoNormal><span lang=EN-US>In the above code you can also see a call
to the <b>System.load(&nbsp;)</b> method, which is commented out. The path
specified here is an absolute path, rather than relying on an environment
variable. Using an environment variable is naturally the better and more
portable solution, but if you can’t figure that out you can comment out the <b>loadLibrary(&nbsp;)</b>
call and uncomment this one, adjusting the path to your own directory.</span></p>

<h3><a name="_Toc481064949"><span lang=EN-US>The header file generator: javah</span></a></h3>

<p class=MsoNormal><span lang=EN-US>Now compile your Java source file and run </span><span lang=EN-US><b>javah</b> on the resulting <b>.class</b> file, specifying the <b>—jni</b>
switch (this is done automatically for you by the makefile in the source code
distribution for this book):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>javah —jni
ShowMessage</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><b><span lang=EN-US>javah</span></b><span lang=EN-US> reads
the Java class file and for each native method declaration it generates a
function prototype in a C or C++ header file. Here’s the output: the <b>ShowMessage.h</b>
source file (edited slightly to fit into this book):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>/* DO NOT EDIT THIS FILE
</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   - it is machine
generated */</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>#include &lt;jni.h&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>/* Header for class
ShowMessage */</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>#ifndef
_Included_ShowMessage</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>#define
_Included_ShowMessage</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>#ifdef __cplusplus</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>extern &quot;C&quot; {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>#endif</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>/*</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> * Class:    
ShowMessage</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> * Method:   
ShowMessage</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> * Signature:
(Ljava/lang/String;)V</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> */</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>JNIEXPORT void JNICALL </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Java_ShowMessage_ShowMessage</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  (JNIEnv *, jobject,
jstring);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>#ifdef __cplusplus</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>#endif</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>#endif</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>As you can see by the <b>#ifdef __cplusplus</b>
preprocessor directive, this file can be compiled either by a C or a C++
compiler. The first <b>#include</b> directive includes <b>jni.h</b>, a header
file that, among other things, defines the types that you can see used in the
rest of the file. </span><span lang=EN-US><b>JNIEXPORT</b> and </span><span lang=EN-US><b>JNICALL</b> are macros that expand to match platform-specific
directives. <b>JNIEnv</b>, <b>jobject</b> and <b>jstring</b> are JNI data type
definitions, which will be explained shortly.</span></p>

<h3><a name="_Toc481064950"><span lang=EN-US>Name mangling and function
signatures</span></a></h3>

<p class=MsoNormal><span lang=EN-US>JNI imposes a naming convention (called <i>name
mangling</i>) on native methods. This is important, since it’s part of the
mechanism by which the virtual machine links Java calls to native methods.
Basically, all native methods start with the word “Java,” followed by the name
of the class in which the Java native declaration appears, followed by the name
of the Java method. The underscore character is used as a separator. If the
Java native method is overloaded, then the function signature is appended to
the name as well; you can see the native signature in the comments preceding
the prototype. For more information about name mangling and native method
signatures, please refer to the JNI documentation.</span></p>

<h3><a name="_Toc481064951"><span lang=EN-US>Implementing your DLL</span></a></h3>

<p class=MsoNormal><span lang=EN-US>At this point, all you have to do is write
a C or C++ source code file that includes the <b>javah</b>-generated header
file and implements the native method, then compile it and generate a dynamic
link library. This part is platform-dependent. The code below is compiled and
linked into a file called <b>MsgImpl.dll</b> for Windows or <b>MsgImpl.so</b>
for Unix/Linux (the makefile packaged with the code listings contains the
commands to do this—it is available on the CD ROM bound into this book, or as a
free download from <i>www.BruceEckel.com</i>):</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixb:MsgImpl.cpp</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# Tested with VC++
&amp; BC++. Include path must </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# be adjusted to find
the JNI headers. See </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# the makefile for
this chapter (in the </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# downloadable source
code) for an example.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>#include &lt;jni.h&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>#include &lt;stdio.h&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>#include
&quot;ShowMessage.h&quot;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>extern &quot;C&quot;
JNIEXPORT void JNICALL </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Java_ShowMessage_ShowMessage(JNIEnv*
env, </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>jobject, jstring jMsg) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  const char*
msg=env-&gt;GetStringUTFChars(jMsg,0);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  printf(&quot;Thinking
in Java, JNI: %s\n&quot;, msg);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
env-&gt;ReleaseStringUTFChars(jMsg, msg);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>The arguments that are passed into the
native method are the gateway back into Java. The first, of type <b>JNIEnv</b>,<b>
</b>contains all the hooks that allow you to call back into the JVM. (We’ll
look at this in the next section.) The second argument has a different meaning
depending on the type of method. For non-<b>static</b> methods like the example
above, the second argument is the equivalent of the “this” pointer in C++ and
similar to <b>this</b> in Java: it’s a reference to the object that called the
native method. For <b>static</b> methods, it’s a reference to the <b>Class</b>
object where the method is implemented.</span></p>

<p class=MsoNormal><span lang=EN-US>The remaining arguments represent the Java
objects passed into the native method call. Primitives are also passed in this
way, but they come in by value.</span></p>

<p class=MsoNormal><span lang=EN-US>In the following sections we’ll explain
this code by looking at the ways that you access and control the JVM from
inside a native method.</span></p>

<h2><a name="_Toc481064952"><span lang=EN-US>Accessing JNI functions: <br>
the <b>JNIEnv</b> argument</span></a></h2>

<p class=MsoNormal><span lang=EN-US>JNI functions are those that the programmer
uses to interact with the JVM from inside a native method. As you can see in
the example above, every JNI native method receives a special argument as its
first parameter: the <b>JNIEnv</b> argument, which is a pointer to a special
JNI data structure of type <b>JNIEnv_</b>. One element of the JNI data
structure is a pointer to an array generated by the JVM. Each element of this
array is a pointer to a JNI function. The JNI functions can be called from the
native method by dereferencing these pointers (it’s simpler than it sounds).
Every JVM provides its own implementation of the JNI functions, but their
addresses will always be at predefined offsets.</span></p>

<p class=MsoNormal><span lang=EN-US>Through the <b>JNIEnv</b> argument, the
programmer has access to a large set of functions. These functions can be
grouped into the following categories:</span></p>

<p class=BulletTIJ><span lang=EN-AU style='font-family:Symbol;layout-grid-mode:
line'>¨<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-AU style='layout-grid-mode:line'>Obtaining version
information</span></p>

<p class=BulletTIJ><span lang=EN-AU style='font-family:Symbol;layout-grid-mode:
line'>¨<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-AU style='layout-grid-mode:line'>Performing class
and object operations</span></p>

<p class=BulletTIJ><span lang=EN-AU style='font-family:Symbol;layout-grid-mode:
line'>¨<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-AU style='layout-grid-mode:line'>Handling global
and local references to Java objects</span></p>

<p class=BulletTIJ><span lang=EN-AU style='font-family:Symbol;layout-grid-mode:
line'>¨<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-AU style='layout-grid-mode:line'>Accessing instance
fields and static fields</span></p>

<p class=BulletTIJ><span lang=EN-AU style='font-family:Symbol;layout-grid-mode:
line'>¨<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-AU style='layout-grid-mode:line'>Calling instance
methods and static methods</span></p>

<p class=BulletTIJ><span lang=EN-AU style='font-family:Symbol;layout-grid-mode:
line'>¨<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-AU style='layout-grid-mode:line'>Performing string
and array operations</span></p>

<p class=BulletTIJ><span lang=EN-AU style='font-family:Symbol;layout-grid-mode:
line'>¨<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-AU style='layout-grid-mode:line'>Generating and
handling Java exceptions</span></p>

<p class=MsoNormal><span lang=EN-US>The number of JNI functions is quite large
and won’t be covered here. Instead, I’ll show the rationale behind the use of
these functions. For more detailed information, consult your compiler’s JNI documentation.</span></p>

<p class=MsoNormal><span lang=EN-US>If you take a look at the <b>jni.h</b>
header file, you’ll see that inside the <b>#ifdef __cplusplus</b> preprocessor
conditional, the <b>JNIEnv_</b> structure is defined as a class when compiled
by a C++ compiler. This class contains a number of inline functions that let
you access the JNI functions with an easy and familiar syntax. For example, the
line of C++ code in the preceding example:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>env-&gt;ReleaseStringUTFChars(jMsg,
msg);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>could also be called from C like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>(*env)-&gt;ReleaseStringUTFChars(env,
jMsg, msg);</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>You’ll notice that the C style is
(naturally) more complicated—you need a double dereferencing of the <b>env</b>
pointer, and you must also pass the same pointer as the first parameter to the
JNI function call. The examples in this appendix use the C++ style.</span></p>

<h3><a name="_Toc481064953"><span lang=EN-US>Accessing Java Strings</span></a></h3>

<p class=MsoNormal><span lang=EN-US>As an example of accessing a JNI function,
consider the code in <b>MsgImpl.cpp</b>. Here, the <b>JNIEnv</b> argument <b>env</b>
is used to access a Java <b>String</b>. Java <b>String</b>s are in Unicode
format, so if you receive one and want to pass it to a non-Unicode function (<b>printf(&nbsp;)</b>,
for example), you must first convert it into ASCII characters with the JNI
function <b>GetStringUTFChars(&nbsp;)</b>. This function takes a Java <b>String</b>
and converts it to UTF-8 characters. (These are 8 bits wide to hold ASCII
values or 16 bits wide to hold Unicode. If the content of the original string
was composed only of ASCII, the resulting string will be ASCII as well.)</span></p>

<p class=MsoNormal><b><span lang=EN-US>GetStringUTFChars(&nbsp;)</span></b><span
lang=EN-US> is one of the member functions in <b>JNIEnv</b>. To access the JNI
function, we use the typical C++ syntax for calling a member function though a
pointer. You use the form above to access all of the JNI functions.</span></p>

<h2><a name="_Toc481064954"><span lang=EN-US>Passing and using Java objects</span></a></h2>

<p class=MsoNormal><span lang=EN-US>In the previous example we passed a <b>String</b>
to the native method. You can also pass Java objects of your own creation to a native
method. Inside your native method, you can access the fields and methods of the
object that was received.</span></p>

<p class=MsoNormal><span lang=EN-US>To pass objects, use the ordinary Java
syntax when declaring the native method. In the example below, <b>MyJavaClass</b>
has one <b>public</b> field and one <b>public</b> method. The class <b>UseObjects
</b>declares a native method that takes an object of class <b>MyJavaClass</b>.
To see if the native method manipulates its argument, the <b>public</b> field
of the argument is set, the native method is called, and then the value of the <b>public</b>
field is printed.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixb:UseObjects.java</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>class MyJavaClass {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public int aValue;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public void divByTwo()
{ aValue /= 2; }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>&nbsp;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>public class UseObjects
{</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  private native void </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
changeObject(MyJavaClass obj);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  static {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    System.loadLibrary(&quot;UseObjImpl&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // Linux hack, if
you can't get your library</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // path set in your
environment:</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    // System.load(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
//&quot;/home/bruce/tij2/appendixb/UseObjImpl.so&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  public static void
main(String[] args) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    UseObjects app = new
UseObjects();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    MyJavaClass anObj =
new MyJavaClass();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    anObj.aValue = 2;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
app.changeObject(anObj);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>   
System.out.println(&quot;Java: &quot; + anObj.aValue);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  }</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>After compiling the code and running <b>javah</b>,
you can implement the native method. In the example below, once the field and
method ID are obtained, they are accessed through JNI functions.</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//:
appendixb:UseObjImpl.cpp</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# Tested with VC++
&amp; BC++. Include path must </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# be adjusted to find
the JNI headers. See </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# the makefile for this
chapter (in the </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>//# downloadable source
code) for an example.</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>#include &lt;jni.h&gt;</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>extern &quot;C&quot;
JNIEXPORT void JNICALL</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>Java_UseObjects_changeObject(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>JNIEnv* env, jobject,
jobject obj) {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  jclass cls =
env-&gt;GetObjectClass(obj);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  jfieldID fid =
env-&gt;GetFieldID(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cls,
&quot;aValue&quot;, &quot;I&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  jmethodID mid =
env-&gt;GetMethodID(</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>    cls,
&quot;divByTwo&quot;, &quot;()V&quot;);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  int value =
env-&gt;GetIntField(obj, fid);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  printf(&quot;Native:
%d\n&quot;, value);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
env-&gt;SetIntField(obj, fid, 6);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US> 
env-&gt;CallVoidMethod(obj, mid);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  value =
env-&gt;GetIntField(obj, fid);</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US>  printf(&quot;Native:
%d\n&quot;, value);</span></p>

<p class=CodeInline style='margin-left:0cm'><span lang=EN-US>} ///:~</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>Ignoring the “this” equivalent, the C++
function receives a <b>jobject</b>, which is the native side of the Java object
reference we pass from the Java code. We simply read <b>aValue</b>, print it
out, change the value, call the object’s <b>divByTwo(&nbsp;)</b> method, and
print the value out again. </span></p>

<p class=MsoNormal><span lang=EN-US>To access a Java field or method, you must
first obtain its identifier using <b>GetFieldID(&nbsp;)</b> for fields and <b>GetMethodID(&nbsp;)</b>
for methods. These functions take the class object, a string containing the element
name, and a string that gives type information: the data type of the field, or
signature information for a method (details can be found in the JNI
documentation). These functions return an identifier that you use to access the
element. This approach might seem convoluted, but your native method has no
knowledge of the internal layout of the Java object. Instead, it must access
fields and methods through indexes returned by the JVM. This allows different
JVMs to implement different internal object layouts with no impact on your
native methods.</span></p>

<p class=MsoNormal><span lang=EN-US>If you run the Java program, you’ll see
that the object that’s passed from the Java side is manipulated by your native
method. But what exactly is passed? A pointer or a Java reference? And what is
the garbage collector doing during native method calls?</span></p>

<p class=MsoNormal><span lang=EN-US>The </span><span
lang=EN-US>garbage collector continues to operate during native method
execution, but it’s guaranteed that your objects will not be garbage-collected
during a native method call. To ensure this, <i>local references</i> are
created before, and destroyed right after, the native method call. Since their
lifetime wraps the call, you know that the objects will be valid throughout the
native method call.</span></p>

<p class=MsoNormal><span lang=EN-US>Since these references are created and
subsequently destroyed every time the function is called, you cannot make local
copies in your native methods, in <b>static</b> variables. If you want a
reference that lasts across function invocations, you need a global reference.
Global references are not created by the JVM, but the programmer can make a
global reference out of a local one by calling specific JNI functions. When you
create a global reference, you become responsible for the lifetime of the
referenced object. The global reference (and the object it refers to) will be
in memory until the programmer explicitly frees the reference with the
appropriate JNI function. It’s similar to <b>malloc(&nbsp;)</b> and <b>free(&nbsp;)</b>
in C.</span></p>

<h2><a name="_Toc481064955"><span lang=EN-US>JNI and Java exceptions</span></a></h2>

<p class=MsoNormal><span lang=EN-US>With </span><span
lang=EN-US>JNI, Java exceptions can be thrown, caught, printed, and rethrown
just as they are inside a Java program. But it’s up to the programmer to call
dedicated JNI functions to deal with exceptions. Here are the JNI functions for
exception handling:</span></p>

<p class=BulletTIJ><span lang=EN-US style='font-family:Symbol'>¨<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Throw(&nbsp;)</span></b><span lang=EN-US><br>
Throws an existing exception object. Used in native methods to rethrow an
exception.</span></p>

<p class=BulletTIJ><span lang=EN-US style='font-family:Symbol'>¨<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><span
lang=EN-US>ThrowNew(&nbsp;)<br>
</span></b><span lang=EN-US>Generates a new exception object and throws it.</span></p>

<p class=BulletTIJ><span lang=EN-US style='font-family:Symbol'>¨<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><span
lang=EN-US>ExceptionOccurred(&nbsp;)</span></b><span lang=EN-US><br>
Determines if an exception was thrown and not yet cleared.</span></p>

<p class=BulletTIJ><span lang=EN-US style='font-family:Symbol'>¨<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><span
lang=EN-US>ExceptionDescribe(&nbsp;)</span></b><span lang=EN-US><br>
Prints an exception and the stack trace.</span></p>

<p class=BulletTIJ><span lang=EN-US style='font-family:Symbol'>¨<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><span
lang=EN-US>ExceptionClear(&nbsp;)</span></b><span lang=EN-US><br>
Clears a pending exception.</span></p>

<p class=BulletTIJ><span lang=EN-US style='font-family:Symbol'>¨<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><b><span
lang=EN-US>FatalError(&nbsp;)</span></b><span lang=EN-US><br>
Raises a fatal error. Does not return.</span></p>

<p class=MsoNormal><span lang=EN-US>Among these, you can’t ignore <b>ExceptionOccurred(&nbsp;)</b>
and <b>ExceptionClear(&nbsp;)</b>. Most JNI functions can generate exceptions,
and there is no language feature that you can use in place of a Java try block,
so you must call <b>ExceptionOccurred(&nbsp;) </b>after each JNI function call
to see if an exception was thrown. If you detect an exception, you may choose
to handle it (and possibly rethrow it). You must make certain, however, that
the exception is eventually cleared. This can be done in your function using <b>ExceptionClear(&nbsp;)</b>
or in some other function if the exception is rethrown, but it must be done.</span></p>

<p class=MsoNormal><span lang=EN-US>You must ensure that the exception is
cleared, because otherwise the results will be unpredictable if you call a JNI
function while an exception is pending. There are few JNI functions that are
safe to call during an exception; among these, of course, are all the exception
handling functions.</span></p>

<h2><a name="_Toc481064956"><span lang=EN-US>JNI and threading</span></a></h2>

<p class=MsoNormal><span lang=EN-AU style='layout-grid-mode:line'>Since Java is
a multithreaded language, several threads can call a native method
concurrently. (The native method might be suspended in the middle of its
operation when a second thread calls it.) It’s entirely up to the programmer to
guarantee that the native call is thread-safe; i.e., it does not modify shared
data in an unmonitored way. Basically, you have two options: declare the native
method as <b>synchronized</b></span><span lang=EN-US>,</span><span lang=EN-AU
style='layout-grid-mode:line'> or implement some other strategy within the
native method to ensure correct, concurrent data manipulation.</span></p>

<p class=MsoNormal><span lang=EN-AU style='layout-grid-mode:line'>Also, you
should never pass the <b>JNIEnv</b> pointer across threads, since the internal
structure it points to is allocated on a per-thread basis and contains
information that makes sense only in that particular thread.</span></p>

<h2><a name="_Toc481064957"><span lang=EN-US>Using a preexisting code base</span></a></h2>

<p class=MsoNormal><span lang=EN-US>The easiest way to implement JNI native
methods is to start writing native method prototypes in a Java class, compile
that class, and run the <b>.class</b> file through <b>javah</b>. But what if
you have a large, preexisting code base that you want to call from Java?
Renaming all the functions in your DLLs to match the JNI name mangling
convention is not a viable solution. The best approach is to write a wrapper
DLL “outside” your original code base. The Java code calls functions in this
new DLL, which in turn calls your original DLL functions. This solution is not
just a work-around; in most cases you must do this anyway because you must call
JNI functions on the object references before you can use them.</span></p>

<h2><a name="_Toc481064958"><span lang=EN-US>Additional information</span></a></h2>

<p class=MsoNormal><span lang=EN-US>You can find further introductory material,
including a C (rather than C++) example and discussion of Microsoft issues, in
Appendix A of the first edition of this book, which can be found on the CD ROM
bound in with this book, or in a free download from <i>www.BruceEckel.com</i>.
More extensive information is available at <i>java.sun.com</i> (in the search
engine, select “training &amp; tutorials” for keywords “native methods”).
Chapter 11 of <i>Core Java 2</i>, <i>Volume II</i>, by Horstmann &amp; Cornell
(Prentice-Hall, 2000) gives excellent coverage of native methods.</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection24>

<h1><a name="_Toc481064959"></a><a name="_Toc477690738"></a><a
name="_Toc375545509"></a><a name="Appendix_B"></a><a name="Appendix_C"></a><span
lang=EN-US>C: Java Programming Guidelines</span></h1>

<p class=Intro><span lang=EN-US>This appendix contains suggestions to help
guide you in performing low-level program design, and in writing </span><span lang=EN-US>code.</span></p>

<p class=MsoNormal><span lang=EN-US>Naturally, these are guidelines and not
rules. The idea is to use them as inspirations, and to remember that there are
occasional situations where you need to bend or break a rule.</span></p>

<h2><a name="_Toc481064960"><span lang=EN-US>Design</span></a></h2>

<p class=Numbered><b><span lang=EN-US>Elegance always pays off</span></b><span
lang=EN-US>. In the short term it might seem like it takes much longer to come
up with a truly graceful solution to a problem, but when it works the first
time and easily adapts to new situations instead of requiring hours, days, or
months of struggle, you’ll see the rewards (even if no one can measure them).
Not only does it give you a program that’s easier to build and debug, but it’s
also easier to understand and maintain, and that’s where the financial value
lies. This point can take some experience to understand, because it can appear
that you’re not being productive while you’re making a piece of code elegant.
Resist the urge to hurry; it will only slow you down.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>152.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>First make it work, then make it fast</span></b><span lang=EN-US>.
This is true even if you are certain that a piece of code is really important
and that it will be a principal bottleneck in your system. Don’t do it. Get the
system going first with as simple a design as possible. Then if it isn’t going
fast enough, profile it. You’ll almost always discover that “your” bottleneck
isn’t the problem. Save your time for the really important stuff.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>153.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Remember the “divide and conquer” principle</span></b><span
lang=EN-US>. If the problem you’re looking at is too confusing, try to imagine
what the basic operation of the program would be, given the existence of a
magic “piece” that handles the hard parts. That “piece” is an object—write the
code that uses the object, then look at the object and encapsulate <i>its</i>
hard parts into other objects, etc.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>154.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Separate the class creator from the class user (<i>client programmer</i>)</span></b><span
lang=EN-US>. The class user is the “customer” and doesn’t need or want to know
what’s going on behind the scenes of the class. The class creator must be the
expert in class design and write the class so that it can be used by the most
novice programmer possible, yet still work robustly in the application. Library
use will be easy only if it’s transparent.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>155.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>When you create a class, attempt to make your names so clear that
comments are unnecessary</span></b><span lang=EN-US>. Your goal should be to
make the client programmer’s interface conceptually simple. To this end, use
method overloading when appropriate to create an intuitive, easy-to-use
interface.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>156.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Your analysis and design must produce, at minimum, the classes in
your system, their public interfaces, and their relationships to other classes,
especially base classes</span></b><span lang=EN-US>. If your design methodology
produces more than that, ask yourself if all the pieces produced by that
methodology have value over the lifetime of the program. If they do not,
maintaining them will cost you. Members of development teams tend not to
maintain anything that does not contribute to their productivity; this is a
fact of life that many design methods don’t account for.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>157.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Automate everything</span></b><span lang=EN-US>.<b> </b>Write the
test code first (before you write the class), and keep it with the class.
Automate the running of your tests through a makefile or similar tool. This
way, any changes can be automatically verified by running the test code, and
you’ll immediately discover errors. Because you know that you have the safety
net of your test framework, you will be bolder about making sweeping changes when
you discover the need. Remember that the greatest improvements in languages
come from the built-in testing provided by type checking, exception handling,
etc., but those features take you only so far. You must go the rest of the way
in creating a robust system by filling in the tests that verify features that
are specific to your class or program.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>158.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Write the test code first (before you write the class) in order to
verify that your class design is complete</span></b><span lang=EN-US>. If you
can’t write test code, you don’t know what your class looks like. In addition,
the act of writing the test code will often flush out additional features or
constraints that you need in the class—these features or constraints don’t
always appear during analysis and design. Tests also provide example code
showing how your class can be used.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>159.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>All software design problems can be simplified by introducing an
extra level of conceptual indirection</span></b><i><span lang=EN-US>.</span></i><span
lang=EN-US> This fundamental rule of software engineering</span><a
href="#_ftn85" name="_ftnref85" title=""><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt'><span class=MsoFootnoteReference><span
lang=EN-US style='font-size:8.0pt;font-family:"Georgia","serif"'>[85]</span></span></span></span></a><span
lang=EN-US> is the basis of abstraction, the primary feature of object-oriented
programming.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>160.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>An indirection should have a meaning </span></b><span lang=EN-US>(in
concert with guideline 9). This meaning can be something as simple as “putting
commonly used code in a single method.” If you add levels of indirection
(abstraction, encapsulation, etc.) that don’t have meaning, it can be as bad as
not having adequate indirection.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>161.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Make classes as atomic as possible</span></b><span lang=EN-US>. Give
each class a single, clear purpose. If your classes or your system design grows
too complicated, break complex classes into simpler ones. The most obvious
indicator of this is sheer size: if a class is big, chances are it’s doing too
much and should be broken up.<br>
Clues to suggest redesign of a class are:<br>
1) A complicated switch statement: consider using polymorphism. <br>
2) A large number of methods that cover broadly different types of operations:
consider using several classes.<br>
3) A large number of member variables that concern broadly different
characteristics: consider using several classes.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>162.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Watch for long argument lists</span></b><span lang=EN-US>. Method
calls then become difficult to write, read, and maintain. Instead, try to move
the method to a class where it is (more) appropriate, and/or pass objects in as
arguments.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>163.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Don’t repeat yourself</span></b><span lang=EN-US>. If a piece of
code is recurring in many methods in derived classes, put that code into a
single method in the base class and call it from the derived-class methods. Not
only do you save code space, you provide for easy propagation of changes.
Sometimes the discovery of this common code will add valuable functionality to
your interface.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>164.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Watch for <i>switch</i> statements or chained <i>if-else</i> clauses</span></b><span
lang=EN-US>. This is typically an indicator of <i>type-check coding</i>, which
means you are choosing what code to execute based on some kind of type
information (the exact type may not be obvious at first). You can usually
replace this kind of code with inheritance and polymorphism; a polymorphic
method call will perform the type checking for you, and allow for more reliable
and easier extensibility.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>165.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>From a design standpoint, look for and separate things that change
from things that stay the same</span></b><span lang=EN-US>. That is, search for
the elements in a system that you might want to change without forcing a
redesign, then encapsulate those elements in classes. You can learn
significantly more about this concept in <i>Thinking in Patterns with Java</i>,
downloadable at <i>www.BruceEckel.com</i>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>166.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Don’t extend fundamental functionality by subclassing</span></b><span
lang=EN-US>. If an interface element is essential to a class it should be in
the base class, not added during derivation. If you’re adding methods by
inheriting, perhaps you should rethink the design.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>167.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Less is more</span></b><span lang=EN-US>. Start with a minimal
interface to a class, as small and simple as you need to solve the problem at
hand, but don’t try to anticipate all the ways that your class <i>might</i> be
used. As the class is used, you’ll discover ways you must expand the interface.
However, once a class is in use you cannot shrink the interface without
disturbing client code. If you need to add more methods, that’s fine; it won’t
disturb code, other than forcing recompiles. But even if new methods replace
the functionality of old ones, leave the existing interface alone (you can
combine the functionality in the underlying implementation if you want). If you
need to expand the interface of an existing method by adding more arguments,
create an overloaded method with the new arguments; this way you won’t disturb
any existing calls to the existing method.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>168.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Read your classes aloud to make sure they’re logical</span></b><span
lang=EN-US>. Refer to the relationship between a base class and derived class
as “is-a” and member objects as “has-a.”</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>169.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>When deciding between inheritance and composition, ask if you need
to upcast to the base type</span></b><span lang=EN-US>. If not, prefer
composition (member objects) to inheritance. This can eliminate the perceived
need for multiple base types. If you inherit, users will think they are
supposed to upcast.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>170.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Use data members for variation in value and method overriding for
variation in behavior</span></b><span lang=EN-US>. That is, if you find a class
that uses state variables along with methods that switch behavior based on
those variables, you should probably redesign it to express the differences in
behavior within subclasses and overridden methods.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>171.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Watch for overloading</span></b><span lang=EN-US>. A method should
not conditionally execute code based on the value of an argument. In this case,
you should create two or more overloaded methods instead.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>172.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Use exception hierarchies</span></b><span lang=EN-US>—preferably
derived from specific appropriate classes in the standard Java exception
hierarchy. The person catching the exceptions can then catch the specific types
of exceptions, followed by the base type. If you add new derived exceptions,
existing client code will still catch the exception through the base type.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>173.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Sometimes simple aggregation does the job</span></b><span
lang=EN-US>. A “passenger comfort system” on an airline consists of
disconnected elements: seat, air conditioning, video, etc., and yet you need to
create many of these in a plane. Do you make private members and build a whole
new interface? No—in this case, the components are also part of the public
interface, so you should create public member objects. Those objects have their
own private implementations, which are still safe. Be aware that simple
aggregation is not a solution to be used often, but it does happen.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>174.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Consider the perspective of the client programmer and the person
maintaining the code</span></b><span lang=EN-US>. Design your class to be as
obvious as possible to use. Anticipate the kind of changes that will be made,
and design your class so that those changes will be easy.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>175.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Watch out for “giant object syndrome.”</span></b><span lang=EN-US>
This is often an affliction of procedural programmers who are new to OOP and
who end up writing a procedural program and sticking it inside one or two giant
objects. With the exception of application frameworks, objects represent
concepts in your application, not the application.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>176.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>If you must do something ugly, at least localize the ugliness inside
a class</span></b><span lang=EN-US>.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>177.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>If you must do something nonportable, make an abstraction for that
service and localize it within a class</span></b><span lang=EN-US>. This extra
level of indirection prevents the nonportability from being distributed
throughout your program. (This idiom is embodied in the <i>Bridge </i>Pattern).</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>178.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Objects should not simply hold some data</span></b><span lang=EN-US>.
They should also have well-defined behaviors. (Occasionally, “data objects” are
appropriate, but only when used expressly to package and transport a group of
items when a generalized container is innappropriate.)</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>179.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Choose composition first when creating new classes from existing
classes</span></b><span lang=EN-US>. You should only used inheritance if it is
required by your design. If you use inheritance where composition will work,
your designs will become needlessly complicated.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>180.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Use inheritance and method overriding to express differences in
behavior, and fields to express variations in state</span></b><span lang=EN-US>.
An extreme example of what not to do is inheriting different classes to
represent colors instead of using a “color” field.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>181.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Watch out for <i>variance</i></span></b><span lang=EN-US>. Two
semantically different objects may have identical actions, or responsibilities,
and there is a natural temptation to try to make one a subclass of the other
just to benefit from inheritance. This is called variance, but there’s no real
justification to force a superclass/subclass relationship where it doesn’t
exist. A better solution is to create a general base class that produces an
interface for both as derived classes—it requires a bit more space, but you
still benefit from inheritance, and will probably make an important discovery
about the design.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>182.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Watch out for <i>limitation</i> during inheritance</span></b><span
lang=EN-US>. The clearest designs add new capabilities to inherited ones. A
suspicious design removes old capabilities during inheritance without adding
new ones. But rules are made to be broken, and if you are working from an old
class library, it may be more efficient to restrict an existing class in its
subclass than it would be to restructure the hierarchy so your new class fits
in where it should, above the old class.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>183.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Use design patterns to eliminate “naked functionality.”</span></b><span
lang=EN-US> That is, if only one object of your class should be created, don’t
bolt ahead to the application and write a comment “Make only one of these.”
Wrap it in a singleton. If you have a lot of messy code in your main program
that creates your objects, look for a creational pattern like a factory method
in which you can encapsulate that creation. Eliminating “naked functionality”
will not only make your code much easier to understand and maintain, it will
also make it more bulletproof against the well-intentioned maintainers that
come after you.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>184.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Watch out for “analysis paralysis.”</span></b><span lang=EN-US>
Remember that you must usually move forward in a project before you know
everything, and that often the best and fastest way to learn about some of your
unknown factors is to go to the next step rather than trying to figure it out
in your head. You can’t know the solution until you <i>have</i> the solution. </span><span
lang=EN-US>Java has built-in firewalls; let them work for you. Your mistakes in
a class or set of classes won’t destroy the integrity of the whole system.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>185.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>When you think you’ve got a good analysis, design, or
implementation, do a walkthrough</span></b><span lang=EN-US>. Bring someone in
from outside your group—this doesn’t have to be a consultant, but can be
someone from another group within your company. Reviewing your work with a
fresh pair of eyes can reveal problems at a stage when it’s much easier to fix
them, and more than pays for the time and money “lost” to the walkthrough
process.</span></p>

<h2><a name="_Toc481064961"><span lang=EN-US>Implementation</span></a></h2>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>186.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>In general, follow the Sun coding conventions</span></b><span
lang=EN-US>. These are available at<br>
<i>java.sun.com/docs/codeconv/index.html</i> (the code in this book follows
these conventions as much as I was able). These are used for what constitutes
arguably the largest body of code that the largest number of Java programmers
will be exposed to. If you doggedly stick to the coding style you’ve always
used, you will make it harder for your reader. Whatever coding conventions you
decide on, ensure they are consistent throughout the project. There is a free
tool to automatically reformat Java code at: <i>home.wtal.de/software-solutions/jindent.</i></span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>187.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Whatever coding style you use, it really does make a difference if
your team (and even better, your company) standardizes on it</span></b><span
lang=EN-US>. This means to the point that everyone considers it fair game to
fix someone else’s coding style if it doesn’t conform. The value of
standardization is that it takes less brain cycles to parse the code, so that
you can focus more on what the code means.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>188.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Follow standard capitalization rules</span></b><span lang=EN-US>.
Capitalize the first letter of class names. The first letter of fields,
methods, and objects (references) should be lowercase. All identifiers should
run their words together, and capitalize the first letter of all intermediate
words. For example:<br>
<b>ThisIsAClassName<br>
thisIsAMethodOrFieldName</b><br>
Capitalize <i>all</i> the letters of <b>static</b> <b>final</b> primitive
identifiers that have constant initializers in their definitions. This indicates
they are compile-time constants.<br>
<b>Packages are a special case</b>—they are all lowercase letters, even for
intermediate words. The domain extension (com, org, net, edu, etc.) should also
be lowercase. (This was a change between Java 1.1 and Java 2.)</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>189.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Don’t create your own “decorated” private data member names</span></b><span
lang=EN-US>. This is usually seen in the form of prepended underscores and
characters. Hungarian notation is the worst example of this, where you attach
extra characters that indicate data type, use, location, etc., as if you were
writing assembly language and the compiler provided no extra assistance at all.
These notations are confusing, difficult to read, and unpleasant to enforce and
maintain. Let classes and packages do the name scoping for you.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>190.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Follow a “canonical form” </span></b><span lang=EN-US>when creating
a class for general-purpose use. Include definitions for <b>equals(&nbsp;)</b>,
<b>hashCode(&nbsp;)</b>, <b>toString(&nbsp;)</b>, <b>clone(&nbsp;)</b>
(implement <b>Cloneable</b>), and implement <b>Comparable </b>and <b>Serializable</b>.
</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>191.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Use the JavaBeans “get,” “set,” and “is” naming conventions</span></b><span
lang=EN-US> for methods that read and change <b>private</b> fields, even if you
don’t think you’re making a JavaBean at the time. Not only does it make it easy
to use your class as a Bean, but it’s a standard way to name these kinds of
methods and so will be more easily understood by the reader.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>192.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>For each class you create, consider including a <i>static public
test(&nbsp;)</i> that contains code to test that class</span></b><span
lang=EN-US>. You don’t need to remove the test code to use the class in a
project, and if you make any changes you can easily rerun the tests. This code
also provides examples of how to use your class.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>193.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Sometimes you need to inherit in order to access <i>protected</i>
members of the base class</span></b><span lang=EN-US>. This can lead to a
perceived need for multiple base types. If you don’t need to upcast, first
derive a new class to perform the protected access. Then make that new class a
member object inside any class that needs to use it, rather than inheriting.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>194.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Avoid the use of <i>final</i> methods for efficiency purposes</span></b><span
lang=EN-US>. Use <b>final </b>only when the program is running, but not fast
enough, and your profiler has shown you that a method invocation is the bottleneck.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>195.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>If two classes are associated with each other in some functional way
(such as containers and iterators), try to make one an inner class of the other</span></b><span
lang=EN-US>. This not only emphasizes the association between the classes, but
it allows the class name to be reused within a single package by nesting it
within another class. The Java containers library does this by defining an
inner <b>Iterator</b> class inside each container class, thereby providing the
containers with a common interface. The other reason you’ll want to use an
inner class is as part of the <b>private </b>implementation. Here, the inner
class beneficial for implementation hiding rather than the class association
and prevention of namespace pollution noted above.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>196.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Anytime you notice classes that appear to have high coupling with
each other, consider the coding and maintenance improvements you might get by
using inner classes</span></b><span lang=EN-US>. The use of inner classes will
not uncouple the classes, but rather make the coupling explicit and more
convenient.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>197.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Don’t fall prey to premature optimization</span></b><span
lang=EN-US>. This way lies madness. In particular, don’t worry about writing
(or avoiding) native methods, making some methods <b>final</b>, or tweaking
code to be efficient when you are first constructing the system. Your primary
goal should be to prove the design, unless the design requires a certain
efficiency.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>198.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Keep scopes as small as possible so the visibility and lifetime of
your objects are as small as possible</span></b><span lang=EN-US>. This reduces
the chance of using an object in the wrong context and hiding a
difficult-to-find bug. For example, suppose you have a container and a piece of
code that iterates through it. If you copy that code to use with a new
container, you may accidentally end up using the size of the old container as
the upper bound of the new one. If, however, the old container is out of scope,
the error will be caught at compile-time.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>199.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Use the containers in the standard Java library</span></b><span
lang=EN-US>. Become proficient with their use and you’ll greatly increase your
productivity. Prefer <b>ArrayList</b> for sequences, <b>HashSet</b> for sets, <b>HashMap</b>
for associative arrays, and <b>LinkedList</b> for stacks (rather than <b>Stack</b>)
and queues.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>200.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>For a program to be robust, each component must be robust</span></b><span
lang=EN-US>. Use all the tools provided by Java: access control, exceptions,
type checking, and so on, in each class you create. That way you can safely
move to the next level of abstraction when building your system.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>201.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Prefer compile-time errors to run-time errors</span></b><span
lang=EN-US>. Try to handle an error as close to the point of its occurrence as
possible. Prefer dealing with the error at that point to throwing an exception.
Catch any exceptions in the nearest handler that has enough information to deal
with them. Do what you can with the exception at the current level; if that
doesn’t solve the problem, rethrow the exception.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>202.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Watch for long method definitions</span></b><span lang=EN-US>. Methods
should be brief, functional units that describe and implement a discrete part
of a class interface. A method that is long and complicated is difficult and
expensive to maintain, and is probably trying to do too much all by itself. If
you see such a method, it indicates that, at the least, it should be broken up
into multiple methods. It may also suggest the creation of a new class. Small
methods will also foster reuse within your class. (Sometimes methods must be
large, but they should still do just one thing.)</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>203.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Keep things as “<i>private</i> as possible.”</span></b><span
lang=EN-US> Once you publicize an aspect of your library (a method, a class, a
field), you can never take it out. If you do, you’ll wreck somebody’s existing
code, forcing them to rewrite and redesign. If you publicize only what you
must, you can change everything else with impunity, and since designs tend to
evolve this is an important freedom. In this way, implementation changes will
have minimal impact on derived classes. Privacy is especially important when
dealing with multithreading—only <b>private</b> fields can be protected against
un-<b>synchronized</b> use.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>204.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Use comments liberally, and use the <i>javadoc</i>
comment-documentation syntax to produce your program documentation</span></b><span
lang=EN-US>. However, the comments should add geniune meaning to the code;
comments that only reiterate what the code is clearly expressing are annoying.
Note that the typical verbose detail of Java class and method names reduce the
need for as many comments.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>205.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Avoid using “magic numbers”</span></b><span lang=EN-US>—which are
numbers hard-wired into code. These are a nightmare if you need to change them,
since you never know if “100” means “the array size” or “something else
entirely.” Instead, create a constant with a descriptive name and use the
constant identifier throughout your program. This makes the program easier to
understand and much easier to maintain.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>206.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>When creating constructors, consider exceptions</span></b><span
lang=EN-US>. In the best case, the constructor won’t do anything that throws an
exception. In the next-best scenario, the class will be composed and inherited
from robust classes only, so they will need no cleanup if an exception is
thrown. Otherwise, you must clean up composed classes inside a <b>finally</b>
clause. If a constructor must fail, the appropriate action is to throw an
exception, so the caller doesn’t continue blindly, thinking that the object was
created correctly.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>207.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>If </span><span lang=EN-US>your class requires any cleanup when the
client programmer is finished with the object, place the cleanup code in a
single, well-defined method</span></b><span lang=EN-US>—with a name like <b>cleanup(&nbsp;)</b>
that clearly suggests its purpose. In addition, place a <b>boolean</b> flag in
the class to indicate whether the object has been cleaned up so that <b>finalize(&nbsp;)</b>
can check for “the death condition” (see Chapter 4).</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>208.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>The responsibility of <i>finalize(&nbsp;)</i> can only be to verify
“the death condition” of an object for debugging.</span></b><span lang=EN-US>
(See Chapter 4.) In special cases, it might be needed to release memory that
would not otherwise be released by the garbage collector. Since the garbage
collector might not get called for your object, you cannot use <b>finalize(&nbsp;)
</b>to perform necessary cleanup. For that you must create your own “cleanup”
method. In the <b>finalize(&nbsp;)</b> method for the class, check to make sure
that the object has been cleaned up and throw a class derived from <b>RuntimeException</b>
if it hasn’t, to indicate a programming error. Before relying on such a scheme,
ensure that <b>finalize(&nbsp;) </b>works on your system. (You might need to
call <b>System.gc(&nbsp;)</b> to ensure this behavior.)</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>209.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>If an object must be cleaned up (other than by garbage collection) within
a particular scope, use the following approach:</span></b><span lang=EN-US>
Initialize the object and, if successful, immediately enter a <b>try</b> block
with a <b>finally</b> clause that performs the cleanup.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>210.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>When overriding <i>finalize(&nbsp;)</i> during inheritance, remember
to call <i>super.finalize(&nbsp;)</i></span></b><b><span lang=EN-US>.</span></b><span
lang=EN-US> (This is not necessary if <b>Object</b> is your immediate
superclass.) You should call <b>super.finalize(&nbsp;)</b> as the <i>final</i>
act of your overridden <b>finalize(&nbsp;)</b> rather than the first, to ensure
that base-class components are still valid if you need them.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>211.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>When you are creating a fixed-size container of objects, transfer
them to an array</span></b><span lang=EN-US>—especially if you’re returning
this container from a method. This way you get the benefit of the array’s
compile-time type checking, and the recipient of the array might not need to
cast the objects in the array in order to use them. Note that the base-class of
the containers library, <b>java.util.Collection</b>, has two <b>toArray(&nbsp;)</b>
methods to accomplish this.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>212.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Choose <i>interfaces</i> over <i>abstract</i> classes</span></b><span
lang=EN-US>. If you know something is going to be a base class, your first
choice should be to make it an <b>interface</b>, and only if you’re forced to
have method definitions or member variables should you change it to an <b>abstract</b>
class. An <b>interface </b>talks about what the client wants to do, while a
class tends to focus on (or allow) implementation details.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>213.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Inside constructors, do only what is necessary to set the object
into the proper state</span></b><span lang=EN-US>. Actively avoid calling other
methods (except for <b>final</b> methods) since those methods can be overridden
by someone else to produce unexpected results during construction. (See Chapter
7 for details.) Smaller, simpler constructors are less likely to throw
exceptions or cause problems.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>214.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>To avoid a highly frustrating experience, make sure that there is
only one unpackaged class of each name anywhere in your classpath</span></b><span
lang=EN-US>. Otherwise, the compiler can find the identically-named other class
first, and report error messages that make no sense. If you suspect that you
are having a classpath problem, try looking for <b>.class</b> files with the
same names at each of the starting points in your classpath. Ideally, put all
your classes within packages.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>215.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Watch out for accidental overloading</span></b><span lang=EN-US>. If
you attempt to override a base-class method and you don’t quite get the
spelling right, you’ll end up adding a new method rather than overriding an
existing method. However, this is perfectly legal, so you won’t get any error
message from the compiler or run-time system—your code simply won’t work
correctly.</span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>216.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Watch out for premature optimization</span></b><span lang=EN-US>.
First make it work, then make it fast—but only if you must, and only if it’s
proven that there is a performance bottleneck in a particular section of your
code. Unless you have used a profiler to discover a bottleneck, you will
probably be wasting your time. The hidden cost of performance tweaks is that
your code becomes less understandable and maintainable. </span></p>

<p class=Numbered><span lang=EN-US style='font-family:"Verdana","sans-serif"'>217.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span><b><span
lang=EN-US>Remember that code is read much more than it is written</span></b><span
lang=EN-US>. Clean designs make for easy-to-understand programs, but comments,
detailed explanations, and examples are invaluable. They will help both you and
everyone who comes after you. If nothing else, the frustration of trying to
ferret out useful information from the online Java documentation should
convince you.</span></p>

<p class=Numbered style='margin-left:18.0pt;text-indent:0cm'><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:14.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection25>

<h1><a name="_Toc481064962"></a><a name="_Toc477690739"></a><a name="Appendix_D"></a><span
lang=EN-US>D: Resources</span></h1>

<h2><a name="_Toc481064963"><span lang=EN-US>Software</span></a></h2>

<p class=MsoNormal><b><span lang=EN-US>The JDK </span></b><span lang=EN-US>from
<i>java.sun.com</i>. Even if you choose to use a third-party development
environment, it’s always a good idea to have the JDK on hand in case you come
up against what might be a compiler error. The JDK is the touchstone, and if
there is a bug in it, chances are it will be well-known.</span></p>

<p class=MsoNormal><b><span lang=EN-US>The HTML Java documentation</span></b><span
lang=EN-US> from <i>java.sun.com</i>. I have never found a reference book on
the standard Java libraries that wasn’t out of date or missing information.
Although the HTML documentation from Sun is shot-through with small bugs and is
sometimes unusably terse, all the classes and methods are at least <i>there</i>.
People are sometimes uncomfortable at first using an online resource rather
than a printed book, but it’s worth your while to get over this and open the
HTML docs first, so you can at least get the big picture. If you can’t figure
it out at that point, then reach for the printed books.</span></p>

<h2><a name="_Toc481064964"><span lang=EN-US>Books</span></a></h2>

<p class=MsoNormal><b><i><span lang=EN-US>Thinking in Java, 1<sup>st</sup>
Edition</span></i></b><span lang=EN-US>. Available as fully-indexed,
color-syntax-highlighted HTML on the CD ROM bound in with this book, or as a
free download from <i>www.BruceEckel.com</i>. Includes older material and
material that was not considered interesting enough to carry through to the 2<sup>nd</sup>
edition.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Core Java 2</span></i></b><span
lang=EN-US>, by Horstmann &amp; Cornell, Volume I—Fundamentals (Prentice-Hall,
1999). Volume II—Advanced Features, 2000. Huge, comprehensive, and the first
place I go when I’m hunting for answers. The book I recommend when you’ve
completed <i>Thinking in Java</i> and need to cast a bigger net.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Java in a Nutshell: A Desktop Quick
Reference, 2nd Edition</span></i></b><span lang=EN-US>,<b> </b>by David
Flanagan (O’Reilly, 1997). A compact summary of the online Java documentation.
Personally, I prefer to browse the docs from <i>java.sun.com</i> online,
especially since they change so often. However, many folks still like printed
documentation and this fits the bill; it also provides more discussion than the
online documents.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>The Java Class Libraries: An
Annotated Reference</span></i></b><span lang=EN-US>,<b> </b>by Patrick Chan and
Rosanna Lee (Addison-Wesley, 1997). What the online reference <i>should</i>
have been: enough description to make it usable. One of the technical reviewers
for <i>Thinking in Java</i> said, “If I had only one Java book, this would be
it (well, in addition to yours, of course).” I’m not as thrilled with it as he
is. It’s big, it’s expensive, and the quality of the examples doesn’t satisfy
me. <i>But</i> it’s a place to look when you’re stuck and it seems to have more
depth (and sheer size) than <i>Java in a Nutshell</i>.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Java Network Programming</span></i></b><span
lang=EN-US>, by Elliotte Rusty Harold (O’Reilly, 1997). I didn’t begin to
understand Java networking until I found this book. I also find his Web site,
Café au Lait, to be a stimulating, opinionated, and up-to-date perspective on
Java developments, unencumbered by allegiances to any vendors. His regular
updates keep up with fast-changing news about Java. See <i>metalab.unc.edu/javafaq/</i>.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>JDBC Database Access with Java</span></i></b><span
lang=EN-US>, by Hamilton, Cattell &amp; Fisher (Addison-Wesley, 1997). If you
know nothing about SQL and databases, this is a nice, gentle introduction. It
also contains some of the details as well as an “annotated reference” to the
API (again, what the online reference should have been). The drawback, as with
all books in <i>The Java Series </i>(“The ONLY Books Authorized by JavaSoft”)
is that it’s been whitewashed so that it says only wonderful things about
Java—you won’t find out about any dark corners in this series.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Java Programming with CORBA</span></i></b><span
lang=EN-US>, by Andreas Vogel &amp; Keith Duddy (John Wiley &amp; Sons, 1997).
A serious treatment of the subject with code examples for three Java ORBs
(Visibroker, Orbix, Joe). </span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Design Patterns</span></i></b><span
lang=EN-US>, by Gamma, Helm, Johnson &amp; Vlissides (Addison-Wesley, 1995).
The seminal book that started the patterns movement in programming.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Practical Algorithms for Programmers</span></i></b><span
lang=EN-US>, by Binstock &amp; Rex (Addison-Wesley, 1995). The algorithms are
in C, so they’re fairly easy to translate into Java. Each algorithm is
thoroughly explained.</span></p>

<h3><a name="_Toc481064965"></a><a name="_Toc472655073"><span lang=EN-US>Analysis
&amp; design</span></a></h3>

<p class=MsoNormal><i><span lang=EN-US><b>Extreme Programming Explained</b></span></i><span lang=EN-US>,<b> </b>by
</span><span lang=EN-US>Kent Beck (Addison-Wesley, 2000). I <i>love</i> this
book. Yes, I tend to take a radical approach to things but I've always felt
that there could be a much different, much better program development process,
and I think XP comes pretty darn close. The only book that has had a similar
impact on me was <i>PeopleWare </i>(described below), which talks primarily
about the environment and dealing with corporate culture. <i>Extreme
Programming Explained</i> talks about programming, and turns most things, even
recent “findings,” on their ear. They even go so far as to say that pictures
are OK as long as you don’t spend too much time on them and are willing to
throw them away. (You’ll notice that this book does <i>not </i>have the “UML
stamp of approval” on its cover.) I could see deciding whether to work for a
company based solely on whether they used XP. Small book, small chapters, effortless
to read, exciting to think about. You start imagining yourself working in such
an atmosphere and it brings visions of a whole new world.</span></p>

<p class=MsoNormal><i><span lang=EN-US><b>UML Distilled, 2<sup>nd</sup> Edition</b></span></i><span
lang=EN-US>, by </span><span lang=EN-US>Martin Fowler (Addison-Wesley, 2000).
When you first encounter UML, it is daunting because there are so many diagrams
and details. According to Fowler, most of this stuff is unnecessary so he cuts
through to the essentials. For most projects, you only need to know a few
diagramming tools, and Fowler’s goal is to come up with a good design rather
than worry about all the artifacts of getting there. A nice, thin, readable
book; the first one you should get if you need to understand UML.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>UML Toolkit</span></i></b><span
lang=EN-US>, by Hans-Erik Eriksson &amp; Magnus Penker, (John Wiley &amp; Sons,
1997). Explains UML and how to use it, and has a case study in Java. An
accompanying CD ROM contains the Java code and a cut-down version of Rational
Rose. An excellent introduction to UML and how to use it to build a real
system.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>The Unified Software Development
Process</span></i></b><span lang=EN-US>, by </span><span
lang=EN-US>Ivar Jacobsen, Grady Booch</span><span
lang=EN-US>, and </span><span lang=EN-US>James Rumbaugh (Addison-Wesley, 1999).
I went in fully prepared to dislike this book. It seemed to have all the
makings of a boring college text. I was pleasantly surprised—only pockets of
the book contain explanations that seem as if those concepts aren’t clear to
the authors. The bulk of the book is not only clear, but enjoyable. And best of
all, the process makes a lot of practical sense. It’s not Extreme Programming
(and does not have their clarity about testing) but it’s also part of the UML
juggernaut—even if you can’t get XP adopted, most people have climbed aboard
the “UML is good” bandwagon (regardless of their <i>actual</i> level of
experience with it) and so you can probably get it adopted. I think this book
should be the flagship of UML, and the one you can read after Fowler’s <i>UML
Distilled</i> when you want more detail.</span></p>

<p class=MsoNormal><span lang=EN-US>Before you choose any method, it’s helpful
to gain perspective from those who are not trying to sell one. It’s easy to
adopt a method without really understanding what you want out of it or what it
will do for you. Others are using it, which seems a compelling reason. However,
humans have a strange little psychological quirk: If they want to believe
something will solve their problems, they’ll try it. (This is experimentation,
which is good.) But if it doesn’t solve their problems, they may redouble their
efforts and begin to announce loudly what a great thing they’ve discovered.
(This is denial, which is not good.) The assumption here may be that if you can
get other people in the same boat, you won’t be lonely, even if it’s going
nowhere (or sinking).</span></p>

<p class=MsoNormal><span lang=EN-US>This is not to suggest that all
methodologies go nowhere, but that you should be armed to the teeth with mental
tools that help you stay in experimentation mode (“It’s not working; let’s try
something else”) and out of denial mode (“No, that’s not really a problem.
Everything’s wonderful, we don’t need to change”). I think the following books,
read <i>before</i> you choose a method, will provide you with these tools.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Software Creativity</span></i></b><span
lang=EN-US>, by Robert Glass</span><span
lang=EN-US> (Prentice-Hall, 1995). This is the best book I’ve seen that
discusses <i>perspective</i> on the whole methodology issue. It’s a collection
of short essays and papers that Glass has written and sometimes acquired (P.J.
Plauger</span><span lang=EN-US> is one contributor), reflecting his many years
of thinking and study on the subject. They’re entertaining and only long enough
to say what’s necessary; he doesn’t ramble and bore you. He’s not just blowing
smoke, either; there are hundreds of references to other papers and studies.
All programmers and managers should read this book before wading into the
methodology mire.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Software Runaways: Monumental
Software Disasters</span></i></b><span lang=EN-US>, by Robert Glass
(Prentice-Hall, 1997). The great thing about this book is that it brings to the
forefront what we don’t talk about: how many projects not only fail, but fail
spectacularly. I find that most of us still think “That can’t happen to me” (or
“That can’t happen <i>again</i>”), and I think this puts us at a disadvantage.
By keeping in mind that things can always go wrong, you’re in a much better position
to make them go right.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Peopleware</span></i></b><i><span
lang=EN-US>, <b>2<sup>nd</sup> Edition</b></span></i><span lang=EN-US>,<b> </b>by
Tom Demarco</span><span lang=EN-US> and Timothy Lister</span><span
lang=EN-US> (Dorset House, 1999). Although they have backgrounds in software
development, this book is about projects and teams in general. But the focus is
on the <i>people</i> and their needs, rather than the technology and its needs.
They talk about creating an environment where people will be happy and
productive, rather than deciding what rules those people should follow to be
adequate components of a machine. This latter attitude, I think, is the biggest
contributor to programmers smiling and nodding when XYZ method is adopted and
then quietly doing whatever they’ve always done.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Complexity</span></i></b><span
lang=EN-US>, by M. Mitchell Waldrop</span><span
lang=EN-US> (Simon &amp; Schuster, 1992). This chronicles the coming together
of a group of scientists from different disciplines in Santa Fe, New Mexico, to
discuss real problems that their individual disciplines couldn’t solve (the
stock market in economics, the initial formation of life in biology, why people
do what they do in sociology, etc.). By crossing physics, economics, chemistry,
math, computer science, sociology, and others, a multidisciplinary approach to
these problems is developing. But more important, a different way of <i>thinking</i>
about these ultra-complex problems is emerging: Away from mathematical
determinism and the illusion that you can write an equation that predicts all
behavior, and toward first <i>observing </i>and looking for a pattern and
trying to emulate that pattern by any means possible. (The book chronicles, for
example, the emergence of genetic algorithms.) This kind of thinking, I
believe, is useful as we observe ways to manage more and more complex software
projects.</span></p>

<h3><a name="_Toc472655071"></a><a name="_Toc481064966"><span lang=EN-US>Python</span></a></h3>

<p class=MsoNormal><b><i><span lang=EN-US>Learning Python</span></i></b><span
lang=EN-US>, by Mark Lutz and David Ascher (O’Reilly, 1999). A nice
programmer’s introduction to what is rapidly becoming my favorite language, an
excellent companion to Java. The book includes an introduction to JPython,
which allows you to combine Java and Python in a single program (the JPython
interpreter is compiled to pure Java bytecodes, so there is nothing special you
need to add to accomplish this). This language union promises great
possibilities.</span></p>

<h3><a name="_Toc481064967"><span lang=EN-US>My own list of books</span></a><span
lang=EN-US> </span></h3>

<p class=MsoNormal><span lang=EN-US>Listed in order of publication. Not all of
these are currently available.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Computer Interfacing with Pascal
&amp; C</span></i></b><span lang=EN-US>,<b> </b>(Self-published via the Eisys
imprint, 1988. Only available via <i>www.BruceEckel.com</i>). An introduction
to electronics from back when CP/M was still king and DOS was an upstart. I
used high-level languages and often the parallel port of the computer to drive
various electronic projects. Adapted from my columns in the first and best
magazine I wrote for, <i>Micro Cornucopia. </i>(To paraphrase Larry O’Brien,
long-time editor of <i>Software Development Magazine</i>: the best computer
magazine ever published—they even had plans for building a robot in a flower
pot!) Alas, Micro C became lost long before the Internet appeared. Creating
this book was an extremely satisfying publishing experience.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Using C++</span></i></b><span
lang=EN-US>,<b> </b>(Osborne/McGraw-Hill, 1989). One of the first books out on
C++. This is out of print and replaced by its second edition, the renamed <i>C++
Inside &amp; Out</i>.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>C++ Inside &amp; Out</span></i></b><span
lang=EN-US>,<b> </b>(Osborne/McGraw-Hill, 1993). As noted, actually the 2<sup>nd</sup>
edition of <b>Using C++</b>. The C++ in this book is reasonably accurate, but
it's circa 1992 and <i>Thinking in C++</i> is intended to replace it. You can
find out more about this book and download the source code at <i>www.BruceEckel.com</i>.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Thinking in C++, 1<sup>st</sup>
Edition</span></i></b><span lang=EN-US>, (Prentice-Hall, 1995). </span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Thinking in C++, 2<sup>nd</sup> Edition,
Volume 1</span></i></b><span lang=EN-US>, (Prentice-Hall, 2000). Downloadable
from <i>www.BruceEckel.com</i>.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Black Belt C++, the Master’s
Collection</span></i></b><span lang=EN-US>, Bruce Eckel, editor (M&amp;T Books,
1994). Out of print. A collection of chapters by various C++ luminaries based
on their presentations in the C++ track at the Software Development Conference,
which I chaired. The cover on this book stimulated me to gain control over all
future cover designs.</span></p>

<p class=MsoNormal><b><i><span lang=EN-US>Thinking in Java, 1<sup>st</sup>
Edition</span></i></b><span lang=EN-US>, (Prentice-Hall, 1998). The first
edition of this book won the <i>Software Development Magazine </i>Productivity
Award, the <i>Java Developer’s Journal </i>Editor’s Choice Award, and the <i>JavaWorld
Reader’s Choice Award for best book</i>. Downloadable from <i>www.BruceEckel.com</i>.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:auto'>
</span>

<div class=WordSection26></div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:right'>
</span>

<div class=WordSection27>

<h1><a name="_Toc481064968"></a><a name="_Toc477690740"><span lang=EN-US>Index</span></a></h1>

<p class=Intro><span lang=EN-US>Please note that some names will be duplicated
in capitalized form. Following Java style, the capitalized names refer to Java
classes, while lowercase names refer to a general concept.</span></p>

</div>

<span lang=EN-US style='font-size:14.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:auto'>
</span>

<div class=WordSection28>

<p class=MsoIndex1><span lang=EN-US>- · 139</span></p>

<p class=MsoIndex1><span lang=EN-US>! · 143</span></p>

<p class=MsoIndex1><span lang=EN-US>!= · 141; operator · 1025</span></p>

<p class=MsoIndex1><span lang=EN-US>&amp; · 146</span></p>

<p class=MsoIndex1><span lang=EN-US>&amp;&amp; · 143</span></p>

<p class=MsoIndex1><span lang=EN-US>&amp;= · 147</span></p>

<p class=MsoIndex1><span lang=EN-US>@deprecated · 128</span></p>

<p class=MsoIndex1><span lang=EN-US> [&nbsp;]: indexing operator [&nbsp;] · 231</span></p>

<p class=MsoIndex1><span lang=EN-US>^ · 146</span></p>

<p class=MsoIndex1><span lang=EN-US>^= · 147</span></p>

<p class=MsoIndex1><span lang=EN-US>| · 146</span></p>

<p class=MsoIndex1><span lang=EN-US>|| · 143</span></p>

<p class=MsoIndex1><span lang=EN-US>|= · 147</span></p>

<p class=MsoIndex1><span lang=EN-US> ‘+’: operator + for String · 1054</span></p>

<p class=MsoIndex1><span lang=EN-US>+ · 139</span></p>

<p class=MsoIndex1><span lang=EN-US>&lt; · 141</span></p>

<p class=MsoIndex1><span lang=EN-US>&lt;&lt; · 147</span></p>

<p class=MsoIndex1><span lang=EN-US>&lt;&lt;= · 147</span></p>

<p class=MsoIndex1><span lang=EN-US>&lt;= · 141</span></p>

<p class=MsoIndex1><span lang=EN-US>== · 141; operator · 1025; vs.
equals(&nbsp;) · 645</span></p>

<p class=MsoIndex1><span lang=EN-US>&gt; · 141</span></p>

<p class=MsoIndex1><span lang=EN-US>&gt;= · 141</span></p>

<p class=MsoIndex1><span lang=EN-US>&gt;&gt; · 147</span></p>

<p class=MsoIndex1><span lang=EN-US>&gt;&gt;= · 147</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>A</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>abstract: class · 326; inheriting from an
abstract class · 326; vs. interface · 356</span></p>

<p class=MsoIndex1><span lang=EN-US>abstract keyword · 327</span></p>

<p class=MsoIndex1><span lang=EN-US>Abstract Window Toolkit (AWT) · 689</span></p>

<p class=MsoIndex1><span lang=EN-US>AbstractButton · 734</span></p>

<p class=MsoIndex1><span lang=EN-US>abstraction · 30</span></p>

<p class=MsoIndex1><span lang=EN-US>AbstractSequentialList · 502</span></p>

<p class=MsoIndex1><span lang=EN-US>AbstractSet · 461</span></p>

<p class=MsoIndex1><span lang=EN-US>accept(&nbsp;) · 909</span></p>

<p class=MsoIndex1><span lang=EN-US>access: class · 263; control · 243, 267;
inner classes &amp; access rights · 376; package access and friendly · 255;
specifiers · 36, 243, 255; within a directory, via the default package · 257</span></p>

<p class=MsoIndex1><span lang=EN-US>action command · 765</span></p>

<p class=MsoIndex1><span lang=EN-US>ActionEvent · 766, 814</span></p>

<p class=MsoIndex1><span lang=EN-US>ActionListener · 712</span></p>

<p class=MsoIndex1><span lang=EN-US>actor, in use cases · 77</span></p>

<p class=MsoIndex1><span lang=EN-US>adapters: listener adapters · 729</span></p>

<p class=MsoIndex1><span lang=EN-US>add(&nbsp;), ArrayList · 450</span></p>

<p class=MsoIndex1><span lang=EN-US>addActionListener(&nbsp;) · 811, 857</span></p>

<p class=MsoIndex1><span lang=EN-US>addChangeListener · 771</span></p>

<p class=MsoIndex1><span lang=EN-US>addition · 137</span></p>

<p class=MsoIndex1><span lang=EN-US>addListener · 722</span></p>

<p class=MsoIndex1><span lang=EN-US>addXXXListener(&nbsp;) · 723</span></p>

<p class=MsoIndex1><span lang=EN-US>Adler32 · 608</span></p>

<p class=MsoIndex1><span lang=EN-US>aggregate array initialization · 231</span></p>

<p class=MsoIndex1><span lang=EN-US>aggregation · 37</span></p>

<p class=MsoIndex1><span lang=EN-US>aliasing · 136; and String · 1054; during a
method call · 1014</span></p>

<p class=MsoIndex1><span lang=EN-US>align · 697</span></p>

<p class=MsoIndex1><span lang=EN-US>alphabetic vs. lexicographic sorting · 436</span></p>

<p class=MsoIndex1><span lang=EN-US>AlreadyBoundException · 978</span></p>

<p class=MsoIndex1><span lang=EN-US>analysis: and design, object-oriented · 71;
paralysis · 72; requirements analysis · 75</span></p>

<p class=MsoIndex1><span lang=EN-US>AND: bitwise · 154; logical (&amp;&amp;) ·
143</span></p>

<p class=MsoIndex1><span lang=EN-US>anonymous inner class · 370, 576, 709, 875;
and constructors · 375</span></p>

<p class=MsoIndex1><span lang=EN-US>anonymous inner class, and table-driven
code · 502</span></p>

<p class=MsoIndex1><span lang=EN-US>applet · 692; advantages for client/server
systems · 693; align · 697; and packages · 699; archive tag, for HTML and JAR
files · 793; classpath · 699; codebase · 697; combined applets and applications
· 700; displaying a Web page from within an applet · 923; name · 697; packaging
applets in a JAR file to optimize loading · 793; parameter · 697; placing
inside a Web page · 695; restrictions · 692</span></p>

<p class=MsoIndex1><span lang=EN-US>Applet: combined with application · 839;
initialization parameters · 839</span></p>

<p class=MsoIndex1><span lang=EN-US>appletviewer · 698</span></p>

<p class=MsoIndex1><span lang=EN-US>application: application builder · 800;
application framework · 394; combined applets and applications · 700; combined
with Applet · 839; windowed applications · 700</span></p>

<p class=MsoIndex1><span lang=EN-US>application framework, and applets · 694</span></p>

<p class=MsoIndex1><span lang=EN-US>archive tag, for HTML and JAR files · 793</span></p>

<p class=MsoIndex1><span lang=EN-US>argument: constructor · 193; final · 298,
577; passing a reference into a method · 1014; variable argument lists (unknown
quantity and type of arguments) · 235</span></p>

<p class=MsoIndex1><span lang=EN-US>array · 407; associative array · 477;
associative array, Map · 442; bounds checking · 232; comparing arrays · 431;
copying an array · 429; dynamic aggregate initialization syntax · 412; element
comparisons · 431; first-class objects · 409; initialization · 231; length ·
232, 409; multidimensional · 236; of objects · 409; of primitives · 409; return
an array · 413</span></p>

<p class=MsoIndex1><span lang=EN-US>ArrayList · 456, 463, 467, 500, 505;
add(&nbsp;) · 450; and deep copying · 1030; get(&nbsp;) · 450, 456;
size(&nbsp;) · 451; type-conscious ArrayList · 454; used with HashMap · 652</span></p>

<p class=MsoIndex1><span lang=EN-US>Arrays class, container utility · 415</span></p>

<p class=MsoIndex1><span lang=EN-US>Arrays.asList(&nbsp;) · 519</span></p>

<p class=MsoIndex1><span lang=EN-US>Arrays.binarySearch(&nbsp;) · 437</span></p>

<p class=MsoIndex1><span lang=EN-US>Arrays.fill(&nbsp;) · 428</span></p>

<p class=MsoIndex1><span lang=EN-US>assigning objects · 134</span></p>

<p class=MsoIndex1><span lang=EN-US>assignment · 134</span></p>

<p class=MsoIndex1><span lang=EN-US>associative array · 439, 477</span></p>

<p class=MsoIndex1><span lang=EN-US>associative arrays (Maps) · 442</span></p>

<p class=MsoIndex1><span lang=EN-US>auto-decrement operator · 139</span></p>

<p class=MsoIndex1><span lang=EN-US>auto-increment operator · 139</span></p>

<p class=MsoIndex1><span lang=EN-US>automatic type conversion · 273</span></p>

<p class=MsoIndex1><span lang=EN-US>available(&nbsp;) · 598</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>B</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>bag · 440</span></p>

<p class=MsoIndex1><span lang=EN-US>base: types · 39</span></p>

<p class=MsoIndex1><span lang=EN-US>base 16 · 156</span></p>

<p class=MsoIndex1><span lang=EN-US>base 8 · 156</span></p>

<p class=MsoIndex1><span lang=EN-US>base class · 260, 275, 315; abstract base
class · 326; base-class interface · 320; constructor · 332; constructors and exceptions
· 281; initialization · 278</span></p>

<p class=MsoIndex1><span lang=EN-US>Basic: Microsoft Visual Basic · 800</span></p>

<p class=MsoIndex1><span lang=EN-US>basic concepts of object-oriented
programming (OOP) · 29</span></p>

<p class=MsoIndex1><span lang=EN-US>BASIC language · 92</span></p>

<p class=MsoIndex1><span lang=EN-US>BasicArrowButton · 735</span></p>

<p class=MsoIndex1><span lang=EN-US>beanbox Bean testing tool · 817</span></p>

<p class=MsoIndex1><span lang=EN-US>BeanInfo: custom BeanInfo · 818</span></p>

<p class=MsoIndex1><span lang=EN-US>Beans: and Borland’s Delphi · 800; and
Microsoft’s Visual Basic · 800; and multithreading · 854; application builder ·
800; beanbox Bean testing tool · 817; bound properties · 818; component · 801;
constrained properties · 818; custom BeanInfo · 818; custom property editor ·
818; custom property sheet · 818; events · 801; EventSetDescriptors · 808;
FeatureDescriptor · 818; getBeanInfo(&nbsp;) · 805;
getEventSetDescriptors(&nbsp;) · 808; getMethodDescriptors(&nbsp;) · 808;
getName(&nbsp;) · 808; getPropertyDescriptors(&nbsp;) · 808;
getPropertyType(&nbsp;) · 808; getReadMethod(&nbsp;) · 808;
getWriteMethod(&nbsp;) · 808; indexed property · 818; Introspector · 805; JAR
files for packaging · 816; manifest file · 816; Method · 808; MethodDescriptors
· 808; naming convention · 802; properties · 801; PropertyChangeEvent · 818;
PropertyDescriptors · 808; ProptertyVetoException · 818; reflection · 801, 804;
Serializable · 814; visual programming · 800</span></p>

<p class=MsoIndex1><span lang=EN-US>Beck, Kent · 1093</span></p>

<p class=MsoIndex1><span lang=EN-US>Bill Joy · 141</span></p>

<p class=MsoIndex1><span lang=EN-US>binary: numbers · 156; operators · 146</span></p>

<p class=MsoIndex1><span lang=EN-US>binary numbers, printing · 150</span></p>

<p class=MsoIndex1><span lang=EN-US>binarySearch(&nbsp;) · 437</span></p>

<p class=MsoIndex1><span lang=EN-US>bind(&nbsp;) · 976</span></p>

<p class=MsoIndex1><span lang=EN-US>binding: dynamic binding · 316; dynamic,
late, or run-time binding · 311; early · 45; late · 45; late binding · 316;
method call binding · 315; run-time binding · 316</span></p>

<p class=MsoIndex1><span lang=EN-US>BitSet · 522</span></p>

<p class=MsoIndex1><span lang=EN-US>bitwise: AND · 154; AND operator (&amp;) ·
146; EXCLUSIVE OR XOR (^) · 146; NOT ~ · 146; operators · 146; OR · 154; OR
operator (|) · 146</span></p>

<p class=MsoIndex1><span lang=EN-US>bitwise copy · 1024</span></p>

<p class=MsoIndex1><span lang=EN-US>blank final · 297</span></p>

<p class=MsoIndex1><span lang=EN-US>blocking: and available(&nbsp;) · 598; and
threads · 859; on I/O · 869</span></p>

<p class=MsoIndex1><span lang=EN-US>Booch, Grady · 1093</span></p>

<p class=MsoIndex1><span lang=EN-US>book: errors, reporting · 23; updates of
the book · 22</span></p>

<p class=MsoIndex1><span lang=EN-US>boolean</span><span lang=EN-US>: operators
that won’t work with boolean · 141</span></p>

<p class=MsoIndex1><span lang=EN-US>Boolean · 169; algebra · 146; and casting ·
155; vs. C and C++ · 144</span></p>

<p class=MsoIndex1><span lang=EN-US>BorderLayout · 713</span></p>

<p class=MsoIndex1><span lang=EN-US>Borland · 820; Delphi · 800</span></p>

<p class=MsoIndex1><span lang=EN-US>bound properties · 818</span></p>

<p class=MsoIndex1><span lang=EN-US>bounds checking, array · 232</span></p>

<p class=MsoIndex1><span lang=EN-US>Box, for BoxLayout · 718</span></p>

<p class=MsoIndex1><span lang=EN-US>BoxLayout · 717</span></p>

<p class=MsoIndex1><span lang=EN-US>break keyword · 175</span></p>

<p class=MsoIndex1><span lang=EN-US>browser: class browser · 263</span></p>

<p class=MsoIndex1><span lang=EN-US>BufferedInputStream · 586</span></p>

<p class=MsoIndex1><span lang=EN-US>BufferedOutputStream · 588</span></p>

<p class=MsoIndex1><span lang=EN-US>BufferedReader · 563, 591, 597</span></p>

<p class=MsoIndex1><span lang=EN-US>BufferedWriter · 591, 599</span></p>

<p class=MsoIndex1><span lang=EN-US>business objects/logic · 796</span></p>

<p class=MsoIndex1><span lang=EN-US>button: creating your own · 730; radio
button · 750</span></p>

<p class=MsoIndex1><span lang=EN-US>button, Swing · 706</span></p>

<p class=MsoIndex1><span lang=EN-US>ButtonGroup · 736, 750</span></p>

<p class=MsoIndex1><span lang=EN-US>buttons · 734</span></p>

<p class=MsoIndex1><span lang=EN-US>ByteArrayInputStream · 582</span></p>

<p class=MsoIndex1><span lang=EN-US>ByteArrayOutputStream · 583</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>C</span></p>

</div>

<p class=MsoIndex1><span lang=EN-AU style='layout-grid-mode:line'>C/C++,
interfacing with</span><span lang=EN-US> · 1065</span></p>

<p class=MsoIndex1><span lang=EN-US>C++ · 141; copy constructor · 1042;
Standard Container Library aka STL · 440; strategies for transition to · 93;
templates · 455; vector class, vs. array and ArrayList · 408; why it succeeds ·
91</span></p>

<p class=MsoIndex1><span lang=EN-US>callback · 432, 575, 708</span></p>

<p class=MsoIndex1><span lang=EN-US>callbacks: and inner classes · 391</span></p>

<p class=MsoIndex1><span lang=EN-US>capacity, of a HashMap or HashSet · 491</span></p>

<p class=MsoIndex1><span lang=EN-US>capitalization: Java capitalization style
source-code checking tool · 645; of package names · 116</span></p>

<p class=MsoIndex1><span lang=EN-US>case statement · 183</span></p>

<p class=MsoIndex1><span lang=EN-US>cast · 47, 201, 661; and containers · 450;
and primitive types · 170; from float or double to integral, truncation · 186;
operators · 154</span></p>

<p class=MsoIndex1><span lang=EN-US>catch: catching an exception · 534;
catching any exception · 543; keyword · 535</span></p>

<p class=MsoIndex1><span lang=EN-US>CD ROM for book · 20</span></p>

<p class=MsoIndex1><span lang=EN-US>CGI: Common-Gateway Interface · 948</span></p>

<p class=MsoIndex1><span lang=EN-US>change: vector of change · 397</span></p>

<p class=MsoIndex1><span lang=EN-US>CharArrayReader · 590</span></p>

<p class=MsoIndex1><span lang=EN-US>CharArrayWriter · 590</span></p>

<p class=MsoIndex1><span lang=EN-US>check box · 748</span></p>

<p class=MsoIndex1><span lang=EN-US>CheckedInputStream · 606</span></p>

<p class=MsoIndex1><span lang=EN-US>CheckedOutputStream · 606</span></p>

<p class=MsoIndex1><span lang=EN-US>Checksum · 608</span></p>

<p class=MsoIndex1><span lang=EN-US>class · 32, 262; abstract class · 326;
access · 263; anonymous inner · 709; anonymous inner class · 370, 576, 875;
anonymous inner class and constructors · 375; base class · 260, 275, 315;
browser · 263; class hierarchies and exception handling · 567; class literal ·
664, 669; creators · 35; defining the interface · 88; derived class · 315;
equivalence, and instanceof/isInstance(&nbsp;) · 672; final classes · 301;
inheritance diagrams · 293; inheriting from an abstract class · 326; inheriting
from inner classes · 384; initialization &amp; class loading · 304; initialization
of data members · 220; initializing members at point of definition · 221;
initializing the base class · 278; inner class · 365; inner class nesting
within any arbitrary scope · 372; inner classes · 799; inner classes &amp;
access rights · 376; inner classes and overriding · 385; inner classes and
super · 385; inner classes and Swing · 722; inner classes and upcasting · 368;
inner classes in methods &amp; scopes · 370; inner classes, identifiers and
.class files · 387; instance of · 31; intializing the derived class · 278;
keyword · 38; loading · 305; member initialization · 273; multiply-nested ·
383; order of initialization · 223; private inner classes · 397; public class,
and compilation units · 245; read-only classes · 1047; referring to the outer class
object in an inner class · 381; static inner classes · 379; style of creating
classes · 262; subobject · 278</span></p>

<p class=MsoIndex1><span lang=EN-US>Class · 737; Class object · 633, 662, 848;
forName(&nbsp;) · 664, 727; getClass(&nbsp;) · 544; getConstructors(&nbsp;) ·
681; getInterfaces(&nbsp;) · 676; getMethods(&nbsp;) · 681; getName(&nbsp;) ·
677; getSuperclass(&nbsp;) · 676; isInstance · 671; isInterface(&nbsp;) · 677;
newInstance(&nbsp;) · 676; printInfo(&nbsp;) · 677; RTTI using the Class object
· 674</span></p>

<p class=MsoIndex1><span lang=EN-US>Class object · 227</span></p>

<p class=MsoIndex1><span lang=EN-US>ClassCastException · 345, 666</span></p>

<p class=MsoIndex1><span lang=EN-US>classpath · 248, 699; and rmic · 979</span></p>

<p class=MsoIndex1><span lang=EN-US>class-responsibility-collaboration (CRC)
cards · 79</span></p>

<p class=MsoIndex1><span lang=EN-US>cleanup: and garbage collector · 283;
performing · 209; with finally · 554</span></p>

<p class=MsoIndex1><span lang=EN-US>cleanup, guaranteeing with finalize(&nbsp;)
· 214</span></p>

<p class=MsoIndex1><span lang=EN-US>client programmer · 35; vs. library creator
· 243</span></p>

<p class=MsoIndex1><span lang=EN-US>client, network · 907</span></p>

<p class=MsoIndex1><span lang=EN-US>clipboard: system clipboard · 790</span></p>

<p class=MsoIndex1><span lang=EN-US>clone(&nbsp;) · 1021; and composition ·
1027; and inheritance · 1034; Object.clone(&nbsp;) · 1025; removing/turning off
cloneability · 1036; super.clone(&nbsp;) · 1025, 1041; supporting cloning in
derived classes · 1036</span></p>

<p class=MsoIndex1><span lang=EN-US>Cloneable interface · 1022</span></p>

<p class=MsoIndex1><span lang=EN-US>CloneNotSupportedException · 1024</span></p>

<p class=MsoIndex1><span lang=EN-US>close(&nbsp;) · 597</span></p>

<p class=MsoIndex1><span lang=EN-US>closure, and inner classes · 391</span></p>

<p class=MsoIndex1><span lang=EN-US>code: calling non-Java code · 1065; coding
standards · 22, 1077; organization · 255; re-use · 271</span></p>

<p class=MsoIndex1><span lang=EN-US>codebase · 697</span></p>

<p class=MsoIndex1><span lang=EN-US>Collection · 440</span></p>

<p class=MsoIndex1><span lang=EN-US>collection class · 407</span></p>

<p class=MsoIndex1><span lang=EN-US>Collections · 511</span></p>

<p class=MsoIndex1><span lang=EN-US>Collections.enumeration(&nbsp;) · 520</span></p>

<p class=MsoIndex1><span lang=EN-US>Collections.fill(&nbsp;) · 443</span></p>

<p class=MsoIndex1><span lang=EN-US>Collections.reverseOrder() · 434</span></p>

<p class=MsoIndex1><span lang=EN-US>collision: name · 250</span></p>

<p class=MsoIndex1><span lang=EN-US>collisions, during hashing · 488</span></p>

<p class=MsoIndex1><span lang=EN-US>com.bruceeckel.swing · 703</span></p>

<p class=MsoIndex1><span lang=EN-US>combo box · 751</span></p>

<p class=MsoIndex1><span lang=EN-US>comma operator · 152, 175</span></p>

<p class=MsoIndex1><span lang=EN-US>Command Pattern · 575</span></p>

<p class=MsoIndex1><span lang=EN-US>comments: and embedded documentation · 122</span></p>

<p class=MsoIndex1><span lang=EN-US>common interface · 325</span></p>

<p class=MsoIndex1><span lang=EN-US>common pitfalls when using operators · 153</span></p>

<p class=MsoIndex1><span lang=EN-US>Common-Gateway Interface (CGI) · 948</span></p>

<p class=MsoIndex1><span lang=EN-US>Comparable · 432, 475</span></p>

<p class=MsoIndex1><span lang=EN-US>Comparator · 434, 475</span></p>

<p class=MsoIndex1><span lang=EN-US>compareTo(&nbsp;), in java.lang.Comparable
· 432</span></p>

<p class=MsoIndex1><span lang=EN-US>comparing arrays · 431</span></p>

<p class=MsoIndex1><span lang=EN-US>compilation unit · 245</span></p>

<p class=MsoIndex1><span lang=EN-US>compile-time constant · 294</span></p>

<p class=MsoIndex1><span lang=EN-US>compiling a Java program · 121</span></p>

<p class=MsoIndex1><span lang=EN-US>component, and JavaBeans · 801</span></p>

<p class=MsoIndex1><span lang=EN-US>composition · 37, 271; and cloning · 1027;
and design · 340; and dynamic behavior change · 341; choosing composition vs.
inheritance · 288; combining composition &amp; inheritance · 281; vs.
inheritance · 294, 642</span></p>

<p class=MsoIndex1><span lang=EN-US>compression: compression library · 606</span></p>

<p class=MsoIndex1><span lang=EN-US>concept, high · 75</span></p>

<p class=MsoIndex1><span lang=EN-US>ConcurrentModificationException · 515</span></p>

<p class=MsoIndex1><span lang=EN-US>conditional operator · 151</span></p>

<p class=MsoIndex1><span lang=EN-US>conference, Software Development Conference
· 10</span></p>

<p class=MsoIndex1><span lang=EN-US>Console: Swing display framework in com.bruceeckel.swing
· 702</span></p>

<p class=MsoIndex1><span lang=EN-US>console input · 597</span></p>

<p class=MsoIndex1><span lang=EN-US>const, in C++ · 1053</span></p>

<p class=MsoIndex1><span lang=EN-US>constant: compile-time constant · 294;
folding · 294; groups of constant values · 359; implicit constants, and String
· 1053</span></p>

<p class=MsoIndex1><span lang=EN-US>constrained properties · 818</span></p>

<p class=MsoIndex1><span lang=EN-US>constructor · 191; and anonymous inner
classes · 370; and exception handling · 562; and exceptions · 561; and finally
· 562; and overloading · 194; and polymorphism · 330; arguments · 193;
base-class constructor · 332; base-class constructors and exceptions · 281;
behavior of polymorphic methods inside constructors · 337; C++ copy constructor
· 1042; calling base-class constructors with arguments · 280; calling from
other constructors · 205; default · 202; default constructors · 196;
initialization during inheritance and composition · 281; name · 192; no-arg
constructors · 196; order of constructor calls with inheritance · 330; return
value · 193; static construction clause · 228; synthesized default constructor
access · 681</span></p>

<p class=MsoIndex1><span lang=EN-US>Constructor: for reflection · 678</span></p>

<p class=MsoIndex1><span lang=EN-US>consulting &amp; mentoring provided by
Bruce Eckel · 23</span></p>

<p class=MsoIndex1><span lang=EN-US>container: class · 407, 439; of primitives
· 412</span></p>

<p class=MsoIndex1><span lang=EN-US>container classes, utilities for · 444</span></p>

<p class=MsoIndex1><span lang=EN-US>continue keyword · 175</span></p>

<p class=MsoIndex1><span lang=EN-US>control: access · 36</span></p>

<p class=MsoIndex1><span lang=EN-US>control framework, and inner classes · 394</span></p>

<p class=MsoIndex1><span lang=EN-US>controlling access · 267</span></p>

<p class=MsoIndex1><span lang=EN-US>conversion: automatic · 273; narrowing
conversion · 155, 201; widening conversion · 155</span></p>

<p class=MsoIndex1><span lang=EN-US>cookies: and JSP · 971</span></p>

<p class=MsoIndex1><span lang=EN-US>cookies, and servlets · 955</span></p>

<p class=MsoIndex1><span lang=EN-US>copy: deep copy · 1020; shallow copy · 1019</span></p>

<p class=MsoIndex1><span lang=EN-US>copying an array · 429</span></p>

<p class=MsoIndex1><span lang=EN-US>CORBA · 980</span></p>

<p class=MsoIndex1><span lang=EN-US>costs, startup · 95</span></p>

<p class=MsoIndex1><span lang=EN-US>coupling · 537</span></p>

<p class=MsoIndex1><span lang=EN-US>CRC, class-responsibility-collaboration cards
· 79</span></p>

<p class=MsoIndex1><span lang=EN-US>CRC32 · 608</span></p>

<p class=MsoIndex1><span lang=EN-US>createStatement(&nbsp;) · 930</span></p>

<p class=MsoIndex1><span lang=EN-US>critical section, and synchronized block ·
852</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>D</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>daemon threads · 840</span></p>

<p class=MsoIndex1><span lang=EN-US>data: final · 294; primitive data types and
use with operators · 159; static initialization · 225</span></p>

<p class=MsoIndex1><span lang=EN-US>data type: equivalence to class · 33</span></p>

<p class=MsoIndex1><span lang=EN-US>database: flat-file database · 932; Java
DataBase Connectivity (JDBC) · 927; relational database · 933; URL · 928</span></p>

<p class=MsoIndex1><span lang=EN-US>DatabaseMetaData · 938</span></p>

<p class=MsoIndex1><span lang=EN-US>DataFlavor · 792</span></p>

<p class=MsoIndex1><span lang=EN-US>Datagram · 923; User Datagram Protocol
(UDP) · 923</span></p>

<p class=MsoIndex1><span lang=EN-US>DataInput · 593</span></p>

<p class=MsoIndex1><span lang=EN-US>DataInputStream · 586, 591, 597, 599</span></p>

<p class=MsoIndex1><span lang=EN-US>DataOutput · 593</span></p>

<p class=MsoIndex1><span lang=EN-US>DataOutputStream · 588, 592, 599</span></p>

<p class=MsoIndex1><span lang=EN-US>dead, Thread · 859</span></p>

<p class=MsoIndex1><span lang=EN-US>deadlock, multithreading · 865, 872</span></p>

<p class=MsoIndex1><span lang=EN-US>death condition, and finalize(&nbsp;) · 214</span></p>

<p class=MsoIndex1><span lang=EN-US>decorator design pattern · 585</span></p>

<p class=MsoIndex1><span lang=EN-US>decoupling: via polymorphism · 46</span></p>

<p class=MsoIndex1><span lang=EN-US>decoupling through polymorphism · 311</span></p>

<p class=MsoIndex1><span lang=EN-US>decrement operator · 139</span></p>

<p class=MsoIndex1><span lang=EN-US>deep copy · 1020, 1027; and ArrayList ·
1030; using serialization to perform deep copying · 1032</span></p>

<p class=MsoIndex1><span lang=EN-US>default constructor · 196, 202;
synthesizing a default constructor · 279</span></p>

<p class=MsoIndex1><span lang=EN-US>default constructor, access the same as the
class · 681</span></p>

<p class=MsoIndex1><span lang=EN-US>default keyword, in a switch statement ·
183</span></p>

<p class=MsoIndex1><span lang=EN-US>default package · 257</span></p>

<p class=MsoIndex1><span lang=EN-US>DefaultMutableTreeNode · 784</span></p>

<p class=MsoIndex1><span lang=EN-US>defaultReadObject(&nbsp;) · 629</span></p>

<p class=MsoIndex1><span lang=EN-US>DefaultTreeModel · 784</span></p>

<p class=MsoIndex1><span lang=EN-US>defaultWriteObject(&nbsp;) · 629</span></p>

<p class=MsoIndex1><span lang=EN-US>DeflaterOutputStream · 606</span></p>

<p class=MsoIndex1><span lang=EN-US>Delphi, from Borland · 800</span></p>

<p class=MsoIndex1><span lang=EN-US>Demarco, Tom · 1095</span></p>

<p class=MsoIndex1><span lang=EN-US>dequeue · 440</span></p>

<p class=MsoIndex1><span lang=EN-US>derived: derived class · 315; derived
class, initializing · 278; types · 39</span></p>

<p class=MsoIndex1><span lang=EN-US>design · 342; adding more methods to a
design · 268; analysis and design, object-oriented · 71; and composition · 340;
and inheritance · 339; and mistakes · 268; five stages of object design · 82;
library design · 243; of object hierarchies · 307; patterns · 86, 94</span></p>

<p class=MsoIndex1><span lang=EN-US>design patterns · 266; decorator · 585;
singleton · 266</span></p>

<p class=MsoIndex1><span lang=EN-US>destroy(&nbsp;) · 877</span></p>

<p class=MsoIndex1><span lang=EN-US>destructor · 208, 209, 554; Java doesn’t
have one · 283</span></p>

<p class=MsoIndex1><span lang=EN-US>development, incremental · 291</span></p>

<p class=MsoIndex1><span lang=EN-US>diagram: inheritance · 47; use case · 77</span></p>

<p class=MsoIndex1><span lang=EN-US>diagram, class inheritance diagrams · 293</span></p>

<p class=MsoIndex1><span lang=EN-US>dialog box · 771</span></p>

<p class=MsoIndex1><span lang=EN-US>dialog, file · 776</span></p>

<p class=MsoIndex1><span lang=EN-US>dialog, tabbed · 755</span></p>

<p class=MsoIndex1><span lang=EN-US>dictionary · 477</span></p>

<p class=MsoIndex1><span lang=EN-US>digital signing · 692</span></p>

<p class=MsoIndex1><span lang=EN-US>directory: and packages · 254; creating
directories and paths · 578; lister · 574</span></p>

<p class=MsoIndex1><span lang=EN-US>display framework, for Swing · 702</span></p>

<p class=MsoIndex1><span lang=EN-US>dispose(&nbsp;) · 772</span></p>

<p class=MsoIndex1><span lang=EN-US>division · 137</span></p>

<p class=MsoIndex1><span lang=EN-US>documentation: comments &amp; embedded
documentation · 122</span></p>

<p class=MsoIndex1><span lang=EN-US>Domain Name System (DNS) · 905</span></p>

<p class=MsoIndex1><span lang=EN-US>dotted quad · 905</span></p>

<p class=MsoIndex1><span lang=EN-US>double, literal value marker (D) · 156</span></p>

<p class=MsoIndex1><span lang=EN-US>do-while · 173</span></p>

<p class=MsoIndex1><span lang=EN-US>downcast · 293, 343, 666; type-safe
downcast in run-time type identification · 665</span></p>

<p class=MsoIndex1><span lang=EN-US>Drawing lines in Swing · 768</span></p>

<p class=MsoIndex1><span lang=EN-US>drop-down list · 751</span></p>

<p class=MsoIndex1><span lang=EN-US>dynamic: behavior change with composition ·
341; binding · 311, 316</span></p>

<p class=MsoIndex1><span lang=EN-US>dynamic aggregate initialization syntax for
arrays · 412</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>E</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>early binding · 45, 315</span></p>

<p class=MsoIndex1><span lang=EN-US>East, BorderLayout · 713</span></p>

<p class=MsoIndex1><span lang=EN-US>editor, creating one using the Swing
JTextPane · 747</span></p>

<p class=MsoIndex1><span lang=EN-US>efficiency: and arrays · 408; and final ·
302; and threads · 828; when using the synchronized keyword · 853</span></p>

<p class=MsoIndex1><span lang=EN-US>EJB · 990</span></p>

<p class=MsoIndex1><span lang=EN-US>elegance, in programming · 87</span></p>

<p class=MsoIndex1><span lang=EN-US>else keyword · 171</span></p>

<p class=MsoIndex1><span lang=EN-US>encapsulation · 261</span></p>

<p class=MsoIndex1><span lang=EN-US>Enterprise JavaBeans (EJB) · 990</span></p>

<p class=MsoIndex1><span lang=EN-US>enum, groups of constant values in C &amp;
C++ · 359</span></p>

<p class=MsoIndex1><span lang=EN-US>Enumeration · 520</span></p>

<p class=MsoIndex1><span lang=EN-US>equals(&nbsp;) · 142, 475; and hashed data
structures · 485; overriding for HashMap · 484; vs. == · 645</span></p>

<p class=MsoIndex1><span lang=EN-US>equivalence: == · 141; object equivalence ·
141</span></p>

<p class=MsoIndex1><span lang=EN-US>error: handling with exceptions · 531;
recovery · 568; reporting errors in book · 23; standard error stream · 538</span></p>

<p class=MsoIndex1><span lang=EN-US>event: event-driven system · 394; JavaBeans
· 801; multicast · 796; multicast event and JavaBeans · 854; responding to a
Swing event · 707; Swing event model · 794; unicast · 796</span></p>

<p class=MsoIndex1><span lang=EN-US>event listener · 722; order of execution ·
796</span></p>

<p class=MsoIndex1><span lang=EN-US>event model, Swing · 722</span></p>

<p class=MsoIndex1><span lang=EN-US>event-driven programming · 707</span></p>

<p class=MsoIndex1><span lang=EN-US>events and listeners · 723</span></p>

<p class=MsoIndex1><span lang=EN-US>EventSetDescriptors · 808</span></p>

<p class=MsoIndex1><span lang=EN-US>evolution, in program development · 85</span></p>

<p class=MsoIndex1><span lang=EN-US>exception: and base-class constructors · 281;
and constructors · 561; and inheritance · 558, 566; catching an exception ·
534; catching any exception · 543; changing the point of origin of the
exception · 547; class hierarchies · 567; constructors · 562; creating your own
· 537; design issues · 565; Error class · 549; Exception class · 549; <i>exception
handler</i> · 535; exception handling · 531; exception matching · 566;
FileNotFoundException · 565; fillInStackTrace(&nbsp;) · 545; finally · 552;
guarded region · 535; handler · 532; handling · 283; losing an exception,
pitfall · 557; NullPointerException · 550; printStackTrace(&nbsp;) · 545;
restrictions · 558; re-throwing an exception · 545; RuntimeException · 550;
specification · 542; termination vs. resumption · 536; Throwable · 543;
throwing an exception · 533; try · 554; try block · 535; typical uses of
exceptions · 568</span></p>

<p class=MsoIndex1><span lang=EN-US>exceptional condition · 532</span></p>

<p class=MsoIndex1><span lang=EN-US>exceptions: and JNI · 1074</span></p>

<p class=MsoIndex1><span lang=EN-US>executeQuery(&nbsp;) · 930</span></p>

<p class=MsoIndex1><span lang=EN-US>Exponential notation · 156</span></p>

<p class=MsoIndex1><span lang=EN-US>extending a class during inheritance · 41</span></p>

<p class=MsoIndex1><span lang=EN-US>extends · 260, 277, 342; and interface ·
359; keyword · 275</span></p>

<p class=MsoIndex1><span lang=EN-US>extensible: program · 320</span></p>

<p class=MsoIndex1><span lang=EN-US>extension: pure inheritance vs. extension ·
341</span></p>

<p class=MsoIndex1><span lang=EN-US>extension, sign · 147</span></p>

<p class=MsoIndex1><span lang=EN-US>extension, zero · 147</span></p>

<p class=MsoIndex1><span lang=EN-US>Externalizable · 620; alternative approach
to using · 626</span></p>

<p class=MsoIndex1><span lang=EN-US>Extreme Programming (XP) · 88, 1093</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>F</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>fail fast containers · 515</span></p>

<p class=MsoIndex1><span lang=EN-US>false · 143</span></p>

<p class=MsoIndex1><span lang=EN-US>FeatureDescriptor · 818</span></p>

<p class=MsoIndex1><span lang=EN-US>Field, for reflection · 678</span></p>

<p class=MsoIndex1><span lang=EN-US>fields, initializing fields in interfaces ·
361</span></p>

<p class=MsoIndex1><span lang=EN-US>FIFO · 472</span></p>

<p class=MsoIndex1><span lang=EN-US>file: characteristics of files · 578;
File.list(&nbsp;) · 574; incomplete output files, errors and flushing · 599;
JAR file · 245</span></p>

<p class=MsoIndex1><span lang=EN-US>File · 582, 592, 655; class · 574</span></p>

<p class=MsoIndex1><span lang=EN-US>file dialogs · 776</span></p>

<p class=MsoIndex1><span lang=EN-US>File Transfer Protocol (FTP) · 699</span></p>

<p class=MsoIndex1><span lang=EN-US>FileDescriptor · 582</span></p>

<p class=MsoIndex1><span lang=EN-US>FileInputReader</span><span lang=EN-US> ·
597</span></p>

<p class=MsoIndex1><span lang=EN-US>FileInputStream · 582</span></p>

<p class=MsoIndex1><span lang=EN-US>FilenameFilter · 574, 653</span></p>

<p class=MsoIndex1><span lang=EN-US>FileNotFoundException · 565</span></p>

<p class=MsoIndex1><span lang=EN-US>FileOutputStream · 583</span></p>

<p class=MsoIndex1><span lang=EN-US>FileReader · 563, 590</span></p>

<p class=MsoIndex1><span lang=EN-US>FileWriter · 590, 599</span></p>

<p class=MsoIndex1><span lang=EN-US>fillInStackTrace(&nbsp;) · 545</span></p>

<p class=MsoIndex1><span lang=EN-US>FilterInputStream · 582</span></p>

<p class=MsoIndex1><span lang=EN-US>FilterOutputStream · 583</span></p>

<p class=MsoIndex1><span lang=EN-US>FilterReader · 591</span></p>

<p class=MsoIndex1><span lang=EN-US>FilterWriter · 591</span></p>

<p class=MsoIndex1><span lang=EN-US>final · 350; and efficiency · 302; and
private · 299; and static · 294; argument · 298, 577; blank finals · 297;
classes · 301; data · 294; keyword · 294; method · 316; methods · 299, 339;
static primitives · 296; with object references · 295</span></p>

<p class=MsoIndex1><span lang=EN-US>finalize(&nbsp;) · 207, 566; and
inheritance · 333; and super · 335; calling directly · 210; order of
finalization of objects · 336</span></p>

<p class=MsoIndex1><span lang=EN-US>finally · 283, 286; and constructors · 562;
keyword · 552; pitfall · 557</span></p>

<p class=MsoIndex1><span lang=EN-US>finding .class files during loading · 247</span></p>

<p class=MsoIndex1><span lang=EN-US>flat-file database · 932</span></p>

<p class=MsoIndex1><span lang=EN-US>flavor, clipboard · 790</span></p>

<p class=MsoIndex1><span lang=EN-US>float, literal value marker(F) · 156</span></p>

<p class=MsoIndex1><span lang=EN-US>floating point: true and false · 144</span></p>

<p class=MsoIndex1><span lang=EN-US>FlowLayout · 714</span></p>

<p class=MsoIndex1><span lang=EN-US>flushing output files · 599</span></p>

<p class=MsoIndex1><span lang=EN-US>focus traversal · 691</span></p>

<p class=MsoIndex1><span lang=EN-US>folding, constant · 294</span></p>

<p class=MsoIndex1><span lang=EN-US>for keyword · 173</span></p>

<p class=MsoIndex1><span lang=EN-US>forName(&nbsp;) · 664, 727</span></p>

<p class=MsoIndex1><span lang=EN-US>FORTRAN · 156</span></p>

<p class=MsoIndex1><span lang=EN-US>forward referencing · 222</span></p>

<p class=MsoIndex1><span lang=EN-US>Fowler, Martin · 72, 85, 1093</span></p>

<p class=MsoIndex1><span lang=EN-US>framework: application framework and
applets · 694; control framework and inner classes · 394</span></p>

<p class=MsoIndex1><span lang=EN-US>friendly · 243, 368; and interface · 350;
and protected · 290; less accessible than protected · 335</span></p>

<p class=MsoIndex1><span lang=EN-US>FTP: File Transfer Protocol (FTP) · 699</span></p>

<p class=MsoIndex1><span lang=EN-US>function: member function · 35; overriding
· 42</span></p>

<p class=MsoIndex1><span lang=EN-US>functor · 575</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>G</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>garbage collection · 207, 210, 333; and
cleanup · 283; and native method execution · 1073; forcing finalization · 286;
how the collector works · 215; order of object reclamation · 286; reachable
objects · 495; setting references to null to allow cleanup · 397</span></p>

<p class=MsoIndex1><span lang=EN-US>generator · 443</span></p>

<p class=MsoIndex1><span lang=EN-US>generator object, to fill arrays and
containers · 416</span></p>

<p class=MsoIndex1><span lang=EN-US>get(&nbsp;), ArrayList · 450, 456</span></p>

<p class=MsoIndex1><span lang=EN-US>get(&nbsp;), HashMap · 481</span></p>

<p class=MsoIndex1><span lang=EN-US>getBeanInfo(&nbsp;) · 805</span></p>

<p class=MsoIndex1><span lang=EN-US>getBytes( ) · 598</span></p>

<p class=MsoIndex1><span lang=EN-US>getClass(&nbsp;) · 544, 674</span></p>

<p class=MsoIndex1><span lang=EN-US>getConstructor(&nbsp;) · 737</span></p>

<p class=MsoIndex1><span lang=EN-US>getConstructors(&nbsp;) · 681</span></p>

<p class=MsoIndex1><span lang=EN-US>getContentPane(&nbsp;) · 695</span></p>

<p class=MsoIndex1><span lang=EN-US>getContents(&nbsp;) · 792</span></p>

<p class=MsoIndex1><span lang=EN-US>getEventSetDescriptors(&nbsp;) · 808</span></p>

<p class=MsoIndex1><span lang=EN-US>getFloat(&nbsp;) · 930</span></p>

<p class=MsoIndex1><span lang=EN-US>getInputStream(&nbsp;) · 909</span></p>

<p class=MsoIndex1><span lang=EN-US>getInt(&nbsp;) · 930</span></p>

<p class=MsoIndex1><span lang=EN-US>getInterfaces(&nbsp;) · 676</span></p>

<p class=MsoIndex1><span lang=EN-US>getMethodDescriptors(&nbsp;) · 808</span></p>

<p class=MsoIndex1><span lang=EN-US>getMethods(&nbsp;) · 681</span></p>

<p class=MsoIndex1><span lang=EN-US>getModel(&nbsp;) · 784</span></p>

<p class=MsoIndex1><span lang=EN-US>getName(&nbsp;) · 677, 808</span></p>

<p class=MsoIndex1><span lang=EN-US>getOutputStream(&nbsp;) · 909</span></p>

<p class=MsoIndex1><span lang=EN-US>getPriority(&nbsp;) · 878</span></p>

<p class=MsoIndex1><span lang=EN-US>getPropertyDescriptors(&nbsp;) · 808</span></p>

<p class=MsoIndex1><span lang=EN-US>getPropertyType(&nbsp;) · 808</span></p>

<p class=MsoIndex1><span lang=EN-US>getReadMethod(&nbsp;) · 808</span></p>

<p class=MsoIndex1><span lang=EN-US>getSelectedValues(&nbsp;) · 753</span></p>

<p class=MsoIndex1><span lang=EN-US>getState(&nbsp;) · 765</span></p>

<p class=MsoIndex1><span lang=EN-US>getString(&nbsp;) · 930</span></p>

<p class=MsoIndex1><span lang=EN-US>getSuperclass(&nbsp;) · 676</span></p>

<p class=MsoIndex1><span lang=EN-US>getTransferData(&nbsp;) · 792</span></p>

<p class=MsoIndex1><span lang=EN-US>getTransferDataFlavors(&nbsp;) · 792</span></p>

<p class=MsoIndex1><span lang=EN-US>getWriteMethod(&nbsp;) · 808</span></p>

<p class=MsoIndex1><span lang=EN-US>Glass, Robert · 1094</span></p>

<p class=MsoIndex1><span lang=EN-US>glue, in BoxLayout · 717</span></p>

<p class=MsoIndex1><span lang=EN-US>goto: lack of goto in Java · 177</span></p>

<p class=MsoIndex1><span lang=EN-US>graphical user interface (GUI) · 394, 689</span></p>

<p class=MsoIndex1><span lang=EN-US>graphics · 776</span></p>

<p class=MsoIndex1><span lang=EN-US>Graphics · 768</span></p>

<p class=MsoIndex1><span lang=EN-US>greater than (&gt;) · 141</span></p>

<p class=MsoIndex1><span lang=EN-US>greater than or equal to (&gt;=) · 141</span></p>

<p class=MsoIndex1><span lang=EN-US>GridBagLayout · 716</span></p>

<p class=MsoIndex1><span lang=EN-US>GridLayout · 715, 894</span></p>

<p class=MsoIndex1><span lang=EN-US>guarded region, in exception handling · 535</span></p>

<p class=MsoIndex1><span lang=EN-US>GUI: graphical user interface · 394, 689</span></p>

<p class=MsoIndex1><span lang=EN-US>GUI builders · 690</span></p>

<p class=MsoIndex1><span lang=EN-US>guidelines: object development · 83</span></p>

<p class=MsoIndex1><span lang=EN-US>guidelines, coding standards · 1077</span></p>

<p class=MsoIndex1><span lang=EN-US>GZIPInputStream · 606</span></p>

<p class=MsoIndex1><span lang=EN-US>GZIPOutputStream · 606</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>H</span></p>

</div>

<p class=MsoIndex1><i><span lang=EN-US>handler, exception</span></i><span
lang=EN-US> · 535</span></p>

<p class=MsoIndex1><span lang=EN-US>hardware devices, interfacing with · 1065</span></p>

<p class=MsoIndex1><span lang=EN-US>has-a · 37</span></p>

<p class=MsoIndex1><span lang=EN-US>has-a relationship, composition · 289</span></p>

<p class=MsoIndex1><span lang=EN-US>hash code · 477, 488</span></p>

<p class=MsoIndex1><span lang=EN-US>hash function · 488</span></p>

<p class=MsoIndex1><span lang=EN-US>hashCode(&nbsp;) · 473, 477; and hashed
data structures · 485; issues when writing · 492; overriding for HashMap · 484</span></p>

<p class=MsoIndex1><span lang=EN-US>hashing · 485; external chaining · 488;
perfect hashing function · 488</span></p>

<p class=MsoIndex1><span lang=EN-US>HashMap · 476, 500, 733; used with
ArrayList · 652</span></p>

<p class=MsoIndex1><span lang=EN-US>HashSet · 473, 506</span></p>

<p class=MsoIndex1><span lang=EN-US>Hashtable · 510, 521</span></p>

<p class=MsoIndex1><span lang=EN-US>hasNext(&nbsp;), Iterator · 457</span></p>

<p class=MsoIndex1><span lang=EN-US>Hexadecimal · 156</span></p>

<p class=MsoIndex1><span lang=EN-US>hiding: implementation · 35</span></p>

<p class=MsoIndex1><span lang=EN-US>hiding, implementation · 261</span></p>

<p class=MsoIndex1><span lang=EN-US>high concept · 75</span></p>

<p class=MsoIndex1><span lang=EN-US>HTML · 948; name · 839; param · 839; value
· 839</span></p>

<p class=MsoIndex1><span lang=EN-US>HTML on Swing components · 779</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>I</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>I/O: and threads, blocking · 860;
available(&nbsp;) · 598; blocking on I/O · 869; blocking, and available(&nbsp;)
· 598; BufferedInputStream · 586; BufferedOutputStream · 588; BufferedReader ·
563, 591, 597; BufferedWriter · 591, 599; ByteArrayInputStream · 582;
ByteArrayOutputStream · 583; characteristics of files · 578; CharArrayReader ·
590; CharArrayWriter · 590; CheckedInputStream · 606; CheckedOutputStream ·
606; close(&nbsp;) · 597; compression library · 606; console input · 597;
controlling the process of serialization · 619; DataInput · 593;
DataInputStream · 586, 591, 597, 599; DataOutput · 593; DataOutputStream · 588,
592, 599; DeflaterOutputStream · 606; directory lister · 574; directory,
creating directories and paths · 578; Externalizable · 620; File · 582, 592,
655; File class · 574; File.list(&nbsp;) · 574; FileDescriptor · 582; FileInputReader
· 597; FileInputStream · 582; FilenameFilter · 574, 653; FileOutputStream ·
583; FileReader · 563, 590; FileWriter · 590, 599; FilterInputStream · 582;
FilterOutputStream · 583; FilterReader · 591; FilterWriter · 591; from standard
input · 602; GZIPInputStream · 606; GZIPOutputStream · 606; InflaterInputStream
· 606; input · 581; InputStream · 581, 913; InputStreamReader · 589, 590, 913;
internationalization · 590; library · 573; lightweight persistence · 613;
LineNumberInputStream · 586; LineNumberReader · 591; mark(&nbsp;) · 593;
mkdirs(&nbsp;) · 580; nextToken(&nbsp;) · 654; ObjectOutputStream · 614; output
· 581; OutputStream · 581, 583, 913; OutputStreamWriter · 589, 590, 913; pipe ·
581; piped stream · 869; piped streams · 602; PipedInputStream · 582;
PipedOutputStream · 582, 583; PipedReader · 590; PipedWriter · 590; PrintStream
· 588; PrintWriter · 591, 599, 913; pushBack(&nbsp;) · 654; PushbackInputStream
· 586; PushBackReader · 591; RandomAccessFile · 592, 593, 599; read(&nbsp;) ·
581; readChar(&nbsp;) · 600; readDouble(&nbsp;) · 600; Reader · 581, 589, 590,
913; readExternal(&nbsp;) · 620; readLine(&nbsp;) · 565, 591, 599, 600, 603;
readObject(&nbsp;) · 614; redirecting standard I/O · 604; renameTo(&nbsp;) ·
580; reset(&nbsp;) · 593; seek(&nbsp;) · 593, 601; SequenceInputStream · 582,
592; Serializable · 620; setErr(PrintStream) · 604; setIn(InputStream) · 604;
setOut(PrintStream) · 604; StreamTokenizer · 591, 639, 653, 682; StringBuffer ·
582; StringBufferInputStream · 582; StringReader · 590, 597; StringWriter ·
590; System.err · 602; System.in · 597, 602; System.out · 602; transient · 624;
typical I/O configurations · 594; Unicode · 590; write(&nbsp;) · 581;
writeBytes(&nbsp;) · 600; writeChars(&nbsp;) · 600; writeDouble(&nbsp;) · 600;
writeExternal(&nbsp;) · 620; writeObject(&nbsp;) · 614; Writer · 581, 589, 590,
913; ZipEntry · 610; ZipInputStream · 606; ZipOutputStream · 606</span></p>

<p class=MsoIndex1><span lang=EN-US>Icon · 738</span></p>

<p class=MsoIndex1><span lang=IT>IDL</span><span lang=EN-US> · 982</span></p>

<p class=MsoIndex1><span lang=EN-US>idltojava · 984</span></p>

<p class=MsoIndex1><span lang=EN-US>if-else statement · 151, 171</span></p>

<p class=MsoIndex1><span lang=EN-US>IllegalMonitorStateException · 866</span></p>

<p class=MsoIndex1><span lang=EN-US>ImageIcon · 738</span></p>

<p class=MsoIndex1><span lang=EN-US>immutable objects · 1047</span></p>

<p class=MsoIndex1><span lang=EN-US>implementation · 34; and interface · 288,
350; and interface, separating · 36; and interface, separation · 262; hiding ·
35, 261, 368; separation of interface and implementation · 722</span></p>

<p class=MsoIndex1><span lang=EN-US>implements keyword · 350</span></p>

<p class=MsoIndex1><span lang=EN-US>import keyword · 244</span></p>

<p class=MsoIndex1><span lang=EN-US>increment operator · 139</span></p>

<p class=MsoIndex1><span lang=EN-US>incremental development · 291</span></p>

<p class=MsoIndex1><span lang=EN-US>indexed property · 818</span></p>

<p class=MsoIndex1><span lang=EN-US>indexing operator [&nbsp;] · 231</span></p>

<p class=MsoIndex1><span lang=EN-US>indexOf(&nbsp;): String · 576, 681</span></p>

<p class=MsoIndex1><span lang=EN-US>InflaterInputStream · 606</span></p>

<p class=MsoIndex1><span lang=EN-US>inheritance · 38, 260, 271, 275, 311; and
cloning · 1034; and final · 302; and finalize(&nbsp;) · 333; and synchronized ·
858; choosing composition vs. inheritance · 288; class inheritance diagrams ·
293; combining composition &amp; inheritance · 281; designing with inheritance
· 339; diagram · 47; extending a class during · 41; extending interfaces with
inheritance · 358; from an abstract class · 326; from inner classes · 384;
inheritance and method overloading vs. overriding · 286; initialization with
inheritance · 304; multiple inheritance in C++ and Java · 354; pure inheritance
vs. extension · 341; specialization · 289; vs composition · 642; vs.
composition · 294</span></p>

<p class=MsoIndex1><span lang=EN-US>initial capacity, of a HashMap or HashSet ·
491</span></p>

<p class=MsoIndex1><span lang=EN-US>initialization: and class loading · 304;
array initialization · 231; base class · 278; class member · 273; constructor
initialization during inheritance and composition · 281; initializing class
members at point of definition · 221; initializing with the constructor · 191;
instance initialization · 229, 375; member initializers · 332; non-static
instance initialization · 229; of class data members · 220; of method variables
· 220; order of initialization · 223, 338; static · 306; with inheritance · 304</span></p>

<p class=MsoIndex1><span lang=EN-US>inizialization: lazy · 273</span></p>

<p class=MsoIndex1><span lang=EN-US>inline method calls · 299</span></p>

<p class=MsoIndex1><span lang=EN-US>inner class · 365, 799; access rights ·
376; and super · 385; and overriding · 385; and control frameworks · 394; and
Swing · 722; and upcasting · 368; anonymous · 709; anonymous inner class · 576,
875; anonymous inner class and constructors · 375; anonymous, and table-driven
code · 502; callback · 391; closure · 391; hidden reference to the object of
the enclosing class · 378; identifiers and .class files · 387; in methods &amp;
scopes · 370; inheriting from inner classes · 384; nesting within any arbitrary
scope · 372; private · 833; private inner classes · 397; referring to the outer
class object · 381; static inner classes · 379</span></p>

<p class=MsoIndex1><span lang=EN-US>input: console input · 597</span></p>

<p class=MsoIndex1><span lang=EN-US>InputStream · 581, 913</span></p>

<p class=MsoIndex1><span lang=EN-US>InputStreamReader · 589, 590, 913</span></p>

<p class=MsoIndex1><span lang=EN-US>insertNodeInto(&nbsp;) · 784</span></p>

<p class=MsoIndex1><span lang=EN-US>instance: instance initialization · 375;
non-static instance initialization · 229</span></p>

<p class=MsoIndex1><span lang=EN-US>instance of a class · 31</span></p>

<p class=MsoIndex1><span lang=EN-US>instanceof: dynamic instanceof · 671;
keyword · 666</span></p>

<p class=MsoIndex1><span lang=EN-US>Integer: parseInt(&nbsp;) · 776</span></p>

<p class=MsoIndex1><span lang=EN-US>Integer wrapper class · 233</span></p>

<p class=MsoIndex1><span lang=EN-US>interface: and implementation, separation ·
262; and inheritance · 358; base-class interface · 320; Cloneable interface
used as a flag · 1022; common interface · 325; defining the class · 88; for an
object · 32; graphical user interface (GUI) · 394, 689; implementation,
separation of · 36; initializing fields in interfaces · 361; keyword · 349;
nesting interfaces within classes and other interfaces · 362; private, as
nested interfaces · 364; Runnable · 836; separation of interface and
implementation · 722; upcasting to an interface · 353; user · 78; vs. abstract
· 356; vs. implemenation · 288</span></p>

<p class=MsoIndex1><span lang=EN-US>Interface Definition Language (IDL) · 982</span></p>

<p class=MsoIndex1><span lang=EN-US>interfaces: name collisions when combining
interfaces · 356</span></p>

<p class=MsoIndex1><span lang=EN-US>interfacing with hardware devices · 1065</span></p>

<p class=MsoIndex1><span lang=EN-US>internationalization, in I/O library · 590</span></p>

<p class=MsoIndex1><span lang=EN-US>Internet: Internet Protocol · 905; Internet
Service Provider (ISP) · 699</span></p>

<p class=MsoIndex1><span lang=EN-US>interrupt(&nbsp;) · 873</span></p>

<p class=MsoIndex1><span lang=EN-US>InterruptedException · 827</span></p>

<p class=MsoIndex1><span lang=EN-US>intranet · 693; and applets · 693</span></p>

<p class=MsoIndex1><span lang=EN-US>Introspector · 805</span></p>

<p class=MsoIndex1><span lang=EN-US>IP (Internet Protocol) · 905</span></p>

<p class=MsoIndex1><span lang=EN-US>is-a · 341; relationship, inheritance ·
289; relationship, inheritance &amp; upcasting · 292; vs. is-like-a
relationships · 42</span></p>

<p class=MsoIndex1><span lang=EN-US>isDaemon(&nbsp;) · 840</span></p>

<p class=MsoIndex1><span lang=EN-US>isDataFlavorSupported(&nbsp;) · 792</span></p>

<p class=MsoIndex1><span lang=EN-US>isInstance · 671</span></p>

<p class=MsoIndex1><span lang=EN-US>isInterface(&nbsp;) · 677</span></p>

<p class=MsoIndex1><span lang=EN-US>is-like-a · 342</span></p>

<p class=MsoIndex1><span lang=EN-US>ISP (Internet Service Provider) · 699</span></p>

<p class=MsoIndex1><span lang=EN-US>iteration, in program development · 84</span></p>

<p class=MsoIndex1><span lang=EN-US>iterator · 456</span></p>

<p class=MsoIndex1><span lang=EN-US>Iterator · 456, 463, 500; hasNext(&nbsp;) ·
457; next(&nbsp;) · 457</span></p>

<p class=MsoIndex1><span lang=EN-US>iterator(&nbsp;) · 463</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>J</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>Jacobsen, Ivar · 1093</span></p>

<p class=MsoIndex1><span lang=EN-US>JApplet · 713; menus · 759</span></p>

<p class=MsoIndex1><span lang=EN-US>JAR · 816; archive tag, for HTML and JAR
files · 793; file · 245; jar files and classpath · 249; packaging applets to
optimize loading · 793</span></p>

<p class=MsoIndex1><span lang=EN-US>JAR utility · 611</span></p>

<p class=MsoIndex1><span lang=EN-US>Java · 99; and pointers · 1013; and set-top
boxes · 146; capitalization style source-code checking tool · 645; compiling
and running a program · 121; containers library · 440; public Java seminars ·
11; versions · 22</span></p>

<p class=MsoIndex1><span lang=EN-US>Java 1.1: I/O streams · 589</span></p>

<p class=MsoIndex1><span lang=EN-US>Java AWT · 689</span></p>

<p class=MsoIndex1><span lang=EN-US>Java Foundation Classes (JFC/Swing) · 689</span></p>

<p class=MsoIndex1><span lang=EN-US>Java operators · 133</span></p>

<p class=MsoIndex1><span lang=EN-US>Java programs, running from the Windows
Explorer · 705</span></p>

<p class=MsoIndex1><span lang=EN-US>Java Server Pages (JSP) · 960</span></p>

<p class=MsoIndex1><span lang=EN-US>Java Virtual Machine · 662</span></p>

<p class=MsoIndex1><span lang=EN-US>JavaBeans: see Beans · 800</span></p>

<p class=MsoIndex1><span lang=EN-US>javac · 121</span></p>

<p class=MsoIndex1><span lang=EN-US>javah · 1067</span></p>

<p class=MsoIndex1><span lang=EN-US>JButton · 738</span></p>

<p class=MsoIndex1><span lang=EN-US>JButton, Swing · 706</span></p>

<p class=MsoIndex1><span lang=EN-US>JCheckBox · 738, 748</span></p>

<p class=MsoIndex1><span lang=EN-US>JCheckboxMenuItem · 765</span></p>

<p class=MsoIndex1><span lang=EN-US>JCheckBoxMenuItem · 760</span></p>

<p class=MsoIndex1><span lang=EN-US>JComboBox · 751</span></p>

<p class=MsoIndex1><span lang=EN-US>JComponent · 740, 768</span></p>

<p class=MsoIndex1><span lang=EN-US>JDBC: createStatement(&nbsp;) · 930;
database URL · 928; DatabaseMetaData · 938; executeQuery(&nbsp;) · 930;
flat-file database · 932; getFloat(&nbsp;) · 930; getInt(&nbsp;) · 930;
getString(&nbsp;) · 930; Java DataBase Connectivity · 927; join · 932;
relational database · 933; ResultSet · 930; SQL stored procedures · 935;
Statement · 930; Structured Query Language (SQL) · 927</span></p>

<p class=MsoIndex1><span lang=EN-US>JDialog · 771; menus · 759</span></p>

<p class=MsoIndex1><span lang=EN-US>JDK: downloading and installing · 121</span></p>

<p class=MsoIndex1><span lang=EN-US>JFC: Java Foundation Classes (JFC/Swing) ·
689</span></p>

<p class=MsoIndex1><span lang=EN-US>JFileChooser</span><span lang=EN-US> · 776</span></p>

<p class=MsoIndex1><span lang=EN-US>JFrame · 704, 713; menus · 759</span></p>

<p class=MsoIndex1><span lang=EN-US>Jini · 1003</span></p>

<p class=MsoIndex1><span lang=EN-US>JIT: Just-In Time compilers · 98</span></p>

<p class=MsoIndex1><span lang=EN-US>JLabel · 695, 743</span></p>

<p class=MsoIndex1><span lang=EN-US>JList · 753</span></p>

<p class=MsoIndex1><span lang=EN-US>JMenu · 759, 765</span></p>

<p class=MsoIndex1><span lang=EN-US>JMenuBar · 759, 766</span></p>

<p class=MsoIndex1><span lang=EN-US>JMenuItem · 738, 759, 765, 766, 768</span></p>

<p class=MsoIndex1><span lang=EN-US>JNI functions · 1069</span></p>

<p class=MsoIndex1><span lang=EN-US>JNICALL · 1068</span></p>

<p class=MsoIndex1><span lang=EN-US>JNIEnv · 1069</span></p>

<p class=MsoIndex1><span lang=EN-US>JNIEXPORT · 1068</span></p>

<p class=MsoIndex1><span lang=EN-US>join · 932</span></p>

<p class=MsoIndex1><span lang=EN-US>JOptionPane · 756</span></p>

<p class=MsoIndex1><span lang=EN-US>JPanel · 713, 736, 768, 894</span></p>

<p class=MsoIndex1><span lang=EN-US>JPopupMenu · 766</span></p>

<p class=MsoIndex1><span lang=EN-US>JProgressBar · 781</span></p>

<p class=MsoIndex1><span lang=EN-US>JRadioButton · 738, 750</span></p>

<p class=MsoIndex1><span lang=EN-US>JScrollPane · 712, 744, 755, 784</span></p>

<p class=MsoIndex1><span lang=EN-US>JSlider · 781</span></p>

<p class=MsoIndex1><span lang=EN-US>JSP · 960</span></p>

<p class=MsoIndex1><span lang=EN-US>JTabbedPane · 755</span></p>

<p class=MsoIndex1><span lang=EN-US>JTable · 784</span></p>

<p class=MsoIndex1><span lang=EN-US>JTextArea · 711, 790</span></p>

<p class=MsoIndex1><span lang=EN-US>JTextField · 708, 740</span></p>

<p class=MsoIndex1><span lang=EN-US>JTextPane · 747</span></p>

<p class=MsoIndex1><span lang=EN-US>JToggleButton · 736</span></p>

<p class=MsoIndex1><span lang=EN-US>JTree · 781</span></p>

<p class=MsoIndex1><span lang=EN-US>JVM (Java Virtual Machine) · 662</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>K</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>keyboard navigation, and Swing · 691</span></p>

<p class=MsoIndex1><span lang=EN-US>keyboard shortcuts · 765</span></p>

<p class=MsoIndex1><span lang=EN-US>keySet(&nbsp;) · 511</span></p>

<p class=MsoIndex1><span lang=EN-US>keywords: class · 32, 38</span></p>

<p class=MsoIndex1><span lang=EN-US>Koenig, Andrew · 1079</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>L</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>label · 178</span></p>

<p class=MsoIndex1><span lang=EN-US>labeled break · 178</span></p>

<p class=MsoIndex1><span lang=EN-US>labeled continue · 178</span></p>

<p class=MsoIndex1><span lang=EN-US>late binding · 45, 311, 316</span></p>

<p class=MsoIndex1><span lang=EN-US>layout: controlling layout with layout
managers · 712</span></p>

<p class=MsoIndex1><span lang=EN-US>lazy inizialization · 273</span></p>

<p class=MsoIndex1><span lang=EN-US>left-shift operator (&lt;&lt;) · 147</span></p>

<p class=MsoIndex1><span lang=EN-US>length, array member · 232</span></p>

<p class=MsoIndex1><span lang=EN-US>length, for arrays · 409</span></p>

<p class=MsoIndex1><span lang=EN-US>less than (&lt;) · 141</span></p>

<p class=MsoIndex1><span lang=EN-US>less than or equal to (&lt;=) · 141</span></p>

<p class=MsoIndex1><span lang=EN-US>lexicographic vs. alphabetic sorting · 436</span></p>

<p class=MsoIndex1><span lang=EN-US>library: creator, vs. client programmer ·
243; design · 243; use · 244</span></p>

<p class=MsoIndex1><span lang=EN-US>LIFO · 471</span></p>

<p class=MsoIndex1><span lang=EN-US>lightweight: Swing components · 691</span></p>

<p class=MsoIndex1><span lang=EN-US>lightweight persistence · 613</span></p>

<p class=MsoIndex1><span lang=EN-US>LineNumberInputStream · 586</span></p>

<p class=MsoIndex1><span lang=EN-US>LineNumberReader · 591</span></p>

<p class=MsoIndex1><span lang=EN-US>linked list · 440</span></p>

<p class=MsoIndex1><span lang=EN-US>LinkedList · 467, 472, 505</span></p>

<p class=MsoIndex1><span lang=EN-US>list: drop-down list · 751</span></p>

<p class=MsoIndex1><span lang=EN-US>List · 408, 439, 440, 467, 753; sorting and
searching · 511</span></p>

<p class=MsoIndex1><span lang=EN-US>list boxes · 753</span></p>

<p class=MsoIndex1><span lang=EN-US>listener adapters · 729</span></p>

<p class=MsoIndex1><span lang=EN-US>listener classes · 799</span></p>

<p class=MsoIndex1><span lang=EN-US>listener interfaces · 728</span></p>

<p class=MsoIndex1><span lang=EN-US>listeners and events · 723</span></p>

<p class=MsoIndex1><span lang=EN-US>Lister, Timothy · 1095</span></p>

<p class=MsoIndex1><span lang=EN-US>ListIterator · 467</span></p>

<p class=MsoIndex1><span lang=EN-US>literal: class literal · 664, 669; double ·
156; float · 156; long · 156; values · 155</span></p>

<p class=MsoIndex1><span lang=EN-US>load factor, of a HashMap or HashSet · 491</span></p>

<p class=MsoIndex1><span lang=EN-US>loading: .class files · 247; initialization
&amp; class loading · 304; loding a class · 305</span></p>

<p class=MsoIndex1><span lang=EN-US>local loopback IP address · 907</span></p>

<p class=MsoIndex1><span lang=EN-US>localhost · 907; and RMI · 977</span></p>

<p class=MsoIndex1><span lang=EN-US>lock, for multithreading · 848</span></p>

<p class=MsoIndex1><span lang=EN-US>logarithms: natural logarithms · 156</span></p>

<p class=MsoIndex1><span lang=EN-US>logical: AND · 154; operator and
short-circuiting · 144; operators · 143; OR · 154</span></p>

<p class=MsoIndex1><span lang=EN-US>long, literal value marker (L) · 156</span></p>

<p class=MsoIndex1><span lang=EN-US>Look &amp; Feel: Pluggable · 787</span></p>

<p class=MsoIndex1><span lang=EN-US>lvalue · 134</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>M</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>main(&nbsp;) · 277</span></p>

<p class=MsoIndex1><span lang=EN-US>maintenance, program · 85</span></p>

<p class=MsoIndex1><span lang=EN-US>management obstacles · 95</span></p>

<p class=MsoIndex1><span lang=EN-US>manifest file, for JAR files · 611, 816</span></p>

<p class=MsoIndex1><span lang=EN-US>map · 477</span></p>

<p class=MsoIndex1><span lang=EN-US>Map · 408, 439, 440, 476, 508</span></p>

<p class=MsoIndex1><span lang=EN-US>Map.Entry · 486</span></p>

<p class=MsoIndex1><span lang=EN-US>mark(&nbsp;) · 593</span></p>

<p class=MsoIndex1><span lang=EN-US>Math.random(&nbsp;) · 480; values produced
by · 186</span></p>

<p class=MsoIndex1><span lang=EN-US>mathematical operators · 137</span></p>

<p class=MsoIndex1><span lang=EN-US>max(&nbsp;) · 512</span></p>

<p class=MsoIndex1><span lang=EN-US>member: member function · 35; object · 37</span></p>

<p class=MsoIndex1><span lang=EN-US>member initializers · 332</span></p>

<p class=MsoIndex1><span lang=EN-US>memory exhaustion, solution via References
· 495</span></p>

<p class=MsoIndex1><span lang=EN-US>mentoring: and training · 95, 96</span></p>

<p class=MsoIndex1><span lang=EN-US>menu: JPopupMenu · 766</span></p>

<p class=MsoIndex1><span lang=EN-US>menus: JDialog, JApplet, JFrame · 759</span></p>

<p class=MsoIndex1><span lang=EN-US>message box, in Swing · 756</span></p>

<p class=MsoIndex1><span lang=EN-US>message,  sending · 33</span></p>

<p class=MsoIndex1><span lang=EN-US>meta-class · 662</span></p>

<p class=MsoIndex1><span lang=EN-US>method: adding more methods to a design ·
268; aliasing during a method call · 1014; aliasing during method calls · 136;
behavior of polymorphic methods inside constructors · 337; distinguishing
overloaded methods · 196; final · 316, 339; final methods · 299; initialization
of method variables · 220; inline method calls · 299; inner classes in methods
&amp; scopes · 370; lookup tool · 724; method call binding · 315; overloading ·
194; passing a reference into a method · 1014; polymorphic method call · 311;
private · 339; protected methods · 290; recursive · 459; static · 206;
synchronized method and blocking · 860</span></p>

<p class=MsoIndex1><span lang=EN-US>Method · 808; for reflection · 678</span></p>

<p class=MsoIndex1><span lang=EN-US>MethodDescriptors · 808</span></p>

<p class=MsoIndex1><span lang=EN-US>methodology, analysis and design · 71</span></p>

<p class=MsoIndex1><span lang=EN-US>Meyers, Scott · 35</span></p>

<p class=MsoIndex1><span lang=EN-US>Microsoft · 820; Visual Basic · 800</span></p>

<p class=MsoIndex1><span lang=EN-US>min(&nbsp;) · 512</span></p>

<p class=MsoIndex1><span lang=EN-US>mission statement · 75</span></p>

<p class=MsoIndex1><span lang=EN-US>mistakes, and design · 268</span></p>

<p class=MsoIndex1><span lang=EN-US>mkdirs(&nbsp;) · 580</span></p>

<p class=MsoIndex1><span lang=EN-US>mnemonics (keyboard shortcuts) · 765</span></p>

<p class=MsoIndex1><span lang=EN-US>modulus · 137</span></p>

<p class=MsoIndex1><span lang=EN-US>monitor, for multithreading · 848</span></p>

<p class=MsoIndex1><span lang=EN-US>multicast · 814; event, and JavaBeans ·
854; multicast events · 796</span></p>

<p class=MsoIndex1><span lang=EN-US>multidimensional arrays · 236</span></p>

<p class=MsoIndex1><span lang=EN-US>Multimedia CD ROM for book · 20</span></p>

<p class=MsoIndex1><span lang=EN-US>multiparadigm programming · 31</span></p>

<p class=MsoIndex1><span lang=EN-US>multiple inheritance, in C++ and Java · 354</span></p>

<p class=MsoIndex1><span lang=EN-US>multiplication · 137</span></p>

<p class=MsoIndex1><span lang=EN-US>multiply-nested class · 383</span></p>

<p class=MsoIndex1><span lang=EN-US>MultiStringMap · 652</span></p>

<p class=MsoIndex1><span lang=EN-US>multitasking · 825</span></p>

<p class=MsoIndex1><span lang=EN-US>multithreading · 825, 917; and containers ·
514; and JavaBeans · 854; blocking · 859; deadlock · 865; deciding what methods
to synchronize · 858; drawbacks · 899; Runnable · 891; servlets · 954; when to
use it · 899</span></p>

<p class=MsoIndex1><span lang=EN-US>multi-tiered systems · 796</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>N</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>name · 697; clash · 244; collisions · 250;
creating unique package names · 247; spaces · 244</span></p>

<p class=MsoIndex1><span lang=EN-US>name collisions when combining interfaces ·
356</span></p>

<p class=MsoIndex1><span lang=EN-US>name, HTML keyword · 839</span></p>

<p class=MsoIndex1><span lang=EN-US>Naming: bind(&nbsp;) · 976; rebind(&nbsp;)
· 978; unbind(&nbsp;) · 978</span></p>

<p class=MsoIndex1><span lang=EN-US>narrowing conversion · 155, 170, 201</span></p>

<p class=MsoIndex1><span lang=EN-US>native method interface (NMI) in Java 1.0 ·
1065</span></p>

<p class=MsoIndex1><span lang=EN-US>natural logarithms · 156</span></p>

<p class=MsoIndex1><span lang=EN-US>nesting interfaces · 362</span></p>

<p class=MsoIndex1><span lang=EN-US>network programming · 904; accept(&nbsp;) ·
909; client · 907; Common-Gateway Interface (CGI) · 948; datagrams · 923;
dedicated connection · 917; displaying a Web page from within an applet · 923;
DNS (Domain Name System) · 905; dotted quad · 905; getInputStream(&nbsp;) ·
909; getOutputStream(&nbsp;) · 909; HTML · 948; identifying machines · 905;
Internet Protocol (IP) · 905; Java DataBase Connectivity (JDBC) · 927; local
loopback IP address · 907; localhost · 907; multithreading · 917; port · 908;
reliable protocol · 923; server · 907; serving multiple clients · 917;
showDocument(&nbsp;) · 924; Socket · 915; stream-based sockets · 923; testing
programs without a network · 907; Transmission Control Protocol (TCP) · 923;
unreliable protocol · 923; URL · 925; User Datagram Protocol (UDP) · 923</span></p>

<p class=MsoIndex1><span lang=EN-US>new operator · 207; and primitives, array ·
233</span></p>

<p class=MsoIndex1><span lang=EN-US>newInstance(&nbsp;) · 737; reflection · 676</span></p>

<p class=MsoIndex1><span lang=EN-US>next(&nbsp;), Iterator · 457</span></p>

<p class=MsoIndex1><span lang=EN-US>nextToken(&nbsp;) · 654</span></p>

<p class=MsoIndex1><span lang=EN-US>NMI: Java 1.0 native method interface ·
1065</span></p>

<p class=MsoIndex1><span lang=EN-US>no-arg: constructors · 196</span></p>

<p class=MsoIndex1><span lang=EN-US>non-Java code, calling · 1065</span></p>

<p class=MsoIndex1><span lang=EN-US>North, BorderLayout · 713</span></p>

<p class=MsoIndex1><span lang=EN-US>NOT: logical (!) · 143</span></p>

<p class=MsoIndex1><span lang=EN-US>not equivalent (!=) · 141</span></p>

<p class=MsoIndex1><span lang=EN-US>notify(&nbsp;) · 860</span></p>

<p class=MsoIndex1><span lang=EN-US>notifyAll(&nbsp;) · 860</span></p>

<p class=MsoIndex1><span lang=EN-US>notifyListeners(&nbsp;) · 858</span></p>

<p class=MsoIndex1><span lang=EN-US>null · 107, 411; garbage collection,
allowing cleanup · 397</span></p>

<p class=MsoIndex1><span lang=EN-US>NullPointerException · 550</span></p>

<p class=MsoIndex1><span lang=EN-US>numbers, binary · 156</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>O</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>object · 31; aliasing · 136; arrays are
first-class objects · 409; assigning objects by copying references · 134;
assignment and reference copying · 134; business object/logic · 796; Class
object · 633, 662, 848; creation · 192; equals(&nbsp;) method · 142;
equivalence · 141; equivalence vs reference equivalence · 142; final · 295;
five stages of object design · 82; guidelines for object development · 83;
immutable objects · 1047; interface to · 32; lock, for multithreading · 848;
member · 37; object-oriented programming · 660; order of finalization of
objects · 336; process of creation · 227; reference equivalence vs. object
equivalence · 1025; serialization · 613; web of objects · 614, 1020</span></p>

<p class=MsoIndex1><span lang=EN-US>Object · 408; clone(&nbsp;) · 1021, 1025;
getClass(&nbsp;) · 674; hashCode(&nbsp;) · 477; standard root class, default
inheritance from · 275; wait( ) and notify( ) methods · 866</span></p>

<p class=MsoIndex1><span lang=EN-US>object-oriented: analysis and design · 71;
basic concepts of object-oriented programming (OOP) · 29</span></p>

<p class=MsoIndex1><span lang=EN-US>ObjectOutputStream · 614</span></p>

<p class=MsoIndex1><span lang=EN-US>obstacles, management · 95</span></p>

<p class=MsoIndex1><span lang=EN-US>Octal · 156</span></p>

<p class=MsoIndex1><span lang=EN-US>ODBC · 928</span></p>

<p class=MsoIndex1><span lang=EN-US>OMG · 981</span></p>

<p class=MsoIndex1><span lang=EN-US>ones complement operator · 146</span></p>

<p class=MsoIndex1><span lang=EN-US>OOP · 262; analysis and design · 71; basic
characteristics · 31; basic concepts of object-oriented programming · 29;
protocol · 350; Simula programming language · 32; substitutability · 31</span></p>

<p class=MsoIndex1><span lang=EN-US>operator · 133; + and += overloading for
String · 277; +, for String · 1054; == and != · 1025; binary · 146; bitwise ·
146; casting · 154; comma · 152; comma operator · 175; common pitfalls · 153;
indexing operator [&nbsp;] · 231; logical · 143; logical operators and
short-circuiting · 144; ones-complement · 146; operator overloading for String
· 1054; overloading · 153; precedence · 134; precedence mnemonic · 158;
relational · 141; shift · 147; ternary · 151; unary · 139, 146</span></p>

<p class=MsoIndex1><span lang=EN-US>optional methods, in the Java 2 containers
· 516</span></p>

<p class=MsoIndex1><span lang=EN-US>OR · 154; (||) · 143</span></p>

<p class=MsoIndex1><span lang=EN-US>order: of constructor calls with
inheritance · 330; of finalization of objects · 336; of initialization · 223,
304, 338</span></p>

<p class=MsoIndex1><span lang=EN-US>organization, code · 255</span></p>

<p class=MsoIndex1><span lang=EN-US>OutputStream · 581, 583, 913</span></p>

<p class=MsoIndex1><span lang=EN-US>OutputStreamWriter · 589, 590, 913</span></p>

<p class=MsoIndex1><span lang=EN-US>overflow: and primitive types · 169</span></p>

<p class=MsoIndex1><span lang=EN-US>overloading: and constructors · 194;
distinguishing overloaded methods · 196; lack of name hiding during inheritance
· 286; method overloading · 194; on return values · 202; operator + and +=
overloading for String · 277; operator overloading · 153; operator overloading
for String · 1054; overloading vs. overriding · 286; vs. overriding · 324</span></p>

<p class=MsoIndex1><span lang=EN-US>overriding: and inner classes · 385;
function · 42; overloading vs. overriding · 286; vs. overloading · 324</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>P</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>package · 244; access, and friendly · 255;
and applets · 699; and directory structure · 254; creating unique package names
· 247; default package · 257; names, capitalization · 116; visibility, friendly
· 368</span></p>

<p class=MsoIndex1><span lang=EN-US>paintComponent(&nbsp;) · 768, 776</span></p>

<p class=MsoIndex1><span lang=EN-US>Painting on a JPanel in Swing · 768</span></p>

<p class=MsoIndex1><span lang=EN-US>pair programming · 90</span></p>

<p class=MsoIndex1><span lang=EN-US>paralysis, analysis · 72</span></p>

<p class=MsoIndex1><span lang=EN-US>param, HTML keyword · 839</span></p>

<p class=MsoIndex1><span lang=EN-US>parameter, applet · 697</span></p>

<p class=MsoIndex1><span lang=EN-US>parameterized type · 455</span></p>

<p class=MsoIndex1><span lang=EN-US>parseInt(&nbsp;) · 776</span></p>

<p class=MsoIndex1><span lang=EN-US>pass: pass by value · 1018; passing a
reference into a method · 1014</span></p>

<p class=MsoIndex1><span lang=EN-US>Pattern: Command Pattern · 575</span></p>

<p class=MsoIndex1><span lang=EN-US>patterns, design · 86, 94</span></p>

<p class=MsoIndex1><span lang=EN-US>patterns, design patterns · 266</span></p>

<p class=MsoIndex1><span lang=EN-US>perfect hashing function · 488</span></p>

<p class=MsoIndex1><span lang=EN-US>performance: and final · 302</span></p>

<p class=MsoIndex1><span lang=EN-US>performance issues · 96</span></p>

<p class=MsoIndex1><span lang=EN-US>Perl programming language · 705</span></p>

<p class=MsoIndex1><span lang=EN-US>persistence · 630; lightweight persistence
· 613</span></p>

<p class=MsoIndex1><span lang=EN-US>PhantomReference · 495</span></p>

<p class=MsoIndex1><span lang=EN-US>pipe · 581</span></p>

<p class=MsoIndex1><span lang=EN-US>piped stream · 869</span></p>

<p class=MsoIndex1><span lang=EN-US>piped streams · 602</span></p>

<p class=MsoIndex1><span lang=EN-US>PipedInputStream · 582</span></p>

<p class=MsoIndex1><span lang=EN-US>PipedOutputStream · 582, 583</span></p>

<p class=MsoIndex1><span lang=EN-US>PipedReader · 590</span></p>

<p class=MsoIndex1><span lang=EN-US>PipedWriter · 590</span></p>

<p class=MsoIndex1><span lang=EN-US>planning, software development · 74</span></p>

<p class=MsoIndex1><span lang=EN-US>Plauger, P.J. · 1094</span></p>

<p class=MsoIndex1><span lang=EN-US>Pluggable Look &amp; Feel · 787</span></p>

<p class=MsoIndex1><span lang=EN-US>pointer: Java exclusion of pointers · 391</span></p>

<p class=MsoIndex1><span lang=EN-US>pointers, and Java · 1013</span></p>

<p class=MsoIndex1><span lang=EN-US>polymorphism · 44, 311, 346, 660, 685; and
constructors · 330; behavior of polymorphic methods inside constructors · 337</span></p>

<p class=MsoIndex1><span lang=EN-US>port · 908</span></p>

<p class=MsoIndex1><span lang=EN-US>portability in C, C++ and Java · 158</span></p>

<p class=MsoIndex1><span lang=EN-US>position, absolute, when laying out Swing
components · 716</span></p>

<p class=MsoIndex1><span lang=EN-US>precedence: operator precedence mnemonic ·
158</span></p>

<p class=MsoIndex1><span lang=EN-US>prerequisites, for this book · 29</span></p>

<p class=MsoIndex1><span lang=EN-US>primitive: comparison · 142; containers of
primitives · 412; data types, and use with operators · 159; dealing with the
immutability of primitive wrapper classes · 1047; final · 294; final static
primitives · 296; initialization of class data members · 220; wrappers · 481</span></p>

<p class=MsoIndex1><span lang=EN-US>primitive types · 105</span></p>

<p class=MsoIndex1><span lang=EN-US>printInfo(&nbsp;) · 677</span></p>

<p class=MsoIndex1><span lang=EN-US>printing arrays · 417</span></p>

<p class=MsoIndex1><span lang=EN-US>println(&nbsp;) · 458</span></p>

<p class=MsoIndex1><span lang=EN-US>printStackTrace(&nbsp;) · 543, 545</span></p>

<p class=MsoIndex1><span lang=EN-US>PrintStream · 588</span></p>

<p class=MsoIndex1><span lang=EN-US>PrintWriter · 591, 599, 913</span></p>

<p class=MsoIndex1><span lang=EN-US>priority: default priority for a Thread
group · 882; thread · 877</span></p>

<p class=MsoIndex1><span lang=EN-US>private · 36, 243, 255, 258, 290, 848;
illusion of overriding private methods · 299; inner class · 833; inner classes
· 397; interfaces, when nested · 364; methods · 339</span></p>

<p class=MsoIndex1><span lang=EN-US>problem space · 30, 291</span></p>

<p class=MsoIndex1><span lang=EN-US>process, and threading · 825</span></p>

<p class=MsoIndex1><span lang=EN-US>program: maintenance · 85</span></p>

<p class=MsoIndex1><span lang=EN-US>programmer, client · 35</span></p>

<p class=MsoIndex1><span lang=EN-US>programming: basic concepts of
object-oriented programming (OOP) · 29; coding standards · 1077; event-driven
programming · 707; Extreme Programming (XP) · 88, 1093; in the large · 92;
multiparadigm · 31; object-oriented · 660; pair · 90</span></p>

<p class=MsoIndex1><span lang=EN-US>progress bar · 780</span></p>

<p class=MsoIndex1><span lang=EN-US>promotion: of primitive types · 169; type
promotion · 157</span></p>

<p class=MsoIndex1><span lang=EN-US>Properties · 652</span></p>

<p class=MsoIndex1><span lang=EN-US>property · 801; bound properties · 818;
constrained properties · 818; custom property editor · 818; custom property
sheet · 818; indexed property · 818</span></p>

<p class=MsoIndex1><span lang=EN-US>PropertyChangeEvent · 818</span></p>

<p class=MsoIndex1><span lang=EN-US>PropertyDescriptors · 808</span></p>

<p class=MsoIndex1><span lang=EN-US>ProptertyVetoException · 818</span></p>

<p class=MsoIndex1><span lang=EN-US>protected · 36, 243, 255, 260, 290; and
friendly · 290; is also friendly · 261; more accessible than friendly · 335;
use in clone(&nbsp;) · 1021</span></p>

<p class=MsoIndex1><span lang=EN-US>protocol · 350; unreliable protocol · 923</span></p>

<p class=MsoIndex1><span lang=EN-US>prototyping: rapid · 86</span></p>

<p class=MsoIndex1><span lang=EN-US>public · 36, 243, 255, 256; and interface ·
350; class, and compilation units · 245</span></p>

<p class=MsoIndex1><span lang=EN-US>pure: substitution · 42</span></p>

<p class=MsoIndex1><span lang=EN-US>pure inheritance, vs. extension · 341</span></p>

<p class=MsoIndex1><span lang=EN-US>pure substitution · 342</span></p>

<p class=MsoIndex1><span lang=EN-US>pushBack(&nbsp;) · 654</span></p>

<p class=MsoIndex1><span lang=EN-US>PushbackInputStream · 586</span></p>

<p class=MsoIndex1><span lang=EN-US>PushBackReader · 591</span></p>

<p class=MsoIndex1><span lang=EN-US>put(&nbsp;), HashMap · 481</span></p>

<p class=MsoIndex1><span lang=EN-US>Python · 81, 99</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>Q</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>queue · 440, 472</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>R</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>RAD (Rapid Application Development) · 678</span></p>

<p class=MsoIndex1><span lang=EN-US>radio button · 750</span></p>

<p class=MsoIndex1><span lang=EN-US>random number generator, values produced by
· 186</span></p>

<p class=MsoIndex1><span lang=EN-US>random(&nbsp;) · 480</span></p>

<p class=MsoIndex1><span lang=EN-US>RandomAccessFile · 592, 593, 599</span></p>

<p class=MsoIndex1><span lang=EN-US>rapid prototyping · 86</span></p>

<p class=MsoIndex1><span lang=EN-US>reachable objects and garbage collection ·
495</span></p>

<p class=MsoIndex1><span lang=EN-US>read(&nbsp;) · 581</span></p>

<p class=MsoIndex1><span lang=EN-US>readChar(&nbsp;) · 600</span></p>

<p class=MsoIndex1><span lang=EN-US>readDouble(&nbsp;) · 600</span></p>

<p class=MsoIndex1><span lang=EN-US>Reader · 581, 589, 590, 869, 913</span></p>

<p class=MsoIndex1><span lang=EN-US>readExternal(&nbsp;) · 620</span></p>

<p class=MsoIndex1><span lang=EN-US>reading from standard input · 602</span></p>

<p class=MsoIndex1><span lang=EN-US>readLine(&nbsp;) · 565, 591, 599, 600, 603</span></p>

<p class=MsoIndex1><span lang=EN-US>readObject(&nbsp;) · 614; with Serializable
· 627</span></p>

<p class=MsoIndex1><span lang=EN-US>rebind(&nbsp;) · 978</span></p>

<p class=MsoIndex1><span lang=EN-US>recursion, unintended via toString() · 459</span></p>

<p class=MsoIndex1><span lang=EN-US>redirecting standard I/O · 604</span></p>

<p class=MsoIndex1><span lang=EN-US>refactoring · 85</span></p>

<p class=MsoIndex1><span lang=EN-US>reference: assigning objects by copying
references · 134; equivalence vs object equivalence · 142; final · 295; finding
exact type of a base reference · 662; null · 107; reference equivalence vs.
object equivalence · 1025</span></p>

<p class=MsoIndex1><span lang=EN-US>Reference, from java.lang.ref · 495</span></p>

<p class=MsoIndex1><span lang=EN-US>referencing, forward referencing · 222</span></p>

<p class=MsoIndex1><span lang=EN-US>reflection · 677, 678, 724, 804; and Beans
· 801; difference between RTTI and reflection · 679</span></p>

<p class=MsoIndex1><span lang=EN-US>reflection example · 736</span></p>

<p class=MsoIndex1><span lang=EN-US>registry: remote object registry · 976</span></p>

<p class=MsoIndex1><span lang=EN-US>relational: database · 933; operators · 141</span></p>

<p class=MsoIndex1><span lang=EN-US>reliable protocol · 923</span></p>

<p class=MsoIndex1><span lang=EN-US>Remote Method Invocation (RMI) · 973</span></p>

<p class=MsoIndex1><span lang=EN-US>RemoteException · 980</span></p>

<p class=MsoIndex1><span lang=EN-US>removeActionListener(&nbsp;) · 812, 857</span></p>

<p class=MsoIndex1><span lang=EN-US>removeXXXListener(&nbsp;) · 723</span></p>

<p class=MsoIndex1><span lang=EN-US>renameTo(&nbsp;) · 580</span></p>

<p class=MsoIndex1><span lang=EN-US>reporting errors in book · 23</span></p>

<p class=MsoIndex1><span lang=EN-US>request, in OOP · 33</span></p>

<p class=MsoIndex1><span lang=EN-US>requirements analysis · 75</span></p>

<p class=MsoIndex1><span lang=EN-US>reset(&nbsp;) · 593</span></p>

<p class=MsoIndex1><span lang=EN-US>ResultSet · 930</span></p>

<p class=MsoIndex1><span lang=EN-US>resume(&nbsp;) · 860, 864; and deadlocks ·
873; deprecation in Java 2 · 875</span></p>

<p class=MsoIndex1><span lang=EN-US>resumption, termination vs. resumption,
exception handling · 536</span></p>

<p class=MsoIndex1><span lang=EN-US>re-throwing an exception · 545</span></p>

<p class=MsoIndex1><span lang=EN-US>return: an array · 413; constructor return
value · 193; overloading on return value · 202</span></p>

<p class=MsoIndex1><span lang=EN-US>reusability · 37</span></p>

<p class=MsoIndex1><span lang=EN-US>reuse · 83; code reuse · 271; existing
class libraries · 94; reusable code · 800</span></p>

<p class=MsoIndex1><span lang=EN-US>right-shift operator (&gt;&gt;) · 147</span></p>

<p class=MsoIndex1><span lang=EN-US>RMI: AlreadyBoundException · 978; and CORBA
· 989; bind(&nbsp;) · 976; localhost · 977; rebind(&nbsp;) · 978; Remote · 974;
remote interface · 974; Remote Method Invocation · 973; remote object registry ·
976; RemoteException · 974, 980; rmic · 979; rmic and classpath · 979;
rmiregistry · 976; RMISecurityManager · 976; Serializable arguments · 978;
skeleton · 978; stub · 978; TCP/IP · 977; unbind(&nbsp;) · 978;
UnicastRemoteObject · 974</span></p>

<p class=MsoIndex1><span lang=EN-US>rmic · 979</span></p>

<p class=MsoIndex1><span lang=EN-US>rmiregistry · 976</span></p>

<p class=MsoIndex1><span lang=EN-US>RMISecurityManager · 976</span></p>

<p class=MsoIndex1><span lang=EN-US>rollover · 740</span></p>

<p class=MsoIndex1><span lang=EN-US>RTTI: and cloning · 1025; cast · 661; Class
· 737; Class object · 662; ClassCastException · 666; Constructor · 678;
difference between RTTI and reflection · 679; downcast · 666; Field · 678;
getConstructor(&nbsp;) · 737; instanceof keyword · 666; isInstance · 671;
meta-class · 662; Method · 678; newInstance(&nbsp;) · 737; reflection · 677;
run-time type identification (RTTI) · 344; type-safe downcast · 665; using the
Class object · 674</span></p>

<p class=MsoIndex1><span lang=EN-US>Rumbaugh, James · 1093</span></p>

<p class=MsoIndex1><span lang=EN-US>runFinalizersOnExit(&nbsp;) · 335</span></p>

<p class=MsoIndex1><span lang=EN-US>Runnable · 891; interface · 836; Thread ·
859</span></p>

<p class=MsoIndex1><span lang=EN-US>running a Java program · 121</span></p>

<p class=MsoIndex1><span lang=EN-US>run-time binding · 316; polymorphism · 311</span></p>

<p class=MsoIndex1><span lang=EN-US>run-time type identification: (RTTI) · 344;
misuse · 685; shape example · 659; when to use it · 685</span></p>

<p class=MsoIndex1><span lang=EN-US>RuntimeException · 408, 550</span></p>

<p class=MsoIndex1><span lang=EN-US>rvalue · 134</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>S</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>safety, and applet restrictions · 692</span></p>

<p class=MsoIndex1><span lang=EN-US>scenario · 77</span></p>

<p class=MsoIndex1><span lang=EN-US>scheduling · 79</span></p>

<p class=MsoIndex1><span lang=EN-US>scope: inner class nesting within any
arbitrary scope · 372; inner classes in methods &amp; scopes · 370; use case ·
84</span></p>

<p class=MsoIndex1><span lang=EN-US>scrolling in Swing · 712</span></p>

<p class=MsoIndex1><span lang=EN-US>searching: sorting and searching Lists ·
511</span></p>

<p class=MsoIndex1><span lang=EN-US>searching an array · 437</span></p>

<p class=MsoIndex1><span lang=EN-US>section, critical section and synchronized
block · 852</span></p>

<p class=MsoIndex1><span lang=EN-US>seek(&nbsp;) · 593, 601</span></p>

<p class=MsoIndex1><span lang=EN-US>seminars: public Java seminars · 11;
training, provided by Bruce Eckel · 23</span></p>

<p class=MsoIndex1><span lang=EN-US>sending a message · 33</span></p>

<p class=MsoIndex1><span lang=EN-US>separating business logic from UI logic ·
796</span></p>

<p class=MsoIndex1><span lang=EN-US>separation of interface and implementation
· 36, 262, 722</span></p>

<p class=MsoIndex1><span lang=EN-US>SequenceInputStream · 582, 592</span></p>

<p class=MsoIndex1><span lang=EN-US>Serializable · 613, 620, 625, 637, 814;
readObject(&nbsp;) · 627; writeObject(&nbsp;) · 627</span></p>

<p class=MsoIndex1><span lang=EN-US>serialization: and object storage · 630;
and transient · 624; controlling the process of serialization · 619;
defaultReadObject(&nbsp;) · 629; defaultWriteObject(&nbsp;) · 629; RMI
arguments · 978; to perform deep copying · 1032; Versioning · 630</span></p>

<p class=MsoIndex1><span lang=EN-US>server · 907</span></p>

<p class=MsoIndex1><span lang=EN-US>servlet · 948; multithreading · 954;
running servlets with Tomcat · 960; session tracking · 955</span></p>

<p class=MsoIndex1><span lang=EN-US>session: and JSP · 969</span></p>

<p class=MsoIndex1><span lang=EN-US>session tracking, with servlets · 955</span></p>

<p class=MsoIndex1><span lang=EN-US>Set · 408, 439, 440, 473, 506</span></p>

<p class=MsoIndex1><span lang=EN-US>setActionCommand(&nbsp;) · 765</span></p>

<p class=MsoIndex1><span lang=EN-US>setBorder(&nbsp;) · 743</span></p>

<p class=MsoIndex1><span lang=EN-US>setContents(&nbsp;) · 792</span></p>

<p class=MsoIndex1><span lang=EN-US>setDaemon(&nbsp;) · 840</span></p>

<p class=MsoIndex1><span lang=EN-US>setDefaultCloseOperation(&nbsp;) · 704</span></p>

<p class=MsoIndex1><span lang=EN-US>setErr(PrintStream) · 604</span></p>

<p class=MsoIndex1><span lang=EN-US>setIcon(&nbsp;) · 740</span></p>

<p class=MsoIndex1><span lang=EN-US>setIn(InputStream) · 604</span></p>

<p class=MsoIndex1><span lang=EN-US>setLayout(&nbsp;) · 713</span></p>

<p class=MsoIndex1><span lang=EN-US>setMnemonic(&nbsp;) · 765</span></p>

<p class=MsoIndex1><span lang=EN-US>setOut(PrintStream) · 604</span></p>

<p class=MsoIndex1><span lang=EN-US>setPriority(&nbsp;) · 878</span></p>

<p class=MsoIndex1><span lang=EN-US>setToolTipText(&nbsp;) · 740</span></p>

<p class=MsoIndex1><span lang=EN-US>shallow copy · 1019, 1027</span></p>

<p class=MsoIndex1><span lang=EN-US>shape: example · 39, 316; example, and
run-time type identification · 659</span></p>

<p class=MsoIndex1><span lang=EN-US>shift operators · 147</span></p>

<p class=MsoIndex1><span lang=EN-US>short-circuit, and logical operators · 144</span></p>

<p class=MsoIndex1><span lang=EN-US>shortcut, keyboard · 765</span></p>

<p class=MsoIndex1><span lang=EN-US>show(&nbsp;) · 773</span></p>

<p class=MsoIndex1><span lang=EN-US>showDocument(&nbsp;) · 924</span></p>

<p class=MsoIndex1><span lang=EN-US>shuffle(&nbsp;) · 512</span></p>

<p class=MsoIndex1><span lang=EN-US>side effect · 133, 141, 202, 1016</span></p>

<p class=MsoIndex1><span lang=EN-US>sign extension · 147</span></p>

<p class=MsoIndex1><span lang=EN-US>signed two’s complement · 151</span></p>

<p class=MsoIndex1><span lang=EN-US>Simula programming language · 32</span></p>

<p class=MsoIndex1><span lang=EN-US>Simula-67 · 262</span></p>

<p class=MsoIndex1><span lang=EN-US>sine wave · 768</span></p>

<p class=MsoIndex1><span lang=EN-US>singleton: design pattern · 266</span></p>

<p class=MsoIndex1><span lang=EN-US>size(&nbsp;), ArrayList · 451</span></p>

<p class=MsoIndex1><span lang=EN-US>Size, of a HashMap or HashSet · 491</span></p>

<p class=MsoIndex1><span lang=EN-US>sizeof(&nbsp;): lack of in Java · 158</span></p>

<p class=MsoIndex1><span lang=EN-US>skeleton, RMI · 978</span></p>

<p class=MsoIndex1><span lang=EN-US>sleep(&nbsp;) · 827, 846, 860, 862</span></p>

<p class=MsoIndex1><span lang=EN-US>slider · 780</span></p>

<p class=MsoIndex1><span lang=EN-US>Smalltalk · 31, 207</span></p>

<p class=MsoIndex1><span lang=EN-US>Socket · 915</span></p>

<p class=MsoIndex1><span lang=EN-US>sockets, stream-based · 923</span></p>

<p class=MsoIndex1><span lang=EN-US>SoftReference · 495</span></p>

<p class=MsoIndex1><span lang=EN-US>software: development methodology · 72</span></p>

<p class=MsoIndex1><span lang=EN-US>Software Development Conference · 10</span></p>

<p class=MsoIndex1><span lang=EN-US>solution space · 30</span></p>

<p class=MsoIndex1><span lang=EN-US>sorting · 431; and searching Lists · 511</span></p>

<p class=MsoIndex1><span lang=EN-US>source code copyright notice · 20</span></p>

<p class=MsoIndex1><span lang=EN-US>South, BorderLayout · 713</span></p>

<p class=MsoIndex1><span lang=EN-US>space: problem · 30; solution · 30</span></p>

<p class=MsoIndex1><span lang=EN-US>specialization · 289</span></p>

<p class=MsoIndex1><span lang=EN-US>specification: system specification · 75</span></p>

<p class=MsoIndex1><span lang=EN-US>specification, exception · 542</span></p>

<p class=MsoIndex1><span lang=EN-US>specifier: access specifiers · 36, 243, 255</span></p>

<p class=MsoIndex1><span lang=EN-US>SQL: stored procedures · 935; Structured
Query Language · 927</span></p>

<p class=MsoIndex1><span lang=EN-US>Stack</span><span lang=EN-US> · 471, 521</span></p>

<p class=MsoIndex1><span lang=EN-US>standard input: Reading from standard input
· 602</span></p>

<p class=MsoIndex1><span lang=EN-US>standards: coding standards · 22, 1077</span></p>

<p class=MsoIndex1><span lang=EN-US>startup costs · 95</span></p>

<p class=MsoIndex1><span lang=EN-US>stateChanged(&nbsp;) · 771</span></p>

<p class=MsoIndex1><span lang=EN-US>statement: mission · 75</span></p>

<p class=MsoIndex1><span lang=EN-US>Statement · 930</span></p>

<p class=MsoIndex1><span lang=EN-US>static · 350; and final · 294; block · 228;
clause · 664; construction clause · 228; data initialization · 225; final
static primitives · 296; initialization · 306; inner classes · 379; keyword ·
206; method · 206; synchronized static · 848</span></p>

<p class=MsoIndex1><span lang=EN-US>STL: C++ · 440</span></p>

<p class=MsoIndex1><span lang=EN-US>stop(&nbsp;): and deadlocks · 873;
deprecation in Java 2 · 873</span></p>

<p class=MsoIndex1><span lang=EN-US>stored procedures in SQL · 935</span></p>

<p class=MsoIndex1><span lang=EN-US>stream, I/O · 581</span></p>

<p class=MsoIndex1><span lang=EN-US>stream-based sockets · 923</span></p>

<p class=MsoIndex1><span lang=EN-US>StreamTokenizer · 591, 639, 653, 682</span></p>

<p class=MsoIndex1><span lang=EN-US>String: automatic type conversion · 454;
class methods · 1052; concatenation with operator + · 153; immutability · 1052;
indexOf(&nbsp;) · 576, 681; lexicographic vs. alphabetic sorting · 436; methods
· 1056; operator + · 454; Operator + · 153; operator + and += overloading ·
277; toString(&nbsp;) · 272, 452</span></p>

<p class=MsoIndex1><span lang=EN-US>StringBuffer · 582; methods · 1058</span></p>

<p class=MsoIndex1><span lang=EN-US>StringBufferInputStream · 582</span></p>

<p class=MsoIndex1><span lang=EN-US>StringReader · 590, 597</span></p>

<p class=MsoIndex1><span lang=EN-US>StringSelection · 792</span></p>

<p class=MsoIndex1><span lang=EN-US>StringTokenizer · 642</span></p>

<p class=MsoIndex1><span lang=EN-US>StringWriter · 590</span></p>

<p class=MsoIndex1><span lang=EN-US>struts, in BoxLayout · 717</span></p>

<p class=MsoIndex1><span lang=EN-US>stub, RMI · 978</span></p>

<p class=MsoIndex1><span lang=EN-US>style of creating classes · 262</span></p>

<p class=MsoIndex1><span lang=EN-US>subobject · 278, 288</span></p>

<p class=MsoIndex1><span lang=EN-US>substitutability, in OOP · 31</span></p>

<p class=MsoIndex1><span lang=EN-US>substitution: principle · 42</span></p>

<p class=MsoIndex1><span lang=EN-US>subtraction · 137</span></p>

<p class=MsoIndex1><span lang=EN-US>super · 280; and finalize(&nbsp;) · 335;
and inner classes · 385</span></p>

<p class=MsoIndex1><span lang=EN-US>super keyword · 278</span></p>

<p class=MsoIndex1><span lang=EN-US>super.clone(&nbsp;) · 1021, 1025, 1041</span></p>

<p class=MsoIndex1><span lang=EN-US>superclass · 278</span></p>

<p class=MsoIndex1><span lang=EN-US>suspend(&nbsp;) · 860, 864; and deadlocks ·
873; deprecation in Java 2 · 875</span></p>

<p class=MsoIndex1><span lang=EN-US>Swing · 689</span></p>

<p class=MsoIndex1><span lang=EN-US>Swing component examples · 734</span></p>

<p class=MsoIndex1><span lang=EN-US>Swing components, using HTML with · 779</span></p>

<p class=MsoIndex1><span lang=EN-US>Swing event model · 722, 794</span></p>

<p class=MsoIndex1><span lang=EN-US>switch keyword · 183</span></p>

<p class=MsoIndex1><span lang=EN-US>synchronized</span><span lang=EN-US> · 59,
848; and inheritance · 858; and wait(&nbsp;) &amp; notify(&nbsp;) · 866;
containers · 514; deciding what methods to synchronize · 858; efficiency · 853;
method, and blocking · 860; static · 848; synchronized block · 852</span></p>

<p class=MsoIndex1><span lang=EN-US>system clipboard · 790</span></p>

<p class=MsoIndex1><span lang=EN-US>system specification · 75</span></p>

<p class=MsoIndex1><span lang=EN-US>System.arraycopy(&nbsp;) · 429</span></p>

<p class=MsoIndex1><span lang=EN-US>System.err · 538, 602</span></p>

<p class=MsoIndex1><span lang=EN-US>System.gc(&nbsp;)</span><span lang=EN-US> ·
213</span></p>

<p class=MsoIndex1><span lang=EN-US>System.in · 597, 602</span></p>

<p class=MsoIndex1><span lang=EN-US>System.out · 602</span></p>

<p class=MsoIndex1><span lang=EN-US>System.out.println(&nbsp;) · 458</span></p>

<p class=MsoIndex1><span lang=EN-US>System.runFinalization(&nbsp;) · 213</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>T</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>tabbed dialog · 755</span></p>

<p class=MsoIndex1><span lang=EN-US>table · 784</span></p>

<p class=MsoIndex1><span lang=EN-US>table-driven code, and anonymous inner classes
· 502</span></p>

<p class=MsoIndex1><span lang=EN-US>TCP, Transmission Control Protocol · 923</span></p>

<p class=MsoIndex1><span lang=EN-US>TCP/IP, and RMI · 977</span></p>

<p class=MsoIndex1><span lang=EN-US>template: in C++ · 455</span></p>

<p class=MsoIndex1><span lang=EN-US>termination vs. resumption, exception
handling · 536</span></p>

<p class=MsoIndex1><span lang=EN-US>ternary operator · 151</span></p>

<p class=MsoIndex1><span lang=EN-US>testing: automated · 89; Extreme
Programming (XP) · 88; unit testing · 277</span></p>

<p class=MsoIndex1><span lang=EN-US>testing techniques · 381</span></p>

<p class=MsoIndex1><span lang=EN-US>this keyword · 203</span></p>

<p class=MsoIndex1><span lang=EN-US>Thread · 825, 827; and JavaBeans · 854; and
Runnable · 891; blocked · 859; combined with main class · 834; daemon threads ·
840; dead · 859; deadlock · 872; deciding what methods to synchronize · 858;
destroy(&nbsp;) · 877; drawbacks · 899; getPriority(&nbsp;) · 878; I/O and
threads, blocking · 860; interrupt(&nbsp;) · 873; isDaemon(&nbsp;) · 840; new
Thread · 859; notify(&nbsp;) · 860; notifyAll(&nbsp;) · 860; order of execution
of threads · 831; priority · 877; properly suspending &amp; resuming · 874;
resume(&nbsp;) · 860, 864; resume(&nbsp;) , deprecation in Java 2 · 875;
resume(&nbsp;), and deadlocks · 873; run(&nbsp;) · 829; Runnable · 859;
Runnable interface · 836; setDaemon(&nbsp;) · 840; setPriority(&nbsp;) · 878;
sharing limited resources · 842; sleep(&nbsp;) · 846, 860, 862; start(&nbsp;) ·
830; states · 859; stop(&nbsp;) , deprecation in Java 2 · 873; stop(&nbsp;),
and deadlocks · 873; stopping · 873; suspend(&nbsp;) · 860, 864;
suspend(&nbsp;) , deprecation in Java 2 · 875; suspend(&nbsp;), and deadlocks ·
873; synchronized method and blocking · 860; thread group · 882; thread group,
default priority · 882; threads and efficiency · 828; wait(&nbsp;) · 860, 866;
when they can be suspended · 847; when to use threads · 899; yield(&nbsp;) ·
860</span></p>

<p class=MsoIndex1><span lang=EN-US>throw keyword · 534</span></p>

<p class=MsoIndex1><span lang=EN-US>Throwable · 547; base class for Exception ·
543</span></p>

<p class=MsoIndex1><span lang=EN-US>throwing an exception · 533</span></p>

<p class=MsoIndex1><span lang=EN-US>time-critical code sections · 1065</span></p>

<p class=MsoIndex1><span lang=EN-US>toArray(&nbsp;) · 511</span></p>

<p class=MsoIndex1><span lang=EN-US>token · 639</span></p>

<p class=MsoIndex1><span lang=EN-US>Tokenizing · 639</span></p>

<p class=MsoIndex1><span lang=EN-US>Tomcat, standard servlet container · 960</span></p>

<p class=MsoIndex1><span lang=EN-US>tool tips · 740</span></p>

<p class=MsoIndex1><span lang=EN-US>TooManyListenersException · 796, 814</span></p>

<p class=MsoIndex1><span lang=EN-US>toString(&nbsp;) · 272, 452, 458, 500</span></p>

<p class=MsoIndex1><span lang=EN-US>training · 93; and mentoring · 95, 96</span></p>

<p class=MsoIndex1><span lang=EN-US>training seminars provided by Bruce Eckel ·
23</span></p>

<p class=MsoIndex1><span lang=EN-US>Transferable · 792</span></p>

<p class=MsoIndex1><span lang=EN-US>transient keyword · 624</span></p>

<p class=MsoIndex1><span lang=EN-US>translation unit · 245</span></p>

<p class=MsoIndex1><span lang=EN-US>Transmission Control Protocol (TCP) · 923</span></p>

<p class=MsoIndex1><span lang=EN-US>tree · 781</span></p>

<p class=MsoIndex1><span lang=EN-US>TreeMap · 476, 510, 642</span></p>

<p class=MsoIndex1><span lang=EN-US>TreeSet · 473, 506</span></p>

<p class=MsoIndex1><span lang=EN-US>true · 143</span></p>

<p class=MsoIndex1><span lang=EN-US>try · 286, 554; try block in exceptions ·
535</span></p>

<p class=MsoIndex1><span lang=EN-US>two’s complement, signed · 151</span></p>

<p class=MsoIndex1><span lang=EN-US>type: base · 39; data type equivalence to
class · 33; derived · 39; finding exact type of a base reference · 662;
parameterized type · 455; primitive · 105; primitive data types and use with
operators · 159; type checking and arrays · 408; type safety in Java · 154;
type-safe downcast in run-time type identification · 665; weak typing · 45</span></p>

<p class=MsoIndex1><span lang=EN-US>TYPE field, for primitive class literals ·
665</span></p>

<p class=MsoIndex1><span lang=EN-US>type safe sets of constants · 361</span></p>

<p class=MsoIndex1><span lang=EN-US>type-conscious ArrayList · 454</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>U</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>UDP, User Datagram Protocol · 923</span></p>

<p class=MsoIndex1><span lang=EN-US>UML · 81; indicating composition · 37;
Unified Modeling Language · 35, 1093</span></p>

<p class=MsoIndex1><span lang=EN-US>unary: minus (-) · 139; operator · 146;
operators · 139; plus (+) · 139</span></p>

<p class=MsoIndex1><span lang=EN-US>unbind(&nbsp;) · 978</span></p>

<p class=MsoIndex1><span lang=EN-US>unicast · 814; unicast events · 796</span></p>

<p class=MsoIndex1><span lang=EN-US>UnicastRemoteObject · 974</span></p>

<p class=MsoIndex1><span lang=EN-US>Unicode · 590</span></p>

<p class=MsoIndex1><span lang=EN-US>Unified Modeling Language (UML) · 35, 1093</span></p>

<p class=MsoIndex1><span lang=EN-US>unit testing · 277</span></p>

<p class=MsoIndex1><span lang=EN-US>unmodifiable, making a Collection or Map
unmodifiable · 513</span></p>

<p class=MsoIndex1><span lang=EN-US>unsupported methods, in the Java 2
containers · 516</span></p>

<p class=MsoIndex1><span lang=EN-US>UnsupportedOperationException · 516</span></p>

<p class=MsoIndex1><span lang=EN-US>upcasting · 47, 291, 312, 660; and interface
· 353; inner classes and upcasting · 368</span></p>

<p class=MsoIndex1><span lang=EN-US>updates of the book · 22</span></p>

<p class=MsoIndex1><span lang=EN-US>URL · 925</span></p>

<p class=MsoIndex1><span lang=EN-US>use case · 76; iteration · 84; scope · 84</span></p>

<p class=MsoIndex1><span lang=EN-US>User Datagram Protocol (UDP) · 923</span></p>

<p class=MsoIndex1><span lang=EN-US>user interface · 78; and threads, for
responsiveness · 831; responsive, with threading · 826</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>V</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>value: preventing change at run-time · 294</span></p>

<p class=MsoIndex1><span lang=EN-US>value, HTML keyword · 839</span></p>

<p class=MsoIndex1><span lang=EN-US>variable: defining a variable · 174;
initialization of method variables · 220; variable argument lists (unknown
quantity and type of arguments) · 235</span></p>

<p class=MsoIndex1><span lang=EN-US>vector: of change · 86</span></p>

<p class=MsoIndex1><span lang=EN-US>Vector · 505, 519, 521</span></p>

<p class=MsoIndex1><span lang=EN-US>vector of change · 397</span></p>

<p class=MsoIndex1><span lang=EN-US>versioning, serialization · 630</span></p>

<p class=MsoIndex1><span lang=EN-US>versions of Java · 22</span></p>

<p class=MsoIndex1><span lang=EN-US>visibility, package visibility, (friendly)
· 368</span></p>

<p class=MsoIndex1><span lang=EN-US>visual: programming · 800</span></p>

<p class=MsoIndex1><span lang=EN-US>Visual Basic, Microsoft · 800</span></p>

<p class=MsoIndex1><span lang=EN-US>visual programming environments · 690</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>W</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>wait(&nbsp;) · 860, 866</span></p>

<p class=MsoIndex1><span lang=EN-US>Waldrop, M. Mitchell · 1095</span></p>

<p class=MsoIndex1><span lang=EN-US>weak: weakly typed language · 45</span></p>

<p class=MsoIndex1><span lang=EN-US>WeakHashMap · 498</span></p>

<p class=MsoIndex1><span lang=EN-US>WeakReference · 495</span></p>

<p class=MsoIndex1><span lang=EN-US>Web: displaying a Web page from within an
applet · 923; placing an applet inside a Web page · 695; safety, and applet
restrictions · 692</span></p>

<p class=MsoIndex1><span lang=EN-US>web of objects · 614, 1020</span></p>

<p class=MsoIndex1><span lang=EN-US>West, BorderLayout · 713</span></p>

<p class=MsoIndex1><span lang=EN-US>while · 172</span></p>

<p class=MsoIndex1><span lang=EN-US>widening conversion · 155</span></p>

<p class=MsoIndex1><span lang=EN-US>wild-card · 73</span></p>

<p class=MsoIndex1><span lang=EN-US>WindowAdapter · 704</span></p>

<p class=MsoIndex1><span lang=EN-US>windowClosing(&nbsp;) · 704, 771</span></p>

<p class=MsoIndex1><span lang=EN-US>windowed applications · 700</span></p>

<p class=MsoIndex1><span lang=EN-US>Windows Explorer, running Java programs
from · 705</span></p>

<p class=MsoIndex1><span lang=EN-US>wrapper, dealing with the immutability of
primitive wrapper classes · 1047</span></p>

<p class=MsoIndex1><span lang=EN-US>write(&nbsp;) · 581</span></p>

<p class=MsoIndex1><span lang=EN-US>writeBytes(&nbsp;) · 600</span></p>

<p class=MsoIndex1><span lang=EN-US>writeChars(&nbsp;) · 600</span></p>

<p class=MsoIndex1><span lang=EN-US>writeDouble(&nbsp;) · 600</span></p>

<p class=MsoIndex1><span lang=EN-US>writeExternal(&nbsp;) · 620</span></p>

<p class=MsoIndex1><span lang=EN-US>writeObject(&nbsp;) · 614; with
Serializable · 627</span></p>

<p class=MsoIndex1><span lang=EN-US>Writer · 581, 589, 590, 869, 913</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>X</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>XOR · 146</span></p>

<p class=MsoIndex1><span lang=EN-US>XP, Extreme Programming · 88</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>Y</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>yield(&nbsp;) · 860</span></p>

<div style='border:none;border-top:solid windowtext 1.5pt;padding:0cm 0cm 0cm 0cm;
margin-left:18.0pt;margin-right:0cm'>

<p class=MsoIndexHeading style='margin-left:0cm;page-break-after:avoid'><span
lang=EN-US>Z</span></p>

</div>

<p class=MsoIndex1><span lang=EN-US>zero extension · 147</span></p>

<p class=MsoIndex1><span lang=EN-US>ZipEntry · 610</span></p>

<p class=MsoIndex1><span lang=EN-US>ZipInputStream · 606</span></p>

<p class=MsoIndex1><span lang=EN-US>ZipOutputStream · 606</span></p>

</div>

<span lang=EN-US style='font-size:14.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:auto'>
</span>

<div class=WordSection29>

<p class=Intro><span lang=EN-US>&nbsp;</span></p>

<span lang=EN-US style='font-size:14.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=Intro><span style='position:relative;z-index:251658752;left:-18px;
top:0px;width:517px;height:1px'><img width=517 height=1
src="TIJ2_files/image033.jpg"></span><br clear=ALL>
</p>

<p class=MsoNormal>

<table cellpadding=0 cellspacing=0 align=left>
 <tr>
  <td width=132 height=0></td>
 </tr>
 <tr>
  <td></td>
  <td><img width=548 height=4 src="TIJ2_files/image034.png"
  alt="Text Box: Check www.BruceEckel.com &#13;&#10;for in-depth details &#13;&#10;and the date and location &#13;&#10;of the next &#13;&#10;Hands-On Java Seminar&#13;&#10;	Based on this book&#13;&#10;	Taught by Bruce Eckel&#13;&#10;	Personal attention from Bruce Eckel &#13;&#10;and his seminar assistants&#13;&#10;	Includes in-class programming exercises&#13;&#10;	Intermediate/Advanced seminars also offered&#13;&#10;	Hundreds have already enjoyed this seminar—&#13;&#10;see the Web site for their testimonials&#13;&#10;&#13;&#10;"></td>
 </tr>
</table>

<br clear=ALL>
</p>

</div>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:always'>
</span>

<div class=WordSection30>

<p class=MsoNormal>

<table cellpadding=0 cellspacing=0 align=left>
 <tr>
  <td width=6 height=0></td>
 </tr>
 <tr>
  <td></td>
  <td><img width=728 height=4 src="TIJ2_files/image035.png"></td>
 </tr>
</table>

<br clear=ALL>
</p>

<p class=LicenseAgreement><span lang=EN-US>End-User License Agreement for
Microsoft Software</span></p>

<p class=LicenseAgreement><span lang=EN-US>&nbsp;</span></p>

<p class=LicenseAgreement><span lang=EN-US>IMPORTANT-READ CAREFULLY: This
Microsoft End-User License Agreement (&quot;EULA&quot;) is a legal agreement
between you (either an individual or a single entity) and Microsoft Corporation
for the Microsoft software product included in this package, which includes
computer software and may include associated media, printed materials, and
&quot;online&quot; or electronic documentation (&quot;SOFTWARE PRODUCT&quot;).
The SOFTWARE PRODUCT also includes any updates and supplements to the original
SOFTWARE PRODUCT provided to you by Microsoft. By installing, copying,
downloading, accessing or otherwise using the SOFTWARE PRODUCT, you agree to be
bound by the terms of this EULA. If you do not agree to the terms of this EULA,
do not install, copy, or otherwise use the SOFTWARE PRODUCT.</span></p>

<p class=LicenseAgreement><span lang=EN-US>&nbsp;</span></p>

<p class=LicenseAgreement><span lang=EN-US>SOFTWARE PRODUCT LICENSE</span></p>

<p class=LicenseAgreement><span lang=EN-US>&nbsp;</span></p>

<p class=LicenseAgreement><span lang=EN-US>The SOFTWARE PRODUCT is protected by
copyright laws and international copyright treaties, as well as other
intellectual property laws and treaties. The SOFTWARE PRODUCT is licensed, not
sold. </span></p>

<p class=LicenseAgreement><span lang=EN-US>1. GRANT OF LICENSE. This EULA
grants you the following rights:</span></p>

<p class=LicenseAgreement><span lang=EN-US>1.1 License Grant. Microsoft grants
to you as an individual, a personal nonexclusive license to make and use copies
of the SOFTWARE PRODUCT for the sole purposes of evaluating and learning how to
use the SOFTWARE PRODUCT, as may be instructed in accompanying publications or
documentation. You may install the software on an unlimited number of computers
provided that you are the only individual using the SOFTWARE PRODUCT. </span></p>

<p class=LicenseAgreement><span lang=EN-US>1.2 Academic Use. You must be a
&quot;Qualified Educational User&quot; to use the SOFTWARE PRODUCT in the
manner described in this section. To determine whether you are a Qualified Educational
User, please contact the Microsoft Sales Information Center/One Microsoft
Way/Redmond, WA 98052-6399 or the Microsoft subsidiary serving your country. If
you are a Qualified Educational User, you may either:</span></p>

<p class=LicenseAgreement><span lang=EN-US>(i) exercise the rights granted in
Section 1.1, OR </span></p>

<p class=LicenseAgreement><span lang=EN-US>(ii) if you intend to use the
SOFTWARE PRODUCT solely for instructional purposes in connection with a class
or other educational program, this EULA grants you the following alternative
license models: </span></p>

<p class=LicenseAgreement><span lang=EN-US>(A) Per Computer Model. For every
valid license you have acquired for the SOFTWARE PRODUCT, you may install a
single copy of the SOFTWARE PRODUCT on a single computer for access and use by
an unlimited number of student end users at your educational institution,
provided that all such end users comply with all other terms of this EULA, OR </span></p>

<p class=LicenseAgreement><span lang=EN-US>(B) Per License Model. If you have
multiple licenses for the SOFTWARE PRODUCT, then at any time you may have as
many copies of the SOFTWARE PRODUCT in use as you have licenses, provided that
such use is limited to student or faculty end users at your educational
institution and provided that all such end users comply with all other terms of
this EULA. For purposes of this subsection, the SOFTWARE PRODUCT is &quot;in
use&quot; on a computer when it is loaded into the temporary memory (i.e., RAM)
or installed into the permanent memory (e.g., hard disk, CD ROM, or other
storage device) of that computer, except that a copy installed on a network
server for the sole purpose of distribution to other computers is not &quot;in
use&quot;. If the anticipated number of users of the SOFTWARE PRODUCT will
exceed the number of applicable licenses, then you must have a reasonable
mechanism or process in place to ensure that the number of persons using the
SOFTWARE PRODUCT concurrently does not exceed the number of licenses.</span></p>

<p class=LicenseAgreement><span lang=EN-US>2. DESCRIPTION OF OTHER RIGHTS AND
LIMITATIONS. </span></p>

<p class=LicenseAgreement><span lang=EN-US>• Limitations on Reverse
Engineering, Decompilation, and Disassembly. You may not reverse engineer,
decompile, or disassemble the SOFTWARE PRODUCT, except and only to the extent
that such activity is expressly permitted by applicable law notwithstanding
this limitation.</span></p>

<p class=LicenseAgreement><span lang=EN-US>• Separation of Components. The
SOFTWARE PRODUCT is licensed as a single product. Its component parts may not
be separated for use on more than one computer.</span></p>

<p class=LicenseAgreement><span lang=EN-US>• Rental. You may not rent, lease or
lend the SOFTWARE PRODUCT.</span></p>

<p class=LicenseAgreement><span lang=EN-US>• Trademarks. This EULA does not
grant you any rights in connection with any trademarks or service marks of
Microsoft.</span></p>

<p class=LicenseAgreement><span lang=EN-US>• Software Transfer. The initial
user of the SOFTWARE PRODUCT may make a one-time permanent transfer of this
EULA and SOFTWARE PRODUCT only directly to an end user. This transfer must
include all of the SOFTWARE PRODUCT (including all component parts, the media
and printed materials, any upgrades, this EULA, and, if applicable, the Certificate
of Authenticity). Such transfer may not be by way of consignment or any other
indirect transfer. The transferee of such one-time transfer must agree to
comply with the terms of this EULA, including the obligation not to further
transfer this EULA and SOFTWARE PRODUCT.</span></p>

<p class=LicenseAgreement><span lang=EN-US>• No Support. Microsoft shall have
no obligation to provide any product support for the SOFTWARE PRODUCT.</span></p>

<p class=LicenseAgreement><span lang=EN-US>• Termination. Without prejudice to
any other rights, Microsoft may terminate this EULA if you fail to comply with
the terms and conditions of this EULA. In such event, you must destroy all
copies of the SOFTWARE PRODUCT and all of its component parts.</span></p>

<p class=LicenseAgreement><span lang=EN-US>3. COPYRIGHT. All title and
intellectual property rights in and to the SOFTWARE PRODUCT (including but not
limited to any images, photographs, animations, video, audio, music, text, and
&quot;applets&quot; incorporated into the SOFTWARE PRODUCT), the accompanying
printed materials, and any copies of the SOFTWARE PRODUCT are owned by
Microsoft or its suppliers. All title and intellectual property rights in and
to the content which may be accessed through use of the SOFTWARE PRODUCT is the
property of the respective content owner and may be protected by applicable
copyright or other intellectual property laws and treaties. This EULA grants
you no rights to use such content. All rights not expressly granted are
reserved by Microsoft.</span></p>

<p class=LicenseAgreement><span lang=EN-US>4. BACKUP COPY. After installation
of one copy of the SOFTWARE PRODUCT pursuant to this EULA, you may keep the
original media on which the SOFTWARE PRODUCT was provided by Microsoft solely
for backup or archival purposes. If the original media is required to use the
SOFTWARE PRODUCT on the COMPUTER, you may make one copy of the SOFTWARE PRODUCT
solely for backup or archival purposes. Except as expressly provided in this
EULA, you may not otherwise make copies of the SOFTWARE PRODUCT or the printed
materials accompanying the SOFTWARE PRODUCT.</span></p>

<p class=LicenseAgreement><span lang=EN-US>5. U.S. GOVERNMENT RESTRICTED
RIGHTS. The SOFTWARE PRODUCT and documentation are provided with RESTRICTED
RIGHTS. Use, duplication, or disclosure by the Government is subject to
restrictions as set forth in subparagraph (c)(1)(ii) of the Rights in Technical
Data and Computer Software clause at DFARS 252.227-7013 or subparagraphs (c)(1)
and (2) of the Commercial Computer Software-Restricted Rights at 48 CFR
52.227-19, as applicable. Manufacturer is Microsoft Corporation/One Microsoft
Way/Redmond, WA 98052-6399.</span></p>

<p class=LicenseAgreement><span lang=EN-US>6. EXPORT RESTRICTIONS. You agree
that you will not export or re-export the SOFTWARE PRODUCT, any part thereof,
or any process or service that is the direct product of the SOFTWARE PRODUCT
(the foregoing collectively referred to as the &quot;Restricted
Components&quot;), to any country, person, entity or end user subject to U.S.
export restrictions. You specifically agree not to export or re-export any of
the Restricted Components (i) to any country to which the U.S. has embargoed or
restricted the export of goods or services, which currently include, but are
not necessarily limited to Cuba, Iran, Iraq, Libya, North Korea, Sudan and
Syria, or to any national of any such country, wherever located, who intends to
transmit or transport the Restricted Components back to such country; (ii) to
any end-user who you know or have reason to know will utilize the Restricted
Components in the design, development or production of nuclear, chemical or
biological weapons; or (iii) to any end-user who has been prohibited from
participating in U.S. export transactions by any federal agency of the U.S.
government. You warrant and represent that neither the BXA nor any other U.S.
federal agency has suspended, revoked, or denied your export privileges.</span></p>

<p class=LicenseAgreement><span lang=EN-US>7. NOTE ON JAVA SUPPORT. THE
SOFTWARE PRODUCT MAY CONTAIN SUPPORT FOR PROGRAMS WRITTEN IN JAVA. JAVA
TECHNOLOGY IS NOT FAULT TOLERANT AND IS NOT DESIGNED, MANUFACTURED, OR INTENDED
FOR USE OR RESALE AS ON-LINE CONTROL EQUIPMENT IN HAZARDOUS ENVIRONMENTS
REQUIRING FAIL-SAFE PERFORMANCE, SUCH AS IN THE OPERATION OF NUCLEAR
FACILITIES, AIRCRAFT NAVIGATION OR COMMUNICATION SYSTEMS, AIR TRAFFIC CONTROL,
DIRECT LIFE SUPPORT MACHINES, OR WEAPONS SYSTEMS, IN WHICH THE FAILURE OF JAVA
TECHNOLOGY COULD LEAD DIRECTLY TO DEATH, PERSONAL INJURY, OR SEVERE PHYSICAL OR
ENVIRONMENTAL DAMAGE.</span></p>

<p class=LicenseAgreement><span lang=EN-US>&nbsp;</span></p>

<p class=LicenseAgreement><span lang=EN-US>MISCELLANEOUS</span></p>

<p class=LicenseAgreement><span lang=EN-US>&nbsp;</span></p>

<p class=LicenseAgreement><span lang=EN-US>If you acquired this product in the
United States, this EULA is governed by the laws of the State of Washington. </span></p>

<p class=LicenseAgreement><span lang=EN-US>If you acquired this product in
Canada, this EULA is governed by the laws of the Province of Ontario, Canada.
Each of the parties hereto irrevocably attorns to the jurisdiction of the
courts of the Province of Ontario and further agrees to commence any litigation
which may arise hereunder in the courts located in the Judicial District of
York, Province of Ontario. </span></p>

<p class=LicenseAgreement><span lang=EN-US>If this product was acquired outside
the United States, then local law may apply.</span></p>

<p class=LicenseAgreement><span lang=EN-US>Should you have any questions
concerning this EULA, or if you desire to contact Microsoft for any reason,
please contact </span></p>

<p class=LicenseAgreement><span lang=EN-US>Microsoft, or write: Microsoft Sales
Information Center/One Microsoft Way/Redmond, WA 98052-6399. </span></p>

<p class=LicenseAgreement><span lang=EN-US>&nbsp;</span></p>

<p class=LicenseAgreement><span lang=EN-US>LIMITED WARRANTY</span></p>

<p class=LicenseAgreement><span lang=EN-US>&nbsp;</span></p>

<p class=LicenseAgreement><span lang=EN-US>LIMITED WARRANTY. Microsoft warrants
that (a) the SOFTWARE PRODUCT will perform substantially in accordance with the
accompanying written materials for a period of ninety (90) days from the date
of receipt, and (b) any Support Services provided by Microsoft shall be
substantially as described in applicable written materials provided to you by
Microsoft, and Microsoft support engineers will make commercially reasonable
efforts to solve any problem. To the extent allowed by applicable law, implied
warranties on the SOFTWARE PRODUCT, if any, are limited to ninety (90) days.
Some states/jurisdictions do not allow limitations on duration of an implied
warranty, so the above limitation may not apply to you.</span></p>

<p class=LicenseAgreement><span lang=EN-US>CUSTOMER REMEDIES. Microsoft's and
its suppliers' entire liability and your exclusive remedy shall be, at
Microsoft's option, either (a) return of the price paid, if any, or (b) repair
or replacement of the SOFTWARE PRODUCT that does not meet Microsoft's Limited
Warranty and that is returned to Microsoft with a copy of your receipt. This
Limited Warranty is void if failure of the SOFTWARE PRODUCT has resulted from
accident, abuse, or misapplication. Any replacement SOFTWARE PRODUCT will be
warranted for the remainder of the original warranty period or thirty (30)
days, whichever is longer. Outside the United States, neither these remedies
nor any product support services offered by Microsoft are available without
proof of purchase from an authorized international source.</span></p>

<p class=LicenseAgreement><span lang=EN-US>NO OTHER WARRANTIES. TO THE MAXIMUM
EXTENT PERMITTED BY APPLICABLE LAW, MICROSOFT AND ITS SUPPLIERS DISCLAIM ALL
OTHER WARRANTIES AND CONDITIONS, EITHER EXPRESS OR IMPLIED, INCLUDING, BUT NOT
LIMITED TO, IMPLIED WARRANTIES OR CONDITIONS OF MERCHANTABILITY, FITNESS FOR A
PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT, WITH REGARD TO THE SOFTWARE
PRODUCT, AND THE PROVISION OF OR FAILURE TO PROVIDE SUPPORT SERVICES. THIS
LIMITED WARRANTY GIVES YOU SPECIFIC LEGAL RIGHTS. YOU MAY HAVE OTHERS, WHICH
VARY FROM STATE/JURISDICTION TO STATE/JURISDICTION.</span></p>

<p class=LicenseAgreement><span lang=EN-US>LIMITATION OF LIABILITY. TO THE
MAXIMUM EXTENT PERMITTED BY APPLICABLE LAW, IN NO EVENT SHALL MICROSOFT OR ITS
SUPPLIERS BE LIABLE FOR ANY SPECIAL, INCIDENTAL, INDIRECT, OR CONSEQUENTIAL
DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF BUSINESS
PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY OTHER
PECUNIARY LOSS) ARISING OUT OF THE USE OF OR INABILITY TO USE THE SOFTWARE
PRODUCT OR THE FAILURE TO PROVIDE SUPPORT SERVICES, EVEN IF MICROSOFT HAS BEEN
ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. IN ANY CASE, MICROSOFT'S ENTIRE
LIABILITY UNDER ANY PROVISION OF THIS EULA SHALL BE LIMITED TO THE GREATER OF
THE AMOUNT ACTUALLY PAID BY YOU FOR THE SOFTWARE PRODUCT OR U.S.$5.00;
PROVIDED, HOWEVER, IF YOU HAVE ENTERED INTO A MICROSOFT SUPPORT SERVICES
AGREEMENT, MICROSOFT'S ENTIRE LIABILITY REGARDING SUPPORT SERVICES SHALL BE
GOVERNED BY THE TERMS OF THAT AGREEMENT. BECAUSE SOME STATES/JURISDICTIONS DO
NOT ALLOW THE EXCLUSION OR LIMITATION OF LIABILITY, THE ABOVE LIMITATION MAY
NOT APPLY TO YOU.</span></p>

<p class=LicenseAgreement><span lang=EN-US>0495 Part No. 64358</span></p>

</div>

<span lang=EN-US style='font-size:9.0pt;font-family:"Verdana","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<div class=WordSection31>

<p class=LicenseAgreement><span lang=EN-US>LICENSE AGREEMENT FOR MindView,
Inc.'s<br>
Thinking in C: Foundations for Java &amp; C++ CD ROM<br>
by Chuck Allison</span></p>

<p class=LicenseAgreement><span lang=EN-US>This CD is provided together with
the book &quot;Thinking in Java, 2<sup>nd</sup> edition.&quot;<br>
<br>
READ THIS AGREEMENT BEFORE USING THIS &quot;Thinking in C: Foundations for C++
&amp; Java&quot; (Hereafter called &quot;CD&quot;). BY USING THE CD YOU AGREE
TO BE BOUND BY THE TERMS AND CONDITIONS OF THIS AGREEMENT. IF YOU DO NOT AGREE
TO THE TERMS AND CONDITIONS OF THIS AGREEMENT, IMMEDIATELY RETURN THE UNUSED CD
FOR A FULL REFUND OF MONIES PAID, IF ANY.<br>
<br>
©2000 MindView, Inc. All rights reserved. Printed in the U.S.<br>
<br>
SOFTWARE REQUIREMENTS<br>
The purpose of this CD is to provide the Content, not the associated software
necessary to view the Content. The Content of this CD is in HTML for viewing
with Microsoft Internet Explorer 4 or newer, and uses Microsoft Sound Codecs
available in Microsoft's Windows Media Player for Windows. It is your
responsibility to correctly install the appropriate Microsoft software for your
system. <br>
<br>
The text, images, and other media included on this CD (&quot;Content&quot;) and
their compilation are licensed to you subject to the terms and conditions of
this Agreement by MindView, Inc., having a place of business at 5343 Valle
Vista, La Mesa, CA 91941. Your rights to use other programs and materials
included on the CD are also governed by separate agreements distributed with
those programs and materials on the CD (the &quot;Other Agreements&quot;). In
the event of any inconsistency between this Agreement and the Other Agreements,
this Agreement shall govern. By using this CD, you agree to be bound by the
terms and conditions of this Agreement. MindView, Inc. owns title to the
Content and to all intellectual property rights therein, except insofar as it
contains materials that are proprietary to third-party suppliers. All rights in
the Content except those expressly granted to you in this Agreement are
reserved to MindView, Inc. and such suppliers as their respective interests may
appear.<br>
<br>
1. LIMITED LICENSE<br>
MindView, Inc. grants you a limited, nonexclusive, nontransferable license to
use the Content on a single dedicated computer (excluding network servers).
This Agreement and your rights hereunder shall automatically terminate if you
fail to comply with any provisions of this Agreement or any of the Other Agreements.
Upon such termination, you agree to destroy the CD and all copies of the CD,
whether lawful or not, that are in your possession or under your control. <br>
<br>
2. ADDITIONAL RESTRICTIONS<br>
<br>
a. You shall not (and shall not permit other persons or entities to) directly
or indirectly, by electronic or other means, reproduce (except for archival
purposes as permitted by law), publish, distribute, rent, lease, sell,
sublicense, assign, or otherwise transfer the Content or any part thereof.<br>
<br>
b. You shall not (and shall not permit other persons or entities to) use the
Content or any part thereof for any commercial purpose or merge, modify, create
derivative works of, or translate the Content.<br>
<br>
c. You shall not (and shall not permit other persons or entities to) obscure
MindView's or its suppliers copyright, trademark, or other proprietary notices
or legends from any portion of the Content or any related materials.<br>
<br>
3. PERMISSIONS</span></p>

<p class=LicenseAgreement><span lang=EN-US>a. Except as noted in the Contents
of the CD, you must treat this software just like a book. However, you may copy
it onto a computer to be used and you may make archival copies of the software
for the sole purpose of backing up the software and protecting your investment
from loss. By saying, &quot;just like a book,&quot; MindView, Inc. means, for
example, that this software may be used by any number of people and may be
freely moved from one computer location to another, so long as there is no
possibility of its being used at one location or on one computer while it is
being used at another. Just as a book cannot be read by two different people in
two different places at the same time, neither can the software be used by two
different people in two different places at the same time.</span></p>

<p class=LicenseAgreement><span lang=EN-US>b. You may show or demonstrate the
un-modified Content in a live presentation, live seminar, or live performance
as long as you attribute all material of the Content to MindView, Inc.</span></p>

<p class=LicenseAgreement><span lang=EN-US>c. Other permissions and grants of
rights for use of the CD must be obtained directly from MindView, Inc. at
http://www.MindView.net. (Bulk copies of the CD may also be purchased at this
site.) </span></p>

<p class=LicenseAgreement><span lang=EN-US>DISCLAIMER OF WARRANTY<br>
<br>
The Content and CD are provided &quot;AS IS&quot; without warranty of any kind,
either express or implied, including, without limitation, any warranty of
merchantability and fitness for a particular purpose. The entire risk as to the
results and performance of the CD and Content is assumed by you. MindView, Inc.
and its suppliers assume no responsibility for defects in the CD, the accuracy
of the Content, or omissions in the CD or the Content. MindView, Inc. and its
suppliers do not warrant, guarantee, or make any representations regarding the
use, or the results of the use, of the product in terms of correctness,
accuracy, reliability, currentness, or otherwise, or that the Content will meet
your needs, or that operation of the CD will be uninterrupted or error-free, or
that any defects in the CD or Content will be corrected. MindView, Inc. and its
suppliers shall not be liable for any loss, damages, or costs arising from the
use of the CD or the interpretation of the Content. Some states do not allow
exclusion or limitation of implied warranties or limitation of liability for
incidental or consequential damages, so all of the above limitations or
exclusions may not apply to you.<br>
<br>
In no event shall MindView, Inc. or its suppliers' total liability to you for
all damages, losses, and causes of action (whether in contract, tort, or
otherwise) exceed the amount paid by you for the CD.</span></p>

<p class=LicenseAgreement><span lang=EN-US>MindView, Inc., and Prentice-Hall,
Inc. specifically disclaim the implied warrantees of merchantability and
fitness for a particular purpose. No oral or written information or advice
given by MindView, Inc., Prentice-Hall, Inc., their dealers, distributors,
agents or employees shall create a warrantee. You may have other rights, which
vary from state to state.</span></p>

<p class=LicenseAgreement><span lang=EN-US>Neither MindView, Inc., Bruce Eckel,
Chuck Allison, Prentice-Hall, nor anyone else who has been involved in the
creation, production or delivery of the product shall be liable for any direct,
indirect, consequential, or incidental damages (including damages for loss of
business profits, business interruption, loss of business information, and the
like) arising out of the use of or inability to use the product even if
MindView, Inc., has been advised of the possibility of such damages. Because
some states do not allow the exclusion or limitation of liability for
consequential or incidental damages, the above limitation may not apply to you.</span></p>

<p class=LicenseAgreement><span lang=EN-US>This CD is provided as a supplement
to the book &quot;Thinking in Java 2nd  edition.&quot; The sole responsibility
of Prentice-Hall will be to provide a replacement CD in the event that the one
that came with the book is defective. This replacement warrantee shall be in
effect for a period of sixty days from the purchase date. MindView, Inc. does
not bear any additional responsibility for the CD.</span></p>

<p class=LicenseAgreement><span lang=EN-US>NO TECHNICAL SUPPORT IS PROVIDED
WITH THIS CD ROM</span></p>

<p class=LicenseAgreement><span lang=EN-US>The following are trademarks of
their respective companies in the U.S. and may be protected as trademarks in
other countries: Sun and the Sun Logo, Sun Microsystems, Java, all Java-based
names and logos and the Java Coffee Cup are trademarks of Sun Microsystems;
Internet Explorer, the Windows Media Player, DOS, Windows 95, and Windows NT
are trademarks of Microsoft.</span></p>

<span lang=EN-US style='font-size:11.0pt;font-family:"Georgia","serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
lang=EN-US style='font-size:15.0pt;font-family:"Verdana","sans-serif"'>Thinking
in C: Foundations for Java &amp; C++</span></b></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
lang=EN-US style='font-family:"Verdana","sans-serif"'>Multimedia Seminar-on-CD
ROM </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><span
lang=EN-US>©2000 MindView, Inc. All rights reserved. </span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt'><b><span
lang=EN-US style='font-size:10.0pt'>WARNING: BEFORE OPENING THE DISC PACKAGE,
CAREFULLY READ THE TERMS AND CONDITIONS OF THE LICENSE AGREEMENT &amp; WARANTEE
LIMITATION ON THE PREVIOUS PAGES.</span></b></p>

<p class=MsoNormal style='margin-top:6.0pt;margin-right:0cm;margin-bottom:6.0pt;
margin-left:18.0pt'><span lang=EN-US>The CD ROM packaged with this book is a
multimedia seminar consisting of synchronized slides and audio lectures. The
goal of this seminar is to introduce you to the aspects of C that are necessary
for you to move on to C++ or Java, leaving out the unpleasant parts that C
programmers must deal with on a day-to-day basis but that the C++ and Java
languages steer you away from. The CD also contains this book in HTML form
along with the source code for the book.</span></p>

<p class=MsoNormal><span lang=EN-US>This CD ROM will work with Windows (with a
sound system). However, you must: </span></p>

<p class=MsoList3 style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:36.0pt;margin-bottom:.0001pt'><span lang=EN-US>Install the most
recent version of Microsoft’s Internet Explorer. Because of the features
provided on the CD, it will NOT work with Netscape Navigator. <b>The Internet
Explorer software for Windows 9X/NT is included on the CD.</b></span></p>

<p class=MsoList3 style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:36.0pt;margin-bottom:.0001pt'><span lang=EN-US>Install Microsoft’s <i>Windows
Media Player</i>. <b>The Media Player software for Windows 9X/NT is included on
the CD. </b>You can also go to <b>http://www.microsoft.com/windows/mediaplayer</b>
and follow the instructions or links there to download and install the Media
Player for your particular platform. </span></p>

<p class=MsoList3 style='margin-top:0cm;margin-right:0cm;margin-bottom:0cm;
margin-left:36.0pt;margin-bottom:.0001pt'><span lang=EN-US>At this point you
should be able to play the lectures on the CD. Using the Internet Explorer Web
browser, open the file <b>Install.html</b> that you’ll find on the CD. This
will introduce you to the CD and provide further instructions about the use of
the CD.</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

<div><br clear=all>

<hr align=left size=1 width="33%">

<div id=ftn1>

<p class=MsoFootnoteText><a href="#_ftnref1" name="_ftn1" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[1]</span></span></span></span></a><span lang=EN-US> I take
this back on the 2<sup>nd</sup> edition: I believe that the Python language
comes closest to doing exactly that. See www.Python.org.</span></p>

</div>

<div id=ftn2>

<p class=MsoFootnoteText><a href="#_ftnref2" name="_ftn2" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[2]</span></span></span></span></a><span lang=EN-US> See </span><span lang=EN-US><i>Multiparadigm Programming in Leda</i> by Timothy Budd
(Addison-Wesley 1995).</span></p>

</div>

<div id=ftn3>

<p class=MsoFootnoteText><a href="#_ftnref3" name="_ftn3" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[3]</span></span></span></span></a><span lang=EN-US> Some
people make a distinction, stating that type determines the interface while
class is a particular implementation of that interface.</span></p>

</div>

<div id=ftn4>

<p class=MsoFootnoteText><a href="#_ftnref4" name="_ftn4" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[4]</span></span></span></span></a><span lang=EN-US> I’m
indebted to my friend </span><span lang=EN-US>Scott Meyers for this term.</span></p>

</div>

<div id=ftn5>

<p class=MsoFootnoteText><a href="#_ftnref5" name="_ftn5" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[5]</span></span></span></span></a><span lang=EN-US> This is
usually enough detail for most diagrams, and you don’t need to get specific
about whether you’re using aggregation or composition.</span></p>

</div>

<div id=ftn6>

<p class=MsoFootnoteText><a href="#_ftnref6" name="_ftn6" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[6]</span></span></span></span></a><span lang=EN-US> My
term.</span></p>

</div>

<div id=ftn7>

<p class=MsoFootnoteText><a href="#_ftnref7" name="_ftn7" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[7]</span></span></span></span></a><span lang=EN-US>
Primitive types, which you’ll learn about later, are a special case.</span></p>

</div>

<div id=ftn8>

<p class=MsoFootnoteText><a href="#_ftnref8" name="_ftn8" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[8]</span></span></span></span></a><span lang=EN-US> An
excellent example of this is <i>UML Distilled</i>, 2<sup>nd</sup> edition, by </span><span lang=EN-US>Martin Fowler (Addison-Wesley 2000), which reduces the
sometimes-overwhelming UML process to a manageable subset.</span></p>

</div>

<div id=ftn9>

<p class=MsoFootnoteText><a href="#_ftnref9" name="_ftn9" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[9]</span></span></span></span></a><span lang=EN-US> My rule
of thumb for estimating such projects: If there’s more than one wild card,
don’t even try to plan how long it’s going to take or how much it will cost
until you’ve created a working prototype. There are too many degrees of
freedom.</span></p>

</div>

<div id=ftn10>

<p class=MsoFootnoteText><a href="#_ftnref10" name="_ftn10" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[10]</span></span></span></span></a><span lang=EN-US> Thanks
for help from James H Jarrett.</span></p>

</div>

<div id=ftn11>

<p class=MsoFootnoteText><a href="#_ftnref11" name="_ftn11" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[11]</span></span></span></span></a><span lang=EN-US> More
information on use cases can be found in <i>Applying Use Cases</i> by Schneider
&amp; Winters (Addison-Wesley 1998) and <i>Use Case Driven Object Modeling with
UML</i> by Rosenberg (Addison-Wesley 1999).</span></p>

</div>

<div id=ftn12>

<p class=MsoFootnoteText><a href="#_ftnref12" name="_ftn12" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[12]</span></span></span></span></a><span lang=EN-US> My
personal take on this has changed lately. Doubling and adding 10 percent will
give you a reasonably accurate estimate (assuming there are not too many
wild-card factors), but you still have to work quite diligently to finish in
that time. If you want time to really make it elegant and to enjoy yourself in
the process, the correct multiplier is more like three or four times, I believe.</span></p>

</div>

<div id=ftn13>

<p class=MsoFootnoteText><a href="#_ftnref13" name="_ftn13" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[13]</span></span></span></span></a><span lang=EN-US> For
starters, I recommend the aforementioned <i>UML Distilled</i>, 2<sup>nd</sup>
edition.</span></p>

</div>

<div id=ftn14>

<p class=MsoFootnoteText><a href="#_ftnref14" name="_ftn14" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[14]</span></span></span></span></a><span lang=EN-US> </span><span lang=EN-US>Python (www.Python.org) is often used as “executable pseudocode.”</span></p>

</div>

<div id=ftn15>

<p class=MsoFootnoteText><a href="#_ftnref15" name="_ftn15" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[15]</span></span></span></span></a><span lang=EN-US> At
least one aspect of evolution is covered in </span><span
lang=EN-US>Martin Fowler’s book </span><span
lang=EN-US><i>Refactoring: improving the design of existing code</i>
(Addison-Wesley 1999), which uses Java examples exclusively.</span></p>

</div>

<div id=ftn16>

<p class=MsoFootnoteText><a href="#_ftnref16" name="_ftn16" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[16]</span></span></span></span></a><span lang=EN-US> This
is something like “</span><span lang=EN-US>rapid prototyping,” where you were
supposed to build a quick-and-dirty version so that you could learn about the
system, and then throw away your prototype and build it right. The trouble with
rapid prototyping is that people didn’t throw away the prototype, but instead
built upon it. Combined with the lack of structure in procedural programming,
this often leads to messy systems that are expensive to maintain.</span></p>

</div>

<div id=ftn17>

<p class=MsoFootnoteText><a href="#_ftnref17" name="_ftn17" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[17]</span></span></span></span></a><span lang=EN-US>
Although this may be a more American perspective, the stories of Hollywood
reach everywhere.</span></p>

</div>

<div id=ftn18>

<p class=MsoFootnoteText><a href="#_ftnref18" name="_ftn18" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[18]</span></span></span></span></a><span lang=EN-US>
Including (especially) the PA system. I once worked in a company that insisted
on broadcasting every phone call that arrived for every executive, and it
constantly interrupted our productivity (but the managers couldn’t begin to
conceive of stifling such an important service as the PA). Finally, when no one
was looking I started snipping speaker wires.</span></p>

</div>

<div id=ftn19>

<p class=MsoFootnoteText><a href="#_ftnref19" name="_ftn19" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[19]</span></span></span></span></a><span lang=EN-US> In
particular, I recommend looking at </span><span lang=EN-US>Python (http://www.Python.org).</span></p>

</div>

<div id=ftn20>

<p class=MsoFootnoteText><a href="#_ftnref20" name="_ftn20" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[20]</span></span></span></span></a><span lang=EN-US> This
can be a flashpoint. There are those who say “clearly, it’s a pointer,” but
this presumes an underlying implementation. Also, Java references are much more
akin to C++ references than pointers in their syntax. In the first edition of
this book, I chose to invent a new term, “handle,” because C++ references and
Java references have some important differences. I was coming out of C++ and
did not want to confuse the C++ programmers whom I assumed would be the largest
audience for Java. In the 2<sup>nd</sup> edition, I decided that “reference”
was the more commonly used term, and that anyone changing from C++ would have a
lot more to cope with than the terminology of references, so they might as well
jump in with both feet. However, there are people who disagree even with the
term “reference.” I read in one book where it was “completely wrong to say that
Java supports pass by reference,” because Java object identifiers (according to
that author) are <i>actually</i> “object references.” And (he goes on)
everything is <i>actually</i> pass by value. So you’re not passing by
reference, you’re “passing an object reference by value.” One could argue for
the precision of such convoluted explanations, but I think my approach
simplifies the understanding of the concept without hurting anything (well, the
language lawyers may claim that I’m lying to you, but I’ll say that I’m
providing an appropriate abstraction.)</span></p>

</div>

<div id=ftn21>

<p class=MsoFootnoteText><a href="#_ftnref21" name="_ftn21" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[21]</span></span></span></span></a><span lang=EN-US> <b>static</b>
methods, which you’ll learn about soon, can be called <i>for the class</i>,
without an object.</span></p>

</div>

<div id=ftn22>

<p class=MsoFootnoteText><a href="#_ftnref22" name="_ftn22" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[22]</span></span></span></span></a><span lang=EN-US> With
the usual exception of the aforementioned “special” data types <b>boolean, char</b>,
<b>byte</b>, <b>short</b>, <b>int</b>, <b>long</b>,<b> float,</b> and <b>double</b>.
In general, though, you pass objects, which really means you pass references to
objects.</span></p>

</div>

<div id=ftn23>

<p class=MsoFootnoteText><a href="#_ftnref23" name="_ftn23" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[23]</span></span></span></span></a><span lang=EN-US> Some
programming environments will flash programs up on the screen and close them
before you've had a chance to see the results. You can put in the following bit
of code at the end of <b>main(&nbsp;)</b> to pause the output:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>    try {</span></p>

<p class=Code style='margin-left:0cm;line-height:normal'><span lang=EN-US
style='font-size:9.0pt'>      System.in.read();</span></p>

<p class=CodeInline style='margin-left:0cm;line-height:normal'><span
lang=EN-US style='font-size:9.0pt'>    } catch(Exception e) {}</span></p>

</div>

<p class=CodeInlineTrailer><span lang=EN-US>&nbsp;</span></p>

<p class=MsoFootnoteText><span lang=EN-US>This will pause the output until you
press “Enter” (or any other key). This code involves concepts that will not be
introduced until much later in the book, so you won’t understand it until then,
but it will do the trick.</span></p>

</div>

<div id=ftn24>

<p class=MsoFootnoteText><a href="#_ftnref24" name="_ftn24" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[24]</span></span></span></span></a><span lang=EN-US> A tool
that I created using Python (see www.Python.org) uses this information to
extract the code files, put them in appropriate subdirectories, and create
makefiles.</span></p>

</div>

<div id=ftn25>

<p class=MsoFootnoteText><a href="#_ftnref25" name="_ftn25" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[25]</span></span></span></span></a><span lang=EN-US> John
Kirkham writes, “I started computing in 1962 using FORTRAN II on an IBM 1620.
At that time, and throughout the 1960s and into the 1970s, FORTRAN was an all
uppercase language. This probably started because many of the early input
devices were old teletype units that used 5 bit Baudot code, which had no
lowercase capability. The ‘E’ in the exponential notation was also always upper
case and was never confused with the natural logarithm base ‘e’, which is
always lowercase. The ‘E’ simply stood for exponential, which was for the base
of the number system used—usually 10. At the time octal was also widely used by
programmers. Although I never saw it used, if I had seen an octal number in
exponential notation I would have considered it to be base 8. The first time I
remember seeing an exponential using a lowercase ‘e’ was in the late 1970s and
I also found it confusing. The problem arose as lowercase crept into FORTRAN,
not at its beginning. We actually had functions to use if you really wanted to
use the natural logarithm base, but they were all uppercase.”</span></p>

</div>

<div id=ftn26>

<p class=MsoFootnoteText><a href="#_ftnref26" name="_ftn26" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[26]</span></span></span></span></a><span lang=EN-US> Chuck
Allison writes: The total number of numbers in a floating-point number system
is<br>
<b>2(M-m+1)b^(p-1) + 1</b><br>
where <b>b</b> is the base (usually 2), <b>p</b> is the precision (digits in
the mantissa), <b>M</b> is the largest exponent, and <b>m</b> is the smallest
exponent. IEEE 754 uses:<br>
<b>M = 1023, m = -1022, p = 53, b = 2</b><br>
so the total number of numbers is<br>
<b>2(1023+1022+1)2^52<br>
= 2((2^10-1) + (2^10-1))2^52<br>
= (2^10-1)2^54<br>
= 2^64 - 2^54</b><br>
Half of these numbers (corresponding to exponents in the range [-1022, 0]) are
less than 1 in magnitude (both positive and negative), so 1/4 of that
expression, or 2^62 - 2^52  + 1 (approximately 2^62)  is in the range [0,1).
See my paper at http://www.freshsources.com/1995006a.htm (last of text).</span></p>

</div>

<div id=ftn27>

<p class=MsoFootnoteText><a href="#_ftnref27" name="_ftn27" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[27]</span></span></span></span></a><span lang=EN-US> In
some of the Java literature from Sun they instead refer to these with the
clumsy but descriptive name “</span><span lang=EN-US>no-arg constructors.” The term “default constructor” has been in use
for many years and so I will use that.</span></p>

</div>

<div id=ftn28>

<p class=MsoFootnoteText><a href="#_ftnref28" name="_ftn28" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[28]</span></span></span></span></a><span lang=EN-US> The
one case in which this is possible occurs if you pass a reference to an object
into the <b>static</b> method. Then, via the reference (which is now
effectively <b>this</b>), you can call non-<b>static</b> methods and access
non-<b>static</b> fields. But typically if you want to do something like this
you’ll just make an ordinary, non-<b>static</b> method.</span></p>

</div>

<div id=ftn29>

<p class=MsoFootnoteText><a href="#_ftnref29" name="_ftn29" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[29]</span></span></span></span></a><span lang=EN-US> A term
coined by Bill Venners (www.artima.com) during a seminar that he and I were
giving together.</span></p>

</div>

<div id=ftn30>

<p class=MsoFootnoteText><a href="#_ftnref30" name="_ftn30" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[30]</span></span></span></span></a><span lang=EN-US> In
contrast, C++ has the <i>constructor initializer list</i> that causes
initialization to occur before entering the constructor body, and is enforced
for objects. See <i>Thinking in C++, 2<sup>nd</sup> edition</i> (available on
this book’s CD ROM and at <i>www.BruceEckel.com</i>).</span></p>

</div>

<div id=ftn31>

<p class=MsoFootnoteText><a href="#_ftnref31" name="_ftn31" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[31]</span></span></span></span></a><span lang=EN-US> See <i>Thinking
in C++, 2<sup>nd</sup> edition</i>  for a complete description of C++ aggregate
initialization.</span></p>

</div>

<div id=ftn32>

<p class=MsoFootnoteText><a href="#_ftnref32" name="_ftn32" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[32]</span></span></span></span></a><span lang=EN-US>
There’s nothing in Java that forces the use of an interpreter. There exist
native-code Java compilers that generate a single executable file.</span></p>

</div>

<div id=ftn33>

<p class=MsoFootnoteText><a href="#_ftnref33" name="_ftn33" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[33]</span></span></span></span></a><span lang=EN-US>
There’s another effect in this case: Since the default constructor is the only
one defined, and it’s <b>private</b>, it will prevent inheritance of this
class. (A subject that will be introduced in Chapter 6.)</span></p>

</div>

<div id=ftn34>

<p class=MsoFootnoteText><a href="#_ftnref34" name="_ftn34" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[34]</span></span></span></span></a><span lang=EN-US>
However, people often refer to implementation hiding alone as encapsulation.</span></p>

</div>

<div id=ftn35>

<p class=MsoFootnoteText><a href="#_ftnref35" name="_ftn35" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[35]</span></span></span></span></a><span lang=EN-US>
Actually, an <i>inner class</i> can be private or protected, but that’s a special
case. These will be introduced in Chapter 7.</span></p>

</div>

<div id=ftn36>

<p class=MsoFootnoteText><a href="#_ftnref36" name="_ftn36" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[36]</span></span></span></span></a><span lang=EN-US> You
can also do it by inheriting (Chapter 6) from that class.</span></p>

</div>

<div id=ftn37>

<p class=MsoFootnoteText><a href="#_ftnref37" name="_ftn37" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[37]</span></span></span></span></a><span lang=EN-US> For
C++ programmers, this is the analogue of C++’s <i>pure virtual function</i>.</span></p>

</div>

<div id=ftn38>

<p class=MsoNormal><a href="#_ftnref38" name="_ftn38" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[38]</span></span></span></span></a><span lang=EN-US
style='font-size:9.0pt'> This approach was inspired by an e-mail from Rich
Hoffarth.</span></p>

</div>

<div id=ftn39>

<p class=MsoFootnoteText><a href="#_ftnref39" name="_ftn39" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[39]</span></span></span></span></a><span lang=EN-US> Thanks
to Martin Danner for asking this question during a seminar.</span></p>

</div>

<div id=ftn40>

<p class=MsoFootnoteText><a href="#_ftnref40" name="_ftn40" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[40]</span></span></span></span></a><span lang=EN-US> This
is very different from the design of <i>nested classes</i> in C++, which is
simply a name-hiding mechanism. There is no link to an enclosing object and no
implied permissions in C++.</span></p>

</div>

<div id=ftn41>

<p class=MsoFootnoteText><a href="#_ftnref41" name="_ftn41" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[41]</span></span></span></span></a><span lang=EN-US> Thanks
again to Martin Danner.</span></p>

</div>

<div id=ftn42>

<p class=MsoFootnoteText><a href="#_ftnref42" name="_ftn42" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[42]</span></span></span></span></a><span lang=EN-US> On the
other hand, ‘$’ is a meta-character to the Unix shell and so you’ll sometimes
have trouble when listing the <b>.class</b> files. This is a bit strange coming
from Sun, a Unix-based company. My guess is that they weren’t considering this
issue, but instead thought you’d naturally focus on the source-code files.</span></p>

</div>

<div id=ftn43>

<p class=MsoFootnoteText><a href="#_ftnref43" name="_ftn43" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[43]</span></span></span></span></a><span lang=EN-US> For
some reason this has always been a pleasing problem for me to solve; it came
from my earlier book <i>C++ Inside &amp; Out</i>, but Java allows a much more
elegant solution.</span></p>

</div>

<div id=ftn44>

<p class=MsoFootnoteText><a href="#_ftnref44" name="_ftn44" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[44]</span></span></span></span></a><span lang=EN-US> It’s
possible, however, to ask how big the <b>vector</b> is, and the <b>at(&nbsp;)</b>
method <i>does</i> perform bounds checking.</span></p>

</div>

<div id=ftn45>

<p class=MsoFootnoteText><a href="#_ftnref45" name="_ftn45" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[45]</span></span></span></span></a><span lang=EN-US> This
is one of the places where C++ is distinctly superior to Java, since C++ supports
<i>parameterized types</i> with the <b>template</b> keyword.</span></p>

</div>

<div id=ftn46>

<p class=MsoFootnoteText><a href="#_ftnref46" name="_ftn46" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[46]</span></span></span></span></a><span lang=EN-US> The
C++ programmer will note how much the code could be collapsed with the use of
default arguments and templates. The Python programmer will note that this
entire library would be largely unnecessary in that language.</span></p>

</div>

<div id=ftn47>

<p class=MsoFootnoteText><a href="#_ftnref47" name="_ftn47" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[47]</span></span></span></span></a><span lang=EN-US> By
Joshua Bloch at Sun.</span></p>

</div>

<div id=ftn48>

<p class=MsoFootnoteText><a href="#_ftnref48" name="_ftn48" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[48]</span></span></span></span></a><span lang=EN-US> This
data was found on the Internet, then processed by creating a Python program
(see <i>www.Python.org</i>).</span></p>

</div>

<div id=ftn49>

<p class=MsoFootnoteText><a href="#_ftnref49" name="_ftn49" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[49]</span></span></span></span></a><span lang=EN-US> This
is a place where operator overloading would be nice.</span></p>

</div>

<div id=ftn50>

<p class=MsoFootnoteText><a href="#_ftnref50" name="_ftn50" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[50]</span></span></span></span></a><span lang=EN-US> If
these speedups still don’t meet your performance needs, you can further
accelerate table lookup by writing your own <b>Map</b> and customizing it to
your particular types to avoid delays due to casting to and from <b>Object</b>s.
To reach even higher levels of performance, speed enthusiasts can use Donald
Knuth’s <i>The Art of Computer Programming, Volume 3: Sorting and Searching, Second
Edition</i> to replace overflow bucket lists with arrays that have two
additional benefits: they can be optimized for disk storage characteristics and
they can save most of the time of creating and garbage collecting individual
records.</span></p>

</div>

<div id=ftn51>

<p class=MsoFootnoteText><a href="#_ftnref51" name="_ftn51" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[51]</span></span></span></span></a><span lang=EN-US> The C
programmer can look up the return value of <b>printf(&nbsp;)</b> for an example
of this.</span></p>

</div>

<div id=ftn52>

<p class=MsoFootnoteText><a href="#_ftnref52" name="_ftn52" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[52]</span></span></span></span></a><span lang=EN-US> This
is a significant improvement over C++ exception handling, which doesn’t catch
violations of exception specifications until run time, when it’s not very
useful.</span></p>

</div>

<div id=ftn53>

<p class=MsoFootnoteText><a href="#_ftnref53" name="_ftn53" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[53]</span></span></span></span></a><span lang=EN-US> C++
exception handling does not have the <b>finally</b> clause because it relies on
destructors to accomplish this sort of cleanup.</span></p>

</div>

<div id=ftn54>

<p class=MsoFootnoteText><a href="#_ftnref54" name="_ftn54" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[54]</span></span></span></span></a><span lang=EN-US> A
destructor is a function that’s always called when an object becomes unused.
You always know exactly where and when the destructor gets called. C++ has
automatic destructor calls, but Delphi’s Object Pascal versions 1 and 2 do not
(which changes the meaning and use of the concept of a destructor for that
language).</span></p>

</div>

<div id=ftn55>

<p class=MsoFootnoteText><a href="#_ftnref55" name="_ftn55" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[55]</span></span></span></span></a><span lang=EN-US> ISO
C++ added similar constraints that require derived-method exceptions to be the same
as, or derived from, the exceptions thrown by the base-class method. This is
one case in which C++ is actually able to check exception specifications at
compile-time.</span></p>

</div>

<div id=ftn56>

<p class=MsoFootnoteText><a href="#_ftnref56" name="_ftn56" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[56]</span></span></span></span></a><span lang=EN-US> In
C++, a <i>destructor</i> would handle this for you.</span></p>

</div>

<div id=ftn57>

<p class=MsoFootnoteText><a href="#_ftnref57" name="_ftn57" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[57]</span></span></span></span></a><span lang=EN-US> <i>Design
Patterns</i>, Erich Gamma <i>et al.</i>, Addison-Wesley 1995.</span></p>

</div>

<div id=ftn58>

<p class=MsoFootnoteText><a href="#_ftnref58" name="_ftn58" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[58]</span></span></span></span></a><span lang=EN-US> XML is
another way to solve the problem of moving data across different computing
platforms, and does not depend on having Java on all platforms. However, Java
tools exist that support XML.</span></p>

</div>

<div id=ftn59>

<p class=MsoFootnoteText><a href="#_ftnref59" name="_ftn59" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[59]</span></span></span></span></a><span lang=EN-US>
Chapter 13 shows an even more convenient solution for this: a GUI program with
a scrolling text area.</span></p>

</div>

<div id=ftn60>

<p class=MsoFootnoteText><a href="#_ftnref60" name="_ftn60" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[60]</span></span></span></span></a><span lang=EN-US>
Especially in the past. However, Sun has greatly improved its HTML Java
documentation so that it’s easier to see base-class methods.</span></p>

</div>

<div id=ftn61>

<p class=MsoFootnoteText><a href="#_ftnref61" name="_ftn61" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[61]</span></span></span></span></a><span lang=EN-US> A
variation on this is called “the principle of least astonishment,” which
essentially says: “don’t surprise the user.”</span></p>

</div>

<div id=ftn62>

<p class=MsoFootnoteText><a href="#_ftnref62" name="_ftn62" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[62]</span></span></span></span></a><span lang=EN-US> This
is an example of the design pattern called the <i>template method</i>.</span></p>

</div>

<div id=ftn63>

<p class=MsoFootnoteText><a href="#_ftnref63" name="_ftn63" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[63]</span></span></span></span></a><span lang=EN-US> It is
assumed that the reader is familiar with the basics of HTML. It’s not too hard
to figure out, and there are lots of books and resources.</span></p>

</div>

<div id=ftn64>

<p class=MsoFootnoteText><a href="#_ftnref64" name="_ftn64" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[64]</span></span></span></span></a><span lang=EN-US> This
page—in particular, the ‘clsid’ portion—seemed to work fine with both JDK1.2.2
and JDK1.3 rc-1. However, you may find that you have to change the tag sometime
in the future. Details can be found at <i>java.sun.com</i>.</span></p>

</div>

<div id=ftn65>

<p class=MsoFootnoteText><a href="#_ftnref65" name="_ftn65" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[65]</span></span></span></span></a><span lang=EN-US> In my
opinion. And after you learn about Swing, you won’t want to waste your time on
the earlier stuff.</span></p>

</div>

<div id=ftn66>

<p class=MsoFootnoteText><a href="#_ftnref66" name="_ftn66" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[66]</span></span></span></span></a><span lang=EN-US> As
described earlier, “Frame” was already taken by the AWT, so Swing uses JFrame.</span></p>

</div>

<div id=ftn67>

<p class=MsoFootnoteText><a href="#_ftnref67" name="_ftn67" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[67]</span></span></span></span></a><span lang=EN-US> This
will make sense after you’ve read further in this chapter. First, make the
reference <b>J</b><b>Applet</b> a <b>static</b> member of the class (instead of
a local variable of <b>main(&nbsp;)</b>), and then call <b>applet.stop(&nbsp;)</b>
and <b>applet.destroy(&nbsp;)</b> inside <b>WindowAdapter.windowClosing(&nbsp;)</b>
before you call <b>System.exit(&nbsp;)</b>.</span></p>

</div>

<div id=ftn68>

<p class=MsoFootnoteText><a href="#_ftnref68" name="_ftn68" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[68]</span></span></span></span></a><span lang=EN-US> There
is no <b>MouseMotionEvent</b> even though it seems like there ought to be. Clicking
and motion is combined into <b>MouseEvent</b>, so this second appearance of <b>MouseEvent</b>
in the table is not an error.</span></p>

</div>

<div id=ftn69>

<p class=MsoFootnoteText><a href="#_ftnref69" name="_ftn69" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[69]</span></span></span></span></a><span lang=EN-US> In
Java 1.0/1.1 you could <i>not</i> usefully inherit from the button object. This
was only one of numerous fundamental design flaws.</span></p>

</div>

<div id=ftn70>

<p class=MsoFootnoteText><a href="#_ftnref70" name="_ftn70" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[70]</span></span></span></span></a><span lang=EN-US> <b>Runnable</b>
was in Java 1.0, while inner classes were not introduced until Java 1.1, which
may partially account for the existence of <b>Runnable</b>. Also, traditional
multithreading architectures focused on a function to be run rather than an
object. My preference is always to inherit from <b>Thread</b> if I can; it
seems cleaner and more flexible to me.</span></p>

</div>

<div id=ftn71>

<p class=MsoFootnoteText><a href="#_ftnref71" name="_ftn71" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[71]</span></span></span></span></a><span lang=EN-US> <i>The
Java Programming Language</i>, by Ken Arnold and James Gosling, Addison-Wesley
1996 pp 179.</span></p>

</div>

<div id=ftn72>

<p class=MsoFootnoteText><a href="#_ftnref72" name="_ftn72" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[72]</span></span></span></span></a><span lang=EN-US> This
means a maximum of just over four billion numbers, which is rapidly running
out. The new standard for IP addresses will use a 128-bit number, which should
produce enough unique IP addresses for the foreseeable future.</span></p>

</div>

<div id=ftn73>

<p class=MsoFootnoteText><a href="#_ftnref73" name="_ftn73" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[73]</span></span></span></span></a><span lang=EN-US>
Created by Dave Bartlett.</span></p>

</div>

<div id=ftn74>

<p class=MsoFootnoteText><a href="#_ftnref74" name="_ftn74" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[74]</span></span></span></span></a><span lang=EN-US> Dave
Bartlett was instrumental in the development of this material, and also the JSP
section.</span></p>

</div>

<div id=ftn75>

<p class=MsoFootnoteText><a href="#_ftnref75" name="_ftn75" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[75]</span></span></span></span></a><span lang=EN-US> A
primary tenet of Extreme Programming (XP). See <i>www.xprogramming.com</i>.</span></p>

</div>

<div id=ftn76>

<p class=MsoFootnoteText><a href="#_ftnref76" name="_ftn76" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[76]</span></span></span></span></a><span lang=EN-US> Many
brain cells died in agony to discover this information.</span></p>

</div>

<div id=ftn77>

<p class=MsoFootnoteText><a href="#_ftnref77" name="_ftn77" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[77]</span></span></span></span></a><span lang=EN-US> This
section was contributed by Robert Castaneda, with help from Dave Bartlett.</span></p>

</div>

<div id=ftn78>

<p class=MsoFootnoteText><a href="#_ftnref78" name="_ftn78" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[78]</span></span></span></span></a><span lang=EN-US> This
section was contributed by Bill Venners (www.artima.com).</span></p>

</div>

<div id=ftn79>

<p class=MsoFootnoteText><a href="#_ftnref79" name="_ftn79" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[79]</span></span></span></span></a><span lang=EN-US> In C,
which generally handles small bits of data, the default is pass-by-value. C++
had to follow this form, but with objects pass-by-value isn’t usually the most
efficient way. In addition, coding classes to support pass-by-value in C++ is a
big headache.</span></p>

</div>

<div id=ftn80>

<p class=MsoFootnoteText><a href="#_ftnref80" name="_ftn80" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[80]</span></span></span></span></a><span lang=EN-US> This
is not the dictionary spelling of the word, but it’s what is used in the Java
library, so I’ve used it here, too, in some hopes of reducing confusion.</span></p>

</div>

<div id=ftn81>

<p class=MsoFootnoteText><a href="#_ftnref81" name="_ftn81" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[81]</span></span></span></span></a><span lang=EN-US> You
can apparently create a simple counter-example to this statement, like this:</span></p>

<div style='border:none;border-left:solid windowtext 1.0pt;padding:0cm 0cm 0cm 10.0pt;
margin-left:18.0pt;margin-right:0cm'>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>public
class Cloneit implements Cloneable {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'> 
public static void main (String[] args) </span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'> 
throws CloneNotSupportedException {</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>   
Cloneit a = new Cloneit();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>   
Cloneit b = (Cloneit)a.clone();</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'> 
}</span></p>

<p class=Code style='margin-left:0cm'><span lang=EN-US style='font-size:9.0pt'>}</span></p>

</div>

<p class=MsoFootnoteText><span lang=EN-US>However, this only works because <b>main(&nbsp;)</b>
is a method of <b>Cloneit</b> and thus has permission to call the <b>protected</b>
base-class method <b>clone(&nbsp;)</b>. If you call it from a different class,
it won’t compile.</span></p>

</div>

<div id=ftn82>

<p class=MsoFootnoteText><a href="#_ftnref82" name="_ftn82" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[82]</span></span></span></span></a><span lang=EN-US> Except
for the poor avocado, which has been reclassified to simply “fat.”</span></p>

</div>

<div id=ftn83>

<p class=MsoFootnoteText><a href="#_ftnref83" name="_ftn83" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[83]</span></span></span></span></a><span lang=EN-US> C++
allows the programmer to overload operators at will. Because this can often be
a complicated process (see Chapter 10 of <i>Thinking in C++, 2<sup>nd</sup>
edition,</i> Prentice-Hall, 2000), the Java designers deemed it a “bad” feature
that shouldn’t be included in Java. It wasn’t so bad that they didn’t end up
doing it themselves, and ironically enough, operator overloading would be much
easier to use in Java than in C++. This can be seen in Python (see
www.Python.org) which has garbage collection and straightforward operator
overloading.</span></p>

</div>

<div id=ftn84>

<p class=MsoFootnoteText><a href="#_ftnref84" name="_ftn84" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[84]</span></span></span></span></a><span lang=EN-US> Doug
Lea, who was helpful in resolving this issue, suggested this to me, saying that
he simply creates a function called <b>duplicate(&nbsp;)</b> for each class.</span></p>

</div>

<div id=ftn85>

<p class=MsoFootnoteText><a href="#_ftnref85" name="_ftn85" title=""><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt'><span
class=MsoFootnoteReference><span lang=EN-US style='font-size:8.0pt;font-family:
"Georgia","serif"'>[85]</span></span></span></span></a><span lang=EN-US>
Explained to me by Andrew Koenig.</span></p>

</div>

</div>

</body>

</html>
